(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-31c56270","chunk-3a9abef0","chunk-79cde962","chunk-9aadce66","chunk-e4b87522","chunk-430f85e3","chunk-0658e062","chunk-2d222178"],{"003f":function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("f2e0");class n{constructor(){this.id=Object(r["b"])()}unload(){}}},"008c":function(e,t,i){"use strict";i.d(t,"a",(function(){return C})),i.d(t,"b",(function(){return w})),i.d(t,"c",(function(){return c})),i.d(t,"d",(function(){return P})),i.d(t,"e",(function(){return A})),i.d(t,"f",(function(){return M})),i.d(t,"g",(function(){return R}));var r=i("b2b2"),n=i("a9ab");const a=(e,t,i)=>[t,i],s=(e,t,i)=>[t,i,e[2]],o=(e,t,i)=>[t,i,e[2],e[3]];function c(e){return e?{originPosition:"upper-left"===e.originPosition?"upperLeft":"lower-left"===e.originPosition?"lowerLeft":e.originPosition,scale:e.tolerance?[e.tolerance,e.tolerance]:[1,1],translate:Object(r["l"])(e.extent)?[e.extent.xmin,e.extent.ymax]:[0,0]}:null}function l({scale:e,translate:t},i){return Math.round((i-t[0])/e[0])}function d({scale:e,translate:t},i){return Math.round((t[1]-i)/e[1])}function h(e,t,i){const r=[];let n,a,s,o;for(let c=0;c<i.length;c++){const h=i[c];c>0?(s=l(e,h[0]),o=d(e,h[1]),s===n&&o===a||(r.push(t(h,s-n,o-a)),n=s,a=o)):(n=l(e,h[0]),a=d(e,h[1]),r.push(t(h,n,a)))}return r.length>0?r:null}function u(e,t,i,r){return h(e,i?r?o:s:r?s:a,t)}function p(e,t,i,r){const n=[],c=i?r?o:s:r?s:a;for(let a=0;a<t.length;a++){const i=h(e,c,t[a]);i&&i.length>=3&&n.push(i)}return n.length?n:null}function f(e,t,i,r){const n=[],c=i?r?o:s:r?s:a;for(let a=0;a<t.length;a++){const i=h(e,c,t[a]);i&&i.length>=2&&n.push(i)}return n.length?n:null}function b({scale:e,translate:t},i){return i*e[0]+t[0]}function m({scale:e,translate:t},i){return t[1]-i*e[1]}function g(e,t,i){const r=new Array(i.length);if(!i.length)return r;const[n,a]=e.scale;let s=b(e,i[0][0]),o=m(e,i[0][1]);r[0]=t(i[0],s,o);for(let c=1;c<i.length;c++){const e=i[c];s+=e[0]*n,o-=e[1]*a,r[c]=t(e,s,o)}return r}function v(e,t,i){const r=new Array(i.length);for(let n=0;n<i.length;n++)r[n]=g(e,t,i[n]);return r}function y(e,t,i,r){return g(e,i?r?o:s:r?s:a,t)}function O(e,t,i,r){return v(e,i?r?o:s:r?s:a,t)}function _(e,t,i,r){return v(e,i?r?o:s:r?s:a,t)}function x(e,t,i,r,n){return t.xmin=l(e,i.xmin),t.ymin=d(e,i.ymin),t.xmax=l(e,i.xmax),t.ymax=d(e,i.ymax),t!==i&&(r&&(t.zmin=i.zmin,t.zmax=i.zmax),n&&(t.mmin=i.mmin,t.mmax=i.mmax)),t}function j(e,t,i,r,n){return t.points=u(e,i.points,r,n),t}function w(e,t,i,r,n){return t.x=l(e,i.x),t.y=d(e,i.y),t!==i&&(r&&(t.z=i.z),n&&(t.m=i.m)),t}function S(e,t,i,r,n){const a=p(e,i.rings,r,n);return a?(t.rings=a,t):null}function T(e,t,i,r,n){const a=f(e,i.paths,r,n);return a?(t.paths=a,t):null}function C(e,t){return e&&t?Object(n["f"])(t)?w(e,{},t,!1,!1):Object(n["h"])(t)?T(e,{},t,!1,!1):Object(n["g"])(t)?S(e,{},t,!1,!1):Object(n["e"])(t)?j(e,{},t,!1,!1):Object(n["d"])(t)?x(e,{},t,!1,!1):null:null}function P(e,t,i,n,a){return Object(r["l"])(i)&&(t.points=y(e,i.points,n,a)),t}function A(e,t,i,n,a){return Object(r["k"])(i)||(t.x=b(e,i.x),t.y=m(e,i.y),t!==i&&(n&&(t.z=i.z),a&&(t.m=i.m))),t}function M(e,t,i,n,a){return Object(r["l"])(i)&&(t.rings=_(e,i.rings,n,a)),t}function R(e,t,i,n,a){return Object(r["l"])(i)&&(t.paths=O(e,i.paths,n,a)),t}},"0278":function(e,t,i){"use strict";i.d(t,"a",(function(){return c}));var r=i("b2b2"),n=i("b616"),a=i("003f"),s=i("1038"),o=i("1153");class c extends a["a"]{constructor(e,t=[],i=0,r=-1){super(),this._primitiveType=i,this.edgeIndicesLength=r,this.type=2,this._vertexAttributes=new Map,this._indices=new Map,this._boundingInfo=null;for(const[n,a]of e)a&&this._vertexAttributes.set(n,{...a});if(null==t||0===t.length){const e=l(this._vertexAttributes),t=Object(s["d"])(e);this.edgeIndicesLength=this.edgeIndicesLength<0?e:this.edgeIndicesLength;for(const i of this._vertexAttributes.keys())this._indices.set(i,t)}else for(const[n,a]of t)a&&(this._indices.set(n,d(a)),"position"===n&&(this.edgeIndicesLength=this.edgeIndicesLength<0?this._indices.get(n).length:this.edgeIndicesLength))}get vertexAttributes(){return this._vertexAttributes}getMutableAttribute(e){const t=this._vertexAttributes.get(e);return t&&!t.exclusive&&(t.data=Array.from(t.data),t.exclusive=!0),t}get indices(){return this._indices}get indexCount(){const e=this._indices.values().next().value;return e?e.length:0}get primitiveType(){return this._primitiveType}get faceCount(){return this.indexCount/3}get boundingInfo(){return Object(r["k"])(this._boundingInfo)&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}computeAttachmentOrigin(e){return 0===this.primitiveType?this.computeAttachmentOriginTriangles(e):this.computeAttachmentOriginPoints(e)}computeAttachmentOriginTriangles(e){const t=this.indices.get("position"),i=this.vertexAttributes.get("position");return Object(s["c"])(i,t,e)}computeAttachmentOriginPoints(e){const t=this.indices.get("position"),i=this.vertexAttributes.get("position");return Object(s["b"])(i,t,e)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){const e=this.indices.get("position");if(0===e.length)return null;const t=0===this.primitiveType?3:1;Object(o["a"])(e.length%t==0,"Indexing error: "+e.length+" not divisible by "+t);const i=Object(s["d"])(e.length/t),r=this.vertexAttributes.get("position");return new n["a"](i,t,e,r)}}function l(e){const t=e.values().next().value;return null==t?0:t.data.length/t.size}function d(e){if(e.BYTES_PER_ELEMENT===Uint16Array.BYTES_PER_ELEMENT)return e;for(const t of e)if(t>=65536)return e;return new Uint16Array(e)}},"0310":function(e,t,i){"use strict";i.d(t,"a",(function(){return E})),i.d(t,"b",(function(){return R}));var r=i("bd75"),n=i("17ca"),a=i("d272"),s=i("4db9"),o=i("d539"),c=i("c332"),l=i("b09a"),d=i("6cb2"),h=i("dfaf"),u=i("6d5b"),p=i("7d11"),f=i("17b0"),b=i("7e21"),m=i("d047"),g=i("0d7a"),v=i("7088"),y=i("ea4b"),O=i("c6d7"),_=i("aab5"),x=i("5d5f"),j=i("a7d7"),w=i("d017"),S=i("be24"),T=i("ebd5"),C=i("d56e"),P=i("3626"),A=i("3886"),M=i("690a");function R(e){const t=new M["a"],i=t.vertex.code,R=t.fragment.code;return t.include(C["a"],{name:"Default Material Shader",output:e.output}),t.vertex.uniforms.add("proj","mat4").add("view","mat4").add("camPos","vec3").add("localOrigin","vec3"),t.include(l["a"]),t.varyings.add("vpos","vec3"),t.include(S["a"],e),t.include(o["a"],e),t.include(f["a"],e),0!==e.output&&7!==e.output||(t.include(c["a"],e),t.include(s["a"],{linearDepth:!1}),0===e.normalType&&e.offsetBackfaces&&t.include(n["a"]),t.include(g["a"],e),t.include(p["a"],e),e.instancedColor&&t.attributes.add("instanceColor","vec4"),t.varyings.add("localvpos","vec3"),t.include(h["a"],e),t.include(r["a"],e),t.include(d["a"],e),t.include(u["a"],e),t.vertex.uniforms.add("externalColor","vec4"),t.varyings.add("vcolorExt","vec4"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),i.add(A["a"]`
      void main(void) {
        forwardNormalizedVertexColor();
        vcolorExt = externalColor;
        ${e.instancedColor?"vcolorExt *= instanceColor;":""}
        vcolorExt *= vvColor();
        vcolorExt *= getSymbolColor();
        forwardColorMixMode();

        if (vcolorExt.a < ${A["a"].float(T["c"])}) {
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        }
        else {
          vpos = calculateVPos();
          localvpos = vpos - view[3].xyz;
          vpos = subtractOrigin(vpos);
          ${0===e.normalType?A["a"]`
          vNormalWorld = dpNormal(vvLocalNormal(normalModel()));`:""}
          vpos = addVerticalOffset(vpos, localOrigin);
          ${e.vertexTangents?"vTangent = dpTransformVertexTangent(tangent);":""}
          gl_Position = transformPosition(proj, view, vpos);
          ${0===e.normalType&&e.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, camPos);":""}
        }

        ${e.multipassTerrainEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}
        forwardLinearDepth();
        forwardTextureCoordinates();
      }
    `)),7===e.output&&(t.include(a["a"],e),t.include(T["a"],e),e.multipassTerrainEnabled&&(t.fragment.include(m["a"]),t.include(O["b"],e)),t.fragment.uniforms.add("camPos","vec3").add("localOrigin","vec3").add("opacity","float").add("layerOpacity","float"),e.hasColorTexture&&t.fragment.uniforms.add("tex","sampler2D"),t.fragment.include(P["a"]),R.add(A["a"]`
      void main() {
        discardBySlice(vpos);
        ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${e.hasColorTexture?A["a"]`
        vec4 texColor = texture2D(tex, vuv0);
        ${e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
        discardOrAdjustAlpha(texColor);`:A["a"]`vec4 texColor = vec4(1.0);`}
        ${e.attributeColor?A["a"]`
        float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:A["a"]`
        float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));
        `}
        gl_FragColor = vec4(opacity_);
      }
    `)),0===e.output&&(t.include(a["a"],e),t.include(y["a"],e),t.include(v["a"],e),t.include(T["a"],e),e.receiveShadows&&t.include(w["a"],e),e.multipassTerrainEnabled&&(t.fragment.include(m["a"]),t.include(O["b"],e)),t.fragment.uniforms.add("camPos","vec3").add("localOrigin","vec3").add("ambient","vec3").add("diffuse","vec3").add("opacity","float").add("layerOpacity","float"),e.hasColorTexture&&t.fragment.uniforms.add("tex","sampler2D"),t.include(j["b"],e),t.include(x["a"],e),t.fragment.include(P["a"]),t.include(_["a"],e),R.add(A["a"]`
      void main() {
        discardBySlice(vpos);
        ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${e.hasColorTexture?A["a"]`
        vec4 texColor = texture2D(tex, vuv0);
        ${e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
        discardOrAdjustAlpha(texColor);`:A["a"]`vec4 texColor = vec4(1.0);`}
        shadingParams.viewDirection = normalize(vpos - camPos);
        ${3===e.normalType?A["a"]`
        vec3 normal = screenDerivativeNormal(localvpos);`:A["a"]`
        shadingParams.normalView = vNormalWorld;
        vec3 normal = shadingNormal(shadingParams);`}
        ${1===e.pbrMode?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${e.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":1===e.viewingMode?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${e.attributeColor?A["a"]`
        vec3 albedo_ = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
        float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:A["a"]`
        vec3 albedo_ = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
        float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));
        `}
        ${e.hasNormalTexture?A["a"]`
              mat3 tangentSpace = ${e.vertexTangents?"computeTangentSpace(normal);":"computeTangentSpace(normal, vpos, vuv0);"}
              vec3 shadedNormal = computeTextureNormal(tangentSpace, vuv0);`:"vec3 shadedNormal = normal;"}
        ${1===e.pbrMode||2===e.pbrMode?1===e.viewingMode?A["a"]`vec3 normalGround = normalize(vpos + localOrigin);`:A["a"]`vec3 normalGround = vec3(0.0, 0.0, 1.0);`:A["a"]``}
        ${1===e.pbrMode||2===e.pbrMode?A["a"]`
            float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * lightingMainIntensity[2];
            vec3 shadedColor = evaluateSceneLightingPBR(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:"vec3 shadedColor = evaluateSceneLighting(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight);"}
        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `)),t.include(b["a"],e),t}const E=Object.freeze({__proto__:null,build:R})},"040b":function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("3886");function n(e,t){1===t.viewingMode?e.vertex.code.add(r["a"]`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return normalize(pos + origin);
}`):e.vertex.code.add(r["a"]`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return vec3(0.0, 0.0, 1.0);
}`),1===t.viewingMode?e.vertex.code.add(r["a"]`mat3 getTBNMatrix(in vec3 n) {
vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`):e.vertex.code.add(r["a"]`mat3 getTBNMatrix(in vec3 n) {
vec3 t = vec3(1.0, 0.0, 0.0);
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`)}},"0480":function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return s}));var r=i("8190"),n=i("fc00");function a(e,t){return t.push(e.buffer),{buffer:e.buffer,layout:o(e.layout)}}function s(e){return c(e.layout).createView(e.buffer)}function o(e){const t=new Array;return e.fields.forEach((e,i)=>{const r={...e,constructor:d(e.constructor)};t.push([i,r])}),{stride:e.stride,fields:t,fieldNames:e.fieldNames}}function c(e){const t=Object(n["a"])();return t.stride=e.stride,t.fieldNames=e.fieldNames,e.fields.forEach(e=>t.fields.set(e[0],{...e[1],constructor:h(e[1].constructor)})),t}const l=[r["a"],r["m"],r["u"],r["C"],r["f"],r["h"],r["b"],r["n"],r["v"],r["D"],r["g"],r["i"],r["l"],r["t"],r["B"],r["J"],r["j"],r["r"],r["z"],r["H"],r["k"],r["s"],r["A"],r["I"],r["e"],r["q"],r["y"],r["G"],r["c"],r["o"],r["w"],r["E"],r["d"],r["p"],r["x"],r["F"]];function d(e){return`${e.ElementType}_${e.ElementCount}`}function h(e){return u.get(e)}const u=new Map;l.forEach(e=>u.set(d(e),e))},"0494":function(e,t,i){"use strict";i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return c}));var r=i("b2b2");class n{constructor(e,t,i=2048){this.text=e,this._parameters=t,this.maxSize=i,this._lineWidths=new Array,this._renderPixelRatio=null,this._displayWidth=null,this.key=`${this._parameters.key}--${e}`,this._lines=e.split(/\r?\n/),this._lineHeight=this.computeLineHeight()}get displayWidth(){return this._ensureTextWidth()}get displayHeight(){return this._lineHeight*this._lines.length}get renderedWidth(){return Math.round(this.displayWidth*this.renderPixelRatio)}get renderedHeight(){return Math.round(this.displayHeight*this.renderPixelRatio)}get renderedLineHeight(){return Math.round(this._lineHeight*this.renderPixelRatio)}get renderedFontSize(){return this._parameters.definition.size*this.renderPixelRatio}get renderedHaloSize(){return this._parameters.haloSize*this.renderPixelRatio}get renderPixelRatio(){if(Object(r["k"])(this._renderPixelRatio)){const e=this._parameters.definition.pixelRatio;this.maxSize>0?this._renderPixelRatio=Math.min(e,Math.min(this.maxSize/(this.displayWidth*e),this.maxSize/(this.displayHeight*e))):this._renderPixelRatio=e}return this._renderPixelRatio}getLineXOffset(e){return Math.round((this.renderedWidth-this._lineWidths[e]*this.renderPixelRatio)/2)}render(e,t=0,i=0){const r=this.renderedLineHeight,n=this.renderedHaloSize,o=a(e.textAlign,this.renderedWidth)+n,c=n+s;e.save(),n>0&&this.renderHalo(e,o,c,t,i),this.setFontProperties(e,this.renderedFontSize),i+=c,t+=o;for(let a=0;a<this._lines.length;++a){e.globalCompositeOperation="destination-out",e.fillStyle="rgb(0, 0, 0)";const n=this._lines[a],s=this.getLineXOffset(a);e.fillText(n,t+s,i),e.globalCompositeOperation="source-over",e.fillStyle=this._parameters.fillStyle,e.fillText(n,t+this.getLineXOffset(a),i),i+=r}e.restore()}renderHalo(e,t,i,r,n){const a=this.renderedWidth,s=this.renderedHeight,o=c(l,Math.max(a,d),Math.max(s,d)),h=o.getContext("2d");h.clearRect(0,0,a,s),this.setFontProperties(h,this.renderedFontSize),h.fillStyle=this._parameters.haloStyle,h.strokeStyle=this._parameters.haloStyle;const u=this.renderedHaloSize<3;h.lineJoin=u?"miter":"round",u?this.renderHaloEmulated(h,t,i):this.renderHaloNative(h,t,i),e.globalAlpha=this._parameters.definition.halo.color[3],e.drawImage(o,0,0,a,s,r,n,a,s),e.globalAlpha=1}renderHaloEmulated(e,t,i){const r=this.renderedLineHeight,n=this.renderedHaloSize;for(let a=0;a<this._lines.length;++a){const s=this._lines[a],c=this.getLineXOffset(a);for(const[r,a]of o)e.fillText(s,t+c+n*r,i+n*a);i+=r}}renderHaloNative(e,t,i){const r=this.renderedLineHeight,n=this.renderedHaloSize;for(let a=0;a<this._lines.length;++a){const s=2*n,o=this._lines[a],c=this.getLineXOffset(a),l=5,d=.1;for(let r=0;r<l;r++){const n=1-(l-1)*d+r*d;e.lineWidth=n*s,e.strokeText(o,t+c,i)}i+=r}}setFontProperties(e,t){const i=this._parameters.definition.font,r=`${i.style} ${i.weight} ${t}px ${i.family}, sans-serif`;e.font=r,e.textAlign="left",e.textBaseline="top"}_ensureTextWidth(){if(Object(r["l"])(this._displayWidth))return this._displayWidth;const e=c(l,d,d).getContext("2d");this.setFontProperties(e,this._parameters.definition.size);let t=0,i=2*this._parameters.haloSize;this._lineWidths.length=0;const n=this._parameters.definition.font;("italic"===n.style||"oblique"===n.style||"string"==typeof n.weight&&("bold"===n.weight||"bolder"===n.weight)||"number"==typeof n.weight&&n.weight>600)&&(i+=.3*e.measureText("A").width);for(const r of this._lines){const n=Math.round(e.measureText(r).width+i);this._lineWidths.push(n),t=Math.max(t,n)}return this._displayWidth=t,this._displayWidth}computeLineHeight(){const e=1.275*this._parameters.definition.size;return Math.ceil(e+2*this._parameters.haloSize)+s}}function a(e,t){return"center"===e?.5*t:"right"===e?t:0}const s=1,o=[];{const e=16;for(let t=0;t<360;t+=360/e)o.push([Math.cos(Math.PI*t/180),Math.sin(Math.PI*t/180)])}function c(e,t,i){return e.canvas||(e.canvas=document.createElement("canvas")),e.canvas.width=t,e.canvas.height=i,e.canvas}const l={canvas:null},d=512},"04f0":function(e,t,i){"use strict";i.d(t,"a",(function(){return w})),i.d(t,"b",(function(){return O})),i.d(t,"c",(function(){return h})),i.d(t,"d",(function(){return y})),i.d(t,"e",(function(){return z})),i.d(t,"f",(function(){return x})),i.d(t,"g",(function(){return u})),i.d(t,"h",(function(){return V})),i.d(t,"i",(function(){return d}));var r=i("dae5"),n=i("b139"),a=i("0b2d"),s=i("4212"),o=i("e431"),c=i("7577");function l(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function d(e,t,i){i*=.5;const r=Math.sin(i);return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=Math.cos(i),e}function h(e,t){const i=2*Math.acos(t[3]),r=Math.sin(i/2);return r>s["a"]?(e[0]=t[0]/r,e[1]=t[1]/r,e[2]=t[2]/r):(e[0]=1,e[1]=0,e[2]=0),i}function u(e,t,i){const r=t[0],n=t[1],a=t[2],s=t[3],o=i[0],c=i[1],l=i[2],d=i[3];return e[0]=r*d+s*o+n*l-a*c,e[1]=n*d+s*c+a*o-r*l,e[2]=a*d+s*l+r*c-n*o,e[3]=s*d-r*o-n*c-a*l,e}function p(e,t,i){i*=.5;const r=t[0],n=t[1],a=t[2],s=t[3],o=Math.sin(i),c=Math.cos(i);return e[0]=r*c+s*o,e[1]=n*c+a*o,e[2]=a*c-n*o,e[3]=s*c-r*o,e}function f(e,t,i){i*=.5;const r=t[0],n=t[1],a=t[2],s=t[3],o=Math.sin(i),c=Math.cos(i);return e[0]=r*c-a*o,e[1]=n*c+s*o,e[2]=a*c+r*o,e[3]=s*c-n*o,e}function b(e,t,i){i*=.5;const r=t[0],n=t[1],a=t[2],s=t[3],o=Math.sin(i),c=Math.cos(i);return e[0]=r*c+n*o,e[1]=n*c-r*o,e[2]=a*c+s*o,e[3]=s*c-a*o,e}function m(e,t){const i=t[0],r=t[1],n=t[2];return e[0]=i,e[1]=r,e[2]=n,e[3]=Math.sqrt(Math.abs(1-i*i-r*r-n*n)),e}function g(e,t,i,r){const n=t[0],a=t[1],o=t[2],c=t[3];let l,d,h,u,p,f=i[0],b=i[1],m=i[2],g=i[3];return d=n*f+a*b+o*m+c*g,d<0&&(d=-d,f=-f,b=-b,m=-m,g=-g),1-d>s["a"]?(l=Math.acos(d),h=Math.sin(l),u=Math.sin((1-r)*l)/h,p=Math.sin(r*l)/h):(u=1-r,p=r),e[0]=u*n+p*f,e[1]=u*a+p*b,e[2]=u*o+p*m,e[3]=u*c+p*g,e}function v(e){const t=Object(s["b"])(),i=Object(s["b"])(),r=Object(s["b"])(),n=Math.sqrt(1-t),a=Math.sqrt(t);return e[0]=n*Math.sin(2*Math.PI*i),e[1]=n*Math.cos(2*Math.PI*i),e[2]=a*Math.sin(2*Math.PI*r),e[3]=a*Math.cos(2*Math.PI*r),e}function y(e,t){const i=t[0],r=t[1],n=t[2],a=t[3],s=i*i+r*r+n*n+a*a,o=s?1/s:0;return e[0]=-i*o,e[1]=-r*o,e[2]=-n*o,e[3]=a*o,e}function O(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function _(e,t){const i=t[0]+t[4]+t[8];let r;if(i>0)r=Math.sqrt(i+1),e[3]=.5*r,r=.5/r,e[0]=(t[5]-t[7])*r,e[1]=(t[6]-t[2])*r,e[2]=(t[1]-t[3])*r;else{let i=0;t[4]>t[0]&&(i=1),t[8]>t[3*i+i]&&(i=2);const n=(i+1)%3,a=(i+2)%3;r=Math.sqrt(t[3*i+i]-t[3*n+n]-t[3*a+a]+1),e[i]=.5*r,r=.5/r,e[3]=(t[3*n+a]-t[3*a+n])*r,e[n]=(t[3*n+i]+t[3*i+n])*r,e[a]=(t[3*a+i]+t[3*i+a])*r}return e}function x(e,t,i,r){const n=.5*Math.PI/180;t*=n,i*=n,r*=n;const a=Math.sin(t),s=Math.cos(t),o=Math.sin(i),c=Math.cos(i),l=Math.sin(r),d=Math.cos(r);return e[0]=a*c*d-s*o*l,e[1]=s*o*d+a*c*l,e[2]=s*c*l-a*o*d,e[3]=s*c*d+a*o*l,e}function j(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}const w=c["c"],S=c["l"],T=c["a"],C=u,P=c["b"],A=c["d"],M=c["j"],R=c["e"],E=R,D=c["f"],I=D,F=c["k"],z=c["g"],L=c["h"];function V(e,t,i){const r=Object(o["k"])(t,i);return r<-.999999?(Object(o["j"])(k,U,t),Object(o["B"])(k)<1e-6&&Object(o["j"])(k,B,t),Object(o["u"])(k,k),d(e,k,Math.PI),e):r>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(Object(o["j"])(k,t,i),e[0]=k[0],e[1]=k[1],e[2]=k[2],e[3]=1+r,F(e,e))}const k=Object(a["f"])(),U=Object(a["h"])(1,0,0),B=Object(a["h"])(0,1,0);function N(e,t,i,r,n,a){return g(G,t,n,a),g(q,i,r,a),g(e,G,q,2*a*(1-a)),e}const G=Object(n["b"])(),q=Object(n["b"])();function H(e,t,i,r){const n=W;return n[0]=i[0],n[3]=i[1],n[6]=i[2],n[1]=r[0],n[4]=r[1],n[7]=r[2],n[2]=-t[0],n[5]=-t[1],n[8]=-t[2],F(e,_(e,n))}const W=Object(r["b"])();Object.freeze({__proto__:null,identity:l,setAxisAngle:d,getAxisAngle:h,multiply:u,rotateX:p,rotateY:f,rotateZ:b,calculateW:m,slerp:g,random:v,invert:y,conjugate:O,fromMat3:_,fromEuler:x,str:j,copy:w,set:S,add:T,mul:C,scale:P,dot:A,lerp:M,length:R,len:E,squaredLength:D,sqrLen:I,normalize:F,exactEquals:z,equals:L,rotationTo:V,sqlerp:N,setAxes:H})},"0613":function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));const r=2.1},"087c":function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return s})),i.d(t,"c",(function(){return a}));var r=i("a21b"),n=i("1038");function a(e,t=n["d"]){return"number"==typeof e?t(e):Object(r["i"])(e)||Object(r["k"])(e)?new Uint32Array(e):e}function s(e){const t="number"==typeof e?e:e.length;if(t<3)return new Uint16Array(0);const i=t-2,r=i<=65536?new Uint16Array(3*i):new Uint32Array(3*i);if("number"==typeof e){let e=0;for(let t=0;t<i;t+=1)t%2==0?(r[e++]=t,r[e++]=t+1,r[e++]=t+2):(r[e++]=t+1,r[e++]=t,r[e++]=t+2)}else{let t=0;for(let n=0;n<i;n+=1)if(n%2==0){const i=e[n],a=e[n+1],s=e[n+2];r[t++]=i,r[t++]=a,r[t++]=s}else{const i=e[n+1],a=e[n],s=e[n+2];r[t++]=i,r[t++]=a,r[t++]=s}}return r}function o(e){const t="number"==typeof e?e:e.length;if(t<3)return new Uint16Array(0);const i=t-2,r=i<=65536?new Uint16Array(3*i):new Uint32Array(3*i);if("number"==typeof e){let e=0;for(let t=0;t<i;++t)r[e++]=0,r[e++]=t+1,r[e++]=t+2;return r}{const t=e[0];let n=e[1],a=0;for(let s=0;s<i;++s){const i=e[s+2];r[a++]=t,r[a++]=n,r[a++]=i,n=i}return r}}},"0bde":function(e,t,i){"use strict";i.d(t,"a",(function(){return u}));var r=i("b2b2"),n=i("ecd7"),a=i("8a44"),s=i("e431"),o=i("0b2d"),c=i("d359"),l=i("d18f"),d=i("f895"),h=i("1153");class u{constructor(e,t){this._objectToBoundingSphere=e,this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._root=new p,this._objectCount=0,t&&(void 0!==t.maximumObjectsPerNode&&(this._maximumObjectsPerNode=t.maximumObjectsPerNode),void 0!==t.maximumDepth&&(this._maximumDepth=t.maximumDepth))}get bounds(){return this._root.bounds}get halfSize(){return this._root.halfSize}get root(){return this._root.node}get maximumObjectsPerNode(){return this._maximumObjectsPerNode}get maximumDepth(){return this._maximumDepth}get objectCount(){return this._objectCount}destroy(){this._degenerateObjects.clear(),p.clearPool(),S[0]=null,R.prune(),L.prune()}add(e,t=e.length){this._objectCount+=t,this._grow(e,t);const i=p.acquire();for(let r=0;r<t;r++){const t=e[r];this._isDegenerate(t)?this._degenerateObjects.add(t):(i.init(this._root),this._add(t,i))}p.release(i)}remove(e,t=null){this._objectCount-=e.length;const i=p.acquire();for(const n of e){const e=Object(r["l"])(t)?t:Object(d["b"])(this._objectToBoundingSphere(n),E);_(e[3])?(i.init(this._root),this._remove(n,e,i)):this._degenerateObjects.delete(n)}p.release(i),this._shrink()}update(e,t){if(!_(t[3])&&this._isDegenerate(e))return;const i=T(e);this.remove(i,t),this.add(i)}forEachAlongRay(e,t,i){const r=Object(l["h"])(e,t);this._forEachNode(this._root,e=>{if(!this._intersectsNode(r,e))return!1;const t=e.node;return t.terminals.forAll(e=>{this._intersectsObject(r,e)&&i(e)}),null!==t.residents&&t.residents.forAll(e=>{this._intersectsObject(r,e)&&i(e)}),!0})}forEachAlongRayWithVerticalOffset(e,t,i,r){const n=Object(l["h"])(e,t);this._forEachNode(this._root,e=>{if(!this._intersectsNodeWithOffset(n,e,r))return!1;const t=e.node;return t.terminals.forAll(e=>{this._intersectsObjectWithOffset(n,e,r)&&i(e)}),null!==t.residents&&t.residents.forAll(e=>{this._intersectsObjectWithOffset(n,e,r)&&i(e)}),!0})}forEach(e){this._forEachNode(this._root,t=>{const i=t.node;return i.terminals.forAll(e),null!==i.residents&&i.residents.forAll(e),!0}),this._degenerateObjects.forEach(e)}forEachDegenerateObject(e){this._degenerateObjects.forEach(e)}findClosest(e,t,i,r=(()=>!0),n=1/0){let a=1/0,o=1/0,l=null;const h=y(e,t),u=s=>{if(--n,!r(s))return;const h=this._objectToBoundingSphere(s);if(!Object(c["k"])(i,h))return;const u=O(e,t,Object(d["g"])(h)),p=u-h[3],f=u+h[3];p<a&&(a=p,o=f,l=s)};return this._forEachNodeDepthOrdered(this._root,r=>{if(n<=0||!Object(c["k"])(i,r.bounds))return!1;if(Object(s["h"])(P,h,r.halfSize),Object(s["i"])(P,P,r.bounds),O(e,t,P)>o)return!1;const a=r.node;return a.terminals.forAll(e=>u(e)),null!==a.residents&&a.residents.forAll(e=>u(e)),!0},e,t),l}forEachInDepthRange(e,t,i,r,n,a,o){let l=-1/0,h=1/0;const u={setRange:e=>{1===i?(l=Math.max(l,e.near),h=Math.min(h,e.far)):(l=Math.max(l,-e.far),h=Math.min(h,-e.near))}};u.setRange(r);const p=O(t,i,e),f=y(t,i),b=y(t,-i),m=e=>{if(!o(e))return;const r=this._objectToBoundingSphere(e),s=Object(d["g"])(r),f=O(t,i,s)-p,b=f-r[3],m=f+r[3];b>h||m<l||!Object(c["k"])(a,r)||n(e,u)};this._forEachNodeDepthOrdered(this._root,e=>{if(!Object(c["k"])(a,e.bounds))return!1;if(Object(s["h"])(P,f,e.halfSize),Object(s["i"])(P,P,e.bounds),O(t,i,P)-p>h)return!1;if(Object(s["h"])(P,b,e.halfSize),Object(s["i"])(P,P,e.bounds),O(t,i,P)-p<l)return!1;const r=e.node;return r.terminals.forAll(e=>m(e)),null!==r.residents&&r.residents.forAll(e=>m(e)),!0},t,i)}forEachNode(e){this._forEachNode(this._root,t=>e(t.node,t.bounds,t.halfSize))}_intersectsNode(e,t){return m(t.bounds,2*-t.halfSize,A),m(t.bounds,2*t.halfSize,M),Object(h["j"])(e.origin,e.direction,A,M)}_intersectsNodeWithOffset(e,t,i){return m(t.bounds,2*-t.halfSize,A),m(t.bounds,2*t.halfSize,M),i.applyToMinMax(A,M),Object(h["j"])(e.origin,e.direction,A,M)}_intersectsObject(e,t){const i=this._objectToBoundingSphere(t);return!(i[3]>0)||Object(d["i"])(i,e)}_intersectsObjectWithOffset(e,t,i){const r=this._objectToBoundingSphere(t);return!(r[3]>0)||Object(d["i"])(i.applyToBoundingSphere(r),e)}_forEachNode(e,t){let i=p.acquire().init(e);const r=[i];for(;0!==r.length;){if(i=r.pop(),t(i)&&!i.isLeaf())for(let e=0;e<i.node.children.length;e++)i.node.children[e]&&r.push(p.acquire().init(i).advance(e));p.release(i)}}_forEachNodeDepthOrdered(e,t,i,r=1){let n=p.acquire().init(e);const a=[n];for(v(i,r,V);0!==a.length;){if(n=a.pop(),t(n)&&!n.isLeaf())for(let e=7;e>=0;--e){const t=V[e];n.node.children[t]&&a.push(p.acquire().init(n).advance(t))}p.release(n)}}_remove(e,t,i){R.clear();const r=i.advanceTo(t,(e,t)=>{R.push(e.node),R.push(t)})?i.node.terminals:i.node.residents;if(r.removeUnordered(e),0===r.length)for(let n=R.length-2;n>=0;n-=2){const e=R.data[n],t=R.data[n+1];if(!this._purge(e,t))break}}_nodeIsEmpty(e){if(0!==e.terminals.length)return!1;if(null!==e.residents)return 0===e.residents.length;for(let t=0;t<e.children.length;t++)if(e.children[t])return!1;return!0}_purge(e,t){return t>=0&&(e.children[t]=null),!!this._nodeIsEmpty(e)&&(null===e.residents&&(e.residents=new a["a"]({shrink:!0})),!0)}_add(e,t){t.advanceTo(this._objectToBoundingSphere(e))?t.node.terminals.push(e):(t.node.residents.push(e),t.node.residents.length>this._maximumObjectsPerNode&&t.depth<this._maximumDepth&&this._split(t))}_split(e){const t=e.node.residents;e.node.residents=null;for(let i=0;i<t.length;i++){const r=p.acquire().init(e);this._add(t.getItemAt(i),r),p.release(r)}}_grow(e,t){if(0!==t&&(g(e,t,e=>this._objectToBoundingSphere(e),D),_(D[3])&&!this._fitsInsideTree(D)))if(this._nodeIsEmpty(this._root.node))Object(d["b"])(D,this._root.bounds),this._root.halfSize=1.25*D[3];else{const e=this._rootBoundsForRootAsSubNode(D);this._placingRootViolatesMaxDepth(e)?this._rebuildTree(D,e):this._growRootAsSubNode(e),p.release(e)}}_rebuildTree(e,t){Object(s["n"])(I,t.bounds),I[3]=t.halfSize,g([e,I],2,e=>e,F);const i=p.acquire().init(this._root);this._root.initFrom(null,F,1.25*F[3]),this._forEachNode(i,e=>(this.add(e.node.terminals.data,e.node.terminals.length),null!==e.node.residents&&this.add(e.node.residents.data,e.node.residents.length),!0)),p.release(i)}_placingRootViolatesMaxDepth(e){const t=Math.log(e.halfSize/this._root.halfSize)*Math.LOG2E;let i=0;return this._forEachNode(this._root,e=>(i=Math.max(i,e.depth),i+t<=this._maximumDepth)),i+t>this._maximumDepth}_rootBoundsForRootAsSubNode(e){const t=e[3],i=e;let r=-1/0;const n=this._root.bounds,a=this._root.halfSize;for(let s=0;s<3;s++){const e=n[s]-a-(i[s]-t),o=i[s]+t-(n[s]+a),c=Math.max(0,Math.ceil(e/(2*a))),l=Math.max(0,Math.ceil(o/(2*a)))+1,d=2**Math.ceil(Math.log(c+l)*Math.LOG2E);r=Math.max(r,d),z[s].min=c,z[s].max=l}for(let s=0;s<3;s++){let e=z[s].min,t=z[s].max;const i=(r-(e+t))/2;e+=Math.ceil(i),t+=Math.floor(i);const o=n[s]-a-e*a*2;C[s]=o+(t+e)*a}return C[3]=r*a*w,p.acquire().initFrom(null,C,r*a,0)}_growRootAsSubNode(e){const t=this._root.node;Object(s["n"])(D,this._root.bounds),D[3]=this._root.halfSize,this._root.init(e),e.advanceTo(D,null,!0),e.node.children=t.children,e.node.residents=t.residents,e.node.terminals=t.terminals}_shrink(){for(;;){const e=this._findShrinkIndex();if(-1===e)break;this._root.advance(e),this._root.depth=0}}_findShrinkIndex(){if(0!==this._root.node.terminals.length||this._root.isLeaf())return-1;let e=null;const t=this._root.node.children;let i=0,r=0;for(;r<t.length&&null==e;)i=r++,e=t[i];for(;r<t.length;)if(t[r++])return-1;return i}_isDegenerate(e){return!_(this._objectToBoundingSphere(e)[3])}_fitsInsideTree(e){const t=this._root.bounds,i=this._root.halfSize;return e[3]<=i&&e[0]>=t[0]-i&&e[0]<=t[0]+i&&e[1]>=t[1]-i&&e[1]<=t[1]+i&&e[2]>=t[2]-i&&e[2]<=t[2]+i}}class p{constructor(){this.bounds=Object(d["c"])(),this.halfSize=0,this.initFrom(null,null,0,0)}init(e){return this.initFrom(e.node,e.bounds,e.halfSize,e.depth)}initFrom(e,t,i,n=this.depth){return this.node=Object(r["l"])(e)?e:p.createEmptyNode(),Object(r["l"])(t)&&Object(d["b"])(t,this.bounds),this.halfSize=i,this.depth=n,this}advance(e){let t=this.node.children[e];t||(t=p.createEmptyNode(),this.node.children[e]=t),this.node=t,this.halfSize/=2,this.depth++;const i=x[e];return this.bounds[0]+=i[0]*this.halfSize,this.bounds[1]+=i[1]*this.halfSize,this.bounds[2]+=i[2]*this.halfSize,this.bounds[3]=this.halfSize*w,this}advanceTo(e,t,i=!1){for(;;){if(this.isTerminalFor(e))return t&&t(this,-1),!0;if(this.isLeaf()){if(!i)return t&&t(this,-1),!1;this.node.residents=null}const r=this._childIndex(e);t&&t(this,r),this.advance(r)}}isLeaf(){return null!=this.node.residents}isTerminalFor(e){return e[3]>this.halfSize/2}_childIndex(e){const t=this.bounds;return(t[0]<e[0]?1:0)+(t[1]<e[1]?2:0)+(t[2]<e[2]?4:0)}static createEmptyNode(){return{children:[null,null,null,null,null,null,null,null],terminals:new a["a"]({shrink:!0}),residents:new a["a"]({shrink:!0})}}static acquire(){return p._pool.acquire()}static release(e){p._pool.release(e)}static clearPool(){p._pool.prune()}}function f(e,t){e[0]=Math.min(e[0],t[0]-t[3]),e[1]=Math.min(e[1],t[1]-t[3]),e[2]=Math.min(e[2],t[2]-t[3])}function b(e,t){e[0]=Math.max(e[0],t[0]+t[3]),e[1]=Math.max(e[1],t[1]+t[3]),e[2]=Math.max(e[2],t[2]+t[3])}function m(e,t,i){i[0]=e[0]+t,i[1]=e[1]+t,i[2]=e[2]+t}function g(e,t,i,r){if(1===t){const t=i(e[0]);Object(d["b"])(t,r)}else{A[0]=1/0,A[1]=1/0,A[2]=1/0,M[0]=-1/0,M[1]=-1/0,M[2]=-1/0;for(let r=0;r<t;r++){const t=i(e[r]);_(t[3])&&(f(A,t),b(M,t))}Object(s["l"])(r,A,M,.5),r[3]=Math.max(M[0]-A[0],M[1]-A[1],M[2]-A[2])/2}}function v(e,t,i){if(!L.length)for(let r=0;r<8;++r)L.push({index:0,distance:0});for(let r=0;r<8;++r){const i=x[r];L.data[r].index=r,L.data[r].distance=O(e,t,i)}L.sort((e,t)=>e.distance-t.distance);for(let r=0;r<8;++r)i[r]=L.data[r].index}function y(e,t){let i=1/0,r=null;for(let n=0;n<8;++n){const a=O(e,t,j[n]);a<i&&(i=a,r=j[n])}return r}function O(e,t,i){return t*(e[0]*i[0]+e[1]*i[1]+e[2]*i[2])}function _(e){return!isNaN(e)&&e!==-1/0&&e!==1/0&&e>0}p._pool=new n["a"](p);const x=[Object(o["h"])(-1,-1,-1),Object(o["h"])(1,-1,-1),Object(o["h"])(-1,1,-1),Object(o["h"])(1,1,-1),Object(o["h"])(-1,-1,1),Object(o["h"])(1,-1,1),Object(o["h"])(-1,1,1),Object(o["h"])(1,1,1)],j=[Object(o["h"])(-1,-1,-1),Object(o["h"])(-1,-1,1),Object(o["h"])(-1,1,-1),Object(o["h"])(-1,1,1),Object(o["h"])(1,-1,-1),Object(o["h"])(1,-1,1),Object(o["h"])(1,1,-1),Object(o["h"])(1,1,1)],w=Math.sqrt(3),S=[null];function T(e){return S[0]=e,S}const C=Object(d["c"])(),P=Object(o["f"])(),A=Object(o["f"])(),M=Object(o["f"])(),R=new a["a"],E=Object(d["c"])(),D=Object(d["c"])(),I=Object(d["c"])(),F=Object(d["c"])(),z=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],L=new a["a"],V=[0,0,0,0,0,0,0,0]},"0c9d":function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return h})),i.d(t,"c",(function(){return l})),i.d(t,"d",(function(){return d})),i.d(t,"e",(function(){return s})),i.d(t,"f",(function(){return o}));var r=i("2ebb"),n=i("fc00");const a=Object(n["a"])().vec3f("position").u16("componentIndex").u16("u16padding"),s=Object(n["a"])().vec2u8("sideness"),o=Object(r["a"])(s),c=Object(n["a"])().vec3f("position0").vec3f("position1").u16("componentIndex").u8("variantOffset",{glNormalized:!0}).u8("variantStroke").u8("variantExtension",{glNormalized:!0}).u8("u8padding",{glPadding:!0}).u16("u16padding",{glPadding:!0}),l=c.clone().vec3f("normal"),d=c.clone().vec3f("normalA").vec3f("normalB"),h=new Map([["position0",0],["position1",1],["componentIndex",2],["variantOffset",3],["variantStroke",4],["variantExtension",5],["normal",6],["normalA",6],["normalB",7],["sideness",8]])},"0ca1":function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));class r{constructor(e){this.gain=e}update(e){if(this.hasLastValue){const t=this.computeDelta(e);this.updateDelta(t)}this.lastValue=e}reset(){this.lastValue=void 0,this.filteredDelta=void 0}get hasLastValue(){return void 0!==this.lastValue}get hasFilteredDelta(){return void 0!==this.filteredDelta}computeDelta(e){return e-this.lastValue}updateDelta(e){this.hasFilteredDelta?this.filteredDelta=(1-this.gain)*this.filteredDelta+this.gain*e:this.filteredDelta=e}}},"0cb9":function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return o})),i.d(t,"c",(function(){return s}));var r=i("b2b2"),n=i("84f4");class a{constructor(e,t=null,i=0){this.array=e,this.spatialReference=t,this.offset=i}}function s(e){return"array"in e}function o(e,t,i="ground"){if(Object(n["a"])(t))return e.getElevation(t.x,t.y,t.z||0,t.spatialReference,i);if(s(t)){let n=t.offset;return e.getElevation(t.array[n++],t.array[n++],t.array[n]||0,Object(r["v"])(t.spatialReference,e.spatialReference),i)}return e.getElevation(t[0],t[1],t[2]||0,e.spatialReference,i)}},"0d7a":function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i("7cb4"),n=i("3886");function a(e,t){const i=e.fragment;t.vertexTangents?(e.attributes.add("tangent","vec4"),e.varyings.add("vTangent","vec4"),2===t.doubleSidedMode?i.code.add(n["a"]`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;
vec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`):i.code.add(n["a"]`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = vTangent.w;
vec3 tangent = normalize(vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`)):(e.extensions.add("GL_OES_standard_derivatives"),i.code.add(n["a"]`mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {
vec3 Q1 = dFdx(pos);
vec3 Q2 = dFdy(pos);
vec2 stx = dFdx(st);
vec2 sty = dFdy(st);
float det = stx.t * sty.s - sty.t * stx.s;
vec3 T = stx.t * Q2 - sty.t * Q1;
T = T - normal * dot(normal, T);
T *= inversesqrt(max(dot(T,T), 1.e-10));
vec3 B = sign(det) * cross(normal, T);
return mat3(T, B, normal);
}`)),0!==t.attributeTextureCoordinates&&(e.include(r["a"],t),i.uniforms.add("normalTexture","sampler2D"),i.uniforms.add("normalTextureSize","vec2"),i.code.add(n["a"]`
    vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {
      vtc.uv = uv;
      ${t.supportsTextureAtlas?"vtc.size = normalTextureSize;":""}
      vec3 rawNormal = textureLookup(normalTexture, vtc).rgb * 2.0 - 1.0;
      return tangentSpace * rawNormal;
    }
  `))}},"0d96":function(e,t,i){"use strict";i.d(t,"a",(function(){return j})),i.d(t,"b",(function(){return v})),i.d(t,"c",(function(){return y})),i.d(t,"d",(function(){return O}));var r=i("3349"),n=i("02f1"),a=i("0fc4"),s=i("d272"),o=i("7c1d"),c=i("d0cb"),l=i("7079"),d=i("6a07"),h=i("be24"),u=i("ebd5"),p=i("4377"),f=i("501b"),b=i("2f98"),m=i("3886"),g=i("690a");function v(e){const t=new g["a"],i=e.signedDistanceFieldEnabled;if(t.include(o["a"]),t.include(c["a"],e),t.include(s["a"],e),6===e.output)return t.include(l["a"],e),t;t.include(b["a"]),t.fragment.include(f["a"]),t.fragment.include(p["a"]),t.include(h["a"],e),t.varyings.add("vcolor","vec4"),t.varyings.add("vtc","vec2"),t.varyings.add("vsize","vec2"),e.binaryHighlightOcclusionEnabled&&t.varyings.add("voccluded","float"),t.vertex.uniforms.add("screenOffset","vec2").add("anchorPos","vec2").add("textureCoordinateScaleFactor","vec2").add("materialColor","vec4"),i&&t.vertex.uniforms.add("outlineColor","vec4"),e.screenSizePerspectiveEnabled&&t.vertex.uniforms.add("screenSizePerspective","vec4"),(e.debugDrawBorder||e.binaryHighlightOcclusionEnabled)&&t.varyings.add("debugBorderCoords","vec4"),t.attributes.add("uv0","vec2"),t.attributes.add("color","vec4"),t.attributes.add("size","vec2"),t.attributes.add("auxpos2","vec4"),t.vertex.code.add(m["a"]`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }
      vec2 inputSize;
      ${e.screenSizePerspectiveEnabled?m["a"]`
      inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
      vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
         `:m["a"]`
      inputSize = size;
      vec2 screenOffsetScaled = screenOffset;`}

      ${e.vvSize?"inputSize *= vvScale(auxpos2).xx;":""}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);

      ${e.occlusionTestEnabled||e.binaryHighlightOcclusionEnabled?"bool visible = testVisibilityHUD(posProj);":""}

      ${e.binaryHighlightOcclusionEnabled?"voccluded = visible ? 0.0 : 1.0;":""}
    `);const r=m["a"]`vec2 uv01 = floor(uv0);
vec2 uv = uv0 - uv01;
quadOffset.xy = ((uv01 - anchorPos) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;`,n=e.pixelSnappingEnabled?i?m["a"]`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:m["a"]`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:m["a"]`posProj += quadOffset;`;t.vertex.code.add(m["a"]`
      ${e.occlusionTestEnabled?"if (visible) {":""}
      ${r}
      ${e.vvColor?"vcolor = vvGetColor(auxpos2, vvColorValues, vvColorColors) * materialColor;":"vcolor = color / 255.0 * materialColor;"}

      bool alphaDiscard = vcolor.a < ${m["a"].float(u["c"])};
      ${i?`alphaDiscard = alphaDiscard && outlineColor.a < ${m["a"].float(u["c"])};`:""}
      if (alphaDiscard) {
        // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      } else {
        ${n}
        gl_Position = posProj;
      }

      vtc = uv * textureCoordinateScaleFactor;

      ${e.debugDrawBorder?"debugBorderCoords = vec4(uv01, 1.5 / combinedSize);":""}
      vsize = inputSize;
      ${e.occlusionTestEnabled?m["a"]`} else { vtc = vec2(0.0);
        ${e.debugDrawBorder?"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"}`:""}
    }
    `),t.fragment.uniforms.add("tex","sampler2D"),i&&(t.fragment.uniforms.add("outlineColor","vec4"),t.fragment.uniforms.add("outlineSize","float"));const a=e.debugDrawBorder?m["a"]`(isBorder > 0.0 ? 0.0 : ${m["a"].float(u["b"])})`:m["a"].float(u["b"]),v=m["a"]`
    ${e.debugDrawBorder?m["a"]`
      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`:""}

    ${i?m["a"]`
      vec4 fillPixelColor = vcolor;

      // Attempt to sample texel centers to avoid that thin cross outlines
      // disappear with large symbol sizes.
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041
      const float txSize = 128.0;
      const float texelSize = 1.0 / txSize;
      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture2D(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${a} ||
          fillPixelColor.a + outlinePixelColor.a < ${m["a"].float(u["c"])}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        gl_FragColor = vec4(compositeColor, compositeAlpha);
      } else {
        if (fillAlphaFactor < ${a}) {
          discard;
        }

        gl_FragColor = premultiplyAlpha(fillPixelColor);
      }

      // visualize SDF:
      // gl_FragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:m["a"]`
          vec4 texColor = texture2D(tex, vtc, -0.5);
          if (texColor.a < ${a}) {
            discard;
          }
          gl_FragColor = texColor * premultiplyAlpha(vcolor);
          `}

    ${e.debugDrawBorder?m["a"]`gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder);`:""}
  `;return 7===e.output&&t.fragment.code.add(m["a"]`
      void main() {
        ${v}
        gl_FragColor = vec4(gl_FragColor.a);
      }
      `),0===e.output&&t.fragment.code.add(m["a"]`
    void main() {
      ${v}
      ${e.FrontFacePass?"gl_FragColor.rgb /= gl_FragColor.a;":""}
    }
    `),4===e.output&&(t.include(d["a"]),t.fragment.code.add(m["a"]`
    void main() {
      ${v}
      ${e.binaryHighlightOcclusionEnabled?m["a"]`
          if (voccluded == 1.0) {
            gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);
          } else {
            gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);
          }`:"outputHighlight();"}
    }
    `)),t}function y(e,t,i){e.setUniform4fv("materialColor",t.color),t.textureIsSignedDistanceField&&(t.outlineColor[3]<=0||t.outlineSize<=0?(e.setUniform4fv("outlineColor",a["b"]),e.setUniform1f("outlineSize",0)):(e.setUniform4fv("outlineColor",t.outlineColor),e.setUniform1f("outlineSize",t.outlineSize))),e.setUniform2f("screenOffset",2*t.screenOffset[0]*i,2*t.screenOffset[1]*i),e.setUniform2fv("anchorPos",O(t))}function O(e,t=x){return e.textureIsSignedDistanceField?_(e.anchorPos,e.distanceFieldBoundingBox,t):Object(r["c"])(t,e.anchorPos),t}function _(e,t,i){i[0]=e[0]*(t[2]-t[0])+t[0],i[1]=e[1]*(t[3]-t[1])+t[1]}const x=Object(n["b"])(),j=Object.freeze({__proto__:null,build:v,bindHUDMaterialUniforms:y,calculateAnchorPosForRendering:O})},"0d9f":function(e,t,i){"use strict";i.d(t,"a",(function(){return m})),i.d(t,"b",(function(){return y})),i.d(t,"c",(function(){return re})),i.d(t,"d",(function(){return g})),i.d(t,"e",(function(){return O})),i.d(t,"f",(function(){return F})),i.d(t,"g",(function(){return _})),i.d(t,"h",(function(){return D})),i.d(t,"i",(function(){return S})),i.d(t,"j",(function(){return T})),i.d(t,"k",(function(){return N})),i.d(t,"l",(function(){return B})),i.d(t,"m",(function(){return U})),i.d(t,"n",(function(){return x}));i("c120");var r=i("e92d"),n=i("38a4"),a=i("2119"),s=i("d791"),o=i("afe1"),c=i("e431"),l=i("0b2d"),d=i("bd7e"),h=i("7289"),u=i("d18f"),p=i("a1b1"),f=i("7361");const b=r["a"].getLogger("esri.views.3d.support.geometryUtils.boundedPlane");class m{constructor(){this.plane=Object(h["d"])(),this.origin=Object(l["f"])(),this.basis1=Object(l["f"])(),this.basis2=Object(l["f"])()}}function g(e=Q){return{plane:Object(h["d"])(e.plane),origin:Object(l["d"])(e.origin),basis1:Object(l["d"])(e.basis1),basis2:Object(l["d"])(e.basis2)}}function v(e,t,i){const r=J.get();return r.origin=e,r.basis1=t,r.basis2=i,r.plane=Object(h["w"])(0,0,0,0),x(r),r}function y(e,t=g()){return _(e.origin,e.basis1,e.basis2,t)}function O(e,t){Object(c["n"])(t.origin,e.origin),Object(c["n"])(t.basis1,e.basis1),Object(c["n"])(t.basis2,e.basis2),Object(h["c"])(e.plane,t.plane)}function _(e,t,i,r=g()){return Object(c["n"])(r.origin,e),Object(c["n"])(r.basis1,t),Object(c["n"])(r.basis2,i),x(r),$(r,"fromValues()"),r}function x(e){Object(h["j"])(e.basis2,e.basis1,e.origin,e.plane)}function j(e,t,i){e!==i&&y(e,i);const r=Object(c["h"])(f["d"].get(),N(e),t);return Object(c["i"])(i.origin,i.origin,r),i.plane[3]-=t,i}function w(e,t,i){return S(t,i),j(i,L(e,e.origin),i),i}function S(e,t=g()){const i=(e[2]-e[0])/2,r=(e[3]-e[1])/2;return Object(c["z"])(t.origin,e[0]+i,e[1]+r,0),Object(c["z"])(t.basis1,i,0,0),Object(c["z"])(t.basis2,0,r,0),Object(h["i"])(0,0,1,0,t.plane),t}function T(e,t,i){return!!Object(h["n"])(e.plane,t,i)&&q(e,i)}function C(e,t,i){if(T(e,t,i))return i;const r=P(e,t,f["d"].get());return Object(c["i"])(i,t.origin,Object(c["h"])(f["d"].get(),t.direction,Object(c["p"])(t.origin,r)/Object(c["s"])(t.direction))),i}function P(e,t,i){const r=X.get();Z(e,t,r,X.get());let a=Number.POSITIVE_INFINITY;for(const s of ee){const o=W(e,s,Y.get()),l=f["d"].get();if(Object(h["l"])(r,o,l)){const e=Object(c["y"])(f["d"].get(),t.origin,l),r=Math.abs(Object(n["b"])(Object(c["k"])(t.direction,e)));r<a&&(a=r,Object(c["n"])(i,l))}}return a===Number.POSITIVE_INFINITY?A(e,t,i):i}function A(e,t,i){if(T(e,t,i))return i;const r=X.get(),n=X.get();Z(e,t,r,n);let a=Number.POSITIVE_INFINITY;for(const s of ee){const o=W(e,s,Y.get()),l=f["d"].get();if(Object(h["m"])(r,o,l)){const e=Object(u["d"])(t,l);if(!Object(h["p"])(n,l))continue;e<a&&(a=e,Object(c["n"])(i,l))}}return E(e,t.origin)<a&&M(e,t.origin,i),i}function M(e,t,i){const r=Object(h["s"])(e.plane,t,f["d"].get()),n=Object(d["i"])(H(e,e.basis1),r,-1,1,f["d"].get()),a=Object(d["i"])(H(e,e.basis2),r,-1,1,f["d"].get());return Object(c["m"])(i,Object(c["i"])(f["d"].get(),n,a),e.origin),i}function R(e,t,i){const{origin:r,basis1:n,basis2:a}=e,s=Object(c["m"])(f["d"].get(),t,r),o=Object(p["d"])(n,s),l=Object(p["d"])(a,s),d=Object(p["d"])(N(e),s);return Object(c["z"])(i,o,l,d)}function E(e,t){const i=R(e,t,f["d"].get()),{basis1:r,basis2:n}=e,a=Object(c["s"])(r),s=Object(c["s"])(n),o=Math.max(Math.abs(i[0])-a,0),l=Math.max(Math.abs(i[1])-s,0),d=i[2];return o*o+l*l+d*d}function D(e,t){return Math.sqrt(E(e,t))}function I(e,t){let i=Number.NEGATIVE_INFINITY;for(const r of ee){const n=W(e,r,Y.get()),a=Object(d["e"])(n,t);a>i&&(i=a)}return Math.sqrt(i)}function F(e,t){return Object(h["p"])(e.plane,t)&&q(e,t)}function z(e,t,i,r){return G(e,i,r)}function L(e,t){const i=-e.plane[3];return Object(p["d"])(N(e),t)-i}function V(e,t,i,r){const n=L(e,t),a=Object(c["h"])(K,N(e),i-n);return Object(c["i"])(r,t,a),r}function k(e,t){return Object(c["r"])(e.basis1,t.basis1)&&Object(c["r"])(e.basis2,t.basis2)&&Object(c["r"])(e.origin,t.origin)}function U(e,t,i){return e!==i&&y(e,i),Object(s["c"])(te,t),Object(s["u"])(te,te),Object(c["t"])(i.basis1,e.basis1,te),Object(c["t"])(i.basis2,e.basis2,te),Object(c["t"])(Object(h["r"])(i.plane),Object(h["r"])(e.plane),te),Object(c["t"])(i.origin,e.origin,t),Object(h["u"])(i.plane,i.origin,i.plane),i}function B(e,t,i,r){return e!==r&&y(e,r),Object(s["f"])(ie,Object(s["j"])(ie),t,i),Object(c["t"])(r.basis1,e.basis1,ie),Object(c["t"])(r.basis2,e.basis2,ie),x(r),r}function N(e){return Object(h["r"])(e.plane)}function G(e,t,i){switch(t){case 0:Object(c["n"])(i,e.basis1),Object(c["u"])(i,i);break;case 1:Object(c["n"])(i,e.basis2),Object(c["u"])(i,i);break;case 2:Object(c["n"])(i,N(e))}return i}function q(e,t){const i=Object(c["m"])(f["d"].get(),t,e.origin),r=Object(c["w"])(e.basis1),n=Object(c["w"])(e.basis2),a=Object(c["k"])(e.basis1,i),s=Object(c["k"])(e.basis2,i);return-a-r<0&&a-r<0&&-s-n<0&&s-n<0}function H(e,t){const i=Y.get();return Object(c["n"])(i.origin,e.origin),Object(c["n"])(i.vector,t),i}function W(e,t,i){const{basis1:r,basis2:n,origin:a}=e,s=Object(c["h"])(f["d"].get(),r,t.origin[0]),o=Object(c["h"])(f["d"].get(),n,t.origin[1]);Object(c["i"])(i.origin,s,o),Object(c["i"])(i.origin,i.origin,a);const l=Object(c["h"])(f["d"].get(),r,t.direction[0]),d=Object(c["h"])(f["d"].get(),n,t.direction[1]);return Object(c["h"])(i.vector,Object(c["i"])(l,l,d),2),i}function $(e,t){Math.abs(Object(c["k"])(e.basis1,e.basis2)/(Object(c["s"])(e.basis1)*Object(c["s"])(e.basis2)))>1e-6&&b.warn(t,"Provided basis vectors are not perpendicular"),Math.abs(Object(c["k"])(e.basis1,N(e)))>1e-6&&b.warn(t,"Basis vectors and plane normal are not perpendicular"),Math.abs(-Object(c["k"])(N(e),e.origin)-e.plane[3])>1e-6&&b.warn(t,"Plane offset is not consistent with plane origin")}function Z(e,t,i,r){const n=N(e);Object(h["j"])(n,t.direction,t.origin,i),Object(h["j"])(Object(h["r"])(i),n,t.origin,r)}const Q={plane:Object(h["d"])(),origin:Object(l["h"])(0,0,0),basis1:Object(l["h"])(1,0,0),basis2:Object(l["h"])(0,1,0)},X=new a["a"](h["d"]),Y=new a["a"](d["d"]),K=Object(l["f"])(),J=new a["a"](()=>({origin:null,basis1:null,basis2:null,plane:null})),ee=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],te=Object(o["d"])(),ie=Object(o["d"])(),re=Object.freeze({__proto__:null,BoundedPlaneClass:m,create:g,wrap:v,copy:y,copyWithoutVerify:O,fromValues:_,updateUnboundedPlane:x,elevate:j,setExtent:w,fromAABoundingRect:S,intersectRay:T,intersectRayClosestSilhouette:C,closestPointOnSilhouette:P,closestPoint:A,projectPoint:M,projectPointLocal:R,distance2:E,distance:D,distanceToSilhouette:I,extrusionContainsPoint:F,axisAt:z,altitudeAt:L,setAltitudeAt:V,equals:k,transform:U,rotate:B,normal:N,UP:Q})},"0e88":function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var r=i("b2b2"),n=i("f9d0");class a{constructor(e){this.technique=e,this.refCount=0,this.refZeroFrame=0}}class s{constructor(e){this._context=e,this._perConstructorInstances=new n["a"],this._frameCounter=0,this._keepAliveFrameCount=o}get viewingMode(){return this._context.viewingMode}get constructionContext(){return this._context}dispose(){this._perConstructorInstances.forEach(e=>e.forEach(e=>e.technique.dispose())),this._perConstructorInstances.clear()}acquire(e,t){const i=t.key;let n=this._perConstructorInstances.get(e,i);if(Object(r["k"])(n)){const r=new e(this._context,t,()=>this.release(r));n=new a(r),this._perConstructorInstances.set(e,i,n)}return++n.refCount,n.technique}releaseAndAcquire(e,t,i){if(Object(r["l"])(i)){if(t.key===i.key)return i;i.release()}return this.acquire(e,t)}release(e){if(Object(r["k"])(e)||this._perConstructorInstances.empty)return;const t=this._perConstructorInstances.get(e.constructor,e.key);Object(r["k"])(t)||(--t.refCount,0===t.refCount&&(t.refZeroFrame=this._frameCounter))}frameUpdate(){this._frameCounter++,this._keepAliveFrameCount!==o&&this._perConstructorInstances.forEach((e,t)=>{e.forEach((e,i)=>{0===e.refCount&&e.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(e.technique.dispose(),this._perConstructorInstances.delete(t,i))})})}async reloadAll(){const e=new Array;this._perConstructorInstances.forEach((t,i)=>{const r=async(e,t)=>{const i=t.shader;i&&(await i.reload(),e.forEach(e=>{e.technique.reload(this._context)}))};e.push(r(t,i))}),await Promise.all(e)}}const o=-1},"0eb9":function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var r=i("b2b2"),n=i("8076"),a=i("e9d6");class s{constructor(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(e){this._unit=e,this._metersPerElevationInfoUnit=Object(n["a"])(e)}reset(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}set offsetMeters(e){this._meterUnitOffset=e,this._renderUnitOffset=0}set offsetElevationInfoUnits(e){this._meterUnitOffset=e*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}addOffsetRenderUnits(e){this._renderUnitOffset+=e}geometryZWithOffset(e,t){const i=this.calculateOffsetRenderUnits(t);return null!=this.featureExpressionInfoContext?i:e+i}calculateOffsetRenderUnits(e){let t=this._meterUnitOffset;const i=this.featureExpressionInfoContext;return null!=i&&(t+=Object(a["e"])(i)*this._metersPerElevationInfoUnit),t/e.unitInMeters+this._renderUnitOffset}setFromElevationInfo(e){this.mode=e.mode,this.unit=Object(n["c"])(e.unit)?e.unit:"meters",this.offsetElevationInfoUnits=Object(r["v"])(e.offset,0)}updateFeatureExpressionInfoContext(e,t,i){if(Object(r["k"])(e))return void(this._featureExpressionInfoContext=null);const n=e&&e.arcade;n&&Object(r["l"])(t)&&Object(r["l"])(i)?(this._featureExpressionInfoContext=Object(a["a"])(e),Object(a["g"])(this._featureExpressionInfoContext,Object(a["d"])(n.modules,t,i))):this._featureExpressionInfoContext=e}static fromElevationInfo(e){const t=new s;return Object(r["l"])(e)&&t.setFromElevationInfo(e),t}}},"0fc4":function(e,t,i){"use strict";function r(){return[0,0,0,0]}function n(e){return[e[0],e[1],e[2],e[3]]}function a(e,t,i,r){return[e,t,i,r]}function s(e){const t=r(),i=Math.min(4,e.length);for(let r=0;r<i;++r)t[r]=e[r];return t}function o(e,t){return new Float64Array(e,t,4)}function c(){return r()}function l(){return a(1,1,1,1)}function d(){return a(1,0,0,0)}function h(){return a(0,1,0,0)}function u(){return a(0,0,1,0)}function p(){return a(0,0,0,1)}i.d(t,"a",(function(){return b})),i.d(t,"b",(function(){return f})),i.d(t,"c",(function(){return o})),i.d(t,"d",(function(){return n})),i.d(t,"e",(function(){return r})),i.d(t,"f",(function(){return s})),i.d(t,"g",(function(){return a}));const f=c(),b=l(),m=d(),g=h(),v=u(),y=p();Object.freeze({__proto__:null,create:r,clone:n,fromValues:a,fromArray:s,createView:o,zeros:c,ones:l,unitX:d,unitY:h,unitZ:u,unitW:p,ZEROS:f,ONES:b,UNIT_X:m,UNIT_Y:g,UNIT_Z:v,UNIT_W:y})},1038:function(e,t,i){"use strict";i.d(t,"a",(function(){return p})),i.d(t,"b",(function(){return u})),i.d(t,"c",(function(){return h})),i.d(t,"d",(function(){return l})),i.d(t,"e",(function(){return d}));var r=i("e431"),n=i("0b2d"),a=i("579f");let s=(()=>{const e=new Uint32Array(131072);for(let t=0;t<e.length;++t)e[t]=t;return e})();const o=new Uint16Array([0]),c=(()=>{const e=new Uint16Array(65536);for(let t=0;t<e.length;++t)e[t]=t;return e})();function l(e){if(1===e)return o;if(e<c.length)return new Uint16Array(c.buffer,0,e);if(e>s.length){const t=Math.max(2*s.length,e);s=new Uint32Array(t);for(let e=0;e<s.length;e++)s[e]=e}return new Uint32Array(s.buffer,0,e)}function d(e){if(1===e)return new Uint16Array(o);if(e<c.length)return new Uint16Array(c.slice(0,e));if(e>s.length){const t=new Uint32Array(e);for(let e=0;e<t.length;e++)t[e]=e;return t}return new Uint32Array(s.slice(0,e))}function h(e,t,i){if(!e)return!1;const{size:n,data:s}=e;Object(r["z"])(i,0,0,0),Object(r["z"])(g,0,0,0);let o=0,c=0;for(let l=0;l<t.length-2;l+=3){const e=t[l+0]*n,d=t[l+1]*n,h=t[l+2]*n;Object(r["z"])(f,s[e+0],s[e+1],s[e+2]),Object(r["z"])(b,s[d+0],s[d+1],s[d+2]),Object(r["z"])(m,s[h+0],s[h+1],s[h+2]);const u=Object(a["b"])(f,b,m);u?(Object(r["i"])(f,f,b),Object(r["i"])(f,f,m),Object(r["h"])(f,f,1/3*u),Object(r["i"])(i,i,f),o+=u):(Object(r["i"])(g,g,f),Object(r["i"])(g,g,b),Object(r["i"])(g,g,m),c+=3)}return(0!==c||0!==o)&&(0!==o?(Object(r["h"])(i,i,1/o),!0):0!==c&&(Object(r["h"])(i,g,1/c),!0))}function u(e,t,i){if(!e||!t)return!1;const{size:n,data:a}=e;Object(r["z"])(i,0,0,0);let s=-1,o=0;for(let r=0;r<t.length;r++){const e=t[r]*n;s!==e&&(i[0]+=a[e+0],i[1]+=a[e+1],i[2]+=a[e+2],o++),s=e}return o>1&&Object(r["h"])(i,i,1/o),o>0}function p(e,t,i,n){if(!e)return!1;const{size:a,data:s}=e;Object(r["z"])(n,0,0,0),Object(r["z"])(g,0,0,0);let o=0,c=0;const l=t?t.length-1:s.length/a-1,d=l+(i?2:0);for(let h=0;h<d;h+=2){const e=h<l?h:l,i=h<l?h+1:0,d=(t?t[e]:e)*a,u=(t?t[i]:i)*a;f[0]=s[d+0],f[1]=s[d+1],f[2]=s[d+2],b[0]=s[u+0],b[1]=s[u+1],b[2]=s[u+2],Object(r["h"])(f,Object(r["i"])(f,f,b),.5);const p=Object(r["q"])(f,b);p>0?(Object(r["i"])(n,n,Object(r["h"])(f,f,p)),o+=p):(Object(r["i"])(g,g,f),c++)}return 0!==o?(Object(r["h"])(n,n,1/o),!0):0!==c&&(Object(r["h"])(n,g,1/c),!0)}const f=Object(n["f"])(),b=Object(n["f"])(),m=Object(n["f"])(),g=Object(n["f"])()},1153:function(e,t,i){"use strict";i.d(t,"a",(function(){return l})),i.d(t,"b",(function(){return y})),i.d(t,"c",(function(){return O})),i.d(t,"d",(function(){return g})),i.d(t,"e",(function(){return v})),i.d(t,"f",(function(){return _})),i.d(t,"g",(function(){return m})),i.d(t,"h",(function(){return f})),i.d(t,"i",(function(){return p})),i.d(t,"j",(function(){return h})),i.d(t,"k",(function(){return u})),i.d(t,"l",(function(){return b})),i.d(t,"m",(function(){return d}));i("38a4"),i("d791");var r=i("3349"),n=i("02f1"),a=(i("0b2d"),i("7577")),s=i("0fc4");const o=Object(s["e"])();class c{constructor(e){this.message=e}toString(){return"AssertException: "+this.message}}function l(e,t){if(!e){t=t||"assert";const e=new Error(t);throw e.stack&&console.log(e.stack),new c(t)}}function d(e,t){e||(t=t||"",console.warn("Verify failed: "+t+"\n"+new Error("verify").stack))}function h(e,t,i,r){let n,a=(i[0]-e[0])/t[0],s=(r[0]-e[0])/t[0];a>s&&(n=a,a=s,s=n);let o=(i[1]-e[1])/t[1],c=(r[1]-e[1])/t[1];if(o>c&&(n=o,o=c,c=n),a>c||o>s)return!1;o>a&&(a=o),c<s&&(s=c);let l=(i[2]-e[2])/t[2],d=(r[2]-e[2])/t[2];return l>d&&(n=l,l=d,d=n),!(a>d||l>s)&&(d<s&&(s=d),!(s<0))}function u(e,t,i,r,a,s=Object(n["b"])()){const o=(r[a]-i[a])*(t[0]-e[0])-(r[0]-i[0])*(t[a]-e[a]),c=(r[0]-i[0])*(e[a]-i[a])-(r[a]-i[a])*(e[0]-i[0]);if(0===o)return!1;const l=c/o;return s[0]=e[0]+l*(t[0]-e[0]),s[1]=e[a]+l*(t[a]-e[a]),!0}function p(e,t,i,r,n){n||(n=e),o[0]=e[0],o[1]=e[1],o[2]=e[2],o[3]=1,Object(a["m"])(o,o,t),n.length>2&&(n[2]=-o[2]),Object(a["m"])(o,o,i),l(0!==o[3]),n[0]=o[0]/o[3],n[1]=o[1]/o[3],n[2]=o[2]/o[3],n[0]=(.5*n[0]+.5)*r[2]+r[0],n[1]=(.5*n[1]+.5)*r[3]+r[1]}function f(e,t){return Math.log(e)/Math.log(t)}function b(e,t,i,r){e[12]=t,e[13]=i,e[14]=r}function m(e){return 1===e[0]&&0===e[1]&&0===e[2]&&0===e[3]&&0===e[4]&&1===e[5]&&0===e[6]&&0===e[7]&&0===e[8]&&0===e[9]&&1===e[10]&&0===e[11]&&1===e[15]}function g(e,t,i){return 2*Math.atan(Math.sqrt(t*t+i*i)*Math.tan(.5*e)/t)}function v(e,t,i){return 2*Math.atan(Math.sqrt(t*t+i*i)*Math.tan(.5*e)/i)}function y(e,t,i){return 2*Math.atan(t*Math.tan(.5*e)/Math.sqrt(t*t+i*i))}function O(e,t,i){return 2*Math.atan(i*Math.tan(.5*e)/Math.sqrt(t*t+i*i))}function _(e,t,i,n,a){const s=e;0===e[11]?(n[0]=2/(t*s[0]),n[1]=2/(i*s[5]),n[2]=(1+s[12])/s[0],n[3]=(1+s[13])/s[5],Object(r["s"])(a,0,1)):(n[0]=-2/(t*s[0]),n[1]=-2/(i*s[5]),n[2]=(1-s[8])/s[0],n[3]=(1-s[9])/s[5],Object(r["s"])(a,1,0))}},"11d8":function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("55f0");class n extends r["a"]{constructor(e=3,t=.01,i=.95,r=12){super(e,t,i,r)}add(e,t){if(this.value.hasLastValue){const t=this.value.lastValue;let i=e-t;for(;i>Math.PI;)i-=2*Math.PI;for(;i<-Math.PI;)i+=2*Math.PI;e=t+i}super.add(e,t)}}},1666:function(e,t,i){"use strict";i.d(t,"a",(function(){return c})),i.d(t,"b",(function(){return s}));var r=i("9812"),n=i("32ed"),a=i("8c4b");function s(e){const t=c(e.rings,e.hasZ,1),i=[];let n=0,s=0;for(const a of t.polygons){const e=a.count,o=a.index,c=new Float64Array(t.position.buffer,3*o*t.position.BYTES_PER_ELEMENT,3*e),l=a.holeIndices.map(e=>e-o),d=new Uint32Array(Object(r["a"])(c,l,3));i.push({position:c,faces:d}),n+=c.length,s+=d.length}const l=o(i,n,s),d=Object(a["a"])(l.position.buffer,6,{originalIndices:l.faces});return l.position=new Float64Array(d.buffer),l.faces=d.indices,l}function o(e,t,i){if(1===e.length)return e[0];const r=new Float64Array(t),n=new Uint32Array(i);let a=0,s=0,o=0;for(const c of e){for(let e=0;e<c.position.length;e++)r[a++]=c.position[e];for(let e=0;e<c.faces.length;e++)n[s++]=c.faces[e]+o;o=a/3}return{position:r,faces:n}}function c(e,t,i){const r=e.length,n=new Array(r),a=new Array(r),s=new Array(r);let o=0,c=0,h=0,u=0;for(let l=0;l<r;++l)u+=e[l].length;const p=new Float64Array(3*u);let f=0;for(let b=r-1;b>=0;b--){const u=e[b],m=1===i&&d(u);if(m&&1!==r)n[o++]=u;else{let e=u.length;for(let t=0;t<o;++t)e+=n[t].length;const i={index:f,pathLengths:new Array(o+1),count:e,holeIndices:new Array(o)};i.pathLengths[0]=u.length,u.length>0&&(s[h++]={index:f,count:u.length}),f=m?l(u,u.length-1,-1,p,f,u.length,t):l(u,0,1,p,f,u.length,t);for(let r=0;r<o;++r){const e=n[r];i.holeIndices[r]=f,i.pathLengths[r+1]=e.length,e.length>0&&(s[h++]={index:f,count:e.length}),f=l(e,0,1,p,f,e.length,t)}o=0,i.count>0&&(a[c++]=i)}}for(let d=0;d<o;++d){const e=n[d];e.length>0&&(s[h++]={index:f,count:e.length}),f=l(e,0,1,p,f,e.length,t)}return c<r&&(a.length=c),h<r&&(s.length=h),{position:p,polygons:a,outlines:s}}function l(e,t,i,r,n,a,s){n*=3;for(let o=0;o<a;++o){const a=e[t];r[n++]=a[0],r[n++]=a[1],r[n++]=s?a[2]:0,t+=i}return n/3}function d(e){return!Object(n["g"])(e,!1,!1)}},"171c":function(e,t,i){"use strict";i.d(t,"a",(function(){return O}));var r=i("e92d"),n=i("38a4"),a=i("b2b2"),s=i("a915"),o=i("d791"),c=i("afe1"),l=i("3349"),d=i("02f1"),h=i("e431"),u=i("0b2d"),p=i("7577"),f=i("0fc4"),b=i("d359"),m=i("d18f"),g=i("a1b1"),v=i("1153");const y=r["a"].getLogger("esri.views.3d.webgl-engine.lib.Camera");class O{constructor(e=null,t=null,i=null){this._viewUp=Object(u["f"])(),this._viewForward=Object(u["f"])(),this._viewRight=Object(u["f"])(),this._ray=Object(m["c"])(),this._viewport=Object(f["g"])(0,0,1,1),this._padding=Object(f["g"])(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=Object(d["f"])(1,1e3),this._viewDirty=!0,this._viewMatrix=Object(c["d"])(),this._projectionDirty=!0,this._projectionMatrix=Object(c["d"])(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=Object(c["d"])(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=Object(c["d"])(),this._frustumDirty=!0,this._frustum=Object(b["c"])(),this._fullViewport=Object(f["e"])(),this.pixelRatio=1,this.relativeElevation=0,Object(a["l"])(e)&&Object(h["n"])(this._ray.origin,e),this._center=Object(a["l"])(t)?Object(u["d"])(t):Object(u["f"])(),this._up=Object(a["l"])(i)?Object(u["d"])(i):Object(u["h"])(0,0,1)}get eye(){return this._ray.origin}set eye(e){this._compareAndSetView(e,this._ray.origin)}get center(){return this._center}set center(e){this._compareAndSetView(e,this._center)}get ray(){return Object(h["m"])(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(e){this._compareAndSetView(e,this._up)}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(e){Object(o["d"])(this._viewMatrix,e),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),this._viewForward}get viewUp(){return this._ensureViewClean(),this._viewUp}get viewRight(){return this._ensureViewClean(),this._viewRight}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(e){this._nearFar[0]!==e&&(this._nearFar[0]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get far(){return this._nearFar[1]}set far(e){this._nearFar[1]!==e&&(this._nearFar[1]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get viewport(){return this._viewport}set viewport(e){this.x=e[0],this.y=e[1],this.width=e[2],this.height=e[3]}get x(){return this._viewport[0]}set x(e){e+=this._padding[3],this._viewport[0]!==e&&(this._viewport[0]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get y(){return this._viewport[1]}set y(e){e+=this._padding[2],this._viewport[1]!==e&&(this._viewport[1]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get width(){return this._viewport[2]}set width(e){this._viewport[2]!==e&&(this._viewport[2]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get height(){return this._viewport[3]}set height(e){this._viewport[3]!==e&&(this._viewport[3]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get fullWidth(){return this._viewport[2]+this._padding[1]+this._padding[3]}set fullWidth(e){this.width=e-(this._padding[1]+this._padding[3])}get fullHeight(){return this._viewport[3]+this._padding[0]+this._padding[2]}set fullHeight(e){this.height=e-(this._padding[0]+this._padding[2])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[3],this._fullViewport[1]=this._viewport[1]-this._padding[2],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get aspect(){return this.width/this.height}get padding(){return this._padding}set padding(e){this._padding[0]===e[0]&&this._padding[1]===e[1]&&this._padding[2]===e[2]&&this._padding[3]===e[3]||(this._viewport[0]+=e[3]-this._padding[3],this._viewport[1]+=e[2]-this._padding[2],this._viewport[2]-=e[1]+e[3]-(this._padding[1]+this._padding[3]),this._viewport[3]-=e[0]+e[2]-(this._padding[0]+this._padding[2]),Object(p["c"])(this._padding,e),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get viewProjectionMatrix(){return this._viewProjectionDirty&&(Object(o["n"])(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){if(this._projectionDirty){const e=this.width,t=this.height,i=this.near*Math.tan(this.fovY/2),r=i*this.aspect;Object(o["i"])(this._projectionMatrix,-r*(1+2*this._padding[3]/e),r*(1+2*this._padding[1]/e),-i*(1+2*this._padding[2]/t),i*(1+2*this._padding[0]/t),this.near,this.far),this._projectionDirty=!1}return this._projectionMatrix}set projectionMatrix(e){Object(o["d"])(this._projectionMatrix,e),this._projectionDirty=!1,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fov(){return this._fov}set fov(e){this._fov=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return Object(v["b"])(this._fov,this.width,this.height)}set fovX(e){this._fov=Object(v["d"])(e,this.width,this.height),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return Object(v["c"])(this._fov,this.width,this.height)}set fovY(e){this._fov=Object(v["e"])(e,this.width,this.height),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return Object(h["p"])(this._center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&(Object(o["c"])(this._viewInverseTransposeMatrix,this.viewMatrix),Object(o["u"])(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(e){const t=2*e-1;return 2*this.near*this.far/(this.far+this.near-t*(this.far-this.near))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this.pixelRatio}get aboveGround(){return this.relativeElevation&&this.relativeElevation>=0}copyFrom(e){Object(h["n"])(this._ray.origin,e.eye),Object(h["n"])(this._center,e.center),Object(h["n"])(this._up,e.up),Object(p["c"])(this._viewport,e.viewport),Object(p["c"])(this._padding,e.padding),Object(l["c"])(this._nearFar,e.nearFar),this._fov=e.fov,this.relativeElevation=e.relativeElevation;const t=e;return this._viewDirty=t._viewDirty,this._viewDirty||(Object(o["d"])(this._viewMatrix,e.viewMatrix),Object(h["n"])(this._viewRight,e.viewRight),Object(h["n"])(this._viewUp,e.viewUp),Object(h["n"])(this._viewForward,e.viewForward)),t._projectionDirty?this._projectionDirty=!0:(Object(o["d"])(this._projectionMatrix,e.projectionMatrix),this._projectionDirty=!1),this._viewProjectionDirty=!0,this._frustumDirty=t._frustumDirty,this._frustumDirty||(Object(b["b"])(e.frustum,this._frustum),this._frustumDirty=!1),t._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(Object(o["d"])(this._viewInverseTransposeMatrix,e.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),Object(p["c"])(this._fullViewport,e.fullViewport),this.pixelRatio=e.pixelRatio,this}copyViewFrom(e){this.eye=e.eye,this.center=e.center,this.up=e.up}clone(){return(new O).copyFrom(this)}equals(e){return Object(h["r"])(this.eye,e.eye)&&Object(h["r"])(this._center,e.center)&&Object(h["r"])(this._up,e.up)&&Object(p["g"])(this._viewport,e.viewport)&&Object(p["g"])(this._padding,e.padding)&&Object(l["e"])(this._nearFar,e.nearFar)&&this._fov===e.fov&&this.pixelRatio===e.pixelRatio&&this.relativeElevation===e.relativeElevation}almostEquals(e){if(this.pixelRatio!==e.pixelRatio||Math.abs(e.fov-this._fov)>=.001)return!1;const t=5e-4,i=1-1e-10;Object(h["C"])(j,e.eye,e.center),Object(h["C"])(w,this.eye,this._center);const r=Object(h["k"])(j,w),n=Object(h["D"])(j),a=Object(h["D"])(w);return r*r>=i*n*a&&Object(h["E"])(e.eye,this.eye)<Math.max(n,a)*t*t&&Object(p["i"])(e.padding,this._padding)<.5&&Object(p["i"])(e.viewport,this._viewport)<.5}computeRenderPixelSizeAt(e){return this.computeRenderPixelSizeAtDist(this.viewDirectionDistance(e))}computeRenderPixelSizeAtDist(e){return e*this.perRenderPixelRatio}computeScreenPixelSizeAt(e){return this.computeScreenPixelSizeAtDist(this.viewDirectionDistance(e))}viewDirectionDistance(e){return Math.abs(Object(g["d"])(this.viewForward,Object(h["m"])(j,e,this.eye)))}computeScreenPixelSizeAtDist(e){return e*this.perScreenPixelRatio}computeDistanceFromRadius(e,t){return e/Math.tan(Math.min(this.fovX,this.fovY)/(2*(t||1)))}getScreenCenter(e=Object(s["g"])()){return e[0]=(this.padding[3]+this.width/2)/this.pixelRatio,e[1]=(this.padding[0]+this.height/2)/this.pixelRatio,e}getRenderCenter(e,t=.5,i=.5){return e[0]=this.padding[3]+this.width*t,e[1]=this.padding[2]+this.height*i,e[2]=.5,e}setGLViewport(e){const t=this.viewport,i=this.padding;e.setViewport(t[0]-i[3],t[1]-i[2],t[2]+i[1]+i[3],t[3]+i[0]+i[2])}applyProjection(e,t,i=!1){e!==_&&Object(h["n"])(_,e),_[3]=1,i&&(t[2]=-_[2]),Object(p["m"])(_,_,this.projectionMatrix),Object(h["h"])(_,_,1/Math.abs(_[3]));const r=this.fullViewport;return t[0]=Object(n["l"])(0,r[0]+r[2],.5+.5*_[0]),t[1]=Object(n["l"])(0,r[1]+r[3],.5+.5*_[1]),i||(t[2]=.5*(_[2]+1)),t}projectToScreen(e,t){this.projectToRenderScreen(e,S),this.renderToScreen(S,t)}projectToRenderScreen(e,t){if(_[0]=e[0],_[1]=e[1],_[2]=e[2],_[3]=1,Object(p["m"])(_,_,this.viewProjectionMatrix),0===_[3])return null;Object(h["h"])(_,_,1/Math.abs(_[3]));const i=this.fullViewport;return"x"in t?(t.x=Object(n["l"])(0,i[0]+i[2],.5+.5*_[0]),t.y=Object(n["l"])(0,i[1]+i[3],.5+.5*_[1])):(t[0]=Object(n["l"])(0,i[0]+i[2],.5+.5*_[0]),t[1]=Object(n["l"])(0,i[1]+i[3],.5+.5*_[1]),t.length>2&&(t[2]=.5*(_[2]+1))),t}unprojectFromScreen(e,t){return this.unprojectFromRenderScreen(this.screenToRender(e,S),t)}unprojectFromRenderScreen(e,t){if(Object(o["n"])(x,this.projectionMatrix,this.viewMatrix),!Object(o["c"])(x,x))return null;const i=this.fullViewport;return _[0]=2*(e[0]-i[0])/i[2]-1,_[1]=2*(e[1]-i[1])/i[3]-1,_[2]=2*e[2]-1,_[3]=1,Object(p["m"])(_,_,x),0===_[3]?null:(t[0]=_[0]/_[3],t[1]=_[1]/_[3],t[2]=_[2]/_[3],t)}constrainWindowSize(e,t,i,r=i){const n=e*this.pixelRatio,a=t*this.pixelRatio,s=Math.max(n-i/2,0),o=Math.max(this.fullHeight-a-r/2,0),c=-Math.min(n-i/2,0),l=-Math.min(this.fullHeight-a-r/2,0);return[s,o,i-c- -Math.min(this.fullWidth-n-i/2,0),r-l- -Math.min(a-r/2,0)]}computeUp(e){1===e?this.computeUpGlobal():this.computeUpLocal()}screenToRender(e,t){const i=e[0]*this.pixelRatio,r=this.fullHeight-e[1]*this.pixelRatio;return t[0]=i,t[1]=r,t}renderToScreen(e,t){const i=e[0]/this.pixelRatio,r=(this.fullHeight-e[1])/this.pixelRatio;t[0]=i,t[1]=r}computeUpGlobal(){Object(h["m"])(j,this.center,this.eye);const e=Object(h["s"])(this.center);e<1?(Object(h["z"])(this._up,0,0,1),this._markViewDirty()):Math.abs(Object(h["k"])(j,this.center))>.9999*Object(h["s"])(j)*e||(Object(h["j"])(this._up,j,this.center),Object(h["j"])(this._up,this._up,j),Object(h["u"])(this._up,this._up),this._markViewDirty())}computeUpLocal(){Object(h["y"])(j,this.eye,this.center),Math.abs(j[2])<=.9999&&(Object(h["h"])(j,j,j[2]),Object(h["z"])(this._up,-j[0],-j[1],1-j[2]),Object(h["u"])(this._up,this._up),this._markViewDirty())}_compareAndSetView(e,t){"number"==typeof e[0]&&isFinite(e[0])&&"number"==typeof e[1]&&isFinite(e[1])&&"number"==typeof e[2]&&isFinite(e[2])?Object(h["r"])(e,t)||(Object(h["n"])(t,e),this._markViewDirty()):y.warn("Camera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}_recomputeFrustum(){this._frustumDirty&&(Object(b["e"])(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&(Object(o["m"])(this._viewMatrix,this.eye,this._center,this._up),Object(h["z"])(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),Object(h["z"])(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),Object(h["z"])(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}}const _=Object(f["e"])(),x=Object(c["d"])(),j=Object(u["f"])(),w=Object(u["f"])(),S=Object(s["e"])()},1797:function(e,t,i){"use strict";i.d(t,"a",(function(){return l})),i.d(t,"b",(function(){return c}));i("e06a");var r=i("b50f"),n=i("b2b2"),a=i("f4cc"),s=i("9305"),o=i("57dc");class c{constructor(e,t){this.spatialReference=e,this.view=t}getElevation(e,t,i){return this.view.elevationProvider.getElevation(e,t,0,this.spatialReference,i)}async queryElevation(e,t,i,r,n){return this.view.elevationProvider.queryElevation(e,t,0,this.spatialReference,n,i,r)}}class l{constructor(e,t,i,r){this.spatialReference=t,this._getElevationQueryProvider=i,this._queries=new Array,this._queryOptions={...r,ignoreInvisibleLayers:!0},this._frameTask=e.registerTask(s["b"].ELEVATION_QUERY,this)}destroy(){this._frameTask.remove()}queryElevation(e,t,i,n=0){return new Promise((s,o)=>{const c={x:e,y:t,minDemResolution:n,result:{resolve:s,reject:o},signal:i};this._queries.push(c),Object(a["r"])(i,()=>{Object(r["j"])(this._queries,c),o(Object(a["e"])())})})}get running(){return this._queries.length>0}runTask(){const e=this._queries;this._queries=[];const t=this._getElevationQueryProvider();if(!t)return void e.forEach(e=>e.result.reject());const i=e.map(e=>[e.x,e.y]),r=e.reduce((e,t)=>Math.min(e,t.minDemResolution),1/0),s=new o["a"]({points:i,spatialReference:this.spatialReference}),c=e.length>1&&e.some(e=>!!e.signal)?new AbortController:null,l=Object(n["l"])(c)?c.signal:e[0].signal;if(Object(n["l"])(c)){let t=0;e.forEach(i=>Object(a["r"])(i.signal,()=>{t++,i.result.reject(Object(a["e"])()),t===e.length&&c.abort()}))}const d={...this._queryOptions,minDemResolution:r,signal:l};t.queryElevation(s,d).then(t=>{e.forEach((e,i)=>{Object(n["l"])(e.signal)&&e.signal.aborted?e.result.reject(Object(a["e"])()):e.result.resolve(t.geometry.points[i][2])})}).catch(t=>{e.forEach(e=>e.result.reject(t))})}get test(){const e=this;return{update:()=>e._queries.length>0&&e.runTask()}}}},"17b0":function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return s}));var r=i("2f98"),n=i("3886");function a(e,t){const i=e.vertex.code;t.verticalOffsetEnabled?(e.vertex.uniforms.add("verticalOffset","vec4"),t.screenSizePerspectiveEnabled&&(e.include(r["a"]),e.vertex.uniforms.add("screenSizePerspectiveAlignment","vec4")),i.add(n["a"]`
    vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
      float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
      ${1===t.viewingMode?n["a"]`vec3 worldNormal = normalize(worldPos + localOrigin);`:n["a"]`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
      ${t.screenSizePerspectiveEnabled?n["a"]`
          float cosAngle = dot(worldNormal, normalize(worldPos - camPos));
          float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:n["a"]`
          float verticalOffsetScreenHeight = verticalOffset.x;`}
      // Screen sized offset in world space, used for example for line callouts
      float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
      return worldNormal * worldOffset;
    }

    vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
      return worldPos + calculateVerticalOffset(worldPos, localOrigin);
    }
    `)):i.add(n["a"]`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)}function s(e,t,i){if(!t.verticalOffset)return;const r=o(t.verticalOffset,i.camera.fovY,i.camera.fullViewport[3]),n=i.camera.pixelRatio||1;e.setUniform4f("verticalOffset",r.screenLength*n,r.perDistance,r.minWorldLength,r.maxWorldLength)}function o(e,t,i,r=c){return r.screenLength=e.screenLength,r.perDistance=Math.tan(.5*t)/(.5*i),r.minWorldLength=e.minWorldLength,r.maxWorldLength=e.maxWorldLength,r}const c={screenLength:0,perDistance:0,minWorldLength:0,maxWorldLength:0}},"17ca":function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("3886");function n(e){e.vertex.code.add(r["a"]`vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {
vec3 camToVert = posWorld - camPosWorld;
bool isBackface = dot(camToVert, normalWorld) > 0.0;
if (isBackface) {
posClip.z += 0.0000003 * posClip.w;
}
return posClip;
}`)}},"189c":function(e,t,i){"use strict";function r(e,t,i=32774,r=[0,0,0,0]){return{srcRgb:e,srcAlpha:e,dstRgb:t,dstAlpha:t,opRgb:i,opAlpha:i,color:{r:r[0],g:r[1],b:r[2],a:r[3]}}}function n(e,t,i,r,n=32774,a=32774,s=[0,0,0,0]){return{srcRgb:e,srcAlpha:t,dstRgb:i,dstAlpha:r,opRgb:n,opAlpha:a,color:{r:s[0],g:s[1],b:s[2],a:s[3]}}}i.d(t,"a",(function(){return k})),i.d(t,"b",(function(){return a})),i.d(t,"c",(function(){return o})),i.d(t,"d",(function(){return l})),i.d(t,"e",(function(){return c})),i.d(t,"f",(function(){return s})),i.d(t,"g",(function(){return v})),i.d(t,"h",(function(){return n})),i.d(t,"i",(function(){return r}));const a={face:1029,mode:2305},s={face:1028,mode:2305},o=e=>2===e?a:1===e?s:null,c={zNear:0,zFar:1},l={r:!0,g:!0,b:!0,a:!0};function d(e){return _.intern(e)}function h(e){return j.intern(e)}function u(e){return S.intern(e)}function p(e){return C.intern(e)}function f(e){return A.intern(e)}function b(e){return R.intern(e)}function m(e){return D.intern(e)}function g(e){return F.intern(e)}function v(e){return L.intern(e)}class y{constructor(e,t){this.makeKey=e,this.makeRef=t,this.interns=new Map}intern(e){if(!e)return null;const t=this.makeKey(e),i=this.interns;return i.has(t)||i.set(t,this.makeRef(e)),i.get(t)}}function O(e){return"["+e.join(",")+"]"}const _=new y(x,e=>({__tag:"Blending",...e}));function x(e){return e?O([e.srcRgb,e.srcAlpha,e.dstRgb,e.dstAlpha,e.opRgb,e.opAlpha,e.color.r,e.color.g,e.color.b,e.color.a]):null}const j=new y(w,e=>({__tag:"Culling",...e}));function w(e){return e?O([e.face,e.mode]):null}const S=new y(T,e=>({__tag:"PolygonOffset",...e}));function T(e){return e?O([e.factor,e.units]):null}const C=new y(P,e=>({__tag:"DepthTest",...e}));function P(e){return e?O([e.func]):null}const A=new y(M,e=>({__tag:"StencilTest",...e}));function M(e){return e?O([e.function.func,e.function.ref,e.function.mask,e.operation.fail,e.operation.zFail,e.operation.zPass]):null}const R=new y(E,e=>({__tag:"DepthWrite",...e}));function E(e){return e?O([e.zNear,e.zFar]):null}const D=new y(I,e=>({__tag:"ColorWrite",...e}));function I(e){return e?O([e.r,e.g,e.b,e.a]):null}const F=new y(z,e=>({__tag:"StencilWrite",...e}));function z(e){return e?O([e.mask]):null}const L=new y(V,e=>({blending:d(e.blending),culling:h(e.culling),polygonOffset:u(e.polygonOffset),depthTest:p(e.depthTest),stencilTest:f(e.stencilTest),depthWrite:b(e.depthWrite),colorWrite:m(e.colorWrite),stencilWrite:g(e.stencilWrite)}));function V(e){return e?O([x(e.blending),w(e.culling),T(e.polygonOffset),P(e.depthTest),M(e.stencilTest),E(e.depthWrite),I(e.colorWrite),z(e.stencilWrite)]):null}class k{constructor(e){this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._stateSetters=e}setPipeline(e){(this._pipelineInvalid||e!==this._pipeline)&&(this.setBlending(e.blending),this.setCulling(e.culling),this.setPolygonOffset(e.polygonOffset),this.setDepthTest(e.depthTest),this.setStencilTest(e.stencilTest),this.setDepthWrite(e.depthWrite),this.setColorWrite(e.colorWrite),this.setStencilWrite(e.stencilWrite),this._pipeline=e),this._pipelineInvalid=!1}invalidateBlending(){this._blendingInvalid=!0,this._pipelineInvalid=!0}invalidateCulling(){this._cullingInvalid=!0,this._pipelineInvalid=!0}invalidatePolygonOffset(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0}invalidateDepthTest(){this._depthTestInvalid=!0,this._pipelineInvalid=!0}invalidateStencilTest(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDepthWrite(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0}invalidateColorWrite(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0}invalidateStencilWrite(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}setBlending(e){this._blending=this.setSubState(e,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1}setCulling(e){this._culling=this.setSubState(e,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1}setPolygonOffset(e){this._polygonOffset=this.setSubState(e,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1}setDepthTest(e){this._depthTest=this.setSubState(e,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1}setStencilTest(e){this._stencilTest=this.setSubState(e,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1}setDepthWrite(e){this._depthWrite=this.setSubState(e,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1}setColorWrite(e){this._colorWrite=this.setSubState(e,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1}setStencilWrite(e){this._stencilWrite=this.setSubState(e,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1}setSubState(e,t,i,r){return(i||e!==t)&&(r(e),this._pipelineInvalid=!0),e}}},"191a":function(e,t,i){"use strict";i.d(t,"a",(function(){return E}));var r=i("28eb"),n=i("b2b2"),a=i("8a44"),s=i("d791"),o=i("afe1"),c=i("2ebb"),l=i("b061"),d=i("1153"),h=i("1f93");class u{constructor(e){this.first=e.from,this.count=e.to-e.from}}class p{constructor(e=0,t=0){this.from=e,this.to=t}}class f extends p{constructor(e,t,i,r,n,a){super(t,i),this.id=e,this.isVisible=r,this.hasHighlights=n,this.hasOccludees=a}}function b(e){return Array.from(e.values()).sort(m)}function m(e,t){return e.from===t.from?e.to-t.to:e.from-t.from}function g(e,t){if(0===e.length)return void e.push(new u(t));const i=e[e.length-1];if(v(i,t)){const e=t.from-i.first+t.to-t.from;i.count=e}else e.push(new u(t))}function v(e,t){return e.first+e.count>=t.from}class y{constructor(e,t){this._pool=e,this._size=0,this._buffer=e.newBuffer(_(t))}dispose(){this._buffer=this._pool.deleteBuffer(this._buffer),this._size=0}release(){this.erase(0,this._size),this.dispose()}get vao(){return this._buffer.vao}get array(){return this._buffer.array}get size(){return this._size}grow(e){this._resize(this._size+e,!0).dispose()}alloc(e){return this._resize(e,!1)}_resize(e,t){let i;const r=x(this._buffer.length,this._size,e);if(this._buffer.length!==r){const e=this._pool.newBuffer(r);t&&(e.array.set(this._buffer.array.subarray(0,Math.min(this._size,r))),e.vao.vertexBuffers.geometry.setSubData(e.array,0,0,e.array.byteLength)),i=this._buffer,this._buffer=e}const n=this._size;return this._size=e,i?{dispose:()=>{i.array.fill(0,0,n),this._pool.deleteBuffer(i)},copy:(e,t,r)=>this._buffer.array.set(i.array.subarray(t,r),e),hasNewBuffer:!0}:{dispose:()=>{},copy:(e,t,i)=>{e!==t&&this._buffer.array.copyWithin(e,t,i)},hasNewBuffer:!1}}erase(e,t){this._buffer.array.fill(0,e,t)}}const O=65536;function _(e){return Math.ceil(e/O)*O}function x(e,t,i){return t<=i?e>=i?e:_(Math.max(2*e,i)):e<=2*i?e:_(i)}var j=i("aefa"),w=i("f2e0"),S=i("7ce4"),T=(i("d267"),i("c120"),i("1956"),i("d17d"),i("9f8b"),i("a1ff"),i("0fa6"));class C{constructor(e,t,i,r){this.vao=new T["a"](e,t,{geometry:i},{geometry:S["a"].createVertex(e,35044)}),this.array=new Float32Array(r),this.vao.vertexBuffers.geometry.setData(this.array)}dispose(){this.vao.dispose(!0)}get length(){return this.array.length}}const P=j["a"]+1;class A{constructor(e,t,i){this._rctx=e,this._locations=t,this._layout=i,this._cache=e.newCache("MergedRenderer pool "+Object(w["b"])(),M)}dispose(){this._cache.destroy()}newBuffer(e){const t=e.toString(),i=this._cache.pop(t);if(Object(n["l"])(i)){const e=i.pop();return i.length>0&&this._cache.put(t,i,e.array.byteLength*i.length,P),e}return new C(this._rctx,this._locations,this._layout,e)}deleteBuffer(e){const t=e.array.byteLength,i=e.array.length.toString(),r=this._cache.pop(i);return Object(n["l"])(r)?(r.push(e),this._cache.put(i,r,t*r.length,-1)):this._cache.put(i,[e],t,-1),null}}function M(e,t){if(0===t)return void e.forEach(e=>e.dispose());const i=e.pop(),r=e.length*i.array.byteLength;return i.dispose(),r}var R=i("b623");class E{constructor(e,t,i){this._rctx=e,this._materialRepository=t,this._material=i,this.type="MergedRenderer",this._dataByOrigin=new Map,this._renderCommandData=new a["a"],this._hasHighlights=!1,this._hasOccludees=!1,this._glMaterials=new l["a"](this._material,this._materialRepository),this._bufferWriter=i.createBufferWriter(),this._bufferPool=new A(e,i.vertexAttributeLocations,Object(c["a"])(this._bufferWriter.vertexBufferLayout))}dispose(){this._glMaterials.destroy(),this._dataByOrigin.forEach(e=>e.buffer.dispose()),this._dataByOrigin.clear(),this._bufferPool.dispose()}get isEmpty(){return 0===this._dataByOrigin.size}get hasHighlights(){return this._hasHighlights}get hasOccludees(){return this._hasOccludees}get hasWater(){return!this.isEmpty&&this._material instanceof h["a"]}get rendersOccluded(){return!this.isEmpty&&1!==this._material.renderOccluded}modify(e){this.updateGeometries(e.updates),this.addAndRemoveGeometries(e.adds,e.removes),this.updateRenderCommands()}addAndRemoveGeometries(e,t){const i=this._bufferWriter,r=i.vertexBufferLayout.stride/4,n=this._dataByOrigin,a=I(e,t);a.forEach((e,t)=>{a.delete(t);const s=e.toAdd.reduce((e,t)=>e+i.elementCount(t.data),0);let o=n.get(t);if(null==o)Object(d["a"])(0===e.toRemove.length),o=new k(e.origin,new y(this._bufferPool,s*r)),n.set(t,o);else if(0===e.toAdd.length&&o.instances.size===e.toRemove.length)return o.buffer.dispose(),void n.delete(t);let c=0;o.instances.forEach(e=>c+=e.to-e.from);const l=e.toRemove.reduce((e,t)=>e+i.elementCount(t.data),0),h=o.buffer.size,u=(c+s-l)*r,p=B;if(u<h/2?this.removeAndRebuild(o,e.toRemove,r,u,p):e.toRemove.length>0&&this.remove(o,e.toRemove,r,p),e.toAdd.length>0){const t=N;Object(d["l"])(t,-e.origin[0],-e.origin[1],-e.origin[2]),this.add(o,e.toAdd,r,t,p)}const f=o.buffer.vao.vertexBuffers.geometry;V(p),p.forAll(({from:e,to:t})=>{if(e<t){const i=o.buffer.array,r=4,n=e*r,a=t*r;f.setSubData(i,n,n,a)}}),p.clear(),o.drawCommandsDirty=!0})}updateGeometries(e){const t=this._bufferWriter,i=t.vertexBufferLayout.stride/4;for(const r of e){const e=r.renderGeometry,n=this._dataByOrigin.get(e.origin.id),a=n&&n.instances.get(e.id);if(!a)return;const s=r.updateType;if(1&s&&(a.isVisible=e.instanceParameters.visible),9&s){const t=e.instanceParameters.visible;a.hasHighlights=!!e.instanceParameters.highlights&&t}if(16&s&&(a.hasOccludees=!!e.instanceParameters.occludees),6&s){const{array:r,vao:s}=n.buffer;Object(R["b"])(e,G,q),t.write({transformation:G,invTranspTransformation:q},e.data,t.vertexBufferLayout.createView(r.buffer),a.from),Object(d["a"])(a.from+t.elementCount(e.data)===a.to,"material VBO layout has changed"),s.vertexBuffers.geometry.setSubData(r,a.from*i*4,a.from*i*4,a.to*i*4)}n.drawCommandsDirty=!0}}updateRenderCommands(){this._hasHighlights=!1,this._hasOccludees=!1,this._dataByOrigin.forEach(e=>{e.hasHiddenInstances=!1,e.hasHighlights=!1,e.hasOccludees=!1,Object(r["c"])(e.instances,t=>(t.isVisible?(t.hasHighlights&&(this._hasHighlights=!0,e.hasHighlights=!0),t.hasOccludees&&(this._hasOccludees=!0,e.hasOccludees=!0)):e.hasHiddenInstances=!0,e.hasHiddenInstances&&e.hasHighlights&&e.hasOccludees))});const e=e=>{if(e.drawCommandsDefault=null,e.drawCommandsHighlight=null,e.drawCommandsOccludees=null,e.drawCommandsShadowHighlightRest=null,0===e.instances.size)return;if(!z(e)){const t=this._bufferWriter.vertexBufferLayout.stride,i=4*e.buffer.size/t;return void(e.drawCommandsDefault=[{first:0,count:i}])}const t=b(e.instances);e.drawCommandsDefault=[],e.drawCommandsHighlight=[],e.drawCommandsOccludees=[],e.drawCommandsShadowHighlightRest=[];for(const i of t)i.isVisible&&(i.hasOccludees?g(e.drawCommandsOccludees,i):g(e.drawCommandsDefault,i),i.hasHighlights?g(e.drawCommandsHighlight,i):g(e.drawCommandsShadowHighlightRest,i))};this._dataByOrigin.forEach(t=>{t.drawCommandsDirty&&(e(t),t.drawCommandsDirty=!1)})}updateLogic(e){return this._material.update(e)}render(e,t,i){if(null!=e&&!this._material.requiresSlot(e,t))return!1;const r=5===t||7===t;if(r&&!this._hasHighlights)return!1;const a=6===t,s=!(r||a);if(this._dataByOrigin.forEach(e=>{if(r&&!e.hasHighlights)return;const t=(r?e.drawCommandsHighlight:a&&z(e)?e.drawCommandsShadowHighlightRest:e.drawCommandsDefault)||null,i=s&&e.drawCommandsOccludees||null;(Object(n["l"])(t)||Object(n["l"])(i))&&this._renderCommandData.push(new U(e.origin,e.buffer,t,i))}),0===this._renderCommandData.length)return!1;const o=this._rctx,c=this._glMaterials.load(o,t);if(Object(n["k"])(c))return this._renderCommandData.clear(),!1;const l=c.beginSlot(i);return l.bindPipelineState(o,e,!1),o.useProgram(l.program),c.bind(i,l),this._renderCommandData.forAll(({origin:t,buffer:r,renderCommands:a,occludeeCommands:s})=>{i.origin=t,l.bindDraw(i),l.ensureAttributeLocations(r.vao),o.bindVAO(r.vao);const c=l.primitiveType;Object(n["l"])(a)&&this.renderCommands(o,c,a),Object(n["l"])(s)&&(l.bindPipelineState(o,e,!0),this.renderCommands(o,c,s),l.bindPipelineState(o,e,!1))}),this._renderCommandData.clear(),!0}renderCommands(e,t,i){for(let r=0;r<i.length;r++)e.drawArrays(t,i[r].first,i[r].count)}removeAndRebuild(e,t,i,r,n){for(const l of t)e.instances.delete(l.id);const a=b(e.instances);e.instances.clear();const s=e.buffer.size,o=e.buffer.alloc(r);let c=0;for(const l of a){const t=l.from*i,r=l.to*i;o.copy(c,t,r),l.from=c/i,c+=r-t,l.to=c/i,e.instances.set(l.id,l)}n.push(new p(0,o.hasNewBuffer?e.buffer.array.length:s)),o.dispose(),e.buffer.erase(c,n.back().to),e.holes.clear()}remove(e,t,i,r){for(const n of t){const t=n.id,a=e.instances.get(t),s=a.from*i,o=a.to*i;e.buffer.erase(s,o),e.holes.push(new p(a.from,a.to)),e.instances.delete(t),r.push(new p(s,o))}V(e.holes)}add(e,t,i,r,a){const o=this._bufferWriter;let c=o.vertexBufferLayout.createView(e.buffer.array.buffer);for(const l of t){const t=Object(n["l"])(l.transformation)?Object(s["n"])(G,r,l.transformation):r;Object(s["c"])(q,t);const h=Object(s["u"])(q,q),u=o.elementCount(l.data),b=u*i;let m=L(e.holes,u);Object(n["k"])(m)&&(m=e.buffer.size/i,e.buffer.grow(b),c=o.vertexBufferLayout.createView(e.buffer.array.buffer)),o.write({transformation:t,invTranspTransformation:h},l.data,c,m);const g=l.instanceParameters.visible,v=!!l.instanceParameters.highlights&&g,y=!!l.instanceParameters.occludees,O=new f(l.id,m,m+u,g,v,y);Object(d["a"])(null==e.instances.get(l.id)),e.instances.set(l.id,O),a.push(new p(O.from*i,O.to*i))}}get test(){return{material:this._material,glMaterials:this._glMaterials}}}class D{constructor(e){this.origin=e,this.toAdd=new Array,this.toRemove=new Array}}function I(e,t){const i=new Map;for(const r of e)F(i,r,!0);for(const r of t)F(i,r,!1);return i}function F(e,t,i){const r=t.origin;if(Object(n["k"])(r))return;let a=e.get(r.id);null==a&&(a=new D(r.vec3),e.set(r.id,a)),i?a.toAdd.push(t):a.toRemove.push(t)}function z(e){return e.hasOccludees||e.hasHighlights||e.hasHiddenInstances}function L(e,t){let i;if(!e.some(e=>!(e.to-e.from<t)&&(i=e,!0)))return null;const r=i.from;return i.from+=t,i.from>=i.to&&e.removeUnordered(i),r}function V(e){const t=new Map;e.forAll(e=>t.set(e.from,e));let i=!0;for(;i;)i=!1,e.forEach(r=>{const n=t.get(r.to);n&&(r.to=n.to,t.delete(n.from),e.removeUnordered(n),i=!0)})}class k{constructor(e,t){this.origin=e,this.buffer=t,this.instances=new Map,this.holes=new a["a"]({deallocator:null}),this.hasHiddenInstances=!1,this.hasHighlights=!1,this.hasOccludees=!1,this.drawCommandsDirty=!1}}class U{constructor(e,t,i,r){this.origin=e,this.buffer=t,this.renderCommands=i,this.occludeeCommands=r}}const B=new a["a"]({deallocator:null}),N=Object(o["d"])(),G=Object(o["d"])(),q=Object(o["d"])()},1956:function(e,t,i){"use strict";i.d(t,"a",(function(){return h})),i.d(t,"b",(function(){return l})),i.d(t,"c",(function(){return d}));var r=i("ce50"),n=i("c120"),a=i("e92d");const s=a["a"].getLogger("esri/views/webgl");function o(e,t){switch(t){case e.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";case e.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case e.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case e.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case e.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case e.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";default:return"Unknown error"}}const c=!!Object(n["a"])("enable-feature:webgl-debug");function l(){return c}function d(){return c}function h(e){if(l()){const t=e.getError();if(t){const i=o(e,t),n=(new Error).stack;s.error(new r["a"]("webgl-error","WebGL error occured",{message:i,stack:n}))}}}},1962:function(e,t,i){"use strict";i.d(t,"a",(function(){return b})),i.d(t,"b",(function(){return f}));var r=i("d272"),n=i("4db9"),a=i("6d5b"),s=i("c2d1"),o=i("6a07"),c=i("d047"),l=i("c6d7"),d=i("ebd5"),h=i("4377"),u=i("3886"),p=i("690a");function f(e){const t=new p["a"],i=1===e.output;return t.include(n["a"],{linearDepth:i}),t.include(a["a"],e),t.vertex.uniforms.add("proj","mat4").add("view","mat4"),t.attributes.add("position","vec3"),t.varyings.add("vpos","vec3"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),i&&(t.include(s["a"],e),t.vertex.uniforms.add("cameraNearFar","vec2"),t.varyings.add("linearDepth","float")),t.vertex.code.add(u["a"]`
    void main(void) {
      vpos = position;
      forwardNormalizedVertexColor();
      ${e.multipassTerrainEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = ${i?u["a"]`transformPositionWithDepth(proj, view, vpos, cameraNearFar, linearDepth);`:u["a"]`transformPosition(proj, view, vpos);`}
    }
  `),t.include(r["a"],e),t.fragment.include(h["a"]),e.multipassTerrainEnabled&&(t.fragment.include(c["a"]),t.include(l["b"],e)),t.fragment.uniforms.add("eColor","vec4"),4===e.output&&t.include(o["a"]),t.fragment.code.add(u["a"]`
  void main() {
    discardBySlice(vpos);
    ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
    vec4 color = ${e.attributeColor?"vColor * eColor;":"eColor;"}

    if (color.a < ${u["a"].float(d["c"])}) {
      discard;
    }

    ${7===e.output?u["a"]`gl_FragColor = vec4(color.a);`:""}

    ${0===e.output?u["a"]`gl_FragColor = highlightSlice(color, vpos); ${e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
    ${4===e.output?u["a"]`outputHighlight();`:""};
    ${1===e.output?u["a"]`outputDepth(linearDepth);`:""};
  }
  `),t}const b=Object.freeze({__proto__:null,build:f})},"19f3":function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return s}));var r=i("1a2b"),n=i("3886"),a=i("690a");function s(e){const t=new a["a"];return t.attributes.add("position","vec3"),t.fragment.uniforms.add("cloudRadius","float").add("halfCubeMapSize","float").add("power","float").add("sigmaE","float").add("density","float").add("cloudSize","float").add("detailSize","float").add("smoothness","float").add("cloudHeight","float").add("coverage","float").add("viewMatrix","mat3").add("cloudShapeTexture","sampler2D"),t.vertex.code.add(n["a"]`void main(void) {
gl_Position = vec4(position, 1.0);
}`),t.fragment.code.add(n["a"]`
    const int STEPS = ${0===e.steps?n["a"]`16`:1===e.steps?n["a"]`100`:n["a"]`200`};
    const int STEPS_LIGHT = 6;
    const float stepL = 300.0 / float(STEPS_LIGHT);

    const float cloudStart = 1500.0;

    vec3 rayDirection(vec2 fragCoord) {
      vec2 xy = fragCoord - halfCubeMapSize;
      return normalize(vec3(-xy, -halfCubeMapSize));
    }

    float remap(float x, float low1, float high1, float low2, float high2) {
      return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
    }

    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }`),t.fragment.code.add(`\n    float getCloudShape(vec3 pos, float pOffset) {\n      const float textureWidth = float(${r["a"]});\n      const float dataWidth = float(${r["a"]});\n      const float tileRows = float(${r["c"]});\n      const vec3 atlasDimensions = vec3(float(${r["d"]}), float(${r["d"]}), tileRows * tileRows);\n\n      //Change from Y being height to Z being height\n      vec3 p = pos.xzy;\n\n      //Pixel coordinates of point in the 3D data\n      vec3 coord = vec3(mod(p - pOffset * atlasDimensions, atlasDimensions));\n      float f = fract(coord.z);\n      float level = floor(coord.z);\n      float tileY = floor(level / tileRows);\n      float tileX = level - tileY * tileRows;\n\n      //The data coordinates are offset by the x and y tile, the two boundary cells between each tile pair and the initial boundary cell on the first row/column\n      vec2 offset = atlasDimensions.x * vec2(tileX, tileY) + 2.0 * vec2(tileX, tileY) + 1.0;\n      vec2 pixel = coord.xy + offset;\n      vec2 data = texture2D(cloudShapeTexture, mod(pixel, dataWidth) / textureWidth).xy;\n\n      return 1.0 - mix(data.x, data.y, f);\n    }`),t.fragment.code.add("\n    float clouds(vec3 p) {\n      float cloudVariations = getCloudShape(0.002 * p, 0.5);\n\n      float cloud = saturate(0.5 * mix(0.0, 1.0, min(2.0 * coverage, 1.0)));\n      cloud += (cloudVariations * 0.6 - 0.3) * ( -4.0 * (coverage * coverage - coverage));\n      float heightFraction = saturate((length(p) - cloudRadius - cloudStart) / cloudHeight);\n\n      //Round the bottom and top of the clouds\n      cloud *= saturate(remap(heightFraction, 0.0, 0.25, 0.0, 1.0)) * saturate(remap(heightFraction, 0.75, 1.0, 1.0, 0.0));\n\n      float shape = getCloudShape(cloudSize * p, 0.0);\n      shape *= mix(0.0, 1.0, min(2.0 * (1.0 - coverage), 1.0));\n      cloud = saturate(remap(cloud, shape, 1.0, 0.0, 1.0));\n\n      if (cloud <= 0.0) {\n        return 0.0;\n      }\n\n      return density * saturate(remap(cloud, smoothness * getCloudShape(detailSize * p, 0.0), 1.0, 0.0, 1.0));\n    }"),t.fragment.code.add("\n    vec2 sphereIntersections(vec3 start, vec3 dir, float radius) {\n      float a = dot(dir, dir);\n      float b = 2.0 * dot(dir, start);\n      float c = dot(start, start) - (radius * radius);\n      float d = (b * b) - 4.0 * a * c;\n\n      if (d < 0.0) {\n        return vec2(1e5, -1e5);\n      }\n\n      return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));\n    }\n\n    float HenyeyGreenstein(float g, float costh) {\n      return (1.0 / (4.0 * 3.1415))  * ((1.0 - g * g) / pow(1.0 + g * g - 2.0 * g * costh, 1.5));\n    }\n    "),t.fragment.code.add("\n    vec3 multipleOctaves(float extinction, float mu, float stepL) {\n      float attenuation = 1.0;\n      float contribution = 1.0;\n      float phaseAttenuation = 1.0;\n      vec3 luminance = vec3(0);\n\n      for (int i = 0; i < 4; i++) {\n        float phase = mix(HenyeyGreenstein(0.0, mu), HenyeyGreenstein(0.3 * phaseAttenuation, mu), 0.7);\n        luminance += contribution * phase * exp(-stepL * extinction * sigmaE * attenuation);\n        attenuation *= 0.2;\n        contribution *= 0.6;\n        phaseAttenuation *= 0.5;\n      }\n\n      return luminance;\n    }"),t.fragment.code.add("\n    vec3 lightRay(vec3 org, vec3 p, float phaseFunction, float mu, vec3 sunDirection) {\n      float lightRayDensity = clouds(p);\n      lightRayDensity += clouds(p + sunDirection * 1.0 * stepL);\n      lightRayDensity += clouds(p + sunDirection * 2.0 * stepL);\n      lightRayDensity += clouds(p + sunDirection * 3.0 * stepL);\n      lightRayDensity += clouds(p + sunDirection * 4.0 * stepL);\n      lightRayDensity += clouds(p + sunDirection * 5.0 * stepL);\n\n      vec3 beersLaw = multipleOctaves(lightRayDensity, mu, stepL);\n\n      return mix(beersLaw * 2.0 * (1.0 - (exp(-stepL * lightRayDensity * 2.0 * sigmaE ))), beersLaw, 0.5 + 0.5 * mu);\n    }"),t.fragment.code.add('\n    vec3 mainRay(vec3 org, vec3 dir, vec3 sunDirection, float distToStart, float totalDistance, out float totalTransmittance) {\n\n      // This is never true but having the if statement stops later loop unrolling, texture prefetching and WebGL context crashes\n      if (dir.z < 0.0) {\n        return vec3(0);\n      }\n\n      //Variable to track transmittance along view ray. Assume clear sky and attenuate light when encountering clouds.\n      totalTransmittance = 1.0;\n\n      float stepS = totalDistance / float(STEPS);\n      float cameraHeight = length(org);\n\n      //Alignment of view and light directions.\n      float mu = 0.5 + 0.5 * dot(sunDirection, dir);\n      float phaseFunction = mix(HenyeyGreenstein(-0.3, mu), HenyeyGreenstein(0.3, mu), 0.7);\n\n      vec3 p = org + distToStart  * dir;\n      float dist = distToStart;\n      vec3 color = vec3(0.0);\n\n      for (int i = 0; i < STEPS; i++) {\n\n        float sampleDensity = clouds(p);\n        float sampleSigmaE = sampleDensity * sigmaE;\n\n        if (sampleDensity > 0.0 ) {\n          float ambient = mix((1.2), (1.6), saturate((length(p) - cloudRadius - cloudStart) / cloudHeight));\n\n          vec3 luminance = sampleDensity * (ambient + power * phaseFunction * lightRay(org, p, phaseFunction, mu, sunDirection));\n          float transmittance = exp(-sampleSigmaE * stepS);\n\n          //Better energy conserving integration\n          //"From Physically based sky, atmosphere and cloud rendering in Frostbite" 5.6\n          color += totalTransmittance * (luminance - luminance * transmittance) / sampleSigmaE;\n\n          totalTransmittance *= transmittance;\n\n          //If ray combined transmittance is close to 0, nothing beyond this sample point is visible, so break early.\n          if (totalTransmittance <= 0.001) {\n            totalTransmittance = 0.0;\n            break;\n          }\n\n        }\n\n        dist += stepS;\n        p = org + dir * dist;\n      }\n\n      return color;\n    }'),t.fragment.code.add("\n    void main() {\n      vec3 rayDir = rayDirection(gl_FragCoord.xy);\n      rayDir = normalize(viewMatrix * rayDir);\n\n      vec3 viewPos = vec3(0, 0, cloudRadius + 1.0);\n\n      bool hitsPlanet = rayDir.z < 0.0;\n\n      if (hitsPlanet) {\n        gl_FragColor = vec4(vec3(0), 1);\n        return;\n      }\n\n      vec2 rayStartIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart);\n      vec2 rayEndIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart + cloudHeight);\n      float distToStart = rayStartIntersect.y;\n      float totalDistance = rayEndIntersect.y - distToStart;\n\n      float totalTransmittance = 1.0;\n      vec3 sunDirection = normalize(vec3(0, 0, 1));\n      vec3 col = 0.5 * mainRay(viewPos, rayDir, sunDirection, distToStart, totalDistance, totalTransmittance).rgb;\n\n      gl_FragColor = vec4(col, totalTransmittance);\n    }\n  "),t}const o=Object.freeze({__proto__:null,build:s})},"1a2b":function(e,t,i){"use strict";i.d(t,"a",(function(){return g})),i.d(t,"b",(function(){return v})),i.d(t,"c",(function(){return m})),i.d(t,"d",(function(){return b}));var r=i("c120"),n=i("b2b2"),a=(i("7ce4"),i("d267")),s=(i("1956"),i("d17d"),i("9f8b"),i("a1ff")),o=(i("0fa6"),i("ca67")),c=i("c3a4"),l=i("ca98"),d=i("fa1e"),h=i("c829"),u=i("189c");class p extends l["a"]{initializeProgram(e){const t=p.shader.get().build();return new h["a"](e.rctx,t,d["a"])}initializePipeline(){return Object(u["g"])({blending:Object(u["i"])(1,0),depthTest:{func:515},colorWrite:u["d"]})}}p.shader=new c["a"](o["a"],()=>i.e("chunk-2d0d3e55").then(i.bind(null,"5f5c")));var f=i("d5f7");const b=Object(r["a"])("esri-mobile")?64:128,m=Math.ceil(Math.sqrt(b)),g=(b+2)*m;class v{constructor(e,t){this._shapeTextureDescriptor={target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,hasMipmap:!1,width:1,height:1},this._frameBuffer=new a["a"](e,{colorTarget:0}),this._vao=Object(f["d"])(e),this.textureAtlas=new s["a"](e,this._shapeTextureDescriptor,null),this._technique=new p({rctx:e,viewingMode:t.state.viewingMode},null)}destroy(){this._technique=Object(n["s"])(this._technique),this._frameBuffer=Object(n["f"])(this._frameBuffer),this._vao=Object(n["f"])(this._vao),this.textureAtlas=Object(n["f"])(this.textureAtlas)}render(e){if(Object(n["k"])(this._vao)||Object(n["k"])(this.textureAtlas))return!1;this._frameBuffer.resize(g,g),this.textureAtlas.resize(g,g),this._frameBuffer.attachColorTexture(this.textureAtlas),e.bindFramebuffer(this._frameBuffer);const t=this._technique.program;e.bindVAO(this._vao),t.assertCompatibleVertexAttributeLocations(this._vao),this._technique.bindPipelineState(e),e.useProgram(t),t.setUniform1f("tileSize",b),t.setUniform1f("tileRows",m);const i=e.getViewport();return e.setViewport(0,0,g,g),e.gl.drawArrays(e.gl.TRIANGLE_STRIP,0,4),this._frameBuffer.detachColorTexture(),e.setViewport(i.x,i.y,i.width,i.height),!0}}},"1a54":function(e,t,i){"use strict";i.d(t,"a",(function(){return p})),i.d(t,"b",(function(){return b})),i.d(t,"c",(function(){return w})),i.d(t,"d",(function(){return S})),i.d(t,"e",(function(){return _})),i.d(t,"f",(function(){return m})),i.d(t,"g",(function(){return T})),i.d(t,"h",(function(){return f})),i.d(t,"i",(function(){return j})),i.d(t,"j",(function(){return y})),i.d(t,"k",(function(){return x}));var r=i("f0b9"),n=(i("c120"),i("b2b2")),a=i("a21b"),s=i("f2e0"),o=i("5996"),c=i("4261"),l=i("9180"),d=i("008c"),h=i("74e2"),u=i("a1f3");i("3563");class p{constructor(e,t,i){this.uid=e,this.geometry=t,this.attributes=i,this.visible=!0,this.objectId=null,this.centroid=null}}function f(e){return Object(n["l"])(e.geometry)}class b{constructor(){this.exceededTransferLimit=!1,this.features=[],this.fields=[],this.hasM=!1,this.hasZ=!1,this.geometryType=null,this.objectIdFieldName=null,this.globalIdFieldName=null,this.geometryProperties=null,this.geohashFieldName=null,this.spatialReference=null,this.transform=null}}function m(e){const t=h["a"].fromJSON(e.geometryType),i=o["a"].fromJSON(e.spatialReference),r=e.transform,a=e.features.map(a=>{const s=g(a,t,i,e.objectIdFieldName),o=s.geometry;if(Object(n["l"])(o)&&r)switch(o.type){case"point":s.geometry=Object(d["e"])(r,o,o,o.hasZ,o.hasM);break;case"multipoint":s.geometry=Object(d["d"])(r,o,o,o.hasZ,o.hasM);break;case"polygon":s.geometry=Object(d["f"])(r,o,o,o.hasZ,o.hasM);break;case"polyline":s.geometry=Object(d["g"])(r,o,o,o.hasZ,o.hasM);break;case"extent":case"mesh":s.geometry=o}return s});return{geometryType:t,features:a,spatialReference:i,fields:e.fields?e.fields.map(e=>u["a"].fromJSON(e)):null,objectIdFieldName:e.objectIdFieldName,globalIdFieldName:e.globalIdFieldName,geohashFieldName:e.geohashFieldName,geometryProperties:e.geometryProperties,hasZ:e.hasZ,hasM:e.hasM,exceededTransferLimit:e.exceededTransferLimit,transform:null}}function g(e,t,i,r){return{uid:Object(s["b"])(),objectId:r&&e.attributes?e.attributes[r]:null,attributes:e.attributes,geometry:v(e.geometry,t,i),visible:!0}}function v(e,t,i){if(Object(n["k"])(e))return null;switch(t){case"point":{const t=e;return{x:t.x,y:t.y,z:t.z,m:t.m,hasZ:null!=t.z,hasM:null!=t.m,type:"point",spatialReference:i}}case"polyline":{const t=e;return{paths:t.paths,hasZ:!!t.hasZ,hasM:!!t.hasM,type:"polyline",spatialReference:i}}case"polygon":{const t=e;return{rings:t.rings,hasZ:!!t.hasZ,hasM:!!t.hasM,type:"polygon",spatialReference:i}}case"multipoint":{const t=e;return{points:t.points,hasZ:!!t.hasZ,hasM:!!t.hasM,type:"multipoint",spatialReference:i}}}}function y(e,t,i,r){return{x:e,y:t,z:i,hasZ:null!=i,hasM:!1,spatialReference:r,type:"point"}}function O(e){if(Object(n["k"])(e))return 0;let t=32;switch(e.type){case"point":t+=42;break;case"polyline":case"polygon":{let i=0;const r=2+(e.hasZ?1:0)+(e.hasM?1:0),n="polyline"===e.type?e.paths:e.rings;for(const e of n)i+=e.length;t+=8*i*r+64,t+=128*i,t+=34,t+=32*(n.length+1);break}case"multipoint":{const i=2+(e.hasZ?1:0)+(e.hasM?1:0),r=e.points.length;t+=8*r*i+64,t+=128*r,t+=34,t+=32;break}case"extent":t+=98,e.hasM&&(t+=32),e.hasZ&&(t+=32);break;case"mesh":t+=Object(a["a"])(e.vertexAttributes.position),t+=Object(a["a"])(e.vertexAttributes.normal),t+=Object(a["a"])(e.vertexAttributes.uv),t+=Object(a["a"])(e.vertexAttributes.tangent)}return t}function _(e){let t=32;return t+=Object(r["a"])(e.attributes),t+=3,t+=8+O(e.geometry),t}function x(e){if(Object(n["k"])(e))return 0;switch(e.type){case"point":return 1;case"polyline":{let t=0;for(const i of e.paths)t+=i.length;return t}case"polygon":{let t=0;for(const i of e.rings)t+=i.length;return t}case"multipoint":return e.points.length;case"extent":return 2;case"mesh":{const t=e.vertexAttributes&&e.vertexAttributes.position;return t?t.length/3:0}default:return}}function j(e){if(Object(n["k"])(e))return!1;switch(e.type){case"extent":case"point":return!0;case"polyline":for(const t of e.paths)if(t.length>0)return!0;return!1;case"polygon":for(const t of e.rings)if(t.length>0)return!0;return!1;case"multipoint":return e.points.length>0;case"mesh":return!e.loaded||e.vertexAttributes.position.length>0}}function w(e,t){switch(Object(c["k"])(t),"mesh"===e.type&&(e=e.extent),e.type){case"point":t[0]=t[3]=e.x,t[1]=t[4]=e.y,e.hasZ&&(t[2]=t[5]=e.z);break;case"polyline":for(let i=0;i<e.paths.length;i++)Object(c["o"])(t,e.paths[i],e.hasZ);break;case"polygon":for(let i=0;i<e.rings.length;i++)Object(c["o"])(t,e.rings[i],e.hasZ);break;case"multipoint":Object(c["o"])(t,e.points,e.hasZ);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[3]=e.xmax,t[4]=e.ymax,null!=e.zmin&&(t[2]=e.zmin),null!=e.zmax&&(t[5]=e.zmax)}}function S(e,t){switch(Object(l["o"])(t),"mesh"===e.type&&(e=e.extent),e.type){case"point":t[0]=t[2]=e.x,t[1]=t[3]=e.y;break;case"polyline":for(let i=0;i<e.paths.length;i++)Object(l["s"])(t,e.paths[i]);break;case"polygon":for(let i=0;i<e.rings.length;i++)Object(l["s"])(t,e.rings[i]);break;case"multipoint":Object(l["s"])(t,e.points);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[2]=e.xmax,t[3]=e.ymax}}function T(e,t){return null!=e.objectId?e.objectId:e.attributes&&t?e.attributes[t]:null}Object(c["h"])(),Object(l["m"])()},"1a64":function(e,t,i){"use strict";i.d(t,"a",(function(){return X}));var r=i("e92d"),n=i("38bf"),a=i("9ef0"),s=i("b2b2"),o=i("a915"),c=i("74df"),l=i("2e0f"),d=i("0eb9"),h=i("7b96"),u=i("7f60"),p=i("ba58"),f=i("5241"),b=i("a803"),m=i("0278"),g=i("35b3"),v=i("738e"),y=i("fc00"),O=i("d7f7"),_=i("5957"),x=i("a4ee"),j=i("d272"),w=i("17b0"),S=i("d0cb"),T=i("9617"),C=i("8e97"),P=i("c3a4"),A=i("ca98"),M=i("da35"),R=i("fa1e"),E=i("c829"),D=i("7c51"),I=i("a5b5"),F=i("189c");class z extends A["a"]{initializeProgram(e){const t=z.shader.get(),i=this.configuration,r=t.build({occlusionTestEnabled:i.occlusionTestEnabled,verticalOffsetEnabled:i.verticalOffset,screenSizePerspectiveEnabled:i.screenSizePerspective,depthHudEnabled:i.depthHudEnabled,depthHudAlignStartEnabled:i.depthHudAlignStartEnabled,screenCenterOffsetUnitsEnabled:i.screenCenterOffsetUnitsEnabled,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!0,viewingMode:e.viewingMode,isDraped:!1,multipassGeometryEnabled:i.multipassGeometryEnabled});return new E["a"](e.rctx,r,R["a"])}bindPass(e,t){Object(C["c"])(this.program,t.camera.projectionMatrix),I["a"].bindUniforms(this.program,e,t.camera.pixelRatio||1),Object(w["b"])(this.program,e,t),Object(S["b"])(this.program,t),this.program.setUniform2fv("cameraNearFar",t.camera.nearFar),this.program.setUniform2fv("inverseViewport",t.inverseViewport),Object(T["a"])(this.program,t),this.program.bindTexture(t.hudVisibilityTexture,"hudVisibilityTexture"),this.program.setUniform1f("cameraGroundRelative",t.camera.aboveGround?1:-1),this.program.setUniform1f("polygonOffset",e.shaderPolygonOffset),Object(C["f"])(this.program,t),this.program.setUniform1f("perDistancePixelRatio",Math.tan(t.camera.fovY/2)/(t.camera.fullViewport[2]/2)),this.program.setUniformMatrix4fv("viewNormal",t.camera.viewInverseTransposeMatrix),this.program.setUniform2f("pixelToNDC",2/t.camera.fullViewport[2],2/t.camera.fullViewport[3]);const i=t.camera.pixelRatio||1;this.program.setUniform1f("lineSize",Math.ceil(e.size)*i),Object(D["a"])(e.screenSizePerspective,this.program,"screenSizePerspectiveAlignment")}bindDraw(e){Object(C["d"])(this.program,e),Object(C["a"])(this.program,e.origin,e.camera.viewInverseTransposeMatrix),Object(j["c"])(this.program,this.configuration,e),this.program.rebindTextures()}setPipelineState(e){const t=e?519:513;return this.configuration.depthHudEnabled?Object(F["g"])({depthTest:{func:t},depthWrite:F["e"]}):Object(F["g"])({blending:Object(F["h"])(1,770,771,771),depthTest:{func:t},colorWrite:F["d"]})}initializePipeline(){return this.setPipelineState(this.configuration.multipassGeometryEnabled)}}z.shader=new P["a"](I["b"],()=>i.e("chunk-2d0efcae").then(i.bind(null,"9a2b")));class L extends M["a"]{constructor(){super(...arguments),this.occlusionTestEnabled=!0,this.verticalOffset=!1,this.screenSizePerspective=!1,this.depthHudEnabled=!1,this.depthHudAlignStartEnabled=!1,this.screenCenterOffsetUnitsEnabled=0,this.slicePlaneEnabled=!1,this.multipassGeometryEnabled=!1}}Object(x["a"])([Object(M["b"])()],L.prototype,"occlusionTestEnabled",void 0),Object(x["a"])([Object(M["b"])()],L.prototype,"verticalOffset",void 0),Object(x["a"])([Object(M["b"])()],L.prototype,"screenSizePerspective",void 0),Object(x["a"])([Object(M["b"])()],L.prototype,"depthHudEnabled",void 0),Object(x["a"])([Object(M["b"])()],L.prototype,"depthHudAlignStartEnabled",void 0),Object(x["a"])([Object(M["b"])({count:2})],L.prototype,"screenCenterOffsetUnitsEnabled",void 0),Object(x["a"])([Object(M["b"])()],L.prototype,"slicePlaneEnabled",void 0),Object(x["a"])([Object(M["b"])()],L.prototype,"multipassGeometryEnabled",void 0);class V extends g["a"]{constructor(e){super(e,U),this.techniqueConfig=new L,this._uniqueMaterialIdentifier=V.uniqueMaterialIdentifier(this.parameters)}get uniqueMaterialIdentifier(){return this._uniqueMaterialIdentifier}getPassParameters(){return this.parameters}getTechniqueConfig(e,t){const i=18!==(null==t?void 0:t.slot);return this.techniqueConfig.occlusionTestEnabled=this.parameters.occlusionTest,this.techniqueConfig.verticalOffset=!!this.parameters.verticalOffset,this.techniqueConfig.screenSizePerspective=!!this.parameters.screenSizePerspective,this.techniqueConfig.depthHudEnabled=i,this.techniqueConfig.depthHudAlignStartEnabled=!!this.parameters.depthHUDAlignStart,this.techniqueConfig.screenCenterOffsetUnitsEnabled="screen"===this.parameters.centerOffsetUnits?1:0,this.techniqueConfig.slicePlaneEnabled=this.parameters.slicePlaneEnabled,this.techniqueConfig.multipassGeometryEnabled=!!t&&t.multipassGeometryEnabled,this.techniqueConfig}intersect(){}requiresSlot(e){switch(e){case 18:case 19:return!0}return!1}createGLMaterial(e){return 0===e.output?new k(e):null}createBufferWriter(){return new G}validateParameters(e){const t=V.uniqueMaterialIdentifier(e);t!==this._uniqueMaterialIdentifier&&(this._uniqueMaterialIdentifier=t)}static uniqueMaterialIdentifier(e){return JSON.stringify({screenOffset:e.screenOffset||[0,0],centerOffsetUnits:e.centerOffsetUnits||"world"})}}class k extends O["a"]{updateParameters(e){return this.ensureTechnique(z,e)}beginSlot(e){return this.updateParameters(e)}bind(e,t){t.bindPass(this._material.getPassParameters(),e)}}const U={verticalOffset:null,screenSizePerspective:null,screenOffset:[0,0],color:[0,0,0,1],size:1,borderColor:null,occlusionTest:!1,shaderPolygonOffset:1e-5,depthHUDAlignStart:!1,centerOffsetUnits:"world",slicePlaneEnabled:!1,...g["b"]},B=Object(y["a"])().vec3f("position").vec3f("normal").vec2f("uv0").vec4f("auxpos1"),N=[Object(v["b"])(0,0),Object(v["b"])(1,0),Object(v["b"])(0,1),Object(v["b"])(1,0),Object(v["b"])(1,1),Object(v["b"])(0,1)];class G{constructor(){this.vertexBufferLayout=B}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return 6*e.indices.get("position").length}write(e,t,i,r){Object(_["e"])(t.indices.get("position"),t.vertexAttributes.get("position").data,e.transformation,i.position,r,6),Object(_["d"])(t.indices.get("normal"),t.vertexAttributes.get("normal").data,e.invTranspTransformation,i.normal,r,6),Object(_["a"])(t.indices.get("auxpos1"),t.vertexAttributes.get("auxpos1").data,i.auxpos1,r,6);for(let n=0;n<N.length;++n)i.uv0.setVec(r+n,N[n])}}class q extends u["a"]{constructor(e,t){super(e,null,t,Z),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){this._material=new V(this.materialParameters),this._context.stage.add(this._material)}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}perInstanceMaterialParameters(e){const t=this.materialParameters;return t.screenOffset=e.screenOffset||[0,0],t.centerOffsetUnits=e.centerOffsetUnits||"world",t}get materialParameters(){const e=this.symbol,t=e.callout,i=Object(s["l"])(t.color)?a["a"].toUnitRGBA(t.color):[0,0,0,0];i[3]*=this._getLayerOpacity();const r=Object(o["h"])(t.size||0);let n=null;if(e.verticalOffset){const{screenLength:t,minWorldLength:i,maxWorldLength:r}=e.verticalOffset;n={screenLength:Object(o["h"])(t),minWorldLength:i||0,maxWorldLength:null!=r?r:1/0}}const c=Object(s["l"])(t.border)&&Object(s["l"])(t.border.color)?a["a"].toUnitRGBA(t.border.color):null,l="object"===e.symbolLayers.getItemAt(0).type,d=!l,h=l?0:void 0,u="label-3d"===e.type;return{color:i,size:r,verticalOffset:n,screenSizePerspective:this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,screenOffset:[0,0],centerOffsetUnits:"world",borderColor:c,occlusionTest:d,shaderPolygonOffset:h,depthHUDAlignStart:u,slicePlaneEnabled:this._context.slicePlaneEnabled,renderOccluded:g["b"].renderOccluded}}_defaultElevationInfoNoZ(){return $}createGraphics3DGraphic(e){const t=e.renderingInfo,i=e.graphic,r=this.setGraphicElevationContext(i,new d["a"],t.elevationOffset||0),n=t.symbol,a="on-the-ground"===this._elevationContext.mode&&("cim"===n.type||!n.symbolLayers.some(e=>"object"===e.type||"text"===e.type));if("label-3d"!==n.type&&a)return null;const o=Object(p["a"])(i.geometry);return Object(s["k"])(o)?null:this._createAs3DShape(o,r,t,i.uid)}layerOpacityChanged(){return Object(s["k"])(this._material)||this._material.setParameters(this.materialParameters),!0}layerElevationInfoChanged(e,t,i){const r=this._elevationContext.mode,n=Object(l["e"])(q.elevationModeChangeTypes,i,r);return n!==l["b"].UPDATE||e.forEach(e=>{const i=t(e);Object(s["l"])(i)&&this.updateGraphicElevationContext(e.graphic,i)}),n}slicePlaneEnabledChanged(){return Object(s["k"])(this._material)||this._material.setParameters({slicePlaneEnabled:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}setGraphicElevationContext(e,t,i=0){const r=super.setGraphicElevationContext(e,t);return r.addOffsetRenderUnits(i),r}updateGraphicElevationContext(e,t){this.setGraphicElevationContext(e,t.elevationContext,t.metadata.elevationOffset),t.needsElevationUpdates=Object(l["h"])(t.elevationContext.mode)}updateGeometry(e,t){return!1}computeComplexity(){return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:b["e"].memory}}createVertexData(e){const{translation:t,centerOffset:i}=e;return[["position",t?{size:3,data:[t[0],t[1],t[2]],exclusive:!0}:{size:3,data:[0,0,0],exclusive:!0}],["normal",{size:3,data:[0,0,1],exclusive:!0}],["auxpos1",i?{size:4,data:[i[0],i[1],i[2],i[3]],exclusive:!0}:{size:4,data:[0,0,0,1],exclusive:!0}]]}_getOrCreateMaterial(e){const t=this.perInstanceMaterialParameters(e),i=V.uniqueMaterialIdentifier(t);if(Object(s["l"])(this._material)&&i===this._material.uniqueMaterialIdentifier)return{material:this._material,isUnique:!1};if(e.materialCollection){let r=e.materialCollection.get(i);return Object(s["k"])(r)&&(r=new V(t),e.materialCollection.add(i,r)),{material:r,isUnique:!1}}return{material:new V(t),isUnique:!0}}_createAs3DShape(e,t,i,r){const n=[new m["a"](this.createVertexData(i),W,1)],a=this._getOrCreateMaterial(i),s=Object(f["a"])(this._context,e,n,[a.material],t,this._context.layer.uid,r);if(null===s)return null;const o=new h["a"](this,s.object,n,a.isUnique?[a.material]:null,null,c["b"],t);return o.metadata={elevationOffset:i.elevationOffset||0},o.alignedSampledElevation=s.sampledElevation,o.needsElevationUpdates=Object(l["h"])(t.mode),Object(f["b"])(o,e,this._context.elevationProvider),o}}q.elevationModeChangeTypes={definedChanged:l["b"].UPDATE,staysOnTheGround:l["b"].UPDATE,onTheGroundChanged:l["b"].RECREATE};const H=new Uint16Array([0]),W=[["position",H],["normal",H],["auxpos1",H]],$={mode:"relative-to-ground",offset:0},Z={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1},Q=r["a"].getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");function X(e,t){if(!Object(n["d"])(e))return Q.error("Graphics3DCalloutSymbolLayerFactory#make",`symbol of type '${e.type}' does not support callouts`),null;if(!e.callout)return null;const i=Y[e.callout.type];return i?new i(e,t):(Q.error("Graphics3DCalloutSymbolLayerFactory#make","unknown or unsupported callout type "+e.callout.type),null)}const Y={line:q}},"1a9a":function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i("c514");class n{constructor(e,t,i,r,n,a,s,o){this.createQuery=e,this.resultAvailable=t,this.getResult=i,this.disjoint=r,this.beginTimeElapsed=n,this.endTimeElapsed=a,this.createTimestamp=s,this.timestampBits=o}}function a(e,t){if(t.disjointTimerQuery)return null;let i=e.getExtension("EXT_disjoint_timer_query_webgl2");return i&&Object(r["a"])(e)?new n(()=>e.createQuery(),t=>e.getQueryParameter(t,e.QUERY_RESULT_AVAILABLE),t=>e.getQueryParameter(t,e.QUERY_RESULT),()=>e.getParameter(i.GPU_DISJOINT_EXT),t=>e.beginQuery(i.TIME_ELAPSED_EXT,t),()=>e.endQuery(i.TIME_ELAPSED_EXT),e=>i.queryCounterEXT(e,i.TIMESTAMP_EXT),()=>e.getQuery(i.TIMESTAMP_EXT,i.QUERY_COUNTER_BITS_EXT)):(i=e.getExtension("EXT_disjoint_timer_query"),i?new n(()=>i.createQueryEXT(),e=>i.getQueryObjectEXT(e,i.QUERY_RESULT_AVAILABLE_EXT),e=>i.getQueryObjectEXT(e,i.QUERY_RESULT_EXT),()=>e.getParameter(i.GPU_DISJOINT_EXT),e=>i.beginQueryEXT(i.TIME_ELAPSED_EXT,e),()=>i.endQueryEXT(i.TIME_ELAPSED_EXT),e=>i.queryCounterEXT(e,i.TIMESTAMP_EXT),()=>i.getQueryEXT(i.TIMESTAMP_EXT,i.QUERY_COUNTER_BITS_EXT)):null)}},"1af8":function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("3886");function n(e,t){const i=e.vertex;switch(t.mode){case 1:i.code.add(r["a"]`#define discardShortEdges(unpackedAttributes, lineLengthPixels) { if (lineLengthPixels <= 3.0) { gl_Position = vec4(10.0, 10.0, 10.0, 1.0); return; }}`);break;case 2:i.code.add(r["a"]`#define discardShortEdges(unpackedAttributes, lineLengthPixels) { if (unpackedAttributes.type <= 0.0 && lineLengthPixels <= 3.0) { gl_Position = vec4(10.0, 10.0, 10.0, 1.0); return; }}`);break;case 0:i.code.add(r["a"]`#define discardShortEdges(unpackedAttributes, lineLengthPixels) {}`)}}},"1c20":function(e,t,i){"use strict";function r(e,t,i){const r=e.typedBuffer,n=e.typedBufferStride,a=t.typedBuffer,s=t.typedBufferStride,o=i?i.count:t.count;let c=(i&&i.dstIndex?i.dstIndex:0)*n,l=(i&&i.srcIndex?i.srcIndex:0)*s;for(let d=0;d<o;++d)r[c]=a[l],r[c+1]=a[l+1],r[c+2]=a[l+2],r[c+3]=a[l+3],c+=n,l+=s}function n(e,t,i,r,n,a){var s,o;const c=e.typedBuffer,l=e.typedBufferStride,d=null!=(s=null==a?void 0:a.count)?s:e.count;let h=(null!=(o=null==a?void 0:a.dstIndex)?o:0)*l;for(let u=0;u<d;++u)c[h]=t,c[h+1]=i,c[h+2]=r,c[h+3]=n,h+=l}i.d(t,"a",(function(){return r})),i.d(t,"b",(function(){return n}));Object.freeze({__proto__:null,copy:r,fill:n})},"1dc3":function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return h}));var r=i("a4ee"),n=i("ce50"),a=i("59b2"),s=(i("b50f"),i("c120"),i("cea0"),i("d386")),o=i("66af"),c=i("45e3"),l=i("365a");let d=class extends(Object(c["a"])(Object(o["a"])(l["a"]))){constructor(){super(...arguments),this.type="elevation-3d"}initialize(){const e=this.get("view.map.allLayers"),t=e&&e.includes(this.layer),i=this.get("view.map.ground.layers"),r=i&&i.includes(this.layer);if(t&&!r){const e=new n["a"]("layerview:elevation-layer-only","3D elevation layer '"+this.layer.id+"' can only be added in the map ground");this.addResolvingPromise(Promise.reject(e))}this._addTilingSchemeMatchPromise()}};Object(r["a"])([Object(a["b"])({readOnly:!0,aliasOf:"layer.fullExtent"})],d.prototype,"fullExtent",void 0),Object(r["a"])([Object(a["b"])()],d.prototype,"layer",void 0),Object(r["a"])([Object(a["b"])({readOnly:!0,aliasOf:"layer.tileInfo"})],d.prototype,"tileInfo",void 0),d=Object(r["a"])([Object(s["a"])("esri.views.3d.layers.ElevationLayerView3D")],d);const h=d},"1e2c":function(e,t,i){"use strict";i.d(t,"a",(function(){return N}));var r=i("6c97"),n=i("ce50"),a=i("ce6d"),s=i("38a4"),o=i("b2b2"),c=i("f4cc"),l=i("a21b"),d=i("e041"),h=i("2db0"),u=i("228a"),p=i("c15d"),f=i("003f"),b=i("e92d"),m=i("a1ff");const g=b["a"].getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),v=542327876,y=131072,O=4;function _(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}function x(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)}const j=_("DXT1"),w=_("DXT3"),S=_("DXT5"),T=31,C=0,P=1,A=2,M=3,R=4,E=7,D=20,I=21;function F(e,t,i){const{textureData:r,internalFormat:n,width:a,height:s}=z(i,t.hasMipmap);return t.samplingMode=r.levels.length>1?9987:9729,t.hasMipmap=r.levels.length>1,t.internalFormat=n,t.width=a,t.height=s,new m["a"](e,t,r)}function z(e,t){const i=new Int32Array(e,0,T);if(i[C]!==v)return g.error("Invalid magic number in DDS header"),null;if(!(i[D]&O))return g.error("Unsupported format, must contain a FourCC code"),null;const r=i[I];let n,a;switch(r){case j:n=8,a=33776;break;case w:n=16,a=33778;break;case S:n=16,a=33779;break;default:return g.error("Unsupported FourCC code:",x(r)),null}let o=1,c=i[R],l=i[M];0==(3&c)&&0==(3&l)||(g.warn("Rounding up compressed texture size to nearest multiple of 4."),c=c+3&-4,l=l+3&-4);const d=c,h=l;let u,p;i[A]&y&&!1!==t&&(o=Math.max(1,i[E])),1===o||Object(s["k"])(c)&&Object(s["k"])(l)||(g.warn("Ignoring mipmaps of non power of two sized compressed texture."),o=1);let f=i[P]+4;const b=[];for(let s=0;s<o;++s)p=(c+3>>2)*(l+3>>2)*n,u=new Uint8Array(e,f,p),b.push(u),f+=p,c=Math.max(1,c>>1),l=Math.max(1,l>>1);return{textureData:{type:"compressed",levels:b},internalFormat:a,width:d,height:h}}var L=i("d5f7"),V=i("1153"),k=i("d267"),U=i("8539"),B=i("c514");class N extends f["a"]{constructor(e,t){super(),this.data=e,this.type=4,this._glTexture=null,this._powerOfTwoStretchInfo=null,this._loadingPromise=null,this._loadingController=null,this.events=new a["a"],this.params=t||{},this.params.mipmap=!1!==this.params.mipmap,this.params.noUnpackFlip=this.params.noUnpackFlip||!1,this.params.preMultiplyAlpha=this.params.preMultiplyAlpha||!1,this.params.wrap=this.params.wrap||{s:10497,t:10497},this.params.powerOfTwoResizeMode=this.params.powerOfTwoResizeMode||1,this.estimatedTexMemRequired=N.estimateTexMemRequired(this.data,this.params),this.startPreload()}startPreload(){const e=this.data;Object(o["k"])(e)||(e instanceof HTMLVideoElement?this.startPreloadVideoElement(e):e instanceof HTMLImageElement&&this.startPreloadImageElement(e))}startPreloadVideoElement(e){Object(d["t"])(e.src)||"auto"===e.preload&&e.crossOrigin||(e.preload="auto",e.crossOrigin="anonymous",e.src=e.src)}startPreloadImageElement(e){Object(d["u"])(e.src)||Object(d["t"])(e.src)||e.crossOrigin||(e.crossOrigin="anonymous",e.src=e.src)}static getDataDimensions(e){return e instanceof HTMLVideoElement?{width:e.videoWidth,height:e.videoHeight}:e}static estimateTexMemRequired(e,t){if(Object(o["k"])(e))return 0;if(Object(l["c"])(e)||Object(l["k"])(e))return t.encoding===N.KTX2_ENCODING?Object(p["d"])(e,t.mipmap):t.encoding===N.BASIS_ENCODING?Object(p["c"])(e,t.mipmap):e.byteLength;const{width:i,height:r}=e instanceof Image||e instanceof ImageData||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement?N.getDataDimensions(e):t;return(t.mipmap?4/3:1)*i*r*(t.components||4)||0}dispose(){this.data=void 0}get width(){return this.params.width}get height(){return this.params.height}createDescriptor(e){var t;return{target:3553,pixelFormat:6408,dataType:5121,wrapMode:this.params.wrap,flipped:!this.params.noUnpackFlip,samplingMode:this.params.mipmap?9987:9729,hasMipmap:this.params.mipmap,preMultiplyAlpha:this.params.preMultiplyAlpha,maxAnisotropy:null!=(t=this.params.maxAnisotropy)?t:this.params.mipmap?e.parameters.maxMaxAnisotropy:1}}get glTexture(){return this._glTexture}load(e,t){if(Object(o["l"])(this._glTexture))return this._glTexture;if(Object(o["l"])(this._loadingPromise))return this._loadingPromise;const i=this.data;return Object(o["k"])(i)?(this._glTexture=new m["a"](e,this.createDescriptor(e),null),this._glTexture):"string"==typeof i?this.loadFromURL(e,t,i):i instanceof Image?this.loadFromImageElement(e,t,i):i instanceof HTMLVideoElement?this.loadFromVideoElement(e,t,i):i instanceof ImageData||i instanceof HTMLCanvasElement?this.loadFromImage(e,i,t):(Object(l["c"])(i)||Object(l["k"])(i))&&this.params.encoding===N.DDS_ENCODING?this.loadFromDDSData(e,i):(Object(l["c"])(i)||Object(l["k"])(i))&&this.params.encoding===N.KTX2_ENCODING?this.loadFromKTX2(e,i):(Object(l["c"])(i)||Object(l["k"])(i))&&this.params.encoding===N.BASIS_ENCODING?this.loadFromBasis(e,i):Object(l["k"])(i)?this.loadFromPixelData(e,i):Object(l["c"])(i)?this.loadFromPixelData(e,new Uint8Array(i)):null}get requiresFrameUpdates(){return this.data instanceof HTMLVideoElement}frameUpdate(e,t,i){if(!(this.data instanceof HTMLVideoElement)||Object(o["k"])(this._glTexture))return i;if(this.data.readyState<2||i===this.data.currentTime)return i;if(Object(o["l"])(this._powerOfTwoStretchInfo)){const{framebuffer:i,vao:r,sourceTexture:n}=this._powerOfTwoStretchInfo;n.setData(this.data),this.drawStretchedTexture(e,t,i,r,n,this._glTexture)}else{const{width:e,height:t}=this.data,{width:i,height:r}=this._glTexture.descriptor;e!==i||t!==r?this._glTexture.updateData(0,0,0,Math.min(e,i),Math.min(t,r),this.data):this._glTexture.setData(this.data)}return this._glTexture.descriptor.hasMipmap&&this._glTexture.generateMipmap(),this.data.currentTime}loadFromDDSData(e,t){return this._glTexture=F(e,this.createDescriptor(e),t),this._glTexture}loadFromKTX2(e,t){return this.loadAsync(()=>Object(p["b"])(e,this.createDescriptor(e),t).then(e=>(this._glTexture=e,e)))}loadFromBasis(e,t){return this.loadAsync(()=>Object(p["a"])(e,this.createDescriptor(e),t).then(e=>(this._glTexture=e,e)))}loadFromPixelData(e,t){Object(V["a"])(this.params.width>0&&this.params.height>0);const i=this.createDescriptor(e);return i.pixelFormat=1===this.params.components?6409:3===this.params.components?6407:6408,i.width=this.params.width,i.height=this.params.height,this._glTexture=new m["a"](e,i,t),this._glTexture}loadFromURL(e,t,i){return this.loadAsync(async r=>{const n=await Object(h["a"])(i,{signal:r});return this.loadFromImage(e,n,t)})}loadFromImageElement(e,t,i){return i.complete?this.loadFromImage(e,i,t):this.loadAsync(async r=>{const n=await Object(u["a"])(i,i.src,!1,r);return this.loadFromImage(e,n,t)})}loadFromVideoElement(e,t,i){return i.readyState>=2?this.loadFromImage(e,i,t):this.loadFromVideoElementAsync(e,t,i)}loadFromVideoElementAsync(e,t,i){return this.loadAsync(r=>new Promise((a,s)=>{const l=()=>{i.removeEventListener("loadeddata",d),i.removeEventListener("error",h),Object(o["t"])(u)},d=()=>{i.readyState>=2&&(l(),a(this.loadFromImage(e,i,t)))},h=e=>{l(),s(e||new n["a"]("Failed to load video"))};i.addEventListener("loadeddata",d),i.addEventListener("error",h);const u=Object(c["r"])(r,()=>h(Object(c["e"])()))}))}loadFromImage(e,t,i){const r=N.getDataDimensions(t);this.params.width=r.width,this.params.height=r.height;const n=this.createDescriptor(e);return n.pixelFormat=3===this.params.components?6407:6408,!this.requiresPowerOfTwo(e,n)||Object(s["k"])(r.width)&&Object(s["k"])(r.height)?(n.width=r.width,n.height=r.height,this._glTexture=new m["a"](e,n,t),this._glTexture):(this._glTexture=this.makePowerOfTwoTexture(e,t,r,n,i),this._glTexture)}loadAsync(e){const t=new AbortController;this._loadingController=t;const i=e(t.signal);this._loadingPromise=i;const r=()=>{this._loadingController===t&&(this._loadingController=null),this._loadingPromise===i&&(this._loadingPromise=null)};return i.then(r,r),i}requiresPowerOfTwo(e,t){const i=33071,r="number"==typeof t.wrapMode?t.wrapMode===i:t.wrapMode.s===i&&t.wrapMode.t===i;return!Object(B["a"])(e.gl)&&(t.hasMipmap||!r)}makePowerOfTwoTexture(e,t,i,n,a){const{width:o,height:c}=i,l=Object(s["n"])(o),d=Object(s["n"])(c);let h;switch(n.width=l,n.height=d,this.params.powerOfTwoResizeMode){case 2:n.textureCoordinateScaleFactor=[o/l,c/d],h=new m["a"](e,n),h.updateData(0,0,0,o,c,t);break;case 1:case null:case void 0:h=this.stretchToPowerOfTwo(e,t,n,a());break;default:Object(r["a"])(this.params.powerOfTwoResizeMode)}return n.hasMipmap&&h.generateMipmap(),h}stretchToPowerOfTwo(e,t,i,r){const n=new m["a"](e,i),a=new k["a"](e,{colorTarget:0,depthStencilTarget:0},n),s=new m["a"](e,{target:3553,pixelFormat:i.pixelFormat,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!!i.flipped,maxAnisotropy:8,preMultiplyAlpha:i.preMultiplyAlpha},t),o=Object(L["d"])(e),c=e.getBoundFramebufferObject();return this.drawStretchedTexture(e,r,a,o,s,n),this.requiresFrameUpdates?this._powerOfTwoStretchInfo={vao:o,sourceTexture:s,framebuffer:a}:(o.dispose(!0),s.dispose(),a.detachColorTexture(),a.dispose()),e.bindFramebuffer(c),n}drawStretchedTexture(e,t,i,r,n,a){e.bindFramebuffer(i);const s=e.getViewport();e.setViewport(0,0,a.descriptor.width,a.descriptor.height);const o=t.program;e.useProgram(o),o.setUniform4f("color",1,1,1,1),o.bindTexture(n,"tex"),e.bindVAO(r),t.bindPipelineState(e),e.drawArrays(5,0,Object(U["e"])(r,"geometry")),e.bindFramebuffer(null),e.setViewport(s.x,s.y,s.width,s.height)}unload(){if(Object(o["l"])(this._powerOfTwoStretchInfo)){const{framebuffer:e,vao:t,sourceTexture:i}=this._powerOfTwoStretchInfo;t.dispose(!0),i.dispose(),e.dispose(),this._glTexture=null,this._powerOfTwoStretchInfo=null}if(Object(o["l"])(this._glTexture)&&(this._glTexture.dispose(),this._glTexture=null),Object(o["l"])(this._loadingController)){const e=this._loadingController;this._loadingController=null,this._loadingPromise=null,e.abort()}this.events.emit("unloaded")}}N.DDS_ENCODING="image/vnd-ms.dds",N.KTX2_ENCODING="image/ktx2",N.BASIS_ENCODING="image/x.basis"},"1f93":function(e,t,i){"use strict";i.d(t,"a",(function(){return R}));var r=i("b2b2"),n=i("b0ea");class a{constructor(){this.enabled=!0,this._time=0}get time(){return Object(n["a"])(this._time)}advance(e){return Object(r["l"])(e.forcedTime)?this._time!==e.forcedTime&&(this._time=e.forcedTime,!0):!(!this.enabled||0===e.dt)&&(this._time+=e.dt,!0)}}var s=i("b061"),o=i("35b3"),c=i("7438"),l=i("d7f7"),d=i("a4ee"),h=i("d272"),u=i("6a07"),p=i("c6d7"),f=i("d017"),b=i("df77"),m=i("33e2"),g=i("8e97"),v=i("c3a4"),y=i("ca98"),O=i("da35"),_=i("fa1e"),x=i("c829"),j=i("ea44"),w=i("189c");class S extends y["a"]{constructor(e,t,i){super(e,t,i),this._textureRepository=e.waterTextureRepository}initializeProgram(e){const t=S.shader.get(),i=this.configuration,r=t.build({OITEnabled:0===i.transparencyPassType,output:i.output,viewingMode:e.viewingMode,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,receiveShadows:i.receiveShadows,pbrMode:3,useCustomDTRExponentForWater:!0,ssrEnabled:i.useSSR,highStepCount:!0,multipassTerrainEnabled:i.multipassTerrainEnabled,cullAboveGround:i.cullAboveGround});return new x["a"](e.rctx,r,_["a"])}bindPass(e,t){Object(g["c"])(this.program,t.camera.projectionMatrix),t.multipassTerrainEnabled&&(this.program.setUniform2fv("cameraNearFar",t.camera.nearFar),this.program.setUniform2fv("inverseViewport",t.inverseViewport),Object(p["a"])(this.program,t)),0===this.configuration.output&&(t.lighting.setUniforms(this.program,!1),Object(b["b"])(this.program,t)),0!==this.configuration.output&&2!==this.configuration.output||(Object(m["b"])(this.program,e),this._textureRepository.bind(this.program)),this.program.setUniform4fv("waterColor",e.color),4===this.configuration.output&&Object(u["b"])(this.program,t)}bindDraw(e){Object(g["d"])(this.program,e),this.program.rebindTextures(),0!==this.configuration.output&&7!==this.configuration.output||Object(g["a"])(this.program,e.origin,e.camera.viewInverseTransposeMatrix),0===this.configuration.output&&Object(f["b"])(this.program,e),0!==this.configuration.output&&7!==this.configuration.output&&4!==this.configuration.output||Object(h["c"])(this.program,this.configuration,e)}setPipelineState(e){const t=this.configuration,i=3===e,r=2===e;return Object(w["g"])({blending:2!==t.output&&4!==t.output&&t.transparent?i?c["g"]:Object(c["a"])(e):null,depthTest:{func:Object(c["b"])(e)},depthWrite:i?t.writeDepth&&w["e"]:Object(c["c"])(e),colorWrite:w["d"],polygonOffset:i||r?null:Object(c["h"])(t.enableOffset)})}initializePipeline(){return this.setPipelineState(this.configuration.transparencyPassType)}}S.shader=new v["a"](j["a"],()=>i.e("chunk-2d0a5169").then(i.bind(null,"08e0")));class T extends O["a"]{constructor(){super(...arguments),this.output=0,this.receiveShadows=!1,this.slicePlaneEnabled=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!1,this.useSSR=!1,this.isDraped=!1,this.transparencyPassType=3,this.multipassTerrainEnabled=!1,this.cullAboveGround=!1}}Object(d["a"])([Object(O["b"])({count:8})],T.prototype,"output",void 0),Object(d["a"])([Object(O["b"])()],T.prototype,"receiveShadows",void 0),Object(d["a"])([Object(O["b"])()],T.prototype,"slicePlaneEnabled",void 0),Object(d["a"])([Object(O["b"])()],T.prototype,"transparent",void 0),Object(d["a"])([Object(O["b"])()],T.prototype,"enableOffset",void 0),Object(d["a"])([Object(O["b"])()],T.prototype,"writeDepth",void 0),Object(d["a"])([Object(O["b"])()],T.prototype,"useSSR",void 0),Object(d["a"])([Object(O["b"])()],T.prototype,"isDraped",void 0),Object(d["a"])([Object(O["b"])({count:4})],T.prototype,"transparencyPassType",void 0),Object(d["a"])([Object(O["b"])()],T.prototype,"multipassTerrainEnabled",void 0),Object(d["a"])([Object(O["b"])()],T.prototype,"cullAboveGround",void 0);class C extends l["a"]{updateParameters(e){return this.ensureTechnique(S,e)}setElapsedTimeUniform(e){const t=.001*this._material.animation.time;e.setUniform1f("timeElapsed",t*this._material.parameters.animationSpeed)}_updateShadowState(e){e.shadowMappingEnabled!==this._material.parameters.receiveShadows&&this._material.setParameters({receiveShadows:e.shadowMappingEnabled})}_updateSSRState(e){e.ssrEnabled!==this._material.parameters.ssrEnabled&&this._material.setParameters({ssrEnabled:e.ssrEnabled})}ensureResources(e){const t=this._techniqueRep.constructionContext.waterTextureRepository;return t.ready||t.updating||t.loadTextures(e),t.ready?2:1}beginSlot(e){return 0===this._output&&(this._updateShadowState(e),this._updateSSRState(e)),this.updateParameters(e)}bind(e,t){t.bindPass(this._material.parameters,e),2!==this._output&&0!==this._output||this.setElapsedTimeUniform(t.program)}}var P=i("8675"),A=i("7c51"),M=i("b855");class R extends o["a"]{constructor(e){super(e,M["a"]),this._techniqueConfig=new T,this.animation=new a}getTechniqueConfig(e,t){return this._techniqueConfig.output=e,this._techniqueConfig.writeDepth=this.parameters.writeDepth,this._techniqueConfig.receiveShadows=this.parameters.receiveShadows,this._techniqueConfig.slicePlaneEnabled=this.parameters.slicePlaneEnabled,this._techniqueConfig.transparent=this.parameters.transparent,this._techniqueConfig.useSSR=this.parameters.ssrEnabled,this._techniqueConfig.isDraped=this.parameters.isDraped,this._techniqueConfig.transparencyPassType=t.transparencyPassType,this._techniqueConfig.enableOffset=t.camera.relativeElevation<c["e"],this._techniqueConfig.multipassTerrainEnabled=t.multipassTerrainEnabled,this._techniqueConfig.cullAboveGround=t.cullAboveGround,this._techniqueConfig}update(e){const t=Math.min(e.camera.relativeElevation,e.camera.distance);this.animation.enabled=Math.sqrt(this.parameters.waveTextureRepeat/this.parameters.waveStrength)*t<E;const i=this.animation.advance(e);return this.animation.enabled&&i}intersect(e,t,i,r,n,a,s){Object(A["i"])(e,t,r,n,a,void 0,s)}requiresSlot(e,t){switch(Object(s["b"])(t)){case 2:return 21===e;case 0:if(this.parameters.isDraped)return 20===e;break;case 4:return 2===e||20===e}let i=2;return this.parameters.transparent&&(i=this.parameters.writeDepth?4:7),e===i}createGLMaterial(e){if(0===e.output&&this.parameters.isDraped)return e.output=5,new C(e);switch(e.output){case 0:case 2:case 4:case 7:return new C(e)}return null}createBufferWriter(){return new P["a"](P["d"])}}const E=35e3},2119:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("2ab7");class n{constructor(e){this.allocator=e,this._items=[],this._itemsPtr=0,this.grow()}get(){return 0===this._itemsPtr&&Object(r["a"])(()=>this.reset()),this._itemsPtr===this._items.length&&this.grow(),this._items[this._itemsPtr++]}reset(){const e=Math.min(3*Math.max(8,this._itemsPtr),this._itemsPtr+3*a);this._items.length=Math.min(e,this._items.length),this._itemsPtr=0}grow(){for(let e=0;e<Math.max(8,Math.min(this._items.length,a));e++)this._items.push(this.allocator())}}const a=1024},"21ed":function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("3886");function n(e,t){const i=e.vertex;switch(i.code.add(r["a"]`#define VERTEX_DISCARD_CUTOFF (1.0 - 1.0 / 255.0)`),t.vertexDiscardMode){case 0:i.code.add(r["a"]`#define vertexDiscardByOpacity(_opacity_) {}`);break;case 2:i.code.add(r["a"]`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ >  VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);break;case 1:i.code.add(r["a"]`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ <= VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`)}}},2245:function(e,t,i){"use strict";i.d(t,"a",(function(){return w}));var r=i("e431"),n=i("0b2d"),a=i("2bc9"),s=i("38a4");function o(e,t,i){(i=i||e).length=e.length;for(let r=0;r<e.length;r++)i[r]=e[r]*t[r];return i}function c(e,t,i){(i=i||e).length=e.length;for(let r=0;r<e.length;r++)i[r]=e[r]*t;return i}function l(e,t,i){(i=i||e).length=e.length;for(let r=0;r<e.length;r++)i[r]=e[r]+t[r];return i}function d(e){return(e+1)*(e+1)}function h(e){return Object(s["f"])(Math.floor(Math.sqrt(e)-1),0,2)}function u(e,t,i){const r=e[0],n=e[1],a=e[2],s=i||[];return s.length=d(t),t>=0&&(s[0]=.28209479177),t>=1&&(s[1]=.4886025119*r,s[2]=.4886025119*a,s[3]=.4886025119*n),t>=2&&(s[4]=1.09254843059*r*n,s[5]=1.09254843059*n*a,s[6]=.31539156525*(3*a*a-1),s[7]=1.09254843059*r*a,s[8]=.54627421529*(r*r-n*n)),s}function p(e,t){const i=d(e),r=t||{r:[],g:[],b:[]};r.r.length=r.g.length=r.b.length=i;for(let n=0;n<i;n++)r.r[n]=r.g[n]=r.b[n]=0;return r}function f(e,t){const i=h(t.r.length);for(const n of e)Object(r["v"])(x,n.direction),u(x,i,O),o(O,j),c(O,n.intensity[0],_),l(t.r,_),c(O,n.intensity[1],_),l(t.g,_),c(O,n.intensity[2],_),l(t.b,_);return t}function b(e,t){u(x,0,O);for(const i of e)t.r[0]+=O[0]*j[0]*i.intensity[0]*4*Math.PI,t.g[0]+=O[0]*j[0]*i.intensity[1]*4*Math.PI,t.b[0]+=O[0]*j[0]*i.intensity[2]*4*Math.PI;return t}function m(e,t,i,n){p(t,n),Object(r["z"])(i.intensity,0,0,0);let s=!1;const o=g,c=v,d=y;o.length=0,c.length=0,d.length=0;for(const l of e)l instanceof a["c"]&&!s?(Object(r["n"])(i.direction,l.direction),i.intensity[0]=l.intensity[0],i.intensity[1]=l.intensity[1],i.intensity[2]=l.intensity[2],i.castShadows=l.castShadows,s=!0):l instanceof a["c"]||l instanceof a["b"]?o.push(l):l instanceof a["a"]?c.push(l):l instanceof a["d"]&&d.push(l);f(o,n),b(c,n);for(const r of d)l(n.r,r.r),l(n.g,r.g),l(n.b,r.b)}const g=[],v=[],y=[],O=[0],_=[0],x=Object(n["f"])(),j=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398];class w{constructor(){this._shOrder=2,this._ambientBoost=.4,this._oldSunlight={direction:Object(n["f"])(),ambient:{color:Object(n["f"])(),intensity:1},diffuse:{color:Object(n["f"])(),intensity:1}},this.globalFactor=.5,this.groundLightingFactor=.5,this._sphericalHarmonics=new a["d"],this._mainLight={intensity:Object(n["f"])(),direction:Object(n["h"])(1,0,0),castShadows:!1}}get lightingMainDirection(){return this._mainLight.direction}setLightDirectionUniform(e){e.setUniform3fv("lightingMainDirection",this._mainLight.direction)}setUniforms(e,t=!1){const i=t?(1-this.groundLightingFactor)*(1-this.globalFactor):0;e.setUniform1f("lightingFixedFactor",i),e.setUniform1f("lightingGlobalFactor",this.globalFactor),this.setLightDirectionUniform(e),e.setUniform3fv("lightingMainIntensity",this._mainLight.intensity),e.setUniform1f("ambientBoostFactor",this._ambientBoost);const r=this._sphericalHarmonics;0===this._shOrder?e.setUniform3f("lightingAmbientSH0",r.r[0],r.g[0],r.b[0]):1===this._shOrder?(e.setUniform4f("lightingAmbientSH_R",r.r[0],r.r[1],r.r[2],r.r[3]),e.setUniform4f("lightingAmbientSH_G",r.g[0],r.g[1],r.g[2],r.g[3]),e.setUniform4f("lightingAmbientSH_B",r.b[0],r.b[1],r.b[2],r.b[3])):2===this._shOrder&&(e.setUniform3f("lightingAmbientSH0",r.r[0],r.g[0],r.b[0]),e.setUniform4f("lightingAmbientSH_R1",r.r[1],r.r[2],r.r[3],r.r[4]),e.setUniform4f("lightingAmbientSH_G1",r.g[1],r.g[2],r.g[3],r.g[4]),e.setUniform4f("lightingAmbientSH_B1",r.b[1],r.b[2],r.b[3],r.b[4]),e.setUniform4f("lightingAmbientSH_R2",r.r[5],r.r[6],r.r[7],r.r[8]),e.setUniform4f("lightingAmbientSH_G2",r.g[5],r.g[6],r.g[7],r.g[8]),e.setUniform4f("lightingAmbientSH_B2",r.b[5],r.b[6],r.b[7],r.b[8]))}set(e){m(e,this._shOrder,this._mainLight,this._sphericalHarmonics),Object(r["n"])(this._oldSunlight.direction,this._mainLight.direction);const t=1/Math.PI;this._oldSunlight.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*t,this._oldSunlight.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*t,this._oldSunlight.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*t,Object(r["h"])(this._oldSunlight.diffuse.color,this._mainLight.intensity,t),Object(r["n"])(S,this._oldSunlight.diffuse.color),Object(r["h"])(S,S,this._ambientBoost*this.globalFactor),Object(r["i"])(this._oldSunlight.ambient.color,this._oldSunlight.ambient.color,S)}get old(){return this._oldSunlight}}const S=Object(n["f"])()},2258:function(e,t,i){"use strict";function r(e,t,i){const r=t.flatten(({sublayers:e})=>e).length;return r!==e.length||(!!e.some(e=>e.originIdOf("minScale")>i||e.originIdOf("maxScale")>i||e.originIdOf("renderer")>i||e.originIdOf("labelingInfo")>i||e.originIdOf("opacity")>i||e.originIdOf("labelsVisible")>i||e.originIdOf("source")>i)||!a(e,t))}function n(e,t,i){return!!e.some(e=>{const t=e.source;return!(!t||"map-layer"===t.type&&t.mapLayerId===e.id&&(!t.gdbVersion||t.gdbVersion===i.gdbVersion))||e.originIdOf("renderer")>2||e.originIdOf("labelingInfo")>2||e.originIdOf("opacity")>2||e.originIdOf("labelsVisible")>2})||!a(e,t)}function a(e,t){if(!e||!e.length)return!0;const i=t.slice().reverse().flatten(({sublayers:e})=>e&&e.toArray().reverse()).map(e=>e.id).toArray();if(e.length>i.length)return!1;let r=0;const n=i.length;for(const{id:a}of e){for(;r<n&&i[r]!==a;)r++;if(r>=n)return!1}return!0}function s(e){return!!e&&e.some(e=>null!=e.minScale||e.layerDefinition&&null!=e.layerDefinition.minScale)}i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return s})),i.d(t,"c",(function(){return r}))},2273:function(e,t,i){"use strict";i.r(t),i.d(t,"work",(function(){return w})),i.d(t,"wrappedWork",(function(){return j}));var r=i("8c4b");function n(e,t,i){const r=t/3,n=new Uint32Array(i+1),a=new Uint32Array(i+1),s=(e,t)=>{e<t?n[e+1]++:a[t+1]++};for(let g=0;g<r;g++){const t=e[3*g],i=e[3*g+1],r=e[3*g+2];s(t,i),s(i,r),s(r,t)}let o=0,c=0;for(let g=0;g<i;g++){const e=n[g+1],t=a[g+1];n[g+1]=o,a[g+1]=c,o+=e,c+=t}const l=new Uint32Array(6*r),d=n[i],h=(e,t,i)=>{if(e<t){const r=n[e+1]++;l[2*r]=t,l[2*r+1]=i}else{const r=a[t+1]++;l[2*d+2*r]=e,l[2*d+2*r+1]=i}};for(let g=0;g<r;g++){const t=e[3*g],i=e[3*g+1],r=e[3*g+2];h(t,i,g),h(i,r,g),h(r,t,g)}const u=(e,t)=>{const i=2*e,r=t-e;for(let n=1;n<r;n++){const e=l[i+2*n],t=l[i+2*n+1];let r=n-1;for(;r>=0&&l[i+2*r]>e;r--)l[i+2*r+2]=l[i+2*r],l[i+2*r+3]=l[i+2*r+1];l[i+2*r+2]=e,l[i+2*r+3]=t}};for(let g=0;g<i;g++)u(n[g],n[g+1]),u(d+a[g],d+a[g+1]);const p=new Int32Array(3*r),f=(t,i)=>t===e[3*i]?0:t===e[3*i+1]?1:t===e[3*i+2]?2:-1,b=(e,t)=>{const i=f(e,t);p[3*t+i]=-1},m=(e,t,i,r)=>{const n=f(e,t);p[3*t+n]=r;const a=f(i,r);p[3*r+a]=t};for(let g=0;g<i;g++){let e=n[g];const t=n[g+1];let i=a[g];const r=a[g+1];for(;e<t&&i<r;){const t=l[2*e],r=l[2*d+2*i];t===r?(m(g,l[2*e+1],r,l[2*d+2*i+1]),e++,i++):t<r?(b(g,l[2*e+1]),e++):(b(r,l[2*d+2*i+1]),i++)}for(;e<t;)b(g,l[2*e+1]),e++;for(;i<r;)b(l[2*d+2*i],l[2*d+2*i+1]),i++}return p}var a=i("0480"),s=i("0c9d"),o=i("7e0c"),c=i("b50f"),l=i("38a4"),d=i("a21b"),h=i("e431"),u=i("0b2d");const p=-1;function f(e,t,i,r=x){const n=e.vertices.position,a=e.vertices.componentIndex,s=Object(l["h"])(r.anglePlanar),o=Object(l["h"])(r.angleSignificantEdge),u=Math.cos(o),f=Math.cos(s),_=O.edge,j=_.position0,w=_.position1,S=_.faceNormal0,T=_.faceNormal1,C=y(e),P=v(e),A=P.length/4,M=t.allocate(A);let R=0;const E=A,D=i.allocate(E);let I=0,F=0,z=0;const L=Object(c["i"])(0,A),V=new Float32Array(A);Object(d["b"])(V,(e,t,i)=>{n.getVec(P[4*t+0],j),n.getVec(P[4*t+1],w),i[t]=Object(h["p"])(j,w)}),L.sort((e,t)=>V[t]-V[e]);const k=new Array,U=new Array;for(let c=0;c<A;c++){const e=L[c],r=V[e],o=P[4*e+0],l=P[4*e+1],d=P[4*e+2],v=P[4*e+3],y=v===p;if(n.getVec(o,j),n.getVec(l,w),y)Object(h["z"])(S,C[3*d+0],C[3*d+1],C[3*d+2]),Object(h["n"])(T,S),_.componentIndex=a.get(o),_.cosAngle=Object(h["k"])(S,T);else{if(Object(h["z"])(S,C[3*d+0],C[3*d+1],C[3*d+2]),Object(h["z"])(T,C[3*v+0],C[3*v+1],C[3*v+2]),_.componentIndex=a.get(o),_.cosAngle=Object(h["k"])(S,T),m(_,f))continue;_.cosAngle<-.9999&&Object(h["n"])(T,S)}F+=r,z++,y||b(_,u)?(t.write(M,R++,_),k.push(r)):g(_,s)&&(i.write(D,I++,_),U.push(r))}const B=new Float32Array(k.reverse()),N=new Float32Array(U.reverse());return{regular:{instancesData:t.trim(M,R),lodInfo:{lengths:B}},silhouette:{instancesData:i.trim(D,I),lodInfo:{lengths:N}},averageEdgeLength:F/z}}function b(e,t){return e.cosAngle<t}function m(e,t){return e.cosAngle>t}function g(e,t){const i=Object(l["b"])(e.cosAngle),r=O.fwd,n=O.ortho;return Object(h["y"])(r,e.position1,e.position0),i*(Object(h["k"])(Object(h["j"])(n,e.faceNormal0,e.faceNormal1),r)>0?-1:1)>t}function v(e){const t=e.faces.length/3,i=e.faces,r=e.neighbors;let n=0;for(let o=0;o<t;o++){const e=r[3*o+0],t=r[3*o+1],a=r[3*o+2],s=i[3*o+0],c=i[3*o+1],l=i[3*o+2];n+=e===p||s<c?1:0,n+=t===p||c<l?1:0,n+=a===p||l<s?1:0}const a=new Int32Array(4*n);let s=0;for(let o=0;o<t;o++){const e=r[3*o+0],t=r[3*o+1],n=r[3*o+2],c=i[3*o+0],l=i[3*o+1],d=i[3*o+2];(e===p||c<l)&&(a[s++]=c,a[s++]=l,a[s++]=o,a[s++]=e),(t===p||l<d)&&(a[s++]=l,a[s++]=d,a[s++]=o,a[s++]=t),(n===p||d<c)&&(a[s++]=d,a[s++]=c,a[s++]=o,a[s++]=n)}return a}function y(e){const t=e.faces.length/3,i=e.vertices.position,r=e.faces,n=_.v0,a=_.v1,s=_.v2,o=new Float32Array(3*t);for(let c=0;c<t;c++){const e=r[3*c+0],t=r[3*c+1],l=r[3*c+2];i.getVec(e,n),i.getVec(t,a),i.getVec(l,s),Object(h["m"])(a,a,n),Object(h["m"])(s,s,n),Object(h["j"])(n,a,s),Object(h["u"])(n,n),o[3*c+0]=n[0],o[3*c+1]=n[1],o[3*c+2]=n[2]}return o}const O={edge:{position0:Object(u["f"])(),position1:Object(u["f"])(),faceNormal0:Object(u["f"])(),faceNormal1:Object(u["f"])(),componentIndex:0,cosAngle:0},ortho:Object(u["f"])(),fwd:Object(u["f"])()},_={v0:Object(u["f"])(),v1:Object(u["f"])(),v2:Object(u["f"])()},x={anglePlanar:4,angleSignificantEdge:35};async function j(e){const t=S(e),i=w(t),r=[t.data.buffer];return{result:T(i,r),transferList:r}}function w(e){const t=C(e.data,e.skipDeduplicate,e.indices,e.indicesLength);return P.updateSettings(e.writerSettings),A.updateSettings(e.writerSettings),f(t,P,A)}function S(e){return{data:s["a"].createView(e.dataBuffer),indices:"Uint32Array"===e.indicesType?new Uint32Array(e.indicesBuffer):"Uint16Array"===e.indicesType?new Uint16Array(e.indicesBuffer):void 0,indicesLength:e.indicesLength,writerSettings:e.writerSettings,skipDeduplicate:e.skipDeduplicate}}function T(e,t){return t.push(e.regular.lodInfo.lengths.buffer),t.push(e.silhouette.lodInfo.lengths.buffer),{regular:{instancesData:Object(a["a"])(e.regular.instancesData,t),lodInfo:{lengths:e.regular.lodInfo.lengths.buffer}},silhouette:{instancesData:Object(a["a"])(e.silhouette.instancesData,t),lodInfo:{lengths:e.silhouette.lodInfo.lengths.buffer}},averageEdgeLength:e.averageEdgeLength}}function C(e,t,i,a){if(t)return{faces:i,facesLength:a,neighbors:n(i,a,e.count),vertices:e};const o=Object(r["a"])(e.buffer,e.stride/4,{originalIndices:i,originalIndicesLength:a}),c=n(o.indices,a,o.uniqueCount);return{faces:o.indices,facesLength:o.indices.length,neighbors:c,vertices:s["a"].createView(o.buffer)}}const P=new o["a"],A=new o["b"]},"22f5":function(e,t,i){"use strict";i.d(t,"a",(function(){return g})),i.d(t,"b",(function(){return x}));var r=i("2eab"),n=i("792b"),a=i("ce50"),s=i("e92d"),o=i("b2b2"),c=i("f4cc"),l=i("549a"),d=i("0b2d"),h=i("4261"),u=i("2db0"),p=i("0278"),f=i("1e2c"),b=i("dbad");const m=s["a"].getLogger("esri.views.3d.layers.graphics.objectResourceUtils");async function g(e,t){const i=await v(e,t);return{resource:i,textures:await w(i.textureDefinitions,t)}}async function v(e,t){const i=Object(o["l"])(t)&&t.streamDataRequester;if(i)return y(e,i,t);const a=await Object(n["d"])(Object(r["default"])(e,Object(o["u"])(t)));if(!0===a.ok)return a.value.data;Object(c["v"])(a.error),O(a.error)}async function y(e,t,i){const r=await Object(n["d"])(t.request(e,"json",i));if(!0===r.ok)return r.value;Object(c["v"])(r.error),O(r.error.details.url)}function O(e){throw new a["a"]("","Request for object resource failed: "+e)}function _(e){const t=e.params,i=t.topology;let r=!0;switch(t.vertexAttributes||(m.warn("Geometry must specify vertex attributes"),r=!1),t.topology){case"PerAttributeArray":break;case"Indexed":case null:case void 0:{const e=t.faces;if(e){if(t.vertexAttributes)for(const i in t.vertexAttributes){const t=e[i];t&&t.values?(null!=t.valueType&&"UInt32"!==t.valueType&&(m.warn(`Unsupported indexed geometry indices type '${t.valueType}', only UInt32 is currently supported`),r=!1),null!=t.valuesPerElement&&1!==t.valuesPerElement&&(m.warn(`Unsupported indexed geometry values per element '${t.valuesPerElement}', only 1 is currently supported`),r=!1)):(m.warn(`Indexed geometry does not specify face indices for '${i}' attribute`),r=!1)}}else m.warn("Indexed geometries must specify faces"),r=!1;break}default:m.warn(`Unsupported topology '${i}'`),r=!1}e.params.material||(m.warn("Geometry requires material"),r=!1);const n=e.params.vertexAttributes;for(const a in n)n[a].values||(m.warn("Geometries with externally defined attributes are not yet supported"),r=!1);return r}function x(e,t){const i=[],r=[],n=[],a=[],s=e.resource,c=l["a"].parse(s.version||"1.0","wosr");C.validate(c);const h=s.model.name,u=s.model.geometries,m=s.materialDefinitions,g=e.textures;let v=0;const y=new Map;for(let l=0;l<u.length;l++){const e=u[l];if(!_(e))continue;const s=T(e),c=e.params.vertexAttributes,h=[];for(const t in c){const e=c[t],i=e.values;h.push([t,{data:i,size:e.valuesPerElement,exclusive:!0}])}const O=[];if("PerAttributeArray"!==e.params.topology){const t=e.params.faces;for(const e in t)O.push([e,new Uint32Array(t[e].values)])}const x=g&&g[s.texture];if(x&&!y.has(s.texture)){const{image:e,params:t}=x,i=new f["a"](e,t);a.push(i),y.set(s.texture,i)}const j=y.get(s.texture),w=j?j.id:void 0;let C=n[s.material]?n[s.material][s.texture]:null;if(!C){const e=m[s.material.substring(s.material.lastIndexOf("/")+1)].params;1===e.transparency&&(e.transparency=0);const i=x&&x.alphaChannelUsage,r=e.transparency>0||"transparency"===i||"maskAndTransparency"===i,a=x?S(x.alphaChannelUsage):void 0,c={ambient:Object(d["g"])(e.diffuse),diffuse:Object(d["g"])(e.diffuse),opacity:1-(e.transparency||0),transparent:r,textureAlphaMode:a,textureAlphaCutoff:.33,textureId:w,initTextureTransparent:!0,doubleSided:!0,cullFace:0,colorMixMode:e.externalColorMixMode||"tint",textureAlphaPremultiplied:!!x&&!!x.params.preMultiplyAlpha};Object(o["l"])(t)&&t.materialParamsMixin&&Object.assign(c,t.materialParamsMixin),C=new b["a"](c),n[s.material]||(n[s.material]={}),n[s.material][s.texture]=C}r.push(C);const P=new p["a"](h,O);v+=O.position?O.position.length:0,i.push(P)}return{name:h,stageResources:{textures:a,materials:r,geometries:i},pivotOffset:s.model.pivotOffset,boundingBox:j(i),numberOfVertices:v,lodThreshold:null}}function j(e){const t=Object(h["k"])();return e.forEach(e=>{const i=e.boundingInfo;Object(o["l"])(i)&&(Object(h["r"])(t,i.getBBMin()),Object(h["r"])(t,i.getBBMax()))}),t}async function w(e,t){const i=[];for(const a in e){const r=e[a],n=r.images[0].data;if(!n){m.warn("Externally referenced texture data is not yet supported");continue}const s=r.encoding+";base64,"+n,c="/textureDefinitions/"+a,l="rgba"===r.channels?r.alphaChannelUsage||"transparency":"none",d={noUnpackFlip:!0,wrap:{s:10497,t:10497},preMultiplyAlpha:1!==S(l)},h=Object(o["l"])(t)&&t.disableTextures?Promise.resolve(null):Object(u["a"])(s,t);i.push(h.then(e=>({refId:c,image:e,params:d,alphaChannelUsage:l})))}const r=await Promise.all(i),n={};for(const a of r)n[a.refId]=a;return n}function S(e){switch(e){case"mask":return 2;case"maskAndTransparency":return 3;case"none":return 1;default:return 0}}function T(e){const t=e.params;return{id:1,material:t.material,texture:t.texture,region:t.texture}}const C=new l["a"](1,2,"wosr")},2650:function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return I}));var r=i("a4ee"),n=(i("e06a"),i("2eab")),a=i("ce50"),s=i("9096"),o=i("b2b2"),c=i("e694"),l=i("f4cc"),d=i("e041"),h=i("59b2"),u=(i("b50f"),i("c120"),i("1a3e")),p=i("afcf"),f=i("d386"),b=i("09db"),m=i("a6a3"),g=i("f46e"),v=i("b485"),y=i("303f"),O=i("3d59"),_=i("997b"),x=i("8b28"),j=i("b911"),w=i("0db5"),S=i("8e17"),T=i("5a62"),C=i("d409"),P=i("54b4"),A=i("22f4"),M=i("e9d0"),R=i("5996");const E=["Canvas/World_Dark_Gray_Base","Canvas/World_Dark_Gray_Reference","Canvas/World_Light_Gray_Base","Canvas/World_Light_Gray_Reference","Elevation/World_Hillshade","Elevation/World_Hillshade_Dark","Ocean/World_Ocean_Base","Ocean/World_Ocean_Reference","Ocean_Basemap","Reference/World_Boundaries_and_Places","Reference/World_Boundaries_and_Places_Alternate","Reference/World_Transportation","World_Imagery","World_Street_Map","World_Topo_Map"];let D=class extends(Object(_["a"])(Object(C["a"])(Object(T["a"])(Object(j["a"])(Object(w["a"])(Object(v["a"])(Object(y["a"])(Object(O["a"])(Object(c["a"])(Object(s["b"])(Object(S["a"])(Object(g["a"])(Object(x["a"])(m["a"])))))))))))))){constructor(...e){super(...e),this.listMode="show",this.isReference=null,this.operationalLayerType="ArcGISTiledMapServiceLayer",this.resampling=!0,this.sourceJSON=null,this.spatialReference=null,this.path=null,this.sublayers=null,this.type="tile",this.url=null}normalizeCtorArgs(e,t){return"string"==typeof e?{url:e,...t}:e}load(e){const t=Object(o["l"])(e)?e.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Map Service"]},e).catch(l["v"]).then(()=>this._fetchService(t))),Promise.resolve(this)}get attributionDataUrl(){var e;const t=null==(e=this.parsedUrl)?void 0:e.path.toLowerCase();return t&&this._getDefaultAttribution(this._getMapName(t))}readSpatialReference(e,t){return(e=e||t.tileInfo&&t.tileInfo.spatialReference)&&R["a"].fromJSON(e)}writeSublayers(e,t,i,r){if(!this.loaded||!e)return;const n=e.slice().reverse().flatten(({sublayers:e})=>e&&e.toArray().reverse()).toArray(),a=[],s={writeSublayerStructure:!1,...r};n.forEach(e=>{const t=e.write({},s);a.push(t)}),a.some(e=>Object.keys(e).length>1)&&(t.layers=a)}get tileServers(){return this._getDefaultTileServers(this.parsedUrl.path)}castTileServers(e){return Array.isArray(e)?e.map(e=>Object(d["K"])(e).path):null}fetchTile(e,t,i,r={}){const{signal:a}=r,s=this.getTileUrl(e,t,i),o={responseType:"image",signal:a,query:{...this.refreshParameters}};return Object(n["default"])(s,o).then(e=>e.data)}getTileUrl(e,t,i){const r=!this.tilemapCache&&this.supportsBlankTile,n=Object(d["E"])({...this.parsedUrl.query,blankTile:!r&&null,...this.customParameters,token:this.apiKey}),a=this.tileServers;return`${a&&a.length?a[t%a.length]:this.parsedUrl.path}/tile/${e}/${t}/${i}${n?"?"+n:""}`}_fetchService(e){return new Promise((t,i)=>{if(this.sourceJSON){if(null!=this.sourceJSON.bandCount&&null!=this.sourceJSON.pixelSizeX)throw new a["a"]("tile-layer:unsupported-url","use ImageryTileLayer to open a tiled image service");return void t({data:this.sourceJSON})}if(!this.parsedUrl)throw new a["a"]("tile-layer:undefined-url","layer's url is not defined");const r=Object(P["e"])(this.parsedUrl.path);if(Object(o["l"])(r)&&"ImageServer"===r.serverType)throw new a["a"]("tile-layer:unsupported-url","use ImageryTileLayer to open a tiled image service");Object(n["default"])(this.parsedUrl.path,{query:{f:"json",...this.parsedUrl.query,...this.customParameters,token:this.apiKey},responseType:"json",signal:e}).then(t,i)}).then(t=>{if(t.ssl&&(this.url=this.url.replace(/^http:/i,"https:")),this.sourceJSON=t.data,this.read(t.data,{origin:"service",url:this.parsedUrl}),10.1===this.version&&!Object(P["c"])(this.url))return this._fetchServerVersion(this.url,e).then(e=>{this.read({currentVersion:e})}).catch(()=>{})})}_fetchServerVersion(e,t){if(!Object(P["b"])(e))return Promise.reject();const i=e.replace(/(.*\/rest)\/.*/i,"$1")+"/info";return Object(n["default"])(i,{query:{f:"json",...this.customParameters,token:this.apiKey},responseType:"json",signal:t}).then(e=>{if(e.data&&e.data.currentVersion)return e.data.currentVersion;throw new a["a"]("tile-layer:version-not-available")})}_getMapName(e){const t=e.match(/^(?:https?:)?\/\/(server\.arcgisonline\.com|services\.arcgisonline\.com|ibasemaps-api\.arcgis\.com)\/arcgis\/rest\/services\/([^\/]+(\/[^\/]+)*)\/mapserver/i);return t&&t[2]}_getDefaultAttribution(e){if(!e)return;let t;e=e.toLowerCase();for(let i=0,r=E.length;i<r;i++)if(t=E[i],t.toLowerCase().indexOf(e)>-1)return Object(d["A"])("//static.arcgis.com/attribution/"+t)}_getDefaultTileServers(e){const t=-1!==e.search(/^(?:https?:)?\/\/server\.arcgisonline\.com/i),i=-1!==e.search(/^(?:https?:)?\/\/services\.arcgisonline\.com/i);return t||i?[e,e.replace(t?/server\.arcgisonline/i:/services\.arcgisonline/i,t?"services.arcgisonline":"server.arcgisonline")]:[]}get hasOverriddenFetchTile(){return!this.fetchTile.__isDefault__}};Object(r["a"])([Object(h["b"])({readOnly:!0})],D.prototype,"attributionDataUrl",null),Object(r["a"])([Object(h["b"])({type:["show","hide","hide-children"]})],D.prototype,"listMode",void 0),Object(r["a"])([Object(h["b"])({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],D.prototype,"isReference",void 0),Object(r["a"])([Object(h["b"])({readOnly:!0,type:["ArcGISTiledMapServiceLayer"]})],D.prototype,"operationalLayerType",void 0),Object(r["a"])([Object(h["b"])({type:Boolean})],D.prototype,"resampling",void 0),Object(r["a"])([Object(h["b"])()],D.prototype,"sourceJSON",void 0),Object(r["a"])([Object(h["b"])({type:R["a"]})],D.prototype,"spatialReference",void 0),Object(r["a"])([Object(p["a"])("spatialReference",["spatialReference","tileInfo"])],D.prototype,"readSpatialReference",null),Object(r["a"])([Object(h["b"])({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],D.prototype,"path",void 0),Object(r["a"])([Object(h["b"])({readOnly:!0})],D.prototype,"sublayers",void 0),Object(r["a"])([Object(b["a"])("sublayers",{layers:{type:[M["a"]]}})],D.prototype,"writeSublayers",null),Object(r["a"])([Object(h["b"])({json:{read:!1,write:!1}})],D.prototype,"popupEnabled",void 0),Object(r["a"])([Object(h["b"])()],D.prototype,"tileServers",null),Object(r["a"])([Object(u["a"])("tileServers")],D.prototype,"castTileServers",null),Object(r["a"])([Object(h["b"])({readOnly:!0,json:{read:!1}})],D.prototype,"type",void 0),Object(r["a"])([Object(h["b"])(A["n"])],D.prototype,"url",void 0),D=Object(r["a"])([Object(f["a"])("esri.layers.TileLayer")],D),D.prototype.fetchTile.__isDefault__=!0;const I=D},2906:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("3886");function n(e,t){const i=e.fragment,n=void 0!==t.lightingSphericalHarmonicsOrder?t.lightingSphericalHarmonicsOrder:2;0===n?(i.uniforms.add("lightingAmbientSH0","vec3"),i.code.add(r["a"]`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
return ambientLight * (1.0 - ambientOcclusion);
}`)):1===n?(i.uniforms.add("lightingAmbientSH_R","vec4"),i.uniforms.add("lightingAmbientSH_G","vec4"),i.uniforms.add("lightingAmbientSH_B","vec4"),i.code.add(r["a"]`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec4 sh0 = vec4(
0.282095,
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y
);
vec3 ambientLight = vec3(
dot(lightingAmbientSH_R, sh0),
dot(lightingAmbientSH_G, sh0),
dot(lightingAmbientSH_B, sh0)
);
return ambientLight * (1.0 - ambientOcclusion);
}`)):2===n&&(i.uniforms.add("lightingAmbientSH0","vec3"),i.uniforms.add("lightingAmbientSH_R1","vec4"),i.uniforms.add("lightingAmbientSH_G1","vec4"),i.uniforms.add("lightingAmbientSH_B1","vec4"),i.uniforms.add("lightingAmbientSH_R2","vec4"),i.uniforms.add("lightingAmbientSH_G2","vec4"),i.uniforms.add("lightingAmbientSH_B2","vec4"),i.code.add(r["a"]`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
vec4 sh1 = vec4(
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y,
1.092548 * normal.x * normal.y
);
vec4 sh2 = vec4(
1.092548 * normal.y * normal.z,
0.315392 * (3.0 * normal.z * normal.z - 1.0),
1.092548 * normal.x * normal.z,
0.546274 * (normal.x * normal.x - normal.y * normal.y)
);
ambientLight += vec3(
dot(lightingAmbientSH_R1, sh1),
dot(lightingAmbientSH_G1, sh1),
dot(lightingAmbientSH_B1, sh1)
);
ambientLight += vec3(
dot(lightingAmbientSH_R2, sh2),
dot(lightingAmbientSH_G2, sh2),
dot(lightingAmbientSH_B2, sh2)
);
return ambientLight * (1.0 - ambientOcclusion);
}`),1!==t.pbrMode&&2!==t.pbrMode||i.code.add(r["a"]`const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);
vec3 calculateAmbientRadiance(float ambientOcclusion)
{
vec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;
return ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;
}`))}},"2aa2":function(e,t,i){"use strict";i.d(t,"a",(function(){return r})),i.d(t,"b",(function(){return n}));const r=(()=>{const e=new Array;return e[0]=10,e[1]=10,e[2]=10,e[3]=10,e[4]=5,e})(),n=30},"2aad":function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("3886");function n(e){e.attributes.add("position","vec2"),e.varyings.add("uv","vec2"),e.vertex.code.add(r["a"]`
    void main(void) {
      gl_Position = vec4(position, 0.0, 1.0);
      uv = position * 0.5 + vec2(0.5);
    }
  `)}},"2b60":function(e,t,i){"use strict";i.d(t,"a",(function(){return l}));var r=i("2eab"),n=i("792b"),a=i("ce50"),s=i("b2b2"),o=i("f4cc"),c=i("e041");class l{constructor(e){this.streamDataRequester=e}async loadJSON(e,t){return this.load("json",e,t)}async loadBinary(e,t){return Object(c["u"])(e)?(Object(o["w"])(t),Object(c["j"])(e)):this.load("binary",e,t)}async loadImage(e,t){return this.load("image",e,t)}async load(e,t,i){if(Object(s["k"])(this.streamDataRequester))return(await Object(r["default"])(t,{responseType:d[e]})).data;const c=await Object(n["d"])(this.streamDataRequester.request(t,e,i));if(!0===c.ok)return c.value;throw Object(o["v"])(c.error),new a["a"]("","Request for resource failed: "+c.error)}}const d={image:"image",binary:"array-buffer",json:"json"}},"2bc9":function(e,t,i){"use strict";i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return a})),i.d(t,"c",(function(){return s})),i.d(t,"d",(function(){return o}));var r=i("0b2d");class n{constructor(e=Object(r["f"])()){this.intensity=e}}class a{constructor(e=Object(r["f"])(),t=Object(r["h"])(.57735,.57735,.57735)){this.intensity=e,this.direction=t}}class s{constructor(e=Object(r["f"])(),t=Object(r["h"])(.57735,.57735,.57735),i=!0){this.intensity=e,this.direction=t,this.castShadows=i}}class o{constructor(){this.r=[0],this.g=[0],this.b=[0]}}},"2db0":function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("2eab");async function n(e,t){const{data:i}=await Object(r["default"])(e,{responseType:"image",...t});return i}},"2df1":function(e,t,i){"use strict";i.d(t,"a",(function(){return X}));var r=i("38a4"),n=i("b2b2"),a=i("a915"),s=i("1c92"),o=i("dae5"),c=i("d791"),l=i("afe1"),d=i("3349"),h=i("02f1"),u=i("e431"),p=i("0b2d");function f(e){return e instanceof Float32Array&&e.length>=16}function b(e){return Array.isArray(e)&&e.length>=16}function m(e){return f(e)||b(e)}var g=i("9180"),v=i("fc00"),y=i("1038"),O=i("b061"),_=i("68af"),x=i("35b3"),j=i("da1c"),w=i("1153"),S=i("5957"),T=i("7c51"),C=i("b623"),P=i("0d96"),A=i("a4ee"),M=i("d272"),R=i("17b0"),E=i("d0cb"),D=i("6a07"),I=i("9617"),F=i("c6d7"),z=i("be24"),L=i("2f98"),V=i("8e97"),k=i("c3a4"),U=i("ca98"),B=i("da35"),N=i("fa1e"),G=i("7438"),q=i("c829"),H=i("189c");class W extends U["a"]{initializeProgram(e){const t=W.shader.get(),i=this.configuration,r=t.build({output:i.output,FrontFacePass:2===i.transparencyPassType,viewingMode:e.viewingMode,occlusionTestEnabled:i.occlusionTestEnabled,signedDistanceFieldEnabled:i.sdf,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!0,debugDrawBorder:i.debugDrawBorder,binaryHighlightOcclusionEnabled:i.binaryHighlightOcclusion,screenCenterOffsetUnitsEnabled:i.screenCenterOffsetUnitsEnabled,screenSizePerspectiveEnabled:i.screenSizePerspective,verticalOffsetEnabled:i.verticalOffset,pixelSnappingEnabled:i.pixelSnappingEnabled,vvSize:i.vvSize,vvColor:i.vvColor,vvInstancingEnabled:!1,isDraped:i.isDraped,multipassGeometryEnabled:i.multipassGeometryEnabled,multipassTerrainEnabled:i.multipassTerrainEnabled,cullAboveGround:i.cullAboveGround});return new q["a"](e.rctx,r,N["a"])}bindPass(e,t){Object(V["c"])(this.program,t.camera.projectionMatrix),this.program.setUniform1f("cameraGroundRelative",t.camera.aboveGround?1:-1),this.program.setUniform1f("perDistancePixelRatio",Math.tan(t.camera.fovY/2)/(t.camera.fullViewport[2]/2)),this.program.setUniformMatrix4fv("viewNormal",t.camera.viewInverseTransposeMatrix),this.program.setUniform1f("polygonOffset",e.shaderPolygonOffset),Object(R["b"])(this.program,e,t),Object(L["b"])(this.program,e),this.program.setUniform1f("pixelRatio",t.camera.pixelRatio||1),Object(V["f"])(this.program,t),6===this.configuration.output?(this.program.setUniform2fv("cameraNearFar",t.camera.nearFar),this.program.setUniform2fv("inverseViewport",t.inverseViewport),Object(I["a"])(this.program,t),Object(F["a"])(this.program,t)):(Object(E["b"])(this.program,t),Object(P["c"])(this.program,e,t.camera.pixelRatio||1),Object(z["b"])(this.program,e),this.configuration.occlusionTestEnabled&&this.program.bindTexture(t.hudVisibilityTexture,"hudVisibilityTexture")),4===this.configuration.output&&Object(D["b"])(this.program,t)}bindDraw(e){Object(V["d"])(this.program,e),Object(V["a"])(this.program,e.origin,e.camera.viewInverseTransposeMatrix),Object(M["c"])(this.program,this.configuration,e),this.program.rebindTextures()}setPipelineState(e){const t=this.configuration,i=3===e,r=2===e,n=515,a=this.configuration.polygonOffsetEnabled&&$,s=(i||r)&&4!==t.output?(t.depthEnabled||6===t.output)&&H["e"]:null;return Object(H["g"])({blending:0===t.output||7===t.output||4===t.output?i?Z:Object(G["a"])(e):null,depthTest:{func:n},depthWrite:s,colorWrite:H["d"],polygonOffset:a})}initializePipeline(){return this.setPipelineState(this.configuration.transparencyPassType)}get primitiveType(){return 6===this.configuration.output?0:4}}W.shader=new k["a"](P["a"],()=>i.e("chunk-2d0db7d8").then(i.bind(null,"6fa3")));const $={factor:0,units:-4},Z=Object(H["i"])(1,771);class Q extends B["a"]{constructor(){super(...arguments),this.output=0,this.occlusionTestEnabled=!0,this.sdf=!1,this.vvSize=!1,this.vvColor=!1,this.verticalOffset=!1,this.screenSizePerspective=!1,this.screenCenterOffsetUnitsEnabled=0,this.debugDrawBorder=!1,this.binaryHighlightOcclusion=!0,this.slicePlaneEnabled=!1,this.polygonOffsetEnabled=!1,this.depthEnabled=!0,this.transparencyPassType=3,this.pixelSnappingEnabled=!0,this.isDraped=!1,this.multipassGeometryEnabled=!1,this.multipassTerrainEnabled=!1,this.cullAboveGround=!1}}Object(A["a"])([Object(B["b"])({count:8})],Q.prototype,"output",void 0),Object(A["a"])([Object(B["b"])()],Q.prototype,"occlusionTestEnabled",void 0),Object(A["a"])([Object(B["b"])()],Q.prototype,"sdf",void 0),Object(A["a"])([Object(B["b"])()],Q.prototype,"vvSize",void 0),Object(A["a"])([Object(B["b"])()],Q.prototype,"vvColor",void 0),Object(A["a"])([Object(B["b"])()],Q.prototype,"verticalOffset",void 0),Object(A["a"])([Object(B["b"])()],Q.prototype,"screenSizePerspective",void 0),Object(A["a"])([Object(B["b"])({count:2})],Q.prototype,"screenCenterOffsetUnitsEnabled",void 0),Object(A["a"])([Object(B["b"])()],Q.prototype,"debugDrawBorder",void 0),Object(A["a"])([Object(B["b"])()],Q.prototype,"binaryHighlightOcclusion",void 0),Object(A["a"])([Object(B["b"])()],Q.prototype,"slicePlaneEnabled",void 0),Object(A["a"])([Object(B["b"])()],Q.prototype,"polygonOffsetEnabled",void 0),Object(A["a"])([Object(B["b"])()],Q.prototype,"depthEnabled",void 0),Object(A["a"])([Object(B["b"])({count:4})],Q.prototype,"transparencyPassType",void 0),Object(A["a"])([Object(B["b"])()],Q.prototype,"pixelSnappingEnabled",void 0),Object(A["a"])([Object(B["b"])()],Q.prototype,"isDraped",void 0),Object(A["a"])([Object(B["b"])()],Q.prototype,"multipassGeometryEnabled",void 0),Object(A["a"])([Object(B["b"])()],Q.prototype,"multipassTerrainEnabled",void 0),Object(A["a"])([Object(B["b"])()],Q.prototype,"cullAboveGround",void 0);class X extends x["a"]{constructor(e){super(e,ye),this.techniqueConfig=new Q}getTechniqueConfig(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.slicePlaneEnabled=this.parameters.slicePlaneEnabled,this.techniqueConfig.verticalOffset=!!this.parameters.verticalOffset,this.techniqueConfig.screenSizePerspective=!!this.parameters.screenSizePerspective,this.techniqueConfig.screenCenterOffsetUnitsEnabled="screen"===this.parameters.centerOffsetUnits?1:0,this.techniqueConfig.polygonOffsetEnabled=this.parameters.polygonOffset,this.techniqueConfig.isDraped=this.parameters.isDraped,this.techniqueConfig.occlusionTestEnabled=this.parameters.occlusionTest,this.techniqueConfig.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this.techniqueConfig.sdf=this.parameters.textureIsSignedDistanceField,this.techniqueConfig.vvSize=!!this.parameters.vvSizeEnabled,this.techniqueConfig.vvColor=!!this.parameters.vvColorEnabled,0===e&&(this.techniqueConfig.debugDrawBorder=!!this.parameters.debugDrawBorder),4===e&&(this.techniqueConfig.binaryHighlightOcclusion=this.parameters.binaryHighlightOcclusion),this.techniqueConfig.depthEnabled=this.parameters.depthEnabled,this.techniqueConfig.transparencyPassType=t.transparencyPassType,this.techniqueConfig.multipassGeometryEnabled=t.multipassGeometryEnabled,this.techniqueConfig.multipassTerrainEnabled=t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=t.cullAboveGround,this.techniqueConfig}intersect(e,t,i,r,a,s,o,c,l){Object(n["l"])(l)?this.intersectDrapedHudGeometry(e,s,o,c,l):this.intersectHudGeometry(e,t,i,r,o,c)}intersectDrapedHudGeometry(e,t,i,r,a){const s=e.vertexAttributes.get("position"),o=e.vertexAttributes.get("size"),c=this.parameters,l=Object(P["d"])(c);let d=1,h=1;if(Object(n["l"])(r)){const e=r(fe);d=e[0],h=e[5]}d*=e.screenToWorldRatio,h*=e.screenToWorldRatio;const u=me*e.screenToWorldRatio;for(let n=0;n<s.data.length/s.size;n++){const r=n*s.size,p=s.data[r],f=s.data[r+1],b=n*o.size;let m;ge[0]=o.data[b]*d,ge[1]=o.data[b+1]*h,c.textureIsSignedDistanceField&&(m=c.outlineSize*e.screenToWorldRatio/2),te(t,p,f,ge,u,m,c,l)&&i(a.dist,a.normal,-1,!0)}}intersectHudGeometry(e,t,i,r,a,o){if(!r.options.selectionMode||!r.options.hud||Object(C["d"])(t))return;const l=this.parameters;let d=1,h=1;if(Object(s["f"])(le,i),Object(n["l"])(o)){const e=o(fe);d=e[0],h=e[5],ee(le)}const f=e.vertexAttributes.get("position"),b=e.vertexAttributes.get("size"),m=e.vertexAttributes.get("normal"),g=e.vertexAttributes.get("auxpos1");Object(w["a"])(f.size>=3);const v=r.point,y=r.camera,O=Object(P["d"])(l);d*=y.pixelRatio,h*=y.pixelRatio;const _="screen"===this.parameters.centerOffsetUnits;for(let n=0;n<f.data.length/f.size;n++){const e=n*f.size;Object(u["z"])(ne,f.data[e],f.data[e+1],f.data[e+2]),Object(u["t"])(ne,ne,i);const t=n*b.size;ge[0]=b.data[t]*d,ge[1]=b.data[t+1]*h,Object(u["t"])(ne,ne,y.viewMatrix);const s=n*g.size;if(Object(u["z"])(ue,g.data[s+0],g.data[s+1],g.data[s+2]),!_&&(ne[0]+=ue[0],ne[1]+=ue[1],0!==ue[2])){const e=ue[2];Object(u["u"])(ue,ne),Object(u["m"])(ne,ne,Object(u["h"])(ue,ue,e))}const o=n*m.size;if(Object(u["z"])(ae,m.data[o],m.data[o+1],m.data[o+2]),this.normalAndViewAngle(ae,le,y,pe),this.applyVerticalOffsetTransformationView(ne,pe,y,ie),y.applyProjection(ne,se),se[0]>-1){let e=Math.floor(se[0])+this.parameters.screenOffset[0],t=Math.floor(se[1])+this.parameters.screenOffset[1];_&&(e+=ue[0],0!==ue[1]&&(t+=Object(j["b"])(ue[1],ie.factorAlignment))),Object(j["a"])(ge,ie.factor,ge);const i=be*y.pixelRatio;let n;if(l.textureIsSignedDistanceField&&(n=l.outlineSize*y.pixelRatio/2),te(v,e,t,ge,i,n,l,O)){const e=r.ray;if(Object(u["t"])(ce,ne,Object(c["c"])(he,y.viewMatrix)),se[0]=v[0],se[1]=v[1],y.unprojectFromRenderScreen(se,ne)){const t=Object(p["f"])();Object(u["n"])(t,e.direction);const i=1/Object(u["s"])(t);Object(u["h"])(t,t,i),a(Object(u["p"])(e.origin,ne)*i,t,-1,!0,1,ce)}}}}}computeAttachmentOrigin(e,t){const i=e.vertexAttributes;if(!i)return!1;const r=i.get("position"),n=e.indices.get("position");return Object(y["b"])(r,n,t)}createBufferWriter(){return new _e(this)}normalAndViewAngle(e,t,i,r){return m(t)&&(t=Object(s["f"])(de,t)),Object(u["A"])(r.normal,e,t),Object(u["t"])(r.normal,r.normal,i.viewInverseTransposeMatrix),r.cosAngle=Object(u["k"])(oe,ve),r}updateScaleInfo(e,t,i){const r=this.parameters;r.screenSizePerspective?Object(j["e"])(i,t,r.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minPixelSize=0,e.factor.paddingPixels=0),r.screenSizePerspectiveAlignment?Object(j["e"])(i,t,r.screenSizePerspectiveAlignment,e.factorAlignment):(e.factorAlignment.factor=e.factor.factor,e.factorAlignment.scale=e.factor.scale,e.factorAlignment.minPixelSize=e.factor.minPixelSize,e.factorAlignment.paddingPixels=e.factor.paddingPixels)}applyShaderOffsetsView(e,t,i,r,n,a,s){const o=this.normalAndViewAngle(t,i,n,pe);return this.applyVerticalGroundOffsetView(e,o,n,s),this.applyVerticalOffsetTransformationView(s,o,n,a),this.applyPolygonOffsetView(s,o,r[3],n,s),this.applyCenterOffsetView(s,r,s),s}applyShaderOffsetsNDC(e,t,i,r,a){return this.applyCenterOffsetNDC(e,t,i,r),Object(n["l"])(a)&&Object(u["n"])(a,r),this.applyPolygonOffsetNDC(r,t,i,r),r}applyPolygonOffsetView(e,t,i,n,a){const s=n.aboveGround?1:-1;let o=Math.sign(i);0===o&&(o=s);const c=s*o;if(this.parameters.shaderPolygonOffset<=0)return Object(u["n"])(a,e);const l=Object(r["f"])(Math.abs(t.cosAngle),.01,1),d=1-Math.sqrt(1-l*l)/l/n.viewport[2];return Object(u["h"])(a,e,c>0?d:1/d),a}applyVerticalGroundOffsetView(e,t,i,r){const n=Object(u["s"])(e),a=i.aboveGround?1:-1,s=.5*i.computeRenderPixelSizeAtDist(n),o=Object(u["h"])(ne,t.normal,a*s);return Object(u["i"])(r,e,o),r}applyVerticalOffsetTransformationView(e,t,i,r){const n=this.parameters;if(!n.verticalOffset||!n.verticalOffset.screenLength){if(n.screenSizePerspective||n.screenSizePerspectiveAlignment){const i=Object(u["s"])(e);this.updateScaleInfo(r,i,t.cosAngle)}else r.factor.scale=1,r.factorAlignment.scale=1;return e}const a=Object(u["s"])(e),s=n.screenSizePerspectiveAlignment||n.screenSizePerspective,o=Object(T["l"])(i,a,n.verticalOffset,t.cosAngle,s);return this.updateScaleInfo(r,a,t.cosAngle),Object(u["h"])(t.normal,t.normal,o),Object(u["i"])(e,e,t.normal)}applyCenterOffsetView(e,t,i){const r="screen"!==this.parameters.centerOffsetUnits;return i!==e&&Object(u["n"])(i,e),r&&(i[0]+=t[0],i[1]+=t[1],t[2]&&(Object(u["u"])(ae,i),Object(u["i"])(i,i,Object(u["h"])(ae,ae,t[2])))),i}applyCenterOffsetNDC(e,t,i,r){const n="screen"!==this.parameters.centerOffsetUnits;return r!==e&&Object(u["n"])(r,e),n||(r[0]+=t[0]/i.fullWidth*2,r[1]+=t[1]/i.fullHeight*2),r}applyPolygonOffsetNDC(e,t,i,r){const n=this.parameters.shaderPolygonOffset;if(e!==r&&Object(u["n"])(r,e),n){const e=i.aboveGround?1:-1,a=e*Math.sign(t[3]);r[2]-=(a||e)*n}return r}requiresSlot(e,t){const i=Object(O["b"])(t);if(0===i||7===i){if(20===e)return!0;const t=this.parameters.drawInSecondSlot?17:16;return this.parameters.occlusionTest&&11===e||e===t}return e===(this.parameters.drawInSecondSlot?17:16)||20===e}createGLMaterial(e){return 0===e.output||7===e.output?new K(e):4===e.output?new Y(e):null}calculateRelativeScreenBounds(e,t,i=Object(g["m"])()){return J(this.parameters,e,t,i),i[2]=i[0]+e[0],i[3]=i[1]+e[1],i}}class Y extends _["a"]{constructor(e){super({...e,...e.material.parameters})}updateParameters(e){return this.updateTexture(this._material.parameters.textureId),this.selectProgram(e)}selectProgram(e){return this.ensureTechnique(W,e)}beginSlot(e){return this.updateParameters(e)}bind(e,t){this.bindTextures(t.program),this.bindTextureScale(t.program),t.bindPass(this._material.parameters,e)}}class K extends Y{isOcclusionSlot(e){return 11===e.slot&&this._material.parameters.occlusionTest&&(0===this._output||7===this._output)}selectProgram(e){return this.ensureTechnique(W,e,this.isOcclusionSlot(e)?6:this._output)}bind(e,t){this.isOcclusionSlot(e)||(this.bindTextures(t.program),this.bindTextureScale(t.program)),t.bindPass(this._material.parameters,e)}}function J(e,t,i,r=re){return Object(d["c"])(r,e.anchorPos),r[0]*=-t[0],r[1]*=-t[1],r[0]+=e.screenOffset[0]*i,r[1]+=e.screenOffset[1]*i,r}function ee(e){const t=e[0],i=e[1],r=e[2],n=e[3],a=e[4],s=e[5],o=e[6],c=e[7],l=e[8],d=1/Math.sqrt(t*t+i*i+r*r),h=1/Math.sqrt(n*n+a*a+s*s),u=1/Math.sqrt(o*o+c*c+l*l);return e[0]=t*d,e[1]=i*d,e[2]=r*d,e[3]=n*h,e[4]=a*h,e[5]=s*h,e[6]=o*u,e[7]=c*u,e[8]=l*u,e}function te(e,t,i,r,n,a,s,o){let c=t-n-(o[0]>0?r[0]*o[0]:0),l=c+r[0]+2*n,d=i-n-(o[1]>0?r[1]*o[1]:0),h=d+r[1]+2*n;if(s.textureIsSignedDistanceField){const e=s.distanceFieldBoundingBox;c+=r[0]*e[0],d+=r[1]*e[1],l-=r[0]*(1-e[2]),h-=r[1]*(1-e[3]),c-=a,l+=a,d-=a,h+=a}return e[0]>c&&e[0]<l&&e[1]>d&&e[1]<h}const ie={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}},re=Object(h["b"])(),ne=Object(p["f"])(),ae=Object(p["f"])(),se=Object(a["e"])(),oe=Object(p["f"])(),ce=Object(p["f"])(),le=Object(o["b"])(),de=Object(o["b"])(),he=Object(l["d"])(),ue=Object(p["f"])(),pe={normal:oe,cosAngle:0},fe=Object(l["d"])(),be=1,me=2,ge=[0,0],ve=Object(p["h"])(0,0,1),ye={texCoordScale:[1,1],occlusionTest:!0,binaryHighlightOcclusion:!0,drawInSecondSlot:!1,color:[1,1,1,1],outlineColor:[1,1,1,1],outlineSize:0,textureIsSignedDistanceField:!1,distanceFieldBoundingBox:null,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],screenOffset:[0,0],verticalOffset:null,screenSizePerspective:null,screenSizePerspectiveAlignment:null,slicePlaneEnabled:!1,anchorPos:Object(h["f"])(.5,.5),shaderPolygonOffset:1e-5,polygonOffset:!1,textureId:null,centerOffsetUnits:"world",depthEnabled:!0,pixelSnappingEnabled:!0,debugDrawBorder:!1,isDraped:!1,...x["b"]},Oe=Object(v["a"])().vec3f("position").vec3f("normal").vec2f("uv0").vec4u8("color").vec2f("size").vec4f("auxpos1").vec4f("auxpos2");class _e{constructor(e){this.material=e,this.vertexBufferLayout=Oe}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return 6*e.indices.get("position").length}write(e,t,i,r){Object(S["e"])(t.indices.get("position"),t.vertexAttributes.get("position").data,e.transformation,i.position,r,6),Object(S["d"])(t.indices.get("normal"),t.vertexAttributes.get("normal").data,e.invTranspTransformation,i.normal,r,6);{const e=t.vertexAttributes.get("uv0").data;let n,a,s,o;if(null==e||e.length<4){const e=this.material.parameters;n=0,a=0,s=e.texCoordScale[0],o=e.texCoordScale[1]}else n=e[0],a=e[1],s=e[2],o=e[3];s=Math.min(1.99999,s+1),o=Math.min(1.99999,o+1);const c=t.indices.get("position").length,l=i.uv0;let d=r;for(let t=0;t<c;++t)l.set(d,0,n),l.set(d,1,a),d+=1,l.set(d,0,s),l.set(d,1,a),d+=1,l.set(d,0,s),l.set(d,1,o),d+=1,l.set(d,0,s),l.set(d,1,o),d+=1,l.set(d,0,n),l.set(d,1,o),d+=1,l.set(d,0,n),l.set(d,1,a),d+=1}Object(S["b"])(t.indices.get("color"),t.vertexAttributes.get("color").data,4,i.color,r,6);{const e=t.indices.get("size"),n=t.vertexAttributes.get("size").data,a=e.length,s=i.size;let o=r;for(let t=0;t<a;++t){const i=n[2*e[t]],r=n[2*e[t]+1];for(let e=0;e<6;++e)s.set(o,0,i),s.set(o,1,r),o+=1}}t.indices.get("auxpos1")&&t.vertexAttributes.get("auxpos1")&&Object(S["a"])(t.indices.get("auxpos1"),t.vertexAttributes.get("auxpos1").data,i.auxpos1,r,6),t.indices.get("auxpos2")&&t.vertexAttributes.get("auxpos2")&&Object(S["a"])(t.indices.get("auxpos2"),t.vertexAttributes.get("auxpos2").data,i.auxpos2,r,6)}}},"2e0f":function(e,t,i){"use strict";i.d(t,"a",(function(){return S})),i.d(t,"b",(function(){return r})),i.d(t,"c",(function(){return y})),i.d(t,"d",(function(){return p})),i.d(t,"e",(function(){return m})),i.d(t,"f",(function(){return b})),i.d(t,"g",(function(){return f})),i.d(t,"h",(function(){return g})),i.d(t,"i",(function(){return v}));var r,n=i("6c97"),a=i("b2b2"),s=i("d791"),o=i("afe1"),c=i("0b2d"),l=i("8188"),d=i("84f4"),h=i("ba58"),u=i("0cb9");function p(e,t,i,r,n,a,s,o,c,d,h){const u=T[h.mode];let p,f,b=0;if(Object(l["p"])(e,t,i,r,c.spatialReference,n,o))return u.requiresAlignment(h)?(b=u.applyElevationAlignmentBuffer(r,n,a,s,o,c,d,h),p=a,f=s):(p=r,f=n),Object(l["p"])(p,c.spatialReference,f,a,d.spatialReference,s,o)?b:void 0}function f(e,t,i,r,s){const o=(Object(d["a"])(e)?e.z:Object(u["c"])(e)?e.array[e.offset+2]:e[2])||0;switch(i.mode){case"on-the-ground":{const i=Object(a["v"])(Object(u["b"])(t,e,"ground"),0);return s.verticalDistanceToGround=0,s.sampledElevation=i,void(s.z=i)}case"relative-to-ground":{const n=Object(a["v"])(Object(u["b"])(t,e,"ground"),0),c=i.geometryZWithOffset(o,r);return s.verticalDistanceToGround=c,s.sampledElevation=n,void(s.z=c+n)}case"relative-to-scene":{const n=Object(a["v"])(Object(u["b"])(t,e,"scene"),0),c=i.geometryZWithOffset(o,r);return s.verticalDistanceToGround=c,s.sampledElevation=n,void(s.z=c+n)}case"absolute-height":{const n=i.geometryZWithOffset(o,r),c=Object(a["v"])(Object(u["b"])(t,e,"ground"),0);return s.verticalDistanceToGround=n-c,s.sampledElevation=c,void(s.z=n)}default:return Object(n["a"])(i.mode),void(s.z=0)}}function b(e,t,i,r){return f(e,t,i,r,P),P.z}function m(e,t,i){return null==t||null==i?e.definedChanged:"on-the-ground"===t&&"on-the-ground"===i?e.staysOnTheGround:t===i||"on-the-ground"!==t&&"on-the-ground"!==i?r.UPDATE:e.onTheGroundChanged}function g(e){return"relative-to-ground"===e||"relative-to-scene"===e}function v(e){return"absolute-height"!==e}function y(e,t,i,r,n){f(t,i,n,r,P),Object(h["j"])(e,P.verticalDistanceToGround);const a=P.sampledElevation,o=Object(s["d"])(C,e.transformation);return A[0]=t.x,A[1]=t.y,A[2]=P.z,Object(l["d"])(t.spatialReference,A,o,r.spatialReference)?e.transformation=o:console.warn("Could not locate symbol object properly, it might be misplaced"),a}function O(e,t,i,r,n,s){let o=0;const c=s.spatialReference;t*=3,r*=3;for(let l=0;l<n;++l){const n=e[t+0],l=e[t+1],d=e[t+2],h=Object(a["v"])(s.getElevation(n,l,d,c,"ground"),0);o+=h,i[r+0]=n,i[r+1]=l,i[r+2]=h,t+=3,r+=3}return o/n}function _(e,t,i,r,n,s,o,c){let l=0;const d=c.calculateOffsetRenderUnits(o),h=c.featureExpressionInfoContext,u=s.spatialReference;t*=3,r*=3;for(let p=0;p<n;++p){const n=e[t+0],o=e[t+1],c=e[t+2],p=Object(a["v"])(s.getElevation(n,o,c,u,"ground"),0);l+=p,i[r+0]=n,i[r+1]=o,i[r+2]=null==h?c+p+d:p+d,t+=3,r+=3}return l/n}function x(e,t,i,r,n,s,o,c){let l=0;const d=c.calculateOffsetRenderUnits(o),h=c.featureExpressionInfoContext,u=s.spatialReference;t*=3,r*=3;for(let p=0;p<n;++p){const n=e[t+0],o=e[t+1],c=e[t+2],p=Object(a["v"])(s.getElevation(n,o,c,u,"scene"),0);l+=p,i[r+0]=n,i[r+1]=o,i[r+2]=null==h?c+p+d:p+d,t+=3,r+=3}return l/n}function j(e){const t=e.meterUnitOffset,i=e.featureExpressionInfoContext;return 0!==t||null!=i}function w(e,t,i,r,n,a,s,o){const c=o.calculateOffsetRenderUnits(s),l=o.featureExpressionInfoContext;t*=3,r*=3;for(let d=0;d<n;++d){const n=e[t+0],a=e[t+1],s=e[t+2];i[r+0]=n,i[r+1]=a,i[r+2]=null==l?s+c:c,t+=3,r+=3}return 0}class S{constructor(){this.verticalDistanceToGround=0,this.sampledElevation=0,this.z=0}}!function(e){e[e.NONE=0]="NONE",e[e.UPDATE=1]="UPDATE",e[e.RECREATE=2]="RECREATE"}(r||(r={}));const T={"absolute-height":{applyElevationAlignmentBuffer:w,requiresAlignment:j},"on-the-ground":{applyElevationAlignmentBuffer:O,requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:_,requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:x,requiresAlignment:()=>!0}},C=Object(o["d"])(),P=new S,A=Object(c["f"])()},"2eb0":function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("3886");function n(e){e.fragment.uniforms.add("u_colormap","sampler2D"),e.fragment.uniforms.add("u_colormapOffset","float"),e.fragment.uniforms.add("u_colormapMaxIndex","float"),e.fragment.code.add(r["a"]`vec4 colormap(vec4 currentPixel, bool isFloat) {
float clrIndex = isFloat ? currentPixel.r - u_colormapOffset : currentPixel.r * 255.0 - u_colormapOffset;
vec4 result;
if (currentPixel.a == 0.0 || clrIndex > u_colormapMaxIndex) {
result = vec4(0.0, 0.0, 0.0, 0.0);
} else {
vec2 clrPosition = vec2((clrIndex + 0.5) / (u_colormapMaxIndex + 1.0), 0.0);
vec4 color = texture2D(u_colormap, clrPosition);
result = vec4(color.rgb, 1.0) * color.a * u_opacity;
}
return result;
}`)}},"2ebb":function(e,t,i){"use strict";function r(e,t=0){const i=e.stride;return e.fieldNames.filter(t=>{const i=e.fields.get(t).optional;return!(i&&i.glPadding)}).map(r=>{const a=e.fields.get(r),s=a.constructor.ElementCount,o=n(a.constructor.ElementType),c=a.offset,l=!(!a.optional||!a.optional.glNormalized);return{name:r,stride:i,count:s,type:o,offset:c,normalized:l,divisor:t}})}function n(e){const t=a[e];if(t)return t;throw new Error("BufferType not supported in WebGL")}i.d(t,"a",(function(){return r}));const a={u8:5121,u16:5123,u32:5125,i8:5120,i16:5122,i32:5124,f32:5126}},"2ec5":function(e,t,i){"use strict";i.d(t,"a",(function(){return g})),i.d(t,"b",(function(){return l})),i.d(t,"c",(function(){return f})),i.d(t,"d",(function(){return v})),i.d(t,"e",(function(){return c})),i.d(t,"f",(function(){return o})),i.d(t,"g",(function(){return s})),i.d(t,"h",(function(){return d})),i.d(t,"i",(function(){return b})),i.d(t,"j",(function(){return m})),i.d(t,"k",(function(){return p})),i.d(t,"l",(function(){return u}));var r=i("38a4"),n=i("9180"),a=i("ee83");const s=64,o=512,c=2.5,l=Object(r["g"])(r["a"]/10),d=4,h=4,u=e=>e<4?3:h,p=Object(n["m"])();a["a"].WebMercatorAuxiliarySphere.getExtent(0,0,0,p);const f=Object(n["m"])([-180,-90,180,90]),b="Cannot extend surface to encompass all layers because it would result in too many root tiles.",m="Surface extent is too large for tile resolution at level 0.",g="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAIAAADTED8xAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAA2JJREFUeNrs3d1O20AQgFFvRJInQLQBhHj/h0JVW34El1yQ2F73DVq3jTys55zrqUBbPrErZUSZ+vcOsto4AjK76Lqu1vr8+G3mPzjc3D/+eJj/Bcz/cd75R80fbu79BsAVCAQAAgABgABAACAAEAAIAAQAAgABQPOKfQAy83Ho+HnnHzXv49B4A4AAQAAgABAACAAEAAIAAYAAQAAgABAANM4+AKnZB4ifd/5R8/YB8AYAAYAAQAAgABAACAAEAAIAAYAAQAAgAGicfQBSsw8QP+/8o+btA+ANAAIAAYAAQAAgABAACAAEAAIAAYAAQADQOPsApGYfIH7e+UfN2wfAGwAEAAIAAYAAQAAgABAACAAEAAIAAXA201QdggAggH0AUrMPED8/jsPL03fns/y8fQC8AUAAIAAQAAgABAACAAGAAEAAIAAQAAgAGmcfgNTsA8TP2weImrcPgDcACAAEAAIAAYAAQAAgABAACAAEAAIAAUDj7AOQmn2A+Hn7AFHz9gHwBgABgABAACAAEAAIAAQAAgABgABgNS4cAf9pu9u3O1+m/n2aplKK/0j+TX86/tVP5+eZ3+729gFIfwWyDxA7bx8gat4+ANkJAAGAAEAAIAAQAAgABAACAAGAAEAAIABonn0AUrMPED9vHyBq3j4A3gAgABAACAAEAAIAAYAAQAAgABAA51VrdQgCAAHAsuwDkJp9gPj5vj+9vvx0PsvP2wfAGwAEAAIAAYAAQAAgABAACAAEAAIAAYAAoHH2AUjNPkD8vH2AqHn7AHgDgABAACAAEAAIAAQAAgABgABAACAAEAA0zj4AqdkHiJ+3DxA1bx8AbwAQACQ0DL0AyKuOowBwBYKUSikCIHUBAsAVCAQAAgABgABAALBy9gFIzT5A/Lx9gKj5y6trVyC8AUAAIAAQAAgAVq90Pg5N5gA2AsAVCAQAAgABgABAALB29gFIzT5A/Lx9gKj5q6+3rkB4A4AAQAAgABAACADWzB/IIHsCAsAVCARAlKlWhyAAEAAIABZjH4DU7APEz5+OH2+vT85n+fkvhztXILwBQAAgABAACAAEAGtWigBIHcBGALgCgQBAACAAyPMO9nHosxuHodZx5vB2t691HIdh/nx/Os7/Zsz/fvgXAAAA//8DAF1P1hM2ICMfAAAAAElFTkSuQmCC",v=5},"2f00":function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("3886");function n(e){e.attributes.add("position","vec2"),e.attributes.add("uv0","vec2"),e.vertex.uniforms.add("u_scale","float"),e.vertex.uniforms.add("u_offset","vec2"),e.varyings.add("v_texcoord","vec2"),e.vertex.code.add(r["a"]`void main(void) {
v_texcoord = uv0 * u_scale + u_offset;
gl_Position = vec4(position, 0.0, 1.0);
}`)}},"2f98":function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return s}));var r=i("3886"),n=i("7c51");function a(e){e.vertex.code.add(r["a"]`float screenSizePerspectiveMinSize(float size, vec4 factor) {
float nonZeroSize = 1.0 - step(size, 0.0);
return (
factor.z * (
1.0 +
nonZeroSize *
2.0 * factor.w / (
size + (1.0 - nonZeroSize)
)
)
);
}`),e.vertex.code.add(r["a"]`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`),e.vertex.code.add(r["a"]`vec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {
return vec4(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z,
params.w
);
}`),e.vertex.code.add(r["a"]`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {
return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));
}`),e.vertex.code.add(r["a"]`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`),e.vertex.code.add(r["a"]`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {
return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / size.y, 1.0), size, factor.y);
}`),e.vertex.code.add(r["a"]`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)}function s(e,t){if(t.screenSizePerspective){Object(n["a"])(t.screenSizePerspective,e,"screenSizePerspective");const i=t.screenSizePerspectiveAlignment||t.screenSizePerspective;Object(n["a"])(i,e,"screenSizePerspectiveAlignment")}}},"303f":function(e,t,i){"use strict";i.d(t,"a",(function(){return f}));var r=i("a4ee"),n=i("2eab"),a=i("f4cc"),s=i("e041"),o=i("549a"),c=i("59b2"),l=(i("b50f"),i("c120"),i("cea0"),i("afcf")),d=i("d386"),h=i("3af1"),u=i("5996"),p=i("22f4");const f=e=>{let t=class extends e{constructor(){super(...arguments),this.capabilities=void 0,this.copyright=null,this.fullExtent=null,this.legendEnabled=!0,this.spatialReference=null,this.version=null}readCapabilities(e,t){const i=t.capabilities&&t.capabilities.split(",").map(e=>e.toLowerCase().trim());if(!i)return{operations:{supportsQuery:!1,supportsExportMap:!1,supportsExportTiles:!1,supportsTileMap:!1},exportMap:null,exportTiles:null};const r=this.type,n=-1!==i.indexOf("query"),a=-1!==i.indexOf("map"),s=!!t.exportTilesAllowed,c=-1!==i.indexOf("tilemap"),l="tile"!==r&&!!t.supportsDynamicLayers,d="tile"!==r&&(!t.tileInfo||l),h="tile"!==r&&(!t.tileInfo||l),u="tile"!==r,p=!!t.cimVersion&&o["a"].parse(t.cimVersion).since(1,4);return{operations:{supportsQuery:n,supportsExportMap:a,supportsExportTiles:s,supportsTileMap:c},exportMap:a?{supportsArcadeExpressionForLabeling:p,supportsSublayersChanges:u,supportsDynamicLayers:l,supportsSublayerVisibility:d,supportsSublayerDefinitionExpression:h}:null,exportTiles:s?{maxExportTilesCount:+t.maxExportTilesCount}:null}}readVersion(e,t){let i=t.currentVersion;return i||(i=t.hasOwnProperty("capabilities")||t.hasOwnProperty("tables")?10:t.hasOwnProperty("supportedImageFormatTypes")?9.31:9.3),i}async fetchSublayerInfo(e,t){return await this.fetchAllLayersAndTables(t),this._allLayersAndTablesMap.get(e)}async fetchAllLayersAndTables(e){await this.load(e),this._allLayersAndTablesPromise||(this._allLayersAndTablesPromise=Object(n["default"])(Object(s["K"])(this.url).path+"/layers",{responseType:"json",query:{f:"json",...this.customParameters,token:this.apiKey}}).then(e=>{this._allLayersAndTablesMap=new Map;for(const t of e.data.layers)this._allLayersAndTablesMap.set(t.id,t);return{result:e.data}},e=>({error:e})));const t=await this._allLayersAndTablesPromise;if(Object(a["w"])(e),"result"in t)return t.result;throw t.error}};return Object(r["a"])([Object(c["b"])({readOnly:!0})],t.prototype,"capabilities",void 0),Object(r["a"])([Object(l["a"])("service","capabilities",["capabilities","exportTilesAllowed","maxExportTilesCount","supportsDynamicLayers","tileInfo"])],t.prototype,"readCapabilities",null),Object(r["a"])([Object(c["b"])({json:{read:{source:"copyrightText"}}})],t.prototype,"copyright",void 0),Object(r["a"])([Object(c["b"])({type:h["a"]})],t.prototype,"fullExtent",void 0),Object(r["a"])([Object(c["b"])(p["c"])],t.prototype,"id",void 0),Object(r["a"])([Object(c["b"])({type:Boolean,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend"}}})],t.prototype,"legendEnabled",void 0),Object(r["a"])([Object(c["b"])(p["j"])],t.prototype,"popupEnabled",void 0),Object(r["a"])([Object(c["b"])({type:u["a"]})],t.prototype,"spatialReference",void 0),Object(r["a"])([Object(c["b"])()],t.prototype,"version",void 0),Object(r["a"])([Object(l["a"])("version",["currentVersion","capabilities","tables","supportedImageFormatTypes"])],t.prototype,"readVersion",null),t=Object(r["a"])([Object(d["a"])("esri.layers.mixins.ArcGISMapService")],t),t}},3111:function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return s}));var r=i("7c1d"),n=i("3886"),a=i("690a");function s(){const e=new a["a"];return e.attributes.add("position","vec3"),e.attributes.add("color","vec4"),e.attributes.add("size","float"),e.varyings.add("vcolor","vec4"),e.varyings.add("vsize","float"),e.vertex.uniforms.add("transform","mat4").add("viewport","vec4").add("pixelRatio","float"),e.include(r["a"]),e.vertex.code.add(n["a"]`void main(void) {
vec4 posProj = transform * vec4(position, 0);
gl_Position = alignToPixelCenter(posProj, viewport.zw);
vcolor = color / 1.2;
vsize = size * 5.0 * pixelRatio;
gl_PointSize = vsize;
}`),e.fragment.code.add(n["a"]`void main() {
float cap = 0.7;
float scale = 1.0 / cap;
float helper = clamp(length(abs(gl_PointCoord - vec2(0.5))), 0.0, cap);
float alpha = clamp((cap - helper) * scale, 0.0, 1.0);
float intensity = alpha * alpha * alpha;
if (vsize < 3.0) {
intensity *= 0.5;
}
gl_FragColor = vec4(vcolor.xyz, intensity);
}`),e}const o=Object.freeze({__proto__:null,build:s})},"33e2":function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return s}));var r=i("d981"),n=i("3886");function a(e){e.fragment.uniforms.add("texWaveNormal","sampler2D"),e.fragment.uniforms.add("texWavePerturbation","sampler2D"),e.fragment.uniforms.add("waveParams","vec4"),e.fragment.uniforms.add("waveDirection","vec2"),e.include(r["b"]),e.fragment.code.add(n["a"]`const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);
vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture2D(_tex, _uv).rg - 1.0;
}
float sampleNoiseTexture(vec2 _uv) {
return texture2D(texWavePerturbation, _uv).b;
}
vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture2D(_tex, _uv).rgb - 1.0;
}
float computeProgress(vec2 uv, float time) {
return fract(time);
}
float computeWeight(vec2 uv, float time) {
float progress = computeProgress(uv, time);
return 1.0 - abs(1.0 - 2.0 * progress);
}
vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {
float flowStrength = waveParams[2];
float flowOffset = waveParams[3];
vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;
float progress = computeProgress(uv, time + phaseOffset);
float weight = computeWeight(uv, time + phaseOffset);
vec2 result = uv;
result -= flowVector * (progress + flowOffset);
result += phaseOffset;
result += (time - progress) * FLOW_JUMP;
return vec3(result, weight);
}
const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;
const float TIME_NOISE_STRENGTH = 7.77;
vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {
float waveStrength = waveParams[0];
vec2 waveMovement = time * -_waveDir;
float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;
vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);
vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);
vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;
vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;
vec3 mixNormal = normalize(normal_A + normal_B);
mixNormal.xy *= waveStrength;
mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));
return mixNormal;
}
vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {
float waveTextureRepeat = waveParams[1];
vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);
float foam  = normals2FoamIntensity(normal, waveParams[0]);
return vec4(normal, foam);
}`)}function s(e,t){e.setUniform4f("waveParams",t.waveStrength,t.waveTextureRepeat,t.flowStrength,t.flowOffset),e.setUniform2f("waveDirection",t.waveDirection[0]*t.waveVelocity,t.waveDirection[1]*t.waveVelocity)}},3544:function(e,t,i){"use strict";i.d(t,"a",(function(){return c})),i.d(t,"b",(function(){return l}));var r=i("b2b2");const n={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},a={dash:n.dash,"dash-dot":[...n.dash,...n.dot],dot:n.dot,"long-dash":n["long-dash"],"long-dash-dot":[...n["long-dash"],...n.dot],"long-dash-dot-dot":[...n["long-dash"],...n.dot,...n.dot],none:null,"short-dash":n["short-dash"],"short-dash-dot":[...n["short-dash"],...n["short-dot"]],"short-dash-dot-dot":[...n["short-dash"],...n["short-dot"],...n["short-dot"]],"short-dot":n["short-dot"],solid:null},s=8;function o(e,t=2){return Object(r["k"])(e)?e:{pattern:e.slice(),pixelRatio:t}}function c(e,t=2){return{pattern:[e,e],pixelRatio:t}}function l(e){return Object(r["l"])(e)&&"style"===e.type?o(a[e.style],s):null}},3563:function(e,t,i){"use strict";i.d(t,"a",(function(){return f})),i.d(t,"b",(function(){return s}));i("c120");var r=i("b2b2");function n(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++){const r=e[i],n=t[i];if(r.length!==n.length)return!1;for(let e=0;e<r.length;e++)if(r[e]!==n[e])return!1}return!0}function a(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(!n(e[i],t[i]))return!1;return!0}function s(e,t){return!!h(e.spatialReference,t.spatialReference)&&e.x===t.x&&e.y===t.y&&e.z===t.z&&e.m===t.m}function o(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!h(e.spatialReference,t.spatialReference)&&a(e.paths,t.paths)}function c(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!h(e.spatialReference,t.spatialReference)&&a(e.rings,t.rings)}function l(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!h(e.spatialReference,t.spatialReference)&&n(e.points,t.points)}function d(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!h(e.spatialReference,t.spatialReference)&&e.xmin===t.xmin&&e.ymin===t.ymin&&e.zmin===t.zmin&&e.xmax===t.xmax&&e.ymax===t.ymax&&e.zmax===t.zmax}function h(e,t){return e===t||e&&t&&e.equals(t)}function u(e,t){if(e===t)return!0;if(Object(r["k"])(e)||Object(r["k"])(t))return!1;if(e.type!==t.type)return!1;switch(e.type){case"point":return s(e,t);case"extent":return d(e,t);case"polyline":return o(e,t);case"polygon":return c(e,t);case"multipoint":return l(e,t);case"mesh":return!1;default:return}}function p(e,t){if(e===t)return!0;if(!e||!t)return!1;const i=Object.keys(e),r=Object.keys(t);if(i.length!==r.length)return!1;for(const n of i)if(e[n]!==t[n])return!1;return!0}function f(e,t){return e===t||null!=e&&null!=t&&e.objectId===t.objectId&&!!u(e.geometry,t.geometry)&&!!p(e.attributes,t.attributes)}},"35b3":function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return c}));var r=i("b2b2"),n=i("003f"),a=i("fa1e"),s=i("7c51");class o extends n["a"]{constructor(e,t){super(),this.type=3,this.supportsEdges=!1,this._visible=!0,this._renderPriority=0,this._insertOrder=0,this._vertexAttributeLocations=a["a"],this._parameters=Object(s["e"])(e,t),this.validateParameters(this._parameters)}dispose(){}get parameters(){return this._parameters}update(e){return!1}setParameters(e){Object(s["k"])(this._parameters,e)&&(this.validateParameters(this._parameters),this.parametersChanged())}validateParameters(e){}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this.parametersChanged())}shouldRender(e){return this.isVisible()&&this.isVisibleInPass(e.pass)&&0!=(this.renderOccluded&e.renderOccludedMask)}isVisibleInPass(e){return!0}get renderOccluded(){return this.parameters.renderOccluded}get renderPriority(){return this._renderPriority}set renderPriority(e){e!==this._renderPriority&&(this._renderPriority=e,this.parametersChanged())}get insertOrder(){return this._insertOrder}set insertOrder(e){e!==this._insertOrder&&(this._insertOrder=e,this.parametersChanged())}get vertexAttributeLocations(){return this._vertexAttributeLocations}isVisible(){return this._visible}parametersChanged(){Object(r["l"])(this.repository)&&this.repository.materialChanged(this)}}const c={renderOccluded:1}},3626:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i("4377"),n=i("3886");function a(e){e.include(r["a"]),e.code.add(n["a"]`
    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      vec3 internalMixed = internalColor * textureColor;
      vec3 allMixed = internalMixed * externalColor;

      if (mode == ${n["a"].int(1)}) {
        return allMixed;
      }
      else if (mode == ${n["a"].int(2)}) {
        return internalMixed;
      }
      else if (mode == ${n["a"].int(3)}) {
        return externalColor;
      }
      else {
        // tint (or something invalid)
        float vIn = rgb2v(internalMixed);
        vec3 hsvTint = rgb2hsv(externalColor);
        vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);
        return hsv2rgb(hsvOut);
      }
    }

    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      float internalMixed = internalOpacity * textureOpacity;
      float allMixed = internalMixed * externalOpacity;

      if (mode == ${n["a"].int(2)}) {
        return internalMixed;
      }
      else if (mode == ${n["a"].int(3)}) {
        return externalOpacity;
      }
      else {
        // multiply or tint (or something invalid)
        return allMixed;
      }
    }
  `)}},"365a":function(e,t,i){"use strict";i.d(t,"a",(function(){return f}));var r=i("a4ee"),n=i("fc29"),a=i("ce6d"),s=i("9096"),o=i("a5d8"),c=i("e92d"),l=i("b2b2"),d=i("fab3"),h=i("59b2"),u=(i("b50f"),i("c120"),i("cea0"),i("d386"));let p=class extends(Object(s["b"])(Object(o["a"])(Object(d["b"])(a["a"].EventedMixin(n["a"]))))){constructor(e){super(e),this.layer=null,this.parent=null}initialize(){this.when().catch(e=>{if("layerview:create-error"!==e.name){const t=this.layer&&this.layer.id||"no id",i=this.layer&&this.layer.title||"no title";throw c["a"].getLogger(this.declaredClass).error("#resolve()",`Failed to resolve layer view (layer title: '${i}', id: '${t}')`,e),e}})}get fullOpacity(){return Object(l["v"])(this.get("layer.opacity"),1)*Object(l["v"])(this.get("parent.fullOpacity"),1)}get suspended(){return!this.canResume()}get suspendInfo(){return this.getSuspendInfo()}get legendEnabled(){return!this.suspended&&!0===this.layer.legendEnabled}get updating(){return!!(this.updatingHandles&&this.updatingHandles.updating||this.isUpdating())}get updatingProgress(){return this.updating?0:1}get visible(){var e;return!0===(null==(e=this.layer)?void 0:e.visible)}set visible(e){void 0!==e?this._override("visible",e):this._clearOverride("visible")}canResume(){return!this.get("parent.suspended")&&this.get("view.ready")&&this.get("layer.loaded")&&this.visible||!1}getSuspendInfo(){const e=this.parent&&this.parent.suspended?this.parent.suspendInfo:{},t=this;return t.view&&t.view.ready||(e.viewNotReady=!0),this.layer&&this.layer.loaded||(e.layerNotLoaded=!0),this.visible||(e.layerInvisible=!0),e}isUpdating(){return!1}};Object(r["a"])([Object(h["b"])()],p.prototype,"fullOpacity",null),Object(r["a"])([Object(h["b"])()],p.prototype,"layer",void 0),Object(r["a"])([Object(h["b"])()],p.prototype,"parent",void 0),Object(r["a"])([Object(h["b"])({readOnly:!0})],p.prototype,"suspended",null),Object(r["a"])([Object(h["b"])({readOnly:!0})],p.prototype,"suspendInfo",null),Object(r["a"])([Object(h["b"])({readOnly:!0})],p.prototype,"legendEnabled",null),Object(r["a"])([Object(h["b"])({type:Boolean,readOnly:!0})],p.prototype,"updating",null),Object(r["a"])([Object(h["b"])({readOnly:!0})],p.prototype,"updatingProgress",null),Object(r["a"])([Object(h["b"])()],p.prototype,"visible",null),p=Object(r["a"])([Object(u["a"])("esri.views.layers.LayerView")],p);const f=p},"36cf":function(e,t,i){"use strict";i.d(t,"a",(function(){return _})),i.d(t,"b",(function(){return v})),i.d(t,"c",(function(){return C})),i.d(t,"d",(function(){return d})),i.d(t,"e",(function(){return f})),i.d(t,"f",(function(){return m})),i.d(t,"g",(function(){return w})),i.d(t,"h",(function(){return y})),i.d(t,"i",(function(){return O})),i.d(t,"j",(function(){return g})),i.d(t,"k",(function(){return P})),i.d(t,"l",(function(){return x})),i.d(t,"m",(function(){return j})),i.d(t,"n",(function(){return h})),i.d(t,"o",(function(){return T}));var r=i("d791"),n=i("e431"),a=i("0b2d"),s=i("f694"),o=i("5996"),c=i("0d9f"),l=i("f895");function d(e){const{value:t,operations:i}=e;return{operations:i,value:i.create(t)}}function h(e,t,i){return e.operations.setExtent(e.value,t,i.value),i}function u(e){return{operations:e,value:e.create()}}function p(e,t,i=u(e)){return i.operations=e,e.copy(t,i.value),i}function f(e){return p(l["m"],Object(l["f"])(0,0,0,Object(s["e"])(e).radius))}const b=2**50;function m(){return p(c["c"],Object(c["g"])([0,0,0],[b,0,0],[0,b,0]))}function g(e,t,i){return e.operations.axisAt(e.value,t,2,i)}function v(e,t,i,r){return e.operations.axisAt(e.value,t,i,r)}function y(e,t,i){return e.operations.intersectRay(e.value,t,i)}function O(e,t,i){return e.operations.intersectRayClosestSilhouette(e.value,t,i)}function _(e,t){return e.operations.altitudeAt(e.value,t)}function x(e,t,i,r){return e.operations.setAltitudeAt(e.value,t,i,r)}function j(e,t,i,a){return t!==a&&Object(r["d"])(a,t),Object(n["z"])(S,a[12],a[13],a[14]),x(e,S,i,S),a[12]=S[0],a[13]=S[1],a[14]=S[2],a}function w(e,t,i){return e.operations.elevate(e.value,t,i.value)}const S=Object(a["f"])();function T(e,t,i,r,a){return a[0]=Object(n["k"])(e,t),a[1]=Object(n["k"])(e,i),a[2]=Object(n["k"])(e,r),a}function C(e,t,i,r,a){Object(n["n"])(i,e),Object(n["n"])(A,t),Object(n["u"])(A,A),Object(n["j"])(r,A,i),Object(n["j"])(a,r,i)}function P(e,t){return e?Object(s["g"])(t):t.isGeographic?o["a"].PlateCarree:t}const A=Object(a["f"])()},"36df":function(e,t,i){"use strict";i.d(t,"a",(function(){return l})),i.d(t,"b",(function(){return c}));var r=i("2aad"),n=i("d047"),a=i("58c2"),s=i("3886"),o=i("690a");function c(e){const t=new o["a"];return t.include(r["a"]),1===e.output&&(t.fragment.include(n["a"]),t.fragment.uniforms.add("normalMap","sampler2D").add("depthMap","sampler2D").add("tex","sampler2D").add("blurSize","vec2").add("projScale","float").add("nearFar","vec2"),t.fragment.code.add(s["a"]`
      void blurFunction(vec2 uv, float r, float center_d, float sharpness, inout float wTotal, inout float bTotal) {
        float c = texture2D(tex, uv).r;
        float d = linearDepthFromTexture(depthMap, uv, nearFar);

        float ddiff = d - center_d;

        float w = exp(-r * r * ${s["a"].float(e.blurFalloff)} - ddiff * ddiff * sharpness);
        wTotal += w;
        bTotal += w * c;
      }
    `),t.fragment.code.add(s["a"]`
      void main(void) {
        float b = 0.0;
        float w_total = 0.0;

        float center_d = linearDepthFromTexture(depthMap, uv, nearFar);

        float sharpness = -0.05 * projScale/center_d;
        for (int r = -${s["a"].int(e.filterRadius)}; r <= ${s["a"].int(e.filterRadius)}; ++r) {
          float rf = float(r);
          vec2 uvOffset = uv + rf * blurSize;
          blurFunction(uvOffset, rf, center_d, sharpness, w_total, b);
        }

        gl_FragColor = vec4(b / w_total);
      }
    `)),0===e.output&&(t.fragment.include(n["a"]),t.include(a["a"]),t.fragment.uniforms.add("normalMap","sampler2D").add("depthMap","sampler2D").add("intensity","float").add("projScale","float").add("radius","float").add("nearFar","vec2").add("screenDimensions","vec2").add("rnmScale","vec2").add("rnm","sampler2D"),t.fragment.code.add(s["a"]`vec3 sphere[16];
void fillSphere() {
sphere[0] = vec3(0.186937, 0.0, 0.0);
sphere[1] = vec3(0.700542, 0.0, 0.0);
sphere[2] = vec3(-0.864858, -0.481795, -0.111713);
sphere[3] = vec3(-0.624773, 0.102853, -0.730153);
sphere[4] = vec3(-0.387172, 0.260319, 0.007229);
sphere[5] = vec3(-0.222367, -0.642631, -0.707697);
sphere[6] = vec3(-0.01336, -0.014956, 0.169662);
sphere[7] = vec3(0.122575, 0.1544, -0.456944);
sphere[8] = vec3(-0.177141, 0.85997, -0.42346);
sphere[9] = vec3(-0.131631, 0.814545, 0.524355);
sphere[10] = vec3(-0.779469, 0.007991, 0.624833);
sphere[11] = vec3(0.308092, 0.209288,0.35969);
sphere[12] = vec3(0.359331, -0.184533, -0.377458);
sphere[13] = vec3(0.192633, -0.482999, -0.065284);
sphere[14] = vec3(0.233538, 0.293706, -0.055139);
sphere[15] = vec3(0.417709, -0.386701, 0.442449);
}
float fallOffFunction(float vv, float vn, float bias) {
float f = max(radius * radius - vv, 0.0);
return f * f * f * max(vn-bias, 0.0);
}`),t.fragment.code.add(s["a"]`float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {
vec3 v = Q - C;
float vv = dot(v, v);
float vn = dot(normalize(v), n_C);
return fallOffFunction(vv, vn, 0.1);
}`),t.fragment.code.add(s["a"]`
      void main(void) {
        fillSphere();
        vec3 fres = normalize((texture2D(rnm, uv * rnmScale).xyz * 2.0) - vec3(1.0));
        float currentPixelDepth = linearDepthFromTexture(depthMap, uv, nearFar);

        if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
          gl_FragColor = vec4(0.0);
          return;
        }

        vec3 currentPixelPos = reconstructPosition(gl_FragCoord.xy,currentPixelDepth);

        // get the normal of current fragment
        vec4 norm4 = texture2D(normalMap, uv);
        vec3 norm = vec3(-1.0) + 2.0 * norm4.xyz;
        bool isTerrain = norm4.w<0.5;

        float sum = .0;
        vec3 tapPixelPos;

        // note: the factor 2.0 should not be necessary, but makes ssao much nicer.
        // bug or deviation from CE somewhere else?
        float ps = projScale/(2.0 * currentPixelPos.z * zScale.x + zScale.y);

        for(int i = 0; i < ${s["a"].int(e.samples)}; ++i) {
          vec2 unitOffset = reflect(sphere[i], fres).xy;
          vec2 offset = vec2(-unitOffset * radius * ps);

          //don't use current or very nearby samples
          if ( abs(offset.x)<2.0 || abs(offset.y)<2.0) continue;

          vec2 tc = vec2(gl_FragCoord.xy + offset);
          if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenDimensions.x || tc.y > screenDimensions.y) continue;
          vec2 tcTap = tc/screenDimensions;
          float occluderFragmentDepth = linearDepthFromTexture(depthMap, tcTap, nearFar);

          if (isTerrain) {
            bool isTerrainTap = texture2D(normalMap, tcTap).w<0.5;
            if (isTerrainTap) {
              continue;
            }
          }

          tapPixelPos = reconstructPosition(tc, occluderFragmentDepth);

          sum+= aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);
        }

        // output the result
        float A = max(1.0-sum*intensity/float(${s["a"].int(e.samples)}),0.0);

        // Anti-tone map to reduce contrast and drag dark region farther: (x^0.2 + 1.2 * x^4)/2.2
        A = (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;
        gl_FragColor = vec4(A);
      }
    `)),t}const l=Object.freeze({__proto__:null,build:c})},3748:function(e,t,i){"use strict";i.d(t,"a",(function(){return F}));var r=i("e92d"),n=i("b2b2"),a=i("a915"),s=i("3349"),o=i("e431"),c=i("0b2d"),l=i("bd7e"),d=i("7289"),h=i("8190"),u=i("1038"),p=i("d7f7"),f=i("35b3"),b=i("1153"),m=i("5957"),g=i("8675"),v=i("7c51"),y=i("b623"),O=i("a4ee"),_=i("d272"),x=i("6a07"),j=i("8e97"),w=i("c3a4"),S=i("ca98"),T=i("da35"),C=i("fa1e"),P=i("c829"),A=i("87b7"),M=i("713b"),R=i("189c");class E extends S["a"]{constructor(e,t,i){super(e,t,i),this.stipplePattern=null,this.stippleTextureBind=null,this.stippleTextureRepository=e.stippleTextureRepository}get stippleEnabled(){return this.configuration.stippleEnabled&&4!==this.configuration.output}initializeProgram(e){const t=E.shader.get(),i=this.configuration,r=t.build({output:i.output,attributeColor:i.vertexColors,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,draped:i.draped,stippleEnabled:this.stippleEnabled,stippleOffColorEnabled:i.stippleOffColorEnabled,stippleRequiresClamp:!1,stippleScaleWithLineWidth:!1,stipplePreferContinuous:i.stipplePreferContinuous});return new P["a"](e.rctx,r,C["a"])}dispose(){super.dispose(),this.stippleTextureRepository.release(this.stipplePattern),this.stipplePattern=null,this.stippleTextureBind=null}bindPass(e,t){if(Object(j["c"])(this.program,t.camera.projectionMatrix),this.stipplePattern!==e.stipplePattern){const t=e.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,t),this.stipplePattern=t}if(this.stippleEnabled){const{pixelSize:e,sdfNormalizer:i,pixels:r}=Object(n["l"])(this.stippleTextureBind)?this.stippleTextureBind(this.program):{pixelSize:1,sdfNormalizer:1,pixels:1};this.program.setUniform1f("stipplePatternSDFNormalizer",i),this.program.setUniform1f("stipplePatternTextureSize",r),this.program.setUniform1f("stipplePatternPixelSize",e),this.program.setUniform1f("stipplePatternPixelSizeInv",1/e),this.program.setUniform1f("pixelRatio",t.camera.pixelRatio),this.configuration.draped?this.program.setUniform1f("worldToScreenRatio",1/t.screenToPCSRatio):this.program.setUniform1f("worldToScreenPerDistanceRatio",1/t.camera.perScreenPixelRatio),this.program.setUniform2f("ndcToPixel",t.camera.fullViewport[2]/2,t.camera.fullViewport[3]/2)}if(this.program.setUniform4fv("constantColor",e.color),this.program.setUniform1f("alphaCoverage",Math.min(1,e.width*t.camera.pixelRatio)),this.configuration.stippleOffColorEnabled){const t=Object(n["u"])(e.stippleOffColor);this.program.setUniform4f("stippleOffColor",t[0],t[1],t[2],t.length>3?t[3]:1)}4===this.configuration.output&&Object(x["b"])(this.program,t)}bindDraw(e){Object(j["d"])(this.program,e),this.stippleEnabled&&!this.configuration.draped&&Object(j["a"])(this.program,e.origin,e.camera.viewInverseTransposeMatrix),Object(_["c"])(this.program,this.configuration,e),this.program.rebindTextures()}initializePipeline(){const e=this.configuration,t=Object(R["h"])(770,1,771,771),i=(t,i=null,r=null)=>Object(R["g"])({blending:i,depthTest:A["b"],depthWrite:r,colorWrite:R["d"],stencilWrite:e.sceneHasOcludees?A["j"]:null,stencilTest:e.sceneHasOcludees?t?A["f"]:A["e"]:null});return 0===e.output?(this._occludeePipelineState=i(!0,e.transparent||this.stippleEnabled?t:null,R["e"]),i(!1,e.transparent||this.stippleEnabled?t:null,R["e"])):i(!1)}get primitiveType(){return 1}getPipelineState(e,t){return t?this._occludeePipelineState:super.getPipelineState(e,t)}}E.shader=new w["a"](M["a"],()=>i.e("chunk-2d20f1b1").then(i.bind(null,"b1e1")));class D extends T["a"]{constructor(){super(...arguments),this.output=0,this.slicePlaneEnabled=!1,this.vertexColors=!1,this.transparent=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stipplePreferContinuous=!0,this.sceneHasOcludees=!1}}Object(O["a"])([Object(T["b"])({count:8})],D.prototype,"output",void 0),Object(O["a"])([Object(T["b"])()],D.prototype,"slicePlaneEnabled",void 0),Object(O["a"])([Object(T["b"])()],D.prototype,"vertexColors",void 0),Object(O["a"])([Object(T["b"])()],D.prototype,"transparent",void 0),Object(O["a"])([Object(T["b"])()],D.prototype,"draped",void 0),Object(O["a"])([Object(T["b"])()],D.prototype,"stippleEnabled",void 0),Object(O["a"])([Object(T["b"])()],D.prototype,"stippleOffColorEnabled",void 0),Object(O["a"])([Object(T["b"])()],D.prototype,"stipplePreferContinuous",void 0),Object(O["a"])([Object(T["b"])()],D.prototype,"sceneHasOcludees",void 0);const I=r["a"].getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial");class F extends f["a"]{constructor(e){super(e,V),this._techniqueConfig=new D}getTechniqueConfig(e,t){this._techniqueConfig.output=e,this._techniqueConfig.slicePlaneEnabled=this.parameters.slicePlaneEnabled,this._techniqueConfig.vertexColors=this.parameters.vertexColors,this._techniqueConfig.transparent=this.parameters.color[3]<1||this.parameters.width<1,this._techniqueConfig.draped=20===t.slot;const i=Object(n["l"])(this.parameters.stipplePattern);return this._techniqueConfig.stippleEnabled=i,this._techniqueConfig.stippleOffColorEnabled=i&&Object(n["l"])(this.parameters.stippleOffColor),this._techniqueConfig.sceneHasOcludees=this.parameters.sceneHasOcludees,this._techniqueConfig.stipplePreferContinuous=this.parameters.stipplePreferContinuous,this._techniqueConfig}getPassParameters(){return this.parameters}intersect(e,t,i,r,a,s,o,c,l){Object(n["l"])(l)?Object(v["h"])(e,r,l,s,1,o):this.intersectLineGeometry(e,t,i,r,o)}intersectLineGeometry(e,t,i,r,n){if(!r.options.selectionMode||Object(y["d"])(t))return;if(!Object(b["g"])(i))return void I.error("intersection assumes a translation-only matrix");const a=e.vertexAttributes.get("position").data,c=r.camera,h=Q;Object(s["c"])(h,r.point);const u=2;Object(o["z"])(X[0],h[0]-u,h[1]+u,0),Object(o["z"])(X[1],h[0]+u,h[1]+u,0),Object(o["z"])(X[2],h[0]+u,h[1]-u,0),Object(o["z"])(X[3],h[0]-u,h[1]-u,0);for(let s=0;s<4;s++)if(!c.unprojectFromRenderScreen(X[s],Y[s]))return;Object(d["g"])(c.eye,Y[0],Y[1],K),Object(d["g"])(c.eye,Y[1],Y[2],J),Object(d["g"])(c.eye,Y[2],Y[3],ee),Object(d["g"])(c.eye,Y[3],Y[0],te);let p=Number.MAX_VALUE,f=0;for(let s=0;s<a.length-5;s+=3){if(k[0]=a[s]+i[12],k[1]=a[s+1]+i[13],k[2]=a[s+2]+i[14],U[0]=a[s+3]+i[12],U[1]=a[s+4]+i[13],U[2]=a[s+5]+i[14],Object(d["v"])(K,k)<0&&Object(d["v"])(K,U)<0||Object(d["v"])(J,k)<0&&Object(d["v"])(J,U)<0||Object(d["v"])(ee,k)<0&&Object(d["v"])(ee,U)<0||Object(d["v"])(te,k)<0&&Object(d["v"])(te,U)<0)continue;if(c.projectToRenderScreen(k,G),c.projectToRenderScreen(U,q),G[2]<0&&q[2]>0){Object(o["m"])(B,k,U);const e=c.frustum,t=-Object(d["v"])(e[4],k)/Object(o["k"])(B,Object(d["r"])(e[4]));Object(o["h"])(B,B,t),Object(o["i"])(k,k,B),c.projectToRenderScreen(k,G)}else if(G[2]>0&&q[2]<0){Object(o["m"])(B,U,k);const e=c.frustum,t=-Object(d["v"])(e[4],U)/Object(o["k"])(B,Object(d["r"])(e[4]));Object(o["h"])(B,B,t),Object(o["i"])(U,U,B),c.projectToRenderScreen(U,q)}else if(G[2]<0&&q[2]<0)continue;G[2]=0,q[2]=0;const e=Object(l["e"])(Object(l["f"])(G,q,$),h);e<p&&(p=e,Object(o["n"])(H,k),Object(o["n"])(W,U),f=s/3)}const m=r.rayBegin,g=r.rayEnd;if(p<u*u){let e=Number.MAX_VALUE;if(Object(l["a"])(Object(l["f"])(H,W,$),Object(l["f"])(m,g,Z),N)){Object(o["m"])(N,N,m);const t=Object(o["s"])(N);Object(o["h"])(N,N,1/t),e=t/Object(o["p"])(m,g)}n(e,N,f,!1)}}computeAttachmentOrigin(e,t){const i=e.vertexAttributes;if(!i)return!1;const r=i.get("position");return Object(u["a"])(r,null,!1,t)}requiresSlot(e){return 2===e||20===e}createGLMaterial(e){return 0===e.output||4===e.output?new z(e):null}createBufferWriter(){const e=this.parameters.vertexColors?g["b"]:g["c"];return Object(n["k"])(this.parameters.stipplePattern)?new g["a"](e):new L(e.clone().vec3f("auxpos1").vec2f("uv0"))}}class z extends p["a"]{updateParameters(e){return this.ensureTechnique(E,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.sceneHasOcludees&&this._material.setParameters({sceneHasOcludees:e.hasOccludees})}beginSlot(e){return 0===this._output&&this._updateOccludeeState(e),this.updateParameters(e)}bind(e,t){t.bindPass(this._material.getPassParameters(),e)}}class L{constructor(e){this.vertexBufferLayout=e}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return e.indices.get("position").length}write(e,t,i,r){Object(m["c"])(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,i,r),this.writeAuxpos1(e,t,i,r),this.writeUV0(e,t,i,r)}writeAuxpos1(e,t,i,r){const n=i.getField("auxpos1",h["u"]),a=t.indices.get("position"),s=t.vertexAttributes.get("position").data,o=e.transformation,c=n.typedBufferStride,l=n.typedBuffer;r*=c;for(let d=0;d<a.length-1;d+=2)for(const e of[1,0]){const t=3*a[d+e],i=s[t],n=s[t+1],h=s[t+2],u=o[0]*i+o[4]*n+o[8]*h+o[12],p=o[1]*i+o[5]*n+o[9]*h+o[13],f=o[2]*i+o[6]*n+o[10]*h+o[14];l[r]=u,l[r+1]=p,l[r+2]=f,r+=c}}writeUV0(e,t,i,r){var n;const a=i.getField("uv0",h["m"]),s=t.indices.get("position"),c=t.vertexAttributes.get("position").data,l=null==(n=t.vertexAttributes.get("distanceToStart"))?void 0:n.data,d=e.transformation,u=a.typedBufferStride,p=a.typedBuffer;let f=0;p[r*=u]=0,p[r+1]=f,r+=u;const b=3*s[0],m=Object(o["z"])(k,c[b],c[b+1],c[b+2]);d&&Object(o["t"])(m,m,d);const g=U,v=s.length-1;let y=1;const O=l?(e,t,i)=>f=l[i]:(e,t,i)=>f+=Object(o["p"])(e,t);for(let h=1;h<v;h+=2){const e=3*s[h];Object(o["z"])(g,c[e],c[e+1],c[e+2]),d&&Object(o["t"])(g,g,d),O(m,g,y++);for(let t=0;t<2;++t)p[r]=1-t,p[r+1]=f,r+=u;Object(o["n"])(m,g)}const _=3*s[v];Object(o["z"])(g,c[_],c[_+1],c[_+2]),d&&Object(o["t"])(g,g,d),O(m,g,y),p[r]=1,p[r+1]=f}}const V={color:[1,1,1,1],vertexColors:!1,slicePlaneEnabled:!1,width:1,stipplePattern:null,stippleOffColor:null,stipplePreferContinuous:!0,sceneHasOcludees:!1,...f["b"]},k=Object(c["f"])(),U=Object(c["f"])(),B=Object(c["f"])(),N=Object(c["f"])(),G=Object(a["e"])(),q=Object(a["e"])(),H=Object(c["f"])(),W=Object(c["f"])(),$=Object(l["d"])(),Z=Object(l["d"])(),Q=Object(c["f"])(),X=[Object(a["e"])(),Object(a["e"])(),Object(a["e"])(),Object(a["e"])()],Y=[Object(c["f"])(),Object(c["f"])(),Object(c["f"])(),Object(c["f"])()],K=Object(d["d"])(),J=Object(d["d"])(),ee=Object(d["d"])(),te=Object(d["d"])()},3886:function(e,t,i){"use strict";function r(e,...t){let i="";for(let r=0;r<t.length;r++)i+=e[r]+t[r];return i+=e[e.length-1],i}i.d(t,"a",(function(){return r})),function(e){function t(e){return Math.round(e).toString()}function i(e){return e.toPrecision(8)}e.int=t,e.float=i}(r||(r={}))},"3af9":function(e,t,i){"use strict";i.d(t,"a",(function(){return x})),i.d(t,"b",(function(){return j}));var r=i("a4ee"),n=i("2eab"),a=i("fc29"),s=i("b50f"),o=i("ce50"),c=i("7ffa"),l=i("b2b2"),d=i("f4cc"),h=i("59b2"),u=(i("cea0"),i("d386")),p=i("1153");class f{constructor(e){this.client=e,this._cancelled=!1,this.size=0,this.duration=0}}class b{constructor(e){this.typeWorkerQuota=e,this.tasks=new Array,this.numWorkers=0,this.statistics=new m}}class m{constructor(){this.requests=0,this.size=0,this.duration=0,this.speed=0}}class g{constructor(e,t,i,r){this._workerFunc=e,this._callbackFunc=t,this._maxTotalNumWorkers=i,this._totalNumWorkers=0,this._clients=r.map(e=>new b(e))}hasQuota(e){const t=this._clients[e];return!!t&&(this._totalNumWorkers<this._maxTotalNumWorkers||t.numWorkers+t.tasks.length<t.typeWorkerQuota)}push(e){const t=this._clients[e.client];t&&(this._totalNumWorkers<this._maxTotalNumWorkers?(t.numWorkers++,this._totalNumWorkers++,this._workerFunc(e,(e,t)=>this._taskCallback(e,t))):t.tasks.push(e))}cancel(e){this._taskFinished(e),e._cancelled=!0}destroy(){this._clients.length=0}_taskFinished(e){const t=this._clients[e.client];this._totalNumWorkers--,t.numWorkers--,t.statistics.requests++,t.statistics.size+=e.size||0,t.statistics.duration+=e.duration||0,t.statistics.speed=t.statistics.duration>0?t.statistics.size/t.statistics.duration:0,Object(p["a"])(t.numWorkers>=0),this._next()}_next(){for(const e of this._clients)if(e&&e.numWorkers<e.typeWorkerQuota&&this._processQueue(e))return;for(const e of this._clients)if(e&&this._processQueue(e))return}_processQueue(e){for(;e.tasks.length>0;)if(this._workerFunc(e.tasks.shift(),(e,t)=>this._taskCallback(e,t)))return e.numWorkers++,this._totalNumWorkers++,!0;return!1}_taskCallback(e,t){e._cancelled||(this._callbackFunc(e,t),this._taskFinished(e))}getStatsForType(e){const t=this._clients[e];return t?{quota:t.typeWorkerQuota,workers:t.numWorkers,queueSize:t.tasks.length,requestStats:t.statistics}:null}get test(){const e=this;return{set workerFunc(t){e._workerFunc=t}}}}class v extends f{constructor(e,t,i,r,n){super(r),this.url=e,this.options=t,this.docType=i,this.key=n,this.result=null,this.status=1,this.request=null,this.abortController=null,this.resolvers=new Array,this.startTime=0}}var y=i("9305");let O=class extends a["a"]{constructor(){super(...arguments),this.tasks=new Map,this.onLoadQueue=new Array,this.doneQueue=new Array,this.updating=!1}setup(e,t,i){this.loadQueue=new g((e,t)=>this.startLoading(e,t),(e,t)=>this.doneLoadingCallback(e,t),e,t),i&&(this.taskHandle=i.registerTask(y["b"].STREAM_DATA_LOADER,this))}destroy(){this.taskHandle=Object(l["t"])(this.taskHandle),this.tasks.forEach(e=>{e.abortController&&e.abortController.abort()}),this.loadQueue.destroy(),this.loadQueue=null,this.onLoadQueue=null,this.doneQueue=null,this.tasks=null}hasDownloadSlots(e){return this.loadQueue.hasQuota(e)}request(e,t,i,r={}){const n=Object(d["g"])();n.__signal=Object(l["l"])(r)?r.signal:null;const a=this.createOrUpdateTask(e,t,i,r,n);return Object(d["r"])(r,()=>this.cancelRequest(a,n)),n.promise}createTask(e,t,i,r,n,a){const s=new v(e,t,i,r,n);return this.updateTask(s,a),this.tasks.set(n,s),1===this.tasks.size&&this._set("updating",!0),this.loadQueue.push(s),s}cancelRequest(e,t){Object(s["k"])(e.resolvers,t),t.reject(Object(d["e"])()),0===e.resolvers.length&&(2===e.status&&(e.status=4,this.loadQueue.cancel(e),e.abortController.abort(),e.request=null,e.abortController=null),e.status=4,this.tasks.delete(e.key),0===this.tasks.size&&this._set("updating",!1))}taskKey(e,t,i){return`${e}:${t}:${i}`}updateTask(e,t){e.resolvers.push(t)}createOrUpdateTask(e,t,i,r,n){const a=Object(l["l"])(r)&&r.uid||e,s=this.taskKey(a,t,i),o=this.tasks.get(s);return o?(this.updateTask(o,n),o):this.createTask(e,r,t,i,s,n)}doneLoadingCallback(e,t){this.loadQueue&&(Object(p["a"])(2===e.status),e.status=3,this.taskHandle?this.doneQueue.push({task:e,err:t}):this.doneLoading(e,t))}get running(){return this.doneQueue.length>0||this.onLoadQueue.length>0}runTask(e){for(;!e.done&&this.onLoadQueue.length>0;){const t=this.onLoadQueue.shift();Object(d["w"])(t.task.abortController),t.task.abortController=null,t.callback(t.task),e.madeProgress()}for(;!e.done&&this.doneQueue.length>0;){const t=this.doneQueue.shift();3!==t.task.status&&(t.err=t.err||Object(d["e"])()),this.doneLoading(t.task,t.err),e.madeProgress()}}doneLoading(e,t){let i=e.result instanceof HTMLImageElement?0:e.resolvers.length;for(const r of e.resolvers)if(t)Object(d["m"])(t)?r.reject(t):r.reject(new o["a"]("stream-data-loader:request-error",`Failed to request resource at '${e.url}'. ${t}`,{url:e.url,error:t}));else{--i;const t=i<=0?e.result:Object(c["a"])(e.result);r.resolve(t)}this.tasks.delete(e.key),0===this.tasks.size&&this._set("updating",!1)}startLoading(e,t){if(4===e.status)return!1;let i,r;switch(e.startTime=performance.now(),e.status=2,e.docType){case"binary":r="array-buffer",i=0;break;case"image":r="image";break;case"image+type":r="array-buffer";break;default:r="json"}e.abortController=new AbortController;const a=e.abortController.signal;e.request=Object(n["default"])(e.url,{...e.options,responseType:r,timeout:i,signal:a});let s=()=>{};const o=i=>{e.duration=performance.now()-e.startTime,e.size=i instanceof ArrayBuffer?i.byteLength:e.size||0,e.result=i,this.taskHandle?this.onLoadQueue.push({callback:t,task:e}):(e.abortController=null,t(e))},c=i=>{2===e.status&&t(e,i),s()};return"image+type"!==e.docType?(e.request.then(e=>o(e.data),c),!0):(e.request.then(t=>{const l=t.data,d=_(l);if(r="image",e.size=l.byteLength,"unknown"===d)return e.request=Object(n["default"])(e.url,{responseType:r,timeout:i,signal:a}),void e.request.then(e=>o(e.data),c);const h=new Blob([l],{type:d}),u=window.URL.createObjectURL(h);s=()=>window.URL.revokeObjectURL(u),e.request=Object(n["default"])(u,{responseType:r,timeout:i,signal:a}),e.request.then(e=>o(new x(e.data,d,s)),c)},c),!0)}get test(){return{loadQueue:this.loadQueue}}};function _(e){if(e.byteLength<2)return"unknown";const t=new Uint8Array(e,0,e.byteLength);return 137===t[0]&&80===t[1]?"image/png":71===t[0]&&73===t[1]?"image/gif":66===t[0]&&77===t[1]?"image/bmp":255===t[0]&&216===t[1]?"image/jpeg":"unknown"}Object(r["a"])([Object(h["b"])({readOnly:!0})],O.prototype,"updating",void 0),O=Object(r["a"])([Object(u["a"])("esri.views.3d.support.StreamDataLoader")],O);class x{constructor(e,t,i){this.image=e,this.type=t,this.release=i}get isOpaque(){return"image/jpeg"===this.type}}const j=O},"3c3b":function(e,t,i){"use strict";i.d(t,"a",(function(){return B}));var r=i("b2b2"),n=i("afe1"),a=i("ce50"),s=i("e92d");const o=s["a"].getLogger("esri.views.3d.glTF");class c{error(e){throw new a["a"]("gltf-loader-error",e)}errorUnsupported(e){throw new a["a"]("gltf-loader-unsupported-feature",e)}errorUnsupportedIf(e,t){e&&this.errorUnsupported(t)}assert(e,t){e||this.error(t)}warn(e){o.warn(e)}warnUnsupported(e){this.warn("[Unsupported Feature] "+e)}warnUnsupportedIf(e,t){e&&this.warnUnsupported(t)}}function l(e={}){return{color:[1,1,1],opacity:1,alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1,castShadows:!0,receiveShadows:!0,receiveAmbientOcclustion:!0,textureColor:null,textureNormal:null,textureOcclusion:null,textureEmissive:null,textureMetallicRoughness:null,emissiveFactor:[0,0,0],metallicFactor:1,roughnessFactor:1,colorMixMode:"multiply",...e}}function d(e,t={}){return{data:e,parameters:{wrap:{s:10497,t:10497,...t.wrap},noUnpackFlip:!0,mipmap:!1,...t}}}var h=i("6c97"),u=i("28eb"),p=i("e041"),f=i("549a"),b=i("d791"),m=i("04f0"),g=i("b139"),v=i("8190"),y=i("7cfb");class O{constructor(e){this.data=e,this.offset4=0,this.dataUint32=new Uint32Array(this.data,0,Math.floor(this.data.byteLength/4))}readUint32(){const e=this.offset4;return this.offset4+=1,this.dataUint32[e]}readUint8Array(e){const t=4*this.offset4;return this.offset4+=e/4,new Uint8Array(this.data,t,e)}remainingBytes(){return this.data.byteLength-4*this.offset4}}const _={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},x={pbrMetallicRoughness:_,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1},j={ESRI_externalColorMixMode:"tint"},w=(e={})=>{const t={..._,...e.pbrMetallicRoughness},i=S({...j,...e.extras});return{...x,...e,pbrMetallicRoughness:t,extras:i}};function S(e){switch(e.ESRI_externalColorMixMode){case"multiply":case"tint":case"ignore":case"replace":break;default:Object(h["a"])(e.ESRI_externalColorMixMode),e.ESRI_externalColorMixMode="tint"}return e}const T={magFilter:9729,minFilter:9987,wrapS:10497,wrapT:10497},C=e=>({...T,...e});function P(e){let t,i;return e.replace(/^(.*\/)?([^/]*)$/,(e,r,n)=>(t=r||"",i=n||"","")),{dirPart:t,filePart:i}}const A={MAGIC:1179937895,CHUNK_TYPE_JSON:1313821514,CHUNK_TYPE_BIN:5130562,MIN_HEADER_LENGTH:20};class M{constructor(e,t,i,r,n){this.context=e,this.errorContext=t,this.uri=i,this.json=r,this.glbBuffer=n,this.bufferLoaders=new Map,this.textureLoaders=new Map,this.textureCache=new Map,this.materialCache=new Map,this.nodeParentMap=new Map,this.nodeTransformCache=new Map,this.baseUri=P(this.uri).dirPart,this.checkVersionSupported(),this.checkRequiredExtensionsSupported(),t.errorUnsupportedIf(null==r.scenes,"Scenes must be defined."),t.errorUnsupportedIf(null==r.meshes,"Meshes must be defined"),t.errorUnsupportedIf(null==r.nodes,"Nodes must be defined."),this.computeNodeParents()}static async load(e,t,i,r){if(Object(p["u"])(i)){const r=Object(p["i"])(i);if("model/gltf-binary"!==r.mediaType)try{const n=JSON.parse(r.isBase64?atob(r.data):r.data);return new M(e,t,i,n)}catch{}const n=Object(p["j"])(i);if(M.isGLBData(n))return this.fromGLBData(e,t,i,n)}if(i.endsWith(".gltf")){const n=await e.loadJSON(i,r);return new M(e,t,i,n)}const n=await e.loadBinary(i,r);if(M.isGLBData(n))return this.fromGLBData(e,t,i,n);const a=await e.loadJSON(i,r);return new M(e,t,i,a)}static isGLBData(e){const t=new O(e);return t.remainingBytes()>=4&&t.readUint32()===A.MAGIC}static async fromGLBData(e,t,i,r){const n=await M.parseGLBData(t,r);return new M(e,t,i,n.json,n.binaryData)}static async parseGLBData(e,t){const i=new O(t);e.assert(i.remainingBytes()>=12,"GLB binary data is insufficiently large.");const r=i.readUint32(),n=i.readUint32(),a=i.readUint32();e.assert(r===A.MAGIC,"Magic first 4 bytes do not fit to expected GLB value."),e.assert(t.byteLength>=a,"GLB binary data is smaller than header specifies."),e.errorUnsupportedIf(2!==n,"An unsupported GLB container version was detected. Only version 2 is supported.");let s,o,c=0;for(;i.remainingBytes()>=8;){const t=i.readUint32(),r=i.readUint32();0===c?(e.assert(r===A.CHUNK_TYPE_JSON,"First GLB chunk must be JSON."),e.assert(t>=0,"No JSON data found."),s=await L(i.readUint8Array(t))):1===c?(e.errorUnsupportedIf(r!==A.CHUNK_TYPE_BIN,"Second GLB chunk expected to be BIN."),o=i.readUint8Array(t)):e.warnUnsupported("More than 2 GLB chunks detected. Skipping."),c+=1}return s||e.error("No GLB JSON chunk detected."),{json:s,binaryData:o}}async getBuffer(e,t){const i=this.json.buffers[e],r=this.errorContext;if(null==i.uri)return r.assert(null!=this.glbBuffer,"GLB buffer not present"),this.glbBuffer;const n=await this.getBufferLoader(e,t);return r.assert(n.byteLength===i.byteLength,"Buffer byte lengths should match."),n}async getBufferLoader(e,t){const i=this.bufferLoaders.get(e);if(i)return i;const r=this.json.buffers[e],n=this.context.loadBinary(this.resolveUri(r.uri),t).then(e=>new Uint8Array(e));return this.bufferLoaders.set(e,n),n}async getAccessor(e,t){const i=this.errorContext;i.errorUnsupportedIf(!this.json.accessors,"Accessors missing.");const r=this.json.accessors[e];i.errorUnsupportedIf(null==(null==r?void 0:r.bufferView),"Some accessor does not specify a bufferView."),i.errorUnsupportedIf(r.type in["MAT2","MAT3","MAT4"],`AttributeType ${r.type} is not supported`);const n=this.json.bufferViews[r.bufferView],a=await this.getBuffer(n.buffer,t),s=I[r.type],o=F[r.componentType],c=s*o,l=n.byteStride||c;return{raw:a.buffer,byteStride:l,byteOffset:a.byteOffset+(n.byteOffset||0)+(r.byteOffset||0),entryCount:r.count,isDenselyPacked:l===c,componentCount:s,componentByteSize:o,componentType:r.componentType,min:r.min,max:r.max,normalized:!!r.normalized}}async getIndexData(e,t){if(null==e.indices)return null;const i=await this.getAccessor(e.indices,t);if(i.isDenselyPacked)switch(i.componentType){case 5121:return new Uint8Array(i.raw,i.byteOffset,i.entryCount);case 5123:return new Uint16Array(i.raw,i.byteOffset,i.entryCount);case 5125:return new Uint32Array(i.raw,i.byteOffset,i.entryCount)}else switch(i.componentType){case 5121:return Object(y["a"])(this.wrapAccessor(v["l"],i));case 5123:return Object(y["a"])(this.wrapAccessor(v["j"],i));case 5125:return Object(y["a"])(this.wrapAccessor(v["k"],i))}}async getPositionData(e,t){const i=this.errorContext;i.errorUnsupportedIf(null==e.attributes.POSITION,"No POSITION vertex data found.");const r=await this.getAccessor(e.attributes.POSITION,t);return i.errorUnsupportedIf(5126!==r.componentType,"Expected type FLOAT for POSITION vertex attribute, but found "+k[r.componentType]),i.errorUnsupportedIf(3!==r.componentCount,"POSITION vertex attribute must have 3 components, but found "+r.componentCount.toFixed()),this.wrapAccessor(v["u"],r)}async getNormalData(e,t){const i=this.errorContext;i.assert(null!=e.attributes.NORMAL,"No NORMAL vertex data found.");const r=await this.getAccessor(e.attributes.NORMAL,t);return i.errorUnsupportedIf(5126!==r.componentType,"Expected type FLOAT for NORMAL vertex attribute, but found "+k[r.componentType]),i.errorUnsupportedIf(3!==r.componentCount,"NORMAL vertex attribute must have 3 components, but found "+r.componentCount.toFixed()),this.wrapAccessor(v["u"],r)}async getTangentData(e,t){const i=this.errorContext;i.assert(null!=e.attributes.TANGENT,"No TANGENT vertex data found.");const r=await this.getAccessor(e.attributes.TANGENT,t);return i.errorUnsupportedIf(5126!==r.componentType,"Expected type FLOAT for TANGENT vertex attribute, but found "+k[r.componentType]),i.errorUnsupportedIf(4!==r.componentCount,"TANGENT vertex attribute must have 4 components, but found "+r.componentCount.toFixed()),new v["C"](r.raw,r.byteOffset,r.byteStride,r.byteOffset+r.byteStride*r.entryCount)}async getTextureCoordinates(e,t){const i=this.errorContext;i.assert(null!=e.attributes.TEXCOORD_0,"No TEXCOORD_0 vertex data found.");const r=await this.getAccessor(e.attributes.TEXCOORD_0,t);return i.errorUnsupportedIf(2!==r.componentCount,"TEXCOORD_0 vertex attribute must have 2 components, but found "+r.componentCount.toFixed()),5126===r.componentType?this.wrapAccessor(v["m"],r):(i.errorUnsupportedIf(!r.normalized,"Integer component types are only supported for a normalized accessor for TEXCOORD_0."),z(r))}async getVertexColors(e,t){const i=this.errorContext;i.assert(null!=e.attributes.COLOR_0,"No COLOR_0 vertex data found.");const r=await this.getAccessor(e.attributes.COLOR_0,t);if(i.errorUnsupportedIf(4!==r.componentCount&&3!==r.componentCount,"COLOR_0 attribute must have 3 or 4 components, but found "+r.componentCount.toFixed()),4===r.componentCount){if(5126===r.componentType)return this.wrapAccessor(v["C"],r);if(5121===r.componentType)return this.wrapAccessor(v["J"],r);if(5123===r.componentType)return this.wrapAccessor(v["H"],r)}else if(3===r.componentCount){if(5126===r.componentType)return this.wrapAccessor(v["u"],r);if(5121===r.componentType)return this.wrapAccessor(v["B"],r);if(5123===r.componentType)return this.wrapAccessor(v["z"],r)}i.errorUnsupported("Unsupported component type for COLOR_0 attribute: "+k[r.componentType])}hasPositions(e){return void 0!==e.attributes.POSITION}hasNormals(e){return void 0!==e.attributes.NORMAL}hasVertexColors(e){return void 0!==e.attributes.COLOR_0}hasTextureCoordinates(e){return void 0!==e.attributes.TEXCOORD_0}hasTangents(e){return void 0!==e.attributes.TANGENT}async getMaterial(e,t,i){let r=this.materialCache.get(e.material);if(!r){const n=null!=e.material?w(this.json.materials[e.material]):w(),a=n.pbrMetallicRoughness,s=this.hasVertexColors(e),o=this.getTexture(a.baseColorTexture,t),c=this.getTexture(n.normalTexture,t),l=i?this.getTexture(n.occlusionTexture,t):null,d=i?this.getTexture(n.emissiveTexture,t):null,h=i?this.getTexture(a.metallicRoughnessTexture,t):null,u=null!=e.material?e.material:-1;r={alphaMode:n.alphaMode,alphaCutoff:n.alphaCutoff,color:a.baseColorFactor,doubleSided:!!n.doubleSided,colorTexture:await o,normalTexture:await c,name:n.name,id:u,occlusionTexture:await l,emissiveTexture:await d,emissiveFactor:n.emissiveFactor,metallicFactor:a.metallicFactor,roughnessFactor:a.roughnessFactor,metallicRoughnessTexture:await h,vertexColors:s,ESRI_externalColorMixMode:n.extras.ESRI_externalColorMixMode}}return r}async getTexture(e,t){if(!e)return null;this.errorContext.errorUnsupportedIf(0!==(e.texCoord||0),"Only TEXCOORD with index 0 is supported.");const i=e.index,r=this.errorContext,n=this.json.textures[i],a=C(null!=n.sampler?this.json.samplers[n.sampler]:{});r.errorUnsupportedIf(null==n.source,"Source is expected to be defined for a texture.");const s=this.json.images[n.source],o=await this.loadTextureImageData(i,n,t);return Object(u["b"])(this.textureCache,i,()=>{const e=e=>33071===e||33648===e||10497===e,t=e=>(r.error(`Unexpected TextureSampler WrapMode: ${e}. Using default REPEAT(10497).`),10497);return{data:o,wrapS:e(a.wrapS)?a.wrapS:t(a.wrapS),wrapT:e(a.wrapT)?a.wrapT:t(a.wrapT),minFilter:a.minFilter,name:s.name,id:i}})}getNodeTransform(e){if(void 0===e)return E;let t=this.nodeTransformCache.get(e);if(!t){const i=this.getNodeTransform(this.getNodeParent(e)),r=this.json.nodes[e];r.matrix?t=Object(b["n"])(Object(n["d"])(),i,r.matrix):r.translation||r.rotation||r.scale?(t=Object(n["c"])(i),r.translation&&Object(b["b"])(t,t,r.translation),r.rotation&&(D[3]=Object(m["c"])(D,r.rotation),Object(b["f"])(t,t,D[3],D)),r.scale&&Object(b["g"])(t,t,r.scale)):t=i,this.nodeTransformCache.set(e,t)}return t}wrapAccessor(e,t){return new e(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*(t.entryCount-1)+t.componentByteSize*t.componentCount)}resolveUri(e){return Object(p["A"])(e,this.baseUri)}getNodeParent(e){return this.nodeParentMap.get(e)}checkVersionSupported(){const e=f["a"].parse(this.json.asset.version,"glTF");R.validate(e)}checkRequiredExtensionsSupported(){const e=this.json,t=this.errorContext;e.extensionsRequired&&0!==e.extensionsRequired.length&&t.errorUnsupported("gltf loader was not able to load unsupported feature. Required extensions: "+e.extensionsRequired.join(", "))}computeNodeParents(){this.json.nodes.forEach((e,t)=>{e.children&&e.children.forEach(e=>{this.nodeParentMap.set(e,t)})})}async loadTextureImageData(e,t,i){const r=this.textureLoaders.get(e);if(r)return r;const n=this.createTextureLoader(t,i);return this.textureLoaders.set(e,n),n}async createTextureLoader(e,t){const i=this.json.images[e.source];if(i.uri)return this.context.loadImage(this.resolveUri(i.uri),t);const r=this.errorContext;r.errorUnsupportedIf(null==i.bufferView,"Image bufferView must be defined."),r.errorUnsupportedIf(null==i.mimeType,"Image mimeType must be defined.");const n=this.json.bufferViews[i.bufferView],a=await this.getBuffer(n.buffer,t);return r.errorUnsupportedIf(null!=n.byteStride,"byteStride not supported for image buffer"),V(new Uint8Array(a.buffer,a.byteOffset+(n.byteOffset||0),n.byteLength),i.mimeType)}}const R=new f["a"](2,0,"glTF"),E=Object(b["v"])(Object(n["d"])(),Math.PI/2),D=Object(g["b"])(),I={SCALAR:1,VEC2:2,VEC3:3,VEC4:4},F={5120:1,5121:1,5122:2,5123:2,5126:4,5125:4};function z(e){switch(e.componentType){case 5120:return new v["q"](e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case 5121:return new v["t"](e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case 5122:return new v["o"](e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case 5123:return new v["r"](e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case 5125:return new v["s"](e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case 5126:return new v["m"](e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);default:return void Object(h["a"])(e.componentType)}}async function L(e){return new Promise((t,i)=>{const r=new Blob([e]),n=new FileReader;n.onload=()=>{const e=n.result;t(JSON.parse(e))},n.onerror=e=>{i(e)},n.readAsText(r)})}async function V(e,t){return new Promise((i,r)=>{const n=new Blob([e],{type:t}),a=URL.createObjectURL(n),s=new Image;s.addEventListener("load",()=>{URL.revokeObjectURL(a),"decode"in s?s.decode().then(()=>i(s),()=>i(s)):i(s)}),s.addEventListener("error",e=>{URL.revokeObjectURL(a),r(e)}),s.src=a})}const k={5120:"BYTE",5121:"UNSIGNED_BYTE",5122:"SHORT",5123:"UNSIGNED_SHORT",5125:"UNSIGNED_INT",5126:"FLOAT"};let U=0;async function B(e,t,i={},a=!0){const s=await M.load(e,W,t,i),o="gltf_"+U++,c={lods:[],materials:new Map,textures:new Map,meta:N(s)},l=!(!s.json.asset.extras||"symbolResource"!==s.json.asset.extras.ESRI_type),d=new Map;await G(s,async(e,t,l,h)=>{var u;const p=null!=(u=d.get(l))?u:0;d.set(l,p+1);const f=void 0!==e.mode?e.mode:4,b=4===f||5===f||6===f?f:null;if(Object(r["k"])(b))return void W.warnUnsupported("Unsupported primitive mode ("+Z[f]+"). Skipping primitive.");if(!s.hasPositions(e))return void W.warn("Skipping primitive without POSITION vertex attribute.");const m=s.getPositionData(e,i),g=s.getMaterial(e,i,a),v=s.hasNormals(e)?s.getNormalData(e,i):null,y=s.hasTangents(e)?s.getTangentData(e,i):null,O=s.hasTextureCoordinates(e)?s.getTextureCoordinates(e,i):null,_=s.hasVertexColors(e)?s.getVertexColors(e,i):null,x=s.getIndexData(e,i),j={transform:Object(n["c"])(t),attributes:{position:await m,normal:v?await v:null,texCoord0:O?await O:null,color:_?await _:null,tangent:y?await y:null},indices:await x,primitiveType:b,material:H(c,await g,o)};let w=null;Object(r["l"])(c.meta)&&Object(r["l"])(c.meta.ESRI_lod)&&"screenSpaceRadius"===c.meta.ESRI_lod.metric&&(w=c.meta.ESRI_lod.thresholds[l]),c.lods[l]=c.lods[l]||{parts:[],name:h,lodThreshold:w},c.lods[l].parts[p]=j});for(const r of c.lods)r.parts=r.parts.filter(e=>!!e);return{model:c,meta:{isEsriSymbolResource:l,uri:s.uri},customMeta:{}}}function N(e){const t=e.json;let i=null;return t.nodes.forEach(e=>{const t=e.extras;Object(r["l"])(t)&&(t.ESRI_proxyEllipsoid||t.ESRI_lod)&&(i=t)}),i}async function G(e,t){const i=e.json,r=i.scenes[i.scene||0].nodes,n=r.length>1,a=[];for(const o of r){const e=i.nodes[o];a.push(s(o,0)),q(e)&&!n&&e.extensions.MSFT_lod.ids.forEach((e,t)=>s(e,t+1))}async function s(r,n){const o=i.nodes[r],c=e.getNodeTransform(r);if(W.warnUnsupportedIf(null!=o.weights,"Morph targets are not supported."),null!=o.mesh){const e=i.meshes[o.mesh];for(const i of e.primitives)a.push(t(i,c,n,e.name))}for(const e of o.children||[])a.push(s(e,n))}await Promise.all(a)}function q(e){return e.extensions&&e.extensions.MSFT_lod&&Array.isArray(e.extensions.MSFT_lod.ids)}function H(e,t,i){const r=t=>{const r=`${i}_tex_${t&&t.id}${t&&t.name?"_"+t.name:""}`;if(t&&!e.textures.has(r)){const i=d(t.data,{wrap:{s:t.wrapS,t:t.wrapT},mipmap:$.some(e=>e===t.minFilter),noUnpackFlip:!0});e.textures.set(r,i)}return r},n=`${i}_mat_${t.id}_${t.name}`;if(!e.materials.has(n)){const i=l({color:[t.color[0],t.color[1],t.color[2]],opacity:t.color[3],alphaMode:t.alphaMode,alphaCutoff:t.alphaCutoff,doubleSided:t.doubleSided,colorMixMode:t.ESRI_externalColorMixMode,textureColor:t.colorTexture?r(t.colorTexture):void 0,textureNormal:t.normalTexture?r(t.normalTexture):void 0,textureOcclusion:t.occlusionTexture?r(t.occlusionTexture):void 0,textureEmissive:t.emissiveTexture?r(t.emissiveTexture):void 0,textureMetallicRoughness:t.metallicRoughnessTexture?r(t.metallicRoughnessTexture):void 0,emissiveFactor:[t.emissiveFactor[0],t.emissiveFactor[1],t.emissiveFactor[2]],metallicFactor:t.metallicFactor,roughnessFactor:t.roughnessFactor});e.materials.set(n,i)}return n}const W=new c,$=[9987,9985],Z=["POINTS","LINES","LINE_LOOP","LINE_STRIP","TRIANGLES","TRIANGLE_STRIP","TRIANGLE_FAN"]},"3e44":function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return s}));var r=i("2aad"),n=i("3886"),a=i("690a");function s(){const e=new a["a"];return e.include(r["a"]),e.fragment.uniforms.add("tex","sampler2D"),e.fragment.uniforms.add("color","vec4"),e.fragment.code.add(n["a"]`void main() {
vec4 texColor = texture2D(tex, uv);
gl_FragColor = texColor * color;
}`),e}const o=Object.freeze({__proto__:null,build:s})},4294:function(e,t,i){"use strict";i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return o}));var r=i("38a4"),n=i("9180"),a=i("7abc");class s{constructor(e,t){this.index=e,this.renderTargets=t,this.extent=Object(n["m"])(),this.resolution=0,this.renderLocalOrigin=Object(a["a"])(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries={extents:[Object(n["m"])(),Object(n["m"])(),Object(n["m"])()],numViews:0},this.validTargets=null,this.hasDrapedFeatureSource=!1,this.hasDrapedRasterSource=!1,this.hasTargetWithoutRasterImage=!1,this.index=e,this.validTargets=new Array(t.renderTargets.length).fill(!1)}getValidTarget(e){return this.validTargets[e]?this.renderTargets.getTarget(e):null}get needsColorWithoutRasterImage(){return this.hasDrapedRasterSource&&this.hasDrapedFeatureSource&&this.hasTargetWithoutRasterImage}getColorTexture(e){const t=1===e?this.renderTargets.getTarget(0):2===e?this.renderTargets.getTarget(2):this.renderTargets.getTarget(4);return t?t.getTexture():null}getNormalTexture(e){const t=1===e?this.renderTargets.getTarget(3):null;return t?t.getTexture():null}draw(e,t){const i=this.computeRenderTargetValidityBitfield(),r=this.needsColorWithoutRasterImage;for(const n of this.renderTargets.renderTargets)1===n.type&&!1===r?this.validTargets[n.type]=!1:this.validTargets[n.type]=e.drawTarget(this,n,t);return i^this.computeRenderTargetValidityBitfield()?0:1}computeRenderTargetValidityBitfield(){const e=this.validTargets;return+e[0]|+e[1]<<1|+e[2]<<2|+e[3]<<3|+e[4]<<4}setupGeometryViewsCyclical(e){this.setupGeometryViewsDirect();const t=.001*e.range;if(this.extent[0]-t<=e.min){const t=this.canvasGeometries.extents[this.canvasGeometries.numViews++];Object(n["A"])(this.extent,e.range,0,t)}if(this.extent[2]+t>=e.max){const t=this.canvasGeometries.extents[this.canvasGeometries.numViews++];Object(n["A"])(this.extent,-e.range,0,t)}}setupGeometryViewsDirect(){this.canvasGeometries.numViews=1,Object(n["l"])(this.canvasGeometries.extents[0],this.extent)}hasSomeSizedView(){for(let e=0;e<this.canvasGeometries.numViews;e++){const t=this.canvasGeometries.extents[e];if(t[0]!==t[2]&&t[1]!==t[3])return!0}return!1}applyViewport(e){e.setViewport(0===this.index?0:this.resolution,0,this.resolution,this.resolution)}}function o(e,t,i){return Math.min(Object(r["n"])(Math.max(e,t)+256),i)}},4377:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("3886");function n(e){e.code.add(r["a"]`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)}},4395:function(e,t,i){"use strict";i.d(t,"a",(function(){return l}));var r=i("e92d"),n=i("b2b2"),a=i("f9d0"),s=i("1153");const o=r["a"].getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository");class c{constructor(e){this._glMaterial=e,this.refCnt=0,this._glMaterial=e}incRefCnt(){++this.refCnt}decRefCnt(){--this.refCnt,Object(s["a"])(this.refCnt>=0)}getRefCnt(){return this.refCnt}get glMaterial(){return this._glMaterial}}class l{constructor(e,t,i,r){this._textureRepository=e,this._techniqueRepository=t,this.materialChanged=i,this.requestRender=r,this._id2glMaterialRef=new a["a"]}dispose(){this._textureRepository.dispose()}acquire(e,t){this._ownMaterial(e);let i=this._id2glMaterialRef.get(t,e.id);if(Object(n["k"])(i)){const r=e.createGLMaterial({material:e,techniqueRep:this._techniqueRepository,textureRep:this._textureRepository,output:t});i=new c(r),this._id2glMaterialRef.set(t,e.id,i)}return i.incRefCnt(),i.glMaterial}release(e,t){const i=this._id2glMaterialRef.get(t,e.id);Object(n["l"])(i)&&(i.decRefCnt(),0===i.getRefCnt()&&(Object(n["f"])(i.glMaterial),this._id2glMaterialRef.delete(t,e.id)))}_ownMaterial(e){Object(n["l"])(e.repository)&&e.repository!==this&&o.error("Material is already owned by a different material repository"),e.repository=this}}},"43a4":function(e,t,i){"use strict";i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return a}));var r=i("3886"),n=i("690a");function a(e){const t=new n["a"];return 0===e.output&&(t.attributes.add("position","vec2"),t.vertex.uniforms.add("uResolution","vec4"),t.varyings.add("fTexCoord","vec2"),t.varyings.add("fOffset[3]","vec4"),t.vertex.code.add(r["a"]`void SMAAEdgeDetectionVS( vec2 texcoord ) {
fOffset[0] = texcoord.xyxy + uResolution.xyxy * vec4( -1.0, 0.0, 0.0,  1.0 );
fOffset[1] = texcoord.xyxy + uResolution.xyxy * vec4(  1.0, 0.0, 0.0, -1.0 );
fOffset[2] = texcoord.xyxy + uResolution.xyxy * vec4( -2.0, 0.0, 0.0,  2.0 );
}
void main() {
fTexCoord = (position + 1.0 ) * 0.5;
gl_Position = vec4(position, 0, 1);
SMAAEdgeDetectionVS( fTexCoord );
}`),t.fragment.uniforms.add("tColor","sampler2D"),t.fragment.code.add(r["a"]`
      vec4 SMAAColorEdgeDetectionPS( vec2 texcoord, vec4 offset[3], sampler2D colorTex ) {
        vec2 threshold = vec2( ${r["a"].float(e.threshold)} );

        // Calculate color deltas:
        vec4 delta;
        vec3 C = texture2D( colorTex, texcoord ).rgb;

        vec3 Cleft = texture2D( colorTex, offset[0].xy ).rgb;
        vec3 t = abs( C - Cleft );
        delta.x = max( max( t.r, t.g ), t.b );

        vec3 Ctop = texture2D( colorTex, offset[0].zw ).rgb;
        t = abs( C - Ctop );
        delta.y = max( max( t.r, t.g ), t.b );

        // We do the usual threshold:
        vec2 edges = step( threshold, delta.xy );

        // Then discard if there is no edge:
        if ( dot( edges, vec2( 1.0, 1.0 ) ) == 0.0 )
            discard;

        // Calculate right and bottom deltas:
        vec3 Cright = texture2D( colorTex, offset[1].xy ).rgb;
        t = abs( C - Cright );
        delta.z = max( max( t.r, t.g ), t.b );

        vec3 Cbottom  = texture2D( colorTex, offset[1].zw ).rgb;
        t = abs( C - Cbottom );
        delta.w = max( max( t.r, t.g ), t.b );

        // Calculate the maximum delta in the direct neighborhood:
        float maxDelta = max( max( max( delta.x, delta.y ), delta.z ), delta.w );

        // Calculate left-left and top-top deltas:
        vec3 Cleftleft  = texture2D( colorTex, offset[2].xy ).rgb;
        t = abs( C - Cleftleft );
        delta.z = max( max( t.r, t.g ), t.b );

        vec3 Ctoptop = texture2D( colorTex, offset[2].zw ).rgb;
        t = abs( C - Ctoptop );
        delta.w = max( max( t.r, t.g ), t.b );

        // Calculate the final maximum delta:
        maxDelta = max( max( maxDelta, delta.z ), delta.w );

        // Local contrast adaptation in action:
        edges.xy *= step( maxDelta, float(${r["a"].float(e.localConstrastAdaption)}) * delta.xy );

        return vec4( edges, 0.0, 0.0 );
      }

      void main() {
        gl_FragColor = SMAAColorEdgeDetectionPS( fTexCoord, fOffset, tColor );
      }
    `)),1===e.output&&(t.attributes.add("position","vec2"),t.vertex.uniforms.add("uResolution","vec4"),t.varyings.add("fTexCoord","vec2"),t.varyings.add("fOffset[3]","vec4"),t.varyings.add("fPixCoord","vec2"),t.vertex.code.add(r["a"]`
      void SMAABlendingWeightCalculationVS( vec2 texcoord ) {
        fPixCoord = texcoord * uResolution.zw;
        fOffset[0] = texcoord.xyxy + uResolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 );
        fOffset[1] = texcoord.xyxy + uResolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 );
        fOffset[2] = vec4( fOffset[0].xz, fOffset[1].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * uResolution.xxyy * float( ${r["a"].int(e.maxSearchSteps)} );
      }

      void main() {
        fTexCoord = (position + 1.0 ) * 0.5;
        gl_Position = vec4(position, 0, 1);
        SMAABlendingWeightCalculationVS( fTexCoord );
      }
    `),t.fragment.uniforms.add("tEdges","sampler2D").add("tArea","sampler2D").add("tSearch","sampler2D").add("tColor","sampler2D").add("uResolution","vec4"),t.fragment.code.add(r["a"]`
      #define SMAA_AREATEX_PIXEL_SIZE ( 1.0 / vec2( 160.0, 560.0 ) )
      #define SMAA_AREATEX_SUBTEX_SIZE ( 1.0 / 7.0 )

      vec4 SMAASampleLevelZeroOffset(sampler2D tex, vec2 coord, vec2 offset) {
        return texture2D( tex, coord + offset.x * uResolution.xy, 0.0 );
      }

      vec2 round( vec2 x ) {
        return sign( x ) * floor( abs( x ) + 0.5 );
      }

      float SMAASearchLength( sampler2D searchTex, vec2 e, float bias, float scale ) {
        e.r = bias + e.r * scale;
        return 255.0 * texture2D( searchTex, e, 0.0 ).r;
      }

      float SMAASearchXLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${r["a"].int(e.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 2.0, 0.0 ) * uResolution.xy;
          if ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x += 0.25 * uResolution.x;
        texcoord.x += uResolution.x;
        texcoord.x += 2.0 * uResolution.x;
        texcoord.x -= uResolution.x * SMAASearchLength(searchTex, e, 0.0, 0.5);
        return texcoord.x;
      }

      float SMAASearchXRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${r["a"].int(e.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 2.0, 0.0 ) * uResolution.xy;
          if ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x -= 0.25 * uResolution.x;
        texcoord.x -= uResolution.x;
        texcoord.x -= 2.0 * uResolution.x;
        texcoord.x += uResolution.x * SMAASearchLength( searchTex, e, 0.5, 0.5 );
        return texcoord.x;
      }

      float SMAASearchYUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${r["a"].int(e.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 0.0, 2.0 ) * uResolution.xy;
          if ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y -= 0.25 * uResolution.y;
        texcoord.y -= uResolution.y;
        texcoord.y -= 2.0 * uResolution.y;
        texcoord.y += uResolution.y * SMAASearchLength( searchTex, e.gr, 0.0, 0.5 );
        return texcoord.y;
      }

      float SMAASearchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${r["a"].int(e.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 0.0, 2.0 ) * uResolution.xy;
          if ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y += 0.25 * uResolution.y;
        texcoord.y += uResolution.y;
        texcoord.y += 2.0 * uResolution.y;
        texcoord.y -= uResolution.y * SMAASearchLength( searchTex, e.gr, 0.5, 0.5 );
        return texcoord.y;
      }

      vec2 SMAAArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {
        vec2 texcoord = float( ${r["a"].int(e.maxDistanceAreaTex)} ) * round( 4.0 * vec2( e1, e2 ) ) + dist;
        texcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );
        texcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;
        return texture2D( areaTex, texcoord, 0.0 ).rg;
      }

      vec4 SMAABlendingWeightCalculationPS( vec2 texcoord, vec2 pixcoord, vec4 offset[ 3 ], sampler2D edgesTex, sampler2D areaTex, sampler2D searchTex, ivec4 subsampleIndices ) {
        vec4 weights = vec4( 0.0, 0.0, 0.0, 0.0 );
        vec2 e = texture2D( edgesTex, texcoord ).rg;
        if ( e.g > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.x = SMAASearchXLeft( edgesTex, searchTex, offset[ 0 ].xy, offset[ 2 ].x );
          coords.y = offset[ 1 ].y;
          d.x = coords.x;
          float e1 = texture2D( edgesTex, coords, 0.0 ).r;
          coords.x = SMAASearchXRight( edgesTex, searchTex, offset[ 0 ].zw, offset[ 2 ].y );
          d.y = coords.x;
          d = d * uResolution.z - pixcoord.x;
          vec2 sqrt_d = sqrt( abs( d ) );
          coords.y -= 1.0 * uResolution.y;
          float e2 = SMAASampleLevelZeroOffset( edgesTex, coords, vec2( 1.0, 0.0 ) ).r;
          weights.rg = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.y ) );
        }

        if ( e.r > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.y = SMAASearchYUp( edgesTex, searchTex, offset[ 1 ].xy, offset[ 2 ].z );
          coords.x = offset[ 0 ].x;
          d.x = coords.y;
          float e1 = texture2D( edgesTex, coords, 0.0 ).g;
          coords.y = SMAASearchYDown( edgesTex, searchTex, offset[ 1 ].zw, offset[ 2 ].w );
          d.y = coords.y;
          d = d * uResolution.w - pixcoord.y;
          vec2 sqrt_d = sqrt( abs( d ) );
          coords.y -= 1.0 * uResolution.y;
          float e2 = SMAASampleLevelZeroOffset( edgesTex, coords, vec2( 0.0, 1.0 ) ).g;
          weights.ba = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.x ) );

          // for some reason the following lines are necessary to prevent
          // texture lookup precision issues on some Intel integrated graphics chips
          vec4 dbg = (offset[ 0 ]+offset[ 1 ]+offset[ 2 ] + coords.xyyx);
          weights.r += 0.00000001 * dot(vec4(0,1,0,1),dbg);
        }
        return weights;
      }

      void main() {
        gl_FragColor = SMAABlendingWeightCalculationPS( fTexCoord, fPixCoord, fOffset, tEdges, tArea, tSearch, ivec4( 0.0 ) );
      }
    `)),2===e.output&&(t.attributes.add("position","vec2"),t.vertex.uniforms.add("uResolution","vec4"),t.varyings.add("fTexCoord","vec2"),t.varyings.add("fOffset[2]","vec4"),t.vertex.code.add(r["a"]`void SMAANeighborhoodBlendingVS( vec2 texcoord ) {
fOffset[0] = texcoord.xyxy + uResolution.xyxy * vec4( -1.0, 0.0, 0.0, 1.0 );
fOffset[1] = texcoord.xyxy + uResolution.xyxy * vec4( 1.0, 0.0, 0.0, -1.0 );
}
void main() {
fTexCoord = (position + 1.0 ) * 0.5;
gl_Position = vec4(position, 0, 1);
SMAANeighborhoodBlendingVS(fTexCoord);
}`),t.fragment.uniforms.add("tBlendWeights","sampler2D"),t.fragment.uniforms.add("tColor","sampler2D"),t.fragment.uniforms.add("uResolution","vec4"),t.fragment.code.add(r["a"]`vec4 SMAANeighborhoodBlendingPS( vec2 texcoord, vec4 offset[ 2 ], sampler2D colorTex, sampler2D blendTex ) {
vec4 a;
a.xz = texture2D( blendTex, texcoord ).xz;
a.y = texture2D( blendTex, offset[ 1 ].zw ).g;
a.w = texture2D( blendTex, offset[ 1 ].xy ).a;
if ( dot(a, vec4( 1.0, 1.0, 1.0, 1.0 )) < 1e-5 ) {
return texture2D( colorTex, texcoord, 0.0 );
} else {
vec2 offset;
offset.x = a.a > a.b ? a.a : -a.b;
offset.y = a.g > a.r ? -a.g : a.r;
if ( abs( offset.x ) > abs( offset.y )) {
offset.y = 0.0;
} else {
offset.x = 0.0;
}
vec4 C = texture2D( colorTex, texcoord, 0.0 );
texcoord += sign( offset ) * uResolution.xy;
vec4 Cop = texture2D( colorTex, texcoord, 0.0 );
float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );
vec4 mixed = mix(C, Cop, s);
return mixed;
}
}
void main() {
gl_FragColor = SMAANeighborhoodBlendingPS( fTexCoord, fOffset, tColor, tBlendWeights );
}`)),t}const s=Object.freeze({__proto__:null,build:a})},4554:function(e,t,i){"use strict";i.d(t,"a",(function(){return O})),i.d(t,"b",(function(){return v})),i.d(t,"c",(function(){return g})),i.d(t,"d",(function(){return S})),i.d(t,"e",(function(){return w})),i.d(t,"f",(function(){return y})),i.d(t,"g",(function(){return x})),i.d(t,"h",(function(){return _})),i.d(t,"i",(function(){return j}));var r=i("e92d"),n=i("b2b2"),a=i("1c92"),s=i("dae5"),o=i("afe1"),c=i("e431"),l=i("0b2d"),d=i("8188"),h=i("f694"),u=i("7f83"),p=i("9786"),f=i("8190"),b=i("668b");const m=r["a"].getLogger("esri.geometry.support.meshUtils.normalProjection");function g(e,t,i,r,n){return C(r)?(T(0,f["u"].fromTypedArray(e),f["v"].fromTypedArray(t),f["v"].fromTypedArray(i),r,f["u"].fromTypedArray(n)),n):(m.error("Cannot convert spatial reference to PCPF"),n)}function v(e,t,i,r,n){return C(r)?(T(1,f["u"].fromTypedArray(e),f["v"].fromTypedArray(t),f["v"].fromTypedArray(i),r,f["u"].fromTypedArray(n)),n):(m.error("Cannot convert to spatial reference from PCPF"),n)}function y(e,t,i){return Object(d["p"])(e,t,0,i,Object(h["g"])(t),0,e.length/3),i}function O(e,t,i){return Object(d["p"])(e,Object(h["g"])(i),0,t,i,0,e.length/3),t}function _(e,t,i){if(Object(n["k"])(e))return t;const r=f["v"].fromTypedArray(e),a=f["v"].fromTypedArray(t);return Object(b["e"])(a,r,i),t}function x(e,t,i){if(Object(n["k"])(e))return t;Object(a["a"])(D,i);const r=f["u"].fromTypedArray(e),s=f["u"].fromTypedArray(t);return Object(b["a"])(s,r,D),Object(a["i"])(D)||Object(b["c"])(s,s),t}function j(e,t,i){if(Object(n["k"])(e))return t;Object(a["a"])(D,i);const r=f["u"].fromTypedArray(e,4*Float32Array.BYTES_PER_ELEMENT),s=f["u"].fromTypedArray(t,4*Float32Array.BYTES_PER_ELEMENT);if(Object(b["a"])(s,r,D),Object(a["i"])(D)||Object(b["c"])(s,s),e!==t)for(let n=3;n<e.length;n+=4)t[n]=e[n];return t}function w(e,t,i,r,n){if(!C(r))return m.error("Cannot convert spatial reference to PCPF"),n;T(0,f["u"].fromTypedArray(e,4*Float32Array.BYTES_PER_ELEMENT),f["v"].fromTypedArray(t),f["v"].fromTypedArray(i),r,f["u"].fromTypedArray(n,4*Float32Array.BYTES_PER_ELEMENT));for(let a=3;a<e.length;a+=4)n[a]=e[a];return n}function S(e,t,i,r,n){if(!C(r))return m.error("Cannot convert to spatial reference from PCPF"),n;T(1,f["u"].fromTypedArray(e,16),f["v"].fromTypedArray(t),f["v"].fromTypedArray(i),r,f["u"].fromTypedArray(n,16));for(let a=3;a<e.length;a+=4)n[a]=e[a];return n}function T(e,t,i,r,n,s){if(!t)return;const o=i.count,l=Object(h["g"])(n);if(P(n))for(let h=0;h<o;h++)r.getVec(h,M),t.getVec(h,R),Object(d["d"])(l,M,E,l),Object(a["f"])(D,E),1===e&&Object(a["o"])(D,D),Object(c["A"])(R,R,D),s.setVec(h,R);else for(let h=0;h<o;h++){r.getVec(h,M),t.getVec(h,R),Object(d["d"])(l,M,E,l),Object(a["f"])(D,E);const n=Object(p["h"])(i.get(h,1));let o=Math.cos(n);0===e&&(o=1/o),D[0]*=o,D[1]*=o,D[2]*=o,D[3]*=o,D[4]*=o,D[5]*=o,1===e&&Object(a["o"])(D,D),Object(c["A"])(R,R,D),Object(c["u"])(R,R),s.setVec(h,R)}return s}function C(e){return P(e)||A(e)}function P(e){return e.isWGS84||Object(u["f"])(e)||Object(u["i"])(e)||Object(u["j"])(e)}function A(e){return e.isWebMercator}const M=Object(l["f"])(),R=Object(l["f"])(),E=Object(o["d"])(),D=Object(s["b"])()},"45e3":function(e,t,i){"use strict";i.d(t,"a",(function(){return h}));var r=i("a4ee"),n=i("ce50"),a=i("b2b2"),s=i("3795"),o=i("59b2"),c=(i("b50f"),i("c120"),i("cea0"),i("d386")),l=i("deae"),d=i("8b9d");const h=e=>{let t=class extends e{get imageFormatIsOpaque(){return!1}get isOpaque(){return this.fullOpacity>=1&&this.imageFormatIsOpaque}get dataLevelRange(){const e=this.tileInfo.lods,t=e[0].scale,i=e[e.length-1].scale;return this.levelRangeFromScaleRange(t,i)}get displayLevelRange(){const e=this.tileInfo.lods,t=this.layer.minScale||e[0].scale,i=this.layer.maxScale||e[e.length-1].scale,r=this.levelRangeFromScaleRange(t,i);return this.layer.maxScale&&r.maxLevel++,r}getTileUrl(e,t,i){return this.layer.getTileUrl(e,t,i)}_addTilingSchemeMatchPromise(){if(Object(a["k"])(this.layer.fullExtent))return this.addResolvingPromise(Promise.reject(new n["a"]("tilingscheme:extent-not-defined","This layer doesn't define a fullExtent.")));const e=this._getTileInfoSupportError(this.tileInfo,this.layer.fullExtent);if(e)return this.addResolvingPromise(Promise.reject(e));const t=Object(s["m"])(this.view,"basemapTerrain.tilingSchemeLocked").then(()=>{const e=this.view.basemapTerrain.tilingScheme,t=this._getTileInfoCompatibilityError(this.tileInfo,e);if(t)throw t});this.addResolvingPromise(t)}_getTileInfoSupportError(e,t){const i=Object(d["a"])(e,t,this.view.spatialReference,this.view.state.viewingMode);if(i){const e={layer:this.layer,error:i};let t;switch(i.name){case"tilingscheme:spatial-reference-mismatch":case"tilingscheme:global-unsupported-spatial-reference":case"tilingscheme:local-unsupported-spatial-reference":t=new n["a"]("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",e);break;default:t=new n["a"]("layerview:tiling-scheme-unsupported","The tiling scheme of this layer is not supported by SceneView",e)}return t}return null}_getTileInfoCompatibilityError(e,t){return t.compatibleWith(e)?null:new n["a"]("layerview:tiling-scheme-incompatible","The tiling scheme of this layer is incompatible with the tiling scheme of the surface")}levelRangeFromScaleRange(e,t){const i={minLevel:0,maxLevel:1/0},r=this.view&&this.view.basemapTerrain&&this.view.basemapTerrain.tilingScheme;if(!r)return i;const n=r.levels[0],a=e=>{const t=Math.log(n.scale/e)/Math.LN2;return.5-Math.abs(.5-t%1)<1e-9?Math.round(t):Math.ceil(t)};return null!=e&&e>0&&(i.minLevel=Math.max(0,a(e))),null!=t&&t>0&&(i.maxLevel=Math.max(0,a(t))),i}isUpdating(){return!!(this.view&&this.view.basemapTerrain&&this.view.basemapTerrain.updating)}};return Object(r["a"])([Object(o["b"])({readOnly:!0})],t.prototype,"imageFormatIsOpaque",null),Object(r["a"])([Object(o["b"])({readOnly:!0})],t.prototype,"updating",void 0),Object(r["a"])([Object(o["b"])(l["a"])],t.prototype,"updatingProgress",void 0),Object(r["a"])([Object(o["b"])(l["b"])],t.prototype,"updatingProgressValue",void 0),Object(r["a"])([Object(o["b"])({readOnly:!0})],t.prototype,"fullExtent",void 0),Object(r["a"])([Object(o["b"])({readOnly:!0})],t.prototype,"isOpaque",null),Object(r["a"])([Object(o["b"])({readOnly:!0})],t.prototype,"dataLevelRange",null),Object(r["a"])([Object(o["b"])({readOnly:!0})],t.prototype,"displayLevelRange",null),Object(r["a"])([Object(o["b"])()],t.prototype,"layer",void 0),Object(r["a"])([Object(o["b"])({readOnly:!0})],t.prototype,"tileInfo",void 0),t=Object(r["a"])([Object(c["a"])("esri.views.3d.layers.TiledLayerView3D")],t),t}},"47f8":function(e,t,i){"use strict";function r(){return new Float32Array(3)}function n(e){const t=new Float32Array(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function a(e,t,i){const r=new Float32Array(3);return r[0]=e,r[1]=t,r[2]=i,r}function s(e,t){return new Float32Array(e,t,3)}function o(){return r()}function c(){return a(1,1,1)}function l(){return a(1,0,0)}function d(){return a(0,1,0)}function h(){return a(0,0,1)}i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return s})),i.d(t,"c",(function(){return r})),i.d(t,"d",(function(){return a})),i.d(t,"e",(function(){return o}));const u=o(),p=c(),f=l(),b=d(),m=h();Object.freeze({__proto__:null,create:r,clone:n,fromValues:a,createView:s,zeros:o,ones:c,unitX:l,unitY:d,unitZ:h,ZEROS:u,ONES:p,UNIT_X:f,UNIT_Y:b,UNIT_Z:m})},"49b8":function(e,t,i){"use strict";function r(e){return e=e||globalThis.location.hostname,l.some(t=>{var i;return null!=(null==(i=e)?void 0:i.match(t))})}function n(e,t){return e&&(t=t||globalThis.location.hostname)?null!=t.match(a)||null!=t.match(o)?e.replace("static.arcgis.com","staticdev.arcgis.com"):null!=t.match(s)||null!=t.match(c)?e.replace("static.arcgis.com","staticqa.arcgis.com"):e:e}i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return r}));const a=/^devext.arcgis.com$/,s=/^qaext.arcgis.com$/,o=/^[\w-]*\.mapsdevext.arcgis.com$/,c=/^[\w-]*\.mapsqa.arcgis.com$/,l=[/^([\w-]*\.)?[\w-]*\.zrh-dev-local.esri.com$/,a,s,/^jsapps.esri.com$/,o,c]},"4b49":function(e,t,i){"use strict";i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return o}));var r=i("b2b2"),n=i("0b2d"),a=i("8188");function s(e,t,i){if(Object(r["k"])(e)||Object(r["k"])(i))return!1;let n=!0;return c[0]=null!=e.xmin?e.xmin:0,c[1]=null!=e.ymin?e.ymin:0,c[2]=null!=e.zmin?e.zmin:0,n=n&&Object(a["p"])(c,e.spatialReference,0,t,i,0,1),c[0]=null!=e.xmax?e.xmax:0,c[1]=null!=e.ymax?e.ymax:0,c[2]=null!=e.zmax?e.zmax:0,n=n&&Object(a["p"])(c,e.spatialReference,0,t,i,3,1),null==e.xmin&&(t[0]=-1/0),null==e.ymin&&(t[1]=-1/0),null==e.zmin&&(t[2]=-1/0),null==e.xmax&&(t[3]=1/0),null==e.ymax&&(t[4]=1/0),null==e.zmax&&(t[5]=1/0),n}function o(e,t,i){if(Object(r["k"])(e)||Object(r["k"])(i))return!1;let n=!0;return c[0]=null!=e.xmin?e.xmin:0,c[1]=null!=e.ymin?e.ymin:0,c[2]=null!=e.zmin?e.zmin:0,n=n&&Object(a["p"])(c,e.spatialReference,0,c,i,0,1),t[0]=c[0],t[1]=c[1],c[0]=null!=e.xmax?e.xmax:0,c[1]=null!=e.ymax?e.ymax:0,c[2]=null!=e.zmax?e.zmax:0,n=n&&Object(a["p"])(c,e.spatialReference,0,c,i,0,1),t[2]=c[0],t[3]=c[1],null==e.xmin&&(t[0]=-1/0),null==e.ymin&&(t[1]=-1/0),null==e.xmax&&(t[2]=1/0),null==e.ymax&&(t[3]=1/0),n}const c=Object(n["f"])()},"4bc4":function(e,t,i){"use strict";i.d(t,"a",(function(){return l})),i.d(t,"b",(function(){return c}));var r=i("dfaf"),n=i("d047"),a=i("f159"),s=i("3886"),o=i("690a");function c(e){const t=new o["a"];return t.attributes.add("position","vec2"),t.include(r["a"],{attributeTextureCoordinates:1}),t.varyings.add("worldRay","vec3"),t.varyings.add("eyeDir","vec3"),t.vertex.uniforms.add("projectionInverse","mat4"),t.vertex.uniforms.add("viewInverse","mat4"),t.vertex.code.add(s["a"]`void main(void) {
vec3 posViewNear = (projectionInverse * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (viewInverse * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),t.fragment.uniforms.add("lightingMainDirection","vec3").add("atmosphereC","float").add("cameraPosition","vec3").add("nearFar","vec2").add("depthTex","sampler2D").add("strength","float").add("fogAmount","float"),t.include(a["a"]),t.fragment.include(n["a"]),t.fragment.code.add(s["a"]`vec2 sphereIntersect(vec3 start, vec3 dir) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float d = (b * b) - 4.0 * a * atmosphereC;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),t.fragment.code.add(s["a"]`
    vec4 applyFog(float dist, vec3 rayDir){
      bool sky = false;

      if(dist == -1.0){
        vec2 rayAtmosphereIntersect = sphereIntersect(cameraPosition, rayDir);
        dist = 0.1 * rayAtmosphereIntersect.y;
        sky = true;
      }

      float fogAmount = fogAmount * (1.0 - exp(-dist * strength));

      float sunAmount = max(0.0, dot(rayDir, lightingMainDirection));

      float lightAngle = max(0.0, dot(normalize(cameraPosition + dist * rayDir), lightingMainDirection));
      ${e.haze?s["a"]`vec3 fogColor = mix(vec3(0.0), vec3(0.24, 0.44, 0.8), lightAngle);`:s["a"]`vec3 fogColor = mix(vec3(0.1), vec3(1.5), lightAngle);`}

      float phase = sky ? pow(sunAmount, 16.0) : 0.0;
      vec3 col = (lightAngle * vec3(1.0, 0.6, 0.3) * phase + fogColor) * fogAmount;
      return vec4(col, fogAmount);
    }
    `),t.fragment.code.add(s["a"]`
    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;

      float depthSample = texture2D(depthTex, vuv0).r;
      float zNorm = 2.0 * depthSample - 1.0;
      float linDepth = 2.0 * nearFar[0] * nearFar[1] / (nearFar[1] + nearFar[0] - zNorm * (nearFar[1] - nearFar[0]));
      if(depthSample < 1.0 && depthSample > 0.0){
        vec3 cameraSpaceRay = normalize(eyeDir);
        cameraSpaceRay /= cameraSpaceRay.z;
        cameraSpaceRay *= linDepth;
        terrainDepth = max(0.0, length(cameraSpaceRay));
      }

      ${e.haze?s["a"]`
          if(terrainDepth == -1.0){
            gl_FragColor = vec4(0);
            return;
          }`:""}

      vec4 fog = applyFog(terrainDepth, rayDir);

      gl_FragColor = delinearizeGamma(vec4(tonemapACES(fog.rgb), fog.a));
    }
  `),t}const l=Object.freeze({__proto__:null,build:c})},"4c96":function(e,t,i){"use strict";function r(e,t,i){const r=e.typedBuffer,n=e.typedBufferStride,a=t.typedBuffer,s=t.typedBufferStride,o=i?i.count:t.count;let c=(i&&i.dstIndex?i.dstIndex:0)*n,l=(i&&i.srcIndex?i.srcIndex:0)*s;for(let d=0;d<o;++d)r[c]=a[l],r[c+1]=a[l+1],r[c+2]=a[l+2],c+=n,l+=s}function n(e,t,i,r,n){var a,s;const o=e.typedBuffer,c=e.typedBufferStride,l=null!=(a=null==n?void 0:n.count)?a:e.count;let d=(null!=(s=null==n?void 0:n.dstIndex)?s:0)*c;for(let h=0;h<l;++h)o[d]=t,o[d+1]=i,o[d+2]=r,d+=c}i.d(t,"a",(function(){return r})),i.d(t,"b",(function(){return n}));Object.freeze({__proto__:null,copy:r,fill:n})},"4db9":function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("3886");function n(e,t){t.linearDepth?e.vertex.code.add(r["a"]`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;
return proj * eye;
}`):e.vertex.code.add(r["a"]`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`)}},"4e47":function(e,t,i){"use strict";i.d(t,"a",(function(){return c}));var r=i("e431"),n=i("0b2d"),a=i("0ca1"),s=i("b33e");class o extends s["a"]{constructor(e,t,i,r,n){super(e,t,i),this.sceneVelocity=r,this.direction=n}value(e){return super.valueFromInitialVelocity(this.sceneVelocity,e)}}class c{constructor(e=300,t=12,i=.84){this.minimumInitialVelocity=e,this.stopVelocity=t,this.friction=i,this.enabled=!0,this.time=new a["a"](.6),this.screen=[new a["a"](.4),new a["a"](.4)],this.scene=[new a["a"](.6),new a["a"](.6),new a["a"](.6)],this.tmpDirection=Object(n["f"])()}add(e,t,i){if(this.enabled){if(this.time.hasLastValue&&this.time.computeDelta(i)<.015)return;this.screen[0].update(e[0]),this.screen[1].update(e[1]),this.scene[0].update(t[0]),this.scene[1].update(t[1]),this.scene[2].update(t[2]),this.time.update(i)}}reset(){this.screen[0].reset(),this.screen[1].reset(),this.scene[0].reset(),this.scene[1].reset(),this.scene[2].reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.screen[0].hasFilteredDelta)return null;const e=this.screen[0].filteredDelta,t=this.screen[1].filteredDelta,i=Math.sqrt(e*e+t*t)/this.time.filteredDelta;return Math.abs(i)<this.minimumInitialVelocity?null:this.createMomentum(i,this.stopVelocity,this.friction)}createMomentum(e,t,i){Object(r["z"])(this.tmpDirection,this.scene[0].filteredDelta,this.scene[1].filteredDelta,this.scene[2].filteredDelta);const n=Object(r["s"])(this.tmpDirection);n>0&&Object(r["h"])(this.tmpDirection,this.tmpDirection,1/n);const a=n/this.time.filteredDelta;return new o(e,t,i,a,this.tmpDirection)}}},"4f8b":function(e,t,i){"use strict";i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return c})),i.d(t,"c",(function(){return o})),i.d(t,"d",(function(){return d})),i.d(t,"e",(function(){return l}));var r=i("2119"),n=i("e431"),a=i("d18f");i("7361");function s(e){return e?{ray:Object(a["c"])(e.ray),c0:e.c0,c1:e.c1}:{ray:Object(a["c"])(),c0:0,c1:Number.MAX_VALUE}}function o(e,t=s()){return Object(a["b"])(e,t.ray),t.c0=0,t.c1=Number.MAX_VALUE,t}function c(e,t,i=s()){const r=Object(n["s"])(e.vector);return Object(a["g"])(e.origin,t,i.ray),i.c0=0,i.c1=r,i}function l(e,t){return h(e,e.c0,t)}function d(e,t){return h(e,e.c1,t)}function h(e,t,i){return Object(n["i"])(i,e.ray.origin,Object(n["h"])(i,e.ray.direction,t))}new r["a"](()=>({c0:0,c1:0,ray:null}))},5015:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i("f4cc"),n=i("2db0");async function a(e){const t=i.e("chunk-2d0c191a").then(i.bind(null,"4734")),a=i.e("chunk-2d207f46").then(i.bind(null,"a375")),s=Object(n["a"])((await t).default,{signal:e}),o=Object(n["a"])((await a).default,{signal:e}),c={mask:await s,overlay:await o};return Object(r["w"])(e),c}},"501b":function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("3886");function n(e){e.code.add(r["a"]`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}
const vec4 RGBA_2_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgba2float(vec4 rgba) {
return dot(rgba, RGBA_2_FLOAT_FACTORS);
}`)}},5211:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("3886");function n(e){e.extensions.add("GL_EXT_shader_texture_lod"),e.extensions.add("GL_OES_standard_derivatives"),e.fragment.code.add(r["a"]`#ifndef GL_EXT_shader_texture_lod
float calcMipMapLevel(const vec2 ddx, const vec2 ddy) {
float deltaMaxSqr = max(dot(ddx, ddx), dot(ddy, ddy));
return max(0.0, 0.5 * log2(deltaMaxSqr));
}
#endif
vec4 textureAtlasLookup(sampler2D texture, vec2 textureSize, vec2 textureCoordinates, vec4 atlasRegion) {
vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;
vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;
float maxdUV = 0.125;
vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
#ifdef GL_EXT_shader_texture_lod
return texture2DGradEXT(texture, uvAtlas, dUVdx, dUVdy);
#else
vec2 dUVdxAuto = dFdx(uvAtlas);
vec2 dUVdyAuto = dFdy(uvAtlas);
float mipMapLevel = calcMipMapLevel(dUVdx * textureSize, dUVdy * textureSize);
float autoMipMapLevel = calcMipMapLevel(dUVdxAuto * textureSize, dUVdyAuto * textureSize);
return texture2D(texture, uvAtlas, mipMapLevel - autoMipMapLevel);
#endif
}`)}},5241:function(e,t,i){"use strict";i.d(t,"a",(function(){return f})),i.d(t,"b",(function(){return b})),i.d(t,"c",(function(){return g})),i.d(t,"d",(function(){return m}));var r=i("b2b2"),n=i("afe1"),a=i("0b2d"),s=i("8188"),o=i("4261"),c=i("32ed"),l=i("1a54"),d=i("2e0f"),h=i("ba58"),u=i("5a22");const p=Object(a["f"])();function f(e,t,i,a,c,l,h,f){const b=i?i.length:0,m=e.clippingExtent;if(Object(s["t"])(t,p,e.elevationProvider.spatialReference),Object(r["l"])(m)&&!Object(o["g"])(m,p))return null;const g=e.renderCoordsHelper.spatialReference;Object(s["t"])(t,p,g);const v=e.localOriginFactory.getOrigin(p),y=new u["a"]({castShadow:!1,metadata:{layerUid:l,graphicUid:h,usesVerticalDistanceToGround:!0}});for(let r=0;r<b;r++){const e=n["a"];y.addGeometry(i[r],a[r],e,v,f)}return{object:y,sampledElevation:Object(d["c"])(y,t,e.elevationProvider,e.renderCoordsHelper,c)}}function b(e,t,i){const r=e.elevationContext,n=i.spatialReference;Object(s["t"])(t,p,n),r.centerPointInElevationSR=Object(l["j"])(p[0],p[1],t.hasZ?p[2]:0,n)}function m(e){switch(e.type){case"point":return e;case"polygon":case"extent":return Object(h["a"])(e);case"polyline":{const t=e.paths[0];if(!t||0===t.length)return null;const i=Object(c["f"])(t,Object(c["e"])(t)/2);return Object(l["j"])(i[0],i[1],i[2],e.spatialReference)}case"mesh":return e.origin}return null}function g(e,t,i,r,n){const a=new Float64Array(3*e.length),s=new Float64Array(a.length);e.forEach((e,t)=>{a[3*t+0]=e[0],a[3*t+1]=e[1],a[3*t+2]=e.length>2?e[2]:0});const o=Object(d["d"])(a,t,0,s,0,a,0,a.length/3,i,r,n),c=null!=o;return{numVertices:e.length,position:a,mapPosition:s,projectionSuccess:c,sampledElevation:o}}},"53f8":function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return L}));var r=i("a4ee"),n=i("2eab"),a=i("658b"),s=i("ce50"),o=i("9096"),c=i("1853"),l=i("b2b2"),d=i("e694"),h=i("f4cc"),u=i("59b2"),p=(i("b50f"),i("c120"),i("cea0")),f=i("afcf"),b=i("d386"),m=i("09db"),g=i("92ef"),v=i("3af1"),y=i("49a0"),O=i("a6a3"),_=i("f46e"),x=i("303f"),j=i("3d59"),w=i("997b"),S=i("8b28"),T=i("b911"),C=i("0db5"),P=i("8e17"),A=i("5a62"),M=i("d409"),R=i("601a"),E=i("22f4"),D=i("70ce"),I=i("e9d0"),F=i("2258");let z=class extends(Object(w["a"])(Object(R["a"])(Object(A["a"])(Object(M["a"])(Object(x["a"])(Object(j["a"])(Object(T["a"])(Object(C["a"])(Object(d["a"])(Object(P["a"])(Object(_["a"])(Object(S["a"])(Object(o["b"])(O["a"])))))))))))))){constructor(...e){super(...e),this.datesInUnknownTimezone=!1,this.dpi=96,this.gdbVersion=null,this.imageFormat="png24",this.imageMaxHeight=2048,this.imageMaxWidth=2048,this.imageTransparency=!0,this.isReference=null,this.labelsVisible=!1,this.operationalLayerType="ArcGISMapServiceLayer",this.sourceJSON=null,this.sublayers=null,this.type="map-image",this.url=null}normalizeCtorArgs(e,t){return"string"==typeof e?{url:e,...t}:e}load(e){const t=Object(l["l"])(e)?e.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Map Service"]},e).catch(h["v"]).then(()=>this._fetchService(t))),Promise.resolve(this)}readImageFormat(e,t){const i=t.supportedImageFormatTypes;return i&&i.indexOf("PNG32")>-1?"png32":"png24"}writeSublayers(e,t,i,r){if(!this.loaded||!e)return;const n=e.slice().reverse().flatten(({sublayers:e})=>e&&e.toArray().reverse()).toArray();let a=!1;if(this.capabilities&&this.capabilities.operations.supportsExportMap&&this.capabilities.exportMap.supportsDynamicLayers){const e=Object(g["d"])(r.origin);if(3===e){const e=this.createSublayersForOrigin("service").sublayers;a=Object(F["c"])(n,e,2)}else if(e>3){const e=this.createSublayersForOrigin("portal-item");a=Object(F["c"])(n,e.sublayers,Object(g["d"])(e.origin))}}const s=[],o={writeSublayerStructure:a,...r};let c=a;n.forEach(e=>{const t=e.write({},o);s.push(t),c=c||"user"===e.originOf("visible")}),s.some(e=>Object.keys(e).length>1)&&(t.layers=s),c&&(t.visibleLayers=n.filter(e=>e.visible).map(e=>e.id))}createExportImageParameters(e,t,i,r){const n=r&&r.pixelRatio||1;e&&this.version>=10&&(e=e.clone().shiftCentralMeridian());const a=new D["a"]({layer:this,floors:null==r?void 0:r.floors,scale:Object(y["b"])({extent:e,width:t})*n}),s=a.toJSON();a.destroy();const o=!r||!r.rotation||this.version<10.3?{}:{rotation:-r.rotation},c=e&&e.spatialReference,l=c.wkid||JSON.stringify(c.toJSON());s.dpi*=n;const d={};if(null!=r&&r.timeExtent){const{start:e,end:t}=r.timeExtent.toJSON();d.time=e&&t&&e===t?""+e:`${null==e?"null":e},${null==t?"null":t}`}else this.timeInfo&&!this.timeInfo.hasLiveData&&(d.time="null,null");return{bbox:e&&e.xmin+","+e.ymin+","+e.xmax+","+e.ymax,bboxSR:l,imageSR:l,size:t+","+i,...s,...o,...d}}async fetchImage(e,t,i,r){var a;const o={responseType:"image",signal:null!=(a=null==r?void 0:r.signal)?a:null,query:{...this.parsedUrl.query,...this.createExportImageParameters(e,t,i,r),f:"image",...this.refreshParameters,...this.customParameters,token:this.apiKey}},c=this.parsedUrl.path+"/export";return null==o.query.dynamicLayers||this.capabilities.exportMap.supportsDynamicLayers?Object(n["default"])(c,o).then(e=>e.data).catch(e=>{if(Object(h["m"])(e))throw e;throw new s["a"]("mapimagelayer:image-fetch-error","Unable to load image: "+c,{error:e})}):Promise.reject(new s["a"]("mapimagelayer:dynamiclayer-not-supported",`service ${this.url} doesn't support dynamic layers, which is required to be able to change the sublayer's order, rendering, labeling or source.`,{query:o.query}))}async fetchRecomputedExtents(e={}){const t={...e,query:{returnUpdates:!0,f:"json",...this.customParameters,token:this.apiKey}},{data:i}=await Object(n["default"])(this.url,t),{extent:r,fullExtent:s,timeExtent:o}=i,c=r||s;return{fullExtent:c&&v["a"].fromJSON(c),timeExtent:o&&a["a"].fromJSON({start:o[0],end:o[1]})}}loadAll(){return Object(c["a"])(this,e=>{e(this.allSublayers)})}async _fetchService(e){if(this.sourceJSON)return void this.read(this.sourceJSON,{origin:"service",url:this.parsedUrl});const{data:t,ssl:i}=await Object(n["default"])(this.parsedUrl.path,{query:{f:"json",...this.parsedUrl.query,...this.customParameters,token:this.apiKey},signal:e});i&&(this.url=this.url.replace(/^http:/i,"https:")),this.sourceJSON=t,this.read(t,{origin:"service",url:this.parsedUrl})}};Object(r["a"])([Object(u["b"])({type:Boolean})],z.prototype,"datesInUnknownTimezone",void 0),Object(r["a"])([Object(u["b"])()],z.prototype,"dpi",void 0),Object(r["a"])([Object(u["b"])()],z.prototype,"gdbVersion",void 0),Object(r["a"])([Object(u["b"])()],z.prototype,"imageFormat",void 0),Object(r["a"])([Object(f["a"])("imageFormat",["supportedImageFormatTypes"])],z.prototype,"readImageFormat",null),Object(r["a"])([Object(u["b"])({json:{origins:{service:{read:{source:"maxImageHeight"}}}}})],z.prototype,"imageMaxHeight",void 0),Object(r["a"])([Object(u["b"])({json:{origins:{service:{read:{source:"maxImageWidth"}}}}})],z.prototype,"imageMaxWidth",void 0),Object(r["a"])([Object(u["b"])()],z.prototype,"imageTransparency",void 0),Object(r["a"])([Object(u["b"])({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],z.prototype,"isReference",void 0),Object(r["a"])([Object(u["b"])({json:{read:!1,write:!1}})],z.prototype,"labelsVisible",void 0),Object(r["a"])([Object(u["b"])({type:["ArcGISMapServiceLayer"]})],z.prototype,"operationalLayerType",void 0),Object(r["a"])([Object(u["b"])({json:{read:!1,write:!1}})],z.prototype,"popupEnabled",void 0),Object(r["a"])([Object(u["b"])()],z.prototype,"sourceJSON",void 0),Object(r["a"])([Object(u["b"])({json:{write:{ignoreOrigin:!0}}})],z.prototype,"sublayers",void 0),Object(r["a"])([Object(m["a"])("sublayers",{layers:{type:[I["a"]]},visibleLayers:{type:[p["a"]]}})],z.prototype,"writeSublayers",null),Object(r["a"])([Object(u["b"])({type:["show","hide","hide-children"]})],z.prototype,"listMode",void 0),Object(r["a"])([Object(u["b"])({json:{read:!1},readOnly:!0,value:"map-image"})],z.prototype,"type",void 0),Object(r["a"])([Object(u["b"])(E["n"])],z.prototype,"url",void 0),z=Object(r["a"])([Object(b["a"])("esri.layers.MapImageLayer")],z);const L=z},"549a":function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("ce50");class n{constructor(e,t,i=""){this.major=e,this.minor=t,this._context=i}lessThan(e,t){return this.major<e||e===this.major&&this.minor<t}since(e,t){return!this.lessThan(e,t)}validate(e){if(this.major!==e.major){const t=this._context&&this._context+":",i=this._context&&this._context+" ";throw new r["a"](t+"unsupported-version",`Required major ${i}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:e})}}clone(){return new n(this.major,this.minor,this._context)}static parse(e,t=""){const[i,a]=e.split("."),s=/^\s*\d+\s*$/;if(!i||!i.match||!i.match(s))throw new r["a"]((t&&t+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:e});if(!a||!a.match||!a.match(s))throw new r["a"]((t&&t+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:e});const o=parseInt(i,10),c=parseInt(a,10);return new n(o,c,t)}}},5501:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("3886");function n(e,t){e.varyings.add("vtc","vec2"),e.vertex.uniforms.add("texOffsetAndScale","vec4"),e.fragment.uniforms.add("tex","sampler2D"),e.fragment.uniforms.add("textureOpacities","vec3"),t.textureFadingEnabled&&(e.vertex.uniforms.add("nextTexOffsetAndScale","vec4"),e.varyings.add("nvtc","vec2"),e.fragment.uniforms.add("texNext","sampler2D"),e.fragment.uniforms.add("nextTexOpacities","vec3"),e.fragment.uniforms.add("fadeFactor","float")),e.vertex.code.add(r["a"]`
  void forwardTextureCoordinates(in vec2 uv) {
    vtc = uv * texOffsetAndScale.zw + texOffsetAndScale.xy;
    ${t.textureFadingEnabled?r["a"]`nvtc = uv * nextTexOffsetAndScale.zw + nextTexOffsetAndScale.xy;`:r["a"]``}
  }`),t.useGrid?(e.fragment.code.add(r["a"]`float lineFactorAtPosition(float value) {
float pos = value * 129.0;
if(pos < 0.5 || pos > 128.5) {
return 1.0;
}
pos = pos + 0.5;
float modulo = mod(pos, 16.0);
return modulo <= 2.0 ?  1.0 - abs(modulo - 1.0) : 0.0;
}
float lineFactorAtUV(vec2 uv) {
return max(lineFactorAtPosition(uv.x), lineFactorAtPosition(uv.y));
}
float lineFactor(vec2 uv) {
vec2 offset = fwidth(uv) * 0.25;
return (lineFactorAtUV(vec2(uv.x + offset.x, uv.y + offset.y)) +
lineFactorAtUV(vec2(uv.x - offset.x, uv.y + offset.y)) +
lineFactorAtUV(vec2(uv.x + offset.x, uv.y - offset.y)) +
lineFactorAtUV(vec2(uv.x - offset.x, uv.y - offset.y))) / 4.0;
}
vec4 gridColor(vec2 uv) {
float line = lineFactor(uv) * 0.1 + 0.9;
float backgroundOpacity = textureOpacities.y;
return vec4(1.0, 0.972, 0.918, 1.0) * line * backgroundOpacity;
}`),e.fragment.code.add(r["a"]`vec4 getColor(vec4 color, vec2 uv, vec3 opacities) {
if (opacities.y <= 0.0) {
return color * opacities.z * opacities.x;
}
vec4 grid = gridColor(uv);
float alpha = opacities.z * color.a;
return mix(grid, color, alpha) * opacities.x;
}`)):t.hasBackgroundColor?(e.fragment.uniforms.add("backgroundColor","vec3"),e.fragment.code.add(r["a"]`vec4 getColor(vec4 color, vec2 uv, vec3 opacities) {
if (opacities.y <= 0.0) {
return color * opacities.z * opacities.x;
}
float alpha = opacities.z * color.a;
float backgroundOpacity = opacities.y;
return mix(vec4(backgroundColor, 1.0) * backgroundOpacity, color, alpha) * opacities.x;
}`)):e.fragment.code.add(r["a"]`vec4 getColor(vec4 color, vec2 uv, vec3 opacities) {
return color;
}`),t.textureFadingEnabled?e.fragment.code.add(r["a"]`vec4 getTileColor() {
vec4 color = getColor(texture2D(tex, vtc), vtc, textureOpacities);
if (fadeFactor >= 1.0) {
return color;
}
vec4 nextColor = getColor(texture2D(texNext, nvtc), nvtc, nextTexOpacities);
return mix(nextColor, color, fadeFactor);
}`):e.fragment.code.add(r["a"]`vec4 getTileColor() {
return getColor(texture2D(tex, vtc), vtc, textureOpacities);
}`)}},"55f0":function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var r=i("38a4"),n=i("0ca1"),a=i("b33e");class s{constructor(e=2.5,t=.01,i=.95,r=12){this.minimumInitialVelocity=e,this.stopVelocity=t,this.friction=i,this.maxVelocity=r,this.enabled=!0,this.value=new n["a"](.8),this.time=new n["a"](.3)}add(e,t){if(this.enabled){if(this.time.hasLastValue){if(this.time.computeDelta(t)<.01)return;if(this.value.hasFilteredDelta){const t=this.value.computeDelta(e);this.value.filteredDelta*t<0&&this.value.reset()}}this.time.update(t),this.value.update(e)}}reset(){this.value.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.value.hasFilteredDelta)return null;let e=this.value.filteredDelta/this.time.filteredDelta;return e=Object(r["f"])(e,-this.maxVelocity,this.maxVelocity),Math.abs(e)<this.minimumInitialVelocity?null:this.createMomentum(e,this.stopVelocity,this.friction)}createMomentum(e,t,i){return new a["a"](e,t,i)}}},5686:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("3886");function n(e,t){e.varyings.add("tbnTangent","vec3"),e.varyings.add("tbnBiTangent","vec3"),1===t.viewingMode?e.vertex.code.add(r["a"]`void forwardVertexTangent(vec3 n) {
tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), n));
tbnBiTangent = normalize(cross(n, tbnTangent));
}`):e.vertex.code.add(r["a"]`void forwardVertexTangent(vec3 n) {
tbnTangent = vec3(1.0, 0.0, 0.0);
tbnBiTangent = normalize(cross(n, tbnTangent));
}`),e.fragment.code.add(r["a"]`mat3 getTBNMatrix(vec3 n) {
return mat3(tbnTangent, tbnBiTangent, n);
}`)}},"572a":function(e,t,i){"use strict";i.d(t,"a",(function(){return g})),i.d(t,"b",(function(){return m}));var r=i("d272"),n=i("4db9"),a=i("5686"),s=i("c2d1"),o=i("6a07"),c=i("ea4b"),l=i("040b"),d=i("cd26"),h=i("b4c2"),u=i("5501"),p=i("d56e"),f=i("3886"),b=i("690a");function m(e){const t=new b["a"];if(t.include(p["a"],{name:"Terrain Shader",output:e.output}),t.include(h["a"]),t.attributes.add("position","vec3"),t.attributes.add("uv0","vec2"),t.vertex.uniforms.add("proj","mat4").add("view","mat4").add("origin","vec3").add("skirtScale","float"),0===e.output){t.include(n["a"],{linearDepth:!1}),t.include(l["a"],e),t.include(u["a"],e);const i=0!==e.overlayMode,s=2===e.overlayMode;i&&t.include(d["a"],{pbrMode:3,useCustomDTRExponentForWater:!1,ssrEnabled:e.ssrEnabled,highStepCount:e.highStepCount}),s&&t.include(a["a"],e),t.varyings.add("vnormal","vec3"),t.varyings.add("vpos","vec3"),t.vertex.uniforms.add("viewNormal","mat4"),e.receiveShadows&&t.varyings.add("linearDepth","float"),e.tileBorders&&t.varyings.add("vuv","vec2"),e.atmosphere&&(t.vertex.uniforms.add("lightingMainDirection","vec3"),t.varyings.add("wnormal","vec3"),t.varyings.add("wlight","vec3")),e.screenSizePerspective&&(t.vertex.uniforms.add("screenSizePerspective","vec4"),t.varyings.add("screenSizeDistanceToCamera","float"),t.varyings.add("screenSizeCosAngle","float")),t.vertex.code.add(f["a"]`
      void main(void) {
        vpos = position;
        vnormal = getLocalUp(vpos, origin);

        vec2 uv = uv0;
        vpos = applySkirts(uv, vpos, vnormal, skirtScale);
        ${e.atmosphere?f["a"]`
        wnormal = normalize((viewNormal * vec4(normalize(vpos + origin), 1.0)).xyz);
        wlight = normalize((view  * vec4(lightingMainDirection, 1.0)).xyz);`:""}
        ${e.tileBorders?f["a"]`vuv = uv;`:""}
        ${e.screenSizePerspective?f["a"]`
        vec3 viewPos = (view * vec4(vpos, 1.0)).xyz;
        screenSizeDistanceToCamera = length(viewPos);
        vec3 viewSpaceNormal = (viewNormal * vec4(normalize(vpos + origin), 1.0)).xyz;
        screenSizeCosAngle = abs(viewSpaceNormal.z);`:""}
        gl_Position = transformPosition(proj, view, vpos);
        ${e.receiveShadows?f["a"]`linearDepth = gl_Position.w;`:""}
        forwardTextureCoordinates(uv);
        ${i?f["a"]`setOverlayVTC(uv);`:""}
        ${s?f["a"]`forwardVertexTangent(vnormal);`:f["a"]``}
      }
    `),t.extensions.add("GL_OES_standard_derivatives"),t.extensions.add("GL_EXT_shader_texture_lod"),t.include(r["a"],e),t.include(c["a"],e),t.fragment.uniforms.add("camPos","vec3").add("viewDirection","vec3").add("ssaoTex","sampler2D").add("viewportPixelSz","vec4"),e.screenSizePerspective&&t.fragment.uniforms.add("screenSizePerspective","vec4"),s&&(t.fragment.uniforms.add("ovWaterTex","sampler2D"),t.fragment.uniforms.add("view","mat4")),t.fragment.code.add(f["a"]`const float sliceOpacity = 0.2;
float lum(vec3 c) {
return (min(min(c.r, c.g), c.b) + max(max(c.r, c.g), c.b)) * 0.5;
}`),t.fragment.code.add(f["a"]`
      void main() {
        ${e.receiveShadows?f["a"]`float shadow = readShadowMap(vpos, linearDepth);`:f["a"]`float shadow = 0.0;`}
        float vndl = dot(normalize(vnormal), lightingMainDirection);

        float ssao = viewportPixelSz.w < .0 ? 1.0 : texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;
        vec4 tileColor = getTileColor();
        ${i?f["a"]`
            vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
            vec4 overlayColor = overlayOpacity * overlayColorOpaque;
            vec4 groundColor = tileColor;
            tileColor = tileColor * (1.0 - overlayColor.a) + overlayColor;`:""}
        if (rejectBySlice(vpos)) {
          tileColor *= sliceOpacity;
        }
        ${e.atmosphere?f["a"]`
            float ndotl = clamp(vndl, 0.0, 1.0);
            vec3 atm = vec3(clamp(1.0 - dot(-viewDirection, wnormal), 0.0, 1.0));
            atm *= clamp(1.0 - lum(tileColor.rgb) * 1.5, 0.0, 1.0); //avoid atmosphere on bright base maps
            atm *= clamp(ndotl * 2.0, 0.0, 1.0); // avoid atmosphere on dark side of the globe
            atm *= tileColor.a; // premultiply with tile alpha`:""}

        vec3 albedo = ${e.atmosphere?f["a"]`atm + tileColor.rgb;`:f["a"]`tileColor.rgb;`}
        vec3 normal = normalize(vnormal);

        // heuristic shading function used in the old terrain, now used to add ambient lighting
        float additionalAmbientScale = smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

        gl_FragColor = vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);
        ${s?f["a"]`
            vec4 overlayWaterMask = getOverlayColor(ovWaterTex, vtcOverlay);
            float waterNormalLength = length(overlayWaterMask);
            if (waterNormalLength > 0.95) {
              mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, vnormal);
              vec4 waterOverlayColor = vec4(overlayColor.w > 0.0 ? overlayColorOpaque.xyz/overlayColor.w : vec3(1.0), overlayColor.w);
              vec4 viewPosition = view*vec4(vpos, 1.0);
              vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vpos - camPos), shadow, vnormal, tbnMatrix, viewPosition.xyz);
              vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
              // un-gamma the ground color to mix in linear space
              gl_FragColor = mix(groundColor, waterColorNonLinear, waterColorLinear.w);
            }`:""}
        ${e.screenSizePerspective?f["a"]`
          float perspectiveScale = screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, screenSizePerspective);
          if (perspectiveScale <= 0.25) {
            gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);
          }
          else if (perspectiveScale <= 0.5) {
            gl_FragColor = mix(gl_FragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);
          }
          else if (perspectiveScale >= 0.99) {
            gl_FragColor = mix(gl_FragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);
          }
          else {
            gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);
          }`:""}
        ${e.tileBorders?f["a"]`
            vec2 dVuv = fwidth(vuv);
            vec2 edgeFactors = smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv, 1.0 - vuv));
            float edgeFactor = 1.0 - min(edgeFactors.x, edgeFactors.y);
            gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);`:""}
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
      }
    `)}return 1!==e.output&&3!==e.output||(t.include(n["a"],{linearDepth:!0}),t.include(s["a"],{output:e.output}),t.include(l["a"],e),t.varyings.add("linearDepth","float"),t.vertex.uniforms.add("nearFar","vec2"),t.vertex.code.add(f["a"]`void main(void) {
vec3 normal = getLocalUp(position, origin);
vec2 uv = uv0;
vec3 vpos = applySkirts(uv, position, normal.xyz, skirtScale);
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);
}`),t.fragment.code.add(f["a"]`void main() {
outputDepth(linearDepth);
}`)),2===e.output&&(t.include(n["a"],{linearDepth:!1}),t.include(l["a"],e),t.varyings.add("vnormal","vec3"),t.varyings.add("vpos","vec3"),t.vertex.uniforms.add("viewNormal","mat4"),t.vertex.code.add(f["a"]`void main(void) {
vec3 normal = getLocalUp(position, origin);
vec2 uv = uv0;
vpos = applySkirts(uv, position, normal, skirtScale);
gl_Position = transformPosition(proj, view, vpos);
vnormal = normalize((viewNormal * vec4(normal, 1.0)).xyz);
}`),t.fragment.code.add(f["a"]`void main() {
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) {
normal = -normal;
}
gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 0.0);
}`)),4===e.output&&(t.include(n["a"],{linearDepth:!1}),t.include(l["a"],e),t.include(d["a"],{pbrMode:0}),t.vertex.code.add(f["a"]`void main() {
vec3 vnormal = getLocalUp(position, origin);
vec2 uv = uv0;
vec3 vpos = applySkirts(uv, position, vnormal, skirtScale);
setOverlayVTC(uv);
gl_Position = transformPosition(proj, view, vpos);
}`),t.include(o["a"]),t.fragment.code.add(f["a"]`void main() {
vec4 overlayColor = getCombinedOverlayColor();
if (overlayColor.a == 0.0) {
gl_FragColor = vec4(0.0);
return;
}
outputHighlight();
}`)),t}const g=Object.freeze({__proto__:null,build:m})},"579f":function(e,t,i){"use strict";i.d(t,"a",(function(){return c})),i.d(t,"b",(function(){return l}));var r=i("2119"),n=i("3349"),a=i("e431"),s=i("0b2d"),o=i("bd7e");i("7361");function c(e,t,i){const r=Object(n["b"])(e,t),a=Object(n["b"])(t,i),s=Object(n["b"])(i,e),o=(r+a+s)/2,c=o*(o-r)*(o-a)*(o-s);return c<=0?0:Math.sqrt(c)}function l(e,t,i){return Object(a["m"])(d,t,e),Object(a["m"])(h,i,e),Object(a["s"])(Object(a["j"])(d,d,h))/2}new r["a"](o["d"]),new r["a"](()=>({p0:null,p1:null,p2:null}));const d=Object(s["f"])(),h=Object(s["f"])()},5876:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("3886");function n(e){e.vertex.code.add(r["a"]`
    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {
      float symbolAlpha = 0.0;

      const float maxTint = 85.0;
      const float maxReplace = 170.0;
      const float scaleAlpha = 3.0;

      if (symbolColor.a > maxReplace) {
        colorMixMode = ${r["a"].int(1)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);
      } else if (symbolColor.a > maxTint) {
        colorMixMode = ${r["a"].int(3)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);
      } else if (symbolColor.a > 0.0) {
        colorMixMode = ${r["a"].int(4)};
        symbolAlpha = scaleAlpha * symbolColor.a;
      } else {
        colorMixMode = ${r["a"].int(1)};
        symbolAlpha = 0.0;
      }

      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);
    }
  `)}},"58c2":function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("3886");function n(e){e.fragment.uniforms.add("projInfo","vec4"),e.fragment.uniforms.add("zScale","vec2"),e.fragment.code.add(r["a"]`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)}},5957:function(e,t,i){"use strict";i.d(t,"a",(function(){return c})),i.d(t,"b",(function(){return u})),i.d(t,"c",(function(){return p})),i.d(t,"d",(function(){return d})),i.d(t,"e",(function(){return l}));var r=i("d791"),n=i("8190"),a=i("1153");function s(e,t,i,r){const n=i.typedBuffer,a=i.typedBufferStride,s=e.length;r*=a;for(let o=0;o<s;++o){const i=2*e[o];n[r]=t[i],n[r+1]=t[i+1],r+=a}}function o(e,t,i,r,n){const a=i.typedBuffer,s=i.typedBufferStride,o=e.length;if(r*=s,null==n||1===n)for(let c=0;c<o;++c){const i=3*e[c];a[r]=t[i],a[r+1]=t[i+1],a[r+2]=t[i+2],r+=s}else for(let c=0;c<o;++c){const i=3*e[c];for(let e=0;e<n;++e)a[r]=t[i],a[r+1]=t[i+1],a[r+2]=t[i+2],r+=s}}function c(e,t,i,r,n=1){const a=i.typedBuffer,s=i.typedBufferStride,o=e.length;if(r*=s,1===n)for(let c=0;c<o;++c){const i=4*e[c];a[r]=t[i],a[r+1]=t[i+1],a[r+2]=t[i+2],a[r+3]=t[i+3],r+=s}else for(let c=0;c<o;++c){const i=4*e[c];for(let e=0;e<n;++e)a[r]=t[i],a[r+1]=t[i+1],a[r+2]=t[i+2],a[r+3]=t[i+3],r+=s}}function l(e,t,i,r,n,a=1){if(!i)return void o(e,t,r,n,a);const s=r.typedBuffer,c=r.typedBufferStride,l=e.length,d=i[0],h=i[1],u=i[2],p=i[4],f=i[5],b=i[6],m=i[8],g=i[9],v=i[10],y=i[12],O=i[13],_=i[14];if(n*=c,1===a)for(let o=0;o<l;++o){const i=3*e[o],r=t[i],a=t[i+1],l=t[i+2];s[n]=d*r+p*a+m*l+y,s[n+1]=h*r+f*a+g*l+O,s[n+2]=u*r+b*a+v*l+_,n+=c}else for(let o=0;o<l;++o){const i=3*e[o],r=t[i],l=t[i+1],x=t[i+2],j=d*r+p*l+m*x+y,w=h*r+f*l+g*x+O,S=u*r+b*l+v*x+_;for(let e=0;e<a;++e)s[n]=j,s[n+1]=w,s[n+2]=S,n+=c}}function d(e,t,i,n,a,s=1){if(!i)return void o(e,t,n,a,s);const c=i,l=n.typedBuffer,d=n.typedBufferStride,h=e.length,u=c[0],p=c[1],f=c[2],b=c[4],m=c[5],g=c[6],v=c[8],y=c[9],O=c[10],_=!Object(r["l"])(c),x=1e-6,j=1-x;if(a*=d,1===s)for(let r=0;r<h;++r){const i=3*e[r],n=t[i],s=t[i+1],o=t[i+2];let c=u*n+b*s+v*o,h=p*n+m*s+y*o,w=f*n+g*s+O*o;if(_){const e=c*c+h*h+w*w;if(e<j&&e>x){const t=1/Math.sqrt(e);c*=t,h*=t,w*=t}}l[a+0]=c,l[a+1]=h,l[a+2]=w,a+=d}else for(let r=0;r<h;++r){const i=3*e[r],n=t[i],o=t[i+1],c=t[i+2];let h=u*n+b*o+v*c,w=p*n+m*o+y*c,S=f*n+g*o+O*c;if(_){const e=h*h+w*w+S*S;if(e<j&&e>x){const t=1/Math.sqrt(e);h*=t,w*=t,S*=t}}for(let e=0;e<s;++e)l[a+0]=h,l[a+1]=w,l[a+2]=S,a+=d}}function h(e,t,i,n,a,s=1){if(!i)return void c(e,t,n,a,s);const o=i,l=n.typedBuffer,d=n.typedBufferStride,h=e.length,u=o[0],p=o[1],f=o[2],b=o[4],m=o[5],g=o[6],v=o[8],y=o[9],O=o[10],_=!Object(r["l"])(o),x=1e-6,j=1-x;if(a*=d,1===s)for(let r=0;r<h;++r){const i=4*e[r],n=t[i],s=t[i+1],o=t[i+2],c=t[i+3];let h=u*n+b*s+v*o,w=p*n+m*s+y*o,S=f*n+g*s+O*o;if(_){const e=h*h+w*w+S*S;if(e<j&&e>x){const t=1/Math.sqrt(e);h*=t,w*=t,S*=t}}l[a+0]=h,l[a+1]=w,l[a+2]=S,l[a+3]=c,a+=d}else for(let r=0;r<h;++r){const i=4*e[r],n=t[i],o=t[i+1],c=t[i+2],h=t[i+3];let w=u*n+b*o+v*c,S=p*n+m*o+y*c,T=f*n+g*o+O*c;if(_){const e=w*w+S*S+T*T;if(e<j&&e>x){const t=1/Math.sqrt(e);w*=t,S*=t,T*=t}}for(let e=0;e<s;++e)l[a+0]=w,l[a+1]=S,l[a+2]=T,l[a+3]=h,a+=d}}function u(e,t,i,r,n,a=1){const s=r.typedBuffer,o=r.typedBufferStride,c=e.length;if(n*=o,1===a){if(4===i)for(let l=0;l<c;++l){const i=4*e[l];s[n]=t[i],s[n+1]=t[i+1],s[n+2]=t[i+2],s[n+3]=t[i+3],n+=o}else if(3===i)for(let l=0;l<c;++l){const i=3*e[l];s[n]=t[i],s[n+1]=t[i+1],s[n+2]=t[i+2],s[n+3]=255,n+=o}}else if(4===i)for(let l=0;l<c;++l){const i=4*e[l];for(let e=0;e<a;++e)s[n]=t[i],s[n+1]=t[i+1],s[n+2]=t[i+2],s[n+3]=t[i+3],n+=o}else if(3===i)for(let l=0;l<c;++l){const i=3*e[l];for(let e=0;e<a;++e)s[n]=t[i],s[n+1]=t[i+1],s[n+2]=t[i+2],s[n+3]=255,n+=o}}function p(e,t,i,r,o,c){for(const p of t.fieldNames){const t=e.vertexAttributes.get(p),f=e.indices.get(p);if(t&&f)switch(p){case"position":{Object(a["a"])(3===t.size);const e=o.getField(p,n["u"]);e&&l(f,t.data,i,e,c);break}case"normal":{Object(a["a"])(3===t.size);const e=o.getField(p,n["u"]);e&&d(f,t.data,r,e,c);break}case"uv0":{Object(a["a"])(2===t.size);const e=o.getField(p,n["m"]);e&&s(f,t.data,e,c);break}case"color":{Object(a["a"])(3===t.size||4===t.size);const e=o.getField(p,n["J"]);e&&u(f,t.data,t.size,e,c);break}case"symbolColor":{Object(a["a"])(3===t.size||4===t.size);const e=o.getField(p,n["J"]);e&&u(f,t.data,t.size,e,c);break}case"tangent":{Object(a["a"])(4===t.size);const e=o.getField(p,n["C"]);e&&h(f,t.data,r,e,c);break}}}}},"5a22":function(e,t,i){"use strict";i.d(t,"a",(function(){return b}));var r=i("b2b2"),n=i("d791"),a=i("afe1"),s=i("e431"),o=i("0b2d"),c=i("f895"),l=i("680b"),d=i("003f"),h=i("697e"),u=i("bea9"),p=i("1153"),f=i("b623");class b extends d["a"]{constructor(e={}){super(),this.type=1,this._geometryRecords=new Array,this._geometries=new Array,this._objectTransformation=Object(a["d"])(),this._bvObjectSpace=new g,this._bvWorldSpace=new g,this._bvDirty=!0,this._hasVolatileTransformation=!1,this._visible=!0,this.castShadow=null==e.castShadow||e.castShadow,this.metadata=e.metadata,this.metadata&&this.metadata.isElevationSource&&(this.metadata.lastValidElevationBB=new m),this.transformation=Object(a["d"])();const{geometries:t,materials:i,transformations:r,origins:n}=e;if(Array.isArray(t)){Object(p["a"])(i.length===t.length,"Object3D: materials don't match geometries"),Object(p["a"])(r.length===t.length,"Object3D: transformations don't match geometries"),this._geometryRecords.length=t.length,this._geometries.length=t.length;for(let e=0;e<t.length;e++)this._geometries[e]=t[e],this._geometryRecords[e]=h["a"].pool.acquire(t[e],i[e],Object(a["c"])(r[e]),{highlights:null,occludees:null,visible:this._visible},n&&n[e])}}get geometryRecords(){return this._geometryRecords}get geometries(){return this._geometries}get transformation(){return this._objectTransformation}set transformation(e){Object(n["d"])(this._objectTransformation,e),this._invalidateBoundingVolume(),this._emit("objectTransformation",this)}dispose(){this._geometryRecords.length=0,this._geometries.length=0}get parentLayer(){return this._parentLayer}set parentLayer(e){Object(p["a"])(null==this._parentLayer||null==e,"Object3D can only be added to a single Layer"),this._parentLayer=e}addGeometry(e,t,i,n,s){i=i||a["a"],this._geometries.push(e);const o=h["a"].pool.acquire(e,t,i,{highlights:null,occludees:null,visible:this._visible},n,s);return this._geometryRecords.push(o),this._hasVolatileTransformation=this._hasVolatileTransformation||Object(r["l"])(o.shaderTransformation),this._emit("objectGeometryAdded",{object:this,record:o}),this._invalidateBoundingVolume(),o}removeGeometry(e){const t=this._geometryRecords.splice(e,1)[0];return this._hasVolatileTransformation=Object(r["l"])(t.shaderTransformation)?this._geometryRecords.some(e=>Object(r["l"])(e.shaderTransformation)):this._hasVolatileTransformation,t.dispose(),this._geometries.splice(e,1),this._emit("objectGeometryRemoved",{object:this,record:t}),this._invalidateBoundingVolume(),t}removeAllGeometries(){for(;this.geometryRecords.length>0;)this.removeGeometry(0)}geometryVertexAttrsUpdated(e){this._emit("vertexAttrsUpdated",{object:this,record:e}),this._invalidateBoundingVolume()}get isVisible(){return this._visible}setVisible(e){if(this._visible!==e){this._visible=e;for(const e of this._geometryRecords)e.instanceParameters.visible=this._visible;this._emit("visibilityChanged",this)}}maskOccludee(){const e=new u["a"](1);for(const t of this._geometryRecords)t.instanceParameters.occludees=Object(f["a"])(t.instanceParameters.occludees,e);return this._emit("occlusionChanged",this),e}removeOcclude(e){for(const t of this._geometryRecords)t.instanceParameters.occludees=Object(f["e"])(t.instanceParameters.occludees,e);this._emit("occlusionChanged",this)}highlight(){const e=new u["a"](0);for(const t of this._geometryRecords)t.instanceParameters.highlights=Object(f["a"])(t.instanceParameters.highlights,e);return this._emit("highlightChanged",this),e}removeHighlight(e){for(const t of this._geometryRecords)t.instanceParameters.highlights=Object(f["e"])(t.instanceParameters.highlights,e);this._emit("highlightChanged",this)}getCombinedStaticTransformation(e,t){return Object(n["n"])(Object(r["v"])(t,Object(a["d"])()),this.transformation,e.getStaticTransformation())}getCombinedShaderTransformation(e,t){return t=t||Object(a["d"])(),Object(n["n"])(t,this.transformation,e.getShaderTransformation()),t}hasVolativeTransformation(){return this._hasVolatileTransformation}get boundingVolumeWorldSpace(){return this._validateBoundingVolume(),this._bvWorldSpace}get boundingVolumeObjectSpace(){return this._validateBoundingVolume(),this._bvObjectSpace}_validateBoundingVolume(){if(!this._bvDirty&&!this._hasVolatileTransformation)return;this._bvObjectSpace.init(),this._bvWorldSpace.init();for(let n=0;n<this._geometryRecords.length;++n){const e=this._geometries[n],t=this._geometryRecords[n],i=e.boundingInfo;Object(r["l"])(i)&&(this._calculateTransformedBoundingVolume(i,this._bvObjectSpace,t.getShaderTransformation()),this._calculateTransformedBoundingVolume(i,this._bvWorldSpace,this.getCombinedShaderTransformation(t)))}Object(s["l"])(this._bvObjectSpace.bounds,this._bvObjectSpace.min,this._bvObjectSpace.max,.5),Object(s["l"])(this._bvWorldSpace.bounds,this._bvWorldSpace.min,this._bvWorldSpace.max,.5);const e=Object(o["f"])(),t=Object(o["f"])(),i=Object(l["i"])(this.transformation);for(let n=0;n<this._geometryRecords.length;++n){const a=this._geometries[n].boundingInfo;if(Object(r["k"])(a))continue;const o=this._geometryRecords[n].getShaderTransformation(),c=Object(l["i"])(o);Object(s["t"])(e,a.getCenter(),o);const d=Object(s["p"])(e,this._bvObjectSpace.bounds),h=a.getBSRadius()*c;this._bvObjectSpace.bounds[3]=Math.max(this._bvObjectSpace.bounds[3],d+h),Object(s["t"])(t,e,this.transformation);const u=Object(s["p"])(t,this._bvWorldSpace.bounds),p=h*i;this._bvWorldSpace.bounds[3]=Math.max(this._bvWorldSpace.bounds[3],u+p)}this._bvDirty=!1}_calculateTransformedBoundingVolume(e,t,i){const r=e.getBBMin(),n=e.getBBMax(),a=Object(o["d"])(r),c=Object(o["d"])(n);Object(s["t"])(a,a,i),Object(s["t"])(c,c,i);for(let s=0;s<3;++s)t.min[s]=Math.min(t.min[s],a[s],c[s]),t.max[s]=Math.max(t.max[s],a[s],c[s]);for(let o=0;o<3;++o){Object(s["n"])(a,r),Object(s["n"])(c,n),a[o]=n[o],c[o]=r[o],Object(s["t"])(a,a,i),Object(s["t"])(c,c,i);for(let e=0;e<3;++e)t.min[e]=Math.min(t.min[e],a[e],c[e]),t.max[e]=Math.max(t.max[e],a[e],c[e])}}_invalidateBoundingVolume(){this._bvDirty=!0,Object(r["l"])(this._parentLayer)&&this._parentLayer.notifyObjectBBChanged(this,this._bvWorldSpace.bounds)}_emit(e,t){Object(r["l"])(this._parentLayer)&&this._parentLayer.events.emit(e,t)}get test(){const e=this;return{hasGeometry:t=>e._geometries.indexOf(t)>-1,getGeometryIndex:t=>e._geometries.indexOf(t)}}}class m{constructor(){this.min=Object(o["h"])(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.max=Object(o["h"])(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}isEmpty(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}}class g extends m{constructor(){super(...arguments),this.bounds=Object(c["c"])()}init(){Object(s["z"])(this.min,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),Object(s["z"])(this.max,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),Object(c["a"])(this.bounds)}}},"5c33":function(e,t,i){"use strict";i.d(t,"a",(function(){return l})),i.d(t,"b",(function(){return c}));var r=i("b2b2"),n=i("6be6"),a=i("7a91"),s=i("a978");function o(e){return Object(s["c"])(e)&&6===e.intersector&&!!e.target}function c(e,t){return Object(s["b"])(e)||Object(s["a"])(e)?u(e.target.object.metadata,t):Object(a["b"])(e)?null==(i=t.map)?void 0:i.ground:Object(n["b"])(e)||Object(n["a"])(e)||Object(a["a"])(e)?u(e.target,t):null;var i}function l(e,t){return Object(s["b"])(e)||Object(s["a"])(e)?d(e.target.object.metadata,t):Object(n["b"])(e)?e.target.createGraphic():Object(a["a"])(e)||o(e)?d(e.target,t):Object(n["a"])(e)?h(e.target,t):null}function d(e,t){if(Object(r["k"])(e)||Object(r["k"])(e.graphicUid))return null;const i=u(e,t);if(Object(r["k"])(i))return null;if(i===t.graphics)return Object(r["l"])(t.graphicsView)?t.graphicsView.getGraphicFromGraphicUid(e.graphicUid):null;const n=t.allLayerViews.find(e=>e.layer===i);return n&&!n.suspended&&"getGraphicFromGraphicUid"in n&&Object(r["l"])(e.graphicUid)?n.getGraphicFromGraphicUid(e.graphicUid):null}function h(e,t){const i=u(e,t);if(Object(r["k"])(i))return null;const n=t.allLayerViews.find(e=>e.layer===i);return n&&!n.suspended&&"getGraphicFromIntersectorTarget"in n?n.getGraphicFromIntersectorTarget(e):null}function u(e,t){return Object(r["k"])(e.layerUid)?null:Object(r["l"])(t.graphicsView)&&e.layerUid===t.graphicsView.graphics3d.layer.id?t.graphics:t.map.findLayerByUid(e.layerUid)}},"5d07":function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var r=i("3886"),n=i("ee2c"),a=i("b3a9");function s(e,t){const i=e.vertex;switch(e.include(a["a"],t),n["a"].usesSketchLogic(t)&&i.uniforms.add("uStrokesAmplitude","float"),t.mode){case 0:i.code.add(r["a"]`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return 0.0;
}`);break;case 1:i.code.add(r["a"]`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return uStrokesAmplitude;
}`);break;case 2:i.code.add(r["a"]`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
float type = unpackedAttributes.type;
if (type <= 0.0) {
return uStrokesAmplitude;
}
else {
return 0.0;
}
}`)}}},"5d5f":function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var r=i("3886");function n(e){const t=e.fragment.code;t.add(r["a"]`vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)
{
return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
}`),t.add(r["a"]`float integratedRadiance(float cosTheta2, float roughness)
{
return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
}`),t.add(r["a"]`vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)
{
float cosTheta2 = 1.0 - RdotNG * RdotNG;
float intRadTheta = integratedRadiance(cosTheta2, roughness);
float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
float sky = 2.0 - ground;
return (ground * ambientGround + sky * ambientSky) * 0.5;
}`)}var a=i("c51b");function s(e,t){const i=e.fragment.code;e.include(a["a"]),3===t.pbrMode||4===t.pbrMode?(i.add(r["a"]`
    struct PBRShadingWater
    {
        float NdotL;   // cos angle between normal and light direction
        float NdotV;   // cos angle between normal and view direction
        float NdotH;   // cos angle between normal and half vector
        float VdotH;   // cos angle between view direction and half vector
        float LdotH;   // cos angle between light direction and half vector
        float VdotN;   // cos angle between view direction and normal vector
    };

    float dtrExponent = ${t.useCustomDTRExponentForWater?"2.2":"2.0"};
    `),i.add(r["a"]`vec3 fresnelReflection(float angle, vec3 f0, float f90) {
return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
}`),i.add(r["a"]`float normalDistributionWater(float NdotH, float roughness)
{
float r2 = roughness * roughness;
float NdotH2 = NdotH * NdotH;
float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
return r2 / denom;
}`),i.add(r["a"]`float geometricOcclusionKelemen(float LoH)
{
return 0.25 / (LoH * LoH);
}`),i.add(r["a"]`vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)
{
vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
float dSun = normalDistributionWater(props.NdotH, roughness);
float V = geometricOcclusionKelemen(props.LdotH);
float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
float strengthSunHaze  = 1.2;
float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;
return ((dSun + dSunHaze) * V) * F;
}
vec3 tonemapACES(const vec3 x) {
return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);
}`)):1!==t.pbrMode&&2!==t.pbrMode||(e.include(n),i.add(r["a"]`struct PBRShadingInfo
{
float NdotL;
float NdotV;
float NdotH;
float VdotH;
float LdotH;
float NdotNG;
float RdotNG;
float NdotAmbDir;
float NdotH_Horizon;
vec3 skyRadianceToSurface;
vec3 groundRadianceToSurface;
vec3 skyIrradianceToSurface;
vec3 groundIrradianceToSurface;
float averageAmbientRadiance;
float ssao;
vec3 albedoLinear;
vec3 f0;
vec3 f90;
vec3 diffuseColor;
float metalness;
float roughness;
};`),i.add(r["a"]`float normalDistribution(float NdotH, float roughness)
{
float a = NdotH * roughness;
float b = roughness / (1.0 - NdotH * NdotH + a * a);
return b * b * INV_PI;
}`),i.add(r["a"]`const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
const vec2 c2 = vec2(-1.04, 1.04);
vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
vec4 r = roughness * c0 + c1;
float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
return c2 * a004 + r.zw;
}`),i.add(r["a"]`vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);
vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;
vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
vec3 specularComponent = specularColor * indirectSpecular;
return (diffuseComponent + specularComponent);
}`),i.add(r["a"]`float gamutMapChanel(float x, vec2 p){
return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
}`),i.add(r["a"]`vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){
vec3 outColor;
vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));
outColor.x = gamutMapChanel(inColor.x, p) ;
outColor.y = gamutMapChanel(inColor.y, p) ;
outColor.z = gamutMapChanel(inColor.z, p) ;
return outColor;
}`))}},"5e2a":function(e,t,i){"use strict";i.d(t,"a",(function(){return g})),i.d(t,"b",(function(){return m}));var r=i("d272"),n=i("d047"),a=i("c6d7"),s=i("3886"),o=i("690a"),c=i("6fcc"),l=i("c3a3"),d=i("c332f"),h=i("1af8"),u=i("ee2c"),p=i("5d07"),f=i("de47"),b=i("b3a9");function m(e){const t=new o["a"],i=t.vertex,m=t.fragment;return e.legacy&&i.uniforms.add("uModel","mat4"),e.antialiasing&&(i.code.add(s["a"]`#define ANTIALIASING 1`),m.code.add(s["a"]`#define ANTIALIASING 1`)),t.include(c["a"],e),t.include(p["a"],e),t.include(u["a"],e),t.include(b["a"],e),t.include(f["a"],e),t.include(r["a"],e),t.include(d["a"],e),t.include(l["a"],e),t.include(h["a"],e),t.varyings.add("vColor","vec4"),t.varyings.add("vRadius","float"),t.varyings.add("vPosition","vec3"),t.varyings.add("vWorldPosition","vec3"),t.varyings.add("vViewPos","vec3"),t.varyings.add("vLineLengthPixels","float"),t.varyings.add("vSizeFalloffFactor","float"),i.uniforms.add("uPixelToNDC","vec2"),i.uniforms.add("uNDCToPixel","vec2"),i.uniforms.add("uPixelRatio","float"),t.attributes.add("position0","vec3"),t.attributes.add("position1","vec3"),t.attributes.add("variantOffset","float"),t.attributes.add("variantStroke","float"),t.attributes.add("variantExtension","float"),i.code.add(s["a"]`const float opaqueCutoff = 1.0 / 255.0;
void calculateGeometricOutputs(vec3 viewPosV0, vec3 viewPosV1, vec3 worldPosV0, vec3 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {
vec2 sideness = unpackedAttributes.sideness;
vec2 sidenessNorm = unpackedAttributes.sidenessNorm;
vWorldPosition = mix(worldPosV0, worldPosV1, sidenessNorm.y).xyz;
vec3 viewPos = mix(viewPosV0, viewPosV1, sidenessNorm.y);
vViewPos = viewPos;
vec4 projPosV0 = projFromViewPosition(viewPosV0);
vec4 projPosV1 = projFromViewPosition(viewPosV1);
vec4 projPos = projFromViewPosition(viewPos);
vec3 screenSpaceLineNDC = (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);
vec2 screenSpaceLinePixels = screenSpaceLineNDC.xy * uNDCToPixel;
float lineLengthPixels = length(screenSpaceLinePixels);
float dzPerPixel = screenSpaceLineNDC.z / lineLengthPixels;
vec2 screenSpaceDirection = screenSpaceLinePixels / lineLengthPixels;
vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;
float falloffFactor = distanceBasedPerspectiveFactor(-viewPos.z) * uPixelRatio;
float lineWidthPixels = unpackedAttributes.lineWidthPixels * falloffFactor;
float extensionLengthPixels = calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;
float lineAmplitudePixels = calculateLineAmplitude(unpackedAttributes) * uPixelRatio;
vSizeFalloffFactor = falloffFactor;
float lineWidthAndAmplitudePixels = lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;
float extendedLineLengthPixels = lineLengthPixels + extensionLengthPixels + extensionLengthPixels;
#ifdef ANTIALIASING
const float aaPaddingPixels = 1.0;
float halfAAPaddedLineWidthAndAmplitudePixels = lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;
float aaPaddedRoundedCapSizePixels = lineWidthPixels * 0.5 + aaPaddingPixels;
#else
float halfAAPaddedLineWidthAndAmplitudePixels = max(lineWidthAndAmplitudePixels, 1.0) * 0.5;
float aaPaddedRoundedCapSizePixels = max(lineWidthPixels, 1.0) * 0.5;
#endif
vec2 halfAAPaddedLineWidthAndAmplitudeNDC = halfAAPaddedLineWidthAndAmplitudePixels * uPixelToNDC;
vec2 aaPaddedRoundedCapSizeNDC = aaPaddedRoundedCapSizePixels * uPixelToNDC;
vec2 extensionLengthNDC = extensionLengthPixels * uPixelToNDC;
vec2 ndcOffset = (
screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)
+ perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC
);
projPos.xy += ndcOffset * projPos.w;
projPos.z += (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;
projPos = adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));
float aaPaddedLineWithCapsLengthPixels = extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;
float pixelPositionAlongLine = aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;
vPosition = vec3(
halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,
pixelPositionAlongLine,
pixelPositionAlongLine / extendedLineLengthPixels
);
vRadius = lineWidthPixels * 0.5;
vLineLengthPixels = extendedLineLengthPixels;
discardShortEdges(unpackedAttributes, lineLengthPixels);
gl_Position = projPos;
}
void main() {
ComponentData component = readComponentData();
UnpackedAttributes unpackedAttributes = unpackAttributes(component);
vec3 worldPosV0 = worldFromModelPosition(position0);
vec3 worldPosV1 = worldFromModelPosition(position1);
vec3 viewPosV0 = viewFromModelPosition(position0);
vec3 viewPosV1 = viewFromModelPosition(position1);
vColor = component.color;
if (vColor.a < opaqueCutoff) {
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return;
}
if (discardNonSilhouetteEdges(viewPosV0, worldPosV0)) {
return;
}
calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal(), unpackedAttributes);
calculateStyleOutputs(unpackedAttributes);
}`),e.multipassTerrainEnabled&&(t.fragment.include(n["a"]),t.include(a["b"],e)),t.fragment.code.add(s["a"]`
    vec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {
      float lineOffset = calculateLineOffset();
      float positionX = position.x - lineOffset;

      if (radius < 1.0) {
        // Handle this specifically for subpixel sizes:
        // 1. Compute correct coverage (note coverage is computed by
        //    0.5 - dist, so we make sure that that will lead to correct
        //    subpixel coverage
        // 2. Ignore rounded caps
        float coverageX = clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);
        float coverageY = clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);

        float coverage = min(coverageX, coverageY);

        return vec2(0.5 - coverage, 0.0);
      }
      else {
        // Between -radius -> 0 for start cap, 0 for line, 0 -> radius
        float positionOnCap = position.y - clamp(position.y, 0.0, lineLength);

        vec2 lineToPosition = vec2(positionX, positionOnCap);
        return vec2(length(lineToPosition) - radius, positionOnCap / radius);
      }
    }

    void main() {
      ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, vViewPos.z);":""}
      float radius = vRadius * calculateLinePressure();

      vec2 distance = lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);
      float coverage = clamp(0.5 - distance.x, 0.0, 1.0);

      discardByCoverage(radius, coverage);
      discardBySlice(vWorldPosition);

      float alpha = vColor.a * coverage;

      gl_FragColor = vec4(vColor.rgb, alpha);

    }
  `),t}const g=Object.freeze({__proto__:null,build:m})},"5e82":function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i("b2b2"),n=i("f4cc");class a{constructor(e){this.schedule=e,this._loadStatus=0,this.logger=null}destroy(){this.abortLoad()}get loadStatus(){return this._loadStatus}load(e,t){return 1===this._loadStatus?(e&&e(),Object(r["u"])(this._loader)):2===this._loadStatus?(t&&t(this._loadError),Object(r["u"])(this._loader)):(Object(r["k"])(this._loader)&&(this._abortController=new AbortController,this._loader=this.doLoad(this._abortController.signal).then(()=>{this._abortController=null,this._loadStatus=1},e=>{throw this._loadError=e,this._abortController=null,this._loadStatus=2,!Object(n["m"])(e)&&this.logger&&e.message&&this.logger.warn(e.message),e})),this._loader.then(e,t).catch(()=>{}),this._loader)}abortLoad(){Object(r["l"])(this._abortController)?this._abortController=Object(r["a"])(this._abortController):0===this._loadStatus&&(this._loadStatus=2),this._loader=null}}},"5ef2":function(e,t,i){"use strict";function r(){return new Float32Array(4)}function n(e){const t=new Float32Array(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function a(e,t,i,r){const n=new Float32Array(4);return n[0]=e,n[1]=t,n[2]=i,n[3]=r,n}function s(e,t){return new Float32Array(e,t,4)}function o(){return r()}function c(){return a(1,1,1,1)}function l(){return a(1,0,0,0)}function d(){return a(0,1,0,0)}function h(){return a(0,0,1,0)}function u(){return a(0,0,0,1)}i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return r})),i.d(t,"c",(function(){return a}));const p=o(),f=c(),b=l(),m=d(),g=h(),v=u();Object.freeze({__proto__:null,create:r,clone:n,fromValues:a,createView:s,zeros:o,ones:c,unitX:l,unitY:d,unitZ:h,unitW:u,ZEROS:p,ONES:f,UNIT_X:b,UNIT_Y:m,UNIT_Z:g,UNIT_W:v})},6061:function(e,t,i){"use strict";i.d(t,"a",(function(){return p}));var r=i("b2b2"),n=i("f2e0"),a=i("d791"),s=i("afe1"),o=i("e431"),c=i("0fc4"),l=i("680b"),d=i("1038"),h=i("bea9"),u=i("b623");class p{constructor(e,t,i=null,r=null,a=Object(n["b"])(),o=null,l=null,d=!1){this.data=e,this.material=t,this.layerUid=i,this.graphicUid=r,this.id=a,this.boundingInfo=o,this.calculateShaderTransformation=l,this.castShadow=d,this.boundingSphere=Object(c["e"])(),this.instanceParameters={highlights:null,occludees:null,visible:!0},this._transformation=Object(s["d"])(),this._shaderTransformationDirty=!0}get transformation(){return this._transformation}updateTransformation(e){e(this._transformation),this._shaderTransformationDirty=!0,this.computeBoundingSphere(this._transformation,this.boundingSphere)}shaderTransformationChanged(){this._shaderTransformationDirty=!0}computeBoundingSphere(e,t,i=Object(l["i"])(e)){Object(r["k"])(this.boundingInfo)||(Object(o["t"])(t,this.boundingInfo.getCenter(),e),t[3]=this.boundingInfo.getBSRadius()*i)}get hasShaderTransformation(){return Object(r["l"])(this.calculateShaderTransformation)}get primitiveType(){return this.data.primitiveType}getShaderTransformation(){return Object(r["k"])(this.calculateShaderTransformation)?Object(r["v"])(this.transformation,s["a"]):(this._shaderTransformationDirty&&(this._shaderTransformation||(this._shaderTransformation=Object(s["d"])()),Object(a["d"])(this._shaderTransformation,this.calculateShaderTransformation(Object(r["v"])(this.transformation,s["a"]))),this._shaderTransformationDirty=!1),this._shaderTransformation)}computeAttachmentOrigin(e){if(this.material.computeAttachmentOrigin)return!!this.material.computeAttachmentOrigin(this,e)&&(Object(r["l"])(this._transformation)&&Object(o["t"])(e,e,this._transformation),!0);const t=this.indices.get("position"),i=this.vertexAttributes.get("position");return!!Object(d["c"])(i,t,e)&&(Object(r["l"])(this._transformation)&&Object(o["t"])(e,e,this._transformation),!0)}get indices(){return this.data.indices}get vertexAttributes(){return this.data.vertexAttributes}addHighlight(){const e=new h["a"](0),t=this.instanceParameters;return t.highlights=Object(u["a"])(t.highlights,e),e}removeHighlight(e){const t=this.instanceParameters;t.highlights=Object(u["e"])(t.highlights,e)}}},6316:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var r=i("7d11"),n=i("bc40"),a=i("3886");function s(e,t){const i=e.fragment;0===t.doubleSidedMode?i.code.add(a["a"]`vec3 _adjustDoublesided(vec3 normal) {
return normal;
}`):1===t.doubleSidedMode?(e.include(n["a"],t),i.uniforms.add("uTransform_ViewFromCameraLocal_T","vec3"),i.code.add(a["a"]`vec3 _adjustDoublesided(vec3 normal) {
vec3 viewDir = vPositionWorldCameraRelative + uTransform_ViewFromCameraLocal_T;
return dot(normal, viewDir) > 0.0 ? -normal : normal;
}`)):2===t.doubleSidedMode&&i.code.add(a["a"]`vec3 _adjustDoublesided(vec3 normal) {
return gl_FrontFacing ? normal : -normal;
}`),0===t.normalType||1===t.normalType?(e.include(r["a"],t),i.code.add(a["a"]`vec3 shadingNormalWorld() {
return _adjustDoublesided(normalize(vNormalWorld));
}
vec3 shadingNormal_view() {
vec3 normal = normalize(vNormalView);
return gl_FrontFacing ? normal : -normal;
}`)):3===t.normalType?(e.extensions.add("GL_OES_standard_derivatives"),e.include(n["a"],t),i.code.add(a["a"]`vec3 shadingNormalWorld() {
return normalize(cross(
dFdx(vPositionWorldCameraRelative),
dFdy(vPositionWorldCameraRelative)
));
}
vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view)));
}`)):2===t.normalType&&(1===t.viewingMode?(e.include(n["a"],t),i.code.add(a["a"]`vec3 shadingNormalWorld() {
return normalize(positionWorld());
}`)):2===t.viewingMode&&i.code.add(a["a"]`vec3 shadingNormalWorld() {
return vec3(0.0, 0.0, 1.0);
}`),e.extensions.add("GL_OES_standard_derivatives"),i.code.add(a["a"]`vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view))).xyz;
}`))}},6339:function(e,t,i){"use strict";i.d(t,"a",(function(){return zs}));var r=i("792b"),n=i("b2b2"),a=i("f4cc"),s=i("f0b9"),o=i("ecd7"),c=i("3349"),l=i("02f1"),d=i("e431"),h=i("0b2d"),u=i("1219"),p=i("8188"),f=i("4261"),b=i("9180"),m=i("1a54"),g=i("6655"),v=i("e9d6");const y=new o["a"](Array,e=>Object(f["C"])(e,f["c"]),null,10,5),O=Object(b["m"])();class _{constructor(e,t,i,r,a){this.graphic=e,this.graphics3DSymbol=t,this.graphics=i,this._labelGraphics=new Array,this._auxiliaryGraphics=new Array,this._visibilityFlags=x(2,4),this._featureExpressionFeature=null,this._optimizedGeometry={geometry:null,hasZ:!1,hasM:!1},this._extent=null,this.isElevationSource=!1,++t.referenced,this._featureExpressionFeature=a?Object(v["d"])(a,e,r):null;for(const s of i)Object(n["l"])(s)&&(this.isElevationSource=this.isElevationSource||s.isElevationSource)}get labelGraphics(){return this._labelGraphics}get extent(){return this._extent}initialize(e,t,i){this._layer=t,this._stage=e,this.forEachSymbolLayerGraphic(r=>{r.initialize(e,t,i),r.setVisibility(this.isVisible())})}destroy(){this.forEachSymbolLayerGraphic(e=>e.destroy()),this.graphics=null,this._auxiliaryGraphics=null,--this.graphics3DSymbol.referenced,this.graphics3DSymbol=null}get destroyed(){return null==this.graphics}clearLabelGraphics(){this.forEachLabelGraphic(e=>e.destroy()),this._labelGraphics.length=0}addLabelGraphic(e,t,i){this._labelGraphics.push(e),e.initialize(t,i),e.setVisibility(this.isVisible(1))}addAuxiliaryGraphic(e){this._auxiliaryGraphics.push(e),this._layer&&(e.initialize(this._stage,this._layer),e.setVisibility(this.isVisible()))}get isDraped(){let e=!1;return this.forEachSymbolLayerGraphic(t=>{"draped"===t.type&&(e=!0)}),e}isVisible(e=0,t){for(let i=0;i<=e;i++){const e=this._visibilityFlags[i];for(let i=0;i<e.length;++i)if(!1===e[i]&&i!==t)return!1}return!0}hasVisibilityFlag(e,t){return null!=this._visibilityFlags[t][e]}setVisibilityFlag(e,t,i){const r=this.isVisible(i);this._visibilityFlags[i][e]=t;const n=this.isVisible(i);if(r===n)return!1;if(1===i)this.forEachLabelGraphic(e=>e.setVisibility(n));else{this.forEachSymbolLayerGraphic(e=>e.setVisibility(n));const e=this.isVisible(1);this.forEachLabelGraphic(t=>t.setVisibility(e))}return!0}clearVisibilityFlag(e,t=0){return this.setVisibilityFlag(e,void 0,t)}computeExtent(e){if(!this._extent){const t=this.graphic.geometry;if(Object(n["k"])(t))return!1;this._extent=Object(b["m"])(),Object(m["d"])(t,this._extent);const i=t.spatialReference;if(!i.equals(e)&&!Object(p["n"])(this._extent,i,this._extent,e))return this._extent=null,!1}return!0}getAsOptimizedGeometry(e,t){return Object(n["l"])(this._optimizedGeometry.geometry)&&this._optimizedGeometry.hasZ===e&&this._optimizedGeometry.hasM===t||(this._optimizedGeometry.geometry=this._convertGraphicToOptimizedGeometry(this.graphic,e,t),this._optimizedGeometry.hasZ=e,this._optimizedGeometry.hasM=t),this._optimizedGeometry.geometry}_convertGraphicToOptimizedGeometry(e,t,i){let r=e.geometry;return"mesh"!==r.type&&"extent"!==r.type||(r=u["a"].fromExtent("mesh"===r.type?r.extent:r)),Object(g["d"])(r,t,i)}get usedMemory(){let e=Object(s["a"])(this.graphic.attributes);return this.forEachSymbolLayerGraphic(t=>{const i=t.graphics3DSymbolLayer.complexity;if(Object(n["k"])(i))return;const r="draped"===t.type?i.memory.draped:i.memory;e+=r.bytesPerFeature,r.bytesPerCoordinate&&(e+=Object(m["k"])(this.graphic.geometry)*r.bytesPerCoordinate)}),e}computeAttachmentOrigin(){const e={render:{origin:Object(h["f"])(),num:0},draped:{origin:Object(l["b"])(),num:0}};for(const t of this.graphics)Object(n["k"])(t)||t.computeAttachmentOrigin(e);return e.render.num&&Object(d["h"])(e.render.origin,e.render.origin,1/e.render.num),e.draped.num&&Object(c["g"])(e.draped.origin,e.draped.origin,1/e.draped.num),e}async getProjectedBoundingBox(e,t,i,a,s){return s||(s={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),s.boundingBox?Object(f["k"])(s.boundingBox):s.boundingBox=Object(f["k"])(),s.requiresDrapedElevation=!1,await Object(r["b"])(this.graphics,async r=>{if(Object(n["k"])(r))return;const o="draped"===r.type?t:e,c=y.acquire(),l=await r.getProjectedBoundingBox(o,i,s.screenSpaceObjects,a,c);isFinite(l[2])&&isFinite(l[5])||(s.requiresDrapedElevation=!0),l&&Object(f["m"])(s.boundingBox,c),y.release(c)}),Object(f["d"])(s.boundingBox)||Object(b["c"])(Object(f["G"])(s.boundingBox,O))?s:null}needsElevationUpdates(){for(const e of this.graphics)if(Object(n["l"])(e)&&("object3d"===e.type||"lod-instance"===e.type)&&e.needsElevationUpdates)return!0;for(const e of this._labelGraphics)if(e&&e.needsElevationUpdates)return!0;return!1}alignWithElevation(e,t,i){this.forEachRenderedGraphic(r=>{"object3d"!==r.type&&"lod-instance"!==r.type||r.alignWithElevation(e,t,this._featureExpressionFeature,i)})}addObjectStateSet(e,t){this.forEachSymbolLayerGraphic(i=>i.addObjectState(e,t))}removeObjectState(e){this.forEachSymbolLayerGraphic(t=>t.removeObjectState(e))}forEachGraphicList(e,t){e.forEach(e=>e&&t(e))}forEachSymbolLayerGraphic(e){this.forEachGraphicList(this.graphics,e),this.forEachGraphicList(this._auxiliaryGraphics,e)}forEachLabelGraphic(e){this.forEachGraphicList(this._labelGraphics,e)}forEachRenderedGraphic(e){this.forEachSymbolLayerGraphic(e),this.forEachLabelGraphic(e)}}function x(e,t){const i=new Array(e);for(let r=0;r<i.length;r++)i[r]=new Array(t);return i}var j=i("7b96"),w=i("e92d"),S=i("ce50"),T=i("9812"),C=i("1c92"),P=i("dae5"),A=i("d791"),M=i("afe1"),R=i("8190"),E=i("668b"),D=i("d1ac"),I=i("2e0f"),F=i("0eb9"),z=i("7f60"),L=i("ba58"),V=(i("e06a"),i("1666")),k=i("7585"),U=i("0278"),B=i("3af1");function N(e){const t=[["position",e.indices]],i=[["position",{size:3,data:e.attributeData.position,exclusive:!0}]];return Object(n["l"])(e.attributeData.color)&&(i.push(["color",{size:4,data:e.attributeData.color,exclusive:!0}]),t.push(["color",new Uint32Array(e.indices.length)])),Object(n["l"])(e.attributeData.uvMapSpace)&&(i.push(["uvMapSpace",{size:4,data:e.attributeData.uvMapSpace,exclusive:!0}]),t.push(["uvMapSpace",e.indices])),Object(n["l"])(e.attributeData.boundingRect)&&(i.push(["boundingRect",{size:9,data:e.attributeData.boundingRect,exclusive:!0}]),t.push(["boundingRect",e.indices])),Object(n["l"])(e.attributeData.mapPosition)&&(i.push(["mapPos",{size:3,data:e.attributeData.mapPosition,exclusive:!0}]),t.push(["mapPos",e.indices])),new U["a"](i,t)}function G(e){const t=[["position",e.indices],["uv0",e.indices]],i=[["position",{size:3,data:e.attributeData.position,exclusive:!0}],["uv0",{size:2,data:e.attributeData.uv0,exclusive:!0}]];return Object(n["l"])(e.attributeData.mapPosition)&&(i.push(["mapPos",{size:3,data:e.attributeData.mapPosition,exclusive:!0}]),t.push(["mapPos",e.indices])),new U["a"](i,t)}function q(e){switch(e.type){case"extent":if(e instanceof B["a"])return u["a"].fromExtent(e);break;case"polygon":return e}return null}function H(e,t,i,r){const n=Object(V["a"])(e.rings,e.hasZ,1),a=new Float64Array(n.position.length),s=Object(I["d"])(n.position,e.spatialReference,0,a,0,n.position,0,n.position.length/3,t,i,r),o=null!=s;return{position:n.position,mapPosition:a,polygons:Z(n.polygons,n.position,a),outlines:$(n.outlines,n.position,a),projectionSuccess:o,sampledElevation:s}}function W(e,t){const i=Object(V["a"])(e.rings,!1,1),r=Object(p["p"])(i.position,e.spatialReference,0,i.position,t,0,i.position.length/3);for(let n=2;n<i.position.length;n+=3)i.position[n]=k["a"];return{position:i.position,polygons:Z(i.polygons,i.position),outlines:$(i.outlines,i.position),projectionSuccess:r}}function $(e,t,i){const r=new Array;for(const{index:n,count:a}of e){if(a<=1)continue;const e=3*n,s=e+3*a;r.push({index:n,count:a,position:t.subarray(e,s),mapPosition:i?i.subarray(e,s):void 0})}return r}function Z(e,t,i){const r=new Array;for(const{index:n,count:a,holeIndices:s,pathLengths:o}of e){if(a<=1)continue;const e=3*n,c=e+3*a,l=s.map(e=>e-n);r.push({index:n,count:a,holeIndices:l,pathLengths:o,position:t.subarray(e,c),mapPosition:i?i.subarray(e,c):void 0})}return r}var Q=i("ec13"),X=i("6611"),Y=i("0cb9"),K=i("5a22"),J=i("dbad");const ee=["polygon","extent"];class te extends z["a"]{constructor(e,t,i,r){super(e,t,i,r),this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const e=Object(L["k"])(this._getSymbolSize());if(e)throw new S["a"]("graphics3dextrudesymbollayer:invalid-size",e)}const e=Object(n["j"])(this.symbolLayer,"material","color"),t=this._getCombinedOpacityAndColor(e),i=Object(h["g"])(t),r=t[3],a=r<1||this.needsDrivenTransparentPass,s={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,diffuse:i,ambient:i,opacity:r,transparent:a,cullFace:a?0:2,vertexColors:!0,slicePlaneEnabled:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!0};this._material=new J["a"](s),this._bottomMaterial=new J["a"]({...s,cullFace:2}),this._context.stage.add(this._material),this._context.stage.add(this._bottomMaterial)}destroy(){super.destroy(),this._material&&(this._context.stage.remove(this._material),this._context.stage.remove(this._bottomMaterial))}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry,ee,this.symbolLayer.type))return null;const i=this._getVertexOpacityAndColor(e.renderingInfo,255),r=this.setGraphicElevationContext(t,new F["a"]);return this._createAs3DShape(t,e.renderingInfo,i,r,t.uid)}layerOpacityChanged(e,t){const i=Object(n["j"])(this.symbolLayer,"material","color"),r=this._getCombinedOpacity(i),a=r<1||this.needsDrivenTransparentPass;this._material.setParameters({opacity:r,transparent:a}),this._bottomMaterial.setParameters({opacity:r,transparent:a});const s=this._getLayerOpacity();return e.forEach(e=>{const i=t(e);Object(n["l"])(i)&&i.layerOpacityChanged(s,this._context.isAsync)}),!0}layerElevationInfoChanged(e,t){return this.updateGraphics3DGraphicElevationInfo(e,t,I["i"])}slicePlaneEnabledChanged(e,t){return this._material.setParameters({slicePlaneEnabled:this._context.slicePlaneEnabled}),this._bottomMaterial.setParameters({slicePlaneEnabled:this._context.slicePlaneEnabled}),e.forEach(e=>{const i=t(e);Object(n["l"])(i)&&i.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){return this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._bottomMaterial.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}pixelRatioChanged(){return!0}_getExtrusionSize(e){let t;var i;return t=e.size&&this._drivenProperties.size?null!=(i=Object(D["a"])(e.size,2))?i:0:this._getSymbolSize(),t/=this._context.renderCoordsHelper.unitInMeters,t}applyRendererDiff(){return 1}_getSymbolSize(){var e;return null!=(e=this.symbolLayer.size)?e:1}_createAs3DShape(e,t,i,r,a){const s=q(e.geometry);if(Object(n["k"])(s))return null;const o=H(s,this._context.elevationProvider,this._context.renderCoordsHelper,r);if(this._logGeometryCreationWarnings(o,s.rings,"rings","ExtrudeSymbol3DLayer"),0===s.rings.length||!s.rings.some(e=>e.length>0))return null;const c=Object(L["a"])(s);if(Object(n["k"])(c))return null;const l=new Array,d=new Array,u=new Array,b=Object(f["h"])(),m=Object(M["d"])(),g=Object(h["f"])(),v=1===this._context.renderCoordsHelper.viewingMode;v||this._context.renderCoordsHelper.worldUpAtPosition(null,g),Object(p["d"])(s.spatialReference,[c.x,c.y,0],m,this._context.renderCoordsHelper.spatialReference);const y=Object(M["d"])();Object(A["c"])(y,m);const O=Object(P["b"])();Object(C["a"])(O,y);const{polygons:_,mapPosition:x,position:w}=o,S=w.length/3,D=new Float64Array(3*S*6),F=new Float64Array(3*S*6),z=new Float64Array(3*S*6),V=new Float64Array(1*S*6);let k=0;for(let n=0;n<_.length;++n){const e=_[n],r=e.count;if(this._context.clippingExtent&&(Object(f["k"])(b),Object(f["n"])(b,e.mapPosition),!Object(f["x"])(b,this._context.clippingExtent)))continue;const a=Object(T["a"])(e.mapPosition,e.holeIndices,3);if(0===a.length)continue;const s=3*r*2+a.length,o=new Uint32Array(s),c=new Uint32Array(a.length),h=6*r,p=3*D.BYTES_PER_ELEMENT,m=new R["v"](D.buffer,k*p,p,(k+h)*p),j=3*F.BYTES_PER_ELEMENT,S=new R["v"](F.buffer,k*j,j,(k+h)*j),C=new Float64Array(z.buffer,3*k*z.BYTES_PER_ELEMENT,3*h),P=new Float64Array(V.buffer,1*k*V.BYTES_PER_ELEMENT,1*h),A=this._getExtrusionSize(t);ie(w,x,a,e,m.typedBuffer,C,S.typedBuffer,P,0,o,c,A,g,v),Object(E["e"])(m,m,y),Object(E["a"])(S,S,O),k+=6*r;const I=this._createExtrudeGeometry(o,o.length-c.length,{positions:m.typedBuffer,elevation:C,normals:S.typedBuffer,heights:P},i);l.push(I),d.push(this._material),u.push(M["a"]);const L=this._createExtrudeGeometry(c,0,{positions:m.typedBuffer,elevation:C,normals:S.typedBuffer,heights:P},i);l.push(L),d.push(this._bottomMaterial),u.push(M["a"])}if(0===l.length)return null;const U=new K["a"]({geometries:l,materials:d,transformations:u,metadata:{layerUid:this._context.layer.uid,graphicUid:a,isElevationSource:!0}});U.transformation=m;const B=Object(Q["a"])(this.symbolLayer,{opacity:this._getLayerOpacity()}),N=Object(n["l"])(B)?{baseMaterial:this._material,edgeMaterials:[B],properties:{mergeGeometries:!0,slicePlaneEnabled:this._context.slicePlaneEnabled}}:null,G=new j["a"](this,U,l,null,null,fe,r,N);return G.alignedSampledElevation=o.sampledElevation,G.needsElevationUpdates=Object(I["i"])(r.mode),G}_createExtrudeGeometry(e,t,i,r){const n=new Uint32Array(e.length),a=[["position",{size:3,data:i.positions,exclusive:!0}],["normal",{size:3,data:i.normals,exclusive:!0}],["color",{size:4,data:r,exclusive:!0}],["size",{size:1,data:i.heights,exclusive:!0}]],s=[["position",e],["normal",e],["color",n]];return i.elevation&&(a.push(["mapPos",{size:3,data:i.elevation}]),s.push(["mapPos",e])),new U["a"](a,s,0,t)}}function ie(e,t,i,r,n,a,s,o,c,l,d,h,u,p){const f=i.length/3;let b=0,m=2*r.count;re(e,t,r.index,r.count,i,0,f,n,a,s,o,c,l,d,m,h,u,p),c+=2*r.count,m=0,se(n,a,o,s,b,r.pathLengths[0],r.count,c,l,m,h),c+=4*r.pathLengths[0],m+=2*r.pathLengths[0],b+=r.pathLengths[0];for(let g=1;g<r.pathLengths.length;++g)se(n,a,o,s,b,r.pathLengths[g],r.count,c,l,m,h),c+=4*r.pathLengths[g],m+=2*r.pathLengths[g],b+=r.pathLengths[g]}function re(e,t,i,r,n,a,s,o,c,l,h,u,p,f,b,m,g,v){Object(d["n"])(me,g);const y=m>0?1:-1;let O=3*i,_=u,x=3*_,j=u+r,w=3*j;for(let C=0;C<r;++C)v&&(me[0]=e[O+0],me[1]=e[O+1],me[2]=e[O+2],Object(d["u"])(me,me)),o[x+0]=e[O+0],o[x+1]=e[O+1],o[x+2]=e[O+2],c[x+0]=t[O+0],c[x+1]=t[O+1],c[x+2]=t[O+2],l[x+0]=-y*me[0],l[x+1]=-y*me[1],l[x+2]=-y*me[2],h[_]=0,o[w+0]=e[O+0]+m*me[0],o[w+1]=e[O+1]+m*me[1],o[w+2]=e[O+2]+m*me[2],c[w+0]=t[O+0],c[w+1]=t[O+1],c[w+2]=t[O+2],l[w+0]=y*me[0],l[w+1]=y*me[1],l[w+2]=y*me[2],h[j]=m,x+=3,w+=3,O+=3,_+=1,j+=1;O=3*a,x=0,w=3*b;const S=m<0?ye:ve,T=m<0?ve:ye;for(let d=0;d<s;++d)f[x+0]=n[O+S[0]],f[x+1]=n[O+S[1]],f[x+2]=n[O+S[2]],p[w+0]=n[O+T[0]]+r,p[w+1]=n[O+T[1]]+r,p[w+2]=n[O+T[2]]+r,x+=3,w+=3,O+=3}function ne(e,t,i,r,n,a,s){r[a]=r[s],s*=3,e[0+(a*=3)]=e[s+0],e[a+1]=e[s+1],e[a+2]=e[s+2],t[a+0]=t[s+0],t[a+1]=t[s+1],t[a+2]=t[s+2],i[a+0]=n[0],i[a+1]=n[1],i[a+2]=n[2]}const ae=Object(h["f"])();function se(e,t,i,r,n,a,s,o,c,l,d){let h=n,u=n+1,p=n+s,f=n+s+1,b=o,m=o+1,g=o+2*a,v=o+2*a+1;d<0&&(h=n+s+1,f=n),l*=3;for(let y=0;y<a;++y)y===a-1&&(d>0?(u=n,f=n+s):(u=n,h=n+s)),ue(e,h,u,p,ae),ne(e,t,r,i,ae,b,h),ne(e,t,r,i,ae,m,u),ne(e,t,r,i,ae,g,p),ne(e,t,r,i,ae,v,f),c[l++]=b,c[l++]=g,c[l++]=v,c[l++]=b,c[l++]=v,c[l++]=m,h++,u++,p++,f++,b+=2,m+=2,g+=2,v+=2}const oe=Object(h["f"])(),ce=Object(h["f"])(),le=Object(h["f"])(),de=Object(h["f"])(),he=Object(h["f"])();function ue(e,t,i,r,n){t*=3,i*=3,r*=3,Object(d["z"])(oe,e[t++],e[t++],e[t++]),Object(d["z"])(ce,e[i++],e[i++],e[i++]),Object(d["z"])(le,e[r++],e[r++],e[r++]),Object(d["m"])(de,ce,oe),Object(d["m"])(he,le,oe),Object(d["j"])(n,he,de),Object(d["u"])(n,n)}const pe=Object(h["f"])();function fe(e,t,i,r){const n=e.stageObject,a=n.geometryRecords,s=a.length,o="absolute-height"!==t.mode;let c=0;const l=n.transformation,h=Object(A["c"])(Object(M["d"])(),l);for(let u=0;u<s;u+=2){const e=a[u].geometry,s=e.getMutableAttribute("position").data,p=e.vertexAttributes.get("size").data,f=e.vertexAttributes.get("mapPos").data,b=new Y["a"](f),m=s.length/3;let g=0,v=!1,y=0;const O=i.spatialReference;for(let n=0;n<m;n++){pe[0]=s[g],pe[1]=s[g+1],pe[2]=s[g+2],Object(I["g"])(b,i,t,r,ge),o&&(y+=ge.sampledElevation),X["a"].TESTS_DISABLE_OPTIMIZATIONS?(Object(d["z"])(be,b.array[b.offset+0],b.array[b.offset+1],ge.z+p[g/3]),r.toRenderCoords(be,O,be),Object(d["t"])(be,be,h)):(Object(d["z"])(be,s[g+0],s[g+1],s[g+2]),Object(d["t"])(be,be,l),r.setAltitude(be,ge.z+p[g/3]),Object(d["t"])(be,be,h)),s[g]=be[0],s[g+1]=be[1],s[g+2]=be[2];const e=Oe/r.unitInMeters;(Math.abs(pe[0]-s[g])>=e||Math.abs(pe[1]-s[g+1])>=e||Math.abs(pe[2]-s[g+2])>=e)&&(v=!0),b.offset+=3,g+=3}v&&(e.invalidateBoundingInfo(),n.geometryVertexAttrsUpdated(a[u]),a[u+1].geometry.invalidateBoundingInfo(),n.geometryVertexAttrsUpdated(a[u+1])),c+=y/m}return c/s}const be=Object(h["f"])(),me=Object(h["f"])(),ge=new I["a"],ve=[0,2,1],ye=[0,1,2],Oe=.01;var _e=i("9ef0"),xe=(i("1fd7"),i("c120")),je=i("a915"),we=i("e041"),Se=i("7577"),Te=i("0fc4"),Ce=i("82fa"),Pe=i("3dc2"),Ae=i("ac8e"),Me=i("89cb"),Re=i("ed70"),Ee=i("74df");class De{constructor(e,t,i){this.graphics3DSymbolLayer=e,this.renderGeometries=t,this.boundingBox=i,this.type="draped",this.stage=null,this._visible=!1,this._addedToStage=!1,this._layerView=null,this.isElevationSource=!1}initialize(e,t,i){this.stage=e,this._layerView=i,this._overlayRenderer=this._layerView.view.basemapTerrain.overlayManager.renderer}setVisibility(e){if(null!=this.stage&&this._visible!==e){if(this._visible=e,e&&!this._addedToStage)return this._addedToStage=!0,void this._overlayRenderer.addGeometries(this.renderGeometries,this._layerView,1);if(e||this._addedToStage){for(const e of this.renderGeometries)e.instanceParameters.visible=this._visible;this._overlayRenderer.updateGeometries(this.renderGeometries,this._layerView,1)}}}destroy(){this.stage&&this._addedToStage&&this._overlayRenderer.removeGeometries(this.renderGeometries,this._layerView,4),this._addedToStage=!1,this._visible=!1,this.stage=null}getCenterObjectSpace(e=Object(h["f"])()){return Object(d["z"])(e,0,0,0)}getBoundingBoxObjectSpace(e=Object(f["h"])()){return Object(f["k"])(e)}addObjectState(e,t){0===e&&(this.renderGeometries.forEach(e=>{const i=e.addHighlight();t.addRenderGeometry(e,i,this)}),this._addedToStage&&this._overlayRenderer.updateHighlights(this.renderGeometries,this._layerView))}removeObjectState(e){this.renderGeometries.forEach(t=>{e.removeRenderGeometry(t)})}removeRenderGeometryObjectState(e,t){e.removeHighlight(t),this._addedToStage&&this._overlayRenderer.updateHighlights(this.renderGeometries,this._layerView)}computeAttachmentOrigin(e){for(const t of this.renderGeometries)t.computeAttachmentOrigin(ze)&&(e.draped.origin[0]+=ze[0],e.draped.origin[1]+=ze[1],e.draped.num++)}async getProjectedBoundingBox(e,t,i,r,a){Object(f["k"])(a);for(let n=0;n<this.renderGeometries.length;n++){const t=this.renderGeometries[n];this._getRenderGeometryProjectedBoundingRect(t,e,Ie,i),Object(f["q"])(a,Ie)}if(t){let e;Object(f["e"])(a,ze);const i=Object(L["d"])(a,t);try{e=await t.service.queryElevation(ze[0],ze[1],r,i,"ground")}catch(s){}Object(n["l"])(e)&&(a[2]=Math.min(a[2],e),a[5]=Math.max(a[5],e))}return a}_getRenderGeometryProjectedBoundingRect(e,t,i,r){if(this.boundingBox)Object(f["C"])(Fe,this.boundingBox);else{const t=e.boundingSphere,i=t[3];Fe[0]=t[0]-i,Fe[1]=t[1]-i,Fe[2]=t[2]-i,Fe[3]=t[0]+i,Fe[4]=t[1]+i,Fe[5]=t[2]+i}return t(Fe,0,2),this.calculateRelativeScreenBounds&&r.push({location:Object(f["e"])(Fe),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()}),Object(f["G"])(Fe,i)}}const Ie=Object(b["m"])(),Fe=Object(f["h"])(),ze=Object(h["f"])();var Le,Ve=i("5241"),ke=i("a6c9"),Ue=i("38a4"),Be=i("9b40");function Ne(e){return null!=e}function Ge(e){return"number"==typeof e}function qe(e){return"string"==typeof e}function He(e){return null==e||qe(e)}function We(e,t){e&&e.push(t)}function $e(e,t,i,r=Object(M["d"])()){const n=e||0,a=t||0,s=i||0;return 0!==n&&Object(A["s"])(r,r,-n/180*Math.PI),0!==a&&Object(A["e"])(r,r,a/180*Math.PI),0!==s&&Object(A["k"])(r,r,s/180*Math.PI),r}function Ze(e,t,i,r,n){const a=e.minSize,s=e.maxSize;if(e.expression)return We(n,"Could not convert size info: expression not supported"),!1;if(e.useSymbolValue){const e=r.symbolSize[i];return t.minSize[i]=e,t.maxSize[i]=e,t.offset[i]=t.minSize[i],t.factor[i]=0,t.type[i]=1,!0}if(Ne(e.field))return Ne(e.stops)?2===e.stops.length&&Ge(e.stops[0].size)&&Ge(e.stops[1].size)?(Qe(e.stops[0].size,e.stops[1].size,e.stops[0].value,e.stops[1].value,t,i),t.type[i]=1,!0):(We(n,"Could not convert size info: stops only supported with 2 elements"),!1):Ge(a)&&Ge(s)&&Ne(e.minDataValue)&&Ne(e.maxDataValue)?(Qe(a,s,e.minDataValue,e.maxDataValue,t,i),t.type[i]=1,!0):null!=Be["a"][e.valueUnit]?(t.minSize[i]=-1/0,t.maxSize[i]=1/0,t.offset[i]=0,t.factor[i]=1/Be["a"][e.valueUnit],t.type[i]=1,!0):"unknown"===e.valueUnit?(We(n,"Could not convert size info: proportional size not supported"),!1):(We(n,"Could not convert size info: scale-dependent size not supported"),!1);if(!Ne(e.field)){if(e.stops&&e.stops[0]&&Ge(e.stops[0].size))return t.minSize[i]=e.stops[0].size,t.maxSize[i]=e.stops[0].size,t.offset[i]=t.minSize[i],t.factor[i]=0,t.type[i]=1,!0;if(Ge(a))return t.minSize[i]=a,t.maxSize[i]=a,t.offset[i]=a,t.factor[i]=0,t.type[i]=1,!0}return We(n,"Could not convert size info: unsupported variant of sizeInfo"),!1}function Qe(e,t,i,r,n,a){const s=Math.abs(r-i)>0?(t-e)/(r-i):0;n.minSize[a]=s>0?e:t,n.maxSize[a]=s>0?t:e,n.offset[a]=e-i*s,n.factor[a]=s}function Xe(e,t,i,r){if(e.normalizationField||e.valueRepresentation)return We(r,"Could not convert size info: unsupported property"),null;if(!He(e.field))return We(r,"Could not convert size info: field is not a string"),null;if(t.size){if(e.field)if(t.size.field){if(e.field!==t.size.field)return We(r,"Could not convert size info: multiple fields in use"),null}else t.size.field=e.field}else t.size={field:e.field,minSize:[0,0,0],maxSize:[0,0,0],offset:[0,0,0],factor:[0,0,0],type:[0,0,0]};let n;switch(e.axis){case"width":return n=Ze(e,t.size,0,i,r),n?t:null;case"height":return n=Ze(e,t.size,2,i,r),n?t:null;case"depth":return n=Ze(e,t.size,1,i,r),n?t:null;case"width-and-depth":return n=Ze(e,t.size,0,i,r),n&&Ze(e,t.size,1,i,r),n?t:null;case null:case void 0:case"all":return n=Ze(e,t.size,0,i,r),n=n&&Ze(e,t.size,1,i,r),n=n&&Ze(e,t.size,2,i,r),n?t:null;default:return We(r,`Could not convert size info: unknown axis "${e.axis}""`),null}}function Ye(e,t,i){for(let n=0;n<3;++n){let i=t.unitInMeters;1===e.type[n]&&(i*=t.modelSize[n],e.type[n]=2),e.minSize[n]=e.minSize[n]/i,e.maxSize[n]=e.maxSize[n]/i,e.offset[n]=e.offset[n]/i,e.factor[n]=e.factor[n]/i}let r;if(0!==e.type[0])r=0;else if(0!==e.type[1])r=1;else{if(0===e.type[2])return We(i,"No size axis contains a valid size or scale"),!1;r=2}for(let n=0;n<3;++n)0===e.type[n]&&(e.minSize[n]=e.minSize[r],e.maxSize[n]=e.maxSize[r],e.offset[n]=e.offset[r],e.factor[n]=e.factor[r],e.type[n]=e.type[r]);return!0}function Ke(e,t,i){e[4*t+0]=i.r/255,e[4*t+1]=i.g/255,e[4*t+2]=i.b/255,e[4*t+3]=i.a}function Je(e,t,i){if(e.normalizationField)return We(i,"Could not convert color info: unsupported property"),null;if(qe(e.field)){if(!e.stops)return We(i,"Could not convert color info: missing stops or colors"),null;{if(e.stops.length>8)return We(i,"Could not convert color info: too many color stops"),null;t.color={field:e.field,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};const r=e.stops;for(let e=0;e<8;++e){const i=r[Math.min(e,r.length-1)];t.color.values[e]=i.value,Ke(t.color.colors,e,i.color)}}}else{if(!(e.stops&&e.stops.length>=0))return We(i,"Could not convert color info: no field and no colors/stops"),null;{const i=e.stops&&e.stops.length>=0&&e.stops[0].color;t.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};for(let e=0;e<8;e++)t.color.values[e]=1/0,Ke(t.color.colors,e,i)}}return t}function et(e,t,i){if(e.normalizationField)return We(i,"Could not convert opacity info: unsupported property"),null;if(qe(e.field)){if(!e.stops)return We(i,"Could not convert opacity info: missing stops or opacities"),null;{if(e.stops.length>8)return We(i,"Could not convert opacity info: too many opacity stops"),null;t.opacity={field:e.field,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};const r=e.stops;for(let e=0;e<8;++e){const i=r[Math.min(e,r.length-1)];t.opacity.values[e]=i.value,t.opacity.opacityValues[e]=i.opacity}}}else{if(!(e.stops&&e.stops.length>=0))return We(i,"Could not convert opacity info: no field and no opacities/stops"),null;{const i=e.stops&&e.stops.length>=0&&e.stops[0].opacity;t.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};for(let e=0;e<8;e++)t.opacity.values[e]=1/0,t.opacity.opacityValues[e]=i}}return t}function tt(e,t,i){const r=2===i&&"arithmetic"===e.rotationType;t.offset[i]=r?90:0,t.factor[i]=r?-1:1,t.type[i]=1}function it(e,t,i){if(!qe(e.field))return We(i,"Could not convert rotation info: field is not a string"),null;if(t.rotation){if(e.field)if(t.rotation.field){if(e.field!==t.rotation.field)return We(i,"Could not convert rotation info: multiple fields in use"),null}else t.rotation.field=e.field}else t.rotation={field:e.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(e.axis){case"tilt":return tt(e,t.rotation,0),t;case"roll":return tt(e,t.rotation,1),t;case null:case void 0:case"heading":return tt(e,t.rotation,2),t;default:return We(i,`Could not convert rotation info: unknown axis "${e.axis}""`),null}}function rt(e,t,i){if(!e)return null;const r=!t.supportedTypes||!!t.supportedTypes.size,n=!t.supportedTypes||!!t.supportedTypes.color,a=!t.supportedTypes||!!t.supportedTypes.rotation,s=!!t.supportedTypes&&!!t.supportedTypes.opacity,o=e.reduce((e,o)=>{if(!e)return e;if(o.valueExpression)return We(i,"Could not convert visual variables: arcade expressions not supported"),null;switch(o.type){case"size":return r?Xe(o,e,t,i):e;case"color":return n?Je(o,e,i):e;case"opacity":return s?et(o,e,i):null;case"rotation":return a?it(o,e,i):e;default:return null}},{size:null,color:null,opacity:null,rotation:null});return!(e.length>0&&o)||o.size||o.color||o.opacity||o.rotation?o&&o.size&&!Ye(o.size,t,i)?null:o:null}function nt(e){return e&&null!=e.size}function at(e,t){if(!e)return{enabled:!1};if(X["a"].TESTS_DISABLE_FAST_UPDATES)return{enabled:!1};const i=rt(e.visualVariables,t);return i?{enabled:!0,visualVariables:i,materialParameters:ct(i,t),requiresShaderTransformation:nt(i)}:{enabled:!1}}function st(e,t,i){if(!t||!e.enabled)return!1;const r=e.visualVariables,n=rt(t.visualVariables,i);return!!n&&!!(ot(r.size,n.size,"size")&&ot(r.color,n.color,"color")&&ot(r.rotation,n.rotation,"rotation")&&ot(r.opacity,n.opacity,"opacity"))&&(e.visualVariables=n,e.materialParameters=ct(n,i),e.requiresShaderTransformation=nt(n),!0)}function ot(e,t,i){if(!!e!=!!t)return!1;if(e&&e.field!==t.field)return!1;if(e&&"rotation"===i){const i=e,r=t;for(let e=0;e<3;e++)if(i.type[e]!==r.type[e]||i.offset[e]!==r.offset[e]||i.factor[e]!==r.factor[e])return!1}return!0}function ct(e,t){const i={vvSizeEnabled:!1,vvSizeMinSize:null,vvSizeMaxSize:null,vvSizeOffset:null,vvSizeFactor:null,vvSizeValue:null,vvColorEnabled:!1,vvColorValues:null,vvColorColors:null,vvOpacityEnabled:!1,vvOpacityValues:null,vvOpacityOpacities:null,vvSymbolAnchor:null,vvSymbolRotationMatrix:null},r=nt(e);return e&&e.size?(i.vvSizeEnabled=!0,i.vvSizeMinSize=e.size.minSize,i.vvSizeMaxSize=e.size.maxSize,i.vvSizeOffset=e.size.offset,i.vvSizeFactor=e.size.factor):e&&r&&(i.vvSizeValue=t.transformation.scale),e&&r&&(i.vvSymbolAnchor=t.transformation.anchor,i.vvSymbolRotationMatrix=Object(P["b"])(),Object(A["j"])(lt),$e(t.transformation.rotation[2],t.transformation.rotation[0],t.transformation.rotation[1],lt),Object(C["f"])(i.vvSymbolRotationMatrix,lt)),e&&e.color&&(i.vvColorEnabled=!0,i.vvColorValues=e.color.values,i.vvColorColors=e.color.colors),e&&e.opacity&&(i.vvOpacityEnabled=!0,i.vvOpacityValues=e.opacity.values,i.vvOpacityOpacities=e.opacity.opacityValues),i}!function(e){const t=Object(M["d"])(),i=Object(h["f"])();function r(e,r,n){if(!e.vvSizeEnabled)return n;Object(A["d"])(t,n);const a=e.vvSymbolRotationMatrix;Object(A["t"])(lt,a[0],a[1],a[2],0,a[3],a[4],a[5],0,a[6],a[7],a[8],0,0,0,0,1),Object(A["n"])(t,t,lt);for(let t=0;t<3;++t){const n=e.vvSizeOffset[t]+r[0]*e.vvSizeFactor[t];i[t]=Object(Ue["f"])(n,e.vvSizeMinSize[t],e.vvSizeMaxSize[t])}return Object(A["g"])(t,t,i),Object(A["b"])(t,t,e.vvSymbolAnchor),t}function n(e,t,i){if(!t.vvSizeEnabled)return Object(d["z"])(e,1,1,1);for(let r=0;r<3;++r){const n=t.vvSizeOffset[r]+i[0]*t.vvSizeFactor[r];e[r]=Object(Ue["f"])(n,t.vvSizeMinSize[r],t.vvSizeMaxSize[r])}return e}e.evaluateModelTransform=r,e.evaluateModelTransformScale=n}(Le||(Le={}));const lt=Object(M["d"])(),dt=Le.evaluateModelTransform,ht=Le.evaluateModelTransformScale;var ut=i("caf7"),pt=i("6061"),ft=i("1e2c"),bt=i("2df1"),mt=i("4cac");const gt=Object(M["d"])(),vt=Object(h["h"])(0,0,1),yt=16,Ot=1.5,_t=128,xt=.5,jt=[xt/2,xt/2,1-xt/2,1-xt/2],wt=[_t*xt,_t*xt];class St extends z["a"]{constructor(e,t,i,r){super(e,t,i,r),this._cimLayers=null,this._cimSymbolMaterials=new Map,this._cimSymbolTextures=new Map,this._cimMaterialParametersInfo=null,this._cimRequiredFields=null,this._cimScaleFactorOrFunction=null,this._size=null,this._symbolTextureRatio=1,this._outlineSize=0,this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0}}getCachedSize(){return{size:this._getIconSize()}}async doLoad(e){this._validateOrThrow();const t=this._prepareMaterialParameters(),i=this._getPrimitive();if(Object(n["l"])(i))this._prepareResourcesPrimitive(t,i);else{const i=Object(Ae["g"])(this.symbol,this.symbolLayer),r=Object(we["i"])(i);r&&"application/json"===r.mediaType?await this._prepareResourcesCIM(t,JSON.parse(r.data),e):await this._prepareResourcesHref(t,i,e)}}_validateOrThrow(){if(this._drivenProperties.size)return;const e=Object(L["k"])(this._getIconSize());if(e)throw new S["a"]("graphics3diconsymbollayer:invalid-size",e)}_getIconSize(){const e=this.symbolLayer,t=Math.round(null!=e.size?Object(je["h"])(e.size):yt);return this._drivenProperties.size?Math.max(t,64):t}_generateTextureCIM(e){const t=this._getGraphicHash(e);let i=""===t?null:this._cimSymbolTextures.get(t);if(!i){const r={scaleFactor:this._cimScaleFactorOrFunction},n=this._context.sharedResources.cimSymbolRasterizer.rasterizeCIMSymbol(this._cimLayers,e,"esriGeometryPoint",r,null,null);this._cimMaterialParametersInfo.anchorPos=this._getAnchorPos("relative",n.anchorPosition);const a={width:n.imageData.width,height:n.imageData.height,powerOfTwoResizeMode:2};i=new ft["a"](n.imageData,a),this._cimSymbolTextures.set(t,i),this._context.stage.add(i)}return i}_computeSize(e,t){const i=e.width/e.height;return i>1?[t,Math.round(t/i)]:[Math.round(t*i),t]}_prepareMaterialParameters(){const e={anchorPos:this._getAnchorPos(this.symbolLayer.anchor,this.symbolLayer.anchorPosition)},t=this.symbol;if(Tt(t)){const{screenLength:i,minWorldLength:r,maxWorldLength:n}=t.verticalOffset;e.verticalOffset={screenLength:Object(je["h"])(i),minWorldLength:r||0,maxWorldLength:null!=n?n:1/0}}return this._context.screenSizePerspectiveEnabled&&(e.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),e.occlusionTest=!0,e.slicePlaneEnabled=this._context.slicePlaneEnabled,e}_prepareResourcesPrimitive(e,t){const i=this._getOutlineSize();if(Ct(t)&&0===i)throw new Error("Nothing to render");this._outlineSize=i,e.color=this._getFillColor(),e.outlineColor=this._getOutlineColor(),e.outlineSize=this._outlineSize;const r=this._context.sharedResources.textures.fromData(t,()=>Pt(t));this._texture=r.texture,this._releaseTexture=r,e.textureIsSignedDistanceField=!0,e.distanceFieldBoundingBox=jt,e.textureId=this._texture.id;const n=this._getIconSize();this._size=[n,n],this._symbolTextureRatio=1/xt,this._createMaterialAndAddToStage(e,this._context.stage)}async _prepareResourcesHref(e,t,i){if(!Object(xe["a"])("esri-canvas-svg-support")&&Object(we["x"])(t))throw new S["a"]("graphics3diconsymbollayer:unsupported-image-format","IconSymbol3DLayer failed to load (SVG symbols are not supported in IE11)");this._outlineSize=this._getOutlineSize(),e.color=this._getFillColor(),e.outlineColor=this._getOutlineColor(),e.outlineSize=this._outlineSize,e.textureIsSignedDistanceField=!1;const n=this._getIconSize(),s=n*this._context.layerView.view.pixelRatio,o=await Object(r["d"])(this._context.sharedResources.textures.fromUrl(t,s,{signal:i}));if(!1===o.ok)throw Object(a["v"])(o.error),new S["a"]("graphics3diconsymbollayer:request-failed",`Failed to load (Request for icon resource failed: ${t})`);this._releaseTexture=o.value;const c=o.value.texture,l=c.params;this._size=this._computeSize(l,n),e.textureId=c.id,this._createMaterialAndAddToStage(e,this._context.stage)}async _prepareResourcesCIM(e,t,r){const n=new mt["a"]({data:t});if(!this._context.sharedResources.cimSymbolRasterizer){const e=(await Promise.all([i.e("chunk-205026ce"),i.e("chunk-4f5f1116")]).then(i.bind(null,"6b49"))).CIMSymbolRasterizer;Object(a["w"])(r),this._context.sharedResources.cimSymbolRasterizer||(this._context.sharedResources.cimSymbolRasterizer=new e(this._context.renderCoordsHelper.spatialReference,!0))}const s=this._context.layer.fields?this._context.layer.fields.map(e=>e.toJSON()):null;let o,c;if(this._cimLayers=await this._context.sharedResources.cimSymbolRasterizer.analyzeCIMSymbol(n,s,this._context.renderer&&"dictionary"===this._context.renderer.type?this._context.renderer.fieldMap:null,"esriGeometryPoint",{signal:r}),this._context.renderer&&"dictionary"===this._context.renderer.type&&this._context.renderer.scaleExpression){const e=this._context.renderer;if(isNaN(e.scaleExpression)){const t=e.scaleExpression,i=await Object(Ce["d"])(t,this._context.layer.spatialReference,s);c=(e,t,r)=>{const n=Object(Me["a"])(i,e,{$view:r},"esriGeometryPoint",t);return null!==n?n:1}}else o=Number(e.scaleExpression)}this._cimScaleFactorOrFunction=o||c||1;const l=this._context.renderer?await this._context.renderer.getRequiredFields(this._context.layer.fieldsIndex):[];Object(a["w"])(r);const d=this._context.layer.fieldsIndex;this._cimRequiredFields=l.map(e=>d.get(e).name),this._cimMaterialParametersInfo=e,this._cimMaterialParametersInfo.color=this._getFillColor(),this._cimMaterialParametersInfo.outlineColor=[0,0,0,0],this._cimMaterialParametersInfo.outlineSize=0,this._cimMaterialParametersInfo.textureIsSignedDistanceField=!1}_getPrimitive(){return this.symbolLayer.resource&&this.symbolLayer.resource.href?null:this.symbolLayer.resource&&this.symbolLayer.resource.primitive||Pe["b"]}_getOutlineSize(){let e=0;const t=this.symbolLayer;return Object(n["l"])(t.outline)&&null!=t.outline.size?Math.max(Object(je["h"])(t.outline.size),0):(e=Ct(this._getPrimitive())?Ot:0,Math.max(e,0))}_getOutlineColor(){const e=this._getLayerOpacity(),t=this.symbolLayer,i=Object(n["j"])(t,"outline","color");if(Object(n["l"])(i)){const t=_e["a"].toUnitRGB(i),r=i.a*e;return[t[0],t[1],t[2],r]}return[0,0,0,0]}_getFillColor(){if(Ct(this._getPrimitive()))return Re["b"];const e=Object(n["k"])(this._getPrimitive()),t=Object(n["j"])(this.symbolLayer,"material","color");return this._getCombinedOpacityAndColor(t,{hasIntrinsicColor:e})}_getAnchorPos(e,t){return"relative"===e?Object(l["f"])((t.x||0)+.5,.5-(t.y||0)):e in L["h"]?L["h"][e]:L["h"].center}_createMaterialAndAddToStage(e,t){if(this._cimLayers?this._fastUpdates={enabled:!1}:this._fastUpdates=at(this._context.renderer,this._fastVisualVariableConvertOptions()),this._fastUpdates.enabled&&Object.assign(e,this._fastUpdates.materialParameters),this._cimLayers){let i=this._cimSymbolMaterials.get(e.textureId);return i||(i=new bt["a"](e),this._cimSymbolMaterials.set(e.textureId,i),t.add(i)),i}return this._material=new bt["a"](e),t.add(this._material),this._material}_setDrapingDependentMaterialParameters(){this.draped&&(this._forEachMaterial(e=>{e.setParameters({verticalOffset:null,screenSizePerspective:null,occlusionTest:!1,slicePlaneEnabled:!1,shaderPolygonOffset:0,isDraped:this.draped})}),this.layerOpacityChanged())}destroy(){super.destroy(),this._forEachMaterial(e=>this._context.stage.remove(e)),this._material=null,this._cimSymbolMaterials.clear(),this._cimSymbolTextures.forEach(e=>this._context.stage.remove(e)),this._cimSymbolTextures.clear(),this._releaseTexture=Object(n["s"])(this._releaseTexture)}_getScaleFactor(e,t){if(this._drivenProperties.size&&e.size){for(let t=0;t<3;t++){const i=e.size[t];i&&"symbol-value"!==i&&"proportional"!==i&&(e.size[t]=Object(je["h"])(i))}if("symbol-value"===e.size[0])return 1;if(isFinite(+e.size[0]))return+e.size[0]/t;if(isFinite(+e.size[2]))return+e.size[2]/t}return 1}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry))return null;let i,r;if(this._cimLayers){if(!this._cimLayers.length)return null;const e=this._generateTextureCIM(t),n={textureId:e.id,...this._cimMaterialParametersInfo};r=this._createMaterialAndAddToStage(n,this._context.stage),i=[e.params.width,e.params.height]}else i=this._size,r=Object(n["u"])(this._material);const a=Object(Ve["d"])(t.geometry);if(Object(n["k"])(a))return this.logger.warn("unsupported geometry type for icon symbol: "+t.geometry.type),null;const s=e.renderingInfo,o=this._getVertexOpacityAndColor(s);let c=1;if(!this._fastUpdates.enabled||!this._fastUpdates.visualVariables.size){const e=i[0]>i[1]?i[0]:i[1];c=this._getScaleFactor(s,e)}c*=this._symbolTextureRatio;const l=[i[0]*c,i[1]*c],d=this.setGraphicElevationContext(t,new F["a"]);return this.ensureDrapedStatus("on-the-ground"===d.mode)&&this._setDrapingDependentMaterialParameters(),this.draped?this._createAsOverlay(t,a,r,o,l,e.layer.uid):this._createAs3DShape(t,a,r,o,l,d,t.uid)}layerOpacityChanged(){const e=this._getFillColor(),t=this._getOutlineColor();return this._forEachMaterial(i=>{i.setParameters({color:e}),i.setParameters({outlineColor:t})}),!0}layerElevationInfoChanged(e,t,i){const r=this._elevationContext.mode,n=Object(I["e"])(St.elevationModeChangeTypes,i,r);if(n!==I["b"].UPDATE)return n;const a=Object(I["h"])(r)||"absolute-height"===r;return this.updateGraphics3DGraphicElevationInfo(e,t,()=>a)}slicePlaneEnabledChanged(){return this.draped||this._forEachMaterial(e=>{e.setParameters({slicePlaneEnabled:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!!this._getPrimitive()}applyRendererDiff(e,t){for(const i in e.diff){if("visualVariables"!==i)return 0;if(!st(this._fastUpdates,t,this._fastVisualVariableConvertOptions()))return 0;Object(n["l"])(this._material)&&this._material.setParameters(this._fastUpdates.materialParameters)}return 2}_defaultElevationInfoNoZ(){return At}_createAs3DShape(e,t,i,r,n,a,s){const o=this.getFastUpdateAttrValues(e),c=o?e=>dt(this._fastUpdates.materialParameters,o,e):null,l=[ut["a"].createPointGeometry(vt,null,r,n,Mt,null,o)],d=Object(Ve["a"])(this._context,t,l,[i],a,this._context.layer.uid,s,c);if(null===d)return null;const h=new j["a"](this,d.object,l,null,null,Ee["b"],a);return h.alignedSampledElevation=d.sampledElevation,h.needsElevationUpdates=Object(I["h"])(a.mode)||"absolute-height"===a.mode,h.getScreenSize=this._createScreenSizeGetter(n,c),h.calculateRelativeScreenBounds=e=>i.calculateRelativeScreenBounds(h.getScreenSize(),1,e),Object(Ve["b"])(h,t,this._context.elevationProvider),h}_createAsOverlay(e,t,i,r,a,s){i.renderPriority=this._renderPriority;const o=Object(Te["e"])();Object(p["t"])(t,o,this._context.overlaySR),o[2]=k["a"];const c=this._context.clippingExtent;if(Object(n["l"])(c)&&!Object(f["g"])(c,o))return null;const l=this.getFastUpdateAttrValues(e),d=l?e=>dt(this._fastUpdates.materialParameters,l,e):null,h=ut["a"].createPointGeometry(vt,o,r,a,null,null,l),u=new pt["a"](h,i,s,e.uid);o[3]=0,Object(Se["c"])(u.boundingSphere,o),u.calculateShaderTransformation=d;const b=new De(this,[u],null);return b.getScreenSize=this._createScreenSizeGetter(a,d),b.calculateRelativeScreenBounds=e=>i.calculateRelativeScreenBounds(b.getScreenSize(),1,e),b}_createScreenSizeGetter(e,t){const i=this._outlineSize+2;if(this._fastUpdates.enabled){const r=e[0]/this._symbolTextureRatio,n=e[1]/this._symbolTextureRatio;return(e=Object(l["b"])())=>{const a=t(gt);return e[0]=a[0]*r+i,e[1]=a[5]*n+i,e}}{const t=e[0]/this._symbolTextureRatio+i,r=e[1]/this._symbolTextureRatio+i;return(e=Object(l["b"])())=>(e[0]=t,e[1]=r,e)}}_fastVisualVariableConvertOptions(){const e=this._size[0]>this._size[1]?this._size[0]:this._size[1],t=Object(h["h"])(e,e,e),i=Object(je["i"])(1),r=e*i;return{modelSize:t,symbolSize:Object(h["h"])(r,r,r),unitInMeters:i,transformation:{anchor:h["c"],scale:h["a"],rotation:h["c"]}}}_getGraphicHash(e){let t="";for(const i of this._cimRequiredFields)t+=i+e.attributes[i];return t}_forEachMaterial(e){Object(n["l"])(this._material)&&e(this._material),this._cimSymbolMaterials.forEach(e)}}function Tt(e){return e&&"point-3d"===e.type&&e.hasVisibleVerticalOffset()}function Ct(e){return!!Object(n["l"])(e)&&("cross"===e||"x"===e)}function Pt(e){let t;const i=_t,r=i*xt;switch(e){case"circle":t=Object(ke["a"])(i,r);break;case"square":t=Object(ke["d"])(i,r);break;case"kite":t=Object(ke["c"])(i,r);break;case"cross":t=Object(ke["b"])(i,r);break;case"x":t=Object(ke["g"])(i,r);break;case"triangle":t=Object(ke["e"])(i,r)}return new ft["a"](t,{mipmap:!1,wrap:{s:33071,t:33071},width:_t,height:_t,components:4,noUnpackFlip:!0})}St.PRIMITIVE_SIZE=wt,St.elevationModeChangeTypes={definedChanged:I["b"].UPDATE,staysOnTheGround:I["b"].NONE,onTheGroundChanged:I["b"].RECREATE};const At={mode:"relative-to-ground",offset:0},Mt=Object(Te["g"])(0,0,0,1);var Rt=i("d408"),Et=i("3544"),Dt=i("86ba");const It=["polyline","polygon","extent"];class Ft extends z["a"]{constructor(e,t,i,r){super(e,t,i,r),this._uniformSize=1}async doLoad(){if(this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[1,1,1],unitInMeters:1,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}},this._context.renderer&&this._context.renderer.visualVariables&&this._context.renderer.visualVariables.length>0?this._fastUpdates=at(this._context.renderer,this._vvConvertOptions):this._fastUpdates={enabled:!1},!this._drivenProperties.size){const e=null!=this.symbolLayer.size?this.symbolLayer.size:Object(je["i"])(1);if(e<0)throw new S["a"]("graphics3dlinesymbollayer:invalid-size","Symbol sizes may not be negative values");this._uniformSize=e}}getMaterialParameters(e){const t=Object(n["j"])(this.symbolLayer,"material","color"),i=this._getCombinedOpacityAndColor(t);this._patternHidesLine&&(i[3]=0);const r=i[3],a={width:1,color:i,polygonOffset:!0,join:this.symbolLayer.join||"miter",cap:Object(Rt["d"])(this.symbolLayer.cap||"butt"),transparent:r<1||this.needsDrivenTransparentPass,slicePlaneEnabled:this._context.slicePlaneEnabled,isClosed:e,stipplePattern:Object(Et["b"])(this.symbolLayer.pattern),stippleScaleWithLineWidth:!0};if(this._drivenProperties.size)this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size&&(a.width=Object(je["h"])(1));else{const e=null!=this.symbolLayer.size?this.symbolLayer.size:Object(je["i"])(1);a.width=Object(je["h"])(e)}return this._fastUpdates&&this._fastUpdates.visualVariables?{...a,...this._fastUpdates.materialParameters}:a}get lineMaterial(){return Object(n["k"])(this._lineMaterial)&&(this._lineMaterial=new Dt["a"](this.getMaterialParameters(!1)),this._context.stage.add(this._lineMaterial)),this._lineMaterial}get ringMaterial(){return Object(n["k"])(this._ringMaterial)&&(this._ringMaterial=new Dt["a"](this.getMaterialParameters(!0)),this._context.stage.add(this._ringMaterial)),this._ringMaterial}destroy(){super.destroy(),this._context.stage.remove(this._lineMaterial),this._lineMaterial=null,this._context.stage.remove(this._ringMaterial),this._ringMaterial=null}getDrivenSize(e){return this._drivenProperties.size&&e.size?Object(je["h"])(Object(D["b"])(e.size)):1}getSizeFeatureAttributeData(e){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?Object(z["b"])(this._fastUpdates.visualVariables.size.field,e):null}getDrivenColor(e){const t=Object(Te["g"])(1,1,1,1);return this._drivenProperties.color&&e.color&&(t[0]=e.color[0],t[1]=e.color[1],t[2]=e.color[2],e.color.length>0&&(t[3]=e.color[3])),this._drivenProperties.opacity&&e.opacity&&(t[3]=e.opacity),t}getColorFeatureAttributeData(e){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color?Object(z["b"])(this._fastUpdates.visualVariables.color.field,e):null}getOpacityFeatureAttributeData(e){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.opacity?Object(z["b"])(this._fastUpdates.visualVariables.opacity.field,e):null}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry,It,this.symbolLayer.type))return null;const i=this.setGraphicElevationContext(t,new F["a"]);return this.ensureDrapedStatus("on-the-ground"===i.mode),this.draped?this._createAsOverlay(e,this._context.layer.uid):this._createAs3DShape(e,i,t.uid)}applyRendererDiff(e,t){for(const i in e.diff){if("visualVariables"!==i)return 0;if(!st(this._fastUpdates,t,this._vvConvertOptions))return 0;Object(n["l"])(this._lineMaterial)&&this._lineMaterial.setParameters(this._fastUpdates.materialParameters),Object(n["l"])(this._ringMaterial)&&this._ringMaterial.setParameters(this._fastUpdates.materialParameters)}return 2}layerOpacityChanged(){return Object(n["l"])(this._lineMaterial)&&this.updateMaterialLayerOpacity(this._lineMaterial),Object(n["l"])(this._ringMaterial)&&this.updateMaterialLayerOpacity(this._ringMaterial),!0}updateMaterialLayerOpacity(e){const t=e.parameters.color,i=Object(n["j"])(this.symbolLayer,"material","color"),r=this._patternHidesLine?0:this._getCombinedOpacity(i),a=r<1||this.needsDrivenTransparentPass,s=[t[0],t[1],t[2],r];e.setParameters({color:s,transparent:a})}layerElevationInfoChanged(e,t,i){const r=this._elevationContext.mode,n=Object(I["e"])(Ft.elevationModeChangeTypes,i,r);if(n!==I["b"].UPDATE)return n;const a=Object(I["h"])(r);return this.updateGraphics3DGraphicElevationInfo(e,t,()=>a)}slicePlaneEnabledChanged(){return Object(n["l"])(this._lineMaterial)&&this._lineMaterial.setParameters({slicePlaneEnabled:this._context.slicePlaneEnabled}),Object(n["l"])(this._ringMaterial)&&this._ringMaterial.setParameters({slicePlaneEnabled:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}_getGeometryAsPolygonOrPolyline(e){switch(e.type){case"extent":if(e instanceof B["a"])return u["a"].fromExtent(e);break;case"polygon":case"polyline":return e}return null}_createAs3DShape(e,t,i){const r=e.graphic,a=this._getGeometryAsPolygonOrPolyline(r.geometry),s="polygon"===a.type?a.rings:a.paths,o=new Array,c=new Array,l=new Array,d=Object(f["h"])(),h=Object(Rt["b"])(a,this._context.elevationProvider,this._context.renderCoordsHelper,t),u="polygon"===a.type?"rings":"paths";this._logGeometryCreationWarnings(h,s,u,"LineSymbol3DLayer");for(let m=0;m<h.lines.length;m++){const{position:t,mapPosition:i}=h.lines[m];if(Object(n["l"])(this._context.clippingExtent)&&(Object(f["k"])(d),Object(f["n"])(d,i),!Object(f["x"])(d,this._context.clippingExtent)))continue;const r=this._createGeometry(e,t,i,a.type,1);o.push(r),c.push("polygon"===a.type?this.ringMaterial:this.lineMaterial),l.push(M["a"])}if(0===o.length)return null;const p=new K["a"]({geometries:o,materials:c,transformations:l,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:i}}),b=new j["a"](this,p,o,null,null,Ee["c"],t);return b.alignedSampledElevation=h.sampledElevation,b.needsElevationUpdates=Object(I["h"])(t.mode),b}_createGeometry(e,t,i,r,n){const a="polygon"===r?1:0,s=this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color,o=this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size;return Object(Rt["a"])({overlayInfo:0===n?{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper}:null,removeDuplicateStartEnd:a,uniformSize:this._uniformSize,attributeData:{position:t,mapPosition:i,size:o?null:this.getDrivenSize(e.renderingInfo),color:s?null:this.getDrivenColor(e.renderingInfo),sizeFeature:this.getSizeFeatureAttributeData(e.graphic),colorFeature:this.getColorFeatureAttributeData(e.graphic),opacityFeature:this.getOpacityFeatureAttributeData(e.graphic)}})}_createAsOverlay(e,t){const i=e.graphic,r=this._getGeometryAsPolygonOrPolyline(i.geometry),n="polygon"===r.type?r.rings:r.paths,a="polygon"===r.type?this.ringMaterial:this.lineMaterial;a.renderPriority=this._renderPriority;const s=new Array,o=Object(f["h"])(),c=Object(f["k"])(),l=Object(Rt["c"])(r,this._context.overlaySR),d="polygon"===r.type?"rings":"paths";this._logGeometryCreationWarnings(l,n,d,"LineSymbol3DLayer");for(const h of l.lines){if(Object(f["k"])(o),Object(f["n"])(o,h.position),!Object(f["x"])(o,this._context.clippingExtent))continue;Object(f["m"])(c,o);const n=this._createGeometry(e,h.position,null,r.type,0),l=new pt["a"](n,a,t,i.uid);Object(Se["l"])(l.boundingSphere,.5*(o[0]+o[3]),.5*(o[1]+o[4]),0,.5*Math.sqrt((o[3]-o[0])*(o[3]-o[0])+(o[4]-o[1])*(o[4]-o[1]))),s.push(l)}return new De(this,s,c)}get _patternHidesLine(){const e=this.symbolLayer.pattern;return Object(n["l"])(e)&&"style"===e.type&&"none"===e.style}}Ft.elevationModeChangeTypes={definedChanged:I["b"].RECREATE,staysOnTheGround:I["b"].NONE,onTheGroundChanged:I["b"].RECREATE};var zt=i("f0ba"),Lt=i("83fa"),Vt=i("4554"),kt=i("caf1"),Ut=i("1038"),Bt=i("3748");const Nt=["mesh"];class Gt extends z["a"]{constructor(e,t,i,r){super(e,t,i,r),this._materials=new Map,this._textures=new Map,this.ensureDrapedStatus(!1)}async doLoad(){X["a"].DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new Bt["a"]({color:[1,0,1,1]}),this._debugFaceNormalMaterial=new Bt["a"]({color:[0,1,1,1]}))}destroy(){super.destroy(),this._context.stage.removeMany(Array.from(this._materials.values(),e=>e.material)),this._context.stage.removeMany(Array.from(this._textures.values())),this._materials.clear(),this._textures.clear()}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry,Nt,"fill on mesh-3d"))return null;const i=this.setGraphicElevationContext(t,new F["a"]),r=e.renderingInfo;return this._createAs3DShape(t,r,i,t.uid)}layerOpacityChanged(e,t){const i=this._getLayerOpacity();return this._materials.forEach(e=>{e.material.setParameters({layerOpacity:i});const t=e.material.parameters;this._setMaterialTransparentParameter(t,e),e.material.setParameters({transparent:t.transparent})}),e.forEach(e=>{const r=t(e);Object(n["l"])(r)&&r.layerOpacityChanged(i,this._context.isAsync)}),!0}layerElevationInfoChanged(e,t){return this.updateGraphics3DGraphicElevationInfo(e,t,I["i"])}slicePlaneEnabledChanged(e,t){return this._materials.forEach(e=>{e.material.setParameters({slicePlaneEnabled:this._context.slicePlaneEnabled})}),e.forEach(e=>{const i=t(e);Object(n["l"])(i)&&i.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){const e=this._usePBR();return this._materials.forEach(t=>t.material.setParameters({usePBR:e})),!0}pixelRatioChanged(){return!0}_requiresSymbolVertexColors(){return this._drivenProperties.color||this._drivenProperties.opacity}_colorOrTextureUid(e){return Object(n["k"])(e)?"-":e instanceof _e["a"]?e.toHex():e.contentHash}_materialPropertiesDefault(e,t){const i=this._requiresSymbolVertexColors(),r=!!e.vertexAttributes.color,n=!!e.vertexAttributes.tangent;return{hasSymbolVertexColors:i,hasVertexColors:r,hasVertexTangents:n,uid:`vc:${r},vt:${n},vct${t},svc:${i}`}}_materialProperties(e,t,i){const r=this._materialPropertiesDefault(e,i);if(!t.material)return r;const{color:n,colorTexture:a,normalTexture:s,doubleSided:o,alphaCutoff:c,alphaMode:l}=t.material,d=this._colorOrTextureUid(n),h=this._colorOrTextureUid(a),u=this._colorOrTextureUid(s);if(r.color=n,r.colorTexture=a,r.normalTexture=s,r.uid=`${r.uid},cmuid:${d},ctmuid:${h},ntmuid:${u},ds:${o},ac:${c},am:${l}`,t.material instanceof Lt["a"]){const{metallic:e,roughness:i,metallicRoughnessTexture:n,emissiveColor:a,emissiveTexture:s,occlusionTexture:o}=t.material,c=this._colorOrTextureUid(n),l=this._colorOrTextureUid(a),d=this._colorOrTextureUid(s),h=this._colorOrTextureUid(o);r.metallic=e,r.roughness=i,r.metallicRoughnessTexture=n,r.emissiveColor=a,r.emissiveTexture=s,r.occlusionTexture=o,r.uid=`${r.uid},mrm:${e},mrr:${i},mrt:${c},emuid:${l},etmuid:${d},otmuid:${h}`}return r}_setInternalColorValueParameters(e,t){t.diffuse=_e["a"].toUnitRGB(e),t.opacity=e.a}_getLoadableTextureResource(e){return e.data?e.data:e.url}_getInternalTextureId(e){const t=this._getInternalTexture(e,1);return Object(n["l"])(t)?t.id:null}_getInternalTexture(e,t){const i=this._getLoadableTextureResource(e);if(!i)return null;const r=`${e.contentHash}/${t}`;let n=this._textures.get(r);return n||(n=new ft["a"](i,{mipmap:!0,wrap:this._castTextureWrap(e.wrap),noUnpackFlip:!0,preMultiplyAlpha:1!==t}),this._textures.set(r,n),this._context.stage.add(n),this._context.stage.loadSynchronous(n)),n}_castTextureWrap(e="repeat"){if("string"==typeof e){const t=this._castTextureWrapIndividual(e);return{s:t,t:t}}return{s:this._castTextureWrapIndividual(e.horizontal),t:this._castTextureWrapIndividual(e.vertical)}}_castTextureWrapIndividual(e){switch(e){case"clamp":return 33071;case"mirror":return 33648;default:return 10497}}_setInternalMaterialParameters(e,t){if(Object(n["l"])(e.color)&&this._setInternalColorValueParameters(e.color,t),Object(n["l"])(e.colorTexture)){const i=this._getInternalTexture(e.colorTexture,t.textureAlphaMode);Object(n["l"])(i)?(t.textureId=i.id,t.textureAlphaPremultiplied=!!i.params.preMultiplyAlpha):t.textureId=void 0}Object(n["l"])(e.normalTexture)&&(t.normalTextureId=this._getInternalTextureId(e.normalTexture)),Object(n["l"])(e.emissiveColor)&&(t.emissiveFactor=_e["a"].toUnitRGB(e.emissiveColor)),Object(n["l"])(e.emissiveTexture)&&(t.emissiveTextureId=this._getInternalTextureId(e.emissiveTexture)),Object(n["l"])(e.occlusionTexture)&&(t.occlusionTextureId=this._getInternalTextureId(e.occlusionTexture)),Object(n["l"])(e.metallicRoughnessTexture)&&(t.metallicRoughnessTextureId=this._getInternalTextureId(e.metallicRoughnessTexture))}_setExternalMaterialParameters(e){const t=this._drivenProperties.color;let i=Object(n["l"])(this.symbolLayer.material)?this.symbolLayer.material.colorMixMode:null;if(t)e.externalColor=Te["a"];else{const t=Object(n["l"])(this.symbolLayer.material)?this.symbolLayer.material.color:null;Object(n["l"])(t)?e.externalColor=_e["a"].toUnitRGBA(t):(i=null,e.externalColor=Te["a"])}i&&(e.colorMixMode=i),e.castShadows=!!this.symbolLayer.castShadows}_hasTransparentVertexColors(e){const t=e.vertexAttributes.color;if(Object(n["k"])(t))return!1;for(let i=3;i<t.length;i+=4)if(255!==t[i])return!0;return!1}_getOrCreateMaterial(e,t){var i,r,a;const s=null==(i=t.material)?void 0:i.color,o=null==(r=t.material)?void 0:r.colorTexture,c=null==(a=t.material)?void 0:a.alphaMode,l="blend"===c,d=!("opaque"===c)&&(this._hasTransparentVertexColors(e)||Object(n["l"])(s)&&s.a<1||Object(n["l"])(o)&&o.transparent||l),u=this._materialProperties(e,t,d),p=this._materials.get(u.uid);if(p)return p.material;const f={material:null,isComponentTransparent:d,alphaMode:t.material?t.material.alphaMode:"opaque"},b=null==u.metallicRoughnessTexture&&null==u.metallic&&null==u.roughness,m={usePBR:this._usePBR(),isSchematic:b,vertexColors:u.hasVertexColors,symbolColors:u.hasSymbolVertexColors,vertexTangents:u.hasVertexTangents,ambient:h["c"],diffuse:h["a"],opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:0,layerOpacity:this._getLayerOpacity(),slicePlaneEnabled:this._context.slicePlaneEnabled,initTextureTransparent:!0};b||(m.mrrFactors=[null!=u.metallic?u.metallic:1,null!=u.roughness?u.roughness:1,.5]),t.material&&(m.doubleSided=t.material.doubleSided,m.cullFace=t.material.doubleSided?0:2,m.textureAlphaCutoff=t.material.alphaCutoff),this._setExternalMaterialParameters(m),this._setMaterialTransparentParameter(m,f),this._setInternalMaterialParameters(u,m);const g=new J["a"](m);return f.material=g,this._materials.set(u.uid,f),this._context.stage.add(g),g}_usePBR(){return this._context.physicalBasedRenderingEnabled}_setMaterialTransparentParameter(e,t){e.transparent=this.needsDrivenTransparentPass||t.isComponentTransparent||e.layerOpacity<1||e.opacity<1||e.externalColor&&e.externalColor[3]<1,"auto"===t.alphaMode?e.textureAlphaMode=e.transparent?3:1:e.textureAlphaMode="opaque"===t.alphaMode?1:"mask"===t.alphaMode?2:0}_addDebugNormals(e,t,i,r){const n=t.length,a=e.spatialReference.isGeographic?20015077/180:1,s=.1*Math.max(e.extent.width*a,e.extent.height*a,e.extent.zmax-e.extent.zmin),o=[],c=[],l=[],h=[];for(let f=0;f<n;f++){const e=t[f],i=e.vertexAttributes.get("position"),r=e.vertexAttributes.get("normal"),n=e.indices.get("position"),a=e.indices.get("normal"),u=i.data,p=r.data;for(let t=0;t<n.length;t++){const e=3*n[t],i=3*a[t];for(let t=0;t<3;t++)o.push(u[e+t]);for(let t=0;t<3;t++)o.push(u[e+t]+p[i+t]*s);if(c.push(c.length),c.push(c.length),t%3==0){this._calculateFaceNormal(u,n,t,Zt),this._getFaceVertices(u,n,t,Ht,Wt,$t),Object(d["i"])(Ht,Ht,Wt),Object(d["i"])(Ht,Ht,$t),Object(d["h"])(Ht,Ht,1/3);for(let e=0;e<3;e++)l.push(Ht[e]);for(let e=0;e<3;e++)l.push(Ht[e]+Zt[e]*s);h.push(h.length),h.push(h.length)}}}const u=new U["a"]([["position",{data:o,size:3,exclusive:!0}]],[["position",new Uint32Array(c)]],2);t.push(u),i.push(this._debugVertexNormalMaterial),r.push(Object(M["c"])(r[0]));const p=new U["a"]([["position",{data:l,size:3,exclusive:!0}]],[["position",new Uint32Array(h)]],2);t.push(p),i.push(this._debugFaceNormalMaterial),r.push(Object(M["c"])(r[0]))}_createAs3DShape(e,t,i,r){const a=e.geometry;if("mesh"!==a.type)return null;const s=this._createGeometryInfo(a,t);if(!s)return null;const{geometries:o,materials:c,transformations:l,objectTransformation:d}=s;X["a"].DRAW_MESH_GEOMETRY_NORMALS&&this._addDebugNormals(a,o,c,l);const h=new K["a"]({geometries:o,materials:c,transformations:l,metadata:{layerUid:this._context.layer.uid,graphicUid:r}});h.transformation=d;const u=this._createEdgeMaterial(),p=Object(n["l"])(u)?{baseMaterial:c[0],edgeMaterials:[u],properties:{mergeGeometries:!0,slicePlaneEnabled:this._context.slicePlaneEnabled}}:null,f=new j["a"](this,h,o,null,null,Ee["b"],i,p);return f.needsElevationUpdates=Object(I["i"])(i.mode),f.useObjectOriginAsAttachmentOrigin=!0,f.elevationContext.centerPointInElevationSR=this.getCenterPointInElevationSR(h),f.alignedSampledElevation=Object(Ee["b"])(f,f.elevationContext,this._context.elevationProvider,this._context.renderCoordsHelper),f}getCenterPointInElevationSR(e){const t=Object(m["j"])(0,0,0,this._context.elevationProvider.spatialReference);return Object(p["w"])([e.transformation[12],e.transformation[13],e.transformation[14]],this._context.renderCoordsHelper.spatialReference,t),t}_createComponentNormals(e,t,i,r){switch(i.shading||"flat"){case"source":return this._createComponentNormalsSource(e,t,i,r);case"flat":return this._createComponentNormalsFlat(e,r);case"smooth":return this._createComponentNormalsSmooth(e,r);default:return}}_createComponentNormalsSource(e,t,i,r){if(Object(n["k"])(t))return this._createComponentNormalsFlat(e,r);let a=!1;if(!i.trustSourceNormals)for(let n=0;n<r.length;n+=3){this._calculateFaceNormal(e,r,n,Zt);for(let e=0;e<3;e++){const i=3*r[n+e];Ht[0]=t[i+0],Ht[1]=t[i+1],Ht[2]=t[i+2],Object(d["k"])(Zt,Ht)<0&&(t[i+0]=-t[i+0],t[i+1]=-t[i+1],t[i+2]=-t[i+2],a=!0)}}return{normals:t,indices:r,didFlipNormals:a}}_createComponentNormalsFlat(e,t){const i=new Float32Array(t.length),r=new Uint32Array(3*t.length);for(let n=0;n<t.length;n+=3){const a=this._calculateFaceNormal(e,t,n,Zt);for(let e=0;e<3;e++)i[n+e]=a[e],r[n+e]=n/3}return{normals:i,indices:r,didFlipNormals:!1}}_createComponentNormalsSmooth(e,t){const i={};for(let a=0;a<t.length;a+=3){const r=this._calculateFaceNormal(e,t,a,Zt);for(let e=0;e<3;e++){const n=t[a+e];let s=i[n];s||(s={normal:Object(h["f"])(),count:0},i[n]=s),Object(d["i"])(s.normal,s.normal,r),s.count++}}const r=new Float32Array(3*t.length),n=new Uint32Array(3*t.length);for(let a=0;a<t.length;a++){const e=i[t[a]];1!==e.count&&(Object(d["u"])(e.normal,e.normal),e.count=1);for(let t=0;t<3;t++)r[3*a+t]=e.normal[t];n[a]=a}return{normals:r,indices:n,didFlipNormals:!1}}_getFaceVertices(e,t,i,r,n,a){const s=3*t[i+0],o=3*t[i+1],c=3*t[i+2];r[0]=e[s+0],r[1]=e[s+1],r[2]=e[s+2],n[0]=e[o+0],n[1]=e[o+1],n[2]=e[o+2],a[0]=e[c+0],a[1]=e[c+1],a[2]=e[c+2]}_calculateFaceNormal(e,t,i,r){return this._getFaceVertices(e,t,i,Ht,Wt,$t),Object(d["m"])(Wt,Wt,Ht),Object(d["m"])($t,$t,Ht),Object(d["j"])(Ht,Wt,$t),Object(d["u"])(r,Ht),r}_getOrCreateComponents(e){return e.components?e.components:Kt}_createPositionBuffer(e,t){let i=e.vertexAttributes.position;const r=1===t.reprojection?t.transformBeforeProject:null;if(Object(n["l"])(r)&&(i=Object(Vt["h"])(i,new Float64Array(i.length),r)),0===t.reprojection)return t.needsBufferCopy?new Float64Array(i):i;const a=Object(n["l"])(r)?i:new Float64Array(i.length);return Object(p["p"])(i,e.spatialReference,0,a,this._context.renderCoordsHelper.spatialReference,0,i.length/3),a}_createNormalBuffer(e,t,i){let r=e.vertexAttributes.normal;if(Object(n["k"])(r))return null;const a=1===i.reprojection?i.transformBeforeProject:null;if(Object(n["l"])(a)&&(r=Object(Vt["g"])(r,new Float32Array(r.length),a)),"local"===this._context.layerView.view.viewingMode||0===i.reprojection)return i.needsBufferCopy&&e.vertexAttributes.normal===r?new Float32Array(r):r;const s=e.vertexAttributes.position,o=Object(n["l"])(a)?r:new Float32Array(r.length);return Object(Vt["c"])(r,s,t,e.spatialReference,o)}_createTangentBuffer(e,t,i){let r=e.vertexAttributes.tangent;if(Object(n["k"])(r))return null;const a=1===i.reprojection?i.transformBeforeProject:null;if(Object(n["l"])(a)&&(r=Object(Vt["i"])(r,new Float32Array(r.length),a)),"local"===this._context.layerView.view.viewingMode||0===i.reprojection)return i.needsBufferCopy&&e.vertexAttributes.normal===r?new Float32Array(r):r;const s=e.vertexAttributes.position,o=Object(n["l"])(a)?r:new Float32Array(r.length);return Object(Vt["e"])(r,s,t,e.spatialReference,o)}_createColorBuffer(e){return e.vertexAttributes.color}_createSymbolColorBuffer(e){if(this._requiresSymbolVertexColors()){const t=this._getVertexOpacityAndColor(e),i=Object(kt["b"])(Object(n["j"])(this.symbolLayer,"material","colorMixMode")),r=new Uint8Array(4);return Object(kt["a"])(t,i,r),r}return null}_createBuffers(e,t){const i=e.vertexAttributes&&e.vertexAttributes.position;if(!i)return this.logger.warn("Mesh geometry must contain position vertex attributes"),null;const r=e.vertexAttributes.normal,a=e.vertexAttributes.uv,s=e.vertexAttributes.tangent;if(Object(n["l"])(r)&&r.length!==i.length)return this.logger.warn("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;if(Object(n["l"])(s)&&s.length/4!=i.length/3)return this.logger.warn("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),null;if(Object(n["l"])(a)&&a.length/2!=i.length/3)return this.logger.warn("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),null;const o=this._computeReprojectionInfo(e),c=this._createPositionBuffer(e,o),l=this._createColorBuffer(e),d=this._createSymbolColorBuffer(t),h=this._createNormalBuffer(e,c,o),u=this._createTangentBuffer(e,c,o);return{positionBuffer:c,normalBuffer:h,tangentBuffer:u,uvBuffer:a,colorBuffer:l,symbolColorBuffer:d,objectTransformation:0===o.reprojection&&Object(n["l"])(o.objectTransformation)?o.objectTransformation:this._transformOriginLocal(e,c,h,u),geometryTransformation:0===o.reprojection&&Object(n["l"])(o.geometryTransformation)?o.geometryTransformation:Object(M["d"])()}}_computeReprojectionInfo(e){const t=Object(n["l"])(e.transform)&&e.transform.geographic||2===this._context.renderCoordsHelper.viewingMode?0:1;let i=null;if(Object(n["l"])(e.transform)){if(0===t){const i=Object(M["d"])();return Object(p["d"])(e.spatialReference,e.transform.origin,i,this._context.renderCoordsHelper.spatialReference),{reprojection:t,objectTransformation:i,geometryTransformation:Object(M["c"])(e.transform.localMatrix),needsBufferCopy:!1}}return i=Object(A["w"])(Object(M["d"])(),e.transform.origin),Object(A["n"])(i,i,e.transform.localMatrix),{reprojection:t,transformBeforeProject:i,needsBufferCopy:!0}}return{reprojection:t,needsBufferCopy:!0}}_transformOriginLocal(e,t,i,r){const a=this._context.renderCoordsHelper.spatialReference,s=e.anchor;qt[0]=s.x,qt[1]=s.y,qt[2]=s.z;const o=Object(M["d"])();Object(p["d"])(e.spatialReference,qt,o,a);const c=R["v"].fromTypedArray(t);if(Object(A["c"])(Qt,o),Object(E["e"])(c,c,Qt),Object(n["l"])(i)||Object(n["l"])(r)){if(Object(C["f"])(Xt,o),Object(C["o"])(Xt,Xt),Object(n["l"])(i)){const e=R["u"].fromTypedArray(i);Object(E["a"])(e,e,Xt)}if(Object(n["l"])(r)){const e=R["u"].fromTypedArray(r,4*r.BYTES_PER_ELEMENT);Object(E["a"])(e,e,Xt)}}return o}_validateFaces(e,t){const i=e.vertexAttributes.position.length/3,r=t.faces;if(r){let e=-1;for(let t=0;t<r.length;t++){const i=r[t];i>e&&(e=i)}if(i<=e)return this.logger.warn(`Vertex index ${e} is out of bounds of the mesh position buffer`),!1}else if(i%3!=0)return this.logger.warn("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),!1;return!0}_getOrCreateFaces(e,t){return t.faces?t.faces:Object(Ut["d"])(e.vertexAttributes.position.length/3)}_isOutsideClippingArea(e){if(!this._context.clippingExtent)return!1;const t=e.vertexAttributes&&e.vertexAttributes.position;if(!t)return!1;const i=this._context.elevationProvider.spatialReference;let r;const n=t.length/3;return e.spatialReference.equals(i)?r=t:(r=new Float64Array(t.length),Object(p["p"])(e.vertexAttributes.position,e.spatialReference,0,r,i,0,n)),Object(f["k"])(Yt),Object(f["n"])(Yt,r,0,n),!Object(f["x"])(Yt,this._context.clippingExtent)}_createGeometryInfo(e,t){if(!Object(p["b"])(e.spatialReference,this._context.layerView.view.spatialReference))return this.logger.warn("Geometry spatial reference is not compatible with the view"),null;if(this._isOutsideClippingArea(e))return null;const i=this._createBuffers(e,t);if(Object(n["k"])(i))return null;const{positionBuffer:r,uvBuffer:a,colorBuffer:s,symbolColorBuffer:o,normalBuffer:c,tangentBuffer:l,objectTransformation:d,geometryTransformation:h}=i,u=this._getOrCreateComponents(e),f=[],b=[],m=[];let g=!1;for(const p of u){if(!this._validateFaces(e,p))return null;const t=this._getOrCreateFaces(e,p);if(0===t.length)continue;const i=this._createComponentNormals(r,c,p,t);i.didFlipNormals&&(g=!0);const d=[["position",{size:3,data:r,exclusive:!0}],["normal",{size:3,data:i.normals,exclusive:!0}]],u=[["position",t],["normal",i.indices]];Object(n["l"])(s)&&(d.push(["color",{size:4,data:s,exclusive:!0}]),u.push(["color",t])),Object(n["l"])(o)&&(d.push(["symbolColor",{size:4,data:o,exclusive:!0}]),u.push(["symbolColor",new Uint16Array(t.length)])),Object(n["l"])(a)&&(d.push(["uv0",{size:2,data:a,exclusive:!0}]),u.push(["uv0",t])),Object(n["l"])(l)&&(d.push(["tangent",{size:4,data:l,exclusive:!0}]),u.push(["tangent",t]));const v=new U["a"](d,u);f.push(v),b.push(h),m.push(this._getOrCreateMaterial(e,p))}return g&&this.logger.warn("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals."),{geometries:f,transformations:b,materials:m,objectTransformation:d}}_createEdgeMaterial(){const e={opacity:this._getLayerOpacity()};return Object(Q["a"])(this.symbolLayer,e)}}const qt=Object(h["f"])(),Ht=Object(h["f"])(),Wt=Object(h["f"])(),$t=Object(h["f"])(),Zt=Object(h["f"])(),Qt=Object(M["d"])(),Xt=Object(P["b"])(),Yt=Object(f["h"])(),Kt=[new zt["a"]];var Jt=i("8c11"),ei=i("af3d"),ti=i("bea9");class ii{constructor(e,t,i,r){this.graphics3DSymbolLayer=e,this.instanceIndex=t,this.elevationAligner=i,this.elevationContext=r,this.type="lod-instance",this._highlights=new Set,this.alignedSampledElevation=0,this.isElevationSource=!1,this.needsElevationUpdates=!1}initialize(){}setVisibility(e){const t=this.lodRenderer.instanceData;e!==t.getVisible(this.instanceIndex)&&t.setVisible(this.instanceIndex,e)}destroy(){null!=this.instanceIndex&&(this.lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))}alignWithElevation(e,t,i){if(this.elevationAligner){Object(v["g"])(this.elevationContext.featureExpressionInfoContext,i);const r=this.elevationAligner(this,this.elevationContext,e,t);Object(n["l"])(r)&&(this.alignedSampledElevation=r)}}getCenterObjectSpace(e=Object(h["f"])()){return this.lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,oi),Object(d["t"])(e,this.lodRenderer.baseBoundingSphere.center,oi)}getBoundingBoxObjectSpace(e=Object(f["h"])()){this.lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,oi);const t=this.lodRenderer.baseBoundingBox;Object(f["k"])(e);for(let i=0;i<8;++i)Object(d["z"])(ni,0==(1&i)?t[0]:t[3],0==(2&i)?t[1]:t[4],0==(4&i)?t[2]:t[5]),Object(d["t"])(ni,ni,oi),Object(f["r"])(e,ni);return e}computeAttachmentOrigin(e){this.lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,oi),e.render.origin[0]+=oi[12],e.render.origin[1]+=oi[13],e.render.origin[2]+=oi[14],e.render.num++}async getProjectedBoundingBox(e,t,i,r,a){const s=this.getBoundingBoxObjectSpace(a),o=si,c=Object(f["y"])(s)?1:o.length;this.lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,oi);for(let n=0;n<c;n++){const e=o[n];ni[0]=s[e[0]],ni[1]=s[e[1]],ni[2]=s[e[2]],Object(d["t"])(ni,ni,oi),ri[3*n+0]=ni[0],ri[3*n+1]=ni[1],ri[3*n+2]=ni[2]}if(!e(ri,0,c))return null;Object(f["k"])(s);let l=null;this.calculateRelativeScreenBounds&&(l=this.calculateRelativeScreenBounds());for(let n=0;n<3*c;n+=3){for(let e=0;e<3;e++)s[e]=Math.min(s[e],ri[n+e]),s[e+3]=Math.max(s[e+3],ri[n+e]);l&&i.push({location:ri.slice(n,n+3),screenSpaceBoundingRect:l})}if(t&&(Object(f["e"])(s,ai),"absolute-height"!==this.elevationContext.mode)){let e;const i=Object(L["d"])(s,t);try{e=await t.service.queryElevation(ai[0],ai[1],r,i,"ground")}catch(h){}Object(n["l"])(e)&&Object(f["A"])(s,0,0,-this.alignedSampledElevation+e)}return s}addObjectState(e,t){if(0===e){const i=new ti["a"](e);this.addHighlightId(i),t.addExternal(e=>{this.removeHighlightId(e)},i)}}removeObjectState(e){this._highlights.forEach(t=>e.remove(t))}addHighlightId(e){this._highlights.add(e),this.lodRenderer.instanceData.setHighlight(this.instanceIndex,!0)}removeHighlightId(e){this._highlights.delete(e),this.lodRenderer.instanceData.setHighlight(this.instanceIndex,this._highlights.size>0)}get lodRenderer(){return this.graphics3DSymbolLayer.lodRenderer}}const ri=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],ni=Object(h["f"])(),ai=Object(h["f"])(),si=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],oi=Object(M["d"])();var ci=i("f33e");function li(e){const t=[];return e.stageResources.geometries.forEach((i,r)=>{const n=e.stageResources.materials[r],a=e.stageResources.textures;t.push({material:n,geometry:i,textures:a})}),{components:t,minScreenSpaceRadius:e.lodThreshold,pivotOffset:e.pivotOffset}}function di(e){return{levels:e.map(e=>li(e))}}function hi(e,t=pi){const i=Object(ci["a"])(e);return Math.sqrt(i/(t*Math.PI))}function ui(e){e.levels.forEach(e=>{e.minScreenSpaceRadius||(e.minScreenSpaceRadius=hi(e))})}const pi=.05;var fi,bi=i("94a6"),mi=i("9ac8"),gi=i("a803"),vi=i("2ebb"),yi=i("6a07"),Oi=i("171c"),_i=i("fa1e"),xi=i("1153"),ji=i("ce6d"),wi=i("680b"),Si=i("fc00");function Ti(e){let t=Object(Si["a"])().mat4f64("localTransform").mat4f64("globalTransform").vec4f64("boundingSphere").vec3f64("modelOrigin").mat3f("model").mat3f("modelNormal").vec2f("modelScaleFactors");return e.indexOf("color")>=0&&(t=t.vec4f("color")),e.indexOf("featureAttribute")>=0&&(t=t.vec4f("featureAttribute")),t=t.u8("state").u8("lodLevel").alignTo(8),t}!function(e){e[e.ALLOCATED=1]="ALLOCATED",e[e.DEFAULT_ACTIVE=2]="DEFAULT_ACTIVE",e[e.VISIBLE=4]="VISIBLE",e[e.HIGHLIGHT=8]="HIGHLIGHT",e[e.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE",e[e.REMOVE=32]="REMOVE",e[e.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED",e[e.ACTIVE=18]="ACTIVE"}(fi||(fi={}));class Ci{constructor(e){this.localTransform=e.getField("localTransform",R["i"]),this.globalTransform=e.getField("globalTransform",R["i"]),this.modelOrigin=e.getField("modelOrigin",R["v"]),this.model=e.getField("model",R["f"]),this.modelNormal=e.getField("modelNormal",R["f"]),this.modelScaleFactors=e.getField("modelScaleFactors",R["m"]),this.boundingSphere=e.getField("boundingSphere",R["D"]),this.color=e.getField("color",R["C"]),this.featureAttribute=e.getField("featureAttribute",R["C"]),this.state=e.getField("state",R["l"]),this.lodLevel=e.getField("lodLevel",R["l"])}}class Pi extends ji["a"]{constructor(e,t){super(),this._capacity=0,this._size=0,this._next=0,this._layout=Ti(e),this._shaderTransformation=t}get capacity(){return this._capacity}get size(){return this._size}get buffer(){return this._buffer.buffer}get view(){return this._view}addInstance(){this._size+1>this._capacity&&this.grow();const e=this.findSlot();return this._view.state.set(e,fi.ALLOCATED),this._size++,this.emit("instance-added",{index:e}),e}removeInstance(e){const t=this._view.state;Object(xi["a"])(e>=0&&e<this._capacity&&t.get(e)&fi.ALLOCATED,"invalid instance handle"),this.getStateFlag(e,fi.ACTIVE)?this.setStateFlags(e,fi.REMOVE):this.freeInstance(e),this.emit("instance-removed",{index:e})}freeInstance(e){const t=this._view.state;Object(xi["a"])(e>=0&&e<this._capacity&&t.get(e)&fi.ALLOCATED,"invalid instance handle"),t.set(e,0),this._size--}setLocalTransform(e,t,i=!0){this._view.localTransform.setMat(e,t),i&&this.updateModelTransform(e)}getLocalTransform(e,t){this._view.localTransform.getMat(e,t)}setGlobalTransform(e,t,i=!0){this._view.globalTransform.setMat(e,t),i&&this.updateModelTransform(e)}getGlobalTransform(e,t){this._view.globalTransform.getMat(e,t)}updateModelTransform(e){const t=this._view,i=Ri,r=Ei;t.localTransform.getMat(e,Di),t.globalTransform.getMat(e,Ii);const n=Object(A["n"])(Ii,Ii,Di);Object(d["z"])(i,n[12],n[13],n[14]),t.modelOrigin.setVec(e,i),Object(C["f"])(r,n),t.model.setMat(e,r);const a=Object(wi["k"])(Ri,n);a.sort(),t.modelScaleFactors.set(e,0,a[1]),t.modelScaleFactors.set(e,1,a[2]),Object(C["e"])(r,r),Object(C["o"])(r,r),t.modelNormal.setMat(e,r),this.setStateFlags(e,fi.TRANSFORM_CHANGED),this.emit("instance-transform-changed",{index:e})}getModelTransform(e,t){const i=this._view;i.model.getMat(e,Ei),i.modelOrigin.getVec(e,Ri),t[0]=Ei[0],t[1]=Ei[1],t[2]=Ei[2],t[3]=0,t[4]=Ei[3],t[5]=Ei[4],t[6]=Ei[5],t[7]=0,t[8]=Ei[6],t[9]=Ei[7],t[10]=Ei[8],t[11]=0,t[12]=Ri[0],t[13]=Ri[1],t[14]=Ri[2],t[15]=1}applyShaderTransformation(e,t){this._shaderTransformation&&this._shaderTransformation.applyTransform(this,e,t)}getCombinedModelTransform(e,t){return this.getModelTransform(e,t),this._shaderTransformation&&this._shaderTransformation.applyTransform(this,e,t),t}getCombinedLocalTransform(e,t){return this._view.localTransform.getMat(e,t),this._shaderTransformation&&this._shaderTransformation.applyTransform(this,e,t),t}getCombinedMaxScaleFactor(e){let t=this._view.modelScaleFactors.get(e,1);if(this._shaderTransformation){const i=this._shaderTransformation.scaleFactor(Ri,this,e);t*=Math.max(i[0],i[1],i[2])}return t}getCombinedMedianScaleFactor(e){let t=this._view.modelScaleFactors.get(e,0);if(this._shaderTransformation){const i=this._shaderTransformation.scaleFactor(Ri,this,e);i.sort(),t*=i[1]}return t}getModel(e,t){this._view.model.getMat(e,t)}setFeatureAttribute(e,t){this._view.featureAttribute.setVec(e,t)}getFeatureAttribute(e,t){this._view.featureAttribute.getVec(e,t)}setColor(e,t){this._view.color.setVec(e,t)}getColor(e,t){this._view.color.getVec(e,t)}setVisible(e,t){t!==this.getVisible(e)&&(this.setStateFlag(e,fi.VISIBLE,t),this.emit("instance-visibility-changed",{index:e}))}getVisible(e){return this.getStateFlag(e,fi.VISIBLE)}setHighlight(e,t){t!==this.getHighlight(e)&&(this.setStateFlag(e,fi.HIGHLIGHT,t),this.emit("instance-highlight-changed",{index:e}))}getHighlight(e){return this.getStateFlag(e,fi.HIGHLIGHT)}getState(e){return this._view.state.get(e)}getLodLevel(e){return this._view.lodLevel.get(e)}countFlags(e){let t=0;for(let i=0;i<this._capacity;++i)this.getState(i)&e&&++t;return t}setStateFlags(e,t){const i=this._view.state;t=i.get(e)|t,i.set(e,t)}clearStateFlags(e,t){const i=this._view.state;t=i.get(e)&~t,i.set(e,t)}setStateFlag(e,t,i){i?this.setStateFlags(e,t):this.clearStateFlags(e,t)}getStateFlag(e,t){return!!(this._view.state.get(e)&t)}grow(){const e=Math.max(Ai,Math.floor(this._capacity*Mi)),t=this._layout.createBuffer(e);if(this._buffer){const e=new Uint8Array(this._buffer.buffer);new Uint8Array(t.buffer).set(e)}this._capacity=e,this._buffer=t,this._view=new Ci(this._buffer)}findSlot(){const e=this._view.state;let t=this._next;for(;e.get(t)&fi.ALLOCATED;)t=(t+1)%this._capacity;return this._next=(t+1)%this._capacity,t}}const Ai=1024,Mi=2,Ri=Object(h["f"])(),Ei=Object(P["b"])(),Di=Object(M["d"])(),Ii=Object(M["d"])();var Fi=i("f895"),zi=i("0bde");class Li extends zi["a"]{constructor(e,t){super(e=>Object(Fi["n"])(this._instanceData.view.boundingSphere.getVec(e,this._tmpSphere)),{maximumDepth:25}),this._tmpSphere=Object(Fi["c"])(),this._tmpMat4=Object(M["d"])(),this._instanceData=e,this._boundingSphere=t}addInstance(e){const t=this._instanceData.view.boundingSphere,i=this._instanceData.getCombinedModelTransform(e,this._tmpMat4);Object(d["t"])(this._tmpSphere,this._boundingSphere.center,i),this._tmpSphere[3]=this._boundingSphere.radius*Object(wi["i"])(i),t.setVec(e,this._tmpSphere),this.add([e])}removeInstance(e){this.remove([e])}}class Vi{constructor(e,t){this.thresholdScale=1,this._camera=new Oi["a"],this._worldSpaceRadius=e,this._thresholds=t.map(e=>e)}updateCamera(e){this._camera.copyFrom(e)}selectLevel(e,t){const i=this._camera.computeScreenPixelSizeAt(e),r=this._worldSpaceRadius*t/i,n=this._thresholds;let a=-1;for(let s=0;s<n.length;++s)r>=n[s]*this.thresholdScale&&(a=s);return a}}var ki=i("b061"),Ui=i("9250"),Bi=i("7ce4"),Ni=i("0fa6");class Gi{constructor(e,t){const i=e.renderContext.rctx,{geometry:r,material:n}=t;this._materialRepository=e.materialRep,n.setParameters({instancedDoublePrecision:!0});const a=n.createBufferWriter(),s=a.vertexBufferLayout,o=a.elementCount(r),c=a.allocate(o);a.write({},r,c,0),this.geometry=r,this.material=n,this.glMaterials=new ki["a"](n,this._materialRepository),this.vertexBufferLayout=s,this.vbo=Bi["a"].createVertex(i,35044,c.buffer),this.vao=new Ni["a"](i,_i["a"],{geometry:Object(vi["a"])(s)},{geometry:this.vbo}),this.vertexCount=o}destroy(){this.glMaterials.destroy(),this.vbo.dispose(),this.vao.dispose()}get boundingInfo(){return this.geometry.boundingInfo}get triangleCount(){return this.vertexCount/3}intersect(e,t,i,r,n,a){const s=this.geometry.id;this.material.intersect(this.geometry,null,e.transform.transform,e,i,r,(i,r,o,c,l)=>{if(i>=0){if(null!=t&&!t(e.rayBegin,e.rayEnd,i))return;const c={layerUid:a.layerUid,graphicUid:a.graphicUid(n),geometryId:s,triangleNr:o};if((null==e.results.min.drapedLayerOrder||l>=e.results.min.drapedLayerOrder)&&(null==e.results.min.dist||i<e.results.min.dist)&&e.results.min.set(6,c,i,r,e.transform.transform,l),0!==e.options.store&&(null==e.results.max.drapedLayerOrder||l>=e.results.max.drapedLayerOrder)&&(null==e.results.max.dist||i>e.results.max.dist)&&e.results.max.set(6,c,i,r,e.transform.transform,l),2===e.options.store){const t=Object(Ui["c"])(e.results.min.ray);t.set(6,c,i,r,e.transform.transform,l),e.results.all.push(t)}}})}}class qi{constructor(e,t){this.minScreenSpaceRadius=e,this.components=t}static async create(e,t,i){const r=await Promise.allSettled(t.components.map(t=>e.schedule(()=>new Gi(e,t),i))),n=r.map(e=>"fulfilled"===e.status?e.value:null).filter(e=>e);if(Object(a["n"])(i)||n.length!==r.length){n.forEach(e=>e.destroy()),Object(a["w"])(i);for(const e of r)if("rejected"===e.status)throw e.reason}return new qi(t.minScreenSpaceRadius,n)}destroy(){this.components.forEach(e=>e.destroy())}intersect(e,t,i,r,n,a){this.components.forEach(s=>s.intersect(e,t,i,r,n,a))}get boundingBox(){if(Object(n["k"])(this._boundingBox)){const e=Object(f["k"])();this.components.forEach(t=>{Object(n["l"])(t.boundingInfo)&&(Object(f["r"])(e,t.boundingInfo.bbMin),Object(f["r"])(e,t.boundingInfo.bbMax))}),this._boundingBox=e}return this._boundingBox}get boundingSphere(){if(Object(n["k"])(this._boundingSphere)){const e=this.boundingBox,t=Object(h["f"])();Object(f["e"])(e,t),this._boundingSphere={center:t,radius:.5*Object(f["j"])(e)}}return this._boundingSphere}get triangleCount(){return this.components.reduce((e,t)=>e+t.triangleCount,0)}}class Hi{constructor(e,t,i){this._elementSize=t,this._buffer=Bi["a"].createVertex(e,35044),this.resize(i)}destroy(){this._buffer.dispose()}get elementSize(){return this._elementSize}get capacity(){return this._capacity}get array(){return this._array}get buffer(){return this._buffer}get memoryUsage(){return{cpu:this._capacity*this._elementSize,gpu:this._capacity*this._elementSize}}copyRange(e,t,i,r=0){const n=new Uint8Array(this.array,e*this.elementSize,(t-e)*this.elementSize);new Uint8Array(i.array,r*this.elementSize).set(n)}transferAll(){this._buffer.setData(this._array)}transferRange(e,t){const i=e*this._elementSize,r=t*this._elementSize;this._buffer.setSubData(this._array,i,i,r)}resize(e){const t=e*this._elementSize,i=new ArrayBuffer(t);this._array&&(e>=this._capacity?new Uint8Array(i).set(new Uint8Array(this._array)):new Uint8Array(i).set(new Uint8Array(this._array).subarray(0,e*this._elementSize))),this._array=i,this._buffer.setData(t),this._capacity=e}}class Wi{constructor(e){this.modelOriginHi=e.getField("modelOriginHi",R["u"]),this.modelOriginLo=e.getField("modelOriginLo",R["u"]),this.model=e.getField("model",R["f"]),this.modelNormal=e.getField("modelNormal",R["f"]),this.color=e.getField("instanceColor",R["C"]),this.featureAttribute=e.getField("instanceFeatureAttribute",R["C"])}}class $i{constructor(e,t){this._headIndex=0,this._tailIndex=0,this._captureFirstIndex=!0,this._updating=!1,this._prevHeadIndex=0,this._resized=!1,this._rctx=e,this._instanceBufferLayout=t,this._elementSize=t.stride,this._capacity=1}destroy(){this._buffer&&this._buffer.destroy()}get buffer(){return this._buffer.buffer}get view(){return this._view}get capacity(){return this._capacity}get size(){const e=this._headIndex,t=this._tailIndex;return e>=t?e-t:e+this._capacity-t}get isEmpty(){return this._headIndex===this._tailIndex}get isFull(){return this._tailIndex===(this._headIndex+1)%this._capacity}get headIndex(){return this._headIndex}get tailIndex(){return this._tailIndex}get firstIndex(){return this._firstIndex}get memoryUsage(){return this._buffer?this._buffer.memoryUsage:{cpu:0,gpu:0}}reset(){this._headIndex=0,this._tailIndex=0,this._firstIndex=null}startUpdateCylce(){this._captureFirstIndex=!0}beginUpdate(){Object(xi["a"])(!this._updating,"already updating"),this._updating=!0,this._prevHeadIndex=this._headIndex}endUpdate(){Object(xi["a"])(this._updating,"not updating"),this.size<Xi*this.capacity&&this.shrink(),this._resized?(this._buffer.transferAll(),this._resized=!1):this.transferRange(this._prevHeadIndex,this._headIndex),this._updating=!1}allocateHead(){Object(xi["a"])(this._updating,"not updating"),this.isFull&&this.grow();const e=this.headIndex;return this._captureFirstIndex&&(this._firstIndex=e,this._captureFirstIndex=!1),this.incrementHead(),Object(xi["a"])(this._headIndex!==this._tailIndex,"invalid pointers"),e}freeTail(){Object(xi["a"])(this._updating,"not updating"),Object(xi["a"])(this.size>0,"invalid size");const e=this._tailIndex===this._firstIndex;this.incrementTail(),e&&(this._firstIndex=this._tailIndex)}grow(){const e=Math.max(Zi,Math.floor(this._capacity*Qi));this.resize(e)}shrink(){const e=Math.max(Zi,Math.floor(this._capacity*Yi));this.resize(e)}resize(e){if(Object(xi["a"])(this._updating,"not updating"),e===this._capacity)return;const t=new Hi(this._rctx,this._elementSize,e);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);const e=this.size,i=this.compactInstances(t);Object(xi["a"])(i===e,"invalid compaction"),this._buffer.destroy(),this._tailIndex=0,this._headIndex=i,this._prevHeadIndex=0}this._resized=!0,this._capacity=e,this._buffer=t,this._view=new Wi(this._instanceBufferLayout.createView(this._buffer.array))}compactInstances(e){const t=this._headIndex,i=this._tailIndex;return i<t?(this._buffer.copyRange(i,t,e),t-i):i>t?(this._buffer.copyRange(i,this._capacity,e),t>0&&this._buffer.copyRange(0,t,e,this._capacity-i),t+(this._capacity-i)):0}incrementHead(e=1){this._headIndex=(this._headIndex+e)%this._capacity}incrementTail(e=1){this._tailIndex=(this._tailIndex+e)%this._capacity}transferRange(e,t){e<t?this._buffer.transferRange(e,t):e>t&&(t>0&&this._buffer.transferRange(0,t),this._buffer.transferRange(e,this._capacity))}}const Zi=1024,Qi=2,Xi=.3,Yi=.5;var Ki=i("7c51"),Ji=i("b623"),er=i("8539");let tr=function(e){const t=e.baseBoundingSphere.radius,i=e.levels.map(e=>e.minScreenSpaceRadius);return new Vi(t,i)};class ir{constructor(e,t,i,r){this.type=6,this.isGround=!1,this._inverseViewport=Object(l["b"])(),this._levels=[],this._defaultRenderInstanceData=[],this._highlightRenderInstanceData=[],this._instanceIndex=0,this._slicePlane=!1,this._enableLevelSelection=!0,this._lastCamera=new Oi["a"],this._updateCyclesWithStaticCamera=-1,this._needFullCycle=!1,this.canRender=!0,this._symbol=e,this._optionalFields=t,this._metadata=i,this._instanceBufferLayout=Object(J["b"])({instancedDoublePrecision:!0,instanced:t}),this._glInstanceBufferLayout=Object(vi["a"])(this._instanceBufferLayout,1),this._instanceData=new Pi(this._optionalFields,r),this._instanceData.on("instance-added",()=>this.requestUpdateCycle()),this._instanceData.on("instance-removed",()=>this.requestUpdateCycle()),this._instanceData.on("instance-transform-changed",e=>{this.requestUpdateCycle(),this._metadata.notifyGraphicGeometryChanged(e.index)}),this._instanceData.on("instance-visibility-changed",e=>{this.requestUpdateCycle(!0),this._metadata.notifyGraphicVisibilityChanged(e.index)}),this._instanceData.on("instance-highlight-changed",()=>this.requestUpdateCycle(!0)),this._enableLevelSelection=this._symbol.levels.length>1}get levels(){return this._levels}get baseBoundingBox(){return this._levels[this._levels.length-1].boundingBox}get baseBoundingSphere(){return this._levels[this._levels.length-1].boundingSphere}get baseMaterial(){return this._levels[this._levels.length-1].components[0].material}get slicePlaneEnabled(){return this._slicePlane}set slicePlaneEnabled(e){this._slicePlane=e}get layerUid(){return this._metadata.layerUid}get instanceData(){return this._instanceData}get memoryUsage(){const e={cpu:0,gpu:0};return this._defaultRenderInstanceData.forEach(t=>{const i=t.memoryUsage;e.cpu+=i.cpu,e.gpu+=i.gpu}),this._highlightRenderInstanceData.forEach(t=>{const i=t.memoryUsage;e.cpu+=i.cpu,e.gpu+=i.gpu}),e}get renderStats(){const e=this._instanceData.size,t=[];return this._levels.forEach((e,i)=>{const r=this._defaultRenderInstanceData[i],n=this._highlightRenderInstanceData[i],a=r.size+n.size,s=e.triangleCount;t.push({renderedInstances:a,renderedTriangles:a*s,trianglesPerInstance:s})}),{totalInstances:e,renderedInstances:t.reduce((e,t)=>e+t.renderedInstances,0),renderedTriangles:t.reduce((e,t)=>e+t.renderedTriangles,0),levels:t}}async initializeRenderContext(e,t){this._context=e;const i=e.renderContext.rctx,r=await Promise.allSettled(this._symbol.levels.map(r=>(this._defaultRenderInstanceData.push(new $i(i,this._instanceBufferLayout)),this._highlightRenderInstanceData.push(new $i(i,this._instanceBufferLayout)),qi.create(e,r,t)))),n=r.map(e=>"fulfilled"===e.status?e.value:null).filter(e=>e);if(Object(a["n"])(t)||n.length!==r.length){n.forEach(e=>e.destroy()),Object(a["w"])(t);for(const e of r)if("rejected"===e.status)throw e.reason}this._levels=n,this._levelSelector=tr(this)}uninitializeRenderContext(){this.invalidateOctree(),this._levels.forEach(e=>e.destroy()),this._defaultRenderInstanceData.forEach(e=>e.destroy()),this._highlightRenderInstanceData.forEach(e=>e.destroy())}get slots(){return[3,5]}get needsHighlight(){return this._highlightRenderInstanceData.reduce((e,t)=>e+t.size,0)>0}prepareRender(e,t){if(X["a"].LOD_INSTANCE_RENDERER_DISABLE_UPDATES)return;if(this._enableLevelSelection){const e=t.equals(this._lastCamera);this._lastCamera.copyFrom(t),e||this.requestUpdateCycle()}const i=this._needFullCycle?this._instanceData.size:2e3;this._needFullCycle=!1,this.updateInstances(t,i),this.needsUpdates&&this._context.requestRender()}render(e){var t,i;const r=3===e.slot?2:5===e.slot?4:null;if(!r||!this.baseMaterial.isVisible()||!this.baseMaterial.isVisibleInPass(e.pass))return!1;const n=e.camera;this._inverseViewport[0]=1/n.fullViewport[2],this._inverseViewport[1]=1/n.fullViewport[3];const a={slot:r,origin:[0,0,0],camera:n,inverseViewport:this._inverseViewport,shadowMap:e.shadowMap,shadowMappingEnabled:e.shadowMap.enabled,ssaoHelper:e.ssaoHelper,ssaoEnabled:e.ssaoHelper.enabled,screenToWorldRatio:null,screenToPCSRatio:null,slicePlane:e.sliceHelper&&e.sliceHelper.plane,hudVisibilityTexture:e.offscreenRenderingHelper?e.offscreenRenderingHelper.hudVisibilityTexture:null,highlightDepthTexture:null!=(t=null==(i=e.offscreenRenderingHelper)?void 0:i.depthTexture)?t:null,hasOccludees:!1,linearDepthTexture:null,lastFrameColorTexture:null,reprojectionMatrix:M["a"],ssrEnabled:!1,lighting:e.scenelightingData,transparencyPassType:e.transparencyPassType,terrainLinearDepthTexture:e.multipassTerrainParams.terrainLinearDepthTexture,geometryLinearDepthTexture:e.multipassGeometryParams.geometryLinearDepthTexture,multipassTerrainEnabled:e.multipassTerrainParams.multipassTerrainEnabled,cullAboveGround:e.multipassTerrainParams.cullAboveGround,multipassGeometryEnabled:e.multipassGeometryParams.multipassGeometryEnabled,highlightColorTexture:null};e.rctx.bindVAO();const s=5!==e.pass&&7!==e.pass,o=6!==e.pass;return s&&this._renderComponents(e,r,a,this._defaultRenderInstanceData),o&&this._renderComponents(e,r,a,this._highlightRenderInstanceData),s||o}intersect(e,t,i,r){if(!this.baseMaterial.isVisible())return;const n=Object(h["f"])();Object(d["m"])(n,r,i);const a=n=>{this._instanceData.getCombinedModelTransform(n,or),e.transform.set(or),Object(d["t"])(cr,i,e.transform.inverse),Object(d["t"])(lr,r,e.transform.inverse);const a=this._instanceData.getState(n),s=this._instanceData.getLodLevel(n);Object(xi["a"])(a&fi.ACTIVE,"invalid instance state"),Object(xi["a"])(s>=0&&s<this._levels.length,"invaid lod level"),this._levels[s].intersect(e,t,cr,lr,n,this._metadata)};this.baseMaterial.parameters.verticalOffset?this.octree.forEach(a):this.octree.forEachAlongRay(i,n,a)}queryDepthRange(e){return this.queryDepthRangeOctree(e)}notifyShaderTransformationChanged(){this.invalidateOctree()}requestUpdateCycle(e=!1){this._updateCyclesWithStaticCamera=-1,e&&(this._needFullCycle=!0),this.needsUpdates&&this._context.requestRender()}get needsUpdates(){return this._instanceData.size>0&&this._updateCyclesWithStaticCamera<1}get octree(){return this._octree||(this._octree=this.buildOctree()),this._octree}invalidateOctree(){this._octree&&(this._octree.destroy(),this._octree=null)}buildOctree(){const e=new Li(this._instanceData,this.baseBoundingSphere),t=this._instanceData,i=t.view?t.view.state:null;for(let r=0;r<this._instanceData.capacity;++r)i.get(r)&fi.ACTIVE&&e.addInstance(r);return e}queryDepthRangeOctree(e){const t=e.eye,i=e.viewForward,r=this.octree.findClosest(i,1,e.frustum),n=this.octree.findClosest(i,-1,e.frustum);if(null!=r&&null!=n){this._instanceData.view.boundingSphere.getVec(r,sr),Object(d["m"])(sr,sr,t);const a=Object(d["k"])(sr,i)-sr[3];this._instanceData.view.boundingSphere.getVec(n,sr),Object(d["m"])(sr,sr,t);const s=Object(d["k"])(sr,i)+sr[3];return{near:Math.max(e.near,a),far:Math.min(e.far,s)}}return{near:1/0,far:-1/0}}startUpdateCycle(){this._updateCyclesWithStaticCamera++,this._defaultRenderInstanceData.forEach(e=>{e.startUpdateCylce()}),this._highlightRenderInstanceData.forEach(e=>{e.startUpdateCylce()}),this.needsUpdates&&this._context.requestRender()}updateInstances(e,t){const i=this._enableLevelSelection,r=this._levelSelector;r.updateCamera(e),this._defaultRenderInstanceData.forEach(e=>{e.beginUpdate()}),this._highlightRenderInstanceData.forEach(e=>{e.beginUpdate()});const n=this._instanceData,a=this._instanceData.view,s=n.size,o=n.capacity;let c=this._instanceIndex;t=Math.min(s,t);for(let l=0;l<t;++l){0===c&&this.startUpdateCycle();const e=a.state.get(c);let s=0;if(!(e&fi.ALLOCATED)){c=(c+1)%o,t++;continue}const l=a.lodLevel.get(c);if(e&fi.DEFAULT_ACTIVE&&this._defaultRenderInstanceData[l].freeTail(),e&fi.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[l].freeTail(),e&fi.REMOVE)n.freeInstance(c);else if(e&fi.VISIBLE){let t=0;i&&(a.modelOrigin.getVec(c,ar),t=r.selectLevel(ar,n.getCombinedMedianScaleFactor(c))),s=e&~(fi.ACTIVE|fi.TRANSFORM_CHANGED),t>=0&&(e&fi.HIGHLIGHT?(rr(this._highlightRenderInstanceData[t],a,c),s|=fi.HIGHLIGHT_ACTIVE):(rr(this._defaultRenderInstanceData[t],a,c),s|=fi.DEFAULT_ACTIVE)),a.state.set(c,s),a.lodLevel.set(c,t)}else s=e&~(fi.ACTIVE|fi.TRANSFORM_CHANGED),a.state.set(c,s);if(this._octree){const t=!!(e&fi.ACTIVE),i=!!(s&fi.ACTIVE);!t&&i?this._octree.addInstance(c):t&&!i?this._octree.removeInstance(c):t&&i&&e&fi.TRANSFORM_CHANGED&&(this._octree.removeInstance(c),this._octree.addInstance(c))}c=(c+1)%o}this._instanceIndex=c,this._defaultRenderInstanceData.forEach(e=>{e.endUpdate()}),this._highlightRenderInstanceData.forEach(e=>{e.endUpdate()})}_renderComponents(e,t,i,r){this.levels.forEach((n,a)=>{n.components.forEach(n=>{this._renderComponent(e,t,i,r[a],n,a)})})}_renderComponent(e,t,i,r,a,s){if(0===r.size||!a.material.requiresSlot(t))return;const{rctx:o,pass:c}=e,l=a.glMaterials.load(o,c);if(Object(n["k"])(l))return;const d=o.capabilities.instancing,h=l.beginSlot(i),u=h.program;h.bindPipelineState(o,t),o.useProgram(u),l.bind(i,h),o.bindVAO(a.vao),h.ensureAttributeLocations(a.vao),e.isHighlightPass&&Object(yi["b"])(u,i),h.bindDraw(i),X["a"].LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&0===e.pass&&(u.setUniform4fv("externalColor",dr[Math.min(s,dr.length-1)]),u.setUniform1i("colorMixMode",Ki["b"].replace));const p=r.capacity,f=r.headIndex,b=r.tailIndex,m=r.firstIndex,g=this._glInstanceBufferLayout,v=(e,t)=>{Object(er["a"])(o,_i["a"],r.buffer,g,e),d.drawArraysInstanced(h.primitiveType,0,a.vertexCount,t-e),Object(er["d"])(o,_i["a"],r.buffer,g)};a.material.parameters.transparent&&null!=m?f>b?(Object(xi["a"])(m>=b&&m<=f,"invalid firstIndex"),v(m,f),v(b,m)):f<b&&(m<=f?(Object(xi["a"])(m>=0&&m<=f,"invalid firstIndex"),v(m,f),v(b,p),v(0,m)):(Object(xi["a"])(m>=b&&m<=p,"invalid firstIndex"),v(m,p),v(0,f),v(b,m))):f>b?v(b,f):f<b&&(v(0,f),v(b,p)),o.bindVAO(null)}}function rr(e,t,i){const r=e.allocateHead();nr(t,i,e.view,r)}function nr(e,t,i,r){Object(Ji["c"])(e.modelOrigin,t,i.modelOriginHi,i.modelOriginLo,r),i.model.copyFrom(r,e.model,t),i.modelNormal.copyFrom(r,e.modelNormal,t),e.color&&i.color&&i.color.copyFrom(r,e.color,t),e.featureAttribute&&i.featureAttribute&&i.featureAttribute.copyFrom(r,e.featureAttribute,t)}const ar=Object(h["f"])(),sr=Object(Te["e"])(),or=Object(M["d"])(),cr=Object(h["f"])(),lr=Object(h["f"])(),dr=[[1,0,1,1],[0,0,1,1],[0,1,0,1],[1,1,0,1],[1,0,0,1]];class hr extends z["a"]{constructor(e,t,i,r){super(e,t,i,r),this._resources=null,this._optionalFields=new Array,this._instanceIndexToGraphicUid=new Map,this.hasLoadedPBRTextures=!1,this.ensureDrapedStatus(!1),this.hasLoadedPBRTextures=i.physicalBasedRenderingEnabled}getCachedSize(){const[e,t,i]=Object(n["l"])(this._resources)?this._resources.symbolSize:[1,1,1];return{width:e,depth:t,height:i}}async doLoad(e){if(!this._drivenProperties.size&&Object(L["k"])(this.symbolLayer))throw new Error;const t=this.symbolLayer;if(this.isPrimitive){const i=t.resource?t.resource.primitive:Jt["b"];this._resources=await this._createResourcesForPrimitive(i,e)}else this._resources=await this._createResourcesForUrl(t.resource.href,e);this.layerOpacityChanged(),this.slicePlaneEnabledChanged(),this.physicalBasedRenderingChanged(),this.complexity=this.computeComplexity()}get extentPadding(){return Object(n["l"])(this._resources)?this._resources.extentPadding:0}get isPrimitive(){return!(this.symbolLayer.resource&&this.symbolLayer.resource.href)}get lodRenderer(){return Object(n["j"])(this._resources,"lodRenderer")}setMaterialTransparencyParams(e,t=Object(n["j"])(this.symbolLayer,"material","color")){const i=this._getCombinedOpacity(t),r=i<1||this.needsDrivenTransparentPass;return e.transparent=r,e.opacity=i,e.cullFace=r?0:2,e}async _createResourcesForPrimitive(e,t){if(!Object(mi["a"])(e))throw new Error("Unknown object symbol primitive: "+e);const i=this.symbolLayer,r=Object(f["h"])(Object(ei["c"])(e)),a=Object(h["g"])(Object(f["F"])(r)),s=Object(h["g"])(Object(ei["d"])(a,i)),o=Object(d["s"])(s),c=!1,l=!1,u={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,instanced:["transformation"],ambient:h["a"],diffuse:h["a"],slicePlaneEnabled:this._context.slicePlaneEnabled,sliceHighlightDisabled:!0,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!this.symbolLayer.isPrimitive},p=u.usePBR;this.setMaterialTransparencyParams(u);const b=this.symbol;if("point-3d"===b.type&&b.verticalOffset){const{screenLength:e,minWorldLength:t,maxWorldLength:i}=b.verticalOffset;u.verticalOffset={screenLength:Object(je["h"])(e),minWorldLength:t||0,maxWorldLength:null!=i?i:1/0},u.castShadows=!1}if(this._context.screenSizePerspectiveEnabled&&(u.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),this._drivenProperties.color)u.externalColor=Te["a"];else{const e=Object(n["l"])(i.material)&&i.material.color,t=Object(n["l"])(e)?_e["a"].toUnitRGBA(e):Te["a"];u.externalColor=t}this._fastUpdates=at(this._context.renderer,this._fastVisualVariableConvertOptions(r,s,a,n["q"])),this._fastUpdates.enabled?(Object.assign(u,this._fastUpdates.materialParameters),u.instanced.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(u.instanced.push("color"),this._optionalFields.push("color"));const m=new J["a"](u),g=Object(mi["b"])(e,m);if(!g)throw new Error("Unknown object symbol primitive: "+e);const v=Object(ci["d"])(g).map(e=>({opacity:1,transparent:e.parameters.transparent})),y=await this._createStageResources(g,p);return{lodResources:g,lodRenderer:await this._createLodRenderer(g,t),stageResources:y,symbolSize:s,extentPadding:o,isEsriSymbolResource:c,isWosr:l,originalMaterialParameters:v,physicalBasedRenderingEnabled:p,resourceBoundingBox:r,resourceSize:a,dispose:n["q"],pivotOffset:n["q"]}}async _createResourcesForUrl(e,t){const i=["transformation"],r={materialParamsMixin:{instanced:i,slicePlaneEnabled:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows},streamDataRequester:this._context.streamDataRequester,cache:this._context.sharedResources.objectResourceCache};this._fastUpdates=at(this._context.renderer,this._fastVisualVariableConvertOptions(n["q"],n["q"],n["q"],n["q"])),this._fastUpdates.enabled?(Object.assign(r.materialParamsMixin,this._fastUpdates.materialParameters),i.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(i.push("color"),this._optionalFields.push("color"));const a=this.symbol;if("point-3d"===a.type&&a.verticalOffset){const{screenLength:e,minWorldLength:t,maxWorldLength:i}=a.verticalOffset;r.materialParamsMixin.verticalOffset={screenLength:Object(je["h"])(e),minWorldLength:t||0,maxWorldLength:null!=i?i:1/0},r.materialParamsMixin.castShadows=!1}r.signal=t,r.usePBR=this._context.physicalBasedRenderingEnabled;const s=r.usePBR,o=await Object(bi["fetch"])(e,r),c=o.isEsriSymbolResource,l=o.isWosr,u=o.remove,p=di(o.lods);ui(p),p.levels.sort((e,t)=>e.minScreenSpaceRadius-t.minScreenSpaceRadius),p.levels[0].minScreenSpaceRadius=Math.min(2,p.levels[0].minScreenSpaceRadius);const b=this._context,m=this.symbolLayer.material,g=this._getExternalColorParameters(m),v=Object(n["j"])(this.symbolLayer,"material","color"),y=this._getCombinedOpacity(v,{hasIntrinsicColor:!0}),O=this.needsDrivenTransparentPass,_=Object(ci["d"])(p),x=Object(ci["d"])(p).map(e=>({opacity:e.parameters.opacity||1,transparent:e.parameters.transparent}));_.forEach(e=>{const t=e.parameters;e.setParameters(g);const i=t.opacity*y,r=i<1||O||t.transparent;e.setParameters({opacity:i,transparent:r}),b.screenSizePerspectiveEnabled&&e.setParameters({screenSizePerspective:b.sharedResources.screenSizePerspectiveSettings})});const j=o.referenceBoundingBox,w=Object(h["g"])(Object(f["F"])(j)),S=Object(h["g"])(p.levels[0].pivotOffset),T=Object(h["g"])(Object(ei["d"])(w,this.symbolLayer)),C=Object(d["s"])(T);st(this._fastUpdates,this._context.renderer,this._fastVisualVariableConvertOptions(j,T,w,S))&&_.forEach(e=>e.setParameters(this._fastUpdates.materialParameters));const P=await this._createStageResources(p,s);return{lodResources:p,lodRenderer:await this._createLodRenderer(p,t),stageResources:P,symbolSize:T,extentPadding:C,isEsriSymbolResource:c,isWosr:l,originalMaterialParameters:x,physicalBasedRenderingEnabled:s,resourceBoundingBox:j,resourceSize:w,dispose:u,pivotOffset:S}}async _createStageResources(e,t){const i=this._context.stage,r=Object(ci["d"])(e);t!==this._context.physicalBasedRenderingEnabled&&this.physicalBasedRenderingChanged(),i.addMany(r);const n=Object(ci["e"])(e);i.addMany(n),await i.load(n);const a=Object(ci["c"])(e);return i.addMany(a),{materials:r,textures:n,geometries:a}}async _createLodRenderer(e,t){const i=this._context.stage,r={layerUid:this._context.layer.uid,graphicUid:e=>this._instanceIndexToGraphicUid.get(e),notifyGraphicGeometryChanged:e=>this._context.notifyGraphicGeometryChanged(this._instanceIndexToGraphicUid.get(e)),notifyGraphicVisibilityChanged:e=>this._context.notifyGraphicVisibilityChanged(this._instanceIndexToGraphicUid.get(e))},n=this._fastUpdates.enabled?{applyTransform:(e,t,i)=>{e.getFeatureAttribute(t,br),Object(A["d"])(i,dt(this._fastUpdates.materialParameters,br,i))},scaleFactor:(e,t,i)=>(t.getFeatureAttribute(i,br),ht(e,this._fastUpdates.materialParameters,br))}:null,a=new ir(e,this._optionalFields,r,n);return a.slicePlaneEnabled=this._context.slicePlaneEnabled,await i.addRenderPlugin(a.slots,a,t),a}_getExternalColorParameters(e){const t={};return this._drivenProperties.color?t.externalColor=Te["a"]:Object(n["l"])(e)&&Object(n["l"])(e.color)?t.externalColor=_e["a"].toUnitRGBA(e.color):(t.externalColor=Te["a"],t.colorMixMode="ignore"),t}destroy(){if(super.destroy(),Object(n["l"])(this._resources)){const e=this._context.stage;e.removeRenderPlugin(this._resources.lodRenderer);const t=this._resources.stageResources;e.removeMany(t.materials),e.removeMany(t.textures),e.removeMany(t.geometries),Object(n["l"])(this._resources.dispose)&&this._resources.dispose(),this._resources=null}}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry))return null;const i=Object(Ve["d"])(t.geometry);if(Object(n["k"])(i))return this.logger.warn("unsupported geometry type for icon symbol: "+t.geometry.type),null;const r=this.setGraphicElevationContext(t,new F["a"]),a=e.renderingInfo;return this._createAs3DShape(t,i,a,r,t.uid)}notifyDestroyGraphicLayer(e){this._instanceIndexToGraphicUid.delete(e.instanceIndex)}graphicLayerToGraphicId(){return 0}layerOpacityChanged(){if(Object(n["k"])(this._resources))return!0;const e=this._drivenProperties.opacity,t=!this.isPrimitive,i=this._resources.stageResources.materials,r=this._resources.originalMaterialParameters;for(let a=0;a<i.length;a++){const s=i[a],o=Object(n["j"])(this.symbolLayer,"material","color"),c=r[a],l=this._getCombinedOpacity(o,{hasIntrinsicColor:t})*c.opacity,d=l<1||e||c.transparent;s.setParameters({opacity:l,transparent:d}),this.isPrimitive&&s.setParameters({cullFace:d?0:2})}return!0}layerElevationInfoChanged(e,t){return this.updateGraphics3DGraphicElevationInfo(e,t,I["i"])}slicePlaneEnabledChanged(){if(Object(n["k"])(this._resources))return!0;this._resources.lodRenderer.slicePlaneEnabled=this._context.slicePlaneEnabled;for(const e of this._resources.stageResources.materials)e.setParameters({slicePlaneEnabled:this._context.slicePlaneEnabled});return!0}physicalBasedRenderingChanged(){if(Object(n["k"])(this._resources))return!0;const{stageResources:e,isWosr:t}=this._resources;for(const i of e.materials)this.isPrimitive?i.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}):t||i.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!1});return!1!==this.hasLoadedPBRTextures||!0!==this._context.physicalBasedRenderingEnabled||(this.hasLoadedPBRTextures=!0,!1)}pixelRatioChanged(){return!0}applyRendererDiff(e,t){if(Object(n["k"])(this._resources))return 0;const{stageResources:{materials:i},lodRenderer:r,resourceBoundingBox:a,symbolSize:s,resourceSize:o,pivotOffset:c}=this._resources;for(const n in e.diff){if("visualVariables"!==n)return 0;if(!st(this._fastUpdates,t,this._fastVisualVariableConvertOptions(a,s,o,c)))return 0;for(const e of i)e.setParameters(this._fastUpdates.materialParameters);r.notifyShaderTransformationChanged()}return 2}computeComplexity(){return Object(n["k"])(this._resources)?super.computeComplexity():{primitivesPerFeature:Object(ci["b"])(this._resources.lodResources.levels[0]).reduce((e,t)=>e+t.indices.get("position").length,0)/3,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:Object(gi["d"])(this.symbol,this.symbolLayer)}}hasLodRenderer(){return Object(n["l"])(this._resources)}_createAs3DShape(e,t,i,r,a){if(!this.hasLodRenderer()||Object(n["k"])(this._resources))return null;const s=this.getFastUpdateAttrValues(e),o=!this._fastUpdates.enabled&&this._hasPerInstanceColor()?Object(L["g"])(i.color,i.opacity):null,c=this._context.clippingExtent;if(Object(p["t"])(t,ur,this._context.elevationProvider.spatialReference),Object(n["l"])(c)&&!Object(f["g"])(c,ur))return null;const l=this._requiresTerrainElevation(r),d=this._computeGlobalTransform(t,r,fr,mr),h=this._computeLocalTransform(this._resources,this.symbolLayer,i,pr),u=this._resources.lodRenderer.instanceData,b=u.addInstance();this._instanceIndexToGraphicUid.set(b,a),u.setLocalTransform(b,h,!1),u.setGlobalTransform(b,d),s&&u.setFeatureAttribute(b,s),o&&u.setColor(b,o);const m=new ii(this,b,Ee["a"],r);return l&&(m.alignedSampledElevation=mr.sampledElevation),m.needsElevationUpdates=Object(I["i"])(r.mode),Object(Ve["b"])(m,t,this._context.elevationProvider),m}_computeGlobalTransform(e,t,i,r){return Object(I["g"])(e,this._context.elevationProvider,t,this._context.renderCoordsHelper,r),ur[0]=e.x,ur[1]=e.y,ur[2]=r.z,Object(p["d"])(e.spatialReference,ur,i,this._context.renderCoordsHelper.spatialReference),i}_computeLocalTransform(e,t,i,r){return Object(A["j"])(r),this._applyObjectRotation(i,!1,r),this._applyObjectRotation(t,!0,r),this._applyObjectScale(e,i,r),this._applyAnchor(e,t,r),r}_applyObjectScale(e,t,i){if(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation)return;const r=this._drivenProperties.size&&t.size?t.size:e.symbolSize,n=Object(L["c"])(r,e.symbolSize,e.resourceSize,this._context.renderCoordsHelper.unitInMeters);1===n[0]&&1===n[1]&&1===n[2]||Object(A["g"])(i,i,n)}prepareSymbolLayerPatch(e){if("partial"!==e.diff.type)return;const t=e.diff.diff;this._preparePatchTransform(e,t),this._preparePatchColor(e,t)}updateGeometry(e,t){if(Object(n["k"])(this._resources))return!0;const i=t&&Object(Ve["d"])(t);if(Object(n["k"])(i))return!1;const r=this.getGeometryElevationMode(t);return e.elevationContext.mode===r&&(this._computeGlobalTransform(i,e.elevationContext,fr,mr),this._requiresTerrainElevation(e.elevationContext)&&(e.alignedSampledElevation=mr.sampledElevation),this._resources.lodRenderer.instanceData.setGlobalTransform(e.instanceIndex,fr,!0),Object(Ve["b"])(e,i,this._context.elevationProvider),!0)}_preparePatchTransform(e,t){if(!(t.heading||t.tilt||t.roll||t.width||t.height||t.depth||t.anchor||t.anchorPosition))return;if(Object(n["k"])(this._resources))return;const i=(e,t,i)=>Object(n["v"])(null!=e&&"complete"===e.type?e.newValue:t,i),r=i(t.heading,this.symbolLayer.heading,0),a=i(t.tilt,this.symbolLayer.tilt,0),s=i(t.roll,this.symbolLayer.roll,0),o=i(t.width,this.symbolLayer.width,void 0),c=i(t.height,this.symbolLayer.height,void 0),l=i(t.depth,this.symbolLayer.depth,void 0),d=i(t.anchor,this.symbolLayer.anchor,void 0),u=i(t.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete t.heading,delete t.tilt,delete t.roll,delete t.width,delete t.height,delete t.depth,delete t.anchor,delete t.anchorPosition;const p={heading:r,tilt:a,roll:s,anchor:d,anchorPosition:u},f=this._resources;1===this.loadStatus&&e.symbolLayerStatePatches.push(()=>{f.symbolSize=Object(h["g"])(Object(ei["d"])(f.resourceSize,{width:o,height:c,depth:l,isPrimitive:this.symbolLayer.isPrimitive}))}),e.graphics3DGraphicPatches.push((e,t)=>{const i=this._computeLocalTransform(f,p,t,pr),r=e.instanceIndex;f.lodRenderer.instanceData.setLocalTransform(r,i,!0)})}_preparePatchColor(e,t){if(!t.material||"partial"!==t.material.type)return;const i=t.material.diff;if(!i.color||"complete"!==i.color.type||null==i.color.newValue||null==i.color.oldValue)return;const r=i.color.newValue,a=Object(n["l"])(r)?_e["a"].toUnitRGBA(r):Te["a"];delete i.color;const s=this._resources;Object(n["k"])(s)||e.graphics3DGraphicPatches.push(e=>{let t;this._hasPerInstanceColor()?(s.lodRenderer.instanceData.setColor(e.instanceIndex,a),t=this.setMaterialTransparencyParams({},r)):t=this.setMaterialTransparencyParams({externalColor:a},r);for(const i of s.stageResources.materials)i.setParameters(t)})}_requiresTerrainElevation(e){return"absolute-height"!==e.mode}_applyObjectRotation(e,t,i){if(!(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation&&t))return Object(L["b"])(e.heading,e.tilt,e.roll,i)}_computeAnchor(e,t,i){const r=Object(h["f"])();switch(i.anchor){case"center":Object(d["n"])(r,Object(f["e"])(e)),Object(d["v"])(r,r);break;case"top":{const t=Object(f["e"])(e);Object(d["z"])(r,-t[0],-t[1],-e[5]);break}case"bottom":{const t=Object(f["e"])(e);Object(d["z"])(r,-t[0],-t[1],-e[2]);break}case"relative":{const t=Object(f["e"])(e),n=Object(f["F"])(e),a=i.anchorPosition,s=a?Object(h["h"])(a.x,a.y,a.z):h["c"];Object(d["d"])(r,n,s),Object(d["i"])(r,r,t),Object(d["v"])(r,r);break}default:Object(n["l"])(t)?Object(d["v"])(r,t):Object(d["n"])(r,h["c"])}return r}_applyAnchor(e,t,i){if(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation)return;const r=this._computeAnchor(e.resourceBoundingBox,e.pivotOffset,t);r&&Object(A["b"])(i,i,r)}_hasPerInstanceColor(){return this._drivenProperties.color||this._drivenProperties.opacity}_fastVisualVariableConvertOptions(e,t,i,r){const a=Object(n["l"])(e)?Object(h["g"])(Object(f["F"])(e)):h["a"],s=Object(n["l"])(e)?this._computeAnchor(e,r,this.symbolLayer):h["c"],o=this._context.renderCoordsHelper.unitInMeters,c=Object(L["c"])(Object(n["l"])(t)?t:void 0,t,i,o),l=Object(h["h"])(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||0);return{modelSize:a,symbolSize:Object(n["l"])(t)?t:h["a"],unitInMeters:o,transformation:{anchor:s,scale:c,rotation:l}}}}const ur=Object(h["f"])(),pr=Object(M["d"])(),fr=Object(M["d"])(),br=Object(Te["e"])(),mr=new I["a"];var gr=i("4212");function vr(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function yr(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e}function Or(e,t,i,r,n){return e[0]=t,e[1]=i,e[2]=r,e[3]=n,e}function _r(e,t){if(e===t){const i=t[1];e[1]=t[2],e[2]=i}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e}function xr(e,t){const i=t[0],r=t[1],n=t[2],a=t[3];let s=i*a-n*r;return s?(s=1/s,e[0]=a*s,e[1]=-r*s,e[2]=-n*s,e[3]=i*s,e):null}function jr(e,t){const i=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=i,e}function wr(e){return e[0]*e[3]-e[2]*e[1]}function Sr(e,t,i){const r=t[0],n=t[1],a=t[2],s=t[3],o=i[0],c=i[1],l=i[2],d=i[3];return e[0]=r*o+a*c,e[1]=n*o+s*c,e[2]=r*l+a*d,e[3]=n*l+s*d,e}function Tr(e,t,i){const r=t[0],n=t[1],a=t[2],s=t[3],o=Math.sin(i),c=Math.cos(i);return e[0]=r*c+a*o,e[1]=n*c+s*o,e[2]=r*-o+a*c,e[3]=n*-o+s*c,e}function Cr(e,t,i){const r=t[0],n=t[1],a=t[2],s=t[3],o=i[0],c=i[1];return e[0]=r*o,e[1]=n*o,e[2]=a*c,e[3]=s*c,e}function Pr(e,t){const i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=-i,e[3]=r,e}function Ar(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e}function Mr(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function Rr(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2)}function Er(e,t,i,r){return e[2]=r[2]/r[0],i[0]=r[0],i[1]=r[1],i[3]=r[3]-e[2]*i[1],[e,t,i]}function Dr(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e}function Ir(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e}function Fr(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function zr(e,t){const i=e[0],r=e[1],n=e[2],a=e[3],s=t[0],o=t[1],c=t[2],l=t[3];return Math.abs(i-s)<=gr["a"]*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(r-o)<=gr["a"]*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(n-c)<=gr["a"]*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(a-l)<=gr["a"]*Math.max(1,Math.abs(a),Math.abs(l))}function Lr(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e}function Vr(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e}const kr=Sr,Ur=Ir;Object.freeze({__proto__:null,copy:vr,identity:yr,set:Or,transpose:_r,invert:xr,adjoint:jr,determinant:wr,multiply:Sr,rotate:Tr,scale:Cr,fromRotation:Pr,fromScaling:Ar,str:Mr,frob:Rr,LDU:Er,add:Dr,subtract:Ir,exactEquals:Fr,equals:zr,multiplyScalar:Lr,multiplyScalarAndAdd:Vr,mul:kr,sub:Ur});var Br=i("47f8");class Nr extends U["a"]{constructor(e,t,i,r,n,a){super(e,t),this.path=i,this.geometrySR=r,this.upVectorAlignment=n,this.stencilWidth=a}}function Gr(e){return"upVectorAlignment"in e}function qr(){return[1,0,0,1]}function Hr(e){return[e[0],e[1],e[2],e[3]]}function Wr(e,t,i,r){return[e,t,i,r]}function $r(e,t){return new Float64Array(e,t,4)}Object.freeze({__proto__:null,create:qr,clone:Hr,fromValues:Wr,createView:$r});var Zr=i("7289"),Qr=i("d18f");function Xr(){return{up:Object(h["f"])(),right:Object(h["f"])()}}function Yr(e,t,i){Object(d["t"])(e.up,t.up,i),Object(d["t"])(e.right,t.right,i)}function Kr(e,t,i){Object(c["s"])(e,Object(d["k"])(i,t.right),Object(d["k"])(i,t.up))}class Jr{constructor(){this.pos=Object(h["f"])(),this.posES=Object(h["f"])(),this.posGS=Object(h["f"])(),this.vRight=Object(h["f"])(),this.vLeft=Object(h["f"])(),this.frame=Xr(),this.rotationFrame=Xr(),this.rotationRight=Object(l["b"])(),this.rotationAngle=0,this.miterStretch=qr()}setFrameFromUpVector(e){Object(d["n"])(this.frame.up,e),Object(d["i"])(On,this.vLeft,this.vRight),Object(d["u"])(On,On),Object(d["h"])(yn,this.frame.up,Object(d["k"])(On,this.frame.up)),Object(d["m"])(jn,On,yn),Object(d["u"])(jn,jn),Object(d["j"])(this.frame.right,jn,this.frame.up)}computeRotationAxisAndAngleFromUpVector(){Object(d["n"])(this.rotationFrame.up,this.frame.up),Object(d["n"])(this.rotationFrame.right,this.frame.right),Object(c["s"])(this.rotationRight,1,0),Object(d["h"])(yn,this.frame.up,Object(d["k"])(this.frame.up,this.vLeft)),Object(d["m"])(yn,this.vLeft,yn),Object(d["v"])(yn,yn),Object(d["u"])(yn,yn),Object(d["h"])(On,this.frame.up,Object(d["k"])(this.frame.up,this.vRight)),Object(d["m"])(On,this.vRight,On),Object(d["u"])(On,On),Object(d["j"])(_n,this.rotationFrame.up,this.vLeft);const e=Math.sign(Object(d["k"])(_n,this.vRight));if(this.rotationAngle=e*(Math.PI-Object(Ue["b"])(Object(d["k"])(yn,On))),Math.abs(this.rotationAngle)>0){const e=Object(Ue["q"])(Math.cos(.5*this.rotationAngle));Or(this.miterStretch,e-1+1,0,0,1)}const t=Math.PI-this.rotationAngle;this.maxStretchDistance=Math.abs(Math.min(this.vLeftLength,this.vRightLength)/Math.cos(.5*t))}}class en{constructor(){this.vertices=[],this.vertexIndices=[],this.vertexNormals=[],this.poles=[],this.poleIndices=[],this.uvs=null,this.uvIndices=null}addVertex(e,t){return this.vertices.push(Object(l["c"])(e)),this.vertexNormals.push(Object(l["c"])(t)),this.vertices.length-1}addUV(e){return this.uvs||(this.uvs=[],this.uvIndices=[]),this.uvs.push(e),this.uvs.length-1}addPole(e,t=null){return this.poles.push({position:Object(l["c"])(e),normal:t?Object(l["c"])(t):null}),this.poles.length-1}addSegment(e,t=null,i=null){this.vertexIndices.push(e.v0),this.vertexIndices.push(e.v1),t&&(this.uvIndices.push(t.v0),this.uvIndices.push(t.v1)),i&&(this.poleIndices.push(i.v0),this.poleIndices.push(i.v1))}get numSegments(){return this.vertexIndices.length/2}hasUV(){return null!=this.uvs}translate(e,t){for(const i of this.vertices)i[0]+=e,i[1]+=t;for(const i of this.poles)i.position[0]+=e,i.position[1]+=t}static circle(e=20){const t=.5,i=new en,r={v0:0,v1:0};i.addPole(Object(l["f"])(0,0));for(let s=0;s<e;++s){const r=2*s*Math.PI/e,n=Math.cos(r),a=Math.sin(r),o=Object(l["f"])(n*t,a*t),c=Object(l["f"])(n,a);i.addVertex(o,c),i.addUV(s/e)}i.addUV(1);for(let s=0;s<e-1;++s){const e={v0:s,v1:s+1},t=e;i.addSegment(e,t,r)}const n={v0:e-1,v1:0},a={v0:e-1,v1:e};return i.addSegment(n,a,r),i}static rect(){const e=1,t=1,i=new en,r=Object(l["f"])(.5*-e,.5*-t),n=Object(l["f"])(.5*e,.5*-t),a=Object(l["f"])(.5*e,.5*t),s=Object(l["f"])(.5*-e,.5*t),o=Object(l["f"])(0,-1),c=Object(l["f"])(1,0),d=Object(l["f"])(0,1),h=Object(l["f"])(-1,0);i.addUV(0),i.addUV(1),i.addPole(Object(l["f"])(0,.5*t),d),i.addPole(Object(l["f"])(0,.5*t)),i.addPole(Object(l["f"])(0,.5*-t)),i.addPole(Object(l["f"])(0,.5*-t),o);const u={v0:0,v1:1};return i.addVertex(r,o),i.addVertex(n,o),i.addSegment({v0:0,v1:1},u,{v0:3,v1:3}),i.addVertex(n,c),i.addVertex(a,c),i.addSegment({v0:2,v1:3},u,{v0:2,v1:1}),i.addVertex(a,d),i.addVertex(s,d),i.addSegment({v0:4,v1:5},u,{v0:0,v1:0}),i.addVertex(s,h),i.addVertex(r,h),i.addSegment({v0:6,v1:7},u,{v0:1,v1:2}),i}}class tn{constructor(e){this.vertices=[],this.offset=Object(h["f"])(),this.xform=Object(M["d"])(),this.vertices=e;const t=Math.floor((e.length-1)/2);Object(d["n"])(this.offset,this.vertices[t].pos);for(const i of this.vertices)Object(d["m"])(i.pos,i.pos,this.offset);Object(A["b"])(this.xform,this.xform,this.offset),this.updatePathVertexInformation()}updatePathVertexInformation(){const e=this.vertices.length;let t=this.vertices[0];t.index=0,Object(d["z"])(t.vLeft,0,0,0),t.vLeftLength=0,Object(d["m"])(t.vRight,this.vertices[1].pos,t.pos),t.vRightLength=Object(d["s"])(t.vRight),Object(d["u"])(t.vRight,t.vRight);let i=t;for(let r=1;r<e;++r)t=this.vertices[r],t.index=r,Object(d["n"])(t.vLeft,i.vRight),t.vLeftLength=i.vRightLength,r<e-1?(Object(d["m"])(t.vRight,this.vertices[r+1].pos,t.pos),t.vRightLength=Object(d["s"])(t.vRight),Object(d["u"])(t.vRight,t.vRight)):(Object(d["n"])(t.vRight,t.vLeft),t.vRightLength=t.vLeftLength),i=t}}function rn(e,t){let i=null;const r=e.vertices.length,n=.99619469809,a=Object(h["f"])(),s=Object(h["f"])(),o=Object(h["f"])(),c=Object(h["f"])(),l=Object(h["f"])(),u=Object(h["f"])(),p=Object(Zr["d"])();let f=e.vertices[0];Object(d["n"])(s,t),Object(d["z"])(a,0,1,0),ut["a"].makeOrthoBasisDirUpFallback(f.vRight,s,a,a,o,s,n),Object(d["n"])(f.frame.up,s),Object(d["n"])(f.frame.right,o),i=f;for(let h=1;h<r;++h){f=e.vertices[h],Object(d["i"])(l,f.vLeft,f.vRight);let t=Object(d["s"])(l);t>0?(t=1/Math.sqrt(t),l[0]=l[0]*t,l[1]=l[1]*t,l[2]=l[2]*t):(l[0]=f.vRight[0],l[1]=f.vRight[1],l[2]=f.vRight[2]),Object(d["i"])(u,i.pos,i.frame.up),Object(Zr["h"])(f.pos,l,p),Object(Zr["n"])(p,Object(Qr["h"])(u,f.vLeft),c)?(Object(d["m"])(c,c,f.pos),Object(d["u"])(s,c),Object(d["j"])(o,l,s),Object(d["u"])(o,o)):ut["a"].makeOrthoBasisDirUpFallback(l,i.frame.up,i.frame.right,a,o,s,n),Object(d["n"])(f.frame.up,s),Object(d["n"])(f.frame.right,o),i=f}}class nn{numProfilesPerJoin(){return 1}extrude(e,t,i){for(let r=0;r<t.vertices.length;++r)i(e.index,e.frame,t.vertices[r],t.vertexNormals[r],!1)}}class an{constructor(e=.8*Math.PI,t=1){this.cutoffAngle=e,this.numBendSubdivisions=t}numProfilesPerJoin(){return this.numBendSubdivisions+1}extrude(e,t,i){const r=wn;if(Math.abs(e.rotationAngle)>=this.cutoffAngle)for(let n=0;n<this.numBendSubdivisions+1;++n){Object(A["j"])(Sn),Object(A["f"])(Sn,Sn,.5*-e.rotationAngle+n*e.rotationAngle/this.numBendSubdivisions,e.rotationFrame.up),Yr(r,e.frame,Sn);for(let n=0;n<t.vertices.length;++n)Object(c["k"])(t.vertices[n],e.rotationRight)*e.rotationAngle>=0?i(e.index,r,t.vertices[n],t.vertexNormals[n],!1):(Object(c["p"])(mn,t.vertices[n],e.miterStretch),i(e.index,e.frame,mn,t.vertexNormals[n],!0))}else for(let n=0;n<this.numBendSubdivisions+1;++n)for(let r=0;r<t.vertices.length;++r){const n=Object(c["k"])(t.vertices[r],e.rotationRight)*e.rotationAngle>=0;Object(c["p"])(mn,t.vertices[r],e.miterStretch),i(e.index,e.frame,mn,t.vertexNormals[r],!n)}}}const sn={generateUV:!1};class on{rebuildConnectingProfileGeometry(e,t,i){for(let r=0;r<t.vertices.length;++r)i(e.index,e.frame,t.vertices[r],t.vertexNormals[r],0,0)}}class cn extends on{constructor(){super()}getNumVertices(){return 0}getNumIndices(){return 0}rebuildCapGeometry(){}buildTopology(){}}class ln extends on{constructor(e,t=0,i=!1){super(),this.profile=e,this.profilePlaneOffset=t,this.flip=i}getNumVertices(){return this.profile.vertices.length}getNumIndices(){return 3*this.profile.numSegments}rebuildConnectingProfileGeometry(e,t,i){for(let r=0;r<t.vertices.length;++r)i(e.index,e.frame,t.vertices[r],t.vertexNormals[r],this.profilePlaneOffset,0)}rebuildCapGeometry(e,t){const i=gn;Object(c["s"])(i,0,0);const r=this.flip?1:-1;for(let n=0;n<this.profile.vertices.length;++n)t(e.index,e.frame,this.profile.vertices[n],i,this.profilePlaneOffset,r)}buildTopology(e,t){const i=this.vertexBufferStart+this.profile.vertexIndices[0];for(let r=1;r<this.profile.numSegments;++r){const e=this.profile.vertexIndices[2*r+0],n=this.profile.vertexIndices[2*r+1],a=this.vertexBufferStart+e,s=this.vertexBufferStart+n;this.flip?t(s,a,i):t(i,a,s)}}}class dn extends on{constructor(e){super(),this.flip=!1,this.sign=0,this.breakNormals=!1,this.numSegments=3,this.profile=e.profile,this.flip=e.flip,this.sign=this.flip?1:-1,this.breakNormals=e.breakNormals,this.numSegments=e.subdivisions}getNumVertices(){let e=0;return e=this.profile.vertices.length*(this.numSegments-1),this.breakNormals&&(e+=this.profile.vertices.length),e+=this.profile.poles.length,e}getNumIndices(){let e=0;e+=2*this.profile.numSegments*(this.numSegments-1);for(let t=0;t<this.profile.numSegments;++t){const i=this.profile.vertexIndices[2*t+0],r=this.profile.vertexIndices[2*t+1];this.profile.poleIndices[i]===this.profile.poleIndices[r]?e+=1:e+=2}return 3*e}rebuildCapGeometry(e,t){const i=e.frame,r=.5*this.sign,n=mn,a=gn;Object(c["s"])(a,0,0);for(let s=0;s<this.profile.poles.length;++s){const n=this.profile.poles[s];n.normal?t(e.index,i,n.position,n.normal,r,0):t(e.index,i,n.position,a,r,this.sign)}if(this.breakNormals)for(let s=0;s<this.profile.vertices.length;++s)t(e.index,i,this.profile.vertices[s],this.profile.vertexNormals[s],0,0);for(let s=0;s<this.numSegments-1;++s){const o=(1-(s+1)/this.numSegments)*Math.PI*.5,l=Math.sin(o),d=Math.cos(o);for(let s=0;s<this.profile.vertices.length;++s){const o=this.profile.poles[this.profile.poleIndices[s]];Object(c["f"])(n,this.profile.vertices[s],o.position),Object(c["g"])(n,n,l),o.normal?(Object(c["m"])(n,n,o.position),t(e.index,i,n,o.normal,r*d,0)):(Object(c["i"])(a,n),Object(c["g"])(a,a,l),Object(c["m"])(n,n,o.position),t(e.index,i,n,a,r*d,this.sign*d))}}}buildTopology(e,t){const i=this.breakNormals?this.vertexBufferStart+this.profile.poles.length:this.firstProfileVertexIndex,r=this.breakNormals?this.vertexBufferStart+this.profile.poles.length+this.profile.vertices.length:this.vertexBufferStart+this.profile.poles.length;for(let n=0;n<this.profile.numSegments;++n){const e=this.profile.vertexIndices[2*n+0],a=this.profile.vertexIndices[2*n+1],s=this.vertexBufferStart+this.profile.poleIndices[e],o=this.vertexBufferStart+this.profile.poleIndices[a];let c=i+e,l=i+a;for(let i=0;i<this.numSegments-1;++i){const n=r+i*this.profile.vertices.length+e,s=r+i*this.profile.vertices.length+a;this.flip?(t(n,l,c),t(l,n,s)):(t(c,l,n),t(s,n,l)),c=n,l=s}this.flip?(t(s,l,c),s!==o&&t(s,o,l)):(t(c,l,s),s!==o&&t(l,o,s))}}}class hn{constructor(e,t,i,r,n,a=sn){this.options=a,this._extrusionVertexCount=0,this._triangleCount=0,this.numExtrusionProfiles=0,this.numVerticesTotal=0,this.numNormalsTotal=0,this.numUVTotal=0,this.profile=t,this.path=e,this.extruder=i,this.startCap=r,this.endCap=n;const s=this.path.vertices.length-2;this.numExtrusionProfiles=i.numProfilesPerJoin()*s+2,this.numVerticesTotal=t.vertices.length*this.numExtrusionProfiles,this.numNormalsTotal=this.numVerticesTotal,this.startCap.vertexBufferStart=this.numVerticesTotal;const o=this.startCap.getNumVertices();this.numVerticesTotal+=o,this.numNormalsTotal+=o,this.endCap.vertexBufferStart=this.numVerticesTotal;const c=this.endCap.getNumVertices();this.numVerticesTotal+=c,this.numNormalsTotal+=c,this.pathVertexData=new Float32Array(1*this.numVerticesTotal),this.profileRightAxisData=new Float32Array(4*this.numVerticesTotal),this.profileUpAxisData=new Float32Array(4*this.numVerticesTotal),this.profileVertexAndNormalData=new Float32Array(4*this.numVerticesTotal),this.profile.hasUV()&&this.options.generateUV&&(this.numUVTotal=this.profile.uvs.length,this.uvData=new Float32Array(2*this.numUVTotal)),this.originData=new Float32Array(3*this.path.vertices.length),this.rebuildGeometry(),this.buildTopology()}emitVertex(e,t,i,r,n){if(this.profileRightAxisData[4*this._extrusionVertexCount+0]=t.right[0],this.profileRightAxisData[4*this._extrusionVertexCount+1]=t.right[1],this.profileRightAxisData[4*this._extrusionVertexCount+2]=t.right[2],this.profileUpAxisData[4*this._extrusionVertexCount+0]=t.up[0],this.profileUpAxisData[4*this._extrusionVertexCount+1]=t.up[1],this.profileUpAxisData[4*this._extrusionVertexCount+2]=t.up[2],this.profileVertexAndNormalData[4*this._extrusionVertexCount+0]=i[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=i[1],this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=r[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=r[1],this.pathVertexData[this._extrusionVertexCount]=e,n){const t=this.path.vertices[e];this.profileRightAxisData[4*this._extrusionVertexCount+3]=t.rotationRight[0]*t.maxStretchDistance,this.profileUpAxisData[4*this._extrusionVertexCount+3]=t.rotationRight[1]*t.maxStretchDistance}else this.profileRightAxisData[4*this._extrusionVertexCount+3]=0,this.profileUpAxisData[4*this._extrusionVertexCount+3]=0;++this._extrusionVertexCount}emitCapVertex(e,t,i,r,n,a){this.profileRightAxisData[4*this._extrusionVertexCount+0]=t.right[0],this.profileRightAxisData[4*this._extrusionVertexCount+1]=t.right[1],this.profileRightAxisData[4*this._extrusionVertexCount+2]=t.right[2],this.profileUpAxisData[4*this._extrusionVertexCount+0]=t.up[0],this.profileUpAxisData[4*this._extrusionVertexCount+1]=t.up[1],this.profileUpAxisData[4*this._extrusionVertexCount+2]=t.up[2],this.profileVertexAndNormalData[4*this._extrusionVertexCount+0]=i[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=i[1],this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=r[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=r[1],this.pathVertexData[this._extrusionVertexCount]=e,this.profileRightAxisData[4*this._extrusionVertexCount+3]=n,this.profileUpAxisData[4*this._extrusionVertexCount+3]=a,++this._extrusionVertexCount}emitTriangle(e,t,i){this.vertexIndices[3*this._triangleCount+0]=e,this.vertexIndices[3*this._triangleCount+1]=t,this.vertexIndices[3*this._triangleCount+2]=i,this.pathVertexIndices[3*this._triangleCount+0]=this.pathVertexData[e],this.pathVertexIndices[3*this._triangleCount+1]=this.pathVertexData[t],this.pathVertexIndices[3*this._triangleCount+2]=this.pathVertexData[i],this.normalIndices[3*this._triangleCount+0]=e,this.normalIndices[3*this._triangleCount+1]=t,this.normalIndices[3*this._triangleCount+2]=i,++this._triangleCount}rebuildGeometry(){const e=(e,t,i,r,n)=>this.emitVertex(e,t,i,r,n),t=(e,t,i,r,n,a)=>this.emitCapVertex(e,t,i,r,n,a);this._extrusionVertexCount=0;for(const i of this.path.vertices)this.originData[3*i.index+0]=i.pos[0],this.originData[3*i.index+1]=i.pos[1],this.originData[3*i.index+2]=i.pos[2];this.startCap.rebuildConnectingProfileGeometry(this.path.vertices[0],this.profile,t);for(let i=1;i<this.path.vertices.length-1;++i)this.extruder.extrude(this.path.vertices[i],this.profile,e);if(this.endCap.rebuildConnectingProfileGeometry(this.path.vertices[this.path.vertices.length-1],this.profile,t),this.startCap.rebuildCapGeometry(this.path.vertices[0],t),this.endCap.rebuildCapGeometry(this.path.vertices[this.path.vertices.length-1],t),this.profile.hasUV()&&this.options.generateUV)for(let i=0;i<this.profile.uvs.length;++i)this.uvData[2*i+0]=this.profile.uvs[i],this.uvData[2*i+1]=0}buildTopology(){const e=(e,t,i)=>this.emitTriangle(e,t,i);this._triangleCount=0;const t=this.profile.vertices.length,i=this.profile.numSegments,r=this.numExtrusionProfiles-1;let n=i*r*2*3;this.startCap.indexBufferStart=n,this.startCap.firstProfileVertexIndex=0,n+=this.startCap.getNumIndices(),this.endCap.indexBufferStart=n,this.endCap.firstProfileVertexIndex=t*(this.numExtrusionProfiles-1),n+=this.endCap.getNumIndices(),this.vertexIndices=new Uint32Array(n),this.normalIndices=new Uint32Array(n),this.pathVertexIndices=new Uint32Array(n),this.profile.hasUV()&&this.options.generateUV&&(this.uvIndices=new Uint32Array(n));for(let a=0;a<i;++a){const i=this.profile.vertexIndices[2*a],n=this.profile.vertexIndices[2*a+1];for(let a=0;a<r;++a){const r=a*t+i,s=(a+1)*t+n,o=a*t+n;e(r,(a+1)*t+i,s),e(r,s,o)}}this.startCap.buildTopology(this.path.vertices[0],e),this.endCap.buildTopology(this.path.vertices[this.path.vertices.length-1],e)}onPathChanged(){this.rebuildGeometry()}}class un{constructor(e){this.builder=e}get xform(){return this.builder.path.xform}onPathChanged(){this.builder.onPathChanged()}}class pn extends un{constructor(e){super(e),this.vertexAttributePosition=null,this.vertexAttributeNormal=null,this.vertexAttributeColor=null,this.vertexAttributePosition=new Float32Array(3*this.builder.numVerticesTotal),this.vertexAttributeNormal=new Float32Array(3*this.builder.numNormalsTotal),this.vertexAttributeColor=new Uint8Array(4),this.vertexAttributeColor[0]=255,this.vertexAttributeColor[1]=255,this.vertexAttributeColor[2]=255,this.vertexAttributeColor[3]=255}bakeVertexColors(e){this.vertexAttributeColor[0]=255*e[0],this.vertexAttributeColor[1]=255*e[1],this.vertexAttributeColor[2]=255*e[2],this.vertexAttributeColor[3]=255*(e.length>3?e[3]:1)}bake(e){this.size=e;for(let t=0;t<this.builder.numVerticesTotal;++t){let i=this.builder.pathVertexData[t];const r=0===i||i===this.builder.path.vertices.length-1;i*=3;const n=bn;Object(d["z"])(n,this.builder.originData[i++],this.builder.originData[i++],this.builder.originData[i]);const a=4*t,s=yn,o=mn,l=On,h=_n,u=xn;let p=0,f=0;if(Object(d["z"])(h,this.builder.profileRightAxisData[a],this.builder.profileRightAxisData[a+1],this.builder.profileRightAxisData[a+2]),Object(d["z"])(u,this.builder.profileUpAxisData[a],this.builder.profileUpAxisData[a+1],this.builder.profileUpAxisData[a+2]),Object(c["s"])(o,this.builder.profileVertexAndNormalData[a]*e[0],this.builder.profileVertexAndNormalData[a+1]*e[1]),r)Object(d["j"])(l,u,h),p=this.builder.profileRightAxisData[a+3]*e[0],f=this.builder.profileUpAxisData[a+3];else{const e=gn,t=vn;Object(c["s"])(e,this.builder.profileRightAxisData[a+3],this.builder.profileUpAxisData[a+3]);const i=Object(c["l"])(e);Object(c["i"])(e,e);const r=Object(c["k"])(o,e);if(Math.abs(r)>i){Object(c["s"])(t,-e[1],e[0]);const n=Object(c["k"])(o,t);Object(c["g"])(e,e,i*Math.sign(r)),Object(c["g"])(t,t,n),Object(c["m"])(o,e,t)}Object(d["z"])(l,0,0,0)}Object(d["z"])(s,h[0]*o[0]+u[0]*o[1],h[1]*o[0]+u[1]*o[1],h[2]*o[0]+u[2]*o[1]),this.vertexAttributePosition[3*t+0]=n[0]+s[0]+l[0]*p,this.vertexAttributePosition[3*t+1]=n[1]+s[1]+l[1]*p,this.vertexAttributePosition[3*t+2]=n[2]+s[2]+l[2]*p;const b=mn;Object(c["s"])(b,this.builder.profileVertexAndNormalData[a+2],this.builder.profileVertexAndNormalData[a+3]),this.vertexAttributeNormal[3*t+0]=h[0]*b[0]+u[0]*b[1]+l[0]*f,this.vertexAttributeNormal[3*t+1]=h[1]*b[0]+u[1]*b[1]+l[1]*f,this.vertexAttributeNormal[3*t+2]=h[2]*b[0]+u[2]*b[1]+l[2]*f}}createGeometryData(){const e=[["position",this.builder.vertexIndices],["normal",this.builder.normalIndices]],t=[["position",{size:3,data:this.vertexAttributePosition,exclusive:!0}],["normal",{size:3,data:this.vertexAttributeNormal,exclusive:!0}]];if(this.vertexAttributeColor){const i=this.builder.vertexIndices.length;e.push(["color",new Uint32Array(i)]),t.push(["color",{size:4,data:this.vertexAttributeColor}])}return{vertexAttributes:t,indices:e}}onPathChanged(){super.onPathChanged(),this.bake(this.size)}intersect(e,t,i){const r=this.builder.vertexIndices,n={size:3,data:this.vertexAttributePosition},a=r.length/3;Object(Ki["j"])(e,t,0,a,r,n,void 0,void 0,i)}}class fn extends un{constructor(e,t,i,r){super(e),this.sizeAttributeValue=t,this.colorAttributeValue=i,this.opacityAttributeValue=r,this.vvData=null,this.baked=new pn(e),this.vvData=new Float32Array(4*this.builder.path.vertices.length);for(let n=0;n<this.builder.path.vertices.length;++n){this.vvData[4*n+0]=t,this.vvData[4*n+1]=i,this.vvData[4*n+2]=r;const e=0===n||n===this.builder.path.vertices.length-1;this.vvData[4*n+3]=e?1:0}}createGeometryData(){return{vertexAttributes:[["position",{size:3,data:this.builder.originData,exclusive:!0}],["profileRight",{size:4,data:this.builder.profileRightAxisData,exclusive:!0}],["profileUp",{size:4,data:this.builder.profileUpAxisData,exclusive:!0}],["profileVertexAndNormal",{size:4,data:this.builder.profileVertexAndNormalData,exclusive:!0}],["featureValue",{size:4,data:this.vvData,exclusive:!0}]],indices:[["position",this.builder.pathVertexIndices],["profileRight",this.builder.vertexIndices],["profileUp",this.builder.vertexIndices],["profileVertexAndNormal",this.builder.vertexIndices],["featureValue",this.builder.pathVertexIndices]]}}}const bn=Object(h["f"])(),mn=Object(l["b"])(),gn=Object(l["b"])(),vn=Object(l["b"])(),yn=Object(h["f"])(),On=Object(h["f"])(),_n=Object(h["f"])(),xn=Object(h["f"])(),jn=Object(h["f"])(),wn=Xr(),Sn=Object(M["d"])();var Tn=i("d7f7"),Cn=i("35b3"),Pn=i("a4ee"),An=i("d272"),Mn=i("b49d"),Rn=i("7d11"),En=i("c6d7"),Dn=i("d017"),In=i("8e97"),Fn=i("c3a4"),zn=i("ca98"),Ln=i("da35"),Vn=i("7438"),kn=i("c829"),Un=i("87b7"),Bn=i("af20"),Nn=i("189c");const Gn=new Map([["position",0],["profileRight",1],["profileUp",2],["profileVertexAndNormal",3],["featureValue",4]]);class qn extends zn["a"]{initializeProgram(e){const t=qn.shader.get(),i=this.configuration,r=t.build({OITEnabled:0===i.transparencyPassType,output:i.output,viewingMode:e.viewingMode,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,receiveShadows:i.receiveShadows,vvSize:i.vvSize,vvColor:i.vvColor,vvInstancingEnabled:!0,vvOpacity:i.vvOpacity,pbrMode:0,useCustomDTRExponentForWater:!1,receiveAmbientOcclusion:i.receiveSSAO,doubleSidedMode:i.doubleSidedMode,multipassTerrainEnabled:i.multipassTerrainEnabled,cullAboveGround:i.cullAboveGround});return new kn["a"](e.rctx,r,Gn)}bindPass(e,t){var i,r;Object(In["c"])(this.program,t.camera.projectionMatrix),this.program.setUniform3fv("size",e.size),t.multipassTerrainEnabled&&(this.program.setUniform2fv("cameraNearFar",t.camera.nearFar),this.program.setUniform2fv("inverseViewport",t.inverseViewport),Object(En["a"])(this.program,t)),0!==this.configuration.output&&7!==this.configuration.output||this.program.setUniform1f("opacity",e.opacity),0===this.configuration.output?(t.lighting.setUniforms(this.program,!1),this.program.setUniform3fv("ambient",e.ambient),this.program.setUniform3fv("diffuse",e.diffuse),this.program.setUniform3fv("specular",e.specular),this.program.setUniform1f("opacity",e.opacity)):1!==this.configuration.output&&3!==this.configuration.output||Object(In["b"])(this.program,t.camera.nearFar),Object(Mn["b"])(this.program,e),null==(i=t.shadowMap)||i.bind(this.program),null==(r=t.ssaoHelper)||r.bind(this.program,t.camera)}bindDraw(e){Object(In["d"])(this.program,e),Object(An["c"])(this.program,this.configuration,e),this.program.rebindTextures(),0!==this.configuration.output&&7!==this.configuration.output||Object(In["a"])(this.program,e.origin,e.camera.viewInverseTransposeMatrix),0===this.configuration.output&&Object(Dn["c"])(this.program,e),2===this.configuration.output&&Rn["a"].bindUniforms(this.program,e.camera.viewInverseTransposeMatrix)}setPipelineState(e){const t=this.configuration,i=3===e,r=2===e,n=e=>!e.slicePlaneEnabled&&!(e.transparent||0===e.doubleSidedMode);return Object(Nn["g"])({blending:0!==t.output&&7!==t.output||!t.transparent?null:i?Vn["g"]:Object(Vn["a"])(e),culling:n(t)&&Nn["f"],depthTest:{func:Object(Vn["b"])(e)},depthWrite:i||r?Nn["e"]:null,colorWrite:Nn["d"],stencilWrite:t.sceneHasOcludees?Un["j"]:null,stencilTest:t.sceneHasOcludees?Un["e"]:null,polygonOffset:i||r?null:Vn["d"]})}initializePipeline(){return this.setPipelineState(this.configuration.transparencyPassType)}}qn.shader=new Fn["a"](Bn["a"],()=>i.e("chunk-2d0c7e33").then(i.bind(null,"5310")));class Hn extends Ln["a"]{constructor(){super(...arguments),this.output=0,this.doubleSidedMode=0,this.receiveShadows=!1,this.receiveSSAO=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.slicePlaneEnabled=!1,this.transparent=!1,this.sceneHasOcludees=!1,this.transparencyPassType=3,this.multipassTerrainEnabled=!1,this.cullAboveGround=!1}}Object(Pn["a"])([Object(Ln["b"])({count:8})],Hn.prototype,"output",void 0),Object(Pn["a"])([Object(Ln["b"])({count:3})],Hn.prototype,"doubleSidedMode",void 0),Object(Pn["a"])([Object(Ln["b"])()],Hn.prototype,"receiveShadows",void 0),Object(Pn["a"])([Object(Ln["b"])()],Hn.prototype,"receiveSSAO",void 0),Object(Pn["a"])([Object(Ln["b"])()],Hn.prototype,"vvSize",void 0),Object(Pn["a"])([Object(Ln["b"])()],Hn.prototype,"vvColor",void 0),Object(Pn["a"])([Object(Ln["b"])()],Hn.prototype,"vvOpacity",void 0),Object(Pn["a"])([Object(Ln["b"])()],Hn.prototype,"slicePlaneEnabled",void 0),Object(Pn["a"])([Object(Ln["b"])()],Hn.prototype,"transparent",void 0),Object(Pn["a"])([Object(Ln["b"])()],Hn.prototype,"sceneHasOcludees",void 0),Object(Pn["a"])([Object(Ln["b"])({count:4})],Hn.prototype,"transparencyPassType",void 0),Object(Pn["a"])([Object(Ln["b"])()],Hn.prototype,"multipassTerrainEnabled",void 0),Object(Pn["a"])([Object(Ln["b"])()],Hn.prototype,"cullAboveGround",void 0);var Wn=i("b4c8"),$n=i("5957");const Zn=xi["a"];class Qn extends Cn["a"]{constructor(e){super(e,Yn),this.supportsEdges=!0,this._vertexAttributeLocations=Gn,this.techniqueConfig=new Hn,this.vertexBufferLayout=Qn.getVertexBufferLayout(this.parameters)}getTechniqueConfig(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.vvSize=this.parameters.vvSizeEnabled,this.techniqueConfig.vvColor=this.parameters.vvColorEnabled,this.techniqueConfig.vvOpacity=this.parameters.vvOpacityEnabled,this.techniqueConfig.slicePlaneEnabled=this.parameters.slicePlaneEnabled,this.techniqueConfig.transparent=this.parameters.transparent,this.techniqueConfig.sceneHasOcludees=this.parameters.sceneHasOcludees,0!==e&&7!==e||(this.techniqueConfig.doubleSidedMode=this.parameters.doubleSided&&"normal"===this.parameters.doubleSidedType?1:this.parameters.doubleSided&&"winding-order"===this.parameters.doubleSidedType?2:0,this.techniqueConfig.receiveShadows=this.parameters.receiveShadows,this.techniqueConfig.receiveSSAO=!!t.ssaoEnabled&&this.parameters.receiveSSAO),this.techniqueConfig.transparencyPassType=t.transparencyPassType,this.techniqueConfig.multipassTerrainEnabled=t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=t.cullAboveGround,this.techniqueConfig}getPassParameters(){return this.parameters}isVisibleInPass(e){return 4!==e&&6!==e&&7!==e||this.parameters.castShadows}isVisible(){const e=this.parameters;return!!super.isVisible()&&e.opacity>0}intersect(e,t,i,r,a,s,o){const c=e;if(!Gr(c))return;const l=c.path,d=[this.parameters.size[0],this.parameters.size[1]];if(this.parameters.vvSizeEnabled){const e=this.parameters.vvSizeOffset,t=this.parameters.vvSizeFactor,i=this.parameters.vvSizeMinSize,r=this.parameters.vvSizeMaxSize,n=l.sizeAttributeValue;d[0]*=Object(Ue["f"])(e[0]+n*t[0],i[0],r[0]),d[1]*=Object(Ue["f"])(e[2]+n*t[2],i[2],r[2])}const h=Math.max(d[0],d[1]),u=e.boundingInfo;if(Object(n["k"])(u))return void this._intersectTriangles(l,d,a,s,o);const p=Object(f["t"])(u.bbMin[0]-h,u.bbMin[1]-h,u.bbMin[2]-h,u.bbMax[0]+h,u.bbMax[1]+h,u.bbMax[2]+h),b=[s[0]-a[0],s[1]-a[1],s[2]-a[2]],m=Math.sqrt(b[0]*b[0]+b[1]*b[1]+b[2]*b[2]),g=[m/b[0],m/b[1],m/b[2]];Object(Ki["f"])(p,a,g,r.tolerance)&&this._intersectTriangles(l,d,a,s,o)}_intersectTriangles(e,t,i,r,n){e.baked.size&&e.baked.size[0]===t[0]&&e.baked.size[1]===t[1]||e.baked.bake(t),e.baked.intersect(i,r,n)}computeAttachmentOrigin(e,t){const i=e.vertexAttributes;if(!i)return null;const r=i.get("position");return Object(Ut["a"])(r,null,!1,t)}createBufferWriter(){return new Kn(this.vertexBufferLayout)}requiresSlot(e){return e===(this.parameters.transparent?4:2)||20===e}createGLMaterial(e){return 0===e.output||7===e.output||1===e.output||2===e.output||4===e.output||3===e.output&&this.parameters.castShadows?new Xn(e):null}static getVertexBufferLayout(e){let t=Object(Si["a"])().vec3f("position").vec4f("profileRight").vec4f("profileUp").vec4f("profileVertexAndNormal");return(e.vvColorEnabled||e.vvSizeEnabled||e.vvOpacityEnabled)&&(t=t.vec4f("featureValue")),t}}class Xn extends Tn["a"]{updateParameters(e){return this.ensureTechnique(qn,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.sceneHasOcludees&&this._material.setParameters({sceneHasOcludees:e.hasOccludees})}_updateShadowState(e){(Object(n["k"])(this.technique)||e.shadowMappingEnabled!==this.technique.configuration.receiveShadows)&&this._material.setParameters({receiveShadows:e.shadowMappingEnabled})}beginSlot(e){return 0!==this._output&&7!==this._output||(this._updateShadowState(e),this._updateOccludeeState(e)),this.updateParameters(e)}bind(e,t){t.bindPass(this._material.getPassParameters(),e)}}const Yn={size:[1,1,1],ambient:[.2,.2,.2],diffuse:[.8,.8,.8],specular:[0,0,0],opacity:1,doubleSided:!1,doubleSidedType:"normal",receiveSSAO:!0,receiveShadows:!1,castShadows:!0,slicePlaneEnabled:!1,transparent:!1,sceneHasOcludees:!1,...Wn["a"].Default,...Cn["b"]};class Kn{constructor(e){this.vertexBufferLayout=e}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return e.indices.get("position").length}write(e,t,i,r){const n=e=>{if(t.vertexAttributes.has(e)){const n=t.vertexAttributes.get(e),a=t.indices.get(e);Zn(4===n.size);const s=i.getField(e,R["C"]);if(!s)throw new Error("unable to acquire view for "+e);Object($n["a"])(a,n.data,s,r)}};n("profileRight"),n("profileUp"),n("profileVertexAndNormal"),this.vertexBufferLayout.hasField("featureValue")&&n("featureValue"),Object($n["c"])(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,i,r)}}const Jn=["polyline"];class ea extends z["a"]{constructor(e,t,i,r){super(e,t,i,r),this._intrinsicSize=Object(l["f"])(1,1),this.upVectorAlignment="path",this.stencilWidth=.1,this.ensureDrapedStatus(!1)}async doLoad(){const e=Object(n["l"])(this.symbolLayer.width)?this.symbolLayer.width:this.symbolLayer.height,t=Object(n["l"])(this.symbolLayer.height)?this.symbolLayer.height:e;this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[e,1,t],unitInMeters:this._context.renderCoordsHelper.unitInMeters,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}},this._context.renderer&&this._context.renderer.visualVariables&&this._context.renderer.visualVariables.length>0?this._fastUpdates=at(this._context.renderer,this._vvConvertOptions):this._fastUpdates={enabled:!1};const i=this.symbolLayer.anchor||"center";this.upVectorAlignment="path","heading"===this.symbolLayer.profileRotation&&(this.upVectorAlignment="world");const r=this.symbolLayer.profile||"circle";switch(r){case"circle":default:this._profile=en.circle(pa);break;case"quad":this._profile=en.rect()}let a=[0,0];switch("center"!==i&&(a={left:[.5,0],right:[-.5,0],top:[0,-.5],bottom:[0,.5]}[i],this._profile.translate(a[0],a[1])),this.symbolLayer.join||"simple"){case"round":this._extruder=new an(0,ha);break;case"bevel":this._extruder=new an(0,1);break;case"miter":this._extruder=new an(.8*Math.PI,1);break;default:this._extruder=new nn}const s=this.symbolLayer.cap||"butt";switch(s){case"none":this._startCap=new cn,this._endCap=new cn;break;case"butt":default:this._startCap=new ln(this._profile,0),this._endCap=new ln(this._profile,0,!0);break;case"square":this._startCap=new ln(this._profile,-.5),this._endCap=new ln(this._profile,.5,!0);break;case"round":{const e="quad"===r;this._startCap=new dn({profile:this._profile,flip:!1,breakNormals:e,subdivisions:ua}),this._endCap=new dn({profile:this._profile,flip:!0,breakNormals:e,subdivisions:ua});break}}const o=Object(n["j"])(this.symbolLayer,"material","color"),l=this._getCombinedOpacityAndColor(o),d=Object(h["g"])(l),u=l[3],p=u<1||this.needsDrivenTransparentPass,f={diffuse:d,ambient:d,opacity:u,transparent:p,vertexColors:!1,slicePlaneEnabled:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,cullFace:p||"none"===s?0:2,offsetTransparentBackfaces:!0};if(!this._drivenProperties.size&&(Object(c["s"])(this._intrinsicSize,e,t),!Object(L["f"])(this._intrinsicSize[0])||!Object(L["f"])(this._intrinsicSize[1])))throw new S["a"]("graphics3dpathsymbollayer:invalid-size","Symbol sizes may not be negative values");this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size||Object(c["g"])(this._intrinsicSize,this._intrinsicSize,1/this._context.renderCoordsHelper.unitInMeters),this._fastUpdates.enabled?(Object.assign(f,this._fastUpdates.materialParameters,{size:[this._intrinsicSize[0],this._intrinsicSize[1],0]}),this._material=new Qn(f)):(f.vertexColors=this._drivenProperties.color||this._drivenProperties.opacity,this._material=new J["a"](f)),this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._context.stage.add(this._material)}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry,Jn,this.symbolLayer.type))return null;const i=this.setGraphicElevationContext(t,new F["a"]),r=e.renderingInfo;return this._createAs3DShape(t,r,i,t.uid)}layerOpacityChanged(){const e=Object(n["j"])(this.symbolLayer,"material","color"),t=this._getCombinedOpacity(e),i=t<1||this.needsDrivenTransparentPass;return this._material.setParameters({opacity:t,transparent:i}),!0}layerElevationInfoChanged(e,t){return this.updateGraphics3DGraphicElevationInfo(e,t,I["i"])}slicePlaneEnabledChanged(){return this._material.setParameters({slicePlaneEnabled:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}pixelRatioChanged(){return!0}applyRendererDiff(e,t){for(const i in e.diff){if("visualVariables"!==i)return 0;if(!st(this._fastUpdates,t,this._vvConvertOptions))return 0;this._material.setParameters(this._fastUpdates.materialParameters)}return 2}getVertexData(e){let t=0;const i=e.paths,r=[],n=e.spatialReference,a=this._context.elevationProvider.spatialReference,s=this._context.renderCoordsHelper.spatialReference;for(const u of i)t+=u.length;const o=new Float64Array(3*t),c=new Float64Array(3*t),l=new Float64Array(3*t);let d=0;for(const u of i){r.push({index:d,numVertices:u.length});for(const t of u)o[d++]=t[0],o[d++]=t[1],o[d++]=e.hasZ?t[2]:0}let h=!0;return n.equals(a)?this._copyVertices(o,0,c,0,t):h=Object(p["p"])(o,n,0,c,a,0,t),a.equals(s)?this._copyVertices(c,0,l,0,t):Object(p["p"])(c,a,0,l,s,0,t),{pathVertexDataInfos:r,vertexDataGS:o,vertexDataES:c,vertexDataRS:l,projectionSuccess:h,terrainElevation:0}}_copyVertices(e,t,i,r,n){t*=3,r*=3;for(let a=0;a<n;++a)i[r++]=e[t++],i[r++]=e[t++],i[r++]=e[t++]}_createAs3DShape(e,t,i,r){const a=e.geometry,s=new Array,o=new Array,c=new Array,l=a.spatialReference,h=Object(f["h"])(),u=this._context.renderCoordsHelper;sa.spatialReference=l;const p=this.getVertexData(a);if(!p.projectionSuccess)return this.logger.warn("PathSymbol3DLayer geometry failed to be created (failed to project geometry to view spatial reference)"),null;if(p.pathVertexDataInfos.length>0){for(let r=0;r<p.pathVertexDataInfos.length;++r){const a=p.pathVertexDataInfos[r],b=a.index,m=a.numVertices;if(m<2)continue;if(Object(n["l"])(this._context.clippingExtent)&&(Object(f["k"])(h),Object(f["n"])(h,p.vertexDataES,3*b,m),!Object(f["x"])(h,this._context.clippingExtent)))continue;const g=[];for(let e=b;e<b+3*m;){const t=e++,r=e++,n=e++,a=new Jr;Object(d["z"])(a.posGS,p.vertexDataGS[t],p.vertexDataGS[r],p.vertexDataGS[n]),Object(d["z"])(a.posES,p.vertexDataES[t],p.vertexDataES[r],p.vertexDataES[n]);const s=Object(I["f"])(a.posES,this._context.elevationProvider,i,u);Object(d["z"])(oa,p.vertexDataRS[t],p.vertexDataRS[r],p.vertexDataRS[n]),u.setAltitude(oa,s),Object(d["z"])(a.pos,oa[0],oa[1],oa[2]),g.push(a)}const v=new tn(g);ta(v,this.upVectorAlignment,this._context.renderCoordsHelper);const y=new hn(v,this._profile,this._extruder,this._startCap,this._endCap);let O=null;if(this._fastUpdates.enabled){const t=this._fastUpdates.visualVariables,i=t.size?Object(z["b"])(t.size.field,e):0,r=t.color?Object(z["b"])(t.color.field,e):0,n=t.opacity?Object(z["b"])(t.opacity.field,e):0;O=new fn(y,i,r,n)}else{const e=[this._intrinsicSize[0],this._intrinsicSize[1]];this._drivenProperties.size&&(e[0]*=ia(t.size[0],"symbol-value"===t.size[2]?this.symbolLayer.height||0:t.size[2],this.symbolLayer.width||0),e[1]*=ia(t.size[2],"symbol-value"===t.size[0]?this.symbolLayer.width||0:t.size[0],this.symbolLayer.height||0));let i=null;this._drivenProperties.color&&(i=t.color),this._drivenProperties.opacity&&null!=t.opacity&&(i=i?[i[0],i[1],i[2],t.opacity]:[1,1,1,t.opacity]);const r=new pn(y);r.bake(e),i&&r.bakeVertexColors(i),O=r}const{vertexAttributes:_,indices:x}=O.createGeometryData(),j=new Nr(_,x,O,l,this.upVectorAlignment,this.stencilWidth);s.push(j),o.push(this._material),c.push(O.xform)}if(s.length>0){const e={layerUid:this._context.layer.uid,graphicUid:r},t=new K["a"]({geometries:s,materials:o,transformations:c,metadata:e}),n=new j["a"](this,t,s,null,null,na,i);return n.alignedSampledElevation=p.terrainElevation,n.needsElevationUpdates=Object(I["i"])(i.mode),n}}else 0!==a.paths.length&&a.paths.some(e=>e.length>0)||this.logger.warn("PathSymbol3DLayer geometry failed to be created (no paths were defined)");return null}}function ta(e,t,i){switch(t){case"world":for(const t of e.vertices)Object(d["i"])(ca,t.pos,e.offset),i.worldUpAtPosition(ca,oa),t.setFrameFromUpVector(oa),t.computeRotationAxisAndAngleFromUpVector();break;case"path":Object(d["i"])(ca,e.vertices[0].pos,e.offset),i.worldUpAtPosition(ca,oa),rn(e,oa);for(const t of e.vertices){const e=Math.sign(Object(d["k"])(t.frame.right,t.vRight));Object(d["j"])(t.rotationFrame.up,t.vRight,t.vLeft),Object(d["h"])(t.rotationFrame.up,t.rotationFrame.up,e),Object(d["u"])(t.rotationFrame.up,t.rotationFrame.up);const i=Object(d["k"])(t.rotationFrame.up,t.frame.up),r=Object(d["k"])(t.rotationFrame.up,t.frame.right);if(Object(d["h"])(ca,t.frame.up,-r),Object(d["h"])(la,t.frame.right,i),Object(d["i"])(ca,ca,la),Object(d["u"])(t.rotationFrame.right,ca),Kr(t.rotationRight,t.frame,t.rotationFrame.right),Object(d["v"])(ca,t.vLeft),t.rotationAngle=-e*(Math.PI-Object(Ue["b"])(Object(d["k"])(ca,t.vRight))),Math.abs(t.rotationAngle)>0){const e=Object(Ue["q"])(Math.cos(.5*t.rotationAngle));Or(t.miterStretch,1+(e-1)*t.rotationRight[0]*t.rotationRight[0],(e-1)*t.rotationRight[0]*t.rotationRight[1],(e-1)*t.rotationRight[0]*t.rotationRight[1],1+(e-1)*t.rotationRight[1]*t.rotationRight[1])}const n=Math.PI-t.rotationAngle;t.maxStretchDistance=Math.abs(Math.min(t.vLeftLength,t.vRightLength)*Object(Ue["q"])(Math.cos(.5*n)))}}}function ia(e,t,i){switch(e){case"symbol-value":return i;case"proportional":return t;default:return e}}function ra(e,t,i,r){let n=0;for(const a of e.vertices)Object(I["g"])(a.posES,i,t,r,da),n+=da.sampledElevation,Object(d["i"])(oa,a.pos,e.offset),r.setAltitude(oa,da.z),Object(d["m"])(a.pos,oa,e.offset);return e.updatePathVertexInformation(),n/e.vertices.length}function na(e,t,i,r){const n=e.stageObject,a=n.geometryRecords;let s=0;aa.spatialReference=r.spatialReference;for(const o of a){const e=o.geometry;if(!Gr(e))continue;const a=e.path,c=a.builder.path,l=e.geometrySR;sa.spatialReference=l,s+=ra(c,t,i,r),"world"!==e.upVectorAlignment&&ta(c,e.upVectorAlignment,r),a.onPathChanged(),e.invalidateBoundingInfo(),n.geometryVertexAttrsUpdated(o)}return s/a.length}const aa=Object(m["j"])(0,0,0,null),sa=Object(m["j"])(0,0,0,null),oa=Object(h["f"])(),ca=Object(Br["c"])(),la=Object(Br["c"])(),da=new I["a"],ha=3,ua=3,pa=10;var fa=i("f694");function ba(e,t,i,r,n=1){if(i.isGeographic&&2!==r){const e=new Float64Array(t.typedBuffer.length),r=3*t.count,n=Object(fa["e"])(i);for(let i=0;i<r;i+=3)Object(p["l"])(t.typedBuffer,i,e,i,n);t=R["v"].fromTypedArray(e)}Object(c["s"])(ja,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(let o=0;o<t.count;o++)t.getVec(o,va),ja[0]=Math.min(ja[0],va[0]),ja[1]=Math.min(ja[1],va[1]);const a=ja[0]%n,s=ja[1]%n;Sa[0]=ja[0]-a,Sa[1]=ja[1]-s;for(let o=0;o<t.count;o++)t.getVec(o,va),e.setValues(o,(va[0]-Sa[0])/n,(va[1]-Sa[1])/n,Sa[0]/n,Sa[1]/n)}function ma(e,t,i,r,n=1){Object(d["z"])(Oa,1,0,0),Object(d["z"])(_a,0,1,0),Object(d["z"])(xa,0,0,1),Fa(ga,t),Aa(t,ya)&&Ma(ya,Oa,_a,xa,i,ga),Object(c["s"])(ja,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),Object(c["s"])(wa,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(let c=0;c<t.count;c++){t.getVec(c,va);const e=Object(d["k"])(Oa,va),i=Object(d["k"])(_a,va);ja[0]=Math.min(ja[0],e),ja[1]=Math.min(ja[1],i),wa[0]=Math.max(wa[0],e),wa[1]=Math.max(wa[1],i)}const a=Object(d["k"])(xa,ga);La(Ta,ja[0],ja[1],a,Oa,_a,xa),La(Ca,wa[0],ja[1],a,Oa,_a,xa),La(Pa,ja[0],wa[1],a,Oa,_a,xa),Object(d["m"])(Ca,Ca,Ta),Object(d["h"])(Ca,Ca,.5),Object(d["m"])(Pa,Pa,Ta),Object(d["h"])(Pa,Pa,.5),Object(d["i"])(Ta,Ta,Ca),Object(d["i"])(Ta,Ta,Pa);const s=ja[0]%n,o=ja[1]%n;Sa[0]=ja[0]-s,Sa[1]=ja[1]-o;for(let c=0;c<t.count;c++){t.getVec(c,va),e.setValues(c,(Object(d["k"])(Oa,va)-Sa[0])/n,(Object(d["k"])(_a,va)-Sa[1])/n,Sa[0]/n,Sa[1]/n);for(let e=0;e<3;e++)r.set(c,e,Ta[e]),r.set(c,e+3,Ca[e]),r.set(c,e+6,Pa[e])}}const ga=Object(h["f"])(),va=Object(h["f"])(),ya=Object(Zr["d"])(),Oa=Object(h["f"])(),_a=Object(h["f"])(),xa=Object(h["f"])(),ja=Object(l["b"])(),wa=Object(l["b"])(),Sa=Object(l["b"])(),Ta=Object(h["f"])(),Ca=Object(h["f"])(),Pa=Object(h["f"])();function Aa(e,t){const i=e.count-1;return Object(Zr["e"])(e,t,0,Math.floor(i/3),Math.floor(i*(2/3)))}function Ma(e,t,i,r,a,s){Object(n["l"])(a)?(a.basisMatrixAtPosition(s,Ra),Object(d["z"])(Ea,Ra[0],Ra[1],Ra[2]),Object(d["z"])(Da,Ra[4],Ra[5],Ra[6]),Object(d["z"])(Ia,Ra[8],Ra[9],Ra[10])):(Object(d["z"])(Ea,1,0,0),Object(d["z"])(Da,0,1,0),Object(d["z"])(Ia,0,0,1));const o=Object(Zr["r"])(e);Object(d["k"])(o,Ia)<0&&Object(d["h"])(o,o,-1),Object(d["n"])(r,o);const c=Object(d["k"])(o,Da),l=Object(d["k"])(o,Ea);Math.abs(c)<Math.abs(l)?(Object(d["f"])(t,Ea,o,-l),Object(d["u"])(t,t),Object(d["j"])(i,t,o),Object(d["u"])(i,i),Object(d["h"])(i,i,-1)):(Object(d["f"])(i,Da,o,-c),Object(d["u"])(i,i),Object(d["j"])(t,i,o),Object(d["u"])(t,t))}const Ra=Object(M["d"])(),Ea=Object(h["f"])(),Da=Object(h["f"])(),Ia=Object(h["f"])();function Fa(e,t){Object(d["z"])(za,0,0,0);for(let i=0;i<t.count-1;i++)t.getVec(i,va),Object(d["i"])(za,za,va);Object(d["h"])(e,za,1/(t.count-1))}const za=Object(h["f"])();function La(e,t,i,r,n,a,s){Object(d["z"])(e,t*n[0]+i*a[0]+r*s[0],t*n[1]+i*a[1]+r*s[1],t*n[2]+i*a[2]+r*s[2])}var Va=i("d36e"),ka=i("8675"),Ua=i("aeb3");class Ba extends zn["a"]{initializeProgram(e){const t=Ba.shader.get(),i=this.configuration,r=t.build({output:i.output,attributeColor:i.vertexColors,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,style:i.style,patternSpacing:i.patternSpacing,lineWidth:i.lineWidth,draped:i.draped,OITEnabled:0===i.transparencyPassType,multipassTerrainEnabled:i.multipassTerrainEnabled,cullAboveGround:i.cullAboveGround});return new kn["a"](e.rctx,r,qa)}bindPass(e,t){Object(In["c"])(this.program,t.camera.projectionMatrix),this.program.setUniform4fv("matColor",e.color),this.configuration.draped?(this.program.setUniform1f("worldToScreenRatio",1/t.screenToPCSRatio),this.program.setUniform1f("texelSize",1/t.camera.pixelRatio)):this.program.setUniform1f("worldToScreenPerDistanceRatio",1/t.camera.perScreenPixelRatio),4===this.configuration.output&&Object(yi["b"])(this.program,t),(1===this.configuration.output||t.multipassTerrainEnabled)&&this.program.setUniform2fv("cameraNearFar",t.camera.nearFar),t.multipassTerrainEnabled&&(this.program.setUniform2fv("inverseViewport",t.inverseViewport),Object(En["a"])(this.program,t))}bindDraw(e){Object(In["d"])(this.program,e),Object(In["a"])(this.program,e.origin,e.camera.viewInverseTransposeMatrix),Object(An["c"])(this.program,this.configuration,e),this.program.rebindTextures()}setPipelineState(e,t){const i=this.configuration,r=3===e,n=2===e;return Object(Nn["g"])({blending:0===i.output||7===i.output?r?Vn["g"]:Object(Vn["a"])(e):null,culling:Object(Nn["c"])(i.cullFace),depthTest:{func:Object(Vn["b"])(e)},depthWrite:r?i.writeDepth&&Nn["e"]:Object(Vn["c"])(e),colorWrite:Nn["d"],stencilWrite:i.sceneHasOcludees?Un["j"]:null,stencilTest:i.sceneHasOcludees?t?Un["f"]:Un["e"]:null,polygonOffset:r||n?i.polygonOffset&&Na:Object(Vn["h"])(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this.setPipelineState(this.configuration.transparencyPassType,!0),this.setPipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(e,t){return t?this._occludeePipelineState:super.getPipelineState(e,t)}}Ba.shader=new Fn["a"](Ua["a"],()=>i.e("chunk-2d208701").then(i.bind(null,"a590")));const Na={factor:1,units:1};class Ga extends Ln["a"]{constructor(){super(...arguments),this.output=0,this.cullFace=0,this.slicePlaneEnabled=!1,this.vertexColors=!1,this.polygonOffset=!1,this.writeDepth=!0,this.sceneHasOcludees=!1,this.enableOffset=!0,this.transparencyPassType=3,this.multipassTerrainEnabled=!1,this.cullAboveGround=!1}}Object(Pn["a"])([Object(Ln["b"])({count:8})],Ga.prototype,"output",void 0),Object(Pn["a"])([Object(Ln["b"])({count:3})],Ga.prototype,"cullFace",void 0),Object(Pn["a"])([Object(Ln["b"])()],Ga.prototype,"slicePlaneEnabled",void 0),Object(Pn["a"])([Object(Ln["b"])()],Ga.prototype,"vertexColors",void 0),Object(Pn["a"])([Object(Ln["b"])()],Ga.prototype,"polygonOffset",void 0),Object(Pn["a"])([Object(Ln["b"])()],Ga.prototype,"writeDepth",void 0),Object(Pn["a"])([Object(Ln["b"])()],Ga.prototype,"sceneHasOcludees",void 0),Object(Pn["a"])([Object(Ln["b"])({count:6})],Ga.prototype,"style",void 0),Object(Pn["a"])([Object(Ln["b"])()],Ga.prototype,"patternSpacing",void 0),Object(Pn["a"])([Object(Ln["b"])()],Ga.prototype,"lineWidth",void 0),Object(Pn["a"])([Object(Ln["b"])()],Ga.prototype,"enableOffset",void 0),Object(Pn["a"])([Object(Ln["b"])()],Ga.prototype,"draped",void 0),Object(Pn["a"])([Object(Ln["b"])({count:4})],Ga.prototype,"transparencyPassType",void 0),Object(Pn["a"])([Object(Ln["b"])()],Ga.prototype,"multipassTerrainEnabled",void 0),Object(Pn["a"])([Object(Ln["b"])()],Ga.prototype,"cullAboveGround",void 0);const qa=new Map([["position",0],["color",3],["uvMapSpace",4],["boundingRect",5]]);class Ha extends Cn["a"]{constructor(e){super(e,Za),this.supportsEdges=!0,this._vertexAttributeLocations=qa,this.techniqueConfig=new Ga}getTechniqueConfig(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.cullFace=this.parameters.cullFace,this.techniqueConfig.vertexColors=this.parameters.vertexColors,this.techniqueConfig.slicePlaneEnabled=this.parameters.slicePlaneEnabled,this.techniqueConfig.polygonOffset=this.parameters.polygonOffset,this.techniqueConfig.writeDepth=this.parameters.writeDepth,this.techniqueConfig.style=this.parameters.style,this.techniqueConfig.patternSpacing=this.parameters.patternSpacing,this.techniqueConfig.lineWidth=this.parameters.lineWidth,this.techniqueConfig.draped=this.parameters.draped,this.techniqueConfig.transparencyPassType=t.transparencyPassType,this.techniqueConfig.enableOffset=t.camera.relativeElevation<Vn["e"],this.techniqueConfig.multipassTerrainEnabled=t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=t.cullAboveGround,this.techniqueConfig}getPassParameters(){return this.parameters}intersect(e,t,i,r,n,a,s){Object(Ki["i"])(e,t,r,n,a,void 0,s)}requiresSlot(e,t){return 20===e||(4===Object(ki["b"])(t)?2===e:e===(this.parameters.writeDepth?4:7))}createGLMaterial(e){return 0===e.output||7===e.output||4===e.output||1===e.output&&this.parameters.writeLinearDepth?new Wa(e):null}createBufferWriter(){const e=Object(Si["a"])().vec3f("position").vec4u8("color").vec4f("uvMapSpace");return this.parameters.draped||e.mat3f("boundingRect"),new $a(e)}}class Wa extends Tn["a"]{updateParameters(e){return this.ensureTechnique(Ba,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.sceneHasOcludees&&this._material.setParameters({sceneHasOcludees:e.hasOccludees})}beginSlot(e){return 0!==this._output&&7!==this._output||this._updateOccludeeState(e),this.updateParameters(e)}bind(e,t){t.bindPass(this._material.getPassParameters(),e)}}class $a extends ka["a"]{write(e,t,i,r){for(const n of this.vertexBufferLayout.fieldNames){const a=t.vertexAttributes.get(n),s=t.indices.get(n);if(a&&s)switch(n){case"position":{Object(xi["a"])(3===a.size);const t=i.getField(n,R["u"]);t&&Object($n["e"])(s,a.data,e.transformation,t,r);break}case"color":{Object(xi["a"])(3===a.size||4===a.size);const e=i.getField(n,R["J"]);e&&Object($n["b"])(s,a.data,a.size,e,r);break}case"uvMapSpace":{Object(xi["a"])(4===a.size);const e=i.getField(n,R["C"]);e&&Object($n["a"])(s,a.data,e,r);break}case"boundingRect":{Object(xi["a"])(9===a.size);const t=i.getField(n,R["f"]);t&&this.writeBoundingRect(s,a.data,e.transformation,t,r);break}}}}writeBoundingRect(e,t,i,r,n){const a=i,s=r.typedBuffer,o=r.typedBufferStride,c=e.length;n*=o;for(let l=0;l<c;++l){const i=9*e[l],r=t[i],c=t[i+1],d=t[i+2];s[n]=a[0]*r+a[4]*c+a[8]*d+a[12],s[n+1]=a[1]*r+a[5]*c+a[9]*d+a[13],s[n+2]=a[2]*r+a[6]*c+a[10]*d+a[14];for(let e=3;e<9;++e)s[n+e]=t[i+e];n+=o}}}const Za={color:[1,1,1,1],writeDepth:!0,writeLinearDepth:!1,vertexColors:!1,polygonOffset:!1,slicePlaneEnabled:!1,cullFace:0,sceneHasOcludees:!1,style:2,patternSpacing:10,lineWidth:1,draped:!0,...Cn["b"]};function Qa(e,t,i){return Ya(Xa(e),t,i)}function Xa(e){return e&&e.pattern||null}function Ya(e,t,i){return Object(n["l"])(e)?"none"===e.style||"solid"===e.style?("none"===e.style&&(t.color=Object(Te["g"])(0,0,0,0),t.transparent=!0),new Va["a"](t)):(t.style=Ka(e.style),t.draped=i.isDraped,new Ha(t)):new Va["a"](t)}function Ka(e){switch(e){case"horizontal":return 0;case"vertical":return 1;case"cross":return 2;case"forward-diagonal":return 3;case"backward-diagonal":return 4;case"diagonal-cross":return 5;default:return}}function Ja(e){return e.material instanceof Ha&&!e.material.parameters.draped}function es(e,t){if(Ja(e)){const i=e.geometry.vertexAttributes,r=i.get("position").data,n=i.get("uvMapSpace").data,a=i.get("boundingRect").data;ma(R["C"].fromTypedArray(n),R["v"].fromTypedArray(r),t,R["g"].fromTypedArray(a))}}function ts(e,t,i,r){const n=Object(Ee["c"])(e,t,i,r),a=e.stageObject.geometryRecords;for(let s=0;s<a.length;s++)es(a[s],r);return n}const is=["polyline","polygon","extent"];class rs extends z["a"]{constructor(e,t,i,r){super(e,t,i,r),this._needsUV=!1,this._hasOutline=!1}async doLoad(){}ensureMaterials(){this.ensureFillMaterial(),this.ensureOutlineMaterial()}ensureFillMaterial(){if(Object(n["l"])(this._material))return;const e=Object(n["j"])(this.symbolLayer,"material","color"),t=this._getCombinedOpacityAndColor(e);this._material=Qa(this.symbolLayer,{color:t,transparent:t[3]<1||this.needsDrivenTransparentPass,polygonOffset:!1,vertexColors:!0,writeLinearDepth:!0,slicePlaneEnabled:this._context.slicePlaneEnabled},{isDraped:this.draped}),this._needsUV=this._material instanceof Ha,this._context.stage.add(this._material)}ensureOutlineMaterial(){const e=this.symbolLayer.outline;if(Object(n["l"])(this._outlineMaterial)||!this._isValidOutline(e))return;this._hasOutline=!0;const t=t=>{const i=Object(Et["b"])(e.pattern);return new Dt["a"]({width:t,color:this._getOutlineColor(),polygonOffset:!0,slicePlaneEnabled:this._context.slicePlaneEnabled,isClosed:!0,stipplePattern:i,stippleScaleWithLineWidth:!0,cap:Object(Rt["d"])(e.patternCap||"butt")})};this._outlineMaterial=t(Object(je["h"])(e.size)),this._context.stage.add(this._outlineMaterial)}_isValidOutline(e){return Object(n["l"])(e)&&e.size&&e.size>0&&Object(n["l"])(e.color)&&(Object(n["k"])(e.pattern)||"style"!==e.pattern.type||"none"!==e.pattern.style)}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null,this._context.stage.remove(this._outlineMaterial),this._outlineMaterial=null}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry,is,this.symbolLayer.type))return null;const i=this._getVertexOpacityAndColor(e.renderingInfo,255),r=this.setGraphicElevationContext(t,new F["a"]);return this.ensureDrapedStatus("on-the-ground"===r.mode),this.ensureMaterials(),this.draped?this._createAsOverlay(t,i):this._createAs3DShape(t,i,r)}layerOpacityChanged(){if(Object(n["l"])(this._material)){const e=this._material.parameters.color,t=Object(n["j"])(this.symbolLayer,"material","color"),i=this._getCombinedOpacity(t);this._material.setParameters({color:[e[0],e[1],e[2],i],transparent:i<1||this.needsDrivenTransparentPass})}if(Object(n["l"])(this._outlineMaterial)){const e=this._outlineMaterial.parameters.color;this._outlineMaterial.setParameters({color:[e[0],e[1],e[2],this._getOutlineOpacity()]})}return!0}layerElevationInfoChanged(e,t,i){const r=this._elevationContext.mode,n=Object(I["e"])(rs.elevationModeChangeTypes,i,r);if(n!==I["b"].UPDATE)return n;const a=Object(I["h"])(r);return this.updateGraphics3DGraphicElevationInfo(e,t,()=>a)}slicePlaneEnabledChanged(){if(Object(n["l"])(this._material)&&this._material.setParameters({slicePlaneEnabled:this._context.slicePlaneEnabled}),Object(n["l"])(this._outlineMaterial)){const e={slicePlaneEnabled:this._context.slicePlaneEnabled};this._outlineMaterial.setParameters(e)}return!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}_createAs3DShape(e,t,i){const r=q(e.geometry);if(Object(n["k"])(r))return null;as.renderData=H(r,this._context.elevationProvider,this._context.renderCoordsHelper,i),as.color=t;const a=as.renderData.position.length/3;if(this._needsUV&&(as.uvMapSpace=new Float32Array(4*a),as.boundingRect=new Float64Array(9*a)),as.outNum=0,as.outGeometries=[],as.outTransforms=[],as.outMaterials=[],this._createAs3DShapeFill(as),this._hasOutline&&this._createAs3DShapeOutline(as),this._logGeometryCreationWarnings(as.renderData,r.rings,"rings","FillSymbol3DLayer"),0===as.outNum)return null;this._needsUV&&ma(R["C"].fromTypedArray(as.uvMapSpace),R["v"].fromTypedArray(as.renderData.position),this._context.renderCoordsHelper,R["g"].fromTypedArray(as.boundingRect));const s=new K["a"]({geometries:as.outGeometries,materials:as.outMaterials,transformations:as.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:e.uid}}),o=new j["a"](this,s,as.outGeometries,null,null,ts,i);return o.alignedSampledElevation=as.renderData.sampledElevation,o.needsElevationUpdates=Object(I["h"])(i.mode),o}_createAs3DShapeFill(e){const t=e.renderData.polygons;for(const{position:i,mapPosition:r,holeIndices:a,index:s,count:o}of t){if(Object(n["l"])(this._context.clippingExtent)&&(Object(f["k"])(ns),Object(f["n"])(ns,r),!Object(f["x"])(ns,this._context.clippingExtent)))continue;const t=Object(T["a"])(r,a,3);if(0===t.length)continue;const c=new Uint32Array(t),l=N({indices:c,attributeData:{position:i,color:e.color,mapPosition:r,uvMapSpace:this._needsUV?new Float32Array(e.uvMapSpace.buffer,4*s*e.uvMapSpace.BYTES_PER_ELEMENT,4*o):null,boundingRect:this._needsUV?new Float64Array(e.boundingRect.buffer,9*s*e.boundingRect.BYTES_PER_ELEMENT,9*o):null}});e.outGeometries.push(l),e.outMaterials.push(Object(n["u"])(this._material)),e.outTransforms.push(M["a"]),e.outNum++}}_createAs3DShapeOutline(e){if(!this._hasOutline)return;const t=e.renderData.outlines;for(let i=0;i<t.length;++i){const{mapPosition:r,position:a}=t[i];if(Object(n["l"])(this._context.clippingExtent)&&(Object(f["k"])(ns),Object(f["n"])(ns,r),!Object(f["x"])(ns,this._context.clippingExtent)))continue;const s=Object(Rt["a"])({overlayInfo:null,removeDuplicateStartEnd:1,attributeData:{position:a,mapPosition:r}}),o=s.vertexAttributes.get("position");o.data===a&&(o.data=new Float64Array(a)),e.outGeometries.push(s),e.outMaterials.push(Object(n["u"])(this._outlineMaterial)),e.outTransforms.push(M["a"]),e.outNum++}}_createAsOverlay(e,t){const i=q(e.geometry);if(Object(n["k"])(i))return null;Object(n["u"])(this._material).renderPriority=this._renderPriority+this._renderPriorityStep/2,Object(n["l"])(this._outlineMaterial)&&(this._outlineMaterial.renderPriority=this._renderPriority),ss.renderData=W(i,this._context.overlaySR),ss.color=t;const r=ss.renderData.position.length/3;return this._needsUV&&(ss.uvMapSpace=new Float32Array(4*r)),ss.outNum=0,ss.outGeometries=[],ss.outBoundingBox=Object(f["k"])(),ss.layerUid=this._context.layer.uid,ss.graphicsUid=e.uid,this._createAsOverlayFill(ss),this._hasOutline&&this._createAsOverlayOutline(ss),this._logGeometryCreationWarnings(ss.renderData,i.rings,"rings","FillSymbol3DLayer"),0===ss.outNum?null:(this._needsUV&&ba(R["C"].fromTypedArray(ss.uvMapSpace),R["v"].fromTypedArray(ss.renderData.position),this._context.overlaySR,this._context.layerView.view.state.viewingMode),ss.outNum>0?new De(this,ss.outGeometries,ss.outBoundingBox):null)}_createAsOverlayFill(e){const t=e.renderData.polygons;for(const{position:i,holeIndices:r,index:a,count:s}of t){if(Object(f["k"])(ns),Object(f["n"])(ns,i),!Object(f["x"])(ns,this._context.clippingExtent))continue;const t=Object(T["a"])(i,r,3);if(0===t.length)continue;Object(f["m"])(e.outBoundingBox,ns);const o=new Uint32Array(t),c=N({indices:o,attributeData:{position:i,color:e.color,uvMapSpace:this._needsUV?new Float32Array(e.uvMapSpace.buffer,4*a*e.uvMapSpace.BYTES_PER_ELEMENT,4*s):null}}),l=new pt["a"](c,Object(n["u"])(this._material),e.layerUid,e.graphicsUid),d=ns;Object(Se["l"])(l.boundingSphere,.5*(d[0]+d[3]),.5*(d[1]+d[4]),0,.5*Math.sqrt((d[3]-d[0])*(d[3]-d[0])+(d[4]-d[1])*(d[4]-d[1]))),e.outGeometries.push(l),e.outNum++}}_createAsOverlayOutline(e){if(!this._hasOutline)return;const t=e.renderData.outlines;for(let i=0;i<t.length;++i){const{position:r}=t[i];if(Object(f["k"])(ns),Object(f["n"])(ns,r),!Object(f["x"])(ns,this._context.clippingExtent))continue;Object(f["m"])(e.outBoundingBox,ns);const a=Object(Rt["a"])({overlayInfo:{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper},removeDuplicateStartEnd:1,attributeData:{position:r}}),s=new pt["a"](a,Object(n["u"])(this._outlineMaterial),e.layerUid,e.graphicsUid),o=ns;Object(Se["l"])(s.boundingSphere,.5*(o[0]+o[3]),.5*(o[1]+o[4]),0,.5*Math.sqrt((o[3]-o[0])*(o[3]-o[0])+(o[4]-o[1])*(o[4]-o[1]))),e.outGeometries.push(s),e.outNum++}}_getOutlineOpacity(){const e=Object(n["j"])(this.symbolLayer,"outline","color");return(this.draped?1:this._getLayerOpacity())*(Object(n["l"])(e)?e.a:0)}_getOutlineColor(){const e=Object(n["j"])(this.symbolLayer,"outline","color"),t=this._getOutlineOpacity();return Object(L["g"])(Object(n["l"])(e)?_e["a"].toUnitRGB(e):null,t)}get test(){return{createAsOverlay:(e,t)=>this._createAsOverlay(e,t),createAs3DShape:(e,t,i)=>this._createAs3DShape(e,t,i)}}}rs.elevationModeChangeTypes={definedChanged:I["b"].RECREATE,staysOnTheGround:I["b"].NONE,onTheGroundChanged:I["b"].RECREATE};const ns=Object(f["h"])(),as={renderData:null,color:null,uvMapSpace:null,boundingRect:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},ss={renderData:null,color:null,uvMapSpace:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null};var os=i("38bf"),cs=i("a37d"),ls=i("003f"),ds=i("0494"),hs=i("a1ff"),us=i("c514");class ps extends ls["a"]{constructor(e,t,i){super(),this.type=4,this._glTexture=null,this.events=new ji["a"],this._requiresPowerOfTwo=!Object(us["a"])(e.gl),this._renderer=new ds["a"](t,i)}get width(){return this._renderer.renderedWidth}get height(){return this._renderer.renderedHeight}get textureWidth(){const e=this.width;return this._requiresPowerOfTwo?Object(Ue["n"])(e):e}get textureHeight(){const e=this.height;return this._requiresPowerOfTwo?Object(Ue["n"])(e):e}get displayWidth(){return this._renderer.displayWidth}get displayHeight(){return this._renderer.displayHeight}get texcoordScale(){return[this._renderer.renderedWidth/this.textureWidth,this._renderer.renderedHeight/this.textureHeight]}get requiresFrameUpdates(){return!1}createDescriptor(e){return{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,flipped:!0,samplingMode:9987,hasMipmap:!0,preMultiplyAlpha:!0,maxAnisotropy:e.parameters.maxMaxAnisotropy}}get glTexture(){return this._glTexture}load(e){if(Object(n["l"])(this._glTexture))return this._glTexture;const t=Object(ds["b"])(fs,this.textureWidth,this.textureHeight),i=t.getContext("2d");return i.save(),this._renderer.render(i,0,this.textureHeight-this._renderer.renderedHeight),this._glTexture=new hs["a"](e,this.createDescriptor(e),t),i.restore(),this._glTexture}unload(){Object(n["l"])(this._glTexture)&&(this._glTexture.dispose(),this._glTexture=null),this.events.emit("unloaded")}}const fs={canvas:null},bs=[0,0,1];class ms extends z["a"]{constructor(e,t,i,r){super(e,t,i,r),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const e=Object(L["k"])(this.symbolLayer.size);if(e)throw new S["a"]("graphics3dtextsymbollayer:invalid-size",e)}this._createTextRenderParameters()}_createTextRenderParameters(){const e=this._context.layerView.view.pixelRatio;this._textRenderParameters=cs["a"].fromSymbol(this.symbolLayer,e)}destroy(){super.destroy()}createGraphics3DGraphic(e){const t=e.graphic,i=Object(Ve["d"])(t.geometry);if(Object(n["k"])(i))return this.logger.warn("unsupported geometry type for text symbol: "+t.geometry.type),null;const r=this.symbolLayer.text;if(!r)return null;const a=Object(os["d"])(this.symbol)&&this.symbol.hasVisibleVerticalOffset()?this.symbol:null;return this._createAs3DShape(t,i,r,a)}createLabel(e,t,i,r){const a=e.graphic,s=Object(Ve["d"])(a.geometry);if(Object(n["k"])(s))return this.logger.warn("unsupported geometry type for label: "+a.geometry.type),null;const o=t.text;return!o||/^\s+$/.test(o)?null:this._createAs3DShape(a,s,o,t,t,i,r)}setGraphicElevationContext(e,t,i=0){const r=super.setGraphicElevationContext(e,t);return r.addOffsetRenderUnits(i),r}layerOpacityChanged(){return this.logger.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer"),!1}layerElevationInfoChanged(e,t){return gs(e,t,(e,t)=>{this.updateGraphicElevationContext(t,e)}),I["b"].UPDATE}slicePlaneEnabledChanged(e,t){return gs(e,t,e=>{for(const t of e.stageObject.geometryRecords)t.material.setParameters({slicePlaneEnabled:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!1}updateGraphicElevationContext(e,t){this.setGraphicElevationContext(e,t.elevationContext,t.metadata.elevationOffset),t.needsElevationUpdates=Object(I["h"])(t.elevationContext.mode)||"absolute-height"===t.elevationContext.mode}_defaultElevationInfoNoZ(){return vs}_createAs3DShape(e,t,i,r,a=ys,s,o){const c=this.setGraphicElevationContext(e,new F["a"],a.elevationOffset),d="polyline"===Object(n["j"])(e.geometry,"type"),h=e.uid,u=this._context.stage.renderView.renderingContext,p=a.anchor in L["h"]?a.anchor:"center",f=L["h"][p],b=Object(n["k"])(o)?new ps(u,i,this._textRenderParameters):null,m={occlusionTest:!0,screenOffset:a.screenOffset,anchorPos:f,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:a.centerOffsetUnits,debugDrawBorder:a.debugDrawBorder,drawInSecondSlot:!0};if(Object(n["l"])(b)&&(m.textureId=b.id,m.texCoordScale=b.texcoordScale),Object(n["l"])(o)&&(m.textureId=o.id),Object(n["l"])(r)&&Object(n["l"])(r.verticalOffset)){const{screenLength:e,minWorldLength:t,maxWorldLength:i}=r.verticalOffset;m.verticalOffset={screenLength:Object(je["h"])(e),minWorldLength:t||0,maxWorldLength:null!=i?i:1/0}}if(this._context.screenSizePerspectiveEnabled){const{screenSizePerspectiveSettings:e,screenSizePerspectiveSettingsLabels:t}=this._context.sharedResources;m.screenSizePerspective=t.overridePadding(this._textRenderParameters.haloSize),m.screenSizePerspectiveAlignment=e}let g;if(d&&(m.shaderPolygonOffset=1e-4),m.slicePlaneEnabled=this._context.slicePlaneEnabled,Object(n["l"])(s)){const e=JSON.stringify(m);g=s.get(e),Object(n["k"])(g)&&(g=new bt["a"](m),s.add(e,g))}else g=new bt["a"](m);const v=[g],y=a.translation,O=Object(n["l"])(b)?[b.displayWidth,b.displayHeight]:[0,0],_=a.centerOffset,x=bs,w=[0,0],S=[ut["a"].createPointGeometry(x,y,null,O,_,w,null)],T=this._context.layer.uid,C=Object(Ve["a"])(this._context,t,S,v,c,T,h);if(null===C)return null;const P=new j["a"](this,C.object,S,Object(n["k"])(s)?v:null,Object(n["l"])(b)?[b]:null,Ee["b"],c);P.alignedSampledElevation=C.sampledElevation,P.needsElevationUpdates=Object(I["h"])(c.mode)||"absolute-height"===c.mode;const{displayWidth:A,displayHeight:M}=Object(n["l"])(b)?b:a;P.getScreenSize=(e=Object(l["b"])())=>(e[0]=A,e[1]=M,e);const R={labelText:i,elevationOffset:a.elevationOffset};return P.metadata=R,Object(Ve["b"])(P,t,this._context.elevationProvider),P}}function gs(e,t,i){e&&e.forEach(e=>{const r=t(e);Object(n["l"])(r)&&i(r,e.graphic)})}const vs={mode:"relative-to-ground",offset:0},ys={text:null,translation:[0,0,0],elevationOffset:0,centerOffset:[0,0,0,1],screenOffset:[0,0],anchor:"center",verticalOffset:null,centerOffsetUnits:null,debugDrawBorder:!1,displayWidth:0,displayHeight:0};var Os=i("8048"),_s=i("1f93"),xs=i("b855");const js=["polyline","polygon","extent"];class ws extends z["a"]{constructor(e,t,i,r){super(e,t,i,r)}async doLoad(){}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry,js,this.symbolLayer.type))return null;const i=this.setGraphicElevationContext(t,new F["a"]);return this.ensureDrapedStatus("on-the-ground"===i.mode),this.ensureMaterial(),this.draped?this._createAsOverlay(t):this._createAs3DShape(t,i,t.uid)}ensureMaterial(){if(Object(n["l"])(this._material))return;const e={...xs["a"]},t=this.symbolLayer.color;Object(n["l"])(t)&&(e.color=_e["a"].toUnitRGBA(t));const i=this._getCombinedOpacity(t,{hasIntrinsicColor:!0});e.color=[e.color[0],e.color[1],e.color[2],i],e.transparent=i<1||this.needsDrivenTransparentPass,e.waveDirection=Object(n["l"])(this.symbolLayer.waveDirection)?ws.headingVectorFromAngle(this.symbolLayer.waveDirection):Object(l["f"])(0,0);const r=this.symbolLayer.waveStrength+"-"+this.symbolLayer.waterbodySize,a=xs["b"][r];e.waveStrength=a.waveStrength,e.waveTextureRepeat=a.textureRepeat,e.waveVelocity=a.waveVelocity,e.flowStrength=a.perturbationStrength,e.slicePlaneEnabled=this._context.slicePlaneEnabled,e.isDraped=this.draped,this._material=new _s["a"](e),this._context.stage.add(this._material)}layerOpacityChanged(){if(Object(n["k"])(this._material))return!0;const e=this._material.parameters.color,t=this._getCombinedOpacity(this.symbolLayer.color,{hasIntrinsicColor:!0}),i=t<1||this.needsDrivenTransparentPass;return this._material.setParameters({color:[e[0],e[1],e[2],t],transparent:i}),!0}layerElevationInfoChanged(e,t,i){const r=this._elevationContext.mode,n=Object(I["e"])(ws.elevationModeChangeTypes,i,r);if(n!==I["b"].UPDATE)return n;const a=Object(I["h"])(r);return this.updateGraphics3DGraphicElevationInfo(e,t,()=>a)}slicePlaneEnabledChanged(){return Object(n["l"])(this._material)&&this._material.setParameters({slicePlaneEnabled:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}_createAs3DShape(e,t,i){const r=q(e.geometry);if(Object(n["k"])(r))return null;As.renderData=H(r,this._context.elevationProvider,this._context.renderCoordsHelper,t);const a=As.renderData.position.length/3;if(As.uvCoords=new Float64Array(2*a),As.outNum=0,As.outGeometries=[],As.outTransforms=[],As.outMaterials=[],this._create3DShapeGeometries(As),this._logGeometryCreationWarnings(As.renderData,r.rings,"rings","WaterSymbol3DLayer"),0===As.outNum)return null;this._createUVCoordsFromVertices(As.uvCoords,As.renderData.mapPosition,a,this._context.elevationProvider.spatialReference);const s=new K["a"]({geometries:As.outGeometries,materials:As.outMaterials,transformations:As.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:i}}),o=new j["a"](this,s,As.outGeometries,null,null,Ee["c"],t);return o.alignedSampledElevation=As.renderData.sampledElevation,o.needsElevationUpdates=Object(I["h"])(t.mode),o}_createUVCoordsFromVertices(e,t,i,r){const n=Object(Os["f"])(r);Object(b["o"])(Ts);for(let o=0;o<i;o++)Object(c["s"])(Cs,t[3*o+0],t[3*o+1]),Object(b["r"])(Ts,Cs);Object(Se["b"])(Ts,Ts,n);const a=Ts[0]%ws.unitSizeOfTexture,s=Ts[1]%ws.unitSizeOfTexture;Ss[0]=Ts[0]-a,Ss[1]=Ts[1]-s;for(let o=0;o<i;o++)e[2*o+0]=(t[3*o+0]*n-Ss[0])/ws.unitSizeOfTexture,e[2*o+1]=(t[3*o+1]*n-Ss[1])/ws.unitSizeOfTexture}_create3DShapeGeometries(e){const t=e.renderData.polygons,i=e.uvCoords;for(const{count:r,index:a,position:s,mapPosition:o,holeIndices:c}of t){if(Object(n["l"])(this._context.clippingExtent)&&(Object(f["k"])(Ps),Object(f["n"])(Ps,o),!Object(f["x"])(Ps,this._context.clippingExtent)))continue;const t=Object(T["a"])(o,c,3);if(0===t.length)continue;const l=new Uint32Array(t),d=new Float64Array(i.buffer,2*a*i.BYTES_PER_ELEMENT,2*r),h=G({indices:l,attributeData:{position:s,uv0:d,mapPosition:o}});e.outGeometries.push(h),e.outMaterials.push(Object(n["u"])(this._material)),e.outTransforms.push(M["a"]),e.outNum++}}_createAsOverlay(e){const t=q(e.geometry);if(Object(n["k"])(t))return null;Object(n["u"])(this._material).renderPriority=this._renderPriority,Ms.renderData=W(t,this._context.overlaySR);const i=Ms.renderData.position.length/3;return Ms.uvCoords=new Float64Array(2*i),Ms.outNum=0,Ms.outGeometries=[],Ms.outBoundingBox=Object(f["k"])(),Ms.layerUid=this._context.layer.uid,Ms.graphicsUid=e.uid,this._createAsOverlayWater(Ms),this._logGeometryCreationWarnings(Ms.renderData,t.rings,"rings","WaterSymbol3DLayer"),0===Ms.outNum?null:(this._createUVCoordsFromVertices(Ms.uvCoords,Ms.renderData.position,i,this._context.overlaySR),Ms.outNum>0?new De(this,Ms.outGeometries,Ms.outBoundingBox):null)}_createAsOverlayWater(e){const t=e.uvCoords,i=e.renderData.polygons;for(const{position:r,holeIndices:a,index:s,count:o}of i){if(Object(f["k"])(Ps),Object(f["n"])(Ps,r),!Object(f["x"])(Ps,this._context.clippingExtent))continue;Object(f["m"])(e.outBoundingBox,Ps);const i=Object(T["a"])(r,a,3);if(0===i.length)continue;const c=new Uint32Array(i),l=new Float64Array(t.buffer,2*s*t.BYTES_PER_ELEMENT,2*o),d=G({indices:c,attributeData:{position:r,uv0:l}}),h=new pt["a"](d,Object(n["u"])(this._material),e.layerUid,e.graphicsUid),u=Ps;Object(Se["l"])(h.boundingSphere,.5*(u[0]+u[3]),.5*(u[1]+u[4]),0,.5*Math.sqrt((u[3]-u[0])*(u[3]-u[0])+(u[4]-u[1])*(u[4]-u[1]))),e.outGeometries.push(h),e.outNum++}}static headingVectorFromAngle(e){const t=Object(l["b"])(),i=Object(gr["d"])(e);return t[0]=Math.sin(i),t[1]=Math.cos(i),t}get test(){return{create3DShape:e=>this._createAs3DShape(e.graphic,e.elevationContext,e.graphicUid),ensureMaterial:()=>this.ensureMaterial()}}}ws.unitSizeOfTexture=100,ws.elevationModeChangeTypes={definedChanged:I["b"].RECREATE,staysOnTheGround:I["b"].NONE,onTheGroundChanged:I["b"].RECREATE};const Ss=Object(l["b"])(),Ts=Object(b["m"])(),Cs=Object(l["b"])(),Ps=Object(f["h"])(),As={renderData:null,uvCoords:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},Ms={renderData:null,uvCoords:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},Rs=w["a"].getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory");function Es(e,t,i,r){const n=Is[e.type]&&Is[e.type][t.type]||Ds[t.type];return n?new n(e,t,i,r):(Rs.error("GraphicsLayerFactory#make","unknown symbol type "+t.type),null)}const Ds={icon:St,object:hr,line:Ft,path:ea,fill:rs,extrude:te,text:ms,water:ws};const Is={"mesh-3d":{fill:Gt}};var Fs=i("5e82");class zs extends Fs["a"]{constructor(e,t,i){super(t.schedule),this._symbol=e,this._context=t,this._backgroundLayers=i,this._destroyed=!1,this.symbolLayers=new Array,this.referenced=0,this._extentPadding=0}set symbol(e){this._symbol=e;for(let t=0;t<e.symbolLayers.length;t++){const i=this.symbolLayers[t];Object(n["k"])(i)||(i.symbol=e,i.symbolLayer=e.symbolLayers.items[t])}}get symbol(){return this._symbol}async doLoad(e){let t=this._symbol.symbolLayers;this._extentPadding=0,this._backgroundLayers&&(t=this._backgroundLayers.concat(t));const i=t.length;for(;this.symbolLayers.length<t.length;)this.symbolLayers.push(null);this.symbolLayers.length=t.length;const s=[];for(let r=0;r<i;r++){const n=t.getItemAt(r);if(!1===n.enabled)continue;Ls.renderPriority=1-(1+r)/i,Ls.renderPriorityStep=1/i,Ls.ignoreDrivers=n._ignoreDrivers;const o=Es(this.symbol,n,this._context,Ls);s.push(Object(a["s"])(e,()=>{this.symbolLayers[r]=null,o.destroy()})),this.symbolLayers[r]=o}await Object(r["b"])(this.symbolLayers,async(e,t)=>{if(Object(n["l"])(e))try{await e.load(),this._extentPadding+=Math.max(this._extentPadding,e.extentPadding)}catch{this.symbolLayers[t]=null}});for(const r of s)null==r||r.remove();if(s.length=0,Object(a["w"])(e),this.symbolLayers.length&&!this.symbolLayers.some(e=>!!e))throw new Error}getSymbolLayerSize(e){const t=this.symbolLayers[e];return Object(n["l"])(t)?t.getCachedSize():null}get extentPadding(){return this._extentPadding}createGraphics3DGraphic(e,t){const i=e.graphic,r=new Array(this.symbolLayers.length);for(let s=0;s<this.symbolLayers.length;s++){const t=this.symbolLayers[s];r[s]=Object(n["l"])(t)?t.createGraphics3DGraphic(e):null}const a=this._context.arcade||this._context.featureExpressionInfoContext&&this._context.featureExpressionInfoContext.arcade&&this._context.featureExpressionInfoContext.arcade.modules||null;return new _(i,t||this,r,e.layer,a)}get complexity(){return Object(gi["f"])(this.symbolLayers.map(e=>Object(n["j"])(e,"complexity")))}globalPropertyChanged(e,t){const i=this.symbolLayers.length;for(let r=0;r<i;r++){const i=this.symbolLayers[r],a=e=>{const t=e.graphics[r];return t instanceof j["a"]?t:null};if(Object(n["l"])(i)&&!i.globalPropertyChanged(e,t,a))return!1}return!0}applyRendererDiff(e,t){return 1!==this.loadStatus?0:this.symbolLayers.reduce((i,r)=>0!==i&&Object(n["l"])(r)?Math.min(i,r.applyRendererDiff(e,t)):i,2)}prepareSymbolPatch(e){if(2===this.loadStatus)return;if("partial"!==e.diff.type)return;const t=e.diff.diff;if(!t.symbolLayers||"partial"!==t.symbolLayers.type)return;const i=t.symbolLayers.diff;this.symbolLayers.forEach((t,r)=>{if(Object(n["k"])(t))return;const a=i[r];if(a){const i={diff:a,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};t.prepareSymbolLayerPatch(i),e.symbolStatePatches.push(...i.symbolLayerStatePatches),i.graphics3DGraphicPatches.length&&e.graphics3DGraphicPatches.push((e,t)=>{const a=e.graphics[r];Object(n["l"])(a)&&i.graphics3DGraphicPatches.forEach(e=>e(a,t))})}})}updateGeometry(e,t){for(let i=0;i<this.symbolLayers.length;i++){const r=this.symbolLayers[i];if(Object(n["k"])(r))continue;const a=e.graphics[i];if(Object(n["k"])(a)||!r.updateGeometry(a,t))return!1}return!0}onRemoveGraphic(e){for(let t=0;t<this.symbolLayers.length;t++){const i=this.symbolLayers[t];if(Object(n["k"])(i))continue;const r=e.graphics[t];Object(n["l"])(r)&&i.onRemoveGraphic(r)}}getFastUpdateStatus(){let e=0,t=0,i=0;return this.symbolLayers.forEach(r=>{Object(n["k"])(r)||(0===r.loadStatus?e++:r.isFastUpdatesEnabled()?i++:t++)}),{loading:e,slow:t,fast:i}}destroy(){if(this.destroyed)console.error("Graphics3DSymbol.destroy called when already destroyed!");else{super.destroy();for(const e of this.symbolLayers)Object(n["l"])(e)&&e.destroy();this.symbolLayers.length=0,this._destroyed=!0}}get destroyed(){return this._destroyed}}const Ls={renderPriority:0,renderPriorityStep:1,ignoreDrivers:!1}},6415:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("e92d");const n=r["a"].getLogger("esri.views.3d.support.buffer.math")},"65c9":function(e,t,i){"use strict";i.d(t,"a",(function(){return u})),i.d(t,"b",(function(){return h}));var r=i("2aad"),n=i("6a07"),a=i("d047"),s=i("d017"),o=i("58c2"),c=i("501b"),l=i("3886"),d=i("690a");function h(e){const t=new d["a"];return t.include(s["a"]),t.fragment.include(c["a"]),t.fragment.include(a["a"]),t.include(o["a"]),t.include(r["a"]),t.fragment.uniforms.add("defaultDepthTex","sampler2D").add("highlightDepthTex","sampler2D").add("depthMap","sampler2D").add("highlightMap","sampler2D").add("color","vec4").add("nearFar","vec2").add("opacity","float").add("occludedOpacity","float").add("terminationFactor","float").add("inverseView","mat4").add("lightingMainDirectionView","vec3").add("texelSize","vec2"),t.fragment.constants.add("unoccludedHighlightFlag","vec4",n["c"]).add("highlightedThreshold","float",e.highlightedThreshold).add("selfShadowThreshold","float",e.selfShadowThreshold),t.fragment.code.add(l["a"]`vec3 normalFromDepth(vec3 pixelPos, vec2 fragCoord, vec2 uv, vec2 texelSize, sampler2D depthMap, vec2 nearFar) {
float leftPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(-1.0, 0.0) * texelSize, nearFar);
float rightPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(1.0, 0.0) * texelSize, nearFar);
float bottomPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, -1.0) * texelSize, nearFar);
float topPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, 1.0) * texelSize, nearFar);
bool pickLeft = abs(pixelPos.z - leftPixelDepth) < abs(pixelPos.z - rightPixelDepth);
bool pickBottom = abs(pixelPos.z - bottomPixelDepth) < abs(pixelPos.z - topPixelDepth);
vec3 fragCoordHorizontal = pickLeft
? vec3(fragCoord + vec2(-1.0, 0.0), leftPixelDepth)
: vec3(fragCoord + vec2(1.0, 0.0), rightPixelDepth);
vec3 fragCoordVertical = pickBottom
? vec3(fragCoord + vec2(0.0, -1.0), bottomPixelDepth)
: vec3(fragCoord + vec2(0.0, 1.0), topPixelDepth);
vec3 verticalPixelPos = reconstructPosition(fragCoordHorizontal.xy, fragCoordHorizontal.z);
vec3 horizontalPixelPos = reconstructPosition(fragCoordVertical.xy, fragCoordVertical.z);
vec3 normal = normalize(cross(verticalPixelPos - pixelPos, horizontalPixelPos - pixelPos));
return pickLeft == pickBottom ? normal : -normal;
}`),t.fragment.code.add(l["a"]`void main(void) {
vec4 highlightInfo = texture2D(highlightMap, uv);
float visiblyHighlighted = (1.0 - clamp(distance(unoccludedHighlightFlag, highlightInfo), 0.0, 1.0)) * highlightInfo.a;
if (visiblyHighlighted > highlightedThreshold) {
discard;
}
float depth = rgba2float(texture2D(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseView * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= uShadowMapNum) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthHighlight = readShadowMapDepth(uvShadow, highlightDepthTex);
bool shadowHighlight = depthHighlight < lvpos.z;
if (!shadowHighlight) {
discard;
}
float depthDefault = readShadowMapDepth(uvShadow, defaultDepthTex);
bool shadowDefault = depthDefault < lvpos.z;
vec3 normal = normalFromDepth(currentPixelPos.xyz, gl_FragCoord.xy, uv, texelSize, depthMap, nearFar);
bool shaded = dot(normal, lightingMainDirectionView) < selfShadowThreshold;
float differenceOpacity = opacity;
float bothOpacity = occludedOpacity;
float fragOpacity = (shadowDefault || shaded) ? bothOpacity : differenceOpacity;
gl_FragColor = vec4(color.rgb, color.a * fragOpacity * terminationFactor);
}`),t}const u=Object.freeze({__proto__:null,build:h})},6611:function(e,t,i){"use strict";i.d(t,"a",(function(){return c}));var r=i("a4ee"),n=i("fc29"),a=i("59b2"),s=(i("b50f"),i("c120"),i("cea0"),i("d386"));let o=class extends n["a"]{constructor(){super(...arguments),this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,this.SCENEVIEW_LOCKING_LOG=!1,this.HIGHLIGHTS_GRID_OPTIMIZATION_ENABLED=!0,this.HIGHLIGHTS_PROFILE_TO_CONSOLE=!1,this.DECONFLICTOR_SHOW_VISIBLE=!1,this.DECONFLICTOR_SHOW_INVISIBLE=!1,this.DECONFLICTOR_SHOW_GRID=!1,this.LABELS_SHOW_BORDER=!1,this.OVERLAY_DRAW_DEBUG_TEXTURE=!1,this.OVERLAY_SHOW_CENTER=!1,this.SHOW_POI=!1,this.TESTS_DISABLE_OPTIMIZATIONS=!1,this.TESTS_DISABLE_FAST_UPDATES=!1,this.DRAW_MESH_GEOMETRY_NORMALS=!1,this.FEATURE_TILE_FETCH_SHOW_TILES=!1,this.FEATURE_TILE_TREE_SHOW_TILES=!1,this.TERRAIN_TILE_TREE_SHOW_TILES=!1,this.I3S_TREE_SHOW_TILES=!1,this.I3S_SHOW_MODIFICATIONS=!1,this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1}};Object(r["a"])([Object(a["b"])()],o.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),Object(r["a"])([Object(a["b"])()],o.prototype,"SCENEVIEW_LOCKING_LOG",void 0),Object(r["a"])([Object(a["b"])()],o.prototype,"HIGHLIGHTS_GRID_OPTIMIZATION_ENABLED",void 0),Object(r["a"])([Object(a["b"])()],o.prototype,"HIGHLIGHTS_PROFILE_TO_CONSOLE",void 0),Object(r["a"])([Object(a["b"])()],o.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),Object(r["a"])([Object(a["b"])()],o.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),Object(r["a"])([Object(a["b"])()],o.prototype,"DECONFLICTOR_SHOW_GRID",void 0),Object(r["a"])([Object(a["b"])()],o.prototype,"LABELS_SHOW_BORDER",void 0),Object(r["a"])([Object(a["b"])()],o.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),Object(r["a"])([Object(a["b"])()],o.prototype,"OVERLAY_SHOW_CENTER",void 0),Object(r["a"])([Object(a["b"])()],o.prototype,"SHOW_POI",void 0),Object(r["a"])([Object(a["b"])()],o.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0),Object(r["a"])([Object(a["b"])()],o.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0),Object(r["a"])([Object(a["b"])()],o.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),Object(r["a"])([Object(a["b"])()],o.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),Object(r["a"])([Object(a["b"])()],o.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),Object(r["a"])([Object(a["b"])()],o.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),Object(r["a"])([Object(a["b"])()],o.prototype,"I3S_TREE_SHOW_TILES",void 0),Object(r["a"])([Object(a["b"])()],o.prototype,"I3S_SHOW_MODIFICATIONS",void 0),Object(r["a"])([Object(a["b"])()],o.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),Object(r["a"])([Object(a["b"])()],o.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),Object(r["a"])([Object(a["b"])()],o.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),o=Object(r["a"])([Object(s["a"])("esri.views.3d.support.DebugFlags")],o);const c=new o},"661c":function(e,t,i){"use strict";i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return a}));var r=i("38a4");function n(e,t,i=0){const n=Object(r["f"])(e,0,c);for(let r=0;r<4;r++)t[i+r]=Math.floor(256*l(n*s[r]))}function a(e,t=0){let i=0;for(let r=0;r<4;r++)i+=e[t+r]*o[r];return i}const s=[1,256,65536,16777216],o=[1/256,1/65536,1/16777216,1/4294967296],c=a(new Uint8ClampedArray([255,255,255,255]));function l(e){return e-Math.floor(e)}},"668b":function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return c})),i.d(t,"c",(function(){return o})),i.d(t,"d",(function(){return s})),i.d(t,"e",(function(){return n}));var r=i("6415");function n(e,t,i){if(e.count!==t.count)return void r["a"].error("source and destination buffers need to have the same number of elements");const n=e.count,a=i[0],s=i[1],o=i[2],c=i[4],l=i[5],d=i[6],h=i[8],u=i[9],p=i[10],f=i[12],b=i[13],m=i[14],g=e.typedBuffer,v=e.typedBufferStride,y=t.typedBuffer,O=t.typedBufferStride;for(let r=0;r<n;r++){const e=r*v,t=r*O,i=y[t],n=y[t+1],_=y[t+2];g[e]=a*i+c*n+h*_+f,g[e+1]=s*i+l*n+u*_+b,g[e+2]=o*i+d*n+p*_+m}}function a(e,t,i){if(e.count!==t.count)return void r["a"].error("source and destination buffers need to have the same number of elements");const n=e.count,a=i[0],s=i[1],o=i[2],c=i[3],l=i[4],d=i[5],h=i[6],u=i[7],p=i[8],f=e.typedBuffer,b=e.typedBufferStride,m=t.typedBuffer,g=t.typedBufferStride;for(let r=0;r<n;r++){const e=r*b,t=r*g,i=m[t],n=m[t+1],v=m[t+2];f[e]=a*i+c*n+h*v,f[e+1]=s*i+l*n+u*v,f[e+2]=o*i+d*n+p*v}}function s(e,t,i){const r=Math.min(e.count,t.count),n=e.typedBuffer,a=e.typedBufferStride,s=t.typedBuffer,o=t.typedBufferStride;for(let c=0;c<r;c++){const e=c*a,t=c*o;n[e]=i*s[t],n[e+1]=i*s[t+1],n[e+2]=i*s[t+2]}}function o(e,t){const i=Math.min(e.count,t.count),r=e.typedBuffer,n=e.typedBufferStride,a=t.typedBuffer,s=t.typedBufferStride;for(let o=0;o<i;o++){const e=o*n,t=o*s,i=a[t],c=a[t+1],l=a[t+2],d=Math.sqrt(i*i+c*c+l*l);if(d>0){const t=1/d;r[e]=t*i,r[e+1]=t*c,r[e+2]=t*l}}}function c(e,t,i){const r=Math.min(e.count,t.count),n=e.typedBuffer,a=e.typedBufferStride,s=t.typedBuffer,o=t.typedBufferStride;for(let c=0;c<r;c++){const e=c*a,t=c*o;n[e]=s[t]>>i,n[e+1]=s[t+1]>>i,n[e+2]=s[t+2]>>i}}Object.freeze({__proto__:null,transformMat4:n,transformMat3:a,scale:s,normalize:o,shiftRight:c})},"66af":function(e,t,i){"use strict";i.d(t,"a",(function(){return c}));var r=i("a4ee"),n=i("3795"),a=i("59b2"),s=(i("b50f"),i("c120"),i("cea0"),i("d386")),o=i("d2f2");const c=e=>{let t=class extends e{constructor(){super(...arguments),this.slicePlaneEnabled=!1,this.supportsHeightUnitConversion=!1}postscript(e){super.postscript(e),Object(o["b"])(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())}async _validateHeightModelInfo(){const e=Object(n["m"])(this.view.defaultsFromMap,"heightModelInfoReady");this.handles.add(e),await e;const t=Object(o["c"])(this.layer,this.view.heightModelInfo,this.supportsHeightUnitConversion);if(t)throw t}};return Object(r["a"])([Object(a["b"])()],t.prototype,"view",void 0),Object(r["a"])([Object(a["b"])()],t.prototype,"slicePlaneEnabled",void 0),t=Object(r["a"])([Object(s["a"])("esri.views.3d.layers.LayerView3D")],t),t}},"66b9":function(e,t,i){"use strict";i.d(t,"a",(function(){return m})),i.d(t,"b",(function(){return v}));var r=i("b2b2"),n=i("1c92"),a=i("8c71"),s=i("7ce4"),o=(i("d267"),i("c120"),i("1956"),i("d17d"),i("9f8b"),i("a1ff"),i("0fa6")),c=i("bc05");class l{constructor(e,t){this.layerUIDs=[],this.isDestroyed=!1,this.data=e,this.memoryUsed=e.byteLength;let i=1;const r=new Uint32Array(e);this.layerUIDs=[];const n=r[i++];for(let a=0;a<n;a++)this.layerUIDs[a]=r[i++];this.bufferDataOffset=i,t&&(this.layer=t.getStyleLayerByUID(this.layerUIDs[0]))}get isPreparedForRendering(){return Object(r["k"])(this.data)}get offset(){return this.bufferDataOffset}destroy(){this.isDestroyed||(this.doDestroy(),this.isDestroyed=!0)}prepareForRendering(e){Object(r["k"])(this.data)||(this.doPrepareForRendering(e,this.data,this.bufferDataOffset),this.data=null)}}class d extends l{constructor(e,t){super(e,t),this.type=2,this.lineIndexStart=0,this.lineIndexCount=0;const i=new Uint32Array(e);let r=this.bufferDataOffset;this.lineIndexStart=i[r++],this.lineIndexCount=i[r++];const n=i[r++];if(n>0){const e=new Map;for(let t=0;t<n;t++){const t=i[r++],n=i[r++],a=i[r++];e.set(t,[n,a])}this.patternMap=e}this.bufferDataOffset=r}hasData(){return this.lineIndexCount>0}triangleCount(){return this.lineIndexCount/3}doDestroy(){Object(r["l"])(this.lineVertexArrayObject)&&this.lineVertexArrayObject.dispose(),Object(r["l"])(this.lineVertexBuffer)&&this.lineVertexBuffer.dispose(),Object(r["l"])(this.lineIndexBuffer)&&this.lineIndexBuffer.dispose(),this.lineVertexArrayObject=null,this.lineVertexBuffer=null,this.lineIndexBuffer=null,this.memoryUsed=0}doPrepareForRendering(e,t,i){const r=new Uint32Array(t),n=new Int32Array(r.buffer),a=r[i++];this.lineVertexBuffer=s["a"].createVertex(e,35044,new Int32Array(n.buffer,4*i,a)),i+=a;const c=r[i++];this.lineIndexBuffer=s["a"].createIndex(e,35044,new Uint32Array(r.buffer,4*i,c)),i+=c;const l=this.layer.lineMaterial;this.lineVertexArrayObject=new o["a"](e,l.getAttributeLocations(),l.getLayoutInfo(),{geometry:this.lineVertexBuffer},this.lineIndexBuffer)}}class h extends l{constructor(e,t){super(e,t),this.type=1,this.fillIndexStart=0,this.fillIndexCount=0,this.outlineIndexStart=0,this.outlineIndexCount=0;const i=new Uint32Array(e);let r=this.bufferDataOffset;this.fillIndexStart=i[r++],this.fillIndexCount=i[r++],this.outlineIndexStart=i[r++],this.outlineIndexCount=i[r++];const n=i[r++];if(n>0){const e=new Map;for(let t=0;t<n;t++){const t=i[r++],n=i[r++],a=i[r++];e.set(t,[n,a])}this.patternMap=e}this.bufferDataOffset=r}hasData(){return this.fillIndexCount>0||this.outlineIndexCount>0}triangleCount(){return(this.fillIndexCount+this.outlineIndexCount)/3}doDestroy(){Object(r["l"])(this.fillVertexArrayObject)&&this.fillVertexArrayObject.dispose(),Object(r["l"])(this.fillVertexBuffer)&&this.fillVertexBuffer.dispose(),Object(r["l"])(this.fillIndexBuffer)&&this.fillIndexBuffer.dispose(),this.fillVertexArrayObject=null,this.fillVertexBuffer=null,this.fillIndexBuffer=null,Object(r["l"])(this.outlineVertexArrayObject)&&this.outlineVertexArrayObject.dispose(),Object(r["l"])(this.outlineVertexBuffer)&&this.outlineVertexBuffer.dispose(),Object(r["l"])(this.outlineIndexBuffer)&&this.outlineIndexBuffer.dispose(),this.outlineVertexArrayObject=null,this.outlineVertexBuffer=null,this.outlineIndexBuffer=null,this.memoryUsed=0}doPrepareForRendering(e,t,i){const r=new Uint32Array(t),n=new Int32Array(r.buffer),a=r[i++];this.fillVertexBuffer=s["a"].createVertex(e,35044,new Int32Array(n.buffer,4*i,a)),i+=a;const c=r[i++];this.fillIndexBuffer=s["a"].createIndex(e,35044,new Uint32Array(r.buffer,4*i,c)),i+=c;const l=r[i++];this.outlineVertexBuffer=s["a"].createVertex(e,35044,new Int32Array(n.buffer,4*i,l)),i+=l;const d=r[i++];this.outlineIndexBuffer=s["a"].createIndex(e,35044,new Uint32Array(r.buffer,4*i,d)),i+=d;const h=this.layer,u=h.fillMaterial,p=h.outlineMaterial;this.fillVertexArrayObject=new o["a"](e,u.getAttributeLocations(),u.getLayoutInfo(),{geometry:this.fillVertexBuffer},this.fillIndexBuffer),this.outlineVertexArrayObject=new o["a"](e,p.getAttributeLocations(),p.getLayoutInfo(),{geometry:this.outlineVertexBuffer},this.outlineIndexBuffer)}}class u extends l{constructor(e,t,i){super(e,t),this.type=3,this.iconPerPageElementsMap=new Map,this.glyphPerPageElementsMap=new Map,this.symbolInstances=[],this.isIconSDF=!1,this.opacityChanged=!1,this.lastOpacityUpdate=0,this.symbols=[];const r=new Uint32Array(e),n=new Int32Array(e),a=new Float32Array(e);let s=this.bufferDataOffset;this.isIconSDF=!!r[s++];const o=r[s++];for(let c=0;c<o;c++){const e=r[s++],t=r[s++],i=r[s++];this.iconPerPageElementsMap.set(e,[t,i])}const l=r[s++];for(let c=0;c<l;c++){const e=r[s++],t=r[s++],i=r[s++];this.glyphPerPageElementsMap.set(e,[t,i])}const d=r[s++],h=r[s++];this.iconOpacity=new Int32Array(d),this.textOpacity=new Int32Array(h),s=Object(c["b"])(r,n,a,s,this.symbols,i),this.bufferDataOffset=s}hasData(){return this.iconPerPageElementsMap.size>0||this.glyphPerPageElementsMap.size>0}triangleCount(){let e=0;for(const[t,i]of this.iconPerPageElementsMap)e+=i[1];for(const[t,i]of this.glyphPerPageElementsMap)e+=i[1];return e/3}doDestroy(){Object(r["l"])(this.iconVertexArrayObject)&&this.iconVertexArrayObject.dispose(),Object(r["l"])(this.iconVertexBuffer)&&this.iconVertexBuffer.dispose(),Object(r["l"])(this.iconOpacityBuffer)&&this.iconOpacityBuffer.dispose(),Object(r["l"])(this.iconIndexBuffer)&&this.iconIndexBuffer.dispose(),this.iconVertexArrayObject=null,this.iconVertexBuffer=null,this.iconOpacityBuffer=null,this.iconIndexBuffer=null,Object(r["l"])(this.textVertexArrayObject)&&this.textVertexArrayObject.dispose(),Object(r["l"])(this.textVertexBuffer)&&this.textVertexBuffer.dispose(),Object(r["l"])(this.textOpacityBuffer)&&this.textOpacityBuffer.dispose(),Object(r["l"])(this.textIndexBuffer)&&this.textIndexBuffer.dispose(),this.textVertexArrayObject=null,this.textVertexBuffer=null,this.textOpacityBuffer=null,this.textIndexBuffer=null,this.memoryUsed=0}updateOpacityInfo(){if(!this.opacityChanged)return;this.opacityChanged=!1;const e=Object(r["u"])(this.iconOpacity),t=Object(r["u"])(this.iconOpacityBuffer);e.length>0&&e.byteLength===t.size&&t.setSubData(e);const i=Object(r["u"])(this.textOpacity),n=Object(r["u"])(this.textOpacityBuffer);i.length>0&&i.byteLength===n.size&&n.setSubData(i)}doPrepareForRendering(e,t,i){const n=new Uint32Array(t),a=new Int32Array(n.buffer),c=n[i++];this.iconVertexBuffer=s["a"].createVertex(e,35044,new Int32Array(a.buffer,4*i,c)),i+=c;const l=n[i++];this.iconIndexBuffer=s["a"].createIndex(e,35044,new Uint32Array(n.buffer,4*i,l)),i+=l;const d=n[i++];this.textVertexBuffer=s["a"].createVertex(e,35044,new Int32Array(a.buffer,4*i,d)),i+=d;const h=n[i++];this.textIndexBuffer=s["a"].createIndex(e,35044,new Uint32Array(n.buffer,4*i,h)),i+=h,this.iconOpacityBuffer=s["a"].createVertex(e,35044,Object(r["u"])(this.iconOpacity).buffer),this.textOpacityBuffer=s["a"].createVertex(e,35044,Object(r["u"])(this.textOpacity).buffer);const u=this.layer,p=u.iconMaterial,f=u.textMaterial;this.iconVertexArrayObject=new o["a"](e,p.getAttributeLocations(),p.getLayoutInfo(),{geometry:this.iconVertexBuffer,opacity:this.iconOpacityBuffer},this.iconIndexBuffer),this.textVertexArrayObject=new o["a"](e,f.getAttributeLocations(),f.getLayoutInfo(),{geometry:this.textVertexBuffer,opacity:this.textOpacityBuffer},this.textIndexBuffer)}}class p extends l{constructor(e,t){super(e,t),this.type=4,this.circleIndexStart=0,this.circleIndexCount=0;const i=new Uint32Array(e);let r=this.bufferDataOffset;this.circleIndexStart=i[r++],this.circleIndexCount=i[r++],this.bufferDataOffset=r}hasData(){return this.circleIndexCount>0}triangleCount(){return this.circleIndexCount/3}doDestroy(){Object(r["l"])(this.circleVertexArrayObject)&&this.circleVertexArrayObject.dispose(),Object(r["l"])(this.circleVertexBuffer)&&this.circleVertexBuffer.dispose(),Object(r["l"])(this.circleIndexBuffer)&&this.circleIndexBuffer.dispose(),this.circleVertexArrayObject=null,this.circleVertexBuffer=null,this.circleIndexBuffer=null,this.memoryUsed=0}doPrepareForRendering(e,t,i){const r=new Uint32Array(t),n=new Int32Array(r.buffer),a=r[i++];this.circleVertexBuffer=s["a"].createVertex(e,35044,new Int32Array(n.buffer,4*i,a)),i+=a;const c=r[i++];this.circleIndexBuffer=s["a"].createIndex(e,35044,new Uint32Array(r.buffer,4*i,c)),i+=c;const l=this.layer.circleMaterial;this.circleVertexArrayObject=new o["a"](e,l.getAttributeLocations(),l.getLayoutInfo(),{geometry:this.circleVertexBuffer},this.circleIndexBuffer)}}var f=i("db21"),b=i("e4b1");class m extends b["a"]{constructor(e,t,i,r,n,a,s=null){super(e,t,i,r,n,4096,4096),this._memCache=s,this.type="vector-tile",this._referenced=0,this._hasSymbolBuckets=!1,this._memoryUsedByLayerData=0,this.layerData=new Map,this.layerCount=0,this.status="loading",this.allSymbolsFadingOut=!1,this.lastOpacityUpdate=0,this.symbols=new Map,this.isCoverage=!1,this.neededForCoverage=!1,this.decluttered=!1,this.invalidating=!1,this.parentTile=null,this.childrenTiles=new Set,this._processed=!1,this._referenced=1,this.styleRepository=a,this.id=e.id}get hasSymbolBuckets(){return this._hasSymbolBuckets}get isFading(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<f["d"]}get isHoldingForFade(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<f["d"])}get wasRequested(){return"errored"===this.status||"loaded"===this.status||"reloading"===this.status}setData(e){this.changeDataImpl(e),this.requestRender(),this.ready(),this.invalidating=!1,this._processed=!0}deleteLayerData(e){let t=!1;for(const i of e)if(this.layerData.has(i)){const e=this.layerData.get(i);this._memoryUsedByLayerData-=e.memoryUsed,3===e.type&&this.symbols.has(i)&&(this.symbols.delete(i),t=!0),e.destroy(),this.layerData.delete(i),this.layerCount--}Object(r["l"])(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData),t&&this.emit("symbols-changed"),this.requestRender()}processed(){return this._processed}hasData(){return this.layerCount>0}dispose(){"unloaded"!==this.status&&(g.delete(this),m._destroyRenderBuckets(this.layerData),this.layerData=null,this.layerCount=0,this._memoryUsedByLayerData=0,this.destroy(),this.status="unloaded")}release(){return 0==--this._referenced&&(this.dispose(),this.stage=null,!0)}retain(){++this._referenced}get referenced(){return this._referenced}get memoryUsage(){return(this._memoryUsedByLayerData+256)/(this._referenced||1)}changeDataImpl(e){let t=!1;if(e){const i=this._createRenderBuckets(e);for(const[e,r]of i){if(this.layerData.has(e)){const t=this.layerData.get(e);this._memoryUsedByLayerData-=r.memoryUsed,t.destroy(),this.layerData.delete(e),this.layerCount--}3===r.type&&(this.symbols.set(e,r.symbols),t=!0),this._memoryUsedByLayerData+=r.memoryUsed,this.layerData.set(e,r),this.layerCount++}Object(r["l"])(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData)}this._hasSymbolBuckets=!1;for(const[i,r]of this.layerData)3===r.type&&(this._hasSymbolBuckets=!0);t&&this.emit("symbols-changed")}attachWithContext(e){this.stage={context:e,trashDisplayObject(e){e.processDetach()},untrashDisplayObject:()=>!1}}setTransform(e,t){super.setTransform(e,t);const i=t/(e.resolution*e.pixelRatio),r=this.width/this.rangeX*i,a=this.height/this.rangeY*i,s=[0,0];e.toScreen(s,[this.x,this.y]);const o=this.transforms.tileUnitsToPixels;Object(n["b"])(o),Object(n["c"])(o,o,s),Object(n["m"])(o,o,Math.PI*e.rotation/180),Object(n["d"])(o,o,[r,a,1])}_createTransforms(){return{dvs:Object(a["b"])(),tileMat3:Object(a["b"])(),tileUnitsToPixels:Object(a["b"])()}}static _destroyRenderBuckets(e){if(!e)return;const t=new Set;e.forEach(e=>{t.has(e)||(e.destroy(),t.add(e))}),e.clear()}_createRenderBuckets(e){const t=new Map,i=new Map;for(const r of e){const e=this._deserializeBucket(r,i);for(const i of e.layerUIDs)t.set(i,e)}return t}_deserializeBucket(e,t){let i=t.get(e);if(i)return i;switch(new Uint32Array(e)[0]){case 1:i=new h(e,this.styleRepository);break;case 2:i=new d(e,this.styleRepository);break;case 3:i=new u(e,this.styleRepository,this);break;case 4:i=new p(e,this.styleRepository)}return t.set(e,i),i}}const g=new Map;function v(){g.forEach((e,t)=>{console.log(`\n${t.key}:`),e[0].forEach(e=>console.log(e)),console.log("========"),e[1].forEach(e=>console.log(e))})}},6750:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i("501b"),n=i("3886");function a(e,t){e.constants.add("stippleAlphaColorDiscard","float",.001),e.constants.add("stippleAlphaHighlightDiscard","float",.5),t.stippleEnabled?s(e,t):o(e)}function s(e,t){const i=!(t.draped&&t.stipplePreferContinuous);e.fragment.include(r["a"]),e.vertex.uniforms.add("stipplePatternPixelSize","float"),e.vertex.uniforms.add("pixelRatio","float"),t.draped?e.vertex.uniforms.add("worldToScreenRatio","float"):(e.vertex.uniforms.add("worldToScreenPerDistanceRatio","float"),e.vertex.uniforms.add("camPos","vec3"),e.vertex.code.add(n["a"]`float computeWorldToScreenRatio(vec3 segmentCenter) {
float segmentDistanceToCamera = length(segmentCenter - camPos);
return worldToScreenPerDistanceRatio / segmentDistanceToCamera;
}`)),e.varyings.add("vStippleDistance","float"),t.stippleRequiresClamp&&e.varyings.add("vStippleDistanceLimits","vec2"),e.vertex.code.add(n["a"]`
    float discretizeWorldToScreenRatio(float worldToScreenRatio) {
      float step = ${c};

      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);
      return discreteWorldToScreenRatio;
    }
  `),e.vertex.code.add(n["a"]`
  ${t.stippleRequiresStretchMeasure?n["a"]`vec3`:n["a"]`vec2`} computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {
  `),i&&e.vertex.code.add(n["a"]`
      if (segmentLengthPseudoScreen >= patternLength) {

        // Round the screen length to get an integer number of pattern repetitions (minimum 1).
        float repetitions = segmentLengthScreen / (patternLength * pixelRatio);
        float flooredRepetitions = max(1.0, floor(repetitions + 0.5));
        float segmentLengthScreenRounded = flooredRepetitions * patternLength;

        ${t.stippleRequiresStretchMeasure?n["a"]`return vec3(0.0, segmentLengthScreenRounded, repetitions / flooredRepetitions);`:n["a"]`return vec2(0.0, segmentLengthScreenRounded);`}
      }
    `),e.vertex.code.add(n["a"]`
      ${t.stippleRequiresStretchMeasure?n["a"]`return vec3(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen, 1.0)`:n["a"]`return vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen)`};
    }
  `),e.fragment.uniforms.add("stipplePatternTexture","sampler2D"),e.fragment.uniforms.add("stipplePatternSDFNormalizer","float"),e.fragment.uniforms.add("stipplePatternTextureSize","float"),e.fragment.uniforms.add("stipplePatternPixelSizeInv","float"),t.stippleOffColorEnabled&&e.fragment.uniforms.add("stippleOffColor","vec4"),e.fragment.code.add(n["a"]`float padTexture(float u) {
return (u * stipplePatternTextureSize + 1.0)/(stipplePatternTextureSize + 2.0);
}`),e.fragment.code.add(n["a"]`
    float getStippleSDF(out bool isClamped) {
      ${t.stippleRequiresClamp?n["a"]`
          float stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);
          vec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;
          isClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;`:n["a"]`
          float stippleDistanceClamped = vStippleDistance;
          isClamped = false;`}

      float u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv;
      ${t.stippleScaleWithLineWidth?n["a"]`u *= vLineSizeInv;`:""}
      u = padTexture(fract(u));

      float encodedSDF = rgba2float(texture2D(stipplePatternTexture, vec2(u, 0.5)));
      return (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;
    }

    float getStippleSDF() {
      bool ignored;
      return getStippleSDF(ignored);
    }

    float getStippleAlpha() {
      bool isClamped;
      float stippleSDF = getStippleSDF(isClamped);

      float antiAliasedResult = ${t.stippleScaleWithLineWidth?n["a"]`clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);`:n["a"]`clamp(stippleSDF + 0.5, 0.0, 1.0);`}

      return isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;
    }
  `),t.stippleOffColorEnabled?e.fragment.code.add(n["a"]`#define discardByStippleAlpha(stippleAlpha, threshold) {}
#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)`):e.fragment.code.add(n["a"]`#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }
#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)`)}function o(e){e.fragment.code.add(n["a"]`float getStippleAlpha() { return 1.0; }
#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}
#define blendStipple(color, _stippleAlpha_) color`)}const c=n["a"].float(.4)},"68af":function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i("b2b2"),n=i("d7f7");class a extends n["a"]{constructor(e){super(e),this._numLoading=0,this._disposed=!1,this._textureRepository=e.textureRep,this._textureId=e.textureId,this._acquire(e.textureId).then(e=>this._texture=e),this._acquire(e.normalTextureId).then(e=>this._textureNormal=e),this._acquire(e.emissiveTextureId).then(e=>this._textureEmissive=e),this._acquire(e.occlusionTextureId).then(e=>this._textureOcclusion=e),this._acquire(e.metallicRoughnessTextureId).then(e=>this._textureMetallicRoughness=e)}dispose(){this._texture=Object(r["s"])(this._texture),this._textureNormal=Object(r["s"])(this._textureNormal),this._textureEmissive=Object(r["s"])(this._textureEmissive),this._textureOcclusion=Object(r["s"])(this._textureOcclusion),this._textureMetallicRoughness=Object(r["s"])(this._textureMetallicRoughness),this._disposed=!0}ensureResources(e){return 0===this._numLoading?2:1}updateTexture(e){(Object(r["k"])(this._texture)||e!==this._texture.id)&&(this._texture=Object(r["s"])(this._texture),this._textureId=e,this._acquire(this._textureId).then(e=>this._texture=e))}bindTextures(e){Object(r["l"])(this._texture)&&e.bindTexture(this._texture.glTexture,"tex"),Object(r["l"])(this._textureNormal)&&e.bindTexture(this._textureNormal.glTexture,"normalTexture"),Object(r["l"])(this._textureEmissive)&&e.bindTexture(this._textureEmissive.glTexture,"texEmission"),Object(r["l"])(this._textureOcclusion)&&e.bindTexture(this._textureOcclusion.glTexture,"texOcclusion"),Object(r["l"])(this._textureMetallicRoughness)&&e.bindTexture(this._textureMetallicRoughness.glTexture,"texMetallicRoughness")}bindTextureScale(e){const t=Object(r["l"])(this._texture)?this._texture.glTexture:null;Object(r["l"])(t)&&t.descriptor.textureCoordinateScaleFactor?e.setUniform2fv("textureCoordinateScaleFactor",t.descriptor.textureCoordinateScaleFactor):e.setUniform2f("textureCoordinateScaleFactor",1,1)}_acquire(e){return Object(r["k"])(e)?Promise.resolve(null):(++this._numLoading,this._textureRepository.acquire(e).then(e=>this._disposed?(Object(r["s"])(e),null):e).finally(()=>--this._numLoading))}}},"690a":function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var r=i("e92d");const n=r["a"].getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");class a{constructor(){this.includedModules=new Map}include(e,t){this.includedModules.has(e)?this.includedModules.get(e)!==t&&n.error("Trying to include shader module multiple times with different sets of options."):(this.includedModules.set(e,t),e(this.builder,t))}}class s extends a{constructor(){super(...arguments),this.vertex=new l,this.fragment=new l,this.attributes=new d,this.varyings=new h,this.extensions=new u,this.constants=new p}get fragmentUniforms(){return this.fragment.uniforms}get builder(){return this}generateSource(e){const t=this.extensions.generateSource(e),i=this.attributes.generateSource(e),r=this.varyings.generateSource(),n="vertex"===e?this.vertex:this.fragment,a=n.uniforms.generateSource(),s=n.code.generateSource(),o="vertex"===e?b:f,c=this.constants.generateSource().concat(n.constants.generateSource());return`\n${t.join("\n")}\n\n${o}\n\n${c.join("\n")}\n\n${a.join("\n")}\n\n${i.join("\n")}\n\n${r.join("\n")}\n\n${s.join("\n")}`}}class o{constructor(){this._entries=new Map}add(e,t,i){const r=`${e}_${t}_${i}`;return this._entries.set(r,{name:e,type:t,arraySize:i}),this}generateSource(){const e=e=>e?`[${e}]`:"";return Array.from(this._entries.values()).map(t=>`uniform ${t.type} ${t.name}${e(t.arraySize)};`)}get entries(){return Array.from(this._entries.values())}}class c{constructor(){this._entries=new Array}add(e){this._entries.push(e)}generateSource(){return this._entries}}class l extends a{constructor(){super(...arguments),this.uniforms=new o,this.code=new c,this.constants=new p}get builder(){return this}}class d{constructor(){this._entries=new Array}add(e,t){this._entries.push([e,t])}generateSource(e){return"fragment"===e?[]:this._entries.map(e=>`attribute ${e[1]} ${e[0]};`)}}class h{constructor(){this._entries=new Array}add(e,t){this._entries.push([e,t])}generateSource(){return this._entries.map(e=>`varying ${e[1]} ${e[0]};`)}}class u{constructor(){this._entries=new Set}add(e){this._entries.add(e)}generateSource(e){const t="vertex"===e?u.ALLOWLIST_VERTEX:u.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(e=>t.includes(e)).map(e=>`#extension ${e} : enable`)}}u.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],u.ALLOWLIST_VERTEX=[];class p{constructor(){this._entries=[]}add(e,t,i){let r="ERROR_CONSTRUCTOR_STRING";switch(t){case"float":r=p.numberToFloatStr(i);break;case"int":r=p.numberToIntStr(i);break;case"bool":r=i.toString();break;case"vec2":r=`vec2(${p.numberToFloatStr(i[0])},                            ${p.numberToFloatStr(i[1])})`;break;case"vec3":r=`vec3(${p.numberToFloatStr(i[0])},                            ${p.numberToFloatStr(i[1])},                            ${p.numberToFloatStr(i[2])})`;break;case"vec4":r=`vec4(${p.numberToFloatStr(i[0])},                            ${p.numberToFloatStr(i[1])},                            ${p.numberToFloatStr(i[2])},                            ${p.numberToFloatStr(i[3])})`;break;case"ivec2":r=`ivec2(${p.numberToIntStr(i[0])},                             ${p.numberToIntStr(i[1])})`;break;case"ivec3":r=`ivec3(${p.numberToIntStr(i[0])},                             ${p.numberToIntStr(i[1])},                             ${p.numberToIntStr(i[2])})`;break;case"ivec4":r=`ivec4(${p.numberToIntStr(i[0])},                             ${p.numberToIntStr(i[1])},                             ${p.numberToIntStr(i[2])},                             ${p.numberToIntStr(i[3])})`;break;case"mat2":case"mat3":case"mat4":r=`${t}(${Array.prototype.map.call(i,e=>p.numberToFloatStr(e)).join(", ")})`}return this._entries.push(`const ${t} ${e} = ${r};`),this}static numberToIntStr(e){return e.toFixed(0)}static numberToFloatStr(e){return Number.isInteger(e)?e.toFixed(1):e.toString()}generateSource(){return Array.from(this._entries)}}const f="#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  precision highp sampler2D;\n#else\n  precision mediump float;\n  precision mediump sampler2D;\n#endif",b="precision highp float;\nprecision highp sampler2D;"},"697e":function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var r=i("b2b2"),n=i("ecd7"),a=i("f2e0"),s=i("e431");class o{constructor(){this._disposed=!1}get disposed(){return this._disposed}get shaderTransformation(){return this._shaderTransformation}acquire(e,t,i,r,n,s){this.id=Object(a["b"])(),this.geometry=e,this.material=t,this.transformation=i,this.instanceParameters=r,this.origin=n,this._shaderTransformation=s,this._disposed=!1}release(){this._disposed=!1}dispose(){this._disposed=!0}getStaticTransformation(){return this.transformation}getShaderTransformation(){return Object(r["l"])(this._shaderTransformation)?this._shaderTransformation(this.transformation):this.transformation}computeAttachmentOrigin(e){return!!(this.material.computeAttachmentOrigin?this.material.computeAttachmentOrigin(this.geometry,e):this.geometry.computeAttachmentOrigin(e))&&(Object(s["t"])(e,e,this.getStaticTransformation()),!0)}}o.pool=new n["a"](o)},"6a07":function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return c})),i.d(t,"c",(function(){return s}));var r=i("0fc4"),n=i("3886");const a=Object(r["g"])(1,1,0,1),s=Object(r["g"])(1,0,1,1);function o(e){e.fragment.uniforms.add("depthTex","sampler2D"),e.fragment.uniforms.add("highlightViewportPixelSz","vec4"),e.fragment.constants.add("occludedHighlightFlag","vec4",a).add("unoccludedHighlightFlag","vec4",s),e.fragment.code.add(n["a"]`void outputHighlight() {
vec4 fragCoord = gl_FragCoord;
float sceneDepth = texture2D(depthTex, (fragCoord.xy - highlightViewportPixelSz.xy) * highlightViewportPixelSz.zw).r;
if (fragCoord.z > sceneDepth + 5e-7) {
gl_FragColor = occludedHighlightFlag;
}
else {
gl_FragColor = unoccludedHighlightFlag;
}
}`)}function c(e,t){e.bindTexture(t.highlightDepthTexture,"depthTex"),e.setUniform4f("highlightViewportPixelSz",0,0,t.inverseViewport[0],t.inverseViewport[1])}},"6a21":function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return s}));var r=i("c120"),n=i("3886");function a({code:e},t){t.doublePrecisionRequiresObfuscation?e.add(n["a"]`vec3 dpPlusFrc(vec3 a, vec3 b) {
return mix(a, a + b, vec3(notEqual(b, vec3(0))));
}
vec3 dpMinusFrc(vec3 a, vec3 b) {
return mix(vec3(0), a - b, vec3(notEqual(a, b)));
}
vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = dpPlusFrc(hiA, hiB);
vec3 e = dpMinusFrc(t1, hiA);
vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
return t1 + t2;
}`):e.add(n["a"]`vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = hiA + hiB;
vec3 e = t1 - hiA;
vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
return t1 + t2;
}`)}function s(e){return!!Object(r["a"])("force-double-precision-obfuscation")||e.driverTest.doublePrecisionRequiresObfuscation}},"6ad6":function(e,t,i){"use strict";i.d(t,"a",(function(){return p})),i.d(t,"b",(function(){return u})),i.d(t,"c",(function(){return d}));var r=i("2aad"),n=i("d047"),a=i("d017"),s=i("58c2"),o=i("501b"),c=i("3886"),l=i("690a");const d=255,h=1/d;function u(e){const t=new l["a"];t.fragment.include(o["a"]),t.fragment.include(n["a"]),t.include(s["a"]),t.include(r["a"]);const{pass:i}=e;if(1===i){const{visualization:i,bandsEnabled:r}=e;t.fragment.constants.add("inverseSampleValue","float",d),t.fragment.uniforms.add("shadowCastMap","sampler2D"),t.fragment.uniforms.add("sampleScale","float"),t.fragment.uniforms.add("opacityFromElevation","float");const n=0===i,a=1===i;t.fragment.uniforms.add("color","vec4"),n?r&&t.fragment.uniforms.add("bandSize","float"):a&&t.fragment.uniforms.add("threshold","float"),t.fragment.code.add(c["a"]`
      void main(void) {
        vec4 record = texture2D(shadowCastMap, uv);
        float pixelSamples = record.r * inverseSampleValue;

        if (pixelSamples < 1.0) {
          discard;
        }

        float strength = pixelSamples * sampleScale;

        ${a?c["a"]`
            if (strength <= threshold) {
              discard;
            }`:""}

        ${n&&r?c["a"]`strength = ceil(strength / bandSize) * bandSize;`:""}

        gl_FragColor = vec4(color.xyz, color.a * opacityFromElevation ${n?c["a"]`* strength`:""});
      }
    `)}else 0!==i&&2!==i||(t.include(a["a"]),t.fragment.uniforms.add("depthMap","sampler2D"),t.fragment.uniforms.add("inverseView","mat4"),t.fragment.uniforms.add("nearFar","vec2"),0===i?t.fragment.constants.add("sampleValue","float",h):t.fragment.constants.add("shadowColor","vec4",[0,0,0,.8]),t.fragment.code.add(c["a"]`
      void main(void) {

        float depth = rgba2float(texture2D(depthMap, uv));
        // 0.0 is the clear value of depthMap, which means nothing has been drawn there and we should discard
        if (depth == 0.0) {
          discard;
        }

        float currentPixelDepth = linearDepthFromFloat(depth, nearFar);

        if (-currentPixelDepth > nearFar.y || -currentPixelDepth < nearFar.x) {
          discard;
        }

        vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
        vec4 worldSpacePos = inverseView * currentPixelPos;

        mat4 shadowMatrix;
        float linearDepth = -currentPixelDepth;
        int i = chooseCascade(linearDepth, shadowMatrix);

        if (i >= uShadowMapNum) {
          discard;
        }

        vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);

        // vertex completely outside? -> no shadow
        if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
          discard;
        }

        vec2 uvShadow = cascadeCoordinates(i, lvpos);

        float depthShadow = readShadowMapDepth(uvShadow, uShadowMapTex);
        bool shadow = depthShadow < lvpos.z;

        if (!shadow) {
          discard;
        }

        gl_FragColor = ${0===i?c["a"]`vec4(sampleValue)`:c["a"]`shadowColor`};
      }
    `));return t}const p=Object.freeze({__proto__:null,shadowCastMaxSamples:d,build:u})},"6b38":function(e,t,i){"use strict";i.d(t,"a",(function(){return y}));var r=i("6c97"),n=i("38a4"),a=i("d791"),s=i("afe1"),o=i("e431"),c=i("0b2d"),l=i("8188"),d=i("f694"),h=i("4261"),u=i("9180"),p=i("bd7e"),f=i("7289"),b=i("d18f"),m=i("de58");const g=.5*Math.PI,v=g/Math.PI*180;class y{constructor(e){this.renderCoordsHelper=e.renderCoordsHelper,this.extent=new Array(4),this.planes=new Array(6),this.maxSpan=0,this.center={origin:Object(c["f"])(),direction:Object(c["f"])()};for(let t=0;t<4;t++)this.extent[t]={origin:Object(c["f"])(),direction:Object(c["f"])(),cap:{next:null,direction:Object(c["f"])()}},this.planes[t]=Object(f["d"])();this.planes[4]=Object(f["d"])(),this.planes[5]=Object(f["d"])(),this.planesWithoutFar=this.planes.slice(0,5)}update(e,t,i,r=!0){const n=this.extent;this.toRenderBoundingExtent(e,t,i),Object(o["i"])(this.center.origin,n[0].origin,n[2].origin),Object(o["h"])(this.center.origin,this.center.origin,.5),this.renderCoordsHelper.worldUpAtPosition(this.center.origin,this.center.direction),r||Object(o["h"])(this.center.direction,this.center.direction,-1);for(let a=0;a<4;a++){const e=n[a];this.renderCoordsHelper.worldUpAtPosition(e.origin,e.direction);const t=n[3===a?0:a+1];e.cap.next=t.origin,Object(o["y"])(e.cap.direction,e.origin,t.origin),Object(f["j"])(e.direction,e.cap.direction,e.origin,this.planes[a]),r||Object(o["h"])(e.direction,e.direction,-1)}Object(f["j"])(n[0].cap.direction,n[1].cap.direction,n[0].origin,this.planes[4]),r?Object(f["q"])(this.planes[4],this.planes[5]):(Object(f["c"])(this.planes[4],this.planes[5]),Object(f["q"])(this.planes[4],this.planes[4])),this.maxSpan=Math.max(Math.abs(e[0]-e[2]),Math.abs(e[1]-e[3])),this.maxSpanSpatialReference=t,this.minGlobalAltitude=.9*Object(d["e"])(this.maxSpanSpatialReference).radius}isVisibleInFrustum(e,t,i=!1){if(null==e)return!1;if(1===this.renderCoordsHelper.viewingMode){const i=this.maxSpanSpatialReference.isGeographic?v:g*t;if(this.maxSpan>i)return!0;if(e.altitude>=this.minGlobalAltitude)return this.isVisibleInFrustumGlobal(e)}if(0===this.maxSpan){const t=this.extent[0];return!(i||!e.intersectsRay(Object(b["h"])(t.origin,t.direction)))}for(let n=0;n<this.extent.length;n++){const t=this.extent[n];if(!i&&e.intersectsRay(Object(b["h"])(t.origin,t.direction)))return!0;if(e.intersectsLineSegment(Object(p["f"])(t.origin,t.cap.next,T),t.cap.direction))return!0}const r=i?this.planes:this.planesWithoutFar;for(let n=0;n<e.lines.length;n++){const t=e.lines[n];if(Object(m["b"])(r,t.origin,t.endpoint,t.direction))return!0}return!1}toRenderBoundingExtentGlobal(e,t,i){const r=5;Object(u["e"])(e,_),_[2]=i,Object(l["d"])(t,_,x,this.renderCoordsHelper.spatialReference),Object(a["c"])(j,x),Object(h["k"])(w);for(const{x0:a,x1:s,y0:c,y1:d}of O)for(let u=0;u<r;u++){const p=u/(r-1);_[0]=Object(n["l"])(e[a],e[s],p),_[1]=Object(n["l"])(e[c],e[d],p),_[2]=i,Object(l["y"])(_,t,_,this.renderCoordsHelper.spatialReference),Object(o["t"])(_,_,j),Object(h["r"])(w,_)}Object(o["z"])(this.extent[0].origin,w[0],w[1],w[2]),Object(o["z"])(this.extent[1].origin,w[3],w[1],w[2]),Object(o["z"])(this.extent[2].origin,w[3],w[4],w[2]),Object(o["z"])(this.extent[3].origin,w[0],w[4],w[2]);for(let n=0;n<4;++n)Object(o["t"])(this.extent[n].origin,this.extent[n].origin,x)}toRenderBoundingExtentLocal(e,t,i){Object(l["n"])(e,t,S,this.renderCoordsHelper.spatialReference),Object(o["z"])(this.extent[0].origin,S[0],S[1],i),Object(o["z"])(this.extent[1].origin,S[2],S[1],i),Object(o["z"])(this.extent[2].origin,S[2],S[3],i),Object(o["z"])(this.extent[3].origin,S[0],S[3],i)}toRenderBoundingExtent(e,t,i){switch(this.renderCoordsHelper.viewingMode){case 1:this.toRenderBoundingExtentGlobal(e,t,i);break;case 2:this.toRenderBoundingExtentLocal(e,t,i);break;default:Object(r["a"])(this.renderCoordsHelper.viewingMode)}}isVisibleInFrustumGlobal(e){if(Object(o["k"])(this.center.direction,e.direction)<0)return!0;for(let t=0;t<4;t++){const i=this.extent[t];if(Object(o["k"])(i.direction,e.direction)<0)return!0}return!1}}const O=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],_=Object(c["f"])(),x=Object(s["d"])(),j=Object(s["d"])(),w=Object(h["h"])(),S=Object(u["m"])(),T=Object(p["d"])()},"6be6":function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return n}));var r=i("a978");function n(e){return Object(r["c"])(e)&&5===e.intersector&&!!e.target}function a(e){return Object(r["c"])(e)&&4===e.intersector&&!!e.target}},"6cb2":function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i("5876"),n=i("3886");function a(e,t){t.symbolColor?(e.include(r["a"]),e.attributes.add("symbolColor","vec4"),e.varyings.add("colorMixMode","mediump float")):e.fragment.uniforms.add("colorMixMode","int"),t.symbolColor?e.vertex.code.add(n["a"]`int symbolColorMixMode;
vec4 getSymbolColor() {
return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;
}
void forwardColorMixMode() {
colorMixMode = float(symbolColorMixMode) + 0.5;
}`):e.vertex.code.add(n["a"]`vec4 getSymbolColor() { return vec4(1.0); }
void forwardColorMixMode() {}`)}},"6d5b":function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("3886");function n(e,t){t.attributeColor?(e.attributes.add("color","vec4"),e.varyings.add("vColor","vec4"),e.vertex.code.add(r["a"]`void forwardVertexColor() { vColor = color; }`),e.vertex.code.add(r["a"]`void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }`)):e.vertex.code.add(r["a"]`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)}},"6df2":function(e,t,i){"use strict";i.d(t,"a",(function(){return H}));var r=i("b2b2"),n=i("1956"),a=i("d17d");class s{constructor(e){this._allocations=new Map,e?Error.stackTraceLimit=1/0:(this.add=()=>{},this.remove=()=>{})}add(e){this._allocations.set(e,(new Error).stack)}remove(e){this._allocations.delete(e)}print(){if(this._allocations.size>0){console.log(this._allocations.size+" live object allocations:");const e=new Map;this._allocations.forEach(t=>{var i;e.set(t,(null!=(i=e.get(t))?i:0)+1)}),e.forEach((e,t)=>{const i=t.split("\n");i.shift(),i.shift(),console.log(`${e}: ${i.shift()}`),i.forEach(e=>console.log("   ",e))})}}}const o=!1;class c{constructor(){for(this._current=new Array,this._max=new Array,this._allocations=new s(o);this._current.length<a["c"].COUNT;)this._current.push(0),this._max.push(0)}resetMax(){for(this._max.length=0;this._max.length<this._current.length;)this._max.push(0)}increment(e,t){const i=++this._current[e];this._max[e]=Math.max(i,this._max[e]),this._allocations.add(t)}decrement(e,t){--this._current[e],this._allocations.remove(t)}get max(){return this._max}get current(){return this._current}get total(){return this.current.reduce((e,t)=>e+t,0)}printResourceCount(){if(this.total>0){console.log("Live objects:");for(let e=0;e<a["c"].COUNT;++e){const t=this._current[e];t>0&&console.log(`${a["c"][e]}: ${t}`)}}this._allocations.print()}}var l=i("189c"),d=i("a1ff"),h=i("661c"),u=i("0b2d"),p=i("7ce4"),f=i("9cc4"),b=i("d267"),m=i("8e37"),g=i("0fa6");function v(e,t){const i=new b["a"](e,{colorTarget:0,depthStencilTarget:0},{target:3553,wrapMode:33071,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1});function r(i,r){const n=new m["a"](e,`\n\n  precision highp float;\n\n  attribute vec2 position;\n\n  uniform vec3 u_highA;\n  uniform vec3 u_lowA;\n  uniform vec3 u_highB;\n  uniform vec3 u_lowB;\n\n  varying vec4 v_color;\n\n  ${t?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":""}\n\n  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION\n\n  vec3 dpPlusFrc(vec3 a, vec3 b) {\n    return mix(a, a + b, vec3(notEqual(b, vec3(0))));\n  }\n\n  vec3 dpMinusFrc(vec3 a, vec3 b) {\n    return mix(vec3(0), a - b, vec3(notEqual(a, b)));\n  }\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 = dpPlusFrc(hiA, hiB);\n    vec3 e = dpMinusFrc(t1, hiA);\n    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;\n    return t1 + t2;\n  }\n\n  #else\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 = hiA + hiB;\n    vec3 e = t1 - hiA;\n    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;\n    return t1 + t2;\n  }\n\n  #endif\n\n  const float MAX_RGBA_FLOAT =\n    255.0 / 256.0 +\n    255.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 / 256.0;\n\n  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);\n\n  vec4 float2rgba(const float value) {\n    // Make sure value is in the domain we can represent\n    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);\n\n    // Decompose value in 32bit fixed point parts represented as\n    // uint8 rgba components. Decomposition uses the fractional part after multiplying\n    // by a power of 256 (this removes the bits that are represented in the previous\n    // component) and then converts the fractional part to 8bits.\n    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);\n\n    // Convert uint8 values (from 0 to 255) to floating point representation for\n    // the shader\n    const float toU8AsFloat = 1.0 / 255.0;\n\n    return fixedPointU8 * toU8AsFloat;\n  }\n\n  void main() {\n    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);\n\n    v_color = float2rgba(val.z / 25.0);\n\n    gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);\n  }\n  `,"\n  precision highp float;\n\n  varying vec4 v_color;\n\n  void main() {\n    gl_FragColor = v_color;\n  }\n  ",new Map([["position",0]])),a=new Float32Array(6);Object(f["a"])(i,a,3);const s=new Float32Array(6);return Object(f["a"])(r,s,3),e.useProgram(n),n.setUniform3f("u_highA",a[0],a[2],a[4]),n.setUniform3f("u_lowA",a[1],a[3],a[5]),n.setUniform3f("u_highB",s[0],s[2],s[4]),n.setUniform3f("u_lowB",s[1],s[3],s[5]),n}const n=p["a"].createVertex(e,35044,new Uint16Array([0,0,1,0,0,1,1,1])),a=new g["a"](e,new Map([["position",0]]),{geometry:[{name:"position",count:2,type:5123,offset:0,stride:4,normalized:!1}]},{geometry:n}),s=Object(u["h"])(5633261.287538229,2626832.878767164,1434988.0495278358),o=Object(u["h"])(5633271.46742708,2626873.6381334523,1434963.231608387),c=r(s,o),l=e.getBoundFramebufferObject(),{x:d,y:v,width:y,height:O}=e.getViewport();e.bindFramebuffer(i),e.setViewport(0,0,1,1),e.bindVAO(a),e.drawArrays(5,0,4);const _=new Uint8Array(4);i.readPixels(0,0,1,1,6408,5121,_),c.dispose(),a.dispose(!1),n.dispose(),i.dispose(),e.setViewport(d,v,y,O),e.bindFramebuffer(l);const x=(s[2]-o[2])/25,j=Object(h["b"])(_);return Math.abs(x-j)}var y,O,_,x=i("7438"),j={exports:{}};function w(e){var t,i,r,n,a;if(!e.gl)return!1;if("webgl"===e.webglVersion)return(null==(n=e.capabilities.textureFloat)?void 0:n.textureFloat)&&(null==(a=e.capabilities.colorBufferFloat)?void 0:a.textureFloat);if(!((null==(t=e.capabilities.textureFloat)?void 0:t.textureFloat)&&(null==(i=e.capabilities.colorBufferFloat)?void 0:i.textureFloat)&&(null==(r=e.capabilities.colorBufferFloat)?void 0:r.floatBlend)))return!1;const s=new b["a"](e,{colorTarget:0,depthStencilTarget:0},{target:3553,wrapMode:33071,pixelFormat:6408,dataType:5126,internalFormat:34836,samplingMode:9728,width:1,height:1}),o=p["a"].createVertex(e,35044,new Uint16Array([0,0,1,0,0,1,1,1])),c=new g["a"](e,new Map([["a_pos",0]]),{geometry:[{name:"a_pos",count:2,type:5123,offset:0,stride:4,normalized:!1}]},{geometry:o}),d=new m["a"](e,"\n  precision highp float;\n  attribute vec2 a_pos;\n\n  void main() {\n    gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n  }\n  ","\n   precision highp float;\n\n   void main() {\n    gl_FragColor = vec4(0.5, 0.5, 0.5, 0.5);\n   }\n  ",new Map([["a_pos",0]]));e.useProgram(d);const h=e.getBoundFramebufferObject(),{x:u,y:f,width:v,height:y}=e.getViewport();e.bindFramebuffer(s),e.setViewport(0,0,1,1),e.bindVAO(c),e.drawArrays(5,0,4);const O=Object(l["g"])({blending:x["f"]});e.setPipelineState(O),e.drawArrays(5,0,4),j.exports.init(e);const _=e.gl.getError();return e.setViewport(u,f,v,y),e.bindFramebuffer(h),d.dispose(),c.dispose(!1),o.dispose(),s.dispose(),1282!==_||(console.warn("Device claims support for WebGL extension EXT_float_blend but does not support it. Using fall back."),!1)}y=j,O=function(){var e=function(e){window.console&&window.console.log&&window.console.log(e)},t=function(t){window.console&&window.console.error?window.console.error(t):e(t)},i={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0}},bindBuffer:{2:{0:!0}},bufferData:{3:{0:!0,2:!0}},bufferSubData:{3:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},readPixels:{7:{4:!0,5:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}}},r=null,n=null;function a(e){if(null==r)for(var t in r={},n={},e)"number"==typeof e[t]&&(r[e[t]]=t,n[t]=e[t])}function s(){if(null==r)throw"WebGLDebugUtils.init(ctx) not called"}function o(e){return s(),void 0!==r[e]}function c(e){s();var t=r[e];return void 0!==t?"gl."+t:"/*UNKNOWN WebGL ENUM*/ 0x"+e.toString(16)}function l(e,t,r,a){var s;if(void 0!==(s=i[e])&&void 0!==(s=s[t])&&s[r]){if("object"==typeof s[r]&&void 0!==s[r].enumBitwiseOr){for(var o=s[r].enumBitwiseOr,l=0,d=[],h=0;h<o.length;++h){var u=n[o[h]];0!=(a&u)&&(l|=u,d.push(c(u)))}return l===a?d.join(" | "):c(a)}return c(a)}return null===a?"null":void 0===a?"undefined":a.toString()}function d(e,t){for(var i="",r=t.length,n=0;n<r;++n)i+=(0==n?"":", ")+l(e,r,n,t[n]);return i}function h(e,t,i){e.__defineGetter__(i,(function(){return t[i]})),e.__defineSetter__(i,(function(e){t[i]=e}))}function u(e,i,r,n){n=n||e,a(e),i=i||function(e,i,r){for(var n="",a=r.length,s=0;s<a;++s)n+=(0==s?"":", ")+l(i,a,s,r[s]);t("WebGL error "+c(e)+" in "+i+"("+n+")")};var s={};function o(e,t){return function(){r&&r(t,arguments);var a=e[t].apply(e,arguments),o=n.getError();return 0!=o&&(s[o]=!0,i(o,t,arguments)),a}}var d={};for(var p in e)if("function"==typeof e[p])if("getExtension"!=p)d[p]=o(e,p);else{var f=o(e,p);d[p]=function(){return u(f.apply(e,arguments),i,r,n)}}else h(d,e,p);return d.getError=function(){for(var t in s)if(s.hasOwnProperty(t)&&s[t])return s[t]=!1,t;return e.NO_ERROR},d}function p(e){var t=e.getParameter(e.MAX_VERTEX_ATTRIBS),i=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,i);for(var r=0;r<t;++r)e.disableVertexAttribArray(r),e.vertexAttribPointer(r,4,e.FLOAT,!1,0,0),e.vertexAttrib1f(r,0);e.deleteBuffer(i);var n=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);for(r=0;r<n;++r)e.activeTexture(e.TEXTURE0+r),e.bindTexture(e.TEXTURE_CUBE_MAP,null),e.bindTexture(e.TEXTURE_2D,null);for(e.activeTexture(e.TEXTURE0),e.useProgram(null),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindRenderbuffer(e.RENDERBUFFER,null),e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.DITHER),e.disable(e.SCISSOR_TEST),e.blendColor(0,0,0,0),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.clearColor(0,0,0,0),e.clearDepth(1),e.clearStencil(-1),e.colorMask(!0,!0,!0,!0),e.cullFace(e.BACK),e.depthFunc(e.LESS),e.depthMask(!0),e.depthRange(0,1),e.frontFace(e.CCW),e.hint(e.GENERATE_MIPMAP_HINT,e.DONT_CARE),e.lineWidth(1),e.pixelStorei(e.PACK_ALIGNMENT,4),e.pixelStorei(e.UNPACK_ALIGNMENT,4),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),e.UNPACK_COLORSPACE_CONVERSION_WEBGL&&e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.BROWSER_DEFAULT_WEBGL),e.polygonOffset(0,0),e.sampleCoverage(1,!1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.stencilFunc(e.ALWAYS,0,4294967295),e.stencilMask(4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.viewport(0,0,e.canvas.width,e.canvas.height),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT|e.STENCIL_BUFFER_BIT);e.getError(););}function f(e){var t,i,r=[],n=[],a={},s=1,o=!1,c=[],l=0,d=0,u=!1,f=0,b={};function m(e){return"function"==typeof e?e:function(t){e.handleEvent(t)}}e.getContext=(i=e.getContext,function(){var r=i.apply(e,arguments);if(r instanceof WebGLRenderingContext){if(r!=t){if(t)throw"got different context";a=S(t=r)}return a}return r});var g=function(e){r.push(m(e))},v=function(e){n.push(m(e))};function y(e){var t=e.addEventListener;e.addEventListener=function(i,r,n){switch(i){case"webglcontextlost":g(r);break;case"webglcontextrestored":v(r);break;default:t.apply(e,arguments)}}}function O(){for(var e=Object.keys(b),t=0;t<e.length;++t)delete b[e]}function _(){++d,o||l==d&&e.loseContext()}function x(e,t){var i=e[t];return function(){if(_(),!o)return i.apply(e,arguments)}}function j(){for(var e=0;e<c.length;++e){var i=c[e];i instanceof WebGLBuffer?t.deleteBuffer(i):i instanceof WebGLFramebuffer?t.deleteFramebuffer(i):i instanceof WebGLProgram?t.deleteProgram(i):i instanceof WebGLRenderbuffer?t.deleteRenderbuffer(i):i instanceof WebGLShader?t.deleteShader(i):i instanceof WebGLTexture&&t.deleteTexture(i)}}function w(e){return{statusMessage:e,preventDefault:function(){u=!0}}}return y(e),e.loseContext=function(){if(!o){for(o=!0,l=0,++s;t.getError(););O(),b[t.CONTEXT_LOST_WEBGL]=!0;var i=w("context lost"),n=r.slice();setTimeout((function(){for(var t=0;t<n.length;++t)n[t](i);f>=0&&setTimeout((function(){e.restoreContext()}),f)}),0)}},e.restoreContext=function(){o&&n.length&&setTimeout((function(){if(!u)throw"can not restore. webglcontestlost listener did not call event.preventDefault";j(),p(t),o=!1,d=0,u=!1;for(var e=n.slice(),i=w("context restored"),r=0;r<e.length;++r)e[r](i)}),0)},e.loseContextInNCalls=function(e){if(o)throw"You can not ask a lost contet to be lost";l=d+e},e.getNumCalls=function(){return d},e.setRestoreTimeout=function(e){f=e},e;function S(e){for(var i in e)"function"==typeof e[i]?a[i]=x(e,i):h(a,e,i);a.getError=function(){if(_(),!o)for(;e=t.getError();)b[e]=!0;for(var e in b)if(b[e])return delete b[e],e;return a.NO_ERROR};for(var r=["createBuffer","createFramebuffer","createProgram","createRenderbuffer","createShader","createTexture"],n=0;n<r.length;++n){var l=r[n];a[l]=function(t){return function(){if(_(),o)return null;var i=t.apply(e,arguments);return i.__webglDebugContextLostId__=s,c.push(i),i}}(e[l])}var d=["getActiveAttrib","getActiveUniform","getBufferParameter","getContextAttributes","getAttachedShaders","getFramebufferAttachmentParameter","getParameter","getProgramParameter","getProgramInfoLog","getRenderbufferParameter","getShaderParameter","getShaderInfoLog","getShaderSource","getTexParameter","getUniform","getUniformLocation","getVertexAttrib"];for(n=0;n<d.length;++n)l=d[n],a[l]=function(t){return function(){return _(),o?null:t.apply(e,arguments)}}(a[l]);var u=["isBuffer","isEnabled","isFramebuffer","isProgram","isRenderbuffer","isShader","isTexture"];for(n=0;n<u.length;++n)l=u[n],a[l]=function(t){return function(){return _(),!o&&t.apply(e,arguments)}}(a[l]);return a.checkFramebufferStatus=function(t){return function(){return _(),o?a.FRAMEBUFFER_UNSUPPORTED:t.apply(e,arguments)}}(a.checkFramebufferStatus),a.getAttribLocation=function(t){return function(){return _(),o?-1:t.apply(e,arguments)}}(a.getAttribLocation),a.getVertexAttribOffset=function(t){return function(){return _(),o?0:t.apply(e,arguments)}}(a.getVertexAttribOffset),a.isContextLost=function(){return o},a}}return{init:a,mightBeEnum:o,glEnumToString:c,glFunctionArgToString:l,glFunctionArgsToString:d,makeDebugContext:u,makeLostContextSimulatingCanvas:f,resetToInitialState:p}},void 0!==(_=O())&&(y.exports=_);var S=i("e92d");const T=S["a"].getLogger("esri.views.WebGLDriverTest"),C=e=>{const t=new b["a"](e,{colorTarget:0,depthStencilTarget:0},{target:3553,wrapMode:33071,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1}),i="\nprecision highp float;\nattribute vec2 a_pos;\nuniform highp sampler2D u_texture;\nvarying vec4 v_color;\n\nfloat getBit(in float bitset, in int bitIndex) {\n  float offset = pow(2.0, float(bitIndex));\n  return mod(floor(bitset / offset), 2.0);\n}\n\nvoid main() {\n  vec4 value = texture2D(u_texture, vec2(0.0));\n  float bit = getBit(value.x * 255.0, 1);\n\n  v_color = bit * vec4(1.0);\n  gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n}\n",r="\nprecision highp float;\nvarying vec4 v_color;\n\nvoid main() {\n  gl_FragColor = v_color;\n}\n",n=new Uint8Array(4),a=p["a"].createVertex(e,35044,new Uint16Array([0,0,1,0,0,1,1,1])),s=new g["a"](e,new Map([["a_position",0]]),{geometry:[{name:"a_position",count:2,type:5122,offset:0,stride:4,normalized:!1}]},{geometry:a}),o=new m["a"](e,i,r,new Map([["a_pos",0]])),c=new d["a"](e,{target:3553,wrapMode:33071,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1},new Uint8Array([2,255,0,0]));o.setUniform1i("u_texture",0),e.bindTexture(c,0);const l=e.getBoundFramebufferObject();e.bindFramebuffer(t),e.useProgram(o);const{x:h,y:u,width:f,height:v}=e.getViewport();e.setViewport(0,0,1,1),e.bindVAO(s),e.drawArrays(5,0,4),e.setViewport(h,u,f,v),t.readPixels(0,0,1,1,6408,5121,n),o.dispose(),s.dispose(!1),a.dispose(),t.dispose();const y=255!==n[0]||255!==n[1]||255!==n[2]||255!==n[3];return y&&T.warn(`A problem was detected with your graphics driver. Your driver does not appear to honor sampler precision specifiers, which may result in rendering issues due to numerical instability. We recommend ensuring that your drivers have been updated to the latest version. Applying lowp sampler workaround. [${n[0]}.${n[1]}.${n[2]}.${n[3]}]`),e.bindFramebuffer(l),y};async function P(e){const t=new Image;if(t.src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='5' height='5' version='1.1' viewBox='0 0 5 5' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='5' height='5' fill='%23f00' fill-opacity='.5'/%3E%3C/svg%3E%0A",t.width=5,t.height=5,await t.decode(),!e.gl)return!0;const i=new b["a"](e,{colorTarget:0,depthStencilTarget:0},{target:3553,wrapMode:33071,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1}),r=p["a"].createVertex(e,35044,new Uint16Array([0,0,1,0,0,1,1,1])),n=new g["a"](e,new Map([["a_pos",0]]),{geometry:[{name:"a_pos",count:2,type:5123,offset:0,stride:4,normalized:!1}]},{geometry:r}),a=new m["a"](e,"\n  precision highp float;\n\n  attribute vec2 a_pos;\n  varying vec2 v_uv;\n\n  void main() {\n    v_uv = a_pos;\n    gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n  }\n  ","\n  precision highp float;\n\n  varying vec2 v_uv;\n  uniform sampler2D u_texture;\n\n  void main() {\n    gl_FragColor = texture2D(u_texture, v_uv);\n  }\n  ",new Map([["a_pos",0]]));e.useProgram(a);const s=new d["a"](e,{dataType:5121,pixelFormat:6408,preMultiplyAlpha:!1,wrapMode:33071,samplingMode:9729},t);e.bindTexture(s,0),a.setUniform1i("u_texture",0);const o=e.getBoundFramebufferObject(),{x:c,y:l,width:h,height:u}=e.getViewport();e.bindFramebuffer(i),e.setViewport(0,0,1,1),e.setClearColor(0,0,0,0),e.setBlendingEnabled(!1),e.clearSafe(16384),e.bindVAO(n),e.drawArrays(5,0,4);const f=new Uint8Array(4);return i.readPixels(0,0,1,1,6408,5121,f),a.dispose(),n.dispose(!1),r.dispose(),i.dispose(),s.dispose(),e.setViewport(c,l,h,u),e.bindFramebuffer(o),t.src="",255===f[0]}class A{constructor(e){this.context=e,this._floatBufferBlendWorking=w(e),P(e).then(e=>this._svgAlwaysPremultipliesAlpha=!e)}get floatBufferBlendWorking(){if(Object(r["k"])(this._floatBufferBlendWorking))throw new Error("floatBufferBlendWorking test not yet available");return this._floatBufferBlendWorking}get svgAlwaysPremultipliesAlpha(){if(Object(r["k"])(this._svgAlwaysPremultipliesAlpha))throw new Error("svgAlwaysPremultipliesAlpha test not yet available");return this._svgAlwaysPremultipliesAlpha}get doublePrecisionRequiresObfuscation(){if(Object(r["k"])(this._doublePrecisionRequiresObfuscation)){const e=v(this.context,!1),t=v(this.context,!0);this._doublePrecisionRequiresObfuscation=0!==e&&(0===t||e/t>5)}return this._doublePrecisionRequiresObfuscation}get ignoresSamplerPrecision(){return Object(r["k"])(this._ignoresSamplerPrecision)&&(this._ignoresSamplerPrecision=C(this.context)),this._ignoresSamplerPrecision}}var M=i("c514"),R=i("1a9a");function E(e,t){if(t.disjointTimerQuery)return null;if(Object(M["a"])(e))return{drawBuffers:e.drawBuffers.bind(e),MAX_DRAW_BUFFERS:e.MAX_DRAW_BUFFERS,MAX_COLOR_ATTACHMENTS:e.MAX_COLOR_ATTACHMENTS};if(t.drawBuffers)return null;const i=e.getExtension("WEBGL_draw_buffers");return i?{drawBuffers:i.drawBuffersWEBGL.bind(i),MAX_DRAW_BUFFERS:i.MAX_DRAW_BUFFERS_WEBGL,MAX_COLOR_ATTACHMENTS:i.MAX_COLOR_ATTACHMENTS_WEBGL}:null}function D(e){if(Object(M["a"])(e))return{drawArraysInstanced:e.drawArraysInstanced.bind(e),drawElementsInstanced:e.drawElementsInstanced.bind(e),vertexAttribDivisor:e.vertexAttribDivisor.bind(e)};const t=e.getExtension("ANGLE_instanced_arrays");return t?{drawArraysInstanced:t.drawArraysInstancedANGLE.bind(t),drawElementsInstanced:t.drawElementsInstancedANGLE.bind(t),vertexAttribDivisor:t.vertexAttribDivisorANGLE.bind(t)}:null}function I(e,t){const i=t.loseContext&&e.getExtension("WEBGL_lose_context");return i?{loseRenderingContext:()=>i.loseContext()}:null}function F(e,t){if(Object(M["a"])(e))return{createVertexArray:e.createVertexArray.bind(e),deleteVertexArray:e.deleteVertexArray.bind(e),bindVertexArray:e.bindVertexArray.bind(e)};if(t.vao)return null;const i=e.getExtension("OES_vertex_array_object")||e.getExtension("MOZ_OES_vertex_array_object")||e.getExtension("WEBKIT_OES_vertex_array_object");return i?{createVertexArray:i.createVertexArrayOES.bind(i),deleteVertexArray:i.deleteVertexArrayOES.bind(i),bindVertexArray:i.bindVertexArrayOES.bind(i)}:null}function z(e,t){const i=t.disabledExtensions||{},r=t.debugWebGLExtensions||{};let n,a,s,o,c,l,d,h,u,p,f,b,m=null,g=null,v=null,y=null;return{get drawBuffers(){return f||(f=E(e,i)),f},get instancing(){return n||(n=D(e)),n},get vao(){return a||(a=F(e,i)),a},get compressedTextureETC(){return s||(s=L(e,i)),s},get compressedTextureS3TC(){return o||(o=V(e,i)),o},get textureFilterAnisotropic(){return c||(c=U(e,i)),c},get disjointTimerQuery(){return l||(l=Object(R["a"])(e,i)),l},get textureFloat(){return d||(d=B(e,i)),d},get colorBufferFloat(){return h||(h=N(e,i)),h},get blendMinMax(){return u||(u=k(e,i)),u},get depthTexture(){return null===m&&(m=G(e,i,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"])),m},get standardDerivatives(){return null===g&&(g=G(e,i,"standardDerivatives",!0,["OES_standard_derivatives"])),g},get shaderTextureLOD(){return null===v&&(v=G(e,i,"shaderTextureLOD",!0,["EXT_shader_texture_lod"])),v},get fragDepth(){return null===y&&(y=G(e,i,"fragDepth",!0,["EXT_frag_depth"])),y},get loseContext(){return p||(p=I(e,r)),p},get textureNorm16(){return b||(b=q(e,i)),b},enable(e){return this[e]}}}function L(e,t){if(t.compressedTextureETC)return null;const i=e.getExtension("WEBGL_compressed_texture_etc");return i?{COMPRESSED_R11_EAC:i.COMPRESSED_R11_EAC,COMPRESSED_SIGNED_R11_EAC:i.COMPRESSED_SIGNED_R11_EAC,COMPRESSED_RG11_EAC:i.COMPRESSED_RG11_EAC,COMPRESSED_SIGNED_RG11_EAC:i.COMPRESSED_SIGNED_RG11_EAC,COMPRESSED_RGB8_ETC2:i.COMPRESSED_RGB8_ETC2,COMPRESSED_SRGB8_ETC2:i.COMPRESSED_SRGB8_ETC2,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:i.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:i.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_RGBA8_ETC2_EAC:i.COMPRESSED_RGBA8_ETC2_EAC,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC}:null}function V(e,t){if(t.compressedTextureS3TC)return null;const i=e.getExtension("WEBGL_compressed_texture_s3tc");return i?{COMPRESSED_RGB_S3TC_DXT1:i.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:i.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:i.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:i.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null}function k(e,t){if(Object(M["a"])(e))return{MIN:e.MIN,MAX:e.MAX};if(t.blendMinMax)return null;{const t=e.getExtension("EXT_blend_minmax");return t?{MIN:t.MIN_EXT,MAX:t.MAX_EXT}:null}}function U(e,t){if(t.textureFilterAnisotropic)return null;const i=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");return i?{MAX_TEXTURE_MAX_ANISOTROPY:i.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:i.TEXTURE_MAX_ANISOTROPY_EXT}:null}function B(e,t){if(Object(M["a"])(e))return{textureFloat:!0,textureFloatLinear:!t.textureFloatLinear&&!!e.getExtension("OES_texture_float_linear"),textureHalfFloat:!0,textureHalfFloatLinear:!t.textureHalfFloatLinear&&!!e.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:e.HALF_FLOAT};if(e instanceof WebGLRenderingContext){const i=!t.textureHalfFloat&&e.getExtension("OES_texture_half_float");return{textureFloat:!t.textureFloat&&!!e.getExtension("OES_texture_float"),textureFloatLinear:!t.textureFloatLinear&&!!e.getExtension("OES_texture_float_linear"),textureHalfFloat:!!i,textureHalfFloatLinear:!t.textureHalfFloatLinear&&!!e.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:i?i.HALF_FLOAT_OES:void 0}}return null}function N(e,t){if(Object(M["a"])(e)){const i=!t.colorBufferFloat&&e.getExtension("EXT_color_buffer_half_float"),r=!t.colorBufferFloat&&e.getExtension("EXT_color_buffer_float"),n=!t.colorBufferFloat&&e.getExtension("EXT_float_blend");return i||r||n?{textureFloat:!!r,textureHalfFloat:!!i,floatBlend:!!n,R16F:e.R16F,RG16F:e.RG16F,RGBA16F:e.RGBA16F,R32F:e.R32F,RG32F:e.RG32F,RGBA32F:e.RGBA32F,R11F_G11F_B10F:e.R11F_G11F_B10F,RGB16F:e.RGB16F}:null}if(e instanceof WebGLRenderingContext){const i=!t.colorBufferFloat&&e.getExtension("EXT_color_buffer_half_float"),r=!t.colorBufferFloat&&e.getExtension("WEBGL_color_buffer_float"),n=!t.colorBufferFloat&&e.getExtension("EXT_float_blend");return i||r||n?{textureFloat:!!r,textureHalfFloat:!!i,floatBlend:!!n,RGBA16F:i?i.RGBA16F_EXT:void 0,RGB16F:i?i.RGB16F_EXT:void 0,RGBA32F:r?r.RGBA32F_EXT:void 0}:null}return null}function G(e,t,i,r,n){if(r&&Object(M["a"])(e))return!0;if(t[i])return!1;for(const a of n)if(e.getExtension(a))return!0;return!1}function q(e,t){if(!Object(M["a"])(e))return null;if(t.textureNorm16)return null;const i=e.getExtension("EXT_texture_norm16");return i?{R16:i.R16,RG16:i.RG16,RGB16:i.RGB16,RGBA16:i.RGBA16,R16_SNORM:i.R16_SNORM,RG16_SNORM:i.RG16_SNORM,RGB16_SNORM:i.RGB16_SNORM,RGBA16_SNORM:i.RGBA16_SNORM}:null}class H{constructor(e,t){this.gl=e,this.instanceCounter=new c,this._blendEnabled=!1,this._blendColorState={r:0,g:0,b:0,a:0},this._blendFunctionState={srcRGB:1,dstRGB:0,srcAlpha:1,dstAlpha:0},this._blendEquationState={mode:32774,modeAlpha:32774},this._colorMaskState={r:!0,g:!0,b:!0,a:!0},this._polygonCullingEnabled=!1,this._cullFace=1029,this._frontFace=2305,this._scissorTestEnabled=!1,this._scissorRect={x:0,y:0,width:0,height:0},this._depthTestEnabled=!1,this._depthFunction=513,this._clearDepth=1,this._depthWriteEnabled=!0,this._depthRange={zNear:0,zFar:1},this._viewport=null,this._stencilTestEnabled=!1,this._polygonOffsetFillEnabled=!1,this._polygonOffset=[0,0],this._stencilFunction={face:1032,func:519,ref:0,mask:1},this._clearStencil=0,this._stencilWriteMask=1,this._stencilOperation={face:1032,fail:7680,zFail:7680,zPass:7680},this._clearColor={r:0,g:0,b:0,a:0},this._activeShaderProgram=null,this._activeVertexBuffer=null,this._activeIndexBuffer=null,this._activeFramebuffer=null,this._activeRenderbuffer=null,this._activeTextureUnit=0,this._textureUnitMap=new Array,this._numOfDrawCalls=0,this._numOfTriangles=0,this.webglVersion=Object(M["a"])(e)?"webgl2":"webgl","webgl"===this.webglVersion&&this.gl.getExtension("OES_element_index_uint"),this._capabilities=z(e,t),this._parameters=this._loadParameters(t);const i=this.gl.getParameter(this.gl.VIEWPORT);this._viewport={x:i[0],y:i[1],width:i[2],height:i[3]},this._stateTracker=new l["a"]({setBlending:e=>{if(e){this.setBlendingEnabled(!0),this.setBlendEquationSeparate(e.opRgb,e.opAlpha),this.setBlendFunctionSeparate(e.srcRgb,e.dstRgb,e.srcAlpha,e.dstAlpha);const t=e.color;this.setBlendColor(t.r,t.g,t.b,t.a)}else this.setBlendingEnabled(!1)},setCulling:e=>{e?(this.setFaceCullingEnabled(!0),this.setCullFace(e.face),this.setFrontFace(e.mode)):this.setFaceCullingEnabled(!1)},setPolygonOffset:e=>{e?(this.setPolygonOffsetFillEnabled(!0),this.setPolygonOffset(e.factor,e.units)):this.setPolygonOffsetFillEnabled(!1)},setDepthTest:e=>{e?(this.setDepthTestEnabled(!0),this.setDepthFunction(e.func)):this.setDepthTestEnabled(!1)},setStencilTest:e=>{if(e){this.setStencilTestEnabled(!0);const t=e.function;this.setStencilFunction(t.func,t.ref,t.mask);const i=e.operation;this.setStencilOp(i.fail,i.zFail,i.zPass)}else this.setStencilTestEnabled(!1)},setDepthWrite:e=>{e?(this.setDepthWriteEnabled(!0),this.setDepthRange(e.zNear,e.zFar)):this.setDepthWriteEnabled(!1)},setColorWrite:e=>{e?this.setColorMask(e.r,e.g,e.b,e.a):this.setColorMask(!1,!1,!1,!1)},setStencilWrite:e=>{e?this.setStencilWriteMask(e.mask):this.setStencilWriteMask(0)}}),this.enforceState(),this.driverTest=new A(this)}get contextAttributes(){return this.gl.getContextAttributes()}get parameters(){return this._parameters}dispose(){this.bindVAO(null),this.unbindBuffer(34962),this.unbindBuffer(34963),this._textureUnitMap.length=0,Object(n["b"])()&&this.instanceCounter.printResourceCount()}setPipelineState(e){this._stateTracker.setPipeline(e)}setBlendingEnabled(e){this._blendEnabled!==e&&(!0===e?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._blendEnabled=e,this._stateTracker.invalidateBlending())}externalProgramUpdate(){var e;null==(e=this._activeShaderProgram)||e.stop(),this._activeShaderProgram=null}externalTextureUnitUpdate(e,t){for(let i=0;i<e.length;++i)this._textureUnitMap[e[i]]=null;t>=0&&(this._activeTextureUnit=t)}externalVertexArrayObjectUpdate(){const e=this.capabilities.vao;e&&(e.bindVertexArray(null),this._activeVertexArrayObject=null),this._activeVertexBuffer=null,this._activeIndexBuffer=null}externalVertexBufferUpdate(){this._activeVertexBuffer=null}externalIndexBufferUpdate(){this._activeIndexBuffer=null}setBlendColor(e,t,i,r){e===this._blendColorState.r&&t===this._blendColorState.g&&i===this._blendColorState.b&&r===this._blendColorState.a||(this.gl.blendColor(e,t,i,r),this._blendColorState.r=e,this._blendColorState.g=t,this._blendColorState.b=i,this._blendColorState.a=r,this._stateTracker.invalidateBlending())}setBlendFunction(e,t){e===this._blendFunctionState.srcRGB&&t===this._blendFunctionState.dstRGB||(this.gl.blendFunc(e,t),this._blendFunctionState.srcRGB=e,this._blendFunctionState.srcAlpha=e,this._blendFunctionState.dstRGB=t,this._blendFunctionState.dstAlpha=t,this._stateTracker.invalidateBlending())}setBlendFunctionSeparate(e,t,i,r){this._blendFunctionState.srcRGB===e&&this._blendFunctionState.srcAlpha===i&&this._blendFunctionState.dstRGB===t&&this._blendFunctionState.dstAlpha===r||(this.gl.blendFuncSeparate(e,t,i,r),this._blendFunctionState.srcRGB=e,this._blendFunctionState.srcAlpha=i,this._blendFunctionState.dstRGB=t,this._blendFunctionState.dstAlpha=r,this._stateTracker.invalidateBlending())}setBlendEquation(e){this._blendEquationState.mode!==e&&(this.gl.blendEquation(e),this._blendEquationState.mode=e,this._blendEquationState.modeAlpha=e,this._stateTracker.invalidateBlending())}setBlendEquationSeparate(e,t){this._blendEquationState.mode===e&&this._blendEquationState.modeAlpha===t||(this.gl.blendEquationSeparate(e,t),this._blendEquationState.mode=e,this._blendEquationState.modeAlpha=t,this._stateTracker.invalidateBlending())}setColorMask(e,t,i,r){this._colorMaskState.r===e&&this._colorMaskState.g===t&&this._colorMaskState.b===i&&this._colorMaskState.a===r||(this.gl.colorMask(e,t,i,r),this._colorMaskState.r=e,this._colorMaskState.g=t,this._colorMaskState.b=i,this._colorMaskState.a=r,this._stateTracker.invalidateColorWrite())}setClearColor(e,t,i,r){this._clearColor.r===e&&this._clearColor.g===t&&this._clearColor.b===i&&this._clearColor.a===r||(this.gl.clearColor(e,t,i,r),this._clearColor.r=e,this._clearColor.g=t,this._clearColor.b=i,this._clearColor.a=r)}setFaceCullingEnabled(e){this._polygonCullingEnabled!==e&&(!0===e?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._polygonCullingEnabled=e,this._stateTracker.invalidateCulling())}setPolygonOffsetFillEnabled(e){this._polygonOffsetFillEnabled!==e&&(!0===e?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._polygonOffsetFillEnabled=e,this._stateTracker.invalidatePolygonOffset())}setPolygonOffset(e,t){this._polygonOffset[0]===e&&this._polygonOffset[1]===t||(this._polygonOffset[0]=e,this._polygonOffset[1]=t,this.gl.polygonOffset(e,t),this._stateTracker.invalidatePolygonOffset())}setCullFace(e){this._cullFace!==e&&(this.gl.cullFace(e),this._cullFace=e,this._stateTracker.invalidateCulling())}setFrontFace(e){this._frontFace!==e&&(this.gl.frontFace(e),this._frontFace=e,this._stateTracker.invalidateCulling())}setScissorTestEnabled(e){this._scissorTestEnabled!==e&&(!0===e?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._scissorTestEnabled=e)}setScissorRect(e,t,i,r){this._scissorRect.x===e&&this._scissorRect.y===t&&this._scissorRect.width===i&&this._scissorRect.height===r||(this.gl.scissor(e,t,i,r),this._scissorRect.x=e,this._scissorRect.y=t,this._scissorRect.width=i,this._scissorRect.height=r)}setDepthTestEnabled(e){this._depthTestEnabled!==e&&(!0===e?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._depthTestEnabled=e,this._stateTracker.invalidateDepthTest())}setClearDepth(e){this._clearDepth!==e&&(this.gl.clearDepth(e),this._clearDepth=e)}setDepthFunction(e){this._depthFunction!==e&&(this.gl.depthFunc(e),this._depthFunction=e,this._stateTracker.invalidateDepthTest())}setDepthWriteEnabled(e){this._depthWriteEnabled!==e&&(this.gl.depthMask(e),this._depthWriteEnabled=e,this._stateTracker.invalidateDepthWrite())}setDepthRange(e,t){this._depthRange.zNear===e&&this._depthRange.zFar===t||(this.gl.depthRange(e,t),this._depthRange.zNear=e,this._depthRange.zFar=t,this._stateTracker.invalidateDepthWrite())}setStencilTestEnabled(e){this._stencilTestEnabled!==e&&(!0===e?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._stencilTestEnabled=e,this._stateTracker.invalidateStencilTest())}setClearStencil(e){e!==this._clearStencil&&(this.gl.clearStencil(e),this._clearStencil=e)}setStencilFunction(e,t,i){this._stencilFunction.func===e&&this._stencilFunction.ref===t&&this._stencilFunction.mask===i||(this.gl.stencilFunc(e,t,i),this._stencilFunction.face=1032,this._stencilFunction.func=e,this._stencilFunction.ref=t,this._stencilFunction.mask=i,this._stateTracker.invalidateStencilTest())}setStencilFunctionSeparate(e,t,i,r){this._stencilFunction.face===e&&this._stencilFunction.func===t&&this._stencilFunction.ref===i&&this._stencilFunction.mask===r||(this.gl.stencilFuncSeparate(e,t,i,r),this._stencilFunction.face=e,this._stencilFunction.func=t,this._stencilFunction.ref=i,this._stencilFunction.mask=r,this._stateTracker.invalidateStencilTest())}setStencilWriteMask(e){this._stencilWriteMask!==e&&(this.gl.stencilMask(e),this._stencilWriteMask=e,this._stateTracker.invalidateStencilWrite())}setStencilOp(e,t,i){this._stencilOperation.fail===e&&this._stencilOperation.zFail===t&&this._stencilOperation.zPass===i||(this.gl.stencilOp(e,t,i),this._stencilOperation.face=1032,this._stencilOperation.fail=e,this._stencilOperation.zFail=t,this._stencilOperation.zPass=i,this._stateTracker.invalidateStencilTest())}setStencilOpSeparate(e,t,i,r){this._stencilOperation.face===e&&this._stencilOperation.fail===t&&this._stencilOperation.zFail===i&&this._stencilOperation.zPass===r||(this.gl.stencilOpSeparate(e,t,i,r),this._stencilOperation.face=e,this._stencilOperation.face=e,this._stencilOperation.fail=t,this._stencilOperation.zFail=i,this._stencilOperation.zPass=r,this._stateTracker.invalidateStencilTest())}setActiveTexture(e,t=!1){const i=this._activeTextureUnit;return e>=0&&(t||e!==this._activeTextureUnit)&&(this.gl.activeTexture(a["a"]+e),this._activeTextureUnit=e),i}clear(e){e&&this.gl.clear(e)}clearSafe(e,t=255){e&&(16384&e&&this.setColorMask(!0,!0,!0,!0),256&e&&this.setDepthWriteEnabled(!0),1024&e&&this.setStencilWriteMask(t),this.gl.clear(e))}drawArrays(e,t,i){Object(n["b"])()&&(this._numOfDrawCalls++,this._numOfTriangles+=$(e,i)),this.gl.drawArrays(e,t,i)}drawElements(e,t,i,r){Object(n["b"])()&&(this._numOfDrawCalls++,this._numOfTriangles+=$(e,t)),this.gl.drawElements(e,t,i,r)}logIno(){Object(n["b"])()&&console.log(`DrawCalls: ${this._numOfDrawCalls}, Triangles: ${this._numOfTriangles}`)}get capabilities(){return this._capabilities}setViewport(e,t,i,r){i=Math.max(Math.round(i),1),r=Math.max(Math.round(r),1);const n=this._viewport;n.x===e&&n.y===t&&n.width===i&&n.height===r||(n.x=e,n.y=t,n.width=i,n.height=r,this.gl.viewport(e,t,i,r))}getViewport(){return{x:this._viewport.x,y:this._viewport.y,width:this._viewport.width,height:this._viewport.height}}useProgram(e){var t,i;this._activeShaderProgram!==e&&(null==(t=this._activeShaderProgram)||t.stop(),this._activeShaderProgram=e,this.gl.useProgram(null!=(i=null==e?void 0:e.glName)?i:null))}bindTexture(e,t,i=!1){(t>=this.parameters.maxTextureImageUnits||t<0)&&console.error("Input texture unit is out of range of available units!");const n=this._textureUnitMap[t];return Object(r["k"])(e)||null==e.glName?(Object(r["l"])(n)&&(this.setActiveTexture(t,i),this.gl.bindTexture(n.descriptor.target,null)),this._textureUnitMap[t]=null,n):i||n!==e?(this.setActiveTexture(t,i),this.gl.bindTexture(e.descriptor.target,e.glName),e.applyChanges(),this._textureUnitMap[t]=e,n):(e.isDirty&&(this.setActiveTexture(t,i),e.applyChanges()),n)}unbindTextureAllUnits(e){for(let t=0;t<this.parameters.maxTextureImageUnits;t++)this._textureUnitMap[t]===e&&(this.bindTexture(null,t),this._textureUnitMap[t]=null)}bindFramebuffer(e,t=!1,i=3553){if(Object(r["k"])(e))return this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),void(this._activeFramebuffer=null);(t||this._activeFramebuffer!==e)&&(e.initializeAndBind(i),this._activeFramebuffer=e)}bindBuffer(e){e&&(34962===e.bufferType?this._activeVertexBuffer=W(this.gl,e,e.bufferType,this._activeVertexBuffer):this._activeIndexBuffer=W(this.gl,e,e.bufferType,this._activeIndexBuffer))}bindRenderbuffer(e){const t=this.gl;e||(t.bindRenderbuffer(t.RENDERBUFFER,null),this._activeRenderbuffer=null),this._activeRenderbuffer!==e&&(t.bindRenderbuffer(t.RENDERBUFFER,e.glName),this._activeRenderbuffer=e)}unbindBuffer(e){34962===e?this._activeVertexBuffer=W(this.gl,null,e,this._activeVertexBuffer):this._activeIndexBuffer=W(this.gl,null,e,this._activeIndexBuffer)}bindVAO(e=null){Object(r["k"])(e)?this._activeVertexArrayObject&&(this._activeVertexArrayObject.unbind(),this._activeVertexArrayObject=null):this._activeVertexArrayObject!==e&&(e.bind(),this._activeVertexArrayObject=e)}getBoundFramebufferObject(){return this._activeFramebuffer}getBoundVAO(){return this._activeVertexArrayObject}resetState(){this.useProgram(null),this.bindVAO(null),this.bindFramebuffer(null),this.unbindBuffer(34962),this.unbindBuffer(34963);for(let e=0;e<this.parameters.maxTextureImageUnits;++e)this.bindTexture(null,e);this.setBlendingEnabled(!1),this.setBlendFunction(1,0),this.setBlendEquation(32774),this.setBlendColor(0,0,0,0),this.setFaceCullingEnabled(!1),this.setCullFace(1029),this.setFrontFace(2305),this.setPolygonOffsetFillEnabled(!1),this.setPolygonOffset(0,0),this.setScissorTestEnabled(!1),this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height),this.setDepthTestEnabled(!1),this.setDepthFunction(513),this.setDepthRange(0,1),this.setStencilTestEnabled(!1),this.setStencilFunction(519,0,0),this.setStencilOp(7680,7680,7680),this.setClearColor(0,0,0,0),this.setClearDepth(1),this.setClearStencil(0),this.setColorMask(!0,!0,!0,!0),this.setStencilWriteMask(4294967295),this.setDepthWriteEnabled(!0),this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)}enforceState(){var e,t,i,s;const o=this.gl,c=this.capabilities.vao;c&&c.bindVertexArray(null);for(let r=0;r<this.parameters.maxVertexAttributes;r++)o.disableVertexAttribArray(r);if(this._activeVertexBuffer?o.bindBuffer(this._activeVertexBuffer.bufferType,this._activeVertexBuffer.glName):o.bindBuffer(34962,null),this._activeIndexBuffer?o.bindBuffer(this._activeIndexBuffer.bufferType,this._activeIndexBuffer.glName):o.bindBuffer(34963,null),c&&this._activeVertexArrayObject){const e=this._activeVertexArrayObject;this._activeVertexArrayObject&&(this._activeVertexArrayObject.unbind(),this._activeVertexArrayObject=null),this.bindVAO(e)}o.bindFramebuffer(o.FRAMEBUFFER,null!=(e=null==(t=this._activeFramebuffer)?void 0:t.glName)?e:null),o.useProgram(null!=(i=null==(s=this._activeShaderProgram)?void 0:s.glName)?i:null),o.blendColor(this._blendColorState.r,this._blendColorState.g,this._blendColorState.b,this._blendColorState.a),o.bindRenderbuffer(o.RENDERBUFFER,this._activeRenderbuffer?this._activeRenderbuffer.glName:null),!0===this._blendEnabled?o.enable(this.gl.BLEND):o.disable(this.gl.BLEND),o.blendEquationSeparate(this._blendEquationState.mode,this._blendEquationState.modeAlpha),o.blendFuncSeparate(this._blendFunctionState.srcRGB,this._blendFunctionState.dstRGB,this._blendFunctionState.srcAlpha,this._blendFunctionState.dstAlpha),o.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearColor.a),o.clearDepth(this._clearDepth),o.clearStencil(this._clearStencil),o.colorMask(this._colorMaskState.r,this._colorMaskState.g,this._colorMaskState.b,this._colorMaskState.a),o.cullFace(this._cullFace),o.depthFunc(this._depthFunction),o.depthRange(this._depthRange.zNear,this._depthRange.zFar),!0===this._depthTestEnabled?o.enable(o.DEPTH_TEST):o.disable(o.DEPTH_TEST),o.depthMask(this._depthWriteEnabled),o.frontFace(this._frontFace),o.lineWidth(1),!0===this._polygonCullingEnabled?o.enable(o.CULL_FACE):o.disable(o.CULL_FACE),o.polygonOffset(this._polygonOffset[0],this._polygonOffset[1]),!0===this._polygonOffsetFillEnabled?o.enable(o.POLYGON_OFFSET_FILL):o.disable(o.POLYGON_OFFSET_FILL),o.scissor(this._scissorRect.x,this._scissorRect.y,this._scissorRect.width,this._scissorRect.height),!0===this._scissorTestEnabled?o.enable(o.SCISSOR_TEST):o.disable(o.SCISSOR_TEST),o.stencilFunc(this._stencilFunction.func,this._stencilFunction.ref,this._stencilFunction.mask),o.stencilOpSeparate(this._stencilOperation.face,this._stencilOperation.fail,this._stencilOperation.zFail,this._stencilOperation.zPass),!0===this._stencilTestEnabled?o.enable(o.STENCIL_TEST):o.disable(o.STENCIL_TEST),o.stencilMask(this._stencilWriteMask);for(let n=0;n<this.parameters.maxTextureImageUnits;n++){o.activeTexture(a["a"]+n),o.bindTexture(3553,null),o.bindTexture(34067,null),Object(M["a"])(o)&&o.bindTexture(32879,null);const e=this._textureUnitMap[n];Object(r["l"])(e)&&o.bindTexture(e.descriptor.target,e.glName)}o.activeTexture(a["a"]+this._activeTextureUnit),o.viewport(this._viewport.x,this._viewport.y,this._viewport.width,this._viewport.height),Object(n["b"])()&&(this._numOfDrawCalls=0,this._numOfTriangles=0)}_loadParameters(e){var t;const i=this.capabilities.textureFilterAnisotropic,r=null!=(t=e.maxAnisotropy)?t:1/0,n={versionString:this.gl.getParameter(this.gl.VERSION),maxVertexTextureImageUnits:this.gl.getParameter(this.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxVertexAttributes:this.gl.getParameter(this.gl.MAX_VERTEX_ATTRIBS),maxMaxAnisotropy:i?Math.min(this.gl.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY),r):1,maxTextureImageUnits:this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),maxTextureSize:this.gl.getParameter(this.gl.MAX_TEXTURE_SIZE)};return d["a"].TEXTURE_UNIT_FOR_UPDATES=n.maxTextureImageUnits-1,n}}function W(e,t,i,r){return t?r!==t&&e.bindBuffer(i,t.glName):e.bindBuffer(i,null),t}function $(e,t){switch(e){case 0:return 2*t;case 4:return t/3;case 5:case 6:return t-2;default:return 0}}},"6fcc":function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var r=i("bc40"),n=i("3886");function a(e){const t=n["a"]`bool isNaN( float val )
{
return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true;
}`;e.code.add(t)}function s(e,t){e.vertex.include(a),e.include(r["a"],t);const i=e.vertex;i.uniforms.add("uDepthBias","vec2"),i.uniforms.add("uViewportDimInv","vec2"),t.legacy?(i.uniforms.add("uView","mat4"),i.uniforms.add("uProj","mat4")):i.uniforms.add("uTransformNormal_ViewFromGlobal","mat3"),t.legacy?i.code.add(n["a"]`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = uDepthBias.x;
float offsetZ  = uDepthBias.y;
vec4 projNormal = uProj * uView * vec4(globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * uViewportDimInv * normalize(projNormal.xyz).xy;
}`):i.code.add(n["a"]`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = uDepthBias.x;
float offsetZ  = uDepthBias.y;
vec4 projNormal = uTransform_ProjFromView * vec4(uTransformNormal_ViewFromGlobal * globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * uViewportDimInv * normalize(projNormal.xyz).xy;
}`),i.code.add(n["a"]`float _calculateProjectedBiasZ(vec4 projPos) {
float offsetZ = uDepthBias.y;
return sqrt(max(projPos.z,0.0)) * offsetZ;
}
vec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {
vec2 offsetXY = calculateProjectedBiasXY(projPos, worldNormal);
if (!isNaN(offsetXY.x) && !isNaN(offsetXY.y)) {
projPos.xy += offsetXY;
}
projPos.z += _calculateProjectedBiasZ(projPos);
return projPos;
}`)}},7079:function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var r=i("d047"),n=i("9617"),a=i("501b"),s=i("3886");function o(e,t){t.multipassGeometryEnabled&&e.vertex.include(n["b"]),t.multipassTerrainEnabled&&e.varyings.add("depth","float"),e.vertex.code.add(s["a"]`
  void main(void) {
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel
      // filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${t.multipassGeometryEnabled?s["a"]`
        // Don't draw vertices behind geometry
        if(geometryDepthTest(.5 + .5 * posProjCenter.xy / posProjCenter.w, projectAux.posView.z)){
          posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
        }`:""}

      ${t.multipassTerrainEnabled?"depth = projectAux.posView.z;":""}
      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    } else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  }
  `),t.multipassTerrainEnabled&&e.fragment.include(r["a"]),e.fragment.uniforms.add("terrainDepthTexture","sampler2D"),e.fragment.uniforms.add("cameraNearFar","vec2"),e.fragment.uniforms.add("inverseViewport","vec2"),e.fragment.include(a["a"]),e.fragment.code.add(s["a"]`
  void main() {
    gl_FragColor = vec4(1, 1, 1, 1);
    ${t.multipassTerrainEnabled?s["a"]`

          vec2 uv = gl_FragCoord.xy * inverseViewport;

          //Read the rgba data from the texture linear depth
          vec4 terrainDepthData = texture2D(terrainDepthTexture, uv);

          float terrainDepth = linearDepthFromFloat(rgba2float(terrainDepthData), cameraNearFar);

          //If HUD vertex is behind terrain and the terrain depth is not the initialize value (e.g. we are not looking at the sky)
          //Mark the HUD vertex as occluded by transparent terrain
          if(depth < terrainDepth && terrainDepthData != vec4(0,0,0,1)){
            gl_FragColor.g = 0.5;
          }`:""}
  }
  `)}},7088:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("3886");function n(e,t){const i=e.fragment;t.receiveAmbientOcclusion?(i.uniforms.add("ssaoTex","sampler2D"),i.uniforms.add("viewportPixelSz","vec4"),i.code.add(r["a"]`float evaluateAmbientOcclusion() {
return 1.0 - texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;
}
float evaluateAmbientOcclusionInverse() {
float ssao = texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;
return viewportPixelSz.z < 0.0 ? 1.0 : ssao;
}`)):i.code.add(r["a"]`float evaluateAmbientOcclusion() { return 0.0; }
float evaluateAmbientOcclusionInverse() { return 1.0; }`)}},"70a2":function(e,t,i){"use strict";i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return r})),i.d(t,"c",(function(){return a}));const r=e=>{class t extends e{constructor(){super(...arguments),this._isDisposed=!1}dispose(){for(const t of null!=(e=this._managedDisposables)?e:[]){var e;const i=this[t];this[t]=null,i&&"function"==typeof i.dispose&&i.dispose()}this._isDisposed=!0}get isDisposed(){return this._isDisposed}}return t};class n extends(r(class{})){}function a(){return(e,t)=>{var i,r;e.hasOwnProperty("_managedDisposables")||(e._managedDisposables=null!=(i=null==(r=e._managedDisposables)?void 0:r.slice())?i:[]),e._managedDisposables.unshift(t)}}},"70ce":function(e,t,i){"use strict";i.d(t,"a",(function(){return p}));var r=i("a4ee"),n=i("fc29"),a=i("9096"),s=i("b2b2"),o=i("59b2"),c=(i("b50f"),i("c120"),i("cea0"),i("d386")),l=i("22f4"),d=i("2258"),h=i("f353");const u={visible:"visibleSublayers",definitionExpression:"layerDefs",labelingInfo:"hasDynamicLayers",labelsVisible:"hasDynamicLayers",opacity:"hasDynamicLayers",minScale:"visibleSublayers",maxScale:"visibleSublayers",renderer:"hasDynamicLayers",source:"hasDynamicLayers"};let p=class extends(Object(a["b"])(n["a"])){constructor(e){super(e),this.floors=null,this.scale=0}destroy(){this.layer=null}get dynamicLayers(){if(!this.hasDynamicLayers)return null;const e=this.visibleSublayers.map(e=>{const t=Object(h["c"])(this.floors,e);return e.toExportImageJSON(t)});return e.length?JSON.stringify(e):null}get hasDynamicLayers(){return this.layer&&Object(d["a"])(this.visibleSublayers,this.layer.serviceSublayers,this.layer)}set layer(e){this._get("layer")!==e&&(this._set("layer",e),this.handles.remove("layer"),e&&this.handles.add([e.allSublayers.on("change",()=>this.notifyChange("visibleSublayers")),e.on("sublayer-update",e=>this.notifyChange(u[e.propertyName]))],"layer"))}get layers(){const e=this.visibleSublayers;return e?e.length?"show:"+e.map(e=>e.id).join(","):"show:-1":null}get layerDefs(){var e;const t=!(null==(e=this.floors)||!e.length),i=this.visibleSublayers.filter(e=>null!=e.definitionExpression||t&&null!=e.floorInfo);return i.length?JSON.stringify(i.reduce((e,t)=>{const i=Object(h["c"])(this.floors,t),r=Object(s["l"])(i)?Object(h["a"])(i,t):t.definitionExpression;return e[t.id]=r,e},{})):null}get version(){this.commitProperty("layers"),this.commitProperty("layerDefs"),this.commitProperty("dynamicLayers"),this.commitProperty("timeExtent");const e=this.layer;return e&&(e.commitProperty("dpi"),e.commitProperty("imageFormat"),e.commitProperty("imageTransparency"),e.commitProperty("gdbVersion")),(this._get("version")||0)+1}get visibleSublayers(){const e=[];if(!this.layer)return e;const t=this.layer.sublayers,i=t=>{const r=this.scale,n=0===r,a=0===t.minScale||r<=t.minScale,s=0===t.maxScale||r>=t.maxScale;t.visible&&(n||a&&s)&&(t.sublayers?t.sublayers.forEach(i):e.unshift(t))};t&&t.forEach(i);const r=this._get("visibleSublayers");return!r||r.length!==e.length||r.some((t,i)=>e[i]!==t)?e:r}toJSON(){const e=this.layer;let t={dpi:e.dpi,format:e.imageFormat,transparent:e.imageTransparency,gdbVersion:e.gdbVersion||null};return this.hasDynamicLayers&&this.dynamicLayers?t.dynamicLayers=this.dynamicLayers:t={...t,layers:this.layers,layerDefs:this.layerDefs},t}};Object(r["a"])([Object(o["b"])({readOnly:!0})],p.prototype,"dynamicLayers",null),Object(r["a"])([Object(o["b"])()],p.prototype,"floors",void 0),Object(r["a"])([Object(o["b"])({readOnly:!0})],p.prototype,"hasDynamicLayers",null),Object(r["a"])([Object(o["b"])()],p.prototype,"layer",null),Object(r["a"])([Object(o["b"])({readOnly:!0})],p.prototype,"layers",null),Object(r["a"])([Object(o["b"])({readOnly:!0})],p.prototype,"layerDefs",null),Object(r["a"])([Object(o["b"])({type:Number})],p.prototype,"scale",void 0),Object(r["a"])([Object(o["b"])(l["a"])],p.prototype,"timeExtent",void 0),Object(r["a"])([Object(o["b"])({readOnly:!0})],p.prototype,"version",null),Object(r["a"])([Object(o["b"])({readOnly:!0})],p.prototype,"visibleSublayers",null),p=Object(r["a"])([Object(c["a"])("esri.layers.mixins.ExportImageParameters")],p)},"713b":function(e,t,i){"use strict";i.d(t,"a",(function(){return u})),i.d(t,"b",(function(){return h}));var r=i("d272"),n=i("4db9"),a=i("6d5b"),s=i("6a07"),o=i("6750"),c=i("ebd5"),l=i("3886"),d=i("690a");function h(e){const t=new d["a"];return t.include(n["a"],{linearDepth:!1}),t.include(a["a"],e),t.include(o["a"],{...e,stippleRequiresStretchMeasure:!1}),t.vertex.uniforms.add("proj","mat4").add("view","mat4"),e.stippleEnabled&&(t.vertex.uniforms.add("ndcToPixel","vec2"),t.attributes.add("uv0","vec2"),t.attributes.add("auxpos1","vec3")),t.attributes.add("position","vec3"),t.varyings.add("vpos","vec3"),t.vertex.code.add(l["a"]`void main(void) {
vpos = position;
forwardNormalizedVertexColor();
gl_Position = transformPosition(proj, view, vpos);`),e.stippleEnabled&&(t.vertex.code.add(l["a"]`vec4 vpos2 = transformPosition(proj, view, auxpos1);
float lineSegmentPixelSize = length((vpos2.xy / vpos2.w - gl_Position.xy / gl_Position.w) * ndcToPixel);`),e.draped||t.vertex.code.add(l["a"]`vec3 segmentCenter = (position + auxpos1) * 0.5;
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),t.vertex.code.add(l["a"]`float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);`),e.draped?t.vertex.code.add(l["a"]`float startPseudoScreen = uv0.y * discreteWorldToScreenRatio - mix(0.0, lineSegmentPixelSize, uv0.x);
float segmentLengthPseudoScreen = lineSegmentPixelSize;`):t.vertex.code.add(l["a"]`float segmentLengthRender = length(position - auxpos1);
float startPseudoScreen = mix(uv0.y, uv0.y - segmentLengthRender, uv0.x) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),t.vertex.code.add(l["a"]`vec2 stippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, lineSegmentPixelSize, stipplePatternPixelSize);
vStippleDistance = mix(stippleDistanceLimits.x, stippleDistanceLimits.y, uv0.x);
vStippleDistance *= gl_Position.w;`)),t.vertex.code.add(l["a"]`}`),4===e.output&&t.include(s["a"]),t.include(r["a"],e),t.fragment.uniforms.add("constantColor","vec4").add("alphaCoverage","float"),t.fragment.code.add(l["a"]`
  void main() {
    discardBySlice(vpos);

    vec4 color = ${e.attributeColor?"vColor":"constantColor"};

    float stippleAlpha = getStippleAlpha();
    discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);

    vec4 finalColor = blendStipple(vec4(color.rgb, color.a * alphaCoverage), stippleAlpha);

    if (finalColor.a < ${l["a"].float(c["c"])}) {
      discard;
    }

    ${0===e.output?l["a"]`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${4===e.output?l["a"]`outputHighlight();`:""}
  }
  `),t}const u=Object.freeze({__proto__:null,build:h})},7289:function(e,t,i){"use strict";i.d(t,"a",(function(){return R})),i.d(t,"b",(function(){return E})),i.d(t,"c",(function(){return d})),i.d(t,"d",(function(){return c})),i.d(t,"e",(function(){return b})),i.d(t,"f",(function(){return u})),i.d(t,"g",(function(){return f})),i.d(t,"h",(function(){return p})),i.d(t,"i",(function(){return h})),i.d(t,"j",(function(){return w})),i.d(t,"k",(function(){return S})),i.d(t,"l",(function(){return C})),i.d(t,"m",(function(){return P})),i.d(t,"n",(function(){return T})),i.d(t,"o",(function(){return M})),i.d(t,"p",(function(){return A})),i.d(t,"q",(function(){return j})),i.d(t,"r",(function(){return L})),i.d(t,"s",(function(){return D})),i.d(t,"t",(function(){return I})),i.d(t,"u",(function(){return x})),i.d(t,"v",(function(){return F})),i.d(t,"w",(function(){return l}));var r=i("38a4"),n=i("b2b2"),a=i("e431"),s=i("0b2d"),o=(i("f895"),i("7361"));function c(e=V){return[e[0],e[1],e[2],e[3]]}function l(e,t,i,r){return h(e,t,i,r,o["e"].get())}function d(e,t=c()){return h(e[0],e[1],e[2],e[3],t)}function h(e,t,i,r,n=c()){return n[0]=e,n[1]=t,n[2]=i,n[3]=r,n}function u(e,t,i){return Object(a["n"])(i,e),i[3]=t,i}function p(e,t,i){const r=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=Math.abs(r-1)>1e-5&&r>1e-12?1/Math.sqrt(r):1;return i[0]=t[0]*n,i[1]=t[1]*n,i[2]=t[2]*n,i[3]=-(i[0]*e[0]+i[1]*e[1]+i[2]*e[2]),i}function f(e,t,i,r=c()){const n=i[0]-t[0],a=i[1]-t[1],s=i[2]-t[2],o=e[0]-t[0],l=e[1]-t[1],d=e[2]-t[2],h=a*d-s*l,u=s*o-n*d,p=n*l-a*o,f=h*h+u*u+p*p,b=Math.abs(f-1)>1e-5&&f>1e-12?1/Math.sqrt(f):1;r[0]=h*b,r[1]=u*b,r[2]=p*b,r[3]=-(r[0]*e[0]+r[1]*e[1]+r[2]*e[2])}function b(e,t,i,r,n){if(e.count<3)return!1;e.getVec(i,g);let s=r,o=!1;for(;s<e.count-1&&!o;)e.getVec(s,v),s++,o=!Object(a["r"])(g,v);if(!o)return!1;for(s=Math.max(s,n),o=!1;s<e.count&&!o;)e.getVec(s,y),s++,Object(a["m"])(O,g,v),Object(a["u"])(O,O),Object(a["m"])(_,v,y),Object(a["u"])(_,_),o=!Object(a["r"])(g,y)&&!Object(a["r"])(v,y)&&Math.abs(Object(a["k"])(O,_))<m;return o?(f(g,v,y,t),!0):(0!==i||1!==r||2!==n)&&b(e,t,0,1,2)}const m=.99619469809,g=Object(s["f"])(),v=Object(s["f"])(),y=Object(s["f"])(),O=Object(s["f"])(),_=Object(s["f"])();function x(e,t,i){return e!==i&&d(e,i),i[3]=-Object(a["k"])(L(i),t),i}function j(e,t){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function w(e,t,i,r){return Object(a["j"])(y,t,e),p(i,y,r)}function S(e,t,i,r){return z(e,t,Object(a["m"])(o["d"].get(),i,t),k,r)}function T(e,t,i){return!!Object(n["l"])(t)&&z(e,t.origin,t.direction,U,i)}function C(e,t,i){return z(e,t.origin,t.vector,0,i)}function P(e,t,i){return z(e,t.origin,t.vector,1,i)}function A(e,t){return F(e,t)>=0}function M(e,t){const i=t[0],r=t[1],n=t[2],a=t[3],s=t[4],o=t[5];return e[0]*(e[0]>0?i:a)+e[1]*(e[1]>0?r:s)+e[2]*(e[2]>0?n:o)+e[3]>=0}function R(e,t){const i=Object(a["k"])(L(e),t.ray.direction),r=-F(e,t.ray.origin);if(r<0&&i>=0)return!1;if(i>-1e-6&&i<1e-6)return r>0;if((r<0||i<0)&&!(r<0&&i<0))return!0;const n=r/i;return i>0?n<t.c1&&(t.c1=n):n>t.c0&&(t.c0=n),t.c0<=t.c1}function E(e,t){const i=Object(a["k"])(L(e),t.ray.direction),r=-F(e,t.ray.origin);if(i>-1e-6&&i<1e-6)return r>0;const n=r/i;return i>0?n<t.c1&&(t.c1=n):n>t.c0&&(t.c0=n),t.c0<=t.c1}function D(e,t,i){const r=Object(a["h"])(o["d"].get(),L(e),-e[3]),n=I(e,Object(a["m"])(o["d"].get(),t,r),o["d"].get());return Object(a["i"])(i,n,r),i}function I(e,t,i){const r=Object(a["h"])(o["d"].get(),L(e),Object(a["k"])(L(e),t));return Object(a["m"])(i,t,r),i}function F(e,t){return Object(a["k"])(L(e),t)+e[3]}function z(e,t,i,n,s){const o=Object(a["k"])(L(e),i);if(0===o)return!1;let c=-(Object(a["k"])(L(e),t)+e[3])/o;return 1&n&&(c=Object(r["f"])(c,0,1)),!(!(4&n)&&c<0||!(8&n)&&c>1)&&(Object(a["i"])(s,t,Object(a["h"])(s,i,c)),!0)}function L(e){return e}const V=[0,0,1,0],k=12,U=8},7304:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i("5876"),n=i("3886");function a(e,t){1===t.componentData&&(e.vertex.uniforms.add("uComponentColorTex","sampler2D"),e.vertex.uniforms.add("uComponentColorTexInvDim","vec2"),e.attributes.add("componentIndex","float"),e.varyings.add("vExternalColorMixMode","mediump float"),e.varyings.add("vExternalColor","vec4"),e.include(r["a"]),e.vertex.code.add(n["a"]`vec4 _readComponentColor() {
float normalizedIndex = (componentIndex + 0.5) * uComponentColorTexInvDim.x;
vec2 indexCoord = vec2(
mod(normalizedIndex, 1.0),
(floor(normalizedIndex) + 0.5) * uComponentColorTexInvDim.y
);
return texture2D(uComponentColorTex, indexCoord);
}
vec4 forwardExternalColor(out bool castShadows) {
vec4 componentColor = _readComponentColor() * 255.0;
float shadowFlag = mod(componentColor.b * 255.0, 2.0);
componentColor.b -= shadowFlag;
castShadows = shadowFlag >= 1.0;
int decodedColorMixMode;
vExternalColor = decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451;
vExternalColorMixMode = float(decodedColorMixMode) + 0.5;
return vExternalColor;
}`),e.fragment.code.add(n["a"]`void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {
externalColor = vExternalColor;
externalColorMixMode = int(vExternalColorMixMode);
}`)),0===t.componentData&&(e.vertex.uniforms.add("uExternalColor","vec4"),e.fragment.uniforms.add("uExternalColorMixMode","int"),e.varyings.add("vExternalColor","vec4"),e.vertex.code.add(n["a"]`vec4 forwardExternalColor(out bool castShadows) {
vExternalColor = uExternalColor;
castShadows = true;
return uExternalColor;
}`),e.fragment.code.add(n["a"]`void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {
externalColor = vExternalColor;
externalColorMixMode = uExternalColorMixMode;
}`))}},7361:function(e,t,i){"use strict";i.d(t,"a",(function(){return b})),i.d(t,"b",(function(){return m})),i.d(t,"c",(function(){return u})),i.d(t,"d",(function(){return p})),i.d(t,"e",(function(){return f}));var r=i("2ab7"),n=i("dae5"),a=i("afe1"),s=i("b139"),o=i("02f1"),c=i("0b2d"),l=i("0fc4");class d{constructor(e,t,i){this.itemByteSize=e,this.itemCreate=t,this._buffers=new Array,this._items=new Array,this._itemsPtr=0,this._itemsPerBuffer=Math.ceil(i/this.itemByteSize)}get(){0===this._itemsPtr&&Object(r["a"])(()=>this.reset());const e=Math.floor(this._itemsPtr/this._itemsPerBuffer);for(;this._buffers.length<=e;){const e=new ArrayBuffer(this._itemsPerBuffer*this.itemByteSize);for(let t=0;t<this._itemsPerBuffer;++t)this._items.push(this.itemCreate(e,t*this.itemByteSize));this._buffers.push(e)}return this._items[this._itemsPtr++]}reset(){const e=2*(Math.floor(this._itemsPtr/this._itemsPerBuffer)+1);for(;this._buffers.length>e;)this._buffers.pop(),this._items.length=this._buffers.length*this._itemsPerBuffer;this._itemsPtr=0}static createVec2f64(e=h){return new d(16,o["d"],e)}static createVec3f64(e=h){return new d(24,c["e"],e)}static createVec4f64(e=h){return new d(32,l["c"],e)}static createMat3f64(e=h){return new d(72,n["a"],e)}static createMat4f64(e=h){return new d(128,a["b"],e)}static createQuatf64(e=h){return new d(32,s["d"],e)}get test(){return{size:this._buffers.length*this._itemsPerBuffer*this.itemByteSize}}}const h=4096,u=d.createVec2f64(),p=d.createVec3f64(),f=d.createVec4f64(),b=(d.createMat3f64(),d.createMat4f64()),m=d.createQuatf64()},"73d4":function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var r=i("7cb4"),n=i("5211"),a=i("3886");function s(e,t){const i=e.fragment;t.baseColorTexture?(e.include(r["a"],t),i.uniforms.add("uBaseColorTexture","sampler2D"),i.uniforms.add("uBaseColorTextureSize","vec2"),2===t.attributeTextureCoordinates?(e.include(n["a"]),i.code.add(a["a"]`vec4 readBaseColorTexture() {
return textureAtlasLookup(
uBaseColorTexture,
uBaseColorTextureSize,
vuv0,
vuvRegion
);
}`)):i.code.add(a["a"]`vec4 readBaseColorTexture() {
return texture2D(uBaseColorTexture, vuv0);
}`)):i.code.add(a["a"]`vec4 readBaseColorTexture() { return vec4(1.0); }`)}},7438:function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return u})),i.d(t,"c",(function(){return c})),i.d(t,"d",(function(){return d})),i.d(t,"e",(function(){return l})),i.d(t,"f",(function(){return s})),i.d(t,"g",(function(){return n})),i.d(t,"h",(function(){return h}));var r=i("189c");const n=Object(r["h"])(770,1,771,771),a=Object(r["i"])(1,1),s=Object(r["i"])(0,771);function o(e){return 2===e?null:1===e?s:a}function c(e){return 2===e?r["e"]:null}const l=5e5,d={factor:-1,units:-2};function h(e){return e?d:null}function u(e){return 3===e||2===e?513:515}},"748f":function(e,t,i){"use strict";i.d(t,"a",(function(){return d})),i.d(t,"b",(function(){return h}));var r=i("ce6d"),n=i("af40"),a=i("b2b2"),s=i("8a44"),o=i("003f");const c=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","shaderTransformationChanged","objectTransformation","visibilityChanged","occlusionChanged","highlightChanged","objectGeometryAdded","objectGeometryRemoved","vertexAttrsUpdated"];var l=i("0bde");class d extends o["a"]{constructor(e,t=""){var i,a,o;super(),this.apiLayerUid=t,this.type=0,this.events=new r["a"],this.isSliceable=!1,this._objects=new s["a"],this._stageHandles=new n["a"],this.apiLayerUid=t,this.isVisible=null==(i=null==e?void 0:e.isVisible)||i,this.isPickable=null==(a=null==e?void 0:e.isPickable)||a,this.updatePolicy=null!=(o=null==e?void 0:e.updatePolicy)?o:0}get objects(){return this._objects}destroy(){this.detachStage(),this._stage=null}attachStage(e){this.detachStage(),this._stage=e;for(const t of c)this._stageHandles.add(this.events.on(t,i=>e.handleEvent(t,i)))}detachStage(){this._stageHandles.removeAll(),this.invalidateSpatialQueryAccelerator()}add(e){this._objects.push(e),e.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:e}),Object(a["l"])(this._octree)&&this._octree.add([e])}remove(e){this._objects.removeUnordered(e)&&(e.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:e}),Object(a["l"])(this._octree)&&this._octree.remove([e]))}addMany(e){this._objects.pushArray(e);for(const t of e)t.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:e}),Object(a["l"])(this._octree)&&this._octree.add(e)}removeMany(e){const t=new Array;if(this._objects.removeUnorderedMany(e,e.length,t),0!==t.length){for(const e of t)e.parentLayer=null;this.events.emit("layerObjectsRemoved",{layer:this,objects:t}),Object(a["l"])(this._octree)&&this._octree.remove(t)}}sync(){Object(a["l"])(this._stage)&&1!==this.updatePolicy&&this._stage.syncLayer(this.id)}notifyObjectBBChanged(e,t){Object(a["l"])(this._octree)&&this._octree.update(e,t)}getSpatialQueryAccelerator(){return Object(a["k"])(this._octree)&&this._objects.length>50&&this._createOctree(),this._octree}shaderTransformationChanged(){this.invalidateSpatialQueryAccelerator(),this.events.emit("shaderTransformationChanged",this)}invalidateSpatialQueryAccelerator(){this._octree=Object(a["e"])(this._octree)}_createOctree(){this._octree=new l["a"](e=>e.boundingVolumeWorldSpace.bounds),this._octree.add(this._objects.data,this._objects.length)}}function h(e){return Object(a["l"])(e)&&0===e.type}},"74df":function(e,t,i){"use strict";i.d(t,"a",(function(){return m})),i.d(t,"b",(function(){return f})),i.d(t,"c",(function(){return p}));var r=i("b2b2"),n=i("d791"),a=i("afe1"),s=i("e431"),o=i("0b2d"),c=i("8188"),l=i("2e0f"),d=i("ba58"),h=i("6611"),u=i("0cb9");function p(e,t,i,r){const n=e.stageObject,a=i.spatialReference,s=n.geometryRecords,o="absolute-height"!==t.mode;let d=0;for(const p of s){const e=p.geometry,s=p.getShaderTransformation();y[0]=s[12],y[1]=s[13],y[2]=s[14],e.invalidateBoundingInfo();const f=e.getMutableAttribute("position"),b=f.data,m=e.vertexAttributes.get("mapPos").data,_=f.size,x=b.length/_,w=new u["a"](m,a);let S=0,T=!1,C=0;for(let n=0;n<x;n++){if(O[0]=b[S],O[1]=b[S+1],O[2]=b[S+2],Object(l["g"])(w,i,t,r,j),o&&(C+=j.sampledElevation),h["a"].TESTS_DISABLE_OPTIMIZATIONS)b[S]=w.array[w.offset],b[S+1]=w.array[w.offset+1],b[S+2]=j.z,Object(c["p"])(b,a,S,b,r.spatialReference,S,1),b[S]-=y[0],b[S+1]-=y[1],b[S+2]-=y[2],T=!0;else{v[0]=b[S]+y[0],v[1]=b[S+1]+y[1],v[2]=b[S+2]+y[2],r.setAltitude(v,j.z),b[S]=v[0]-y[0],b[S+1]=v[1]-y[1],b[S+2]=v[2]-y[2];const e=g/r.unitInMeters;(Math.abs(O[0]-b[S])>=e||Math.abs(O[1]-b[S+1])>=e||Math.abs(O[2]-b[S+2])>=e)&&(T=!0)}S+=_,w.offset+=3}d+=C/x,T&&n.geometryVertexAttrsUpdated(p)}return d/s.length}function f(e,t,i,r){const a=e.stageObject,o=t.centerPointInElevationSR;let u=0;a.metadata.usesVerticalDistanceToGround?(Object(l["g"])(o,i,t,r,j),Object(d["j"])(a,j.verticalDistanceToGround),u=j.sampledElevation):(Object(l["g"])(o,i,t,r,j),"absolute-height"!==t.mode&&(u=j.sampledElevation));const p=Object(n["d"])(b,a.transformation),f=Object(s["z"])(x,p[12],p[13],p[14]);h["a"].TESTS_DISABLE_OPTIMIZATIONS?(v[0]=o.x,v[1]=o.y,v[2]=j.z,Object(c["d"])(o.spatialReference,v,p,r.spatialReference)&&(a.transformation=p)):r.setAltitudeOfTransformation(j.z,p);const m=g/r.unitInMeters;return(Math.abs(p[12]-f[0])>=m||Math.abs(p[13]-f[1])>=m||Math.abs(p[14]-f[2])>=m)&&(a.transformation=p),u}const b=Object(a["d"])();function m(e,t,i,n){const a=e.graphics3DSymbolLayer.lodRenderer;if(Object(r["k"])(a))return 0;const o=t.centerPointInElevationSR;Object(l["g"])(o,i,t,n,j);const d="absolute-height"!==t.mode?j.sampledElevation:0,u=a.instanceData,p=e.instanceIndex,f=_;u.getGlobalTransform(p,f);const b=Object(s["z"])(x,f[12],f[13],f[14]);h["a"].TESTS_DISABLE_OPTIMIZATIONS?(v[0]=o.x,v[1]=o.y,v[2]=j.z,Object(c["d"])(o.spatialReference,v,f,n.spatialReference)&&u.setGlobalTransform(p,f)):n.setAltitudeOfTransformation(j.z,f);const m=g/n.unitInMeters;return(h["a"].TESTS_DISABLE_OPTIMIZATIONS||Math.abs(f[12]-b[0])>=m||Math.abs(f[13]-b[1])>=m||Math.abs(f[14]-b[2])>=m)&&u.setGlobalTransform(p,f),d}const g=.01,v=Object(o["f"])(),y=Object(o["f"])(),O=Object(o["f"])(),_=Object(a["d"])(),x=Object(o["f"])(),j=new l["a"]},7585:function(e,t,i){"use strict";i.d(t,"a",(function(){return ee})),i.d(t,"b",(function(){return $})),i.d(t,"c",(function(){return te}));var r=i("a4ee"),n=i("fc29"),a=i("ce6d"),s=i("af40"),o=i("e92d"),c=i("28eb"),l=i("b2b2"),d=i("8a44"),h=i("c47a"),u=i("3795"),p=i("59b2"),f=(i("b50f"),i("c120"),i("cea0"),i("d386")),b=i("d791"),m=i("02f1"),g=i("0b2d"),v=i("afe1"),y=i("6611"),O=i("4294"),_=i("738e"),x=(i("7ce4"),i("d267")),j=(i("1956"),i("d17d"),i("9f8b"),i("a1ff"));i("0fa6");class w{constructor(e,t){this.size=Object(_["a"])(),this._fbo=null,this._fbo=new x["a"](e,{colorTarget:0,depthStencilTarget:0},{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9987,hasMipmap:t,maxAnisotropy:8,width:0,height:0})}dispose(){this._fbo=Object(l["f"])(this._fbo)}getTexture(){return this._fbo?this._fbo.colorTexture:null}isValid(){return null!==this._fbo}resize(e,t){this.size[0]=e,this.size[1]=t,this._fbo.resize(this.size[0],this.size[1])}bind(e){e.bindFramebuffer(this._fbo)}generateMipMap(){this._fbo.colorTexture.descriptor.hasMipmap&&this._fbo.colorTexture.generateMipmap()}disposeRenderTargetMemory(){var e;null==(e=this._fbo)||e.resize(0,0)}get gpuMemoryUsage(){var e,t;return null!=(e=null==(t=this._fbo)?void 0:t.gpuMemoryUsage)?e:0}}class S{constructor(e){const t=(t,i,r=!0)=>({type:i,fbo:new w(e,r),renderPass:t,valid:!1,lastUsed:1/0});this.renderTargets=[t(0,0),t(0,1),t(5,2,!1),t(3,3),t(0,4)]}getTarget(e){return this.renderTargets[e].fbo}dispose(){for(const e of this.renderTargets)e.fbo.dispose()}disposeRenderTargetMemory(){for(const e of this.renderTargets)e.fbo.disposeRenderTargetMemory()}validateUsageForTarget(e,t,i){if(e)t.lastUsed=i;else if(i-t.lastUsed>T)t.fbo.disposeRenderTargetMemory(),t.lastUsed=1/0;else if(t.lastUsed<1/0)return!0;return!1}get gpuMemoryUsage(){return this.renderTargets.reduce((e,t)=>e+t.fbo.gpuMemoryUsage,0)}}const T=1e3;var C=i("0e88"),P=i("70a2"),A=i("171c"),M=i("4395"),R=i("d5f7"),E=i("adf1"),D=i("9250"),I=i("d6e5"),F=i("fdc9"),z=i("9def"),L=i("191a");let V=class extends n["a"]{constructor(){super(...arguments),this._pending=new k,this._changes=new F["a"],this._materialRenderers=new Map,this._sortedMaterialRenderers=new d["a"],this._hasHighlights=!1,this._hasWater=!1}dispose(){this._changes.prune(),this._materialRenderers.forEach(e=>e.dispose()),this._materialRenderers.clear(),this._sortedMaterialRenderers.clear()}get updating(){return!this._pending.empty||this._changes.updates.length>0}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return Object(c["c"])(this._materialRenderers,e=>e.rendersOccluded)}get isEmpty(){return!this.updating&&0===this._materialRenderers.size}commitChanges(){if(!this.updating)return!1;this._processAddsRemoves();const e=Object(z["a"])(this._changes);let t=!1,i=!1,r=!1;return e.forEach((e,n)=>{let a=this._materialRenderers.get(n);if(!a&&e.adds.length>0&&(a=new L["a"](this.rctx,this.materialRepository,n),this._materialRenderers.set(n,a),t=!0,i=!0,r=!0),!a)return;const s=i||a.hasHighlights,o=r||a.hasWater;a.modify(e),i=i||s!==a.hasHighlights,r=r||o!==a.hasWater,a.isEmpty&&(this._materialRenderers.delete(n),a.dispose(),t=!0)}),this._changes.clear(),t&&this.updateSortedMaterialRenderers(),i&&(this._hasHighlights=Object(c["c"])(this._materialRenderers,e=>e.hasHighlights)),r&&(this._hasWater=Object(c["c"])(this._materialRenderers,e=>e.hasWater)),this.notifyChange("updating"),!0}add(e){if(0===e.length)return;const t=this._pending.empty;for(const i of e)this._pending.adds.add(i);t&&this.notifyChange("updating")}remove(e){const t=this._pending.empty;for(const i of e)this._pending.adds.has(i)?(this._pending.removed.add(i),this._pending.adds.delete(i)):this._pending.removed.has(i)||this._pending.removes.add(i);t&&!this._pending.empty&&this.notifyChange("updating")}modify(e,t){const i=0===this._changes.updates.length;for(const r of e){const e=this._changes.updates.pushNew();e.renderGeometry=r,e.updateType=t}i&&this._changes.updates.length>0&&this.notifyChange("updating")}updateLogic(e){let t=!1;return this._sortedMaterialRenderers.forAll(({materialRenderer:i})=>t=i.updateLogic(e)||t),t}render(e,t){for(let i=0;i<this._sortedMaterialRenderers.length;i++){const r=this._sortedMaterialRenderers.data[i];r.material.shouldRender(e)&&r.materialRenderer.render(t.slot,e.pass,t)}}updateSortedMaterialRenderers(){this._sortedMaterialRenderers.clear();let e=0;this._materialRenderers.forEach((t,i)=>{i.insertOrder=e++,this._sortedMaterialRenderers.push({material:i,materialRenderer:t})}),this._sortedMaterialRenderers.sort((e,t)=>{const i=t.material.renderPriority-e.material.renderPriority;return 0!==i?i:e.material.insertOrder-t.material.insertOrder})}_processAddsRemoves(){this._changes.adds.clear(),this._changes.removes.clear(),this._changes.adds.pushArray(Array.from(this._pending.adds)),this._changes.removes.pushArray(Array.from(this._pending.removes));for(let e=0;e<this._changes.updates.length;){const t=this._changes.updates.data[e];this._pending.has(t.renderGeometry)?this._changes.updates.removeUnorderedIndex(e):e++}this._pending.clear()}get test(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}}};Object(r["a"])([Object(p["b"])()],V.prototype,"rctx",void 0),Object(r["a"])([Object(p["b"])()],V.prototype,"materialRepository",void 0),Object(r["a"])([Object(p["b"])()],V.prototype,"updating",null),V=Object(r["a"])([Object(f["a"])("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],V);class k{constructor(){this.adds=new Set,this.removes=new Set,this.removed=new Set}get empty(){return 0===this.adds.size&&0===this.removes.size&&0===this.removed.size}has(e){return this.adds.has(e)||this.removes.has(e)||this.removed.has(e)}clear(){this.adds.clear(),this.removes.clear(),this.removed.clear()}}var U=i("7aed"),B=i("2bc9"),N=i("2245"),G=i("c1c0"),q=i("9305"),H=i("8539");const W=o["a"].getLogger("esri.views.3d.webgl-engine.lib.OverlayRenderer");let $=class extends(Object(P["b"])(n["a"])){constructor(e){super(e),this._overlays=null,this._overlayRenderTarget=null,this._hasHighlights=!1,this._rendersOccluded=!1,this._hasWater=!1,this._lighting=new N["a"],this._handles=new s["a"],this._frameTask=q["a"],this._layerRenderers=new Map,this._sortedLayerRenderersDirty=!1,this._sortedLayerRenderers=new d["a"],this._geometries=new Map,this.worldToPCSRatio=1,this.events=new a["a"],this.longitudeCyclical=null}initialize(){const e=this.view._stage.renderView;this._rctx=e.renderingContext,this._renderContext=new I["a"](this._rctx);const t=e.waterTextureRepository;this._stippleTextureRepository=new G["a"](e.renderingContext),this._shaderTechniqueRepository=new C["a"]({rctx:this._rctx,viewingMode:2,stippleTextureRepository:this._stippleTextureRepository,waterTextureRepository:t}),this._handles.add([Object(u["a"])(t,"loadingState",()=>this.events.emit("content-changed")),Object(u["a"])(this,"spatialReference",e=>this._localOrigins=new E["a"](e))]),this._materialRepository=new M["a"](e.textureRepository,this._shaderTechniqueRepository,e=>{(e.renderOccluded&te)>0!==this._rendersOccluded&&this.updateRendersOccluded(),this.events.emit("content-changed"),this.notifyChange("updating")},()=>this.events.emit("content-changed")),this._lighting.groundLightingFactor=1,this._lighting.globalFactor=0,this._lighting.set([new B["a"](Object(g["h"])(1,1,1))]),this._bindParameters={slot:20,highlightDepthTexture:Object(R["b"])(this._rctx),camera:Y,inverseViewport:Object(m["b"])(),origin:null,screenToWorldRatio:null,screenToPCSRatio:null,shadowMappingEnabled:!1,slicePlane:null,ssaoEnabled:!1,hasOccludees:!1,linearDepthTexture:null,lastFrameColorTexture:null,reprojectionMatrix:v["a"],ssrEnabled:!1,lighting:this._lighting,transparencyPassType:3,terrainLinearDepthTexture:null,geometryLinearDepthTexture:null,multipassTerrainEnabled:!1,cullAboveGround:!1,multipassGeometryEnabled:!1,highlightColorTexture:null},this._frameTask=this.view.resourceController.scheduler.registerTask(q["b"].STAGE,this),this._handles.add(this._frameTask)}dispose(){this._handles.destroy(),this._layerRenderers.forEach(e=>e.dispose()),this._layerRenderers.clear(),this._debugTextureTechnique=Object(l["s"])(this._debugTextureTechnique),this._debugPatternTexture=Object(l["f"])(this._debugPatternTexture),this._bindParameters.highlightDepthTexture=Object(l["f"])(this._bindParameters.highlightDepthTexture),this._shaderTechniqueRepository=Object(l["f"])(this._shaderTechniqueRepository),this._temporaryFBO=Object(l["f"])(this._temporaryFBO),this._quadVAO=Object(l["f"])(this._quadVAO),this.disposeOverlays()}get updating(){return this._sortedLayerRenderersDirty||this._frameTask.updating||Object(c["c"])(this._layerRenderers,e=>e.updating)}get hasOverlays(){return Object(l["l"])(this._overlays)&&Object(l["l"])(this._overlayRenderTarget)}get gpuMemoryUsage(){return Object(l["l"])(this._overlayRenderTarget)?this._overlayRenderTarget.gpuMemoryUsage:0}collectUnusedRenderTargetMemory(e){let t=!1;if(Object(l["l"])(this._overlayRenderTarget))for(const i of this._overlayRenderTarget.renderTargets){const r=this.overlays[0].validTargets[i.type]||!this.overlays[1].validTargets[i.type];t=this._overlayRenderTarget.validateUsageForTarget(r,i,e)||t}return t}get overlays(){return Object(l["v"])(this._overlays,[])}ensureDrapeTargets(e){Object(l["l"])(this._overlays)&&this._overlays.forEach(t=>{t.hasTargetWithoutRasterImage=Object(h["a"])(e,e=>1===e.drapeTargetType)})}ensureDrapeSources(e){Object(l["l"])(this._overlays)&&this._overlays.forEach(t=>{t.hasDrapedFeatureSource=Object(c["c"])(e,(e,t)=>1===t.drapeSourceType),t.hasDrapedRasterSource=Object(c["c"])(e,(e,t)=>0===t.drapeSourceType)})}ensureOverlays(e,t){Object(l["k"])(this._overlays)&&(this._overlayRenderTarget=new S(this._rctx),this._overlays=[new O["a"](0,this._overlayRenderTarget),new O["a"](1,this._overlayRenderTarget)]),this.ensureDrapeTargets(e),this.ensureDrapeSources(t)}disposeOverlays(){this._overlays=null,this._overlayRenderTarget=Object(l["f"])(this._overlayRenderTarget),this.events.emit("textures-disposed")}get running(){return this.updating}runTask(e,t=(()=>!0)){this._frameTask.processQueue(e),e.done||this._processLayers(e,t)}_processLayers(e,t){let i=!1;for(const[r,n]of this._layerRenderers){if(e.done)break;(r.destroyed||t(r))&&(n.commitChanges()&&(i=!0,e.madeProgress()),n.isEmpty&&(i=!0,this._sortedLayerRenderersDirty=!0,this._layerRenderers.delete(r),this._handles.remove(r)))}this.updateSortedLayerRenderers(),i&&(Object(l["l"])(this._overlays)&&0===this._layerRenderers.size&&this.disposeOverlays(),this.notifyChange("updating"),this.events.emit("content-changed"),this.updateHasHighlights(),this.updateRendersOccluded(),this.updateHasWater())}processSyncLayers(){this._processLayers(q["d"],e=>1===e.updatePolicy)}addGeometries(e,t,i){for(const r of e)Object(l["k"])(r.origin)&&(r.origin=this._localOrigins.getOrigin(r.boundingSphere)),this._geometries.set(r.id,r);this.ensureLayerRenderer(t).add(e),2===i&&this.notifyGraphicGeometryChanged(e,t)}removeGeometries(e,t,i){for(const n of e)this._geometries.delete(Object(l["u"])(n.id));const r=this._layerRenderers.get(t);r&&(r.remove(e),2===i&&this.notifyGraphicGeometryChanged(e,t))}updateGeometries(e,t,i){const r=this._layerRenderers.get(t);if(r)switch(r.modify(e,i),i){case 4:case 2:return this.notifyGraphicGeometryChanged(e,t);case 1:return this.notifyGraphicVisibilityChanged(e,t)}else W.warn("Attempted to update geometry for nonexistent layer")}notifyGraphicGeometryChanged(e,t){if(Object(l["k"])(t.notifyGraphicGeometryChanged))return;let i;for(const r of e){const e=r.graphicUid;Object(l["l"])(e)&&e!==i&&(t.notifyGraphicGeometryChanged(e),i=e)}}notifyGraphicVisibilityChanged(e,t){if(Object(l["k"])(t.notifyGraphicVisibilityChanged))return;let i;for(const r of e){const e=r.graphicUid;Object(l["l"])(e)&&e!==i&&(t.notifyGraphicVisibilityChanged(e),i=e)}}updateHighlights(e,t){const i=this._layerRenderers.get(t);i?i.modify(e,8):W.warn("Attempted to update highlights for nonexistent layer")}isEmpty(){return 0===this._geometries.size&&!y["a"].OVERLAY_DRAW_DEBUG_TEXTURE}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return this._rendersOccluded}updateLogic(e){let t=!1;return this._layerRenderers.forEach(i=>t=i.updateLogic(e)||t),t}updateLayerOrder(){this._sortedLayerRenderersDirty=!0}drawTarget(e,t,i){const r=e.canvasGeometries;if(0===r.numViews)return!1;this._screenToWorldRatio=i*e.mapUnitsPerPixel;const n=t.renderPass;if(this.isEmpty()||5===n&&!this.hasHighlights||3===n&&!this.hasWater||!e.hasSomeSizedView())return!1;const a=t.fbo;if(!a.isValid())return!1;const s=2*e.resolution,o=e.resolution;a.resize(s,o);const c=this._rctx;Y.pixelRatio=e.pixelRatio*i,this._renderContext.pass=n,this._bindParameters.screenToWorldRatio=this._screenToWorldRatio,this._bindParameters.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio,this._bindParameters.slot=3===n?21:20,e.applyViewport(this._rctx),a.bind(c),0===e.index&&(c.setClearColor(0,0,0,0),c.clearSafe(16384));const d=1===t.type?2:4===t.type?1:0;if(1===d&&(this._renderContext.renderOccludedMask=te),y["a"].OVERLAY_DRAW_DEBUG_TEXTURE&&1!==d)for(let l=0;l<r.numViews;l++)this.setViewParameters(r.extents[l],e,Y),this.drawDebugTexture(e.resolution,Q[e.index]);return this._layerRenderers.size>0&&this._sortedLayerRenderers.forAll(({layerView:t,renderer:i})=>{if(2===d&&Object(l["l"])(t)&&0===t.drapeSourceType)return;const h=Object(l["l"])(t)&&Object(l["l"])(t.fullOpacity)&&t.fullOpacity<1&&0===n;h&&(this.bindTemporaryFramebuffer(this._rctx,s,o),c.clearSafe(16384));for(let n=0;n<r.numViews;n++)this.setViewParameters(r.extents[n],e,Y),i.render(this._renderContext,this._bindParameters);h&&Object(l["l"])(this._temporaryFBO)&&(a.bind(c),this.view._stage.renderView.compositingHelper.composite(this._temporaryFBO.getTexture(),2,Object(l["u"])(Object(l["u"])(t).fullOpacity),3,e.index))}),c.bindFramebuffer(null),a.generateMipMap(),this._renderContext.resetRenderOccludedMask(),!0}bindTemporaryFramebuffer(e,t,i){Object(l["k"])(this._temporaryFBO)&&(this._temporaryFBO=new w(e,!1)),this._temporaryFBO.resize(t,i),this._temporaryFBO.bind(e)}async reloadShaders(){await this._shaderTechniqueRepository.reloadAll()}intersect(e,t,i,r){let n=0;this._geometries.forEach(a=>{if(r&&!r(a))return;this._intersectRenderGeometry(a,i,t,0,e,n);const s=this.longitudeCyclical;s&&(a.boundingSphere[0]-a.boundingSphere[3]<s.min&&this._intersectRenderGeometry(a,i,t,s.range,e,n),a.boundingSphere[0]+a.boundingSphere[3]>s.max&&this._intersectRenderGeometry(a,i,t,-s.range,e,n)),n++})}_intersectRenderGeometry(e,t,i,r,n,a){if(!e.instanceParameters.visible)return;let s=0;Object(l["l"])(e.transformation)&&(r+=e.transformation[12],s=e.transformation[13]),K[0]=i[0]-r,K[1]=i[1]-s,K[2]=1,J[0]=i[0]-r,J[1]=i[1]-s,J[2]=0,e.screenToWorldRatio=this._screenToWorldRatio,e.material.intersect(e,null,e.getShaderTransformation(),n,K,J,(i,r,s)=>{X(t,s,e.material.renderPriority,a,n,e.layerUid,e.graphicUid)},e.calculateShaderTransformation,t)}ensureLayerRenderer(e){let t=this._layerRenderers.get(e);return t||(t=new V({rctx:this._rctx,materialRepository:this._materialRepository}),this._layerRenderers.set(e,t),this._sortedLayerRenderersDirty=!0,"fullOpacity"in e&&this._handles.add(e.watch("fullOpacity",()=>this.events.emit("content-changed")),e),this._handles.add(Object(u["a"])(t,"updating",()=>this.notifyChange("updating")),e)),t}updateSortedLayerRenderers(){if(!this._sortedLayerRenderersDirty)return;if(this._sortedLayerRenderersDirty=!1,this._sortedLayerRenderers.clear(),0===this._layerRenderers.size)return;const e=new Set(this._layerRenderers.values());this.view.allLayerViews.forEach(t=>{const i=t,r=this._layerRenderers.get(i);r&&(this._sortedLayerRenderers.push(new Z(i,r)),e.delete(r))}),e.forEach(e=>this._sortedLayerRenderers.push(new Z(null,e)))}setViewParameters(e,t,i){i.viewport[0]=i.viewport[1]=0,i.viewport[2]=i.viewport[3]=t.resolution,Object(b["p"])(i.projectionMatrix,0,e[2]-e[0],0,e[3]-e[1],i.near,i.far),Object(b["j"])(i.viewMatrix),Object(b["b"])(i.viewMatrix,i.viewMatrix,[-e[0],-e[1],0]),this._renderContext.camera=i,this._bindParameters.camera=i,this._bindParameters.inverseViewport[0]=1/i.fullViewport[2],this._bindParameters.inverseViewport[1]=1/i.fullViewport[3]}updateHasWater(){const e=Object(c["c"])(this._layerRenderers,e=>e.hasWater);e!==this._hasWater&&(this._hasWater=e,this.events.emit("has-water",e))}updateHasHighlights(){const e=Object(c["c"])(this._layerRenderers,e=>e.hasHighlights);e!==this._hasHighlights&&(this._hasHighlights=e,this.events.emit("has-highlights",e))}updateRendersOccluded(){const e=Object(c["c"])(this._layerRenderers,e=>e.rendersOccluded);e!==this._rendersOccluded&&(this._rendersOccluded=e,this.events.emit("renders-occluded",e))}drawDebugTexture(e,t){const i=this._rctx;this.ensureDebugPatternResources(e,e);const r=this._debugTextureTechnique.program;i.useProgram(r),this._debugTextureTechnique.bindPipelineState(i),r.setUniform4f("color",t[0],t[1],t[2],1),r.bindTexture(this._debugPatternTexture,"tex"),i.bindVAO(this._quadVAO),i.drawArrays(5,0,Object(H["e"])(this._quadVAO,"geometry"))}ensureDebugPatternResources(e,t){if(this._debugPatternTexture)return;const i=new Uint8Array(e*t*4);let r=0;for(let a=0;a<t;a++)for(let n=0;n<e;n++){const s=Math.floor(n/10),o=Math.floor(a/10);s<2||o<2||10*s>e-20||10*o>t-20?(i[r++]=255,i[r++]=255,i[r++]=255,i[r++]=255):(i[r++]=255,i[r++]=255,i[r++]=255,i[r++]=1&s&&1&o?1&n^1&a?0:255:1&s^1&o?0:128)}this._debugPatternTexture=new j["a"](this._rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:e,height:t},i);const n=new U["b"];n.hasAlpha=!0,this._debugTextureTechnique=this._shaderTechniqueRepository.acquire(U["a"],n),this._quadVAO=Object(R["d"])(this._rctx)}get test(){return{layerRenderers:this._layerRenderers}}};Object(r["a"])([Object(p["b"])()],$.prototype,"_frameTask",void 0),Object(r["a"])([Object(p["b"])()],$.prototype,"_sortedLayerRenderersDirty",void 0),Object(r["a"])([Object(P["c"])()],$.prototype,"_shaderTechniqueRepository",void 0),Object(r["a"])([Object(P["c"])()],$.prototype,"_stippleTextureRepository",void 0),Object(r["a"])([Object(p["b"])({constructOnly:!0})],$.prototype,"view",void 0),Object(r["a"])([Object(p["b"])()],$.prototype,"worldToPCSRatio",void 0),Object(r["a"])([Object(p["b"])()],$.prototype,"spatialReference",void 0),Object(r["a"])([Object(p["b"])({type:Boolean,readOnly:!0})],$.prototype,"updating",null),$=Object(r["a"])([Object(f["a"])("esri.views.3d.terrain.OverlayRenderer")],$);class Z{constructor(e,t){this.layerView=e,this.renderer=t}}const Q=[[1,.5,.5],[.5,.5,1]];function X(e,t,i,r,n,a,s){const o={layerUid:a,graphicUid:s,triangleNr:t},c=t=>{t.set(3,o,e.dist,e.normal,e.transformation,i,r)};if((null==n.results.min.drapedLayerOrder||i>=n.results.min.drapedLayerOrder)&&(null==n.results.min.dist||n.results.ground.dist<=n.results.min.dist)&&c(n.results.min),0!==n.options.store&&(null==n.results.max.drapedLayerOrder||i<n.results.max.drapedLayerOrder)&&(null==n.results.max.dist||n.results.ground.dist>n.results.max.dist)&&c(n.results.max),2===n.options.store){const e=Object(D["c"])(n.ray);c(e),n.results.all.push(e)}}const Y=new A["a"];Y.near=1,Y.far=1e4,Y.relativeElevation=null;const K=Object(g["f"])(),J=Object(g["f"])(),ee=-2,te=4},7697:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i("3886");function n(e){e.fragment.uniforms.add("u_transformGrid","sampler2D"),e.fragment.uniforms.add("u_transformSpacing","vec2"),e.fragment.uniforms.add("u_transformGridSize","vec2"),e.fragment.uniforms.add("u_targetImageSize","vec2"),e.fragment.code.add(r["a"]`vec2 projectPixelLocation(vec2 coords) {
vec2 index_image = floor(coords * u_targetImageSize);
vec2 oneTransformPixel = vec2(0.25 / u_transformGridSize.s, 1.0 / u_transformGridSize.t);
vec2 index_transform = floor(index_image / u_transformSpacing) / u_transformGridSize;
vec2 pos = fract((index_image + vec2(0.5, 0.5)) / u_transformSpacing);
vec2 srcLocation;
vec2 transform_location = index_transform + oneTransformPixel * 0.5;
if (pos.s <= pos.t) {
vec4 ll_abc = texture2D(u_transformGrid, vec2(transform_location.s, transform_location.t));
vec4 ll_def = texture2D(u_transformGrid, vec2(transform_location.s + oneTransformPixel.s, transform_location.t));
srcLocation.s = dot(ll_abc.rgb, vec3(pos, 1.0));
srcLocation.t = dot(ll_def.rgb, vec3(pos, 1.0));
} else {
vec4 ur_abc = texture2D(u_transformGrid, vec2(transform_location.s + 2.0 * oneTransformPixel.s, transform_location.t));
vec4 ur_def = texture2D(u_transformGrid, vec2(transform_location.s + 3.0 * oneTransformPixel.s, transform_location.t));
srcLocation.s = dot(ur_abc.rgb, vec3(pos, 1.0));
srcLocation.t = dot(ur_def.rgb, vec3(pos, 1.0));
}
return srcLocation;;
}`)}function a(e){e.include(n),e.fragment.uniforms.add("u_image","sampler2D"),e.fragment.uniforms.add("u_isFloatTexture","bool"),e.fragment.uniforms.add("u_flipY","bool"),e.fragment.uniforms.add("u_applyTransform","bool"),e.fragment.uniforms.add("u_opacity","float"),e.fragment.code.add(r["a"]`vec2 getPixelLocation(vec2 coords) {
vec2 targetLocation = u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;
if (!u_applyTransform) {
return targetLocation;
}
return projectPixelLocation(targetLocation);
}
bool isOutside(vec2 coords){
if (coords.t>1.00001 ||coords.t<-0.00001 || coords.s>1.00001 ||coords.s<-0.00001) {
return true;
} else {
return false;
}
}
vec4 getPixel(vec2 pixelLocation) {
return texture2D(u_image, pixelLocation);
}`)}},"76ac":function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return s}));var r=i("4db9"),n=i("3886"),a=i("690a");function s(e){const t=new a["a"];if(2===e.geometry)t.attributes.add("position","vec2"),t.varyings.add("color","vec4"),t.vertex.uniforms.add("lightingMainDirection","vec3").add("cameraPosition","vec3").add("undergroundFadeAlpha","float"),t.vertex.code.add(n["a"]`void main(void) {
float ndotl = dot(normalize(cameraPosition), lightingMainDirection);
float lighting = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));
color = vec4(vec3(lighting), undergroundFadeAlpha);
gl_Position = vec4(position.xy, 1.0, 1.0);
}`),t.fragment.code.add(n["a"]`void main() {
gl_FragColor = color;
}`);else{t.include(r["a"],{linearDepth:!1}),t.attributes.add("position","vec3"),t.varyings.add("vtc","vec2"),t.varyings.add("falloff","float");const i=1===e.geometry;t.vertex.uniforms.add("proj","mat4").add("view","mat4").add("lightingMainDirection","vec3"),i||(t.varyings.add("innerFactor","float"),t.vertex.uniforms.add("silCircleCenter","vec3").add("silCircleV1","vec3").add("silCircleV2","vec3").add("texV","vec2").add("innerScale","float"));const a=6.2831853,s=1/128;t.vertex.code.add(n["a"]`
		void main(void) {
      ${i?n["a"]`
      vec3 pos = position;
      float ndotl = lightingMainDirection.z;
      vtc = vec2(0.0, position.z + 0.05);`:n["a"]`
      innerFactor = clamp(-position.z, 0.0, 1.0);
      float scale = position.y * (1.0 + innerFactor * innerScale);
      float phi = position.x * ${n["a"].float(a*s)} + 1.0;
      vec3 pos =  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;
      float ndotl = dot(normalize(position.y > 0.0 ? pos: silCircleCenter), lightingMainDirection);
      vtc.x = position.x  * ${n["a"].float(s)};
      vtc.y = texV.x * (1.0 - position.z) + texV.y * position.z;
      `}
      falloff = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));

		  gl_Position = transformPosition(proj, view, pos);
		  gl_Position.z = gl_Position.w; // project atmosphere onto the far plane
    }
	  `),t.fragment.uniforms.add("tex","sampler2D"),i||t.fragment.uniforms.add("altitudeFade","float"),t.fragment.code.add(n["a"]`
		void main() {
			vec4 atmosphereColor = texture2D(tex, vtc) * falloff;
      ${i?n["a"]`gl_FragColor = atmosphereColor;`:n["a"]`
			vec4 innerColor = vec4(atmosphereColor.rgb, 1.0 - altitudeFade);
			gl_FragColor = mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));
      `}
    }`)}return t}const o=Object.freeze({__proto__:null,build:s})},7752:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("fc00");function n(e){const t=Object(r["a"])().vec3f("position");return e.normals&&t.vec2i16("normalCompressed",{glNormalized:!0}),1===e.textureCoordinates?t.vec2f("uv0"):2===e.textureCoordinates&&(t.vec2f("uv0"),t.vec4u16("uvRegion",{glNormalized:!0})),e.colors&&t.vec4u8("color",{glNormalized:!0}),t.alignTo(4)}},"78ba":function(e,t,i){"use strict";i.d(t,"a",(function(){return d}));var r=i("b50f"),n=i("c649"),a=i("e92d"),s=i("b2b2"),o=i("f4cc"),c=i("dfa0");const l=a["a"].getLogger("esri.core.workers.WorkerHandle");class d{constructor(e,t,i,r={}){this._mainMethod=t,this._listeners=[],this._promise=Object(c["b"])(e,{...r,schedule:i}).then(e=>{if(void 0===this._thread){this._thread=e,this._promise=null,r.hasInitialize&&this.broadcast({},"initialize");for(const e of this._listeners)this._connectListener(e)}else e.close()}),this._promise.catch(t=>l.error(`Failed to initialize ${e} worker: ${t}`))}on(e,t){const i={removed:!1,eventName:e,callback:t,threadHandle:null};return this._listeners.push(i),this._connectListener(i),Object(n["c"])(()=>{i.removed=!0,Object(r["j"])(this._listeners,i),this._thread&&Object(s["l"])(i.threadHandle)&&i.threadHandle.remove()})}destroy(){this._thread&&(this._thread.close(),this._thread=null),this._promise=null}invoke(e,t){return this.invokeMethod(this._mainMethod,e,t)}invokeMethod(e,t,i){if(this._thread){const r=this.getTransferList(t,e);return this._thread.invoke(e,t,{transferList:r,signal:i})}return this._promise?this._promise.then(()=>(Object(o["w"])(i),this.invokeMethod(e,t,i))):Promise.reject(null)}broadcast(e,t){return this._thread?Promise.all(this._thread.broadcast(t,e)).then(()=>{}):this._promise?this._promise.then(()=>this.broadcast(e,t)):Promise.reject()}get promise(){return this._promise}_connectListener(e){this._thread&&this._thread.on(e.eventName,e.callback).then(t=>{e.removed||(e.threadHandle=t)})}}},"7a18":function(e,t,i){"use strict";function r(e){return e&&"base-tile"===e.type||"tile"===e.type||"elevation"===e.type||"imagery-tile"===e.type||"base-elevation"===e.type||"open-street-map"===e.type||"wcs"===e.type||"web-tile"===e.type||"wmts"===e.type||"vector-tile"===e.type}function n(e){return e.parent&&"esri.Basemap"===e.parent.declaredClass&&e.parent.baseLayers.indexOf(e)>-1}function a(e){return!0===e.labelsVisible&&null!=e.labelingInfo&&e.labelingInfo.length>0}i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return n})),i.d(t,"c",(function(){return r}))},"7a91":function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return n}));var r=i("a978");function n(e){return Object(r["c"])(e)&&2===e.intersector&&!!e.target}function a(e){return Object(r["c"])(e)&&3===e.intersector&&!!e.target}},"7abc":function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i("0b2d");class n{constructor(e,t){this.vec3=e,this.id=t}}function a(e,t,i,a){return new n(Object(r["h"])(e,t,i),a)}},"7aed":function(e,t,i){"use strict";i.d(t,"a",(function(){return h})),i.d(t,"b",(function(){return u}));var r=i("a4ee"),n=i("3e44"),a=i("c3a4"),s=i("ca98"),o=i("da35"),c=i("fa1e"),l=i("c829"),d=i("189c");class h extends s["a"]{initializeProgram(e){const t=h.shader.get().build();return new l["a"](e.rctx,t,c["a"])}initializePipeline(){return this.configuration.hasAlpha?Object(d["g"])({blending:Object(d["h"])(770,1,771,771),colorWrite:d["d"]}):Object(d["g"])({colorWrite:d["d"]})}}h.shader=new a["a"](n["a"],()=>i.e("chunk-2d0b3143").then(i.bind(null,"279a")));class u extends o["a"]{constructor(){super(...arguments),this.hasAlpha=!1}}Object(r["a"])([Object(o["b"])()],u.prototype,"hasAlpha",void 0)},"7b96":function(e,t,i){"use strict";i.d(t,"a",(function(){return d}));var r=i("b2b2"),n=i("e431"),a=i("0b2d"),s=i("4261"),o=i("f895"),c=i("e9d6"),l=i("ba58");class d{constructor(e,t,i,r,n,a,s,o=null){this.graphics3DSymbolLayer=e,this.stageObject=t,this._uniqueGeometries=i,this._uniqueMaterials=r,this._uniqueTextures=n,this.elevationAligner=a,this.elevationContext=s,this._edgeState=o,this.type="object3d",this._stageLayer=null,this._stage=null,this._visible=!1,this._addedToStage=!1,this.alignedSampledElevation=0,this.needsElevationUpdates=!1,this.useObjectOriginAsAttachmentOrigin=!1,this.graphics3DSymbolLayer=e,this.stageObject=t}get isElevationSource(){return!(!this.stageObject.metadata||!this.stageObject.metadata.isElevationSource)}initialize(e,t){this._stageLayer=t,this._stage=e,e.addMany(this._uniqueMaterials),e.addMany(this._uniqueGeometries),e.addMany(this._uniqueTextures),e.load(this._uniqueTextures),e.add(this.stageObject)}destroy(){const e=this._stage;this._stageLayer&&(e.removeMany(this._uniqueMaterials),e.removeMany(this._uniqueGeometries),e.removeMany(this._uniqueTextures)),e.remove(this.stageObject),this._addedToStage&&(this._stageLayer.remove(this.stageObject),this._addedToStage=!1);const t=this._stage.renderView.ensureEdgeView();t.hasObject(this.stageObject)&&t.removeObject(this.stageObject),this.stageObject.dispose(),this._visible=!1,this._stageLayer=null,this._stage=null}layerOpacityChanged(e,t){if(Object(r["k"])(this._edgeState))return;const i=h(this._edgeState.baseMaterial);let n=!1;for(const r of this._edgeState.edgeMaterials)r.objectTransparency!==i&&(r.objectTransparency=i,n=!0);n&&this.resetEdgeObject(t),this._stage.renderView.ensureEdgeView().updateAllComponentOpacities(this.stageObject,[e])}slicePlaneEnabledChanged(e,t){Object(r["k"])(this._edgeState)||(this._stage.renderView.ensureEdgeView().updateAllComponentMaterials(this.stageObject,this._edgeState.edgeMaterials,{slicePlaneEnabled:e},!t),this._edgeState.properties.slicePlaneEnabled=e)}setVisibility(e){if(null!=this._stage&&this._visible!==e&&(this._visible=e,this._visible?this._addedToStage?this.stageObject.setVisible(!0):(this._stageLayer.add(this.stageObject),this._addedToStage=!0):this.stageObject.setVisible(!1),Object(r["l"])(this._edgeState))){const t=this._stage.renderView.ensureEdgeView();t.hasObject(this.stageObject)?t.updateObjectVisibility(this.stageObject,e):e&&this.addOrUpdateEdgeObject(t,!1)}}get visible(){return this._visible}alignWithElevation(e,t,i,n){null!=this.elevationAligner&&(Object(r["l"])(i)&&Object(c["g"])(this.elevationContext.featureExpressionInfoContext,i),this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,e,t),this.resetEdgeObject(n))}getCenterObjectSpace(e=Object(a["f"])()){return Object(n["n"])(e,Object(o["g"])(this.stageObject.boundingVolumeObjectSpace.bounds))}getBoundingBoxObjectSpace(e=Object(s["h"])()){const t=this.stageObject.boundingVolumeObjectSpace;return Object(s["E"])(e,t.min),Object(s["D"])(e,t.max),e}computeAttachmentOrigin(e){if(this.useObjectOriginAsAttachmentOrigin){const t=this.stageObject.transformation;e.render.origin[0]+=t[12],e.render.origin[1]+=t[13],e.render.origin[2]+=t[14],e.render.num++}else for(const t of this.stageObject.geometryRecords)t.computeAttachmentOrigin(f)&&(Object(n["t"])(f,f,this.stageObject.transformation),Object(n["i"])(e.render.origin,e.render.origin,f),e.render.num++)}async getProjectedBoundingBox(e,t,i,a,o){const c=this.getBoundingBoxObjectSpace(o),d=b,h=Object(s["y"])(c)?1:d.length;for(let r=0;r<h;r++){const e=d[r];p[0]=c[e[0]],p[1]=c[e[1]],p[2]=c[e[2]],Object(n["t"])(p,p,this.stageObject.transformation),u[3*r+0]=p[0],u[3*r+1]=p[1],u[3*r+2]=p[2]}if(!e(u,0,h))return null;Object(s["k"])(c);let m=null;this.calculateRelativeScreenBounds&&(m=this.calculateRelativeScreenBounds());for(let r=0;r<3*h;r+=3){for(let e=0;e<3;e++)c[e]=Math.min(c[e],u[r+e]),c[e+3]=Math.max(c[e+3],u[r+e]);m&&i.push({location:u.slice(r,r+3),screenSpaceBoundingRect:m})}if(t&&t.service&&"absolute-height"!==this.elevationContext.mode){Object(s["e"])(c,f);const e="relative-to-scene"===this.elevationContext.mode?"scene":"ground";let i=0;if(t.useViewElevation)i=Object(r["v"])(t.service.getElevation(f[0],f[1],e),0);else try{const n=Object(l["d"])(c,t);i=Object(r["v"])(await t.service.queryElevation(f[0],f[1],a,n,e),0)}catch(g){}Object(s["A"])(c,0,0,-this.alignedSampledElevation+i)}return c}addObjectState(e,t){0===e&&t.addObject(this.stageObject,this.stageObject.highlight()),1===e&&t.addObject(this.stageObject,this.stageObject.maskOccludee())}removeObjectState(e){e.removeObject(this.stageObject)}resetEdgeObject(e){if(Object(r["k"])(this._edgeState))return;const t=this._stage.renderView.ensureEdgeView();this._visible?this.addOrUpdateEdgeObject(t,e):t.removeObject(this.stageObject)}addOrUpdateEdgeObject(e,t){const i=this._edgeState;if(Object(r["k"])(i))return;const n=h(i.baseMaterial);for(const r of i.edgeMaterials)r.objectTransparency=n;e.addOrUpdateObject3D(this.stageObject,i.edgeMaterials,i.properties,!t).then(()=>{var e;return null==(e=this._stageLayer)?void 0:e.sync()})}}function h(e){return e.isVisible?e.parameters.transparent?1:2:0}const u=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],p=Object(a["f"])(),f=Object(a["f"])(),b=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]]},"7c1d":function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("3886");function n(e){const t=r["a"]`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`,i=r["a"]`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`;e.vertex.code.add(t),e.vertex.code.add(i),e.fragment.code.add(t),e.fragment.code.add(i)}},"7c33":function(e,t,i){"use strict";i.d(t,"a",(function(){return r})),i.d(t,"b",(function(){return n}));const r=[{name:"position",count:2,type:5126,offset:0,stride:8,normalized:!1}],n=[{name:"position",count:2,type:5126,offset:0,stride:16,normalized:!1},{name:"uv0",count:2,type:5126,offset:8,stride:16,normalized:!1}]},"7c4b":function(e,t,i){"use strict";i.d(t,"a",(function(){return c}));var r=i("ce6d"),n=i("c120"),a=i("b2b2"),s=i("f4cc");const o=1/Object(n["a"])("mapview-transitions-duration");class c extends r["a"]{constructor(){super(...arguments),this._fadeOutResolver=null,this._fadeInResolver=null,this._clips=null,this.computedVisible=!0,this.computedOpacity=1,this.fadeTransitionEnabled=!1,this.inFadeTransition=!1,this._isReady=!1,this._opacity=1,this._stage=null,this._visible=!0}get clips(){return this._clips}set clips(e){this._clips=e,this.requestRender()}get isReady(){return this._isReady}get opacity(){return this._opacity}set opacity(e){this._opacity!==e&&(this._opacity=Math.min(1,Math.max(e,0)),this.requestRender())}get stage(){return this._stage}set stage(e){if(this._stage===e)return;const t=this._stage;this._stage=e,e?this._stage.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):t.trashDisplayObject(this)}get transforms(){return this._getTransforms()}_getTransforms(){return Object(a["k"])(this._transforms)&&(this._transforms=this._createTransforms()),this._transforms}get visible(){return this._visible}set visible(e){this._visible!==e&&(this._visible=e,this.requestRender())}fadeIn(){return this._fadeInResolver||(this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.computedOpacity=0,this.fadeTransitionEnabled=!0,this._fadeInResolver=Object(s["g"])(),this.requestRender()),this._fadeInResolver.promise}fadeOut(){return this._fadeOutResolver||(this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this.fadeTransitionEnabled=!0,this._fadeOutResolver=Object(s["g"])(),this.requestRender()),this._fadeOutResolver.promise}beforeRender(e){this.updateTransitionProperties(e.deltaTime,e.state.scale)}afterRender(e){this._fadeInResolver&&this.computedOpacity===this.opacity?(this._fadeInResolver(),this._fadeInResolver=null):this._fadeOutResolver&&0===this.computedOpacity&&(this._fadeOutResolver(),this._fadeOutResolver=null)}remove(){var e;null==(e=this.parent)||e.removeChild(this)}setTransform(e){}processRender(e){this.stage&&this.computedVisible&&this.doRender(e)}requestRender(){this.stage&&this.stage.requestRender()}processDetach(){this.onDetach(),this.emit("detach")}updateTransitionProperties(e,t){if(this.fadeTransitionEnabled){const t=this._fadeOutResolver||!this.visible?0:this.opacity,i=this.computedOpacity;if(i===t)this.computedVisible=this.visible;else{const r=e*o;this.computedOpacity=i>t?Math.max(t,i-r):Math.min(t,i+r),this.computedVisible=this.computedOpacity>0;const n=t===this.computedOpacity;this.inFadeTransition=!n,n||this.requestRender()}}else this.computedOpacity=this.opacity,this.computedVisible=this.visible}onAttach(){}onDetach(){}doRender(e){}ready(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())}}},"7c51":function(e,t,i){"use strict";i.d(t,"a",(function(){return S})),i.d(t,"b",(function(){return M})),i.d(t,"c",(function(){return _})),i.d(t,"d",(function(){return O})),i.d(t,"e",(function(){return T})),i.d(t,"f",(function(){return x})),i.d(t,"g",(function(){return j})),i.d(t,"h",(function(){return P})),i.d(t,"i",(function(){return u})),i.d(t,"j",(function(){return m})),i.d(t,"k",(function(){return C})),i.d(t,"l",(function(){return w}));var r=i("38a4"),n=i("b2b2"),a=i("e431"),s=i("0b2d"),o=i("4261"),c=i("da1c"),l=i("1153"),d=i("b623");const h=Object(o["h"])();function u(e,t,i,r,n,a,s){if(!Object(d["d"])(t))if(e.boundingInfo){Object(l["a"])(0===e.primitiveType);const t=i.tolerance;f(e.boundingInfo,r,n,t,a,s)}else{const t=e.indices.get("position"),i=e.vertexAttributes.get("position");m(r,n,0,t.length/3,t,i,void 0,a,s)}}const p=Object(s["f"])();function f(e,t,i,r,a,s){if(Object(n["k"])(e))return;const c=_(t,i,p);if(Object(o["E"])(h,e.getBBMin()),Object(o["D"])(h,e.getBBMax()),Object(n["l"])(a)&&a.applyToAabb(h),x(h,t,c,r)){const{primitiveIndices:n,indices:o,position:c}=e,l=n?n.length:o.length/3;if(l>R){const n=e.getChildren();if(void 0!==n){for(let e=0;e<8;++e)void 0!==n[e]&&f(n[e],t,i,r,a,s);return}}m(t,i,0,l,o,c,n,a,s)}}const b=Object(s["f"])();function m(e,t,i,r,a,s,o,c,l){if(o)return g(e,t,i,r,a,s,o,c,l);const d=s.data,h=s.stride||s.size,u=e[0],p=e[1],f=e[2],m=t[0]-u,v=t[1]-p,y=t[2]-f;for(let g=i,_=3*i;g<r;++g){let e=h*a[_++],t=d[e++],i=d[e++],r=d[e];e=h*a[_++];let s=d[e++],o=d[e++],x=d[e];e=h*a[_++];let j=d[e++],w=d[e++],S=d[e];Object(n["l"])(c)&&([t,i,r]=c.applyToVertex(t,i,r,g),[s,o,x]=c.applyToVertex(s,o,x,g),[j,w,S]=c.applyToVertex(j,w,S,g));const T=s-t,C=o-i,P=x-r,A=j-t,M=w-i,R=S-r,E=v*R-M*y,D=y*A-R*m,I=m*M-A*v,F=T*E+C*D+P*I;if(Math.abs(F)<=Number.EPSILON)continue;const z=u-t,L=p-i,V=f-r,k=z*E+L*D+V*I;if(F>0){if(k<0||k>F)continue}else if(k>0||k<F)continue;const U=L*P-C*V,B=V*T-P*z,N=z*C-T*L,G=m*U+v*B+y*N;if(F>0){if(G<0||k+G>F)continue}else if(G>0||k+G<F)continue;const q=(A*U+M*B+R*N)/F;q>=0&&l(q,O(T,C,P,A,M,R,b),g,!1)}}function g(e,t,i,r,a,s,o,c,l){const d=s.data,h=s.stride||s.size,u=e[0],p=e[1],f=e[2],m=t[0]-u,g=t[1]-p,v=t[2]-f;for(let y=i;y<r;++y){const e=o[y];let t=3*e,i=h*a[t++],r=d[i++],s=d[i++],_=d[i];i=h*a[t++];let x=d[i++],j=d[i++],w=d[i];i=h*a[t];let S=d[i++],T=d[i++],C=d[i];Object(n["l"])(c)&&([r,s,_]=c.applyToVertex(r,s,_,y),[x,j,w]=c.applyToVertex(x,j,w,y),[S,T,C]=c.applyToVertex(S,T,C,y));const P=x-r,A=j-s,M=w-_,R=S-r,E=T-s,D=C-_,I=g*D-E*v,F=v*R-D*m,z=m*E-R*g,L=P*I+A*F+M*z;if(Math.abs(L)<=Number.EPSILON)continue;const V=u-r,k=p-s,U=f-_,B=V*I+k*F+U*z;if(L>0){if(B<0||B>L)continue}else if(B>0||B<L)continue;const N=k*M-A*U,G=U*P-M*V,q=V*A-P*k,H=m*N+g*G+v*q;if(L>0){if(H<0||B+H>L)continue}else if(H>0||B+H<L)continue;const W=(R*N+E*G+D*q)/L;W>=0&&l(W,O(P,A,M,R,E,D,b),e,!1)}}const v=Object(s["f"])(),y=Object(s["f"])();function O(e,t,i,r,n,s,o){return Object(a["z"])(v,e,t,i),Object(a["z"])(y,r,n,s),Object(a["j"])(o,v,y),Object(a["u"])(o,o),o}function _(e,t,i){return Object(a["z"])(i,1/(t[0]-e[0]),1/(t[1]-e[1]),1/(t[2]-e[2]))}function x(e,t,i,r){return j(e,t,i,r,1/0)}function j(e,t,i,r,n){const a=(e[0]-r-t[0])*i[0],s=(e[3]+r-t[0])*i[0];let o=Math.min(a,s),c=Math.max(a,s);const l=(e[1]-r-t[1])*i[1],d=(e[4]+r-t[1])*i[1];if(c=Math.min(c,Math.max(l,d)),c<0)return!1;if(o=Math.max(o,Math.min(l,d)),o>c)return!1;const h=(e[2]-r-t[2])*i[2],u=(e[5]+r-t[2])*i[2];return c=Math.min(c,Math.max(h,u)),!(c<0)&&(o=Math.max(o,Math.min(h,u)),!(o>c)&&o<n)}function w(e,t,i,n,a){let s=(i.screenLength||0)*e.pixelRatio;a&&(s=Object(c["f"])(s,n,t,a));const o=s*Math.tan(.5*e.fovY)/(.5*e.fullHeight);return Object(r["f"])(o*t,i.minWorldLength||0,null!=i.maxWorldLength?i.maxWorldLength:1/0)}function S(e,t,i){if(!e)return;const r=e.parameters,n=e.paddingPixelsOverride;t.setUniform4f(i,r.divisor,r.offset,r.minPixelSize,n)}function T(e,t){const i=t?T(t):{};for(const r in e){let t=e[r];t&&t.forEach&&(t=A(t)),null==t&&r in i||(i[r]=t)}return i}function C(e,t){let i=!1;for(const r in t){const n=t[r];void 0!==n&&(i=!0,Array.isArray(n)?e[r]=n.slice():e[r]=n)}return i}function P(e,t,i,n,a,s){if(!t.options.selectionMode)return;const o=e.vertexAttributes.get("position").data,c=e.vertexAttributes.get("size"),l=c&&c.data[0],d=n[0],h=n[1],u=((l+a)/2+4)*e.screenToWorldRatio;let p=Number.MAX_VALUE,f=0;for(let b=0;b<o.length-5;b+=3){const e=o[b],t=o[b+1],i=d-e,n=h-t,a=o[b+3]-e,s=o[b+4]-t,c=Object(r["f"])((a*i+s*n)/(a*a+s*s),0,1),l=a*c-i,u=s*c-n,m=l*l+u*u;m<p&&(p=m,f=b/3)}p<u*u&&s(i.dist,i.normal,f,!1)}function A(e){const t=[];return e.forEach(e=>t.push(e)),t}const M={multiply:1,ignore:2,replace:3,tint:4},R=1e3},"7c5a":function(e,t,i){"use strict";i.r(t);var r=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"wrap"},[i("div",{ref:"dom",staticClass:"container"})])},n=[],a=i("1da1"),s=(i("96cf"),i("d81d"),i("d3b7"),i("159b"),i("b0c0"),i("99af"),i("bc3a")),o=i.n(s),c=i("5996"),l=(i("2650"),i("53f8"),i("5bd5")),d=(i("c246"),i("6d1b")),h=i("a4ee"),u=i("2603"),p=(i("e06a"),i("8d60")),f=i("8d667"),b=i("cb72"),m=i("2c4f"),g=i("cf9c"),v=i("ce50"),y=i("9d83"),O=i("c649"),_=i("c120"),x=i("fa2a"),j=i("e92d"),w=i("b2b2"),S=i("f4cc"),T=i("5815"),C=i("3795"),P=i("dfa0"),A=i("a915"),M=i("59b2"),R=i("b50f"),E=i("1a3e"),D=i("d386"),I=i("cea0"),F=i("0b2d"),z=i("e64d"),L=i("8188"),V=i("9180"),k=i("0d9f"),U=i("36cf"),B=i("49a0"),N=i("bdba"),G=i("7a18"),q=i("05a9"),H=i("7aa6"),W=i("fc29"),$=i("af40"),Z=i("ce6d"),Q=i("2172"),X=i("9786"),Y=i("851f"),K=i("0cb9"),J=i("2ec5");const ee=j["a"].getLogger("esri.views.support.GroundViewElevationSampler");let te=class extends Z["a"].EventedAccessor{constructor(e){super(e),this.demResolution={min:-1,max:-1},this.noDataValue=J["b"]}initialize(){this.view.basemapTerrain.on("elevation-change",()=>this.emit("changed",{}))}get extent(){const e=this.view.basemapTerrain;return Object(w["l"])(e.extent)&&e.spatialReference?Object(V["B"])(e.extent,e.spatialReference):null}elevationAt(e){const t=e.spatialReference,i=this.spatialReference;if(!Object(X["a"])(t,i)){const e=t?t.wkid:"unknown";return ee.error(`Cannot sample elevation at a location with spatial reference (${e}) different from the view (${i.wkid})`),null}if(Object(w["k"])(this.extent)||!Object(Q["e"])(this.extent,e)){const t=Object(w["l"])(this.extent)?`${this.extent.xmin}, ${this.extent.ymin}, ${this.extent.xmax}, ${this.extent.ymax}`:null;return ee.warn("#elevationAt()",`Point used to sample elevation (${e.x}, ${e.y}) is outside of the sampler extent (${t})`),this.noDataValue}return Object(K["b"])(this.view.elevationProvider,e)}queryElevation(e){return Object(Y["b"])(e.clone(),this)}};Object(h["a"])([Object(M["b"])({readOnly:!0})],te.prototype,"demResolution",void 0),Object(h["a"])([Object(M["b"])({readOnly:!0})],te.prototype,"extent",null),Object(h["a"])([Object(M["b"])({readOnly:!0})],te.prototype,"noDataValue",void 0),Object(h["a"])([Object(M["b"])({readOnly:!0,aliasOf:"view.basemapTerrain.spatialReference"})],te.prototype,"spatialReference",void 0),Object(h["a"])([Object(M["b"])({constructOnly:!0})],te.prototype,"view",void 0),te=Object(h["a"])([Object(D["a"])("esri.views.support.GroundViewElevationSampler")],te);const ie=te;let re=class extends W["a"]{constructor(e){super(e),this.handles=new $["a"],this.view=null,this.layerViews=new m["a"]}initialize(){this.handles.add(Object(C["f"])(this,"view.map.ground",e=>e.load())),this.handles.add(this.layerViews.on("after-changes",()=>this.layerViewsAfterChangesHandler()))}destroy(){this._set("view",null),this.handles&&(this.handles.destroy(),this.handles=null)}get elevationSampler(){return this.view?"2d"===this.view.type?null:this.view.ready&&this.view.basemapTerrain&&this.view.basemapTerrain.ready?new ie({view:this.view}):null:null}get updating(){return!this.suspended&&this.layerViews.some(e=>e.updating)}get suspended(){return!this.view||this.view.suspended}layerViewsAfterChangesHandler(){this.handles.remove("updating"),this.handles.add(this.layerViews.map(e=>e.watch("updating",()=>this.updateUpdating(),!0)).toArray(),"updating"),this.updateUpdating()}updateUpdating(){this.notifyChange("updating")}};Object(h["a"])([Object(M["b"])({readOnly:!0})],re.prototype,"elevationSampler",null),Object(h["a"])([Object(M["b"])({type:Boolean,readOnly:!0})],re.prototype,"updating",null),Object(h["a"])([Object(M["b"])({constructOnly:!0})],re.prototype,"view",void 0),Object(h["a"])([Object(M["b"])({type:m["a"],readOnly:!0})],re.prototype,"layerViews",void 0),Object(h["a"])([Object(M["b"])({readOnly:!0})],re.prototype,"suspended",null),re=Object(h["a"])([Object(D["a"])("esri.views.GroundView")],re);const ne=re;var ae=i("de65"),se=i("535f"),oe=i("f61d"),ce=i("3c9c");const le=()=>i.e("chunk-ef5111d8").then(i.bind(null,"cbe4")),de=()=>Promise.resolve().then(i.bind(null,"1dc3")),he={analysis:()=>i.e("chunk-2d217289").then(i.bind(null,"c611")),"base-dynamic":()=>i.e("chunk-ec210914").then(i.bind(null,"7af4")),"base-elevation":de,"base-tile":le,"bing-maps":le,"building-scene":()=>Promise.all([i.e("chunk-2d0d03a7"),i.e("chunk-d96c05b6"),i.e("chunk-66a552f7"),i.e("chunk-661ea457"),i.e("chunk-12a50892")]).then(i.bind(null,"246f")),csv:()=>Promise.all([i.e("chunk-2d0d03a7"),i.e("chunk-d96c05b6"),i.e("chunk-66a552f7"),i.e("chunk-49a84e06"),i.e("chunk-3c71817d")]).then(i.bind(null,"88bb")),elevation:de,feature:()=>Promise.all([i.e("chunk-2d0d03a7"),i.e("chunk-d96c05b6"),i.e("chunk-66a552f7"),i.e("chunk-49a84e06"),i.e("chunk-7ee7d450")]).then(i.bind(null,"6e37")),geojson:()=>Promise.all([i.e("chunk-2d0d03a7"),i.e("chunk-d96c05b6"),i.e("chunk-66a552f7"),i.e("chunk-49a84e06"),i.e("chunk-7f25bec9")]).then(i.bind(null,"66a7")),graphics:()=>Promise.all([i.e("chunk-66a552f7"),i.e("chunk-72218984")]).then(i.bind(null,"bb49")),group:()=>i.e("chunk-2d0cc20b").then(i.bind(null,"4d38")),imagery:()=>i.e("chunk-cf9611a8").then(i.bind(null,"3a8b")),"integrated-mesh":()=>Promise.all([i.e("chunk-66a552f7"),i.e("chunk-661ea457"),i.e("chunk-7829e32e")]).then(i.bind(null,"f05f")),"map-image":()=>i.e("chunk-665281f1").then(i.bind(null,"997a")),"ogc-feature":()=>Promise.all([i.e("chunk-2d0d03a7"),i.e("chunk-d96c05b6"),i.e("chunk-66a552f7"),i.e("chunk-49a84e06"),i.e("chunk-69283d26")]).then(i.bind(null,"52c0")),"open-street-map":le,"point-cloud":()=>Promise.all([i.e("chunk-33bd1f4e"),i.e("chunk-6c7a01e0")]).then(i.bind(null,"9056")),voxel:()=>i.e("chunk-2d0d640c").then(i.bind(null,"7283")),scene:e=>null==e.profile||"mesh-pyramids"===e.profile?Promise.all([i.e("chunk-2d0d03a7"),i.e("chunk-d96c05b6"),i.e("chunk-66a552f7"),i.e("chunk-661ea457"),i.e("chunk-239c5cee")]).then(i.bind(null,"1e7c")):Promise.all([i.e("chunk-2d0d03a7"),i.e("chunk-d96c05b6"),i.e("chunk-66a552f7"),i.e("chunk-661ea457"),i.e("chunk-12a0a3a0")]).then(i.bind(null,"c572")),stream:()=>Promise.all([i.e("chunk-2d0d03a7"),i.e("chunk-d96c05b6"),i.e("chunk-66a552f7"),i.e("chunk-49a84e06"),i.e("chunk-7e3033f8")]).then(i.bind(null,"a7bf")),tile:le,"imagery-tile":()=>i.e("chunk-dd19b3a0").then(i.bind(null,"1793")),"vector-tile":()=>Promise.all([i.e("chunk-5bee4ec9"),i.e("chunk-205026ce"),i.e("chunk-2d57d7a8"),i.e("chunk-7c09911c")]).then(i.bind(null,"ce88")),wcs:()=>i.e("chunk-dd19b3a0").then(i.bind(null,"1793")),"web-tile":le,wfs:()=>Promise.all([i.e("chunk-2d0d03a7"),i.e("chunk-d96c05b6"),i.e("chunk-66a552f7"),i.e("chunk-49a84e06"),i.e("chunk-1529a847")]).then(i.bind(null,"9de2")),wms:()=>i.e("chunk-0e83f8cb").then(i.bind(null,"3dce")),wmts:()=>i.e("chunk-68f8e1d9").then(i.bind(null,"0513")),"geo-rss":null,kml:null,"map-notes":null,route:null,"subtype-group":null,unknown:null,unsupported:null};function ue(e){const t=e.declaredClass?e.declaredClass.slice(e.declaredClass.lastIndexOf(".")+1):"Unknown",i=t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return new v["a"](i+":view-not-supported",t+" is not supported in 3D")}const pe={hasLayerViewModule:e=>Object(w["l"])(he[e.type]),importLayerView:e=>{const t=he[e.type];if(!Object(w["l"])(t))throw ue(e);return t(e)}};var fe=i("9096");const be=j["a"].getLogger("esri.views.3d.analysis.AnalysisViewManager3D"),me="analyses-owner-handles";let ge=class extends(Object(fe["b"])(W["a"])){constructor(e){super(e),this._allAnalysisViews=new m["a"],this._creatingViewCount=0,this._items=new Map,this._scheduledUpdateHandle=null,this._analysisModules={"area-measurement":{module:null},"direct-line-measurement":{module:null},"line-of-sight":{module:null},slice:{module:null}}}destroy(){this.detach()}attach(){this.handles.add(this._connectOwner(this.view),me)}detach(){this.handles.remove(me),this._update(),this._creatingViewCount=0}get updating(){return!this.view.ready||0!==this._creatingViewCount||this._allAnalysisViews.some(e=>e.updating)}get testInfo(){return{allAnalysisViews:this._allAnalysisViews}}whenAnalysisView(e){const t=this._items.get(e);if(Object(w["k"])(t)||1===t.state.list){const t=new v["a"]("AnalysisViewManager:no-analysisview-for-analysis","The analysis has not been added to the scene.",{analysis:e});return Promise.reject(t)}return t.createAnalysisViewTask.promise}_connectOwner(e){return this._connectAnalysesCollection(e.analyses)}_connectAnalysesCollection(e){for(const r of e)this._addAnalysis(r);const t=e.on("after-add",e=>this._addAnalysis(e.item)),i=e.on("after-remove",e=>this._removeAnalysis(e.item));return{remove:()=>{t.remove(),i.remove();for(const t of e)this._removeAnalysis(t)}}}_addAnalysis(e){const t=this._items.get(e);if(null==t){const t={state:{view:0,list:0},analysis:e,view:null,createAnalysisViewTask:null};this._items.set(e,t),t.createAnalysisViewTask=Object(S["h"])(e=>this._createAnalysisViewPromise(t,e))}else t.state.list=0}_removeAnalysis(e){const t=this._items.get(e);null!=t?(t.state.list=1,this._scheduleUpdate()):be.error("Trying to remove analysis which was not added")}_scheduleUpdate(){Object(w["l"])(this._scheduledUpdateHandle)||(this._scheduledUpdateHandle=Object(T["b"])(()=>this._update()))}_update(){this._scheduledUpdateHandle=Object(w["t"])(this._scheduledUpdateHandle),this._items.forEach(e=>{if(1===e.state.list)switch(this._items.delete(e.analysis),e.state.view){case 0:e.createAnalysisViewTask=Object(w["a"])(e.createAnalysisViewTask);break;case 1:Object(w["l"])(e.view)&&(this._allAnalysisViews.remove(e.view),e.view=Object(w["e"])(e.view),e.createAnalysisViewTask=null)}})}async _createAnalysisViewPromise(e,t){const i=e.analysis,r=i.type,n=this._analysisModules[r];if(this._creatingViewCount+=1,Object(w["k"])(n.module))try{n.module=await this._loadAnalysisModule(r)}catch(s){throw this._creatingViewCount-=1,s}if(Object(S["n"])(t))throw this._creatingViewCount-=1,Object(S["e"])("AnalysisView creation aborted");const a=new n.module.default({analysis:i,view:this.view});try{await a.when()}catch(s){throw this._creatingViewCount-=1,s}if(Object(S["n"])(t))throw this._creatingViewCount-=1,a.destroy(),Object(S["e"])("AnalysisView creation aborted");return e.view=a,e.state.view=1,this._allAnalysisViews.add(a),this._creatingViewCount-=1,a}_loadAnalysisModule(e){switch(e){case"area-measurement":return Promise.all([i.e("chunk-2d22cf8c"),i.e("chunk-b402834e"),i.e("chunk-0e63963a"),i.e("chunk-422efde6")]).then(i.bind(null,"ed44"));case"direct-line-measurement":return Promise.all([i.e("chunk-2d22cf8c"),i.e("chunk-0e63963a"),i.e("chunk-27f328bc")]).then(i.bind(null,"a63c"));case"line-of-sight":return i.e("chunk-5f3937a2").then(i.bind(null,"8e60"));case"slice":return i.e("chunk-5524dc30").then(i.bind(null,"9c6b"));default:return null}}};Object(h["a"])([Object(M["b"])()],ge.prototype,"updating",null),Object(h["a"])([Object(M["b"])({constructOnly:!0})],ge.prototype,"view",void 0),Object(h["a"])([Object(M["b"])()],ge.prototype,"_allAnalysisViews",void 0),Object(h["a"])([Object(M["b"])()],ge.prototype,"_creatingViewCount",void 0),ge=Object(h["a"])([Object(D["a"])("esri.views.3d.analysis.AnalysisViewManager3D")],ge);const ve=ge;var ye=i("e20b"),Oe=i("38a4"),_e=i("2255"),xe=i("680b");const je=j["a"].getLogger("esri.views.3d.state.Constraints");let we=class extends W["a"]{constructor(e){super(e),this.collision=new Ae,this.distance=1/0,this.minimumPoiDistance=4}get altitude(){return 2===this.mode?null:this._get("altitude")||null}set altitude(e){2!==this.mode?this._set("altitude",e):je.warn("Altitude constraint is ignored in local scenes")}clampAltitude(e){return this.altitude?Object(Oe["f"])(e,this.altitude.min,this.altitude.max):e}clampTilt(e,t){if(!this.tilt)return t;const i=this.tilt(e);return Object(Oe["f"])(t,i.min,i.max)}clampDistance(e){return Math.min(e,this.distance)}createDefaultTilt(){return 2===this.mode?this.createDefaultTiltLocal():this.createDefaultTiltGlobal()}createConstantMaxTilt(e){return(t,i=Pe)=>(i.min=Ce.min,i.max=e,i)}createDefaultTiltLocal(){const e=this.collision.enabled?Object(xe["h"])([[4e3,Ce.max],[1e4,Object(Oe["h"])(88)],[6e6,Object(Oe["h"])(88)]]):()=>Ce.max;return(t,i=Pe)=>(i.min=Ce.min,i.max=e(t),i)}createDefaultTiltGlobal(){const e=this.collision.enabled?Object(xe["h"])([[4e3,Ce.max],[5e4,Object(Oe["h"])(88)],[6e6,Object(Oe["h"])(88)],[2e7,Ce.min]]):Object(xe["h"])([[3e5,Ce.max],[3e6,Object(Oe["h"])(88)],[6e6,Object(Oe["h"])(88)],[2e7,Ce.min]]);return(t,i=Pe)=>(i.min=Ce.min,i.max=e(t),i)}};function Se(e){return{min:-2e5,max:4*e.radius}}Object(h["a"])([Object(M["b"])()],we.prototype,"altitude",null),Object(h["a"])([Object(M["b"])({readOnly:!0})],we.prototype,"collision",void 0),Object(h["a"])([Object(M["b"])()],we.prototype,"distance",void 0),Object(h["a"])([Object(M["b"])({readOnly:!0})],we.prototype,"minimumPoiDistance",void 0),Object(h["a"])([Object(M["b"])()],we.prototype,"tilt",void 0),Object(h["a"])([Object(M["b"])({constructOnly:!0})],we.prototype,"mode",void 0),we=Object(h["a"])([Object(D["a"])("esri.views.3d.state.Constraints")],we);const Te=Se(_e["a"]),Ce={min:Object(Oe["h"])(.5),max:Object(Oe["h"])(179.5)},Pe={min:0,max:0};let Ae=class extends W["a"]{constructor(){super(...arguments),this.enabled=!0,this.elevationMargin=5}};Object(h["a"])([Object(M["b"])({type:Boolean})],Ae.prototype,"enabled",void 0),Object(h["a"])([Object(M["b"])({type:Number})],Ae.prototype,"elevationMargin",void 0),Ae=Object(h["a"])([Object(D["a"])("esri.views.3d.state.Constraints.CollisionConstraint")],Ae);const Me=we;let Re=class extends W["a"]{constructor(){super(...arguments),this.min=Te.min,this.max=Te.max}set mode(e){Object(ye["a"])(j["a"].getLogger(this.declaredClass),"esri.views.SceneView.constraints.altitude.mode is deprecated. The altitude constraint no longer applies to local scenes and does not have an automatic mode anymore.",{version:"4.6"})}get mode(){return Object(ye["a"])(j["a"].getLogger(this.declaredClass),"esri.views.SceneView.constraints.altitude.mode is deprecated. The altitude constraint no longer applies to local scenes and does not have an automatic mode anymore.",{version:"4.6"}),"manual"}};Object(h["a"])([Object(M["b"])({type:Number})],Re.prototype,"min",void 0),Object(h["a"])([Object(M["b"])({type:Number})],Re.prototype,"max",void 0),Re=Object(h["a"])([Object(D["a"])("esri.views.3d.constraints.AltitudeConstraint")],Re);const Ee=Re;let De=class extends W["a"]{constructor(){super(...arguments),this.mode="auto"}get near(){return this._get("near")}set near(e){this._set("near",e),e>=this._get("far")&&(this.far=e+1e-9),this.mode="manual"}castNear(e){return Math.max(1e-8,e)}get far(){return this._get("far")}set far(e){this._set("far",e),e<=this._get("near")&&(this.near=e-1e-9),this.mode="manual"}castFar(e){return Math.max(1e-8,e)}autoUpdate(e,t){"auto"===this.mode&&(this._get("near")!==e&&this._set("near",e),this._get("far")!==t&&this._set("far",t))}};Object(h["a"])([Object(M["b"])({type:Number,value:1e-8})],De.prototype,"near",null),Object(h["a"])([Object(E["a"])("near")],De.prototype,"castNear",null),Object(h["a"])([Object(M["b"])({type:Number,value:1e-8})],De.prototype,"far",null),Object(h["a"])([Object(E["a"])("far")],De.prototype,"castFar",null),Object(h["a"])([Object(M["b"])({type:["auto","manual"]})],De.prototype,"mode",void 0),De=Object(h["a"])([Object(D["a"])("esri.views.3d.constraints.ClipDistanceConstraint")],De);const Ie=De,Fe={min:Object(Oe["p"])(Ce.min),max:Object(Oe["p"])(Ce.max)};let ze=class extends W["a"]{constructor(){super(...arguments),this.mode="auto"}get max(){return this._get("max")}set max(e){this._set("max",e),this.mode="manual"}castMax(e){return Object(Oe["f"])(e,Fe.min,Fe.max)}autoUpdate(e){"auto"===this.mode&&this._get("max")!==e&&this._set("max",e)}};Object(h["a"])([Object(M["b"])({type:["auto","manual"]})],ze.prototype,"mode",void 0),Object(h["a"])([Object(M["b"])({type:Number,value:Fe.max})],ze.prototype,"max",null),Object(h["a"])([Object(E["a"])("max")],ze.prototype,"castMax",null),ze=Object(h["a"])([Object(D["a"])("esri.views.3d.constraints.TiltConstraint")],ze);const Le=ze;let Ve=class extends W["a"]{constructor(){super(...arguments),this.tilt=new Le,this.altitude=new Ee,this.clipDistance=new Ie}};Object(h["a"])([Object(M["b"])({type:Le})],Ve.prototype,"tilt",void 0),Object(h["a"])([Object(M["b"])({type:Ee})],Ve.prototype,"altitude",void 0),Object(h["a"])([Object(M["b"])({type:Ie})],Ve.prototype,"clipDistance",void 0),Ve=Object(h["a"])([Object(D["a"])("esri.views.3d.constraints.Constraints")],Ve);const ke=Ve;var Ue,Be=i("7ffa");let Ne=Ue=class extends W["a"]{set quality(e){-1!==["low","high"].indexOf(e)&&this._set("quality",e)}clone(){return new Ue({quality:this.quality})}};Object(h["a"])([Object(M["b"])({type:["low","high"],value:"low"})],Ne.prototype,"quality",null),Ne=Ue=Object(h["a"])([Object(D["a"])("esri.views.3d.environment.SceneViewAtmosphere")],Ne);const Ge=Ne;var qe,He=i("6a0e"),We=i("afcf"),$e=i("09db");let Ze=qe=class extends He["a"]{constructor(e){super(e),this.date=null,this.directShadowsEnabled=!1,this.displayUTCOffset=null}readDate(e,t){return null!=t.datetime&&new Date(t.datetime)||null}writeDate(e,t,i){t[i]=e.getTime()}readDirectShadowsEnabled(e,t){return!!t.directShadows}writedirectShadowsEnabled(e,t,i){e&&(t[i]=e)}writeDisplayUTCOffset(e,t){null!=e&&(t.displayUTCOffset=e)}clone(){return new qe(this.cloneConstructProperties())}cloneConstructProperties(){const e={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:null!=this.displayUTCOffset?this.displayUTCOffset:null};return null!=this.date&&(e.date=new Date(this.date.getTime())),e}};Object(h["a"])([Object(M["b"])({type:Date,json:{type:Number,write:{target:"datetime"}}})],Ze.prototype,"date",void 0),Object(h["a"])([Object(We["a"])("date",["datetime"])],Ze.prototype,"readDate",null),Object(h["a"])([Object($e["a"])("date")],Ze.prototype,"writeDate",null),Object(h["a"])([Object(M["b"])({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],Ze.prototype,"directShadowsEnabled",void 0),Object(h["a"])([Object(We["a"])("directShadowsEnabled",["directShadows"])],Ze.prototype,"readDirectShadowsEnabled",null),Object(h["a"])([Object($e["a"])("directShadowsEnabled")],Ze.prototype,"writedirectShadowsEnabled",null),Object(h["a"])([Object(M["b"])({type:Number,json:{write:!0}})],Ze.prototype,"displayUTCOffset",void 0),Object(h["a"])([Object($e["a"])("displayUTCOffset")],Ze.prototype,"writeDisplayUTCOffset",null),Ze=qe=Object(h["a"])([Object(D["a"])("esri.webscene.Lighting")],Ze);const Qe=Ze;var Xe;let Ye=Xe=class extends(Z["a"].EventedMixin(Qe)){constructor(e){super(e),this.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0},this.cameraTrackingEnabled=!0,this.ambientOcclusionEnabled=!1,this.waterReflectionEnabled=!1;const t=(new Date).getFullYear(),i=new Date("March 15, "+t+" 12:00:00 UTC");this._set("defaultDate",i),this._set("date",i)}static fromWebsceneLighting(e){return new Xe({...e.cloneConstructProperties()})}get defaultDate(){return new Date(this._get("defaultDate").getTime())}set defaultDate(e){const t=this._get("date")===this._get("defaultDate");e=new Date(e.getTime()),this._set("defaultDate",e),t&&this._set("date",e)}set date(e){null!=e&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(e.getTime())))}autoUpdate(e,t){const i=Ke(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=t.hours,this.positionTimezoneInfo.minutes=t.minutes,this.positionTimezoneInfo.seconds=t.seconds;let r=null;null!=e&&(this.positionTimezoneInfo.autoUpdated=!0,r=this.date&&this.date.getTime(),this._set("date",new Date(e.getTime())));const n=Ke(this.positionTimezoneInfo);if(i!==n&&(Je.target=this,Je.timezoneOffset=n,this.emit("timezone-will-change",Je)),null!=e)return r!==e.getTime()}clone(){const e=this._get("date")===this._get("defaultDate"),t=new Xe({...this.cloneConstructProperties(),defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled,ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled});return e&&t._set("date",t._get("defaultDate")),t.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated,t.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours,t.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes,t.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds,t}cloneWithWebsceneLighting(e){const t=this.clone();return null!=e.date&&(t.date=e.date),t.directShadowsEnabled=e.directShadowsEnabled,t.displayUTCOffset=e.displayUTCOffset,t}};function Ke({hours:e,minutes:t,seconds:i}){return Math.round(e+t/60+i/3600)}Object(h["a"])([Object(M["b"])({type:Boolean})],Ye.prototype,"cameraTrackingEnabled",void 0),Object(h["a"])([Object(M["b"])({type:Boolean})],Ye.prototype,"ambientOcclusionEnabled",void 0),Object(h["a"])([Object(M["b"])({type:Boolean})],Ye.prototype,"waterReflectionEnabled",void 0),Object(h["a"])([Object(M["b"])({type:Date})],Ye.prototype,"defaultDate",null),Object(h["a"])([Object(M["b"])({type:Date})],Ye.prototype,"date",null),Ye=Xe=Object(h["a"])([Object(D["a"])("esri.views.3d.environment.SceneViewLighting")],Ye);const Je={target:null,timezoneOffset:0};var et,tt=i("448d");let it=et=class extends He["a"]{constructor(e){super(e),this.type="sunny",this.cloudCover=.5}clone(){return new et({cloudCover:this.cloudCover})}};Object(h["a"])([Object(tt["a"])({sunny:"sunny"})],it.prototype,"type",void 0),Object(h["a"])([Object(M["b"])({type:Number,nonNullable:!0,range:{min:0,max:1}})],it.prototype,"cloudCover",void 0),it=et=Object(h["a"])([Object(D["a"])("esri.views.3d.environment.SunnyWeather")],it);const rt=it;var nt;let at=nt=class extends W["a"]{constructor(e){super(e),this.type="cloudy",this.cloudCover=.5}clone(){return new nt({cloudCover:this.cloudCover})}};Object(h["a"])([Object(tt["a"])({cloudy:"cloudy"})],at.prototype,"type",void 0),Object(h["a"])([Object(M["b"])({type:Number,nonNullable:!0,range:{min:0,max:1}})],at.prototype,"cloudCover",void 0),at=nt=Object(h["a"])([Object(D["a"])("esri.views.3d.environment.CloudyWeather")],at);const st=at;var ot;let ct=ot=class extends W["a"]{constructor(e){super(e),this.type="foggy",this.fogStrength=.5}clone(){return new ot({fogStrength:this.fogStrength})}};Object(h["a"])([Object(tt["a"])({foggy:"foggy"})],ct.prototype,"type",void 0),Object(h["a"])([Object(M["b"])({type:Number,nonNullable:!0,range:{min:0,max:1}})],ct.prototype,"fogStrength",void 0),ct=ot=Object(h["a"])([Object(D["a"])("esri.views.3d.environment.FoggyWeather")],ct);const lt=ct;var dt;let ht=dt=class extends W["a"]{constructor(e){super(e),this.type="rainy",this.cloudCover=.5}clone(){return new dt({cloudCover:this.cloudCover})}};Object(h["a"])([Object(tt["a"])({rainy:"rainy"})],ht.prototype,"type",void 0),Object(h["a"])([Object(M["b"])({type:Number,nonNullable:!0,range:{min:0,max:1}})],ht.prototype,"cloudCover",void 0),ht=dt=Object(h["a"])([Object(D["a"])("esri.views.3d.environment.RainyWeather")],ht);const ut=ht,pt={key:"type",base:null,typeMap:{sunny:rt,cloudy:st,rainy:ut,foggy:lt}};let ft=class extends He["a"]{constructor(e){super(e)}clone(){}};Object(h["a"])([Object(M["b"])({readOnly:!0,json:{read:!1}})],ft.prototype,"type",void 0),ft=Object(h["a"])([Object(D["a"])("esri.webscene.background.Background")],ft);const bt=ft;var mt,gt=i("9ef0"),vt=i("5c00");const yt={...vt["a"],nonNullable:!0};let Ot=mt=class extends bt{constructor(e){super(e),this.type="color",this.color=new gt["a"]([0,0,0,1])}clone(){return new mt(this.cloneProperties())}cloneProperties(){return{color:this.color.clone()}}};Object(h["a"])([Object(tt["a"])({color:"color"},{readOnly:!0})],Ot.prototype,"type",void 0),Object(h["a"])([Object(M["b"])(yt)],Ot.prototype,"color",void 0),Ot=mt=Object(h["a"])([Object(D["a"])("esri.webscene.background.ColorBackground")],Ot);const _t=Ot,xt={base:bt,key:"type",typeMap:{color:_t}};function jt(e){return(t,i,r)=>{if(!t)return t;for(const n in e.typeMap)if(t.type===n){const i=new e.typeMap[n];return i.read(t,r),i}}}const wt={types:xt,json:{read:jt(xt),write:{overridePolicy:(e,t,i)=>({enabled:!i||!i.isPresentation})}}};var St;const Tt=(e,t,i)=>({enabled:!i||!i.isPresentation});let Ct=St=class extends He["a"]{constructor(e){super(e),this.lighting=new Qe,this.background=null,this.atmosphereEnabled=!0,this.starsEnabled=!0}clone(){return new St(this.cloneConstructProperties())}cloneConstructProperties(){return{lighting:Qe.prototype.clone.call(this.lighting),background:Object(Be["a"])(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled}}};Object(h["a"])([Object(M["b"])({type:Qe,json:{write:!0}})],Ct.prototype,"lighting",void 0),Object(h["a"])([Object(M["b"])(wt)],Ct.prototype,"background",void 0),Object(h["a"])([Object(M["b"])({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:Tt}}})],Ct.prototype,"atmosphereEnabled",void 0),Object(h["a"])([Object(M["b"])({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:Tt}}})],Ct.prototype,"starsEnabled",void 0),Ct=St=Object(h["a"])([Object(D["a"])("esri.webscene.Environment")],Ct);const Pt=Ct;var At;let Mt=At=class extends Pt{constructor(e){super(e),this.atmosphere=new Ge,this.weather=new rt}static fromWebsceneEnvironment(e){const t=e.cloneConstructProperties();return new At({...t,lighting:Ye.fromWebsceneLighting(t.lighting)})}castLighting(e){return this.convertLighting(e)}applyLighting(e){this.lighting=this.convertLighting(e)}convertLighting(e){return e?e instanceof Ye?e:e instanceof Qe?this.lighting?this.lighting.cloneWithWebsceneLighting(e):Ye.fromWebsceneLighting(e):Object(I["m"])(Ye,e):new Ye}clone(){return new At({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:Object(Be["a"])(this.background)})}cloneWithWebsceneEnvironment(e){return new At({atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:Object(Be["a"])(this.background),...e.cloneConstructProperties(),lighting:null!=this.lighting?this.lighting.cloneWithWebsceneLighting(e.lighting):Ye.fromWebsceneLighting(e.lighting)})}};Object(h["a"])([Object(M["b"])({type:Ge,json:{read:!1},nonNullable:!0})],Mt.prototype,"atmosphere",void 0),Object(h["a"])([Object(M["b"])({types:pt,nonNullable:!0,json:{write:!1}})],Mt.prototype,"weather",void 0),Object(h["a"])([Object(M["b"])()],Mt.prototype,"lighting",void 0),Object(h["a"])([Object(E["a"])("lighting")],Mt.prototype,"castLighting",null),Mt=At=Object(h["a"])([Object(D["a"])("esri.views.3d.environment.SceneViewEnvironment")],Mt);const Rt=Mt;var Et=i("e431"),Dt=i("0fc4"),It=i("7f83"),Ft=i("477c"),zt=i("f694"),Lt=i("d791"),Vt=i("afe1"),kt=i("3349"),Ut=i("02f1");function Bt(e){const t=1e5,i=1e6;return Math.min(1,Math.max(0,(e-t)/(i-t)))}const Nt=1e4,Gt=Object(F["h"])(5802e-9,13558e-9,331e-7),qt=3,Ht=Object(F["h"])(65e-8*qt,1881e-9*qt,85e-9*qt),Wt=3996e-9,$t=.085,Zt=1e5;var Qt=i("fcb1"),Xt=i("c3a4"),Yt=i("ca98"),Kt=i("da35"),Jt=i("fa1e"),ei=i("c829"),ti=i("189c");class ii extends Yt["a"]{initializeProgram(e){const t=ii.shader.get(),i=this.configuration,r=t.build({haze:i.haze});return new ei["a"](e.rctx,r,Jt["a"])}initializePipeline(){return this.configuration.haze?Object(ti["g"])({blending:Object(ti["h"])(1,0,769,1),colorWrite:ti["d"]}):Object(ti["g"])({blending:Object(ti["h"])(770,1,771,771),depthTest:{func:515},colorWrite:ti["d"]})}}ii.shader=new Xt["a"](Qt["a"],()=>i.e("chunk-2d0e6172").then(i.bind(null,"96ed")));class ri extends Kt["a"]{constructor(){super(...arguments),this.haze=!1}}Object(h["a"])([Object(Kt["b"])()],ri.prototype,"haze",void 0);var ni=i("7c33"),ai=i("d5f7");class si{constructor(e){this._view=e,this.type="realistic",this.canRender=!0,this._cameraPosition=Object(F["f"])(),this._projectionInverse=Object(Vt["d"])(),this._viewInverse=Object(Vt["d"])(),this._heightParameters=Object(Dt["e"])(),this._betasRayleigh=Object(F["f"])(),this._betasCombined=Object(F["f"])(),this._scaleHeight=0,this._radii=Object(Ut["b"])(),this._nearFar=Object(Ut["b"])(),this._cameraHeight=0,this._cameraHeightSq=0,this._cAtmosphere=0,this._innerFadeDistance=0,this._altitudeFade=0,this._lowerElevationBoundRadius=0,this._lowerBoundEarthRadius=_e["a"].radius,this._hazeStrength=1,this._darkenHaze=!1,this._updateRadius(_e["a"].radius)}destroy(){this._atmosphereTechnique=Object(w["s"])(this._atmosphereTechnique),this._atmosphereHazeTechnique=Object(w["s"])(this._atmosphereHazeTechnique),this._vao=Object(w["f"])(this._vao),this._handles=Object(w["e"])(this._handles)}when(){return Promise.resolve()}initializeRenderContext(e){const t=e.renderContext.rctx;this._handles=new $["a"],Object(w["l"])(this._view.basemapTerrain.rootTiles)&&this._updateElevation({spatialReference:this._view.basemapTerrain.spatialReference,tile:this._view.basemapTerrain.rootTiles[0],extent:this._view.basemapTerrain.rootTiles[0].extent,context:"ground"}),this._handles.add(Object(C["b"])(this._view,"basemapTerrain","elevation-change",e=>this._updateElevation(e),()=>this._updateElevation())),this._handles.add(Object(C["b"])(this._view,"basemapTerrain","elevation-bounds-change",()=>this._updateVisibleElevationBounds()));const i=new ri;i.haze=!1,this._atmosphereTechnique=e.shaderTechniqueRep.acquire(ii,i),i.haze=!0,this._atmosphereHazeTechnique=e.shaderTechniqueRep.acquire(ii,i),this._vao=Object(ai["d"])(t,ni["b"]),this._scaleHeight=$t*Zt,Object(Et["z"])(this._betasRayleigh,Gt[0],Gt[1],Gt[2]),Object(Et["z"])(this._betasCombined,Gt[0]+Ht[0],Gt[1]+Ht[1],Gt[2]+Ht[2])}render(e){return this._render(e,this._atmosphereTechnique,e.offscreenRenderingHelper.depthTexture)}renderHaze(e,t){return this._darkenHaze=t,this._render(e,this._atmosphereHazeTechnique,e.offscreenRenderingHelper.linearDepthTexture)}_render(e,t,i){this._update(e.camera);const r=e.rctx,n=e.offscreenRenderingHelper;return r.useProgram(t.program),t.bindPipelineState(r),n.renderDepthDetached(()=>{t.program.bindTexture(i,"depthTex"),this._renderCommon(t.program,e)}),!0}_renderCommon(e,t){if(Object(w["k"])(this._vao))return!1;const i=t.rctx;return t.scenelightingData.setLightDirectionUniform(e),e.setUniform4fv("heightParameters",this._heightParameters),e.setUniform3fv("cameraPosition",this._cameraPosition),e.setUniformMatrix4fv("projectionInverse",this._projectionInverse),e.setUniformMatrix4fv("viewInverse",this._viewInverse),e.setUniform2fv("nearFar",this._nearFar),e.setUniform2fv("radii",this._radii),e.setUniform1f("scaleHeight",this._scaleHeight),e.setUniform1f("betaMie",Wt),e.setUniform3fv("betaRayleigh",this._betasRayleigh),e.setUniform3fv("betaCombined",this._betasCombined),e.setUniform1f("innerFadeDistance",this._innerFadeDistance),e.setUniform1f("altitudeFade",this._altitudeFade),e.setUniform1f("hazeStrength",this._hazeStrength),i.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),i.drawArrays(5,0,4),!0}_adjustRadiusForTesselation(e){return e*Math.cos(Math.PI/16/16)}_updateElevation(e){const t=e?e.tile:Object(w["v"])(this._view.basemapTerrain.rootTiles,[null])[0];if(Object(w["k"])(t)||0!==t.level)return;const i=this._adjustRadiusForTesselation(_e["a"].radius+t.elevationBounds[0]);i!==this._lowerElevationBoundRadius&&(this._lowerElevationBoundRadius=i,this._lowerBoundEarthRadius=-1,this._updateVisibleElevationBounds())}_updateVisibleElevationBounds(){const e=this._adjustRadiusForTesselation(_e["a"].radius+this._view.basemapTerrain.elevationBounds.min);(this._lowerBoundEarthRadius<0||e<this._lowerBoundEarthRadius)&&this._updateRadius(e)}_updateRadius(e){this._lowerBoundEarthRadius=e,Object(kt["s"])(this._radii,e,e+Zt),this._innerFadeDistance=2*Math.sqrt((2*e-Nt)*Nt)}_update(e){if(Object(w["k"])(e))return;this._cameraHeight=Object(Et["s"])(e.eye),this._cameraHeightSq=this._cameraHeight*this._cameraHeight,this._cAtmosphere=this._cameraHeightSq-this._radii[1]*this._radii[1];const t=Math.min(1,Math.max(0,(this._cameraHeight-this._radii[0])/Zt));this._heightParameters=Object(Dt["g"])(this._cameraHeight,this._cameraHeightSq,this._cAtmosphere,t),Object(Et["n"])(this._cameraPosition,e.eye),Object(Lt["c"])(this._projectionInverse,e.projectionMatrix),Object(Lt["c"])(this._viewInverse,e.viewMatrix),Object(kt["s"])(this._nearFar,e.near,e.far),this._altitudeFade=Bt(this._cameraHeight-this._lowerBoundEarthRadius),this._hazeStrength=this._darkenHaze?Object(Oe["l"])(.6,1,Object(Oe["r"])(9500,10500,this._cameraHeight-_e["a"].radius)):1}static isSupported(e){return e.renderContext.rctx.capabilities.depthTexture}}var oi=i("04f0"),ci=i("b139"),li=i("a1b1"),di=i("7361");function hi(e=mi){return[e[0],e[1],e[2],e[3]]}function ui(e,t){return pi(e[0],e[1],e[2],t,di["e"].get())}function pi(e,t,i,r,n=hi()){return n[0]=e,n[1]=t,n[2]=i,n[3]=r,n}function fi(e,t,i=hi()){return Object(Et["j"])(i,e,t),Object(Et["u"])(i,i),i[3]=Object(li["a"])(e,t),i}function bi(e){return e}const mi=[0,0,1,0];Object(ci["b"])(),Object(ci["b"])();var gi,vi,yi,Oi,_i=i("b165");class xi extends Yt["a"]{initializeProgram(e){const t=xi.shader.get().build();return new ei["a"](e.rctx,t,Jt["a"])}initializePipeline(){return Object(ti["g"])({blending:Object(ti["i"])(1,770),depthTest:{func:515},colorWrite:ti["d"]})}}xi.shader=new Xt["a"](_i["a"],()=>i.e("chunk-2d22cac2").then(i.bind(null,"f3dc"))),function(e){e[e.FINISHED=0]="FINISHED",e[e.CHANGE_ANCHOR=1]="CHANGE_ANCHOR",e[e.FADE_IN=2]="FADE_IN"}(gi||(gi={})),function(e){e[e.FINISHED=0]="FINISHED",e[e.FADE_OUT=1]="FADE_OUT",e[e.FADE_IN=2]="FADE_IN"}(vi||(vi={})),function(e){e[e.FINISHED=0]="FINISHED",e[e.CROSS_FADE=1]="CROSS_FADE"}(yi||(yi={})),function(e){e[e.FINISHED=0]="FINISHED",e[e.HEIGHT_FADE=1]="HEIGHT_FADE"}(Oi||(Oi={}));class ji{constructor(e,t,i,r){this._viewingMode=t,this._inverseProjectionMatrix=Object(Vt["d"])(),this._inverseViewMatrix=Object(Vt["d"])(),this._cameraPositionLastFrame=Object(F["f"])(),this._technique=new xi({rctx:e,viewingMode:this._viewingMode},null),this._vao=Object(ai["d"])(e),this._setDefaultParallax(i,r)}destroy(){this._technique=Object(w["s"])(this._technique),this._vao=Object(w["f"])(this._vao)}render(e,t,i,r,n){const a=e.camera;if(Object(w["k"])(this._vao)||Object(w["k"])(a))return!1;const s=e.rctx,o=this._technique.program;return s.useProgram(o),this._technique.bindPipelineState(s),this._isCameraAnimating=i,e.scenelightingData.setLightDirectionUniform(o),e.scenelightingData.setUniforms(o),Object(Lt["c"])(this._inverseProjectionMatrix,a.projectionMatrix),Object(Lt["c"])(this._inverseViewMatrix,a.viewMatrix),o.setUniformMatrix4fv("inverseProjectionMatrix",this._inverseProjectionMatrix),o.setUniformMatrix4fv("inverseViewMatrix",this._inverseViewMatrix),o.bindTexture(t.colorTexture,"cubeMap"),o.setUniform2fv("cloudVariables",[r,n]),this._setParallaxParams(a.eye),this._bindParallaxParams(o,e.camera),s.bindVAO(this._vao),o.assertCompatibleVertexAttributeLocations(this._vao),s.drawArrays(5,0,4),!0}isFading(){return this._crossFadeParams.crossFadeStage!==yi.FINISHED||this._fadeInOutParams.fadeInOutStage!==vi.FINISHED||this._fadeInParams.fadeInStage!==gi.FINISHED||this._fadeInOutHeightParams.fadeHeightStage!==Oi.FINISHED}_setDefaultParallax(e,t){this._parallaxParams={anchorPointClouds:Object(F["f"])(),radius:e,cloudsHeight:1e5,radiusCurvatureCorrectionFactor:0,transform:Object(Vt["d"])()},this._parallaxParamsNew={anchorPointClouds:Object(F["f"])(),radius:e,cloudsHeight:1e5,radiusCurvatureCorrectionFactor:0,transform:Object(Vt["d"])()},this._crossFadeParams={crossFadeStage:yi.FINISHED,crossFadeFactor:0,distanceThresholdFactor:.3},this._fadeInOutParams={fadeInOutStage:vi.FINISHED,fadeInOutFactor:0,distanceThresholdFactor:.6},this._fadeInParams={fadeInStage:gi.FINISHED,fadeInFactor:0,distanceThresholdFactor:2},this._fadeInOutHeightParams={fadeHeightStage:Oi.FINISHED,fadeHeightFactor:t>1e4?1:0,heightThresholdFactor:1e4}}_isCameraPositionFinal(e){return Object(Et["G"])(this._cameraPositionLastFrame,e)}_setFadeInStage(e){const t=this._isCameraPositionFinal(e);this._fadeInParams.fadeInStage===gi.FINISHED&&(this._fadeInParams.fadeInFactor=1,Object(Et["n"])(this._parallaxParams.anchorPointClouds,Ti),this._fadeInParams.fadeInStage=gi.CHANGE_ANCHOR,this._crossFadeParams.crossFadeStage=yi.FINISHED,this._fadeInOutParams.fadeInOutStage=vi.FINISHED),this._fadeInParams.fadeInStage===gi.CHANGE_ANCHOR&&t&&(Object(Et["n"])(this._parallaxParams.anchorPointClouds,Ti),this._fadeInParams.fadeInStage=gi.FADE_IN,this._startTime=performance.now()),this._fadeInParams.fadeInFactor>0&&this._fadeInParams.fadeInStage===gi.FADE_IN&&(this._fadeInParams.fadeInFactor=1-(performance.now()-this._startTime)/500),this._fadeInParams.fadeInFactor<=0&&this._fadeInParams.fadeInStage===gi.FADE_IN&&(this._fadeInParams.fadeInStage=gi.FINISHED,this._fadeInParams.fadeInFactor=0)}_setCrossFadingStage(){this._crossFadeParams.crossFadeStage===yi.FINISHED&&(Object(Et["n"])(this._parallaxParamsNew.anchorPointClouds,Ti),this._startTime=performance.now(),this._crossFadeParams.crossFadeFactor=0,this._crossFadeParams.crossFadeStage=yi.CROSS_FADE),this._crossFadeParams.crossFadeFactor<1&&this._crossFadeParams.crossFadeStage===yi.CROSS_FADE&&(this._crossFadeParams.crossFadeFactor=(performance.now()-this._startTime)/500),this._crossFadeParams.crossFadeFactor>=1&&this._crossFadeParams.crossFadeStage===yi.CROSS_FADE&&(this._crossFadeParams.crossFadeStage=yi.FINISHED,this._crossFadeParams.crossFadeFactor=1,Object(Et["n"])(this._parallaxParams.anchorPointClouds,this._parallaxParamsNew.anchorPointClouds))}_setFadeInOutStage(e){this._fadeInOutParams.fadeInOutStage===vi.FINISHED&&(this._startTime=performance.now(),this._fadeInOutParams.fadeInOutFactor=0,this._fadeInOutParams.fadeInOutStage=vi.FADE_OUT),this._fadeInOutParams.fadeInOutFactor<1&&this._fadeInOutParams.fadeInOutStage===vi.FADE_OUT&&(this._fadeInOutParams.fadeInOutFactor=(performance.now()-this._startTime)/250),this._fadeInOutParams.fadeInOutFactor>=1&&this._fadeInOutParams.fadeInOutStage===vi.FADE_OUT&&(this._fadeInOutParams.fadeInOutFactor=1,Object(Et["n"])(this._parallaxParams.anchorPointClouds,Ti)),this._fadeInOutParams.fadeInOutFactor>=1&&this._fadeInOutParams.fadeInOutStage===vi.FADE_OUT&&this._isCameraPositionFinal(e)&&(this._startTime=performance.now(),this._fadeInOutParams.fadeInOutFactor=1,this._fadeInOutParams.fadeInOutStage=vi.FADE_IN,this._crossFadeParams.crossFadeStage=yi.FINISHED,this._crossFadeParams.crossFadeFactor=0),this._fadeInOutParams.fadeInOutFactor>0&&this._fadeInOutParams.fadeInOutStage===vi.FADE_IN&&(this._fadeInOutParams.fadeInOutFactor=1-(performance.now()-this._startTime)/500),this._fadeInOutParams.fadeInOutFactor<=0&&this._fadeInOutParams.fadeInOutStage===vi.FADE_IN&&(this._fadeInOutParams.fadeInOutStage=vi.FINISHED,this._fadeInOutParams.fadeInOutFactor=0)}_setFadeInOutHeight(e){const t=performance.now();this._startTimeHeightFade=this._fadeInOutHeightParams.fadeHeightStage===Oi.FINISHED?t:this._startTimeHeightFade,e?this._fadeInOutHeightParams.fadeHeightFactor+=(t-this._startTimeHeightFade)/500:this._fadeInOutHeightParams.fadeHeightFactor-=(t-this._startTimeHeightFade)/500,this._startTimeHeightFade=t,this._fadeInOutHeightParams.fadeHeightFactor=Object(Oe["f"])(this._fadeInOutHeightParams.fadeHeightFactor,0,1),this._fadeInOutHeightParams.fadeHeightStage=Oi.HEIGHT_FADE}_setParallaxParams(e){Object(Et["u"])(Ti,e),Object(Et["h"])(Ti,Ti,this._parallaxParams.radius),0===this._parallaxParams.anchorPointClouds[0]&&0===this._parallaxParams.anchorPointClouds[1]&&0===this._parallaxParams.anchorPointClouds[2]&&Object(Et["n"])(this._parallaxParams.anchorPointClouds,Ti);const t=Object(Et["s"])(Object(Et["m"])(Ci,this._parallaxParams.anchorPointClouds,Ti));let i=!0;t>this._fadeInParams.distanceThresholdFactor*this._parallaxParams.cloudsHeight||this._fadeInParams.fadeInStage!==gi.FINISHED?this._setFadeInStage(e):t>this._fadeInOutParams.distanceThresholdFactor*this._parallaxParams.cloudsHeight||this._fadeInOutParams.fadeInOutStage!==vi.FINISHED?this._setFadeInOutStage(e):t>this._crossFadeParams.distanceThresholdFactor*this._parallaxParams.cloudsHeight&&!this._isCameraAnimating||this._crossFadeParams.crossFadeStage!==yi.FINISHED?this._setCrossFadingStage():i=!1;const r=Object(Et["s"])(e),n=r-this._parallaxParams.radius;(n>1.7*this._fadeInOutHeightParams.heightThresholdFactor||n<-1*this._fadeInOutHeightParams.heightThresholdFactor)&&this._fadeInOutHeightParams.fadeHeightFactor<1?this._fadeInOutHeightParams.fadeHeightFactor=1:(n>this._fadeInOutHeightParams.heightThresholdFactor||n<-.35*this._fadeInOutHeightParams.heightThresholdFactor)&&this._fadeInOutHeightParams.fadeHeightFactor<1?this._setFadeInOutHeight(!0):n<this._fadeInOutHeightParams.heightThresholdFactor&&n>-.35*this._fadeInOutHeightParams.heightThresholdFactor&&this._fadeInOutHeightParams.fadeHeightFactor>0?this._setFadeInOutHeight(!1):this._fadeInOutHeightParams.fadeHeightStage=Oi.FINISHED,this._parallaxParams.radiusCurvatureCorrectionFactor=.84*Math.sqrt(Math.max(r*r-this._parallaxParams.radius*this._parallaxParams.radius,0))/r,fi(wi,this._parallaxParams.anchorPointClouds,Si),this._parallaxParams.transform=Object(Vt["d"])(),Object(Lt["f"])(this._parallaxParams.transform,this._parallaxParams.transform,Si[3],bi(Si)),i&&(fi(wi,this._parallaxParamsNew.anchorPointClouds,Si),this._parallaxParamsNew.transform=Object(Vt["d"])(),Object(Lt["f"])(this._parallaxParamsNew.transform,this._parallaxParamsNew.transform,Si[3],bi(Si))),Object(Et["n"])(this._cameraPositionLastFrame,e)}_bindParallaxParams(e,t){e.setUniform1f("cloudsHeight",this._parallaxParams.cloudsHeight),e.setUniformMatrix4fv("rotationMatrixClouds",this._parallaxParams.transform),e.setUniformMatrix4fv("rotationMatrixCloudsCrossFade",this._parallaxParamsNew.transform),e.setUniform3fv("anchorPosition",this._parallaxParams.anchorPointClouds),e.setUniform3fv("anchorPositionCrossFade",this._parallaxParamsNew.anchorPointClouds),this._fadeInOutParams.fadeInOutStage!==vi.FINISHED?e.setUniform1f("totalFadeInOut",this._fadeInOutHeightParams.fadeHeightFactor+Math.max(Object(Oe["f"])(this._fadeInOutParams.fadeInOutFactor,0,1))):e.setUniform1f("totalFadeInOut",this._fadeInOutHeightParams.fadeHeightFactor+Math.max(Object(Oe["f"])(this._fadeInParams.fadeInFactor,0,1))),e.setUniform1f("radiusCurvatureCorrectionFactor",this._parallaxParams.radiusCurvatureCorrectionFactor),e.setUniform1i("crossFade",this._crossFadeParams.crossFadeStage),e.setUniform1f("crossFadeAnchorFactor",Object(Oe["f"])(this._crossFadeParams.crossFadeFactor,0,1)),e.setUniform1f("radius",this._parallaxParams.radius),e.setUniform3fv("cameraPosition",t.eye)}}const wi=Object(F["h"])(0,0,1),Si=hi(),Ti=Object(F["f"])(),Ci=Object(F["f"])();var Pi=i("1c92"),Ai=i("dae5"),Mi=i("47f8"),Ri=i("19f3");class Ei extends Yt["a"]{initializeProgram(e){const t=Ei.shader.get().build({steps:this.configuration.steps});return new ei["a"](e.rctx,t,Jt["a"])}initializePipeline(){return Object(ti["g"])({blending:Object(ti["h"])(1,1,0,0),depthTest:{func:515},colorWrite:ti["d"]})}}Ei.shader=new Xt["a"](Ri["a"],()=>i.e("chunk-2d209219").then(i.bind(null,"a86b")));class Di extends Kt["a"]{constructor(){super(...arguments),this.steps=0}}Object(h["a"])([Object(Kt["b"])({count:3})],Di.prototype,"steps",void 0);var Ii=i("1a2b"),Fi=i("9305"),zi=i("d267");let Li=class extends W["a"]{constructor(e){super(e),this._frameTask=null,this._techniques=[],this._techniqueConfiguration=new Di,this._cubeMapSize=Object(_["a"])("esri-mobile")?1024:2048,this._viewMat3=Object(Ai["b"])(),this._eye=Object(Mi["e"])(),this._didRenderFaces=!1,this._raymarchingStepType=0,this._cloudRadius=0,this._viewMatrix=Object(Vt["d"])();const t=Bi.sunny;this.coverage=Object(Oe["l"])(t.coverage[1],t.coverage[0],.5),this.density=Object(Oe["l"])(t.density[1],t.density[0],.5),this.absorption=Object(Oe["l"])(t.absorption[1],t.absorption[0],.5),this.cloudSize=Object(Oe["l"])(t.cloudSize[1],t.cloudSize[0],.5),this.detailSize=Object(Oe["l"])(t.detailSize[1],t.detailSize[0],.5),this.smoothness=Object(Oe["l"])(t.smoothness[1],t.smoothness[0],.5),this.cloudHeight=Object(Oe["l"])(t.cloudHeight[1],t.cloudHeight[0],.5),this.raymarchingStepType=t.raymarchingStepType}_getTechnique(e){const t=this._techniques[e];return t||(this._techniqueConfiguration.steps=e,this._techniques[e]=new Ei({rctx:this.rctx,viewingMode:this.view.state.viewingMode},this._techniqueConfiguration),this._techniques[e])}initialize(){this._vao=Object(ai["d"])(this.rctx);const e=Object(zt["e"])(this.view.spatialReference);this._cloudRadius=.5*e.radius,this.resetRenderFlags(),this._frameTask=this.view.resourceController.scheduler.registerTask(Fi["b"].CLOUDS_GENERATOR,this)}destroy(){this._frameTask=Object(w["t"])(this._frameTask),this._techniques.forEach(e=>Object(w["s"])(e)),this._techniques=null,this._frameBufferCube=Object(w["f"])(this._frameBufferCube),this._vao=Object(w["f"])(this._vao),this._noiseTexture=Object(w["e"])(this._noiseTexture)}set coverage(e){this._coverage=e,this.resetRenderFlags()}get coverage(){return this._coverage}set density(e){this._density=this.remap(e,0,1,0,.3),this.resetRenderFlags()}set cloudSize(e){this._cloudSize=this.remap(Math.max(.01,1-e),0,1,0,.02),this.resetRenderFlags()}set detailSize(e){this._detailSize=this.remap(Math.max(.01,1-e),0,1,0,.2),this.resetRenderFlags()}set smoothness(e){this._smoothness=this.remap(1-e,0,1,0,.5),this.resetRenderFlags()}set absorption(e){this._sigmaE=1+e,this._power=this.remap(e,0,1,35,120),this.resetRenderFlags()}get absorption(){return this._sigmaE-1}set cloudHeight(e){this._cloudHeight=this.remap(e,0,1,0,1500),this.resetRenderFlags()}get cloudHeight(){return this._cloudHeight}set raymarchingStepType(e){this._raymarchingStepType=e,this.resetRenderFlags()}_ensureNoiseTexture(){return Object(w["k"])(this._noiseTexture)&&(this._noiseTexture=new Ii["b"](this.rctx,this.view),this._noiseTexture.render(this.rctx)),this._noiseTexture}get frameBufferCube(){if(Object(w["k"])(this._frameBufferCube)){const e={target:34067,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,hasMipmap:!1,width:this._cubeMapSize,height:this._cubeMapSize};this._frameBufferCube=new zi["a"](this.rctx,{colorTarget:2,width:this._cubeMapSize,height:this._cubeMapSize},e)}return this._frameBufferCube}get cubeMap(){return this._frameBufferCube}resetRenderFlags(){this._didRenderFaces=!1}remap(e,t,i,r,n){return r+(e-t)*(n-r)/(i-t)}get running(){return!this._didRenderFaces}runTask(e){if(0===this.coverage||Object(w["k"])(this._vao))return void(this._didRenderFaces=!0);const t=this._ensureNoiseTexture().textureAtlas;if(Object(w["k"])(t))return void(this._didRenderFaces=!0);const i=this.rctx.getViewport();this.rctx.setViewport(0,0,this._cubeMapSize,this._cubeMapSize),this.rctx.bindFramebuffer(this.frameBufferCube,!1,34069);const r=this._getTechnique(this._raymarchingStepType),n=r.program;this.rctx.useProgram(n),n.bindTexture(t,"cloudShapeTexture"),n.setUniform1f("cloudRadius",this._cloudRadius),n.setUniform1f("halfCubeMapSize",.5*this._cubeMapSize),n.setUniform1f("power",this._power),n.setUniform1f("sigmaE",this._sigmaE),n.setUniform1f("density",this._density),n.setUniform1f("cloudSize",this._cloudSize),n.setUniform1f("detailSize",this._detailSize),n.setUniform1f("smoothness",this._smoothness),n.setUniform1f("cloudHeight",this._cloudHeight),n.setUniform1f("coverage",this._coverage),this.rctx.bindVAO(this._vao),n.assertCompatibleVertexAttributeLocations(this._vao),r.bindPipelineState(this.rctx);for(let a=0;a<5;a++){const e=Vi[a],t=ki[a];Object(Lt["r"])(this._viewMatrix,this._eye,e,t),Object(Pi["f"])(this._viewMat3,this._viewMatrix),n.setUniformMatrix3fv("viewMatrix",this._viewMat3);const i=34069+a;this.frameBufferCube.framebufferTexture2D(this.frameBufferCube.colorAttachment.glName,this.rctx.gl,36064,i),this.rctx.gl.drawArrays(this.rctx.gl.TRIANGLE_STRIP,0,4),this.rctx.gl.flush()}this.rctx.setViewport(i.x,i.y,i.width,i.height),this.requestRender(),this._didRenderFaces=!0,e.madeProgress()}get test(){return{coverage:this._coverage,density:this.remap(this._density,0,.3,0,1),absorption:this._sigmaE-1,cloudSize:1-this.remap(this._cloudSize,0,.02,0,1),detailSize:1-this.remap(this._detailSize,0,.2,0,1),smoothness:1-this.remap(this._smoothness,0,.5,0,1),cloudHeight:this.remap(this._cloudHeight,0,1500,0,1)}}};Object(h["a"])([Object(M["b"])({constructOnly:!0})],Li.prototype,"rctx",void 0),Object(h["a"])([Object(M["b"])({constructOnly:!0})],Li.prototype,"view",void 0),Object(h["a"])([Object(M["b"])({constructOnly:!0})],Li.prototype,"requestRender",void 0),Object(h["a"])([Object(M["b"])()],Li.prototype,"_frameTask",void 0),Object(h["a"])([Object(M["b"])()],Li.prototype,"_didRenderFaces",void 0),Object(h["a"])([Object(M["b"])({readOnly:!0})],Li.prototype,"running",null),Li=Object(h["a"])([Object(D["a"])("esri.views.3d.environment.CloudsGenerator")],Li);const Vi=[Object(Mi["d"])(1,0,0),Object(Mi["d"])(-1,0,0),Object(Mi["d"])(0,1,0),Object(Mi["d"])(0,-1,0),Object(Mi["d"])(0,0,1)],ki=[Object(Mi["d"])(0,1,0),Object(Mi["d"])(0,1,0),Object(Mi["d"])(0,0,-1),Object(Mi["d"])(0,0,1),Object(Mi["d"])(0,1,0)];class Ui{constructor(e,t,i,r,n,a,s,o,c=.5){this.coverage=e,this.density=t,this.absorption=i,this.cloudSize=r,this.detailSize=n,this.smoothness=a,this.cloudHeight=s,this.raymarchingStepType=o,this.median=c}}const Bi={sunny:new Ui([.1,.7],[.02,.02],[0,0],[.86,.86],[.8,.8],[.5,.5],[.05,.05],0),cloudy:new Ui([.24,.7],[.135,.2],[0,0],[.5,.5],[.65,.7],[.3,.3],[1,1],2),rainy:new Ui([.5,.9],[.2,.5],[.3,.6],[.4,.4],[.7,.7],[.5,.5],[1,1],2),foggy:new Ui([.8,.8],[.5,.5],[0,0],[.85,.85],[.75,.75],[.8,.8],[.3,.3],1)};var Ni=i("4bc4");class Gi extends Yt["a"]{initializeProgram(e){const t=Gi.shader.get(),i=this.configuration,r=t.build({haze:i.haze});return new ei["a"](e.rctx,r,Jt["a"])}initializePipeline(){return this.configuration.haze?Object(ti["g"])({blending:Object(ti["h"])(1,0,769,1),colorWrite:ti["d"]}):Object(ti["g"])({blending:Object(ti["h"])(770,0,771,1),colorWrite:ti["d"]})}}Gi.shader=new Xt["a"](Ni["a"],()=>i.e("chunk-2d0d0632").then(i.bind(null,"6882")));class qi extends Kt["a"]{constructor(){super(...arguments),this.haze=!1}}Object(h["a"])([Object(Kt["b"])()],qi.prototype,"haze",void 0);class Hi{constructor(e,t){this._projectionInverse=Object(Vt["d"])(),this._viewInverse=Object(Vt["d"])(),this._nearFar=Object(Ut["b"])(),this._darkenHaze=!1,this._hazeMultiplier=1,this._strength=4e-6;const i=e.renderContext.rctx;this._vao=Object(ai["d"])(i,ni["b"]),this._shaderTechniqueRepository=e.shaderTechniqueRep;const r=Object(zt["e"])(t.spatialReference);this._planetRadius=r.radius,this._atmosphereRadius=r.radius+Zt}set strength(e){this._strength=e}get strength(){return this._strength}get foggyWeatherTechnique(){if(Object(w["k"])(this._foggyWeatherTechnique)){const e=new qi;e.haze=!1,this._foggyWeatherTechnique=this._shaderTechniqueRepository.acquire(Gi,e)}return this._foggyWeatherTechnique}get distanceFogTechnique(){if(Object(w["k"])(this._distanceFogTechnique)){const e=new qi;e.haze=!0,this._distanceFogTechnique=this._shaderTechniqueRepository.acquire(Gi,e)}return this._distanceFogTechnique}destroy(){this._distanceFogTechnique=Object(w["s"])(this._distanceFogTechnique),this._foggyWeatherTechnique=Object(w["s"])(this._foggyWeatherTechnique),this._vao=Object(w["f"])(this._vao)}when(){return Promise.resolve()}render(e,t,i){if(this._darkenHaze=i,this._update(e.camera,t),this._fogAmount<=0)return!1;const r=e.rctx,n=e.offscreenRenderingHelper,a=t?this.foggyWeatherTechnique:this.distanceFogTechnique;return r.useProgram(a.program),a.bindPipelineState(r),n.renderDepthDetached(()=>{a.program.bindTexture(n.depthTexture,"depthTex"),this._renderFog(a.program,e)}),!0}_renderFog(e,t){if(Object(w["k"])(this._vao))return!1;const i=t.rctx;return t.scenelightingData.setLightDirectionUniform(e),e.setUniform3fv("cameraPosition",t.camera.eye),e.setUniformMatrix4fv("projectionInverse",this._projectionInverse),e.setUniformMatrix4fv("viewInverse",this._viewInverse),e.setUniform2fv("nearFar",this._nearFar),e.setUniform1f("atmosphereC",this._atmosphereC),e.setUniform1f("strength",this._strength),e.setUniform1f("fogAmount",this._hazeMultiplier*this._fogAmount),i.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),i.drawArrays(5,0,4),!0}_update(e,t){if(Object(w["k"])(e))return;Object(Lt["c"])(this._projectionInverse,e.projectionMatrix),Object(Lt["c"])(this._viewInverse,e.viewMatrix),Object(kt["s"])(this._nearFar,e.near,e.far);const i=Object(Et["s"])(e.eye),r=i*i;this._atmosphereC=r-this._atmosphereRadius*this._atmosphereRadius,this._fogAmount=t?1-Object(Oe["r"])(3e3,6e3,Math.abs(i-this._planetRadius)):1-Object(Oe["r"])(7e3,1e4,Math.abs(i-this._planetRadius)),this._hazeMultiplier=this._darkenHaze?Object(Oe["l"])(.4,1,Object(Oe["r"])(9500,10500,i-this._planetRadius)):1}static isSupported(e){return e.capabilities.depthTexture}}var Wi=i("2db0"),$i=i("76ac");class Zi extends Yt["a"]{initializeProgram(e){const t=Zi.shader.get(),i=this.configuration,r=t.build({geometry:i.geometry});return new ei["a"](e.rctx,r,Jt["a"])}initializePipeline(){return 1===this.configuration.geometry?Object(ti["g"])({blending:Object(ti["h"])(770,1,771,771),culling:ti["b"],depthTest:{func:515},colorWrite:ti["d"]}):Object(ti["g"])({blending:Object(ti["h"])(770,1,771,771),depthTest:{func:515},colorWrite:ti["d"]})}}Zi.shader=new Xt["a"]($i["a"],()=>i.e("chunk-2d0d7e66").then(i.bind(null,"797e")));class Qi extends Kt["a"]{constructor(){super(...arguments),this.geometry=0}}Object(h["a"])([Object(Kt["b"])({count:3})],Qi.prototype,"geometry",void 0);const Xi="data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAAEAAAIACAYAAABD1gYFAAAACXBIWXMAAC4jAAAuIwF4pT92AAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAXVJREFUeNq0k9GWhDAIQ3PjzP9/cuehFqhW19mz++IhkCZAq1prsqT+kSQS9g8Vnqp6VGVWkYVktR6tj3Gr968nLnfwlHzHYyHapkKS73bPd/39eI38AYWj24OGvqdwWjZ3l8IDgacXyl1Dj9tdLOzZiicj+P1YcGk0H2O2vN/VQpTveEHmPHQxZxYlqsQdhUeuCWREuDEvAjqlCqDIMYwIo2ijR1HdYUS58dQrKpgQ0EGeMocsTNXrxzyOhS9kfzlWjn82YuWLqwAnvfNEWJFjYXkJCT0s7AmS0NG4x7Lt6Cpy2MiVPBZmS668QT5AR1cevp7b6CpzQ/ZSNH0vmhy5CsNtdax0MBpXDBiFsrDiMSLKMc8b6hH93bNbEpRsIyHDUhNcfTyeKF16PC7c/2QdczvUnvOB1ylZHVFSMtd5s8C2IW/7w6hwM5GLavLCd1zkiFjB+BwH1DSgctQ7mPOimBLJrw35beSXkd8BM/cCqbXWPgMA+GQQ5sIgkfAAAAAASUVORK5CYII=";var Yi=i("2ebb"),Ki=i("fc00"),Ji=i("8e97"),er=i("caf7"),tr=i("7ce4"),ir=i("a1ff"),rr=i("8539"),nr=i("0fa6");const ar=j["a"].getLogger("esri.views.3d.environment.PanoramicAtmosphere");class sr{constructor(){this.type="panoramic",this._atmosphereTechniqueConfig=new Qi,this._readyResolver=Object(S["g"])(),this._readyController=new AbortController}destroy(){this._readyResolver.reject(),this._texture=Object(w["f"])(this._texture),this._vao=Object(w["f"])(this._vao),this._readyController=Object(w["a"])(this._readyController)}when(){return this._readyResolver.promise}initializeRenderContext(e){this._atmosphereTechniqueConfig.geometry=1,this._atmosphereTechnique=e.shaderTechniqueRep.acquire(Zi,this._atmosphereTechniqueConfig);const t=e.renderContext.rctx;this._vao=this._createVertexArrayObject(t),this._vaoCount=Object(rr["e"])(this._vao,"geometry"),Object(Wi["a"])(Xi,{signal:this._readyController.signal}).then(i=>{this._texture=new ir["a"](t,{pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!0},i),e.requestRender(),this._readyController=null,this._readyResolver.resolve()}).catch(e=>{Object(S["m"])(e)||ar.error("Unable to initialize atmosphere: image request failed",e),this._readyResolver.reject()})}get canRender(){return null!=this._texture}render(e){const t=e.rctx,i=this._atmosphereTechnique.program;return t.useProgram(i),this._atmosphereTechnique.bindPipelineState(t),i.bindTexture(this._texture,"tex"),Object(Ji["c"])(i,e.camera.projectionMatrix),or(cr,e.camera.viewMatrix),i.setUniformMatrix4fv("view",cr),i.setUniform4f("color",1,1,1,1),e.scenelightingData.setLightDirectionUniform(i),t.bindVAO(this._vao),i.assertCompatibleVertexAttributeLocations(this._vao),t.drawArrays(4,0,this._vaoCount),!0}renderHaze(){return!1}_createVertexArrayObject(e){const t=er["a"].createPolySphereGeometry(1,2,!1),i=t.indices.get("position");for(let s=0;s<i.length;s+=3){const e=i[s];i[s]=i[s+2],i[s+2]=e}const r=t.vertexAttributes.get("position").data,n=lr.createBuffer(i.length),a=n.position;for(let s=0;s<i.length;++s){const e=3*i[s];a.set(s,0,r[e]),a.set(s,1,r[e+1]),a.set(s,2,r[e+2])}return new nr["a"](e,Jt["a"],{geometry:Object(Yi["a"])(lr)},{geometry:tr["a"].createVertex(e,35044,n.buffer)})}}function or(e,t){Object(Lt["d"])(e,t),e[12]=0,e[13]=0,e[14]=0,e[15]=1}const cr=Object(Vt["d"])(),lr=Object(Ki["a"])().vec3f("position"),dr="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAIACAYAAAE00TaTAAAACXBIWXMAAA7AAAAOwAFq1okJAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAp1JREFUSMd9lcmSEzEQRCtflnqxYZgIThBDAP//kXDQ0pJtuDhqycxWZ5fKERFCERARIAVEyCjCtSFFEjWVa9q7OdJE0oiidIhKhRBROlhloiGVhaYERQHJWFEwMpYKrjUlibI2cqSJIJEpKNmM2c3GkRTOJDnThTMpnMWu0VFszs3Jfbe5bza3w+a229yOIs6zmP3czfn1K2w/for8+EVU15pNmmyqkeJyclinXNJRu1xrUaJmjmdzJiejVNt7zZVBRAIq1RwrsrrWnez+SR7WmQQP/1itKz2q/pmzuJtYnNy2bth9x9z2NLfDcB7FHOcGx6ebOb9/iPzxG/ztg4iorglFiKjzF9HSNphCoRb1OY3RZQJrYgRdT68bmgXGDdBzrTG8qNS7QP/m19ef7tGlcoH7vESYkK70uoPuOLEetz0IqeGoWQW6MlB/j36EnipYGKPWwDRg/RkNhXCNJIzAhMk6PrDePJNII6JHqM5VWqYApCtNFPe0GFFGtOWopWCrEVBSoiQi06KkRRaD08IlxXa/ifz8Jvz2LvjyLnh7F/r8Rei8a8xfjNkIrpmMOQ1C02COrkTEHxGhh+6DQJfXc/eZprXxcIyVIf1LJVgWvKaHvwI/1aQxtv851SQ/nqGXL6MHFVY3nmhLyqKsWO/+qzWif+yS1TpNKq8NezjGPCV69ciZoQj1PwfN6QRpWyCGVMe1D/AAHt3/gefu1Ign3AVpjOiNXkN90JlpL6TUnzFEUU+Jvks0tkp/dY3Fy1TzI24BWwsYJPyg11Q0FqDwK72xIz2kLojbeuxS1FpgtfNWyMX1gFw0j3W7RNeSHTVEe3VaV7SdCzVywFaEt02w7QH7Eeg4AvZDNdJ+Cu1HENsutO+Byi6ilEBZ9BeCNBJceJIjHgAAAABJRU5ErkJggg==";var hr=i("1153");const ur=j["a"].getLogger("esri.views.3d.environment.SimpleAtmosphere"),pr=128,fr=-Nt,br=0,mr=50,gr=()=>1-511/512,vr=Object(xe["h"])([[50,.1015625],[500,.21875],[5e3,1-250/512],[5e4,.4140625]]);class yr{constructor(e){this.view=e,this.type="simple",this._renderData={texV:Object(Ut["b"])(),silCircleCenter:Object(F["f"])(),silCircleV1:Object(F["f"])(),silCircleV2:Object(F["f"])(),altitudeFade:0,innerScale:0,undergroundFadeAlpha:0},this._fadeVaoCount=0,this._readyResolver=Object(S["g"])(),this._readyController=new AbortController,this.texV1=1,this.isOnMars=Object(It["i"])(e.spatialReference);const t=Object(zt["e"])(e.spatialReference);this.planetRadius=t.radius,this.outerRimWidth=t.outerAtmosphereRimWidth,this.innerRimFactor=(this.planetRadius+fr)/this.planetRadius,this.middleRimFactor=(this.planetRadius+br)/this.planetRadius,this.outerRimFactor=(this.planetRadius+this.outerRimWidth)/this.planetRadius,this.texV0=br/this.outerRimWidth,this.texVScale=this.texV1-this.texV0}destroy(){this._readyResolver.reject(),this._cameraChangeHandle=Object(w["t"])(this._cameraChangeHandle),this._texture=Object(w["f"])(this._texture),this._fadeVao=Object(w["f"])(this._fadeVao),this._vao=Object(w["f"])(this._vao),this._readyController=Object(w["a"])(this._readyController)}when(){return this._readyResolver.promise}initializeRenderContext(e){this._shaderTechniqueRepository=e.shaderTechniqueRep;const t=e.renderContext.rctx;this._cameraChangeHandle=Object(C["a"])(this.view,"state.camera",()=>e.requestRender(),!0),this._vao=this._createRibbon(t),this._vaoCount=Object(rr["e"])(this._vao,"geometry"),this._fadeVao=Object(ai["d"])(t),this._fadeVaoCount=Object(rr["e"])(this._fadeVao,"geometry"),Object(Wi["a"])(this.isOnMars?dr:Xi,{signal:this._readyController.signal}).then(i=>{this._texture=new ir["a"](t,{pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!0},i),e.requestRender(),this._readyController=null,this._readyResolver.resolve()}).catch(e=>{Object(S["m"])(e)||ur.error("Unable to initialize simple atmosphere: image request failed",e),this._readyResolver.reject(e)})}get atmosphereConeTechnique(){if(Object(w["k"])(this._atmosphereConeTechnique)){const e=new Qi;e.geometry=0,this._atmosphereConeTechnique=this._shaderTechniqueRepository.acquire(Zi,e)}return this._atmosphereConeTechnique}get atmosphereUndergroundTechnique(){if(Object(w["k"])(this._atmosphereUndergroundTechnique)){const e=new Qi;e.geometry=2,this._atmosphereUndergroundTechnique=this._shaderTechniqueRepository.acquire(Zi,e)}return this._atmosphereUndergroundTechnique}get canRender(){return null!=this._texture}render(e){this._update(e.camera);const t=e.rctx;if(this.atmosphereConeTechnique.bindPipelineState(t),this._renderData.undergroundFadeAlpha<1){const i=this.atmosphereConeTechnique.program;t.useProgram(i),i.setUniformMatrix4fv("proj",e.camera.projectionMatrix),i.setUniformMatrix4fv("view",e.camera.viewMatrix),i.setUniform3fv("silCircleCenter",this._renderData.silCircleCenter),i.setUniform3fv("silCircleV1",this._renderData.silCircleV1),i.setUniform3fv("silCircleV2",this._renderData.silCircleV2),i.setUniform2fv("texV",this._renderData.texV),i.bindTexture(this._texture,"tex"),e.scenelightingData.setLightDirectionUniform(i),i.setUniform1f("altitudeFade",this._renderData.altitudeFade),i.setUniform1f("innerScale",this._renderData.innerScale),t.bindVAO(this._vao),t.drawArrays(4,0,this._vaoCount)}if(this._renderData.undergroundFadeAlpha>0){const i=this.atmosphereUndergroundTechnique.program;t.useProgram(i),i.setUniform1f("undergroundFadeAlpha",this._renderData.undergroundFadeAlpha),e.scenelightingData.setLightDirectionUniform(i),i.setUniform3fv("cameraPosition",e.camera.eye),t.bindVAO(this._fadeVao),t.drawArrays(5,0,this._fadeVaoCount)}return!0}renderHaze(){return!1}_update(e){const t=Object(F["f"])(),i=this.planetRadius,r=Object(Et["s"])(e.eye),n=r-i;if(n<0){const e=Math.min(-n/5e3,1);this._renderData.undergroundFadeAlpha=e}else this._renderData.undergroundFadeAlpha=0;const a=Math.max(mr,n),s=i+fr;this._renderData.innerScale=wr(i+a,i,s)-1,this._renderData.altitudeFade=Bt(n),Object(Et["h"])(t,e.eye,(i+mr)/r),Or(t,e.center,e.up,i,this._renderData);const o=this._computeScreenRimWidth(e,t,e.up,this._renderData),c=gr(),l=vr(n);let d=this.texV0+c*this.texVScale,h=this.texV0+o*l*this.texVScale;if(n>mr){Or(e.eye,e.center,e.up,i,this._renderData);const t=this._computeScreenRimWidth(e,e.eye,e.up,this._renderData),r=Object(Oe["f"])((t-1.5)/(o-1.5),0,1);d=this.texV0+r*c*this.texVScale,h=this.texV0+Object(Oe["l"])(this.texV1,o*l,r)*this.texVScale}Object(kt["s"])(this._renderData.texV,d,h)}_createRibbon(e){const t=new Float32Array(3+3*pr*3),i=new Uint32Array(3*pr*5);t[0]=0,t[1]=0,t[2]=-1;for(let a=0;a<pr;a++){const e=9*a+3;t[e+0]=a,t[e+1]=this.innerRimFactor,t[e+2]=-1,t[e+3]=a,t[e+4]=this.middleRimFactor,t[e+5]=0,t[e+6]=a,t[e+7]=this.outerRimFactor,t[e+8]=1;const r=3*a+1,n=a===pr-1?1:r+3,s=15*a;i[s+0]=r,i[s+1]=r+1,i[s+2]=n+1,i[s+3]=n+1,i[s+4]=n,i[s+5]=r,i[s+6]=r+1,i[s+7]=r+2,i[s+8]=n+2,i[s+9]=n+2,i[s+10]=n+1,i[s+11]=r+1,i[s+12]=r,i[s+13]=n,i[s+14]=0}const r=Sr.createBuffer(i.length),n=r.position;for(let a=0;a<i.length;++a){const e=3*i[a];n.set(a,0,t[e]),n.set(a,1,t[e+1]),n.set(a,2,t[e+2])}return new nr["a"](e,Jt["a"],{geometry:Object(Yi["a"])(Sr)},{geometry:tr["a"].createVertex(e,35044,r.buffer)})}_computeScreenRimWidth(e,t,i,r){return Object(Et["i"])(xr,r.silCircleCenter,r.silCircleV2),Object(Et["h"])(jr,xr,this.outerRimFactor),Object(Lt["m"])(_r,t,xr,i),Object(hr["i"])(xr,_r,e.projectionMatrix,e.viewport),Object(hr["i"])(jr,_r,e.projectionMatrix,e.viewport),Object(Et["p"])(xr,jr)/e.height}}function Or(e,t,i,r,n){const a=Object(Et["s"])(e),s=r*Math.sqrt(a*a-r*r)/a,o=Math.sqrt(r*r-s*s),c=n.silCircleV1,l=n.silCircleV2;return Object(Et["h"])(n.silCircleCenter,e,o/a),Object(Et["j"])(c,e,t),Object(Et["w"])(c)<1&&Object(Et["j"])(c,e,i),Object(Et["h"])(c,c,s/Object(Et["s"])(c)),Object(Et["j"])(l,c,e),Object(Et["h"])(l,l,s/Object(Et["s"])(l)),s}const _r=Object(Vt["d"])(),xr=Object(F["f"])(),jr=Object(F["f"])();function wr(e,t,i){return e*e/(Math.sqrt(e*e-t*t)*Math.sqrt(e*e-i*i)+t*i)}const Sr=Object(Ki["a"])().vec3f("position");var Tr=i("b2cd"),Cr=i("3111");class Pr extends Yt["a"]{initializeProgram(e){const t=Pr.shader.get().build();return new ei["a"](e.rctx,t,Jt["a"])}initializePipeline(){return Object(ti["g"])({blending:Object(ti["h"])(770,1,771,771),depthTest:{func:515},colorWrite:ti["d"]})}bindPass(e){const t=this.makeInfiniteProjectionMatrix(e.camera.projectionMatrix,e.camera.near,Ar);Object(Lt["n"])(t,t,e.camera.viewMatrix),Object(Lt["n"])(t,t,e.modelMatrix),this.program.setUniformMatrix4fv("transform",t),this.program.setUniform4fv("viewport",e.camera.fullViewport),this.program.setUniform1f("pixelRatio",e.camera.pixelRatio)}makeInfiniteProjectionMatrix(e,t,i){const r=24e-8;return Object(Lt["d"])(i,e),i[10]=r-1,i[11]=-1,i[14]=(r-2)*t,i}}Pr.shader=new Xt["a"](Cr["a"],()=>i.e("chunk-2d229d83").then(i.bind(null,"ded0")));const Ar=Object(Vt["d"])();var Mr=i("d347");const Rr=j["a"].getLogger("esri.views.3d.environment.Stars");let Er=class extends W["a"]{constructor(e){super(e),this._loadDataTask=null,this._numPoints=0,this._renderParameter={camera:null,modelMatrix:Object(Vt["d"])()},this._updatingTracking=new Mr["a"]}get updating(){return this._updatingTracking.updating||this.loading}get loading(){return Object(w["l"])(this._loadDataTask)&&!this._loadDataTask.finished}initialize(){this._loadDataTask=this._createLoadDataTask()}destroy(){this._loadDataTask=Object(w["a"])(this._loadDataTask),this._updatingTracking.destroy(),this._numPoints=0,this._technique=Object(w["f"])(this._technique),this._vao=Object(w["f"])(this._vao)}render(e){const{rctx:t,camera:i}=e;if(this._ensureResources(t),Object(w["k"])(this._technique)||Object(w["k"])(this._vao))return!1;const r=this._technique.program;return t.useProgram(r),this._renderParameter.camera=i,this._technique.bindPass(this._renderParameter),this._technique.bindPipelineState(t),t.bindVAO(this._vao),r.assertCompatibleVertexAttributeLocations(this._vao),t.drawArrays(0,0,this._numPoints),!0}_ensureResources(e){if(Object(w["l"])(this._technique)||Object(w["k"])(Vr))return;this._technique=new Pr({rctx:e,viewingMode:this.view.state.viewingMode},null),this._numPoints=Vr.byteLength/zr;const t=new Float32Array(Vr,0,2*this._numPoints),i=new Uint8Array(Vr,2*this._numPoints*4,this._numPoints);this._vao=this._createVertexArrayObject(e,t,i,this._numPoints),this._updatingTracking.add(this.view,"environment.lighting.date",e=>this._update(e),2)}_computeDayDuration(e){const t=e,i=new Date(e.getFullYear(),0,1,11,58,56);return(+t-+i)/(+new Date(e.getFullYear()+1,0,1,11,58,55)-+i)}_update(e){if(!e)return;const t=(e.getHours()/12+e.getMinutes()/60*(2/24)+e.getSeconds()/60*(2/1440)-.9972222)%2,i=2*this._computeDayDuration(e),r=this._renderParameter.modelMatrix;Object(Lt["d"])(r,Fr),Object(Lt["s"])(r,r,-i*Math.PI),Object(Lt["n"])(r,Ir,r),Object(Lt["s"])(r,r,-t*Math.PI),this.requestRender()}_hexToRGB(e){return[parseInt(e.substring(0,2),16),parseInt(e.substring(2,4),16),parseInt(e.substring(4,6),16)]}_unpackUint8Attributes(e){return e>=192?[2.9,e-192]:e>=160?[2.5,e-160]:e>=128?[2,e-128]:e>=96?[1.5,e-96]:e>=64?[1,e-64]:e>=32?[.7,e-32]:[.4,e]}_createVertexArrayObject(e,t,i,r){const n=Lr.createBuffer(r),a=n.position,s=n.color,o=n.size;for(let c=0;c<r;c++){const e=t[2*c+0],r=t[2*c+1];a.set(c,0,-Math.cos(e)*Math.sin(r)),a.set(c,1,-Math.sin(e)*Math.sin(r)),a.set(c,2,-Math.cos(r));const n=this._unpackUint8Attributes(i[c]),l=this._hexToRGB(Dr[n[1]]);s.set(c,0,255*l[0]),s.set(c,1,255*l[1]),s.set(c,2,255*l[2]),s.set(c,3,255),o.set(c,n[0])}return new nr["a"](e,Jt["a"],{geometry:Object(Yi["a"])(Lr)},{geometry:tr["a"].createVertex(e,35044,n.buffer)})}_createLoadDataTask(){if(Object(w["l"])(Vr))return null;const e=Object(S["h"])(async e=>{const{data:t}=await Object(Tr["a"])("esri/views/3d/environment/resources/stars.wsv",{responseType:"array-buffer",signal:e});this._verifyStarData(t),Vr=t});return e.promise.catch(e=>{Object(S["m"])(e)||Rr.error(e)}).then(()=>{this.destroyed||(this.requestRender(),this.notifyChange("updating"))}),e}_verifyStarData(e){if(!e)throw new v["a"]("stars:no-data-received","Failed to create stars because star catalogue is missing");const t=e.byteLength/zr;if(t%1!=0||t>5e4||t<5e3)throw new v["a"]("stars:invalid-data","Failed to create stars because star catalogue data is invalid")}};Object(h["a"])([Object(M["b"])({constructOnly:!0})],Er.prototype,"view",void 0),Object(h["a"])([Object(M["b"])({constructOnly:!0})],Er.prototype,"requestRender",void 0),Object(h["a"])([Object(M["b"])({readOnly:!0})],Er.prototype,"updating",null),Object(h["a"])([Object(M["b"])()],Er.prototype,"_loadDataTask",void 0),Object(h["a"])([Object(M["b"])()],Er.prototype,"_updatingTracking",void 0),Er=Object(h["a"])([Object(D["a"])("esri.views.3d.environment.Stars")],Er);const Dr=["9bb2ff","9eb5ff","aabfff","bbccff","ccd8ff ","dae2ff","e4e9ff","eeefff","f8f6ff","fff9fb","fff5ef","fff1e5","ffeddb","ffe9d2","ffe6ca","ffe3c3","ffe0bb","ffddb4","ffdaad","ffd6a5","ffd29c","ffcc8f","ffc178","ffa94b","ff7b00"],Ir=Object(Vt["e"])(1,0,0,0,0,.9174771405229186,.39778850739794974,0,0,-.39778850739794974,.9174771405229186,0,0,0,0,1),Fr=Object(Vt["e"])(1,0,0,0,0,.9174771405229186,-.39778850739794974,0,0,.39778850739794974,.9174771405229186,0,0,0,0,1),zr=9,Lr=Object(Ki["a"])().vec3f("position").vec4u8("color").f32("size");let Vr=null;const kr=[12,13];let Ur=class extends W["a"]{constructor(e){super(e),this._handles=new $["a"],this._context=null,this._pendingAtmosphere=null,this._atmosphere=null,this._stars=null,this._clouds=null,this._cloudComposition=null,this._fog=null}get atmosphereType(){return Object(w["l"])(this._pendingAtmosphere)?this._pendingAtmosphere.type:Object(w["l"])(this._atmosphere)?this._atmosphere.type:"none"}get canRender(){var e;return!(null==(e=this.view.basemapTerrain)||!e.renderer.canRender)||"global"!==this.view.viewingMode}get needsLinearDepth(){return"realistic"===this._selectAtmosphereType()}get updating(){return Object(w["l"])(this._pendingAtmosphere)||Object(w["l"])(this._stars)&&this._stars.updating||Object(w["l"])(this._clouds)&&this._clouds.running}get weatherEnabled(){var e;return!(null==(e=this.view.environmentManager)||!e.weatherEnabled)}initialize(){this.view._stage.addRenderPlugin(kr,this)}destroy(){this._pendingAtmosphere=Object(w["e"])(this._pendingAtmosphere),this.uninitializeRenderContext(),this._handles=Object(w["e"])(this._handles),this.view&&null!=this.view._stage&&(this.view._stage.removeRenderPlugin(this),this._set("view",null))}initializeRenderContext(e=null){this._context=e,this._handles.add([Object(C["f"])(this.view,"basemapTerrain",()=>this._updateBasemapTerrain(),!0),Object(Ft["b"])(()=>({viewingMode:this.view.viewingMode,atmosphereEnabled:this.view.environment.atmosphereEnabled,atmosphereQuality:this.view.environment.atmosphere.quality}),()=>this._updateAtmosphere(),Ft["e"]),Object(Ft["b"])(()=>this._starsCreationParameters,e=>this._createOrDestroyStars(e),{sync:!0,initial:!0,equals:Be["c"]}),Object(Ft["b"])(()=>this._cloudsCreationParameters,e=>this._createOrDestroyClouds(e),{sync:!0,initial:!0,equals:Be["c"]}),Object(Ft["b"])(()=>this._fogCreationParameters,e=>this._createOrDestroyFog(e),{sync:!0,initial:!0,equals:Be["c"]}),Object(Ft["b"])(()=>this._weatherUpdateParameters,e=>{this._updateWeather(e),this._updateFog(e)},Ft["e"])])}uninitializeRenderContext(){this._stars=Object(w["e"])(this._stars),this._atmosphere=Object(w["e"])(this._atmosphere),this._clouds=Object(w["e"])(this._clouds),this._cloudComposition=Object(w["e"])(this._cloudComposition),this._fog=Object(w["e"])(this._fog)}render(e){if(0!==e.pass)return!1;let t=!1;switch(e.slot){case 12:Object(w["l"])(this._stars)&&this._stars.render(e)&&(t=!0),Object(w["l"])(this._atmosphere)&&this._atmosphere.canRender&&(this._atmosphere.render(e)&&(t=!0),Object(w["l"])(this._clouds)&&Object(w["l"])(this._clouds.cubeMap)&&!this._clouds.running&&Object(w["l"])(this._cloudComposition)&&("sunny"!==this.view.environment.weather.type||0!==this.view.environment.weather.cloudCover)&&(this._cloudComposition.render(e,this._clouds.cubeMap,Object(w["l"])(this.view.animation),this._clouds.coverage,this._clouds.absorption)&&(t=!0),this._cloudComposition.isFading()&&this._setNeedsRender()));break;case 13:if(Object(w["l"])(this._atmosphere)&&this._atmosphere.canRender){const i=this.weatherEnabled?this.view.environment.weather.type:"disabled";this._atmosphere.renderHaze(e,"rainy"===i)&&(t=!0),Object(w["l"])(this._fog)&&("foggy"!==i&&"realistic"===this._selectAtmosphereType()||this._fog.render(e,"foggy"===i,"rainy"===i)&&(t=!0))}break;default:return!1}return t}get _cloudsCreationParameters(){return this.weatherEnabled?{view:this.view,viewingMode:this.view.state.viewingMode,rctx:Object(w["l"])(this._context)?this._context.renderContext.rctx:null,radius:Object(zt["e"])(this.view.spatialReference).radius}:null}_createOrDestroyClouds(e){this._clouds=Object(w["e"])(this._clouds),this._cloudComposition=Object(w["e"])(this._cloudComposition),Object(w["c"])(e,({view:e,viewingMode:t,rctx:i,radius:r})=>{this._clouds=new Li({rctx:i,view:e,requestRender:()=>this._setNeedsRender()}),this._cloudComposition=new ji(i,t,r,Object(Et["s"])(e.state.camera.eye)-r)}),this._setNeedsRender()}get _weatherUpdateParameters(){const e=this.weatherEnabled?this.view.environment.weather:null;return Object(w["k"])(e)?null:{type:e.type,presetAdjustment:"foggy"===e.type?e.fogStrength:e.cloudCover}}_updateWeather(e){if(Object(w["k"])(e)||Object(w["k"])(this._clouds))return;const t=Bi[e.type].median;for(const i in Bi[e.type])if("raymarchingStepType"===i)this._clouds[i]=Bi[e.type][i];else if("median"!==i){const r=Bi[e.type][i],n=Object(Oe["l"])(r[0],r[1],t);this._clouds[i]=e.presetAdjustment<.5?Object(Oe["l"])(r[0],n,2*e.presetAdjustment):Object(Oe["l"])(n,r[1],2*(e.presetAdjustment-.5))}}_setNeedsRender(){Object(w["l"])(this._context)&&this._context.requestRender()}get _starsCreationParameters(){var e,t,i;return{view:this.view,starsEnabled:null!=(e=null==(t=this.view)||null==(i=t.environment)?void 0:i.starsEnabled)&&e}}_createOrDestroyStars({view:e,starsEnabled:t}){t&&Object(w["k"])(this._stars)?(this._stars=new Er({view:e,requestRender:()=>this._setNeedsRender()}),this._setNeedsRender()):!t&&Object(w["l"])(this._stars)&&(this._stars.destroy(),this._stars=null,this._setNeedsRender())}_updateFog(e){Object(w["k"])(this._fog)||Object(w["k"])(e)||("foggy"===e.type?this._fog.strength=Object(Oe["l"])(3e-5,.005,e.presetAdjustment**3):this._fog.strength=4e-6)}get _fogCreationParameters(){return!this.weatherEnabled||Object(w["k"])(this._context)?null:{view:this.view,context:this._context}}_createOrDestroyFog(e){this.weatherEnabled&&Object(w["k"])(this._fog)?(Object(w["c"])(e,({view:e,context:t})=>{this._fog=new Hi(t,e)}),this._updateFog(this._weatherUpdateParameters),this._setNeedsRender()):Object(w["l"])(this._fog)&&(this._fog.destroy(),this._fog=null,this._setNeedsRender())}_updateAtmosphere(){const e=this._selectAtmosphereType();if(this.atmosphereType===e)return;Object(w["l"])(this._pendingAtmosphere)&&(this._pendingAtmosphere!==this._atmosphere&&this._pendingAtmosphere.destroy(),this._pendingAtmosphere=null);const t=this._getAtmosphereClass();if(!t)return Object(w["l"])(this._atmosphere)&&(this._atmosphere.destroy(),this._atmosphere=null,this._setNeedsRender()),void this._updateBasemapTerrain();const i=new t(this.view);Object(w["l"])(this._context)&&i.initializeRenderContext(this._context),Object(w["k"])(this._atmosphere)&&(this._atmosphere=i,this._setNeedsRender()),this._pendingAtmosphere=i,i.when().then(()=>{Object(w["l"])(this._atmosphere)&&this._pendingAtmosphere&&this._pendingAtmosphere!==this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=this._pendingAtmosphere),this._pendingAtmosphere=null,this._setNeedsRender(),this._updateBasemapTerrain()}).catch(()=>{this._pendingAtmosphere===i&&(this._pendingAtmosphere=null)})}_getAtmosphereClass(){switch(this._selectAtmosphereType()){case"none":return null;case"realistic":return si;case"panoramic":return sr;case"simple":return yr;default:return}}_selectAtmosphereType(){const e=this.view.get("environment.atmosphereEnabled"),t=this.view.get("environment.atmosphere.quality"),i=this.view.viewingMode;return!e||null==t||Object(It["j"])(this.view.spatialReference)?"none":"local"===i?"panoramic":"high"===t&&Object(w["l"])(this._context)&&si.isSupported(this._context)&&Object(It["g"])(this.view.spatialReference)?"realistic":"simple"}_updateBasemapTerrain(){this.view.basemapTerrain&&(this.view.basemapTerrain.velvetOverground=Object(w["l"])(this._atmosphere)&&"simple"===this.atmosphereType)}get test(){return{atmosphere:this._atmosphere,clouds:this._clouds,selectAtmosphereType:()=>this._selectAtmosphereType()}}};Object(h["a"])([Object(M["b"])({constructOnly:!0})],Ur.prototype,"view",void 0),Object(h["a"])([Object(M["b"])({type:Boolean,readOnly:!0})],Ur.prototype,"updating",null),Object(h["a"])([Object(M["b"])()],Ur.prototype,"_pendingAtmosphere",void 0),Object(h["a"])([Object(M["b"])()],Ur.prototype,"_stars",void 0),Object(h["a"])([Object(M["b"])()],Ur.prototype,"_clouds",void 0),Object(h["a"])([Object(M["b"])()],Ur.prototype,"_cloudComposition",void 0),Object(h["a"])([Object(M["b"])()],Ur.prototype,"_fog",void 0),Object(h["a"])([Object(M["b"])()],Ur.prototype,"weatherEnabled",null),Object(h["a"])([Object(M["b"])()],Ur.prototype,"_cloudsCreationParameters",null),Object(h["a"])([Object(M["b"])()],Ur.prototype,"_weatherUpdateParameters",null),Object(h["a"])([Object(M["b"])()],Ur.prototype,"_starsCreationParameters",null),Object(h["a"])([Object(M["b"])()],Ur.prototype,"_fogCreationParameters",null),Ur=Object(h["a"])([Object(D["a"])("esri.views.3d.environment.EnvironmentRenderer")],Ur);var Br=i("4ae5");function Nr(e,t,i){return Gr(e,t.longitude,t.latitude,i.longitude,i.latitude)}function Gr(e,t,i,r,n){const a=Object(Oe["h"])(i),s=Object(Oe["h"])(n),o=a-s,c=Object(Oe["h"])(t)-Object(Oe["h"])(r),l=Math.sin(o/2),d=Math.sin(c/2),h=2*Object(Oe["d"])(Math.sqrt(l*l+Math.cos(a)*Math.cos(s)*d*d))*e;return Math.round(1e4*h)/1e4}function qr(e,t,i){const r=t.spatialReference,n=Object(zt["e"])(r),a=new Br["a"](t.x,e.y,r),s=new Br["a"](i.x,e.y,r),o=new Br["a"](e.x,t.y,r),c=new Br["a"](e.x,i.y,r);return{lon:Nr(n.radius,a,s),lat:Nr(n.radius,o,c)}}function Hr(e,t,i){const r=t/i,n=Object(Oe["h"])(e),a=Math.sin(r/2),s=Math.cos(n),o=2*Object(Oe["d"])(Math.sqrt(a*a/(s*s)));return Object(Oe["p"])(o)}function Wr(e,t){let i=e/15;return t||(i=Math.round(i)),i}function $r(e,t){t||(t={hours:0,minutes:0,seconds:0}),t.hours=Wr(e[0],!0);const i=t.hours%1;t.hours-=i,t.minutes=60*i;const r=t.minutes%1;return t.minutes-=r,t.seconds=Math.round(60*r),t}var Zr,Qr,Xr,Yr={exports:{}};Zr=Yr,Qr=function(){var e=Math.PI,t=Math.sin,i=Math.cos,r=Math.tan,n=Math.asin,a=Math.atan2,s=Math.acos,o=e/180,c=864e5,l=2440588,d=2451545,h={dec:0,ra:0};function u(e){return e.valueOf()/c-.5+l}function p(e){return new Date((e+.5-l)*c)}function f(e){return u(e)-d}var b=23.4397*o;function m(e,n){return a(t(e)*i(b)-r(n)*t(b),i(e))}function g(e,r){return n(t(r)*i(b)+i(r)*t(b)*t(e))}function v(e,n,s){return a(t(e),i(e)*t(n)-r(s)*i(n))}function y(e,r,a){return n(t(r)*t(a)+i(r)*i(a)*i(e))}function O(e,t){return o*(280.16+360.9856235*e)-t}function _(e){return o*(357.5291+.98560028*e)}function x(e){return o*(1.9148*t(e)+.02*t(2*e)+3e-4*t(3*e))}function j(t,i){return t+i+102.9372*o+e}function w(e,t){var i=_(e),r=j(i,x(i));return t||(t={dec:0,ra:0}),t.dec=g(r,0),t.ra=m(r,0),t}var S={POLAR_EXCEPTION:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(e,t,i,r){var n=o*-i,a=o*t,s=f(e),c=w(s,h),l=O(s,n)-c.ra;return r||(r={azimuth:0,altitude:0}),r.azimuth=v(l,a,c.dec),r.altitude=y(l,a,c.dec),r}},T=[[-.83,"sunrise","sunset"]];S.addTime=function(e,t,i){T.push([e,t,i])};var C=9e-4;function P(t,i){return Math.round(t-C-i/(2*e))}function A(t,i,r){return C+(t+i)/(2*e)+r}function M(e,i,r){return d+e+.0053*t(i)-.0069*t(2*r)}function R(e,r,n){return s((t(e)-t(r)*t(n))/(i(r)*i(n)))}function E(e){var r=o*(134.963+13.064993*e),n=o*(93.272+13.22935*e),a=o*(218.316+13.176396*e)+6.289*o*t(r),s=5.128*o*t(n),c=385001-20905*i(r);return{ra:m(a,s),dec:g(a,s),dist:c}}return S.getTimes=function(e,r,n){var a=o*-n,s=o*r,c=P(f(e),a),l=A(0,a,c),d=_(l),h=x(d),u=j(d,h),b=g(u,0),m=M(l,d,u);function v(e){return M(A(R(e,s,b),a,c),d,u)}function y(e){var r=(t(e)-t(s)*t(b))/(i(s)*i(b));return r<-1?S.POLAR_EXCEPTION.MIDNIGHT_SUN:r>1?S.POLAR_EXCEPTION.POLAR_NIGHT:S.POLAR_EXCEPTION.NORMAL}var O,w,C,E,D,I={solarNoon:p(m),nadir:p(m-.5),polarException:S.POLAR_EXCEPTION.NORMAL};for(O=0,w=T.length;O<w;O+=1)D=m-((E=v((C=T[O])[0]*o))-m),I[C[1]]=p(D),I[C[2]]=p(E);return I.polarException=y(T[0][0]*o),I},S.getMoonPosition=function(e,t,i){var n=o*-i,a=o*t,s=f(e),c=E(s),l=O(s,n)-c.ra,d=y(l,a,c.dec);return d+=.017*o/r(d+10.26*o/(d+5.1*o)),{azimuth:v(l,a,c.dec),altitude:d,distance:c.dist}},S.getMoonFraction=function(e){var r=f(e),n=w(r),o=E(r),c=149598e3,l=s(t(n.dec)*t(o.dec)+i(n.dec)*i(o.dec)*i(n.ra-o.ra)),d=a(c*t(l),o.dist-c*i(l));return(1+i(d))/2},S},void 0!==(Xr=Qr())&&(Zr.exports=Xr);const Kr=Yr.exports,Jr={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8e5,ambient:.015,direct:.75},planarDirection:{localAltitude:1e4,globalAltitude:1e6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};function en(e,t,i,r,n){const a=t[2];Object(Et["z"])(r.ambient.color,1,1,1),r.ambient.intensity=Jr.global.ambient,Object(Et["z"])(r.direct.color,1,1,1),r.direct.intensity=Jr.global.direct;const s=Object(Oe["f"])((Math.abs(a)-Jr.local.altitude)/(Jr.global.altitude-Jr.local.altitude),0,1);r.globalFactor=s;const o=Kr.getTimes(e,t[1],t[0]);if(s<1){const t=dn(e,o,n);Object(Et["l"])(r.ambient.color,t.ambient.color,r.ambient.color,s),r.ambient.intensity=Object(Oe["l"])(t.ambient.intensity,r.ambient.intensity,s),Object(Et["l"])(r.direct.color,t.direct.color,r.direct.color,s),r.direct.intensity=Object(Oe["l"])(t.direct.intensity,r.direct.intensity,s)}r.noonFactor=cn(e,o),tn(e,t,i,r.direct.directionToLightSource)}function tn(e,t,i,r){const n=on,a=Object(Lt["j"])(sn);if(1===i)Kr.getPosition(e,0,0,n),Object(Et["z"])(r,0,0,-1),Object(Lt["e"])(a,a,-n.azimuth),Object(Lt["k"])(a,a,-n.altitude),Object(Et["t"])(r,r,a);else{const i=Jr.planarDirection,s=i.globalAngles,o=t[2];let c=(Math.abs(o)-i.localAltitude)/(i.globalAltitude-i.localAltitude);c=Object(Oe["f"])(c,0,1),c<1?(Kr.getPosition(e,t[1],t[0],n),n.azimuth=(1-c)*n.azimuth+c*s.azimuth,n.altitude=(1-c)*n.altitude+c*s.altitude):(n.azimuth=s.azimuth,n.altitude=s.altitude),Object(Et["z"])(r,0,-1,0),Object(Lt["s"])(a,a,-n.azimuth),Object(Lt["e"])(a,a,-n.altitude),Object(Et["t"])(r,r,a)}}function rn(e,t){if(1===t)return!0;const i=Jr.planarDirection;return Math.abs(e)<i.localAltitude}const nn=Object(F["h"])(.5773502691896258,-.5773502691896258,.5773502691896258);class an{constructor(){this.ambient={color:Object(F["h"])(1,1,1),intensity:.55},this.direct={color:Object(F["h"])(1,1,1),intensity:.55,directionToLightSource:Object(F["d"])(nn)},this.noonFactor=.5,this.globalFactor=0}}const sn=Object(Vt["d"])(),on={azimuth:0,altitude:0};function cn(e,t){const i=e.valueOf();let r,n;t.polarException===Kr.POLAR_EXCEPTION.MIDNIGHT_SUN?(r=i-60*(e.getHours()+48)*60*1e3-60*e.getMinutes()*1e3,n=r+432e6):t.polarException===Kr.POLAR_EXCEPTION.POLAR_NIGHT?(r=i-2,n=i-1):(r=t.sunrise.valueOf(),n=t.sunset.valueOf());const a=r+(n-r)/2;return 1-Object(Oe["f"])(Math.abs(i-a)/432e5,0,1)}function ln(e){switch(e){case"disabled":case"sunny":return{direct:1,ambient:1};case"cloudy":return{direct:.8,ambient:1.1};case"rainy":return{direct:.4,ambient:1};case"foggy":return{direct:.3,ambient:1.6}}}function dn(e,t,i){const r=e.valueOf();let n,a;t.polarException===Kr.POLAR_EXCEPTION.MIDNIGHT_SUN?(n=r-60*(e.getHours()+48)*60*1e3-60*e.getMinutes()*1e3,a=n+432e6):t.polarException===Kr.POLAR_EXCEPTION.POLAR_NIGHT?(n=r-2,a=r-1):(n=t.sunrise.valueOf(),a=t.sunset.valueOf());const s=a-n,o=n+s/2,c=s/4,l=o-c,d=o+c,h=.06*s,u=n-h/2,p=n+h/2,f=a-h/2,b=a+h/2,m=Jr.local,g=[.01,m.ambientAtNight],v=[.8,.8,1],y=[.01,.01,.01],O=[m.directAtTwilight,m.ambientAtTwilight],_=[1,.6,.5],x=[.8,.8,1],j=[.9*m.directAtNoon,m.ambientAtNoon],w=[1,.98,.98],S=[.98,.98,1],T=[m.directAtNoon,m.ambientAtNoon],C=[1,1,1],P=[1,1,1],A=j,M=w,R=S,E=O,D=_,I=x;let z,L,V=[0,0],k=[0,0,0],U=[0,0,0];r<u||r>b?(V=g,k=y,U=v,L="night"):r<p?(z=p-u,V=hn(r-u,z,g,O),k=hn(r-u,z,y,_),U=hn(r-u,z,v,x),L="sun rising"):r<l?(z=l-p,V=hn(r-p,z,O,j),k=hn(r-p,z,_,w),U=hn(r-p,z,x,S),L="early morning"):r<o?(z=o-l,V=hn(r-l,z,j,T),k=hn(r-l,z,w,C),U=hn(r-l,z,S,P),L="late morning"):r<d?(z=d-o,V=hn(r-o,z,T,A),k=hn(r-o,z,C,M),U=hn(r-o,z,P,R),L="early afternoon"):r<f?(z=f-d,V=hn(r-d,z,A,E),k=hn(r-d,z,M,D),U=hn(r-d,z,R,I),L="late afternoon"):r<b&&(z=b-f,V=hn(r-f,z,E,g),k=hn(r-f,z,D,y),U=hn(r-f,z,I,v),L="sun setting");const B=Object(F["h"])(k[0],k[1],k[2]),N=Object(F["h"])(U[0],U[1],U[2]),G=ln(i);return{direct:{intensity:V[0]*G.direct,color:B},ambient:{intensity:V[1]*G.ambient,color:N},timeOfDay:L}}function hn(e,t,i,r){const n=[];for(let a=0;a<i.length;a++)n[a]=(r[a]-i[a])*e/t+i[a];return n}new Date(0);var un=i("2bc9");let pn=class extends Z["a"].EventedAccessor{constructor(){super(),this._referencePointUpdateDelay=200,this._referencePointUpdateInterval=3e3,this._referencePointUpdateDistThreshold=1e6,this._referencePosUpdateQuery=null,this._referencePosMapCoordsRequested=null,this._viewHandles=new $["a"],this._preserveAbsoluteDateTime=!1,this._trackingEnabled=!1,this._referencePosResetPreserveAbsoluteTime=!1,this._referencePosUpdateTimer=null,this._referencePosMapCoords=null,this._mainLight=new un["c"],this._ambientLight=new un["a"],this._moonLight=new un["b"],this.disableQueries=!1,this._disableWeather=!1,this._renderer=null,this._referencePosWGS84Comparable=null,this._resetReferencePosition()}destroy(){this.disconnectView(),this._viewHandles.destroy()}get _view(){var e;return null==(e=this._renderer)?void 0:e.view}get updating(){var e;return!!(!this.disableQueries&&(this._referencePosUpdateQuery||this._referencePosMapCoordsRequested)||null!=(e=this._renderer)&&e.updating)}get weatherEnabled(){var e,t,i;return(null==(e=this._view)?void 0:e.environment.atmosphereEnabled)&&!this._disableWeather&&1===(null==(t=this._view)||null==(i=t.state)?void 0:i.viewingMode)&&Object(It["g"])(this._view.spatialReference)}get referencePositionWGS84Comparable(){return this._referencePosWGS84Comparable}connectView(e){this._renderer||(this._renderer=new Ur({view:e}),this._viewHandles.add([e.watch("environment.lighting.date",e=>this._lightingDateHandler(e),!0),e.watch("stationary",()=>this._interactingStationaryHandler()),e.watch(["environment.lighting.directShadowsEnabled","environment.lighting.ambientOcclusionEnabled","environment.lighting.waterReflectionEnabled","environment.background.color"],()=>this._updateRenderParamsHandler(),!0),e.watch("spatialReference",()=>this._resetReferencePosition(!0),!0),e.watch("environment.weather.type",()=>this._updateLightParams(),!0),this.watch("weatherEnabled",()=>this._updateLightParams(),!0),Object(C["a"])(e,"viewingMode",()=>this._resetReferencePosition(!0),!0),Object(C["a"])(e,"environment.lighting.cameraTrackingEnabled",e=>this._updateCameraTracking(e),!0),Object(C["a"])(e,"state.camera",()=>this._cameraHandler(),!0),this.watch("disableQueries",()=>this._cameraHandler())]),this._updateRenderParamsHandler(),this._updateLightParams(),this._cameraHandler(),this.notifyChange("updating"))}disconnectView(){this._viewHandles.removeAll(),this._resetReferencePosition(),this._renderer=Object(w["e"])(this._renderer)}_updateCameraTracking(e){if(this._trackingEnabled=e,e)this._cameraHandler();else{const e=this._view.environment.lighting;e&&(e.positionTimezoneInfo.autoUpdated=!1)}}_lightingDateHandler(e){if(!e)return;const t=this._view.environment.lighting;if(!t.positionTimezoneInfo.autoUpdated){this._preserveAbsoluteDateTime=!0;const i=this._view.spatialReference;if(!Object(L["a"])(i)){const e=this._view.camera.position;if(!this._referencePosMapCoords||!this._referencePosMapCoords.equals(e))return void this._requestReferencePositionUpdate(e)}if(this._preupdateTracking(e),Object(w["l"])(this._referencePosWGS84Comparable)){const e=$r(this._referencePosWGS84Comparable,gn);Object(w["l"])(e)&&(t.autoUpdate(null,e),this._trackingEnabled&&(t.positionTimezoneInfo.autoUpdated=!0))}}this._updateLightParams(e)}_preupdateTracking(e){!this._trackingEnabled&&this._view.environment.lighting.cameraTrackingEnabled&&this._cameraHandler(e)}_cameraHandler(e=null){const t=this._view;if(!t.ready)return;const i=t.stateManager.camera;i&&(this._cameraHandlerClientSide(i,e)||this._cameraHandlerServerSide(i))}_cameraHandlerClientSide(e,t){const i=Object(It["g"])(this._view.spatialReference);if(i&&!Object(L["a"])(this._view.spatialReference))return!1;const r=e.position;return Object(w["k"])(this._referencePosWGS84Comparable)&&(this._referencePosWGS84Comparable=Object(F["f"])()),i?Object(L["u"])(r,this._referencePosWGS84Comparable):Object(Et["z"])(this._referencePosWGS84Comparable,r.longitude,r.latitude,r.z),this.notifyChange("referencePositionWGS84Comparable"),this._autoUpdateTimezone(this._referencePosWGS84Comparable,t)||this._updateLightParams(t),!0}_cameraHandlerServerSide(e){const t=e.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||this._exceedsReferencePosDistThreshold(t))&&this._requestReferencePositionUpdate(t,!0),this._view.mapCoordsHelper&&this._referencePosWGS84Comparable&&(this._referencePosWGS84Comparable[2]=t.z*this._view.mapCoordsHelper.unitInMeters,this._referencePosChanged())}_interactingStationaryHandler(){this._view.stationary&&this._executePendingReferencePositionUpdate()}_updateLightParams(e){const t=this._view,i=t.environment.lighting,r=e||i.date,n=t._stage,a=this._referencePosWGS84Comparable,s=Object(w["l"])(a)?fn:bn;if(Object(w["l"])(a)){const e=this.weatherEnabled?t.environment.weather.type:"disabled";en(r,a,t.state.viewingMode,fn,e)}const o=this._mainLight,c=s.direct;Object(Et["h"])(o.intensity,c.color,c.intensity*Math.PI),Object(Et["n"])(o.direction,c.directionToLightSource);const l=this._ambientLight;Object(Et["h"])(l.intensity,s.ambient.color,s.ambient.intensity);const d=this._moonLight;Object(Et["l"])(d.intensity,vn,yn,s.globalFactor);const h=(1-.5*s.globalFactor)*(1-.4*s.noonFactor*(1-s.globalFactor));Object(Et["h"])(d.intensity,d.intensity,h),Object(Et["n"])(d.direction,c.directionToLightSource),n.renderView.updateLightSources([o,l,d],1-s.noonFactor,s.globalFactor),this._updateRenderParamsHandler()}_autoUpdateTimezone(e,t=null){if(!this._view.environment.lighting.cameraTrackingEnabled||Object(w["k"])(e))return!1;const i=mn;i.setTime((t||this._view.environment.lighting.date).getTime());const r=$r(e,gn);if(Object(w["k"])(r))return!1;let n=this._view.environment.lighting.positionTimezoneInfo;if(n.autoUpdated){if(n.hours===r.hours&&n.minutes===r.minutes&&n.seconds===r.seconds)return!1}else n=r;const a=i.getUTCHours()-(r.hours-n.hours),s=i.getUTCMinutes()-(r.minutes-n.minutes),o=i.getUTCSeconds()-(r.seconds-n.seconds);return i.setUTCHours(a),i.setUTCMinutes(s),i.setUTCSeconds(o),!t&&this._view.environment.lighting.autoUpdate(i,r)}_updateRenderParamsHandler(){const e=this._view._stage;if(!e)return;const t=Object(w["o"])(this._referencePosWGS84Comparable,!0,e=>rn(e[2],this._view.state.viewingMode)),i=this._view.environment.background,r=i instanceof _t?{type:"color",color:Object(Dt["f"])(gt["a"].toUnitRGBA(i.color))}:{type:"color",color:Object(Dt["g"])(0,0,0,1)};e.renderView.setRenderParameters({shadowMap:this._view.environment.lighting.directShadowsEnabled&&t,ssao:this._view.environment.lighting.ambientOcclusionEnabled,waterReflectionEnabled:this._view.environment.lighting.waterReflectionEnabled,background:r})}_resetReferencePosition(e=!1){this._cancelReferencePosUpdates(),this._referencePosMapCoords=null,this._referencePosMapCoordsRequested=null,this._referencePosResetPreserveAbsoluteTime=null,this._referencePosWGS84Comparable=null,this.notifyChange("updating"),e&&this._cameraHandler()}_requestReferencePositionUpdate(e,t=!1){if(!this.disableQueries&&(this._referencePosMapCoordsRequested?this._referencePosMapCoordsRequested.copy(e):this._referencePosMapCoordsRequested=e.clone(),this._referencePosResetPreserveAbsoluteTime=!!t,!this._referencePosUpdateQuery&&!this._referencePosUpdateTimer&&this._view.stationary)){const e=this._referencePosUpdateQuery=Object(S["a"])(this._referencePointUpdateDelay).then(()=>{if(this._referencePosUpdateQuery===e){const t=()=>this._referencePosUpdateQuery!==e;return this._doReferencePositionUpdateQuery(t)}}).catch(e=>{"mapcoordshelper:missing-geometry-service"===e.name&&(this.disableQueries=!0)}).then(()=>{this._referencePosUpdateQuery===e&&(this._referencePosUpdateQuery=null,this._referencePosUpdateTimer||this._executePendingReferencePositionUpdate(),this.notifyChange("updating"))}),t=this._referencePosUpdateTimer=Object(S["a"])(this._referencePointUpdateInterval).then(()=>{this._referencePosUpdateTimer===t&&(this._referencePosUpdateTimer=null,this._referencePosUpdateQuery||this._executePendingReferencePositionUpdate())});this.notifyChange("updating")}}async _doReferencePositionUpdateQuery(e){this._referencePosResetPreserveAbsoluteTime&&(this._preserveAbsoluteDateTime=!1),this._referencePosMapCoords?this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested):this._referencePosMapCoords=this._referencePosMapCoordsRequested.clone(),this._referencePosResetPreserveAbsoluteTime=null,this._referencePosMapCoordsRequested=null;const t=await this._view.mapCoordsHelper.toGeographic(this._referencePosMapCoords);if(!e()&&!isNaN(t[0])&&!isNaN(t[1])){const e=this._referencePosMapCoords.z*this._view.mapCoordsHelper.unitInMeters;this._referencePosWGS84Comparable?(this._referencePosWGS84Comparable[0]=t[0],this._referencePosWGS84Comparable[1]=t[1],this._referencePosWGS84Comparable[2]=e):this._referencePosWGS84Comparable=[t[0],t[1],e],this._referencePosChanged()}}_executePendingReferencePositionUpdate(){const e=this._referencePosMapCoordsRequested;e&&this._requestReferencePositionUpdate(e,this._referencePosResetPreserveAbsoluteTime)}_referencePosChanged(){this._preserveAbsoluteDateTime?this._updateLightParams():this._autoUpdateTimezone(this._referencePosWGS84Comparable)||this._updateLightParams(),this.notifyChange("referencePositionWGS84Comparable")}_exceedsReferencePosDistThreshold(e){if(this._referencePosMapCoords){let t=this._referencePosMapCoords.distance(e);return this._view.mapCoordsHelper&&(t*=this._view.mapCoordsHelper.unitInMeters),t>this._referencePointUpdateDistThreshold}return!0}_cancelReferencePosUpdates(){const e=!!this._referencePosUpdateQuery;return this._referencePosUpdateQuery=null,this._referencePosUpdateTimer=null,e}get test(){const e=this;return{get renderer(){return e._renderer},set referencePointUpdateInterval(t){e._referencePointUpdateInterval=t},set referencePointUpdateDistThreshold(t){e._referencePointUpdateDistThreshold=t},set referencePosUpdateTimer(t){e._referencePosUpdateTimer=t},set referencePointUpdateDelay(t){e._referencePointUpdateDelay=t},set disableWeather(t){e._disableWeather=t}}}};Object(h["a"])([Object(M["b"])({type:Boolean,readOnly:!0})],pn.prototype,"updating",null),Object(h["a"])([Object(M["b"])()],pn.prototype,"disableQueries",void 0),Object(h["a"])([Object(M["b"])()],pn.prototype,"_disableWeather",void 0),Object(h["a"])([Object(M["b"])()],pn.prototype,"weatherEnabled",null),Object(h["a"])([Object(M["b"])()],pn.prototype,"referencePositionWGS84Comparable",null),Object(h["a"])([Object(M["b"])()],pn.prototype,"_renderer",void 0),Object(h["a"])([Object(M["b"])()],pn.prototype,"_referencePosWGS84Comparable",void 0),pn=Object(h["a"])([Object(D["a"])("esri.views.3d.environment.SceneViewEnvironmentManager")],pn);const fn=new an,bn=new an,mn=new Date,gn={hours:0,minutes:0,seconds:0},vn=Object(F["h"])(.22,.22,.33),yn=Object(F["h"])(.22,.22,.22);var On=i("b0ea"),_n=(i("2dd4"),i("f895")),xn=i("d18f");function jn(e,t){return 0!=(e&t)}function wn(e,t,i,r,n,a){0!==e&&(i?(a.min=Math.min(a.min,t),a.max=Math.max(a.max,t)):null!=r?(a.min-=Math.max(0,(t-a.min)*(1-r)),a.max+=Math.max(0,(t-a.max)*(1-r))):n&&(a.min-=Math.max(0,t-a.min-n),a.max+=Math.max(0,t-a.max-n)))}const Sn={selection:0,interactionType:0,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:0};function Tn(e,t,i,r){return t=t||e.viewForward,Object(Et["n"])(r,t),Object(Et["h"])(r,r,Math.sign(Object(Et["k"])(t,i))),r}var Cn=i("de58");function Pn(e,t,i=Sn){const r=An(e,t,i);if(0===r)return!1;const n=e.renderCoordsHelper,a=n.getAltitude(t.eye)+r,s=Tn(t,i.interactionDirection,En(e,t,Math.sign(r),zn),Fn),o=Object(Et["n"])(Ln,t.viewForward),c=n.intersectInfiniteManifold(Object(xn["h"])(t.eye,s),a,Vn);return t.eye=Object(w["l"])(c)?c:n.setAltitude(Vn,a,t.eye),t.center=Object(Cn["a"])(Vn,t.eye,o,t.center),!0}function An(e,t,i=Sn){if(!Mn(e,i))return 0;const r=Dn(e.state.constraints.altitude,In);Rn(e,i,r);const n=e.renderCoordsHelper.getAltitude(t.eye),a=Object(Oe["f"])(n,r.min,r.max)-n;return Math.abs(a)<=1e-6?0:a}function Mn(e,t){const i=e.state.constraints.altitude;return!(!e.state.isGlobal||!i)&&(2!==t.interactionType||!jn(t.selection,1))}function Rn(e,t,i){const r=t.interactionType;if(0===r)return;const{min:n,max:a}=i,{interactionStartCamera:s,interactionFactor:o}=t,c=2===r||1===r,l=An(e,s),d=0===l?0:e.renderCoordsHelper.getAltitude(s.eye);i.min=n,i.max=a,wn(l,d,c,o,.05*d,i)}function En(e,t,i,r){return e.renderCoordsHelper.worldUpAtPosition(t.eye,r),Object(Et["h"])(r,r,i),r}function Dn(e,t){return t.min=e.min,t.max=e.max,t}const In={min:0,max:0},Fn=Object(F["f"])(),zn=Object(F["f"])(),Ln=Object(F["f"])(),Vn=Object(F["f"])();function kn(e,t,i=Sn){if(!e.state.isLocal)return 0;const r=e.state.constraints.distance;if(!e.pointsOfInterest.surfaceOrigin.renderLocation||r===1/0)return 0;qn.min=0,qn.max=r,Bn(e,i,qn);const n=Nn(e,t),a=qn.max-n;return a>=-1e-6?0:a}function Un(e,t,i=Sn){const r=kn(e,t,i);if(0===r)return!1;const n=e.pointsOfInterest.surfaceOrigin,a=Nn(e,t)+r,s=Object(Et["n"])(Hn,t.eye),o=Tn(t,i.interactionDirection,Gn(e,t,Zn),$n);if(!Object(_n["e"])(Object(_n["k"])(n.renderLocation,a),Object(xn["h"])(t.eye,o),Qn))return!1;t.eye=Qn;const c=Object(Et["m"])(Wn,t.eye,s);t.center=Object(Et["i"])(Qn,t.center,c);const l=e.renderCoordsHelper.getAltitude(t.center),d=e.renderCoordsHelper.intersectInfiniteManifold(t.ray,l,Qn);return Object(w["l"])(d)&&(t.center=d),!0}function Bn(e,t,i){const r=t.interactionType;if(0===r)return;const{min:n,max:a}=i,{interactionStartCamera:s,interactionFactor:o}=t,c=1===r||4===r,l=kn(e,s),d=0===l?0:Nn(e,s);i.min=n,i.max=a,wn(l,d,c,o,.05*d,i)}function Nn(e,t){const i=e.pointsOfInterest.surfaceOrigin;return Object(Et["p"])(t.eye,i.renderLocation)}function Gn(e,t,i){const r=e.pointsOfInterest.surfaceOrigin;return Object(Et["y"])(i,t.eye,r.renderLocation)}const qn={min:0,max:0},Hn=Object(F["f"])(),Wn=Object(F["f"])(),$n=Object(F["f"])(),Zn=Object(F["f"])(),Qn=Object(F["f"])();var Xn=i("9250");function Yn(e,t,i,r){return Object(w["l"])(e.renderCoordsHelper.fromRenderCoords(t.eye,na,r))&&Object(V["h"])(i,na)}function Kn(e,t){return e.elevationProvider?Object(w["v"])(e.elevationProvider.getElevation(t[0],t[1],t[2],e.renderCoordsHelper.spatialReference,"ground"),0):0}function Jn(e,t,i,r){const n=e.state.camera.clone();t&&(n.eye=t,n.center=i,n.up=r),ta(e,n.ray,aa)||Object(Et["n"])(aa,n.center);const a=e.state.constraints,s=a.minimumPoiDistance;if(Object(Et["o"])(n.eye,aa)<s){const t=a.collision.enabled;Object(Et["n"])(sa,n.viewForward),Object(Et["h"])(sa,sa,s),t?n.eye=Object(Et["m"])(na,aa,sa):Object(Et["i"])(aa,n.eye,sa);const i=e.renderCoordsHelper,r=i.getAltitude(n.eye),o=a.collision.elevationMargin;t&&r<o&&(Object(Et["m"])(sa,aa,n.eye),n.eye=i.setAltitude(na,o,n.eye),Object(Et["i"])(aa,n.eye,sa))}return n.center=aa,n}function ea(e,t,i){if(!e.state.isGlobal)return!1;const r=Kn(e,t),n=e.stateManager.constraintsManager.nearFarHeuristic,{far:a}=n.compute(t,i,e.renderDataExtent,r,oa),s=a*a;return Object(Et["o"])(t,i)>s}function ta(e,t,i){let r=ra[e.viewingMode];r||(r=Object(Xn["b"])(e.state.viewingMode),r.options.backfacesTerrain=!e.state.isGlobal,r.options.invisibleTerrain=!0,ra[e.viewingMode]=r);const{isGlobal:n}=e.state;return!(!e.sceneIntersectionHelper.intersectRay(t,r,i)||ea(e,t.origin,i))||!(!e.renderCoordsHelper.intersectManifold(t,0,i)||ea(e,t.origin,i))||!!n&&ia(t,i,Object(zt["e"])(e.spatialReference).radius)}function ia(e,t,i){const r=Object(Et["k"])(e.origin,e.origin)-i*i,n=r>0?Math.sqrt(r)/3:1;return Object(Et["h"])(t,e.direction,n/Object(Et["s"])(e.direction)),Object(Et["i"])(t,t,e.origin),!0}const ra={},na=Object(F["f"])(),aa=Object(F["f"])(),sa=Object(F["f"])(),oa={near:0,far:0};function ca(e,t,i=0){const r=e.state.constraints;if(!r.collision.enabled)return!1;const n=Kn(e,t.eye),a=e.renderCoordsHelper.getAltitude(t.eye),s=n+r.collision.elevationMargin;if(a>=s)return!1;const o=Object(Et["s"])(t.eye);if(Object(Et["m"])(la,t.center,t.eye),t.eye=e.renderCoordsHelper.setAltitude(da,s,t.eye),1===i)t.center=Object(Et["i"])(la,t.eye,la);else if(2===i){const e=(o-a+s)/o;t.center=Object(Et["h"])(la,t.center,e)}return!0}const la=Object(F["f"])(),da=Object(F["f"])();var ha=i("6c97");function ua(e,t,i){e.worldUpAtPosition(t,pa),Object(Et["m"])(fa,i,t);const r=Object(Et["s"])(fa);return 0===r?0:Object(Oe["b"])(Object(Et["k"])(fa,pa)/r)}const pa=Object(F["f"])(),fa=Object(F["f"])();function ba(e,t,i=Sn,r=!0){Fa.eyeCenterDistance=0,Fa.requiresTwoSteps=!1;const n=ma(e,t,i,void 0,Fa);if(0===n)return!1;switch(Object(Lt["j"])(Ma),Object(Lt["f"])(Ma,Ma,-n,t.viewRight),i.tiltMode){case 1:Object(Et["t"])(Aa,t.viewForward,Ma),Object(Et["h"])(Aa,Aa,Fa.eyeCenterDistance),t.center=Object(Et["i"])(Ra,t.eye,Aa);break;case 0:Object(Et["m"])(Aa,t.center,t.eye),Object(Et["t"])(Aa,Aa,Ma),t.eye=Object(Et["m"])(Ra,t.center,Aa);break;default:Object(ha["a"])(i.tiltMode)}return t.up=Object(Et["t"])(Ra,t.up,Ma),!Fa.requiresTwoSteps||!r||ba(e,t,i,!1)}function ma(e,t,i=Sn,r=Sn,n){if(!e.state.constraints.tilt)return 0;const a=t.distance,s=e.state.constraints.tilt(a,Da);return Ca(e,i,s),2===r.interactionType&&jn(r.selection,2)&&Pa(e,r.interactionStartCamera,s),1===i.tiltMode||1===r.tiltMode?va(e,t,s,n):ga(e,t,s)}function ga(e,t,i){const r=ua(e.renderCoordsHelper,t.center,t.eye),n=r-Object(Oe["f"])(r,i.min,i.max);return xa(n)?n:0}function va(e,t,i,r){switch(r&&(r.requiresTwoSteps=!1),e.viewingMode){case"global":return Oa(e,t,i,r);case"local":return ya(e,t,i,r);default:return void Object(ha["a"])(e.viewingMode)}}function ya(e,t,i,r){const n=ua(e.renderCoordsHelper,t.center,t.eye),a=Object(Oe["f"])(n,i.min,i.max),s=n-a;if(!xa(s))return 0;if(r){const i=e.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,n=e.renderCoordsHelper.getAltitude(t.eye)-i,s=Math.cos(a);Math.abs(s)>1e-4?r.eyeCenterDistance=n/s:r.eyeCenterDistance=t.distance}return s}function Oa(e,t,i,r){const n=_a(e,t,Ia),a=Object(Oe["f"])(n.tiltAtCenter,i.min,i.max);if(!xa(n.tiltAtCenter-a))return 0;let s,o;return n.centerIsOnSurface?(s=ja(n),o=Sa(n,s)):(s=n.constraints.clampTilt(n.eyeCenterDistance,n.tiltAtCenter),r&&s<Math.PI/2&&(r.requiresTwoSteps=!0,s=Math.PI/2-1e-5),o=Ta(n,s)),r&&(r.eyeCenterDistance=wa(n,s)),o}function _a(e,t,i){const r=e.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,n=r+Object(zt["e"])(e.spatialReference).radius,a=e.renderCoordsHelper.intersectManifold(t.ray,r,Ra);return i.eyeCenterDistance=t.distance,i.centerIsOnSurface=!1,Object(w["l"])(a)?(i.eyeCenterDistance=Object(Et["p"])(t.eye,a),i.tiltAtCenter=ua(e.renderCoordsHelper,a,t.eye),i.centerIsOnSurface=!0):e.state.isLocal?i.tiltAtCenter=ua(e.renderCoordsHelper,t.center,t.eye):(Object(_n["h"])(Object(_n["j"])(n),t.ray,Ra),i.eyeCenterDistance=Object(Et["p"])(t.eye,Ra),i.tiltAtCenter=Object(Oe["b"])(-Object(Et["k"])(t.viewForward,Object(Et["u"])(Ra,Ra)))),i.radius=n,i.eyeRadius=Object(Et["s"])(t.eye),i.constraints=e.state.constraints,i}function xa(e){return Math.abs(e)>1e-9}function ja(e){const{constraints:t,eyeCenterDistance:i,tiltAtCenter:r}=e;let n=r,a=t.clampTilt(i,r);const s=wa(e,a);if(t.clampTilt(s,r)===a)return a;let o=0;for(;o<10&&xa(a-n);){const i=(n+a)/2,r=wa(e,i);xa(t.clampTilt(r,i)-i)?n=i:a=i,o++}return a}function wa(e,t){if(!e.centerIsOnSurface)return e.eyeCenterDistance;const i=Math.PI-Object(Oe["f"])(t,0,Math.PI),r=Object(Oe["d"])(e.radius/e.eyeRadius*Math.sin(i)),n=Math.PI-i-r,a=Math.sin(n)/Math.sin(i);if(e.eyeRadius<e.radius&&a>1){const t=Math.PI-r,n=Math.PI-i-t;return Math.sin(n)/Math.sin(i)*e.eyeRadius}return a*e.eyeRadius}function Sa(e,t){const i=Object(Oe["d"])(e.radius/e.eyeRadius*Math.sin(e.tiltAtCenter)),r=Object(Oe["d"])(e.radius/e.eyeRadius*Math.sin(t));return e.eyeRadius>e.radius?i-r:r-i}function Ta(e,t){return e.tiltAtCenter-Math.PI/2-(t-Math.PI/2)}function Ca(e,t,i){if(0===t.interactionType)return;const{interactionStartCamera:r,interactionFactor:n}=t,{min:a,max:s}=i,o=ma(e,r,Sn,t),c=0===o?0:ua(e.renderCoordsHelper,r.center,r.eye);i.min=a,i.max=s,2===t.interactionType?(jn(t.selection,2)&&Pa(e,r,i),wn(o,c,!0,n,Ea,i)):wn(o,c,!1,n,Ea,i)}function Pa(e,t,i){if(e.state.isLocal)return;const r=e.state.constraints;if(!r.altitude)return;const n=Object(Et["w"])(t.center),a=Math.sqrt(n),s=t.distance,o=Object(zt["e"])(e.spatialReference).radius,c=r.altitude.min+o,l=r.altitude.max+o,d=(c*c-s*s-n)/(-2*a*s),h=(l*l-s*s-n)/(-2*a*s);i.min=Math.max(i.min,Math.min(Math.PI-Object(Oe["b"])(h),i.max)),i.max=Math.min(i.max,Math.PI-Object(Oe["b"])(d))}const Aa=Object(F["f"])(),Ma=Object(Vt["d"])(),Ra=Object(F["f"])(),Ea=Object(Oe["h"])(5),Da={min:0,max:0},Ia={constraints:null,radius:0,eyeRadius:0,centerIsOnSurface:!0,eyeCenterDistance:0,tiltAtCenter:0},Fa={eyeCenterDistance:0,requiresTwoSteps:!1};function za(e){return e}const La=e=>e*e,Va=e=>1-La(1-e),ka=e=>e<.5?La(2*e)/2:(Va(2*(e-.5))+1)/2,Ua=e=>e*e*e,Ba=e=>1-Ua(1-e),Na=e=>e<.5?Ua(2*e)/2:(Ba(2*(e-.5))+1)/2,Ga=e=>e*e*e*e,qa=e=>1-Ga(1-e),Ha=e=>e<.5?Ga(2*e)/2:(qa(2*(e-.5))+1)/2,Wa=e=>e*e*e*e*e,$a=e=>1-Wa(1-e),Za=e=>e<.5?Wa(2*e)/2:($a(2*(e-.5))+1)/2,Qa=e=>1-Math.cos(e*Math.PI/2),Xa=e=>1-Qa(1-e),Ya=e=>e<.5?Qa(2*e)/2:(Xa(2*(e-.5))+1)/2,Ka=e=>2**(10*(e-1)),Ja=e=>1-Ka(1-e),es=e=>e<.5?Ka(2*e)/2:(Ja(2*(e-.5))+1)/2,ts=e=>-(Math.sqrt(1-e*e)-1),is=e=>1-ts(1-e),rs=e=>e<.5?ts(2*e)/2:(is(2*(e-.5))+1)/2;function ns(e){const t=2*(e-Math.sqrt((e-1)*e)),i=t/2/e;return r=>r<i?e*r*r:t*r-t+1}function as(e,t){return(i,r)=>i<t?t*e(i/t,r):1-e((1-i)/(1-t),r)*(1-t)}const ss=as(ns(1),1),os=as(ns(1),0),cs=as(ns(1),.5),ls=as(ns(2),1),ds=as(ns(2),0),hs=as(ns(2),.5),us=as(ns(3),1),ps=as(ns(3),0),fs=as(ns(3),.5),bs=as(ns(4),1),ms=as(ns(4),0),gs=as(ns(4),.5),vs={linear:za,"in-quad":La,"out-quad":Va,"in-out-quad":ka,"in-coast-quad":ss,"out-coast-quad":os,"in-out-coast-quad":cs,"in-cubic":Ua,"out-cubic":Ba,"in-out-cubic":Na,"in-coast-cubic":ls,"out-coast-cubic":ds,"in-out-coast-cubic":hs,"in-quart":Ga,"out-quart":qa,"in-out-quart":Ha,"in-coast-quart":us,"out-coast-quart":ps,"in-out-coast-quart":fs,"in-quint":Wa,"out-quint":$a,"in-out-quint":Za,"in-coast-quint":bs,"out-coast-quint":ms,"in-out-coast-quint":gs,"in-sine":Qa,"out-sine":Xa,"in-out-sine":Ya,"in-expo":Ka,"out-expo":Ja,"in-out-expo":es,"in-circ":ts,"out-circ":is,"in-out-circ":rs};function ys(e,t,i=ws,r=t){let n=!1;r!==t&&r.copyFrom(t),r.computeUp(e.state.viewingMode);for(let o=0;o<Ss;o++){let t=0;for(const a of js)if(jn(i.selection,a.type)){const s=Math.abs(a.error(e,r,i));a.apply(e,r,i)&&(n=!0,t+=s)}if(0===t)break}const a=jn(i.selection,8),s=Os(i.interactionType,e);return a&&ca(e,r,s)&&(n=!0),n&&r.computeUp(e.state.viewingMode),n}function Os(e,t){switch(e){case 4:return 1;case 5:return t.state.isGlobal?2:1;default:return 0}}function _s(e,t){const i="number"==typeof e?e:Object(kt["b"])(e,t),r=Math.min(1,i/150);return Na(r)}function xs(e,t,i){return ma(e,t,i)*t.distance}const js=[{type:1,error:xs,apply:ba},{type:2,error:An,apply:Pn},{type:4,error:kn,apply:Un}],ws={selection:15,interactionType:0,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:0},Ss=5,Ts=Object(F["f"])(),Cs=Object(F["f"])(),Ps=Object(F["f"])(),As=Object(F["f"])(),Ms=Object(F["f"])(),Rs=Object(F["f"])(),Es={upward:Object(F["h"])(0,0,1),forward:Object(F["h"])(0,1,0),sideway:Object(F["h"])(1,0,0)},Ds=Object(Ai["b"])();class Is{constructor(e=1){this.viewingMode=e,this.center=Object(F["f"])(),this.pitch=0,this.yaw=0,this.distance=0,this.lookAtDirection=Object(F["d"])(Es.forward)}pixelsPerPanAtZoom(e){return this.size/2/(this._zoomToPanScale*e)}zoomAtPixelsPerPan(e){return this.size/2/(this._zoomToPanScale*e)}pixelsPerRotateAtZoom(){const e=Math.max(Math.cos(Math.abs(this.pitch)),.5);return this.size/2/e}compareTo(e,t){if(t||(t={pan:0,rotate:0,sourceZoom:0,targetZoom:0}),1===this.viewingMode){const i=(Object(Et["s"])(this.center)+Object(Et["s"])(e.center))/2;t.pan=Object(xe["b"])(this.center,e.center)*i}else t.pan=Object(Et["p"])(this.center,e.center);let i=Math.abs(e.yaw-this.yaw);i>=Math.PI&&(i=2*Math.PI-i);const r=Math.abs(e.pitch-this.pitch);return t.rotate=Math.max(i,r),t.sourceZoom=this.distance,t.targetZoom=e.distance,t}interpolate(e,t,i){1===this.viewingMode?Object(xe["l"])(e.center,t.center,i.pan,this.center):Object(Et["l"])(this.center,e.center,t.center,i.pan),this.distance=Object(Oe["l"])(e.distance,t.distance,i.zoom),this.pitch=Object(Oe["l"])(e.pitch,t.pitch,i.rotate);let r=e.yaw;const n=t.yaw;Math.abs(n-r)>=Math.PI&&(r+=2*(r<n?1:-1)*Math.PI),this.yaw=Object(Oe["l"])(r,n,i.rotate)}copyFrom(e){Object(Et["n"])(this.center,e.center),this.pitch=e.pitch,this.yaw=e.yaw,this.distance=e.distance,Object(Et["n"])(this.lookAtDirection,e.lookAtDirection),this.size=e.size,this.copyFromCommon(e),this.viewingMode=e.viewingMode}copyFromRenderCamera(e){const t=this._lookAtOrientation(e.center,Ds);Object(Et["n"])(this.center,e.center),Object(Et["m"])(As,e.center,e.eye),Object(Et["A"])(As,As,t),Object(Et["A"])(Ms,e.up,t),this.distance=Object(Et["s"])(As),As[0]/=this.distance,As[1]/=this.distance,As[2]/=this.distance,this.pitch=this._eyeUpToPitch(As),this.yaw=this._eyeUpToYaw(As,Ms),this.size=Math.sqrt(e.width*e.width+e.height*e.height),this.copyFromCommon(e)}copyFromCommon(e){this.fov=e.fov,this._zoomToPanScale=Math.atan(.5*this.fov)}copyToRenderCamera(e){const t=this._lookAtOrientation(this.center,Ds);Object(Pi["o"])(t,t),this._axisAngleVec3(Es.sideway,this.pitch-Math.PI/2,Es.forward,As),this._axisAngleVec3(Es.upward,this.yaw,As),this._axisAngleVec3(Es.sideway,this.pitch-Math.PI/2,Es.upward,Ms),this._axisAngleVec3(Es.upward,this.yaw,Ms),Object(Et["h"])(As,As,this.distance),Object(Et["A"])(As,As,t),Object(Et["A"])(Ms,Ms,t),e.center=this.center,e.eye=Object(Et["m"])(As,this.center,As),e.up=Ms}_axisAngleVec3(e,t,i,r=i){const n=Math.cos(t),a=Math.sin(t);return Object(Et["h"])(Ts,i,n),Object(Et["j"])(Cs,e,i),Object(Et["h"])(Cs,Cs,a),Object(Et["h"])(Ps,e,(1-n)*Object(Et["k"])(e,i)),Object(Et["i"])(r,Object(Et["i"])(r,Ts,Cs),Ps)}_lookAtOrientation(e,t=Object(Ai["b"])()){return this._upAtLookAt(e,Ps),Object(Et["j"])(Ts,this.lookAtDirection,Ps),Object(Et["u"])(Ts,Ts),0===Ts[0]&&0===Ts[1]&&0===Ts[2]&&Object(Et["n"])(Ts,Es.sideway),Object(Et["j"])(Cs,Ps,Ts),Object(Et["u"])(Cs,Cs),t[0]=Ts[0],t[1]=Cs[0],t[2]=Ps[0],t[3]=Ts[1],t[4]=Cs[1],t[5]=Ps[1],t[6]=Ts[2],t[7]=Cs[2],t[8]=Ps[2],t}_upAtLookAt(e,t){return 2===this.viewingMode?Object(Et["n"])(t,Es.upward):Object(Et["u"])(t,e)}_eyeUpToPitch(e){return Math.PI-Object(xe["b"])(Es.upward,e)}_eyeUpToYaw(e,t){const i=Rs;return Math.abs(t[2])<.5?(Object(Et["n"])(i,t),e[2]>0&&Object(Et["h"])(i,i,-1)):Object(Et["n"])(i,e),Object(Et["j"])(Cs,i,Es.upward),Object(Et["u"])(Cs,Cs),Object(xe["b"])(Es.sideway,Cs,Es.upward)}}var Fs=i("171c");const zs={desiredScreenFlow:2,minDuration:Object(On["a"])(500),maxDuration:Object(On["a"])(8e3)};class Ls{constructor(e){this.createCamera=e,this.compared={sourceZoom:0,targetZoom:0,pan:0,rotate:0},this.settings={desiredScreenFlow:zs.desiredScreenFlow},this.source=e(),this.target=e()}clone(){const e=new Ls(this.createCamera);return e.copyFrom(this),e}copyFrom(e){this.update(e.source,e.target,e.settings)}update(e,t,i){this.source!==e&&this.source.copyFrom(e),this.target!==t&&this.target.copyFrom(t),this.compared=this.source.compareTo(this.target,this.compared),this.settings.desiredScreenFlow=null!=i.desiredScreenFlow?i.desiredScreenFlow:zs.desiredScreenFlow,this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size,this.halfWindowSize=this.target.size/2}halfWindowPanAtZoom(e){const t=this.target.pixelsPerPanAtZoom(e);return this.halfWindowSize/t}get hasZoom(){return Math.abs(this.compared.sourceZoom-this.compared.targetZoom)>1e-5}get hasPan(){return this.compared.pan>1e-9}get hasRotate(){return this.compared.rotate>1e-9}}class Vs{constructor(){this.segments=[]}get time(){return this.segments.reduce((e,t)=>Object(On["c"])(e+t.time),Object(On["c"])(0))}interpolateComponentsAt(e,t){e=Math.min(Math.max(e,0),1),e*=this.time;let i=0,r=0;const n=this.definition;for(let a=0;a<this.segments.length;a++){const s=this.segments[a],o=s.definition;if(e<=s.time||a===this.segments.length-1){t=this.segmentInterpolateComponentsAt(s,e/s.time,t),n.hasPan?t.pan=(i+o.compared.pan*t.pan)/n.compared.pan:t.pan=1,n.hasRotate?t.rotate=(r+o.compared.rotate*t.rotate)/n.compared.rotate:t.rotate=1;const a=t.zoom*(o.compared.targetZoom-o.compared.sourceZoom)+o.compared.sourceZoom,c=this.segments[0].definition.compared.sourceZoom,l=this.segments[this.segments.length-1].definition.compared.targetZoom;return n.hasZoom?t.zoom=(a-c)/(l-c):t.zoom=1,t}e-=s.time,i+=o.compared.pan,r+=o.compared.rotate}}segmentInterpolateComponentsAt(e,t,i){return e.interpolateComponentsAt(t,i)}}class ks{constructor(e){e&&this.update(e)}get time(){return this._time}update(e){e&&(this.definition?this.definition.copyFrom(e):this.definition=e.clone()),this._updatePrecomputedVariables(),this._updatePixelFlow()}_updatePrecomputedVariables(){const e=this.definition,t=e.compared,i=t.sourceZoom,r=t.targetZoom;this._zoomSign=i>r?1:-1,this._panPixelsAtSource=t.pan*e.source.pixelsPerPanAtZoom(i);const n=(e.source.pixelsPerRotateAtZoom(i)+e.target.pixelsPerRotateAtZoom(r))/2;this._rotatePixels=t.rotate*n}_updatePixelFlow(){const e=this.definition.compared.sourceZoom,t=this.definition.compared.targetZoom,{hasZoom:i,hasPan:r,hasRotate:n}=this.definition;let a=0,s=0;i&&(r&&(a=(t/e-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),n&&(s=this._zoomSign*(Math.log(e/t)/Math.LN2)*this.definition.halfWindowSize/this._rotatePixels)),this._zoomPixelFlow=0,this._panPixelFlow=0,this._rotatePixelFlow=0;const o=this.definition.desiredPixelFlow;if(i&&r&&n){const e=a+s+a*s;this._zoomPixelFlow=a*s/e*o,this._panPixelFlow=s/e*o,this._rotatePixelFlow=a/e*o}else if(i&&r){const e=1+a;this._zoomPixelFlow=a/e*o,this._panPixelFlow=1/e*o}else if(i&&n){const e=1+s;this._zoomPixelFlow=s/e*o,this._rotatePixelFlow=1/e*o}else if(r&&n){const e=this._panPixelsAtSource/this._rotatePixels,t=1+e;this._panPixelFlow=e/t*o,this._rotatePixelFlow=1/t*o}else r?this._panPixelFlow=o:i?this._zoomPixelFlow=o:n&&(this._rotatePixelFlow=o);this._time=n?this.rotateTime:i?this.zoomTime:r?this.panTime:Object(On["c"])(0)}get rotateTime(){return this.definition.hasRotate?Object(On["c"])(this._rotatePixels/this._rotatePixelFlow):Object(On["c"])(0)}get zoomTime(){return this.definition.hasZoom?Object(On["c"])(this._zoomSign*(Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2)*this.definition.halfWindowSize/this._zoomPixelFlow):Object(On["c"])(0)}get panTime(){if(this.definition.hasPan){if(this.definition.hasZoom){const e=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2,t=e*this._panPixelsAtSource;return Object(On["c"])(Math.log(t*(this._zoomPixelFlow/this._panPixelFlow)+1)/(e*this._zoomPixelFlow))}return Object(On["c"])(this._panPixelsAtSource/this._panPixelFlow)}return Object(On["c"])(0)}_interpolateComponentsZoom(e){if(0===e||1===e)return e;if(this.definition.hasZoom){const t=this.definition.compared.sourceZoom,i=this.definition.compared.targetZoom;return(t*(t/i)**-e-t)/(i-t)}return e}_interpolateComponentsPan(e){if(0===e||1===e)return e;if(this.definition.hasPan&&this.definition.hasZoom){const t=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*(this._panPixelFlow*(2**(t*e*this._time)-1))/(t*Math.LN2)}return e}_interpolateComponentsRotate(e){return e}interpolateComponentsAt(e,t){e=Math.min(Math.max(e,0),1);const i=this._interpolateComponentsZoom(e),r=this._interpolateComponentsPan(e),n=this._interpolateComponentsRotate(e);return t?(t.zoom=i,t.pan=r,t.rotate=n):t={zoom:i,pan:r,rotate:n},t}}function Us(e,t,i){const r=t-e.compared.sourceZoom,n=e.halfWindowPanAtZoom(r);return-e.halfWindowSize*(i.ascensionFactor*Math.LN2*e.compared.pan+n)*Math.log(e.compared.sourceZoom/t)/(e.desiredPixelFlow*Math.LN2*n)}function Bs(e,t,i){const r=1/t,n=Math.log(e.compared.sourceZoom*r),a=1/e.desiredPixelFlow,s=1/Math.LN2,o=t-e.compared.sourceZoom,c=1/o,l=(i.ascensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(o))/e.halfWindowPanAtZoom(1);return e.halfWindowSize*r*a*s*c*l-e.halfWindowSize*n*a*s*c+e.halfWindowSize*n*a*s*l/(o*o)}function Ns(e,t,i){const r=t-e.compared.sourceZoom,n=1/r,a=1/t,s=Math.log(e.compared.sourceZoom*a),o=(i.ascensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(r))/e.halfWindowPanAtZoom(1);return e.halfWindowSize*n*(-2*n*a*o+2*n*s+2*a-2*s*o/(r*r)-o/(t*t))/(e.desiredPixelFlow*Math.LN2)}function Gs(e,t){return-e.halfWindowSize*Math.log(e.compared.sourceZoom/t)/(e.desiredPixelFlow*Math.LN2)}function qs(e,t){return e.halfWindowSize/(t*e.desiredPixelFlow*Math.LN2)}function Hs(e,t){return-e.halfWindowSize/(t*t*e.desiredPixelFlow*Math.LN2)}function Ws(e,t,i){return-e.compared.pan*e.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(e.desiredPixelFlow*e.halfWindowPanAtZoom(t))}function $s(e,t,i){return e.compared.pan*e.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(e.desiredPixelFlow*e.halfWindowPanAtZoom(t*t))}function Zs(e,t,i){return-2*e.compared.pan*e.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(e.desiredPixelFlow*e.halfWindowPanAtZoom(t*t*t))}function Qs(e,t,i){return e.halfWindowSize*(-e.halfWindowPanAtZoom(t)-i.descensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(e.compared.targetZoom))*Math.log(t/e.compared.targetZoom)/(e.desiredPixelFlow*Math.LN2*e.halfWindowPanAtZoom(-t+e.compared.targetZoom))}function Xs(e,t,i){const r=Math.log(t/e.compared.targetZoom),n=1/e.desiredPixelFlow,a=1/Math.LN2,s=-t+e.compared.targetZoom,o=1/s,c=(-e.halfWindowPanAtZoom(t)-i.descensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(e.compared.targetZoom))/e.halfWindowPanAtZoom(1);return-e.halfWindowSize*r*n*a*o+e.halfWindowSize*r*n*a*c/(s*s)+e.halfWindowSize*n*a*o*c/t}function Ys(e,t,i){const r=t-e.compared.targetZoom,n=1/r,a=1/t,s=Math.log(t/e.compared.targetZoom),o=(e.halfWindowPanAtZoom(t)+i.descensionFactor*Math.LN2*e.compared.pan-e.halfWindowPanAtZoom(e.compared.targetZoom))/e.halfWindowPanAtZoom(1);return e.halfWindowSize*n*(-2*n*a*o-2*n*s+2*a+2*s*o/(r*r)-o/(t*t))/(e.desiredPixelFlow*Math.LN2)}function Ks(e,t){return e.halfWindowSize*Math.log(t/e.compared.targetZoom)/(e.desiredPixelFlow*Math.LN2)}function Js(e,t){return e.halfWindowSize/(t*e.desiredPixelFlow*Math.LN2)}function eo(e,t){return-e.halfWindowSize/(t*t*e.desiredPixelFlow*Math.LN2)}function to(e){const t=Math.LN2*e.compared.pan,i=e.compared.sourceZoom-e.compared.targetZoom,r=e.halfWindowPanAtZoom(i),n=e.halfWindowSize*Math.log(e.compared.sourceZoom/e.compared.targetZoom)/(e.desiredPixelFlow*Math.LN2*r);return e.compared.sourceZoom<=e.compared.targetZoom?n*(t-r):n*(t+r)}function io(e,t){let i=ro(e,t);const r={ascensionFactor:null!=t.ascensionFactor?t.ascensionFactor:.5,descensionFactor:null!=t.descensionFactor?t.descensionFactor:.5},n=0===r.ascensionFactor,a=0===r.descensionFactor,s=n?Gs:Us,o=n?qs:Bs,c=n?Hs:Ns,l=a?Ks:Qs,d=a?Js:Xs,h=a?eo:Ys,u=t=>s(e,t,r)+Ws(e,t,r)+l(e,t,r),p=t=>o(e,t,r)+$s(e,t,r)+d(e,t,r),f=t=>c(e,t,r)+Zs(e,t,r)+h(e,t,r);let b=u(i);const m=to(e);let g;const v=t.maximumIterations||20,y=null!=t.maximumDistance?t.maximumDistance:1/0;for(g=0;g<v;g++){const t=1e-6,r=(p(i)+t)/f(i);if(isNaN(r)||i>=y&&r<0){if(!isFinite(y))return null;i=y,b=u(i);break}if(i-=r,i<e.compared.sourceZoom||i<e.compared.targetZoom)return null;const n=u(i);if(Math.abs(n-b)/b<=.005)break;b=n}return b>.7*m||i<e.compared.sourceZoom||i<e.compared.targetZoom?null:i}function ro(e,t){const i=Math.max(e.compared.sourceZoom,e.compared.targetZoom),r=e.source.zoomAtPixelsPerPan(e.desiredPixelFlow/e.compared.pan)/2;return r<i?null!=t.maximumDistance?i+(t.maximumDistance-i)/2:1.5*i:t.maximumDistance?Math.min(t.maximumDistance,r):r}class no extends Vs{constructor(e,t){super(),this._preallocSegments=[new ks,new ks,new ks],this.update(e,t)}update(e,t){if(!e)return;this.definition?this.definition.copyFrom(e):this.definition=e.clone();let i=null;t&&t.apex&&(i=io(e,t.apex)),this.segments.length=0,this._ascensionSegment=null,this._descensionSegment=null,null==i?this._updateWithoutApex():this._updateWithApex(i,t.apex)}segmentInterpolateComponentsAt(e,t,i){return i=e.interpolateComponentsAt(t,i),e===this._ascensionSegment?i.zoom=Va(i.zoom):e===this._descensionSegment&&(i.zoom=La(i.zoom)),i}_updateWithApex(e,t){const[i,r,n]=this._preallocSegments,a=null!=t.ascensionFactor?t.ascensionFactor:.5,s=Math.min(1-a,null!=t.ascensionFactor?t.descensionFactor:.5),o=1-a-s;i.definition?i.definition.copyFrom(this.definition):i.definition=this.definition.clone(),i.definition.compared.targetZoom=e,i.definition.compared.pan=this.definition.compared.pan*a,i.definition.compared.rotate=this.definition.compared.rotate*a,i.update(),this._ascensionSegment=i,this.segments.push(i),o>0&&(r.definition?r.definition.copyFrom(this.definition):r.definition=this.definition.clone(),r.definition.copyFrom(this.definition),r.definition.compared.sourceZoom=e,r.definition.compared.targetZoom=e,r.definition.compared.pan=this.definition.compared.pan*o,r.definition.compared.rotate=this.definition.compared.rotate*o,r.update(),this.segments.push(r)),n.definition?n.definition.copyFrom(this.definition):n.definition=this.definition.clone(),n.definition.compared.sourceZoom=e,n.definition.compared.pan=this.definition.compared.pan*s,n.definition.compared.rotate=this.definition.compared.rotate*s,n.update(),this._descensionSegment=n,this.segments.push(n)}_updateWithoutApex(){const[e]=this._preallocSegments;e.update(this.definition),this.segments.push(e)}}const ao={zoom:0,pan:0,rotate:0};class so{constructor(e){this.createCamera=e,this._time=Object(On["a"])(0),this.definition=new Ls(e),this.path=new no}get time(){return this._time}update(e,t,i){this.definition.update(e,t,i),this.path.update(this.definition,i),this._time=this._applyTimeSettings(Object(On["b"])(this.path.time),i),this._easing=i.easing?i.easing:this._time>=1e3?cs:Ja}cameraAt(e,t){t=t||this.createCamera(),e=Math.min(Math.max(0,e),1),e=this._normalizedEasing(e);const i=this.path.interpolateComponentsAt(e,ao);return t.interpolate(this.definition.source,this.definition.target,i),t}_normalizedEasing(e){const t=this._easing(0,this._time),i=this._easing(1,this._time);return(this._easing(e,this._time)-t)/(i-t)}_applyTimeSettings(e,t){const i=null!=t.speedFactor?t.speedFactor:1;null!=t.duration?e=t.duration:null!=t.speedFactor&&(e=Object(On["a"])(e/i));const r=null!=t.minDuration?t.minDuration:zs.minDuration/i,n=null!=t.maxDuration?t.maxDuration:zs.maxDuration/i;return Object(On["a"])(Math.min(Math.max(r,e),n))}}const oo=Object(F["f"])();class co{constructor(e){this.currentTime=Object(On["a"])(0),this._animation=new so(()=>new Is(e)),this._current=new Is(e)}get finished(){return this.currentTime>=this._animation.time}get time(){return this._animation.time}update(e,t,i){const r=this._animation.definition.source,n=this._animation.definition.target,a=Object(Et["m"])(oo,t.center,e.center),s=Object(Et["s"])(a);s>=1e-5?(a[0]/=s,a[1]/=s,a[2]/=s):(a[0]=0,a[1]=1,a[0]=0),Object(Et["n"])(r.lookAtDirection,a),Object(Et["n"])(n.lookAtDirection,a),r.copyFromRenderCamera(e),n.copyFromRenderCamera(t),this._current.copyFrom(r),this._animation.update(r,n,i),this.currentTime=Object(On["a"])(0),e.almostEquals(t)&&(this.currentTime=this._animation.time)}cameraAt(e,t){return this._animation.cameraAt(e,this._current),t=t||new Fs["a"],this._current.copyToRenderCamera(t),t}step(e,t){return this.finished||(this.currentTime=Object(On["a"])(this.currentTime+Object(On["b"])(e)),this.currentTime>=this.time&&(this.currentTime=this.time)),this.cameraAt(this.currentTime/this.time,t)}}var lo;!function(e){e.Ready="ready",e.Rejected="rejected",e.Running="running",e.Stopped="stopped",e.Finished="finished"}(lo||(lo={}));let ho=class extends W["a"]{constructor(){super(...arguments),this.state=lo.Ready}get active(){return this.state===lo.Running}get isInteractive(){return!1}get canStop(){return!1}stopController(){return!!this.canStop&&(this.state=lo.Stopped,!0)}finishController(){this.state=lo.Finished}get steppingFinished(){return!1}};Object(h["a"])([Object(M["b"])({readOnly:!0})],ho.prototype,"active",null),Object(h["a"])([Object(M["b"])()],ho.prototype,"state",void 0),ho=Object(h["a"])([Object(D["a"])("esri.views.3d.state.controllers.CameraController")],ho);let uo=class extends ho{get canStop(){return!0}set asyncResult(e){this._asyncResult&&(this._asyncResult.reject(Object(S["e"])()),this._asyncResult=null),this.state===lo.Finished||this.state===lo.Stopped?this.state===lo.Finished?e.resolve():e.reject(Object(S["e"])()):this._asyncResult=e}get asyncResult(){return this._asyncResult}onControllerStart(){this.state=lo.Running,Object(w["l"])(this.viewAnimation)&&this.viewAnimation.when(()=>this.updateStateFromViewAnimation(),()=>this.updateStateFromViewAnimation())}updateStateFromViewAnimation(){!Object(w["l"])(this.viewAnimation)||this.state!==lo.Ready&&this.state!==lo.Running||(this.viewAnimation.state===oe["a"].State.FINISHED?this.finish():this.viewAnimation.state===oe["a"].State.STOPPED&&(this.state=lo.Stopped))}onControllerEnd(){Object(w["l"])(this.viewAnimation)&&!this.viewAnimation.done&&(this.state===lo.Finished?this.viewAnimation.finish():this.state===lo.Stopped&&this.viewAnimation.stop()),this._asyncResult&&(this.state===lo.Finished?this._asyncResult.resolve():this._asyncResult.reject(Object(S["e"])()))}finish(){this.finishController()}};uo=Object(h["a"])([Object(D["a"])("esri.views.3d.state.controllers.AnimationController")],uo);let po=class extends uo{constructor(e){super(e),this.view=null,this.mode="interaction",this.hasTarget=!1}get intersectionHelper(){return this.view.sceneIntersectionHelper}initialize(){this.animation=new co(this.view.state.viewingMode),this.viewAnimation="interaction"===this.mode?null:new oe["a"]}get isInteractive(){return"interaction"===this.mode}begin(e,t){this.hasTarget=!0;const i=this.animationSettings(t);fo.copyFrom(this.view.state.camera);const r=Object(Xn["b"])(this.view.state.viewingMode);this.intersectionHelper.intersectRay(fo.ray,r,bo)&&(fo.center=bo),this.animation.update(fo,e,i),this.animation.finished&&this.finish()}finish(){this.animation.currentTime=this.animation.time,super.finish()}get steppingFinished(){return this.hasTarget&&this.animation.finished}stepController(e,t){this.hasTarget&&this.animation.step(e,t)}onControllerEnd(e){this.hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,e),this.animation.currentTime=this.animation.time),super.onControllerEnd(e)}animationSettings(e={}){return{apex:{maximumDistance:this.view.state.constraints.clampAltitude(1/0)/6,ascensionFactor:void 0,descensionFactor:void 0},...e,easing:"string"==typeof e.easing?vs[e.easing]:e.easing}}};Object(h["a"])([Object(M["b"])({constructOnly:!0})],po.prototype,"view",void 0),Object(h["a"])([Object(M["b"])({constructOnly:!0})],po.prototype,"mode",void 0),po=Object(h["a"])([Object(D["a"])("esri.views.3d.state.controllers.PointToPointAnimationController")],po);const fo=new Fs["a"],bo=Object(F["f"])();var mo=i("7289"),go=i("9990");function vo(e,t,i,r){const n=Object(go["d"])(t,i,yo);return Object(_n["e"])(e,n,r)}const yo=Object(xn["c"])(),Oo=30,_o=[1,3e8],xo=70;function jo(e,t,i){return i[0]=t[0]/(e.fullWidth/e.pixelRatio),i[1]=t[1]/(e.fullHeight/e.pixelRatio),i}function wo(e){for(;e>Math.PI;)e-=2*Math.PI;for(;e<-Math.PI;)e+=2*Math.PI;return e}function So(e,t,i){const r=di["a"].get();Object(Lt["j"])(r),Object(Lt["f"])(r,r,i[3],bi(i)),Object(Et["m"])(Oc,e.eye,t),Object(Et["t"])(Oc,Oc,r),e.eye=Object(Et["i"])(Oc,Oc,t),Object(Et["m"])(Oc,e.center,t),Object(Et["t"])(Oc,Oc,r),e.center=Object(Et["i"])(Oc,Oc,t),e.up=Object(Et["t"])(Oc,e.up,r)}function To(e,t,i,r){return Object(mo["n"])(e,Object(go["c"])(t,i,Sc),r)}function Co(e,t,i,r){return Object(mo["n"])(e,Object(go["d"])(t,i,Sc),r)}function Po(e,t,i,r){const n=di["d"].get();let a=1-i;Object(Et["m"])(n,t,e.eye);const s=Object(Et["s"])(n);let o=s*(1-a);a>=0&&o<r&&(o=r,a=-(o-s)/s),Math.abs(s-o)<1e-6||(Object(Et["h"])(n,n,a),e.eye=Object(Et["i"])(Oc,e.eye,n),e.center=Object(Et["l"])(Oc,e.center,t,a))}function Ao(e,t,i){t.getScreenCenter(Mo),vo(e,t,Mo,Oc)&&(t.center=Oc);const r=t.distance,n=r*i;if(Math.abs(r-n)<1e-6)return;const a=Object(Et["h"])(di["d"].get(),t.viewForward,n);t.eye=Object(Et["m"])(Oc,t.center,a)}const Mo=Object(A["g"])();function Ro(e,t){Object(Et["z"])(t,0,0,0);for(const i of e)Object(Et["i"])(t,t,i);Object(Et["h"])(t,t,1/e.length)}function Eo(e,t,i,r){return Math.sin(e/Object(Et["s"])(t))*(i+r.radius)}function Do(e,t,i,r){return Eo(Math.PI/2,t,i,r)+(e-Math.PI/2)}var Io;!function(e){e[e.Vertical=0]="Vertical",e[e.Horizontal=1]="Horizontal"}(Io||(Io={}));const Fo={Elevation:3e4,Angle:Object(Oe["h"])(6)},zo={Pole:.95,Angle:Object(Oe["h"])(18),Tilt:45},Lo=Object(Oe["h"])(80);function Vo(e,t,i,r,n){const a=Object(F["f"])(),s=Object(_n["c"])();let o=!0,c=!0;return e.intersectScreen(i,a)?s[3]=Object(Et["s"])(a):(c=!1,t.aboveGround?s[3]=Math.max(Object(Et["s"])(t.center),.9*n.radius):s[3]=Object(Et["s"])(t.eye)-t.relativeElevation,r?No(s,t,i,a):o=vo(s,t,i,a)),{sphere:s,scenePickPoint:o?a:null,hasGeometryIntersection:c}}function ko(e,t,i,r){return Object(Et["s"])(e.eye)-r.radius>Fo.Elevation?Io.Horizontal:i?(Object(go["d"])(e,t,Tc),-Math.sign(e.relativeElevation)*(.5*Math.PI+Object(li["a"])(e.eye,Tc.direction))<Fo.Angle?Io.Vertical:Io.Horizontal):Io.Vertical}function Uo(e,t,i){Object(Et["m"])(Bo,i,t),e.eye=Object(Et["m"])(Oc,e.eye,Bo),e.center=Object(Et["m"])(Oc,e.center,Bo)}const Bo=Object(F["f"])();function No(e,t,i,r){const n=Object(go["d"])(t,i,Sc);return!Object(w["k"])(n)&&(Object(_n["h"])(e,n,Go),Object(_n["e"])(e,n,r)?!(Object(Et["o"])(Go,n.origin)<Object(Et["o"])(r,n.origin))||(Object(Et["n"])(r,Go),!1):(Object(Et["m"])(qo,t.eye,t.center),Object(Et["u"])(qo,qo),Object(mo["f"])(qo,-Object(Et["k"])(Object(Et["u"])(qo,qo),Go),Ho),Object(mo["n"])(Ho,n,r),!1))}const Go=Object(F["f"])(),qo=Object(F["f"])(),Ho=Object(mo["d"])();function Wo(e,t,i,r,n,a){let s;if(Object(Et["j"])(jc,e,t),Object(Et["m"])(_c,e,t),Object(Et["s"])(e)<=n||!r.aboveGround){Object(Et["j"])(i,_c,r.eye);const o=Object(Et["k"])(e,t)/(Object(Et["s"])(e)*Object(Et["s"])(t)),c=Math.cos(Object(Oe["f"])(xe["f"].normalize(Object(Oe["h"])(a)),0,Lo));s=-Object(Oe["b"])(o)-Math.max(0,Object(Et["s"])(t)-n)/(c*n)}else Object(Et["m"])($o,r.eye,r.center),Object(Et["j"])(i,_c,$o),s=-Object(Et["s"])(_c)/n;return Object(Et["u"])(i,i),Object(Et["h"])(i,i,Object(Et["s"])(jc)),s}const $o=Object(F["f"])();function Zo(e,t,i,r){let n,a;const s=Math.cos(Object(Oe["f"])(xe["f"].normalize(Object(Oe["h"])(r)),0,Lo));return n=t>i?-(t-i)/(s*i):t<-i?Math.PI-(t+i)/(s*i):Object(Oe["b"])(t/i),a=e>i?-(e-i)/(s*i):e<-i?Math.PI-(e+i)/(s*i):Object(Oe["b"])(e/i),(a-n)*i}function Qo(e,t,i,r,n,a,s,o,c,l){const d=Zo(e[2],t[2],s[3],c),h=l?Zo(e[0],t[0],s[3],180):t[0]-e[0],u=Math.sin(o)*h-Math.cos(o)*d,p=Math.cos(o)*h+Math.sin(o)*d;Object(Et["u"])(Oc,n);const f=l?u/Math.sqrt(Math.abs(s[3]**2-Object(Et["k"])(i,Oc)**2)):u/s[3],b=p/Math.sqrt(Math.abs(s[3]**2-Object(Et["k"])(i,r)**2));Object(kt["s"])(a,f,b)}function Xo(e,t,i,r,n,a,s,o,c,l){Object(Et["j"])(jc,e,t),Object(U["c"])(a.up,a.eye,lc,dc,hc),Object(U["c"])([0,0,1],a.eye,sc,oc,cc),Object(Et["n"])(i,oc),Object(Et["n"])(r,sc),Object(Et["u"])(i,i),Object(Et["h"])(i,i,Object(Et["s"])(jc)),Object(U["o"])(e,Object(Et["u"])(dc,dc),Object(Et["u"])(hc,hc),Object(Et["u"])(lc,lc),uc),Object(U["o"])(t,dc,hc,lc,pc),Qo(uc,pc,e,sc,oc,n,s,o,c,l)}function Yo(e,t,i,r,n,a,s){Object(Lt["j"])(mc),Object(Lt["j"])(gc),Object(Lt["j"])(vc),Object(Lt["f"])(mc,mc,n,r),Object(Lt["f"])(gc,gc,s,a),Object(Lt["n"])(vc,mc,gc),Object(Et["m"])(t,e,i),Object(Et["t"])(t,t,vc),Object(Et["i"])(t,t,i)}function Ko(e,t,i,r,n,a){Object(Lt["j"])(mc),Object(Lt["j"])(gc),Object(Lt["j"])(vc),Object(Lt["f"])(mc,mc,r,i),Object(Lt["f"])(gc,gc,a,n),Object(Lt["n"])(vc,mc,gc),Object(Et["m"])(Oc,e.eye,t),Object(Et["t"])(Oc,Oc,vc),e.eye=Object(Et["i"])(Oc,Oc,t),Object(Et["m"])(Oc,e.center,t),Object(Et["t"])(Oc,Oc,vc),e.center=Object(Et["i"])(Oc,Oc,t),Object(Et["m"])(Oc,e.up,t),Object(Et["t"])(Oc,Oc,vc),e.up=Object(Et["i"])(Oc,Oc,t)}function Jo(e,t,i,r,n,a,s=zo.Pole,o=zo.Angle){const c=Math.abs(r)>Math.PI-o||Math.abs(r)<o,l=Math.abs(e[2])<i*s||Math.abs(t)>i;return!!(c&&l&&a.aboveGround&&n<zo.Tilt)}function ec(e,t,i,r,n,a){if(a)fi(i,r,bc),So(t,e,bc);else{const a=Wo(i,r,wc,t,e[3],n);So(t,e,ui(wc,a))}}function tc(e,t,i,r,n,a,s){const o=s?20:1,c=1e-12;let l,d;Object(Et["n"])(yc,r),xc.copyFrom(t);for(let h=0;h<o&&Object(Et["o"])(i,yc)>c&&(l=Object(Et["o"])(i,yc),Xo(i,yc,oc,sc,fc,xc,e,n,a,s),Ko(xc,e,sc,fc[1],oc,fc[0]),Yo(yc,yc,e,sc,fc[1],oc,fc[0]),d=Object(Et["o"])(i,yc),d<l||0===h);h++)t.copyFrom(xc)}function ic(e,t,i,r,n,a,s){Jo(i,Object(Et["k"])(t.up,i),e[3],-xe["f"].normalize(Object(Oe["h"])(n)),a,t,zo.Pole,zo.Angle)?tc(e,t,i,r,-xe["f"].normalize(Object(Oe["h"])(n)),a,s):ec(e,t,i,r,a,s)}function rc(e,t,i,r,n,a){const{eye:s}=e;Object(U["c"])([0,0,1],s,sc,oc,cc);const o=t.translation[0]*i.pan,c="zoom"===n.mode?0:t.translation[1]*i.pan,l=Math.max(Math.sqrt(Math.abs(1-Object(Et["k"])(e.center,sc)**2/Object(Et["s"])(e.center)**2)),.5),d=(Math.sin(a)*c+Math.cos(a)*o)/l,h=-Math.cos(a)*c+Math.sin(a)*o;switch(Object(Lt["f"])(r.pan.matrix,r.pan.matrix,d,sc),r.pan.enabled=!0,n.mode){case"pan":Object(Lt["f"])(r.pan.matrix,r.pan.matrix,h,oc),r.pan.enabled=!0;break;case"zoom":r.zoom=-t.translation[1]*i.zoom}}function nc(e,t,i,r,n){const{eye:a,viewRight:s}=e,o=Object(Et["j"])(di["d"].get(),s,a),c=t.translation[0]*i.pan;switch(0!==c&&(Object(Lt["f"])(r.pan.matrix,r.pan.matrix,-c,o),r.pan.enabled=!0),n.mode){case"pan":{const e=t.translation[1]*i.pan;0!==e&&(Object(Lt["f"])(r.pan.matrix,r.pan.matrix,e,s),r.pan.enabled=!0);break}case"zoom":r.zoom=-t.translation[1]*i.zoom}}function ac(e,t,i,r,n,a,s,o,c){Jo(e.center,Object(Et["k"])(e.up,e.center),Object(Et["s"])(e.center),-xe["f"].normalize(Object(Oe["h"])(a)),s,t)?rc(t,i,r,o,c,-xe["f"].normalize(Object(Oe["h"])(n))):nc(t,i,r,o,c)}const sc=Object(F["f"])(),oc=Object(F["f"])(),cc=Object(F["f"])(),lc=Object(F["f"])(),dc=Object(F["f"])(),hc=Object(F["f"])(),uc=Object(F["f"])(),pc=Object(F["f"])(),fc=Object(Ut["b"])(),bc=hi(),mc=Object(Vt["d"])(),gc=Object(Vt["d"])(),vc=Object(Vt["d"])(),yc=Object(F["f"])(),Oc=Object(F["f"])(),_c=Object(F["f"])(),xc=new Fs["a"],jc=Object(F["f"])(),wc=Object(F["f"])(),Sc={origin:Object(F["f"])(),direction:Object(F["f"])()},Tc={origin:Object(F["f"])(),direction:Object(F["f"])()},Cc=.6,Pc=4,Ac=12,Mc=60,Rc=20;let Ec=class extends po{constructor(){super(...arguments),this.zoomLocation=Object(F["f"])(),this.tmpCamera=new Fs["a"],this.tmpViewDir=Object(F["f"])(),this.tmpRayDir={origin:Object(F["f"])(),direction:Object(F["f"])()},this.targetOnSphere=Object(F["f"])(),this.tmpCenter=Object(F["f"])(),this.constraintOptions={selection:7,interactionType:1,interactionFactor:null,interactionStartCamera:new Fs["a"],interactionDirection:null,tiltMode:0},this.sphere=Object(_n["c"])()}initialize(){this.intersector=Object(Xn["b"])(this.view.state.viewingMode)}zoomStep(e,t){if(!this.active)return;const i=this.view.state,{interactionStartCamera:r}=this.constraintOptions;this.animation.finished?r.copyFrom(i.camera):this.animation.cameraAt(1,r);let n=!1,a=!1;this.intersectionHelper.intersectScreen(t,this.zoomLocation)&&(n=e>0,a=!0),this.tmpCamera.copyFrom(i.camera),n?this.intersectionHelper.intersectRay(this.tmpCamera.ray,this.intersector,this.tmpCenter)&&(this.tmpCamera.center=this.tmpCenter):this.intersectionHelper.intersectRay(this.tmpCamera.ray,this.intersector,this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:Object(Et["n"])(this.zoomLocation,this.tmpCamera.center),this.updateCamera(this.tmpCamera,e,this.zoomLocation,t,a),this.begin(this.tmpCamera)}animationSettings(){return{apex:null,duration:Object(On["a"])(600),easing:Ja}}updateCamera(e,t,i,r,n){const a=Object(zt["e"])(this.view.spatialReference);if(ko(e,r,n,a)===Io.Horizontal||Object(_["a"])("disable-feature:context-navigation")){let n=Cc**t;this.sphere[3]=Object(Et["s"])(i),Object(Et["m"])(this.tmpViewDir,e.center,e.eye);const a=Object(Et["s"])(this.tmpViewDir);let s=a*n;if(n<=1&&s<Pc&&(s=Pc,n=s/a),Math.abs(a-s)<1e-6)return;const o=Object(Et["s"])(e.center);if(this.sphere[3]!==o){const t=this.sphere[3]+n*(o-this.sphere[3]);e.center=Object(Et["h"])(Dc,e.center,t/o)}Object(Et["h"])(this.tmpViewDir,this.tmpViewDir,-n),e.eye=Object(Et["i"])(Dc,e.center,this.tmpViewDir),ys(this.view,e,this.constraintOptions),Object(Et["o"])(i,e.center)>1e-12&&vo(this.sphere,e,r,this.targetOnSphere)&&ic(this.sphere,e,i,this.targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0)}else{let n=Cc**Math.abs(t);const a=t>0?1:-1;let s;Object(go["d"])(e,r,this.tmpRayDir),Object(Et["u"])(this.tmpRayDir.direction,this.tmpRayDir.direction),this.view.camera.position.hasZ&&(s=Math.abs(this.view.camera.position.z));let o=Math.max(Ac*s,Rc);const c=this.view._stage.renderView.getMinimalDepthForArea(null,r[0],r[1],this.view.state.camera,Mc);o=o>c?c:o,Object(Et["h"])(this.tmpRayDir.direction,this.tmpRayDir.direction,o),Object(Et["i"])(i,this.tmpRayDir.origin,this.tmpRayDir.direction);let l=o*n;const d=Math.max(Pc,1.01*e.nearFar[0]);if(t>0&&l<d&&(l=d,n=l/o),Math.abs(o-l)<1e-6)return;Object(Et["h"])(this.tmpRayDir.direction,this.tmpRayDir.direction,a*(1-n)),e.eye=Object(Et["i"])(Dc,e.eye,this.tmpRayDir.direction),e.center=Object(Et["i"])(Dc,e.center,this.tmpRayDir.direction)}ca(this.view,e)}};Ec=Object(h["a"])([Object(D["a"])("esri.views.3d.state.controllers.global.ZoomStepController")],Ec);const Dc=Object(F["f"])();var Ic=i("1091");const Fc=.6,zc=4,Lc=60,Vc=14,kc=20;let Uc=class extends po{constructor(){super(...arguments),this.zoomLocation=Object(F["f"])(),this.tmpCamera=new Fs["a"],this.tmpRayDir=Object(F["f"])(),this.tmpCenter=Object(F["f"])(),this.constraintOptions={selection:15,interactionType:1,interactionFactor:null,interactionStartCamera:new Fs["a"],interactionDirection:null,tiltMode:0}}zoomStep(e,t){if(!this.active)return;const i=this.view.state,{interactionStartCamera:r}=this.constraintOptions;this.animation.finished?r.copyFrom(i.camera):this.animation.cameraAt(1,r),this.tmpCamera.copyFrom(i.camera);const n=Object(Xn["b"])(this.view.state.viewingMode);e>0?(this.intersectionHelper.intersectScreenFreePointFallback(t,this.zoomLocation),this.intersectionHelper.intersectRay(this.tmpCamera.ray,n,this.tmpCenter)&&(this.tmpCamera.center=this.tmpCenter)):this.intersectionHelper.intersectRay(this.tmpCamera.ray,n,this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:Object(Et["n"])(this.zoomLocation,this.tmpCamera.center);const a=Fc**e;if(!Object(Ic["a"])()){let e=this.view._stage.renderView.getMinimalDepthForArea(this.view.getVoxelWasmPerSceneView(),t[0],t[1],this.view.state.camera,Lc);const i=Math.max(Vc*Math.abs(this.view.camera.position.z),kc);if(e=e?Math.min(e,i):i,e){const t=Object(F["f"])();Object(Et["m"])(t,this.zoomLocation,this.tmpCamera.eye),e<Object(Et["s"])(t)&&(Object(Et["u"])(t,t),Object(Et["i"])(this.zoomLocation,this.tmpCamera.eye,Object(Et["h"])(t,t,e)))}}this.updateCamera(this.tmpCamera,a,this.zoomLocation),this.begin(this.tmpCamera)}animationSettings(){return{apex:null,duration:Object(On["a"])(600),easing:Ja}}updateCamera(e,t,i){Object(Et["m"])(this.tmpRayDir,i,e.eye);const r=Object(Et["s"])(this.tmpRayDir);let n=r*t;const a=t<=1,s=Math.max(zc,1.01*e.nearFar[0]);a&&n<s&&(n=s,t=n/r),Math.abs(r-n)<1e-6||(Object(Et["h"])(this.tmpRayDir,this.tmpRayDir,t),e.eye=Object(Et["m"])(Bc,i,this.tmpRayDir),e.center=Object(Et["l"])(Bc,e.center,i,1-t),ys(this.view,e,this.constraintOptions))}};Uc=Object(h["a"])([Object(D["a"])("esri.views.3d.state.controllers.local.ZoomStepController")],Uc);const Bc=Object(F["f"])();var Nc=i("7164"),Gc=i("1bf0");class qc extends Nc["a"]{constructor(e,t){super(!0),this.view=e,this.registerIncoming("double-click",t,e=>this.handleDoubleClick(e))}handleDoubleClick(e){const t=e.data;if(Object(Gc["b"])(t,"primary")){const i=this.view.state.isGlobal?new Ec({view:this.view,mode:"animation"}):new Uc({view:this.view,mode:"animation"});this.view.state.switchCameraController(i),i.zoomStep(Math.log(.5)/Math.log(.6),Object(A["g"])(t.x,t.y)),e.stopPropagation()}}}let Hc=class extends ho{constructor(){super(...arguments),this.startCamera=new Fs["a"],this.currentCamera=new Fs["a"]}get isInteractive(){return!0}stepController(e,t){t.copyViewFrom(this.currentCamera),this.currentCamera.copyFrom(t)}onControllerStart(e){this.state=lo.Running,this.startCamera.copyFrom(e),this.currentCamera.copyFrom(e)}onControllerEnd(e){e.copyViewFrom(this.currentCamera)}};Hc=Object(h["a"])([Object(D["a"])("esri.views.3d.state.controllers.InteractiveController")],Hc);const Wc=7,$c=90;let Zc=class extends Hc{constructor(e){super(e),this.view=null,this.pivot=0,this.lastPoint=Object(Ut["b"])(),this.tmpWorldUp=Object(F["f"])(),this.tmpViewDir=Object(F["f"])(),this.tmpRotCurPoint=Object(Ut["b"])(),this.tmpTransf=Object(Vt["d"])(),this.tmpAxis=Object(F["f"])(),this.tmpPivotPoint=Object(F["f"])(),this.pivotPos=Object(F["f"])(),this.constraintOptions={selection:15,interactionType:2,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:0}}get intersectionHelper(){return this.view.sceneIntersectionHelper}initialize(){this.rotScale=0===this.pivot?3:1.5}begin(e){if(this.active){switch(this.pivot){case 1:Object(Et["n"])(this.pivotPos,this.startCamera.eye),this.constraintOptions.interactionType=3,this.constraintOptions.tiltMode=1,this.constraintOptions.selection=0;break;case 0:this.intersectionHelper.intersectRayFreePointFallback(this.startCamera.ray,this.pivotPos)||Object(Et["n"])(this.pivotPos,this.startCamera.center),Object(_["a"])("disable-feature:context-navigation")||this.constrainPivotPoint(e),this.startCamera.center=this.pivotPos,this.constraintOptions.interactionType=2,this.constraintOptions.tiltMode=0,this.constraintOptions.selection=11}this.constraintOptions.interactionStartCamera=this.startCamera,jo(this.startCamera,e,this.lastPoint)}}constrainPivotPoint(e){const t=this.startCamera,i=Object(F["f"])();Object(Et["m"])(i,this.pivotPos,t.eye);let r=Object(Et["s"])(i);this.view.camera.position.hasZ&&(r=Math.min(r,Wc*Math.abs(this.view.camera.position.z)));const n=Object(zt["e"])(this.view.spatialReference),a=Object(A["g"])(t.width/t.pixelRatio*.5,t.height/t.pixelRatio*.5),s=ko(this.startCamera,a,!0,n);let o=this.view._stage.renderView.getMinimalDepthForArea(this.view.getVoxelWasmPerSceneView(),t.fullWidth/t.pixelRatio*.5,t.fullHeight/t.pixelRatio*.5,t,2.5*$c,$c),c=this.view._stage.renderView.getMinimalDepthForArea(this.view.getVoxelWasmPerSceneView(),e[0],e[1],t,$c);void 0===o&&void 0===c||(o=void 0===o?c:o,c=void 0===c||s===Io.Horizontal?o:c,r=o>c?c:o),Object(Et["u"])(i,i),Object(Et["n"])(this.pivotPos,Object(Et["i"])(this.tmpPivotPoint,t.eye,Object(Et["h"])(this.tmpPivotPoint,i,r)))}update(e){if(this.active){switch(this.pivot){case 1:this.currentCamera.center=this.applyRotation(this.currentCamera,e,this.currentCamera.center,this.pivotPos);break;case 0:this.currentCamera.center=this.pivotPos,this.currentCamera.eye=this.applyRotation(this.currentCamera,e,this.currentCamera.eye,this.pivotPos)}ys(this.view,this.currentCamera,this.constraintOptions)}}end(){this.active&&this.finishController()}applyRotation(e,t,i,r){this.view.renderCoordsHelper.worldUpAtPosition(r,this.tmpWorldUp),jo(e,t,this.tmpRotCurPoint);let n=(this.lastPoint[1]-this.tmpRotCurPoint[1])*this.rotScale,a=(this.tmpRotCurPoint[0]-this.lastPoint[0])*this.rotScale;Object(Et["m"])(this.tmpViewDir,i,r);const s=Object(Et["s"])(this.tmpViewDir),o=Object(Oe["b"])(Object(Et["k"])(this.tmpViewDir,this.tmpWorldUp)/s);if(1===this.pivot){n*=-.5;const e=.5*Math.PI-o,t=.5*Math.PI*.99;n=e-Math.max(-t,Math.min(t,e+n))}return n=Object(Oe["f"])(n+o,Ce.min,Ce.max)-o,Object(Lt["j"])(this.tmpTransf),Object(Et["j"])(this.tmpAxis,e.up,this.tmpViewDir),0===this.pivot&&(a=-a),Object(Lt["f"])(this.tmpTransf,this.tmpTransf,a,this.tmpWorldUp),Object(Lt["f"])(this.tmpTransf,this.tmpTransf,n,this.tmpAxis),Object(Et["t"])(this.tmpViewDir,this.tmpViewDir,this.tmpTransf),e.up=Object(Et["t"])(Qc,e.up,this.tmpTransf),Object(Et["i"])(Qc,r,this.tmpViewDir),Object(kt["c"])(this.lastPoint,this.tmpRotCurPoint),Qc}};Object(h["a"])([Object(M["b"])({constructOnly:!0})],Zc.prototype,"view",void 0),Object(h["a"])([Object(M["b"])()],Zc.prototype,"pivot",void 0),Zc=Object(h["a"])([Object(D["a"])("esri.views.3d.state.controllers.RotateController")],Zc);const Qc=Object(F["f"])();class Xc extends Nc["a"]{constructor(e,t,i,r){super(!0),this.view=e,this.pointerAction=t,this.pivot=i,this.registerIncoming("drag",r,e=>this.handleDrag(e))}handleDrag(e){const t=e.data;if(t.pointers.size>1)return;if(!Object(Gc["a"])(e.data,this.pointerAction))return;const i=Object(A["g"])(t.center.x,t.center.y);switch(t.action){case"start":this.cameraController&&(this.cameraController.end(),this.cameraController=null),this.cameraController=new Zc({view:this.view,pivot:this.pivot}),this.view.state.switchCameraController(this.cameraController),this.cameraController.begin(i);break;case"update":this.cameraController&&this.cameraController.update(i);break;case"end":this.cameraController&&(this.cameraController.end(),this.cameraController=null)}e.stopPropagation()}}let Yc=class extends Hc{constructor(e){super(e),this.view=null,this.pickPoint=Object(F["f"])(),this.tmpP0=Object(Ut["b"])(),this.panAxisAngle=hi(),this.tmpRayDir=Object(F["f"])(),this.targetOnSphere=Object(F["f"])(),this.tmpRay={origin:Object(F["f"])(),direction:Object(F["f"])()},this.dragBeginPoint=Object(A["g"])(),this.normalizedAnchorPoint=Object(Ut["b"])(),this.constraintOptions={selection:7,interactionType:1,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:0},this.sphere=Object(_n["c"])(),this.hasPickPoint=!1}get intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;Object(kt["c"])(this.dragBeginPoint,e),jo(this.startCamera,e,this.normalizedAnchorPoint);const t=Object(zt["e"])(this.view.spatialReference),i=Vo(this.intersectionHelper,this.startCamera,e,!1,t);if(this.navMode=ko(this.startCamera,e,i.hasGeometryIntersection,t),this.navMode===Io.Horizontal||Object(_["a"])("disable-feature:context-navigation"))this.hasPickPoint=!!i.scenePickPoint,this.pickPoint=i.scenePickPoint,this.sphere=i.sphere;else{let t;Object(go["d"])(this.startCamera,e,this.tmpRay),Object(Et["u"])(this.tmpRay.direction,this.tmpRay.direction),this.view.camera.position.hasZ&&(t=Math.abs(this.view.camera.position.z));let i=Object(Oe["f"])(Oo*t,_o[0],_o[1]);const r=this.view._stage.renderView.getMinimalDepthForArea(null,e[0],e[1],this.view.state.camera,xo);i=i>r?r:i,this.hasPickPoint=!0,Object(Et["h"])(this.tmpRay.direction,this.tmpRay.direction,i),Object(Et["i"])(this.pickPoint,this.tmpRay.origin,this.tmpRay.direction)}this.constraintOptions.interactionStartCamera=this.startCamera}update(e){if(this.active){if(this.currentCamera.eye=this.startCamera.eye,this.currentCamera.center=this.startCamera.center,this.currentCamera.up=this.startCamera.up,this.navMode===Io.Horizontal||Object(_["a"])("disable-feature:context-navigation")){Object(Et["m"])(this.tmpRayDir,this.currentCamera.center,this.currentCamera.eye);const t=Object(Et["s"])(this.tmpRayDir);jo(this.currentCamera,e,this.tmpP0);const i=12*(this.normalizedAnchorPoint[1]-this.tmpP0[1]);let r=t*2**i;const n=this.view.state.constraints.minimumPoiDistance;if(i<0&&r<n&&(r=n),Math.abs(t-r)<1e-6)return;if(this.hasPickPoint&&r<t){const e=1-(1-r/t)*(1-this.sphere[3]/Object(Et["s"])(this.currentCamera.center));this.currentCamera.center=Object(Et["h"])(Kc,this.currentCamera.center,e)}Object(Et["h"])(this.tmpRayDir,this.tmpRayDir,-r/t),this.currentCamera.eye=Object(Et["i"])(Kc,this.currentCamera.center,this.tmpRayDir),this.constraintOptions.interactionFactor=_s(this.dragBeginPoint,e),ys(this.view,this.currentCamera,this.constraintOptions),this.hasPickPoint&&(No(this.sphere,this.currentCamera,this.dragBeginPoint,this.targetOnSphere),fi(this.pickPoint,this.targetOnSphere,this.panAxisAngle),So(this.currentCamera,this.sphere,this.panAxisAngle))}else{const t=Object(Et["s"])(this.tmpRay.direction);jo(this.currentCamera,e,this.tmpP0);const i=12*(this.normalizedAnchorPoint[1]-this.tmpP0[1]);let r=t*2**i;const n=this.view.state.constraints.minimumPoiDistance;if(i<0&&r<n&&(r=n),Math.abs(t-r)<1e-6)return;Object(Et["h"])(this.tmpRayDir,this.tmpRay.direction,1-r/t),this.currentCamera.eye=Object(Et["i"])(Kc,this.currentCamera.eye,this.tmpRayDir),this.currentCamera.center=Object(Et["i"])(Kc,this.currentCamera.center,this.tmpRayDir)}ca(this.view,this.currentCamera)}}end(){this.active&&this.finishController()}};Object(h["a"])([Object(M["b"])({constructOnly:!0})],Yc.prototype,"view",void 0),Yc=Object(h["a"])([Object(D["a"])("esri.views.3d.state.controllers.global.ZoomController")],Yc);const Kc=Object(F["f"])();let Jc=class extends Hc{constructor(e){super(e),this.view=null,this.tmpP=Object(F["f"])(),this.tmpDir=Object(F["f"])(),this.tmpN=Object(F["f"])(),this.tmpP0=Object(Ut["b"])(),this.tmpPoi=Object(F["f"])(),this.tmpRayDir=Object(F["f"])(),this.dragBeginPoint=Object(A["g"])(),this.normalizedAnchorPoint=Object(Ut["b"])(),this.constraintOptions={selection:15,interactionType:1,interactionFactor:0,interactionStartCamera:null,interactionDirection:Object(F["f"])(),tiltMode:0},this.plane=Object(mo["d"])()}get intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;let t;Object(kt["c"])(this.dragBeginPoint,e),jo(this.startCamera,e,this.normalizedAnchorPoint),this.intersectionHelper.intersectScreenFreePointFallback(e,this.tmpP),Object(Et["m"])(this.tmpDir,this.tmpP,this.startCamera.eye),Object(Et["u"])(this.tmpDir,this.tmpDir),this.view.camera.position.hasZ&&(t=Math.abs(this.view.camera.position.z));let i=Object(Oe["f"])(Oo*t,_o[0],_o[1]);const r=this.view._stage.renderView.getMinimalDepthForArea(this.view.getVoxelWasmPerSceneView(),e[0],e[1],this.view.state.camera,xo);i=i>r?r:i,Object(Et["h"])(this.tmpDir,this.tmpDir,i),Object(Et["i"])(this.tmpP,this.startCamera.eye,this.tmpDir),Object(Et["m"])(this.tmpN,this.startCamera.eye,this.startCamera.center),Object(Et["u"])(this.tmpN,this.tmpN),this.tmpN[1]<0&&Object(Et["v"])(this.tmpN,this.tmpN),Object(mo["h"])(this.tmpP,this.tmpN,this.plane),this.constraintOptions.interactionStartCamera=this.startCamera}update(e){if(!this.active)return;To(this.plane,this.currentCamera,this.dragBeginPoint,this.tmpPoi)||Object(Et["n"])(this.tmpPoi,this.currentCamera.center),jo(this.currentCamera,e,this.tmpP0);let t=4*(this.tmpP0[1]-this.normalizedAnchorPoint[1]);Object(kt["c"])(this.normalizedAnchorPoint,this.tmpP0),Object(Et["m"])(this.tmpRayDir,this.tmpPoi,this.currentCamera.eye);const i=Object(Et["s"])(this.tmpRayDir);let r=i*(1-t);Object(Et["n"])(this.constraintOptions.interactionDirection,this.tmpRayDir),Object(Et["h"])(this.constraintOptions.interactionDirection,this.constraintOptions.interactionDirection,Math.sign(t)/i);const n=this.view.state.constraints.minimumPoiDistance;t>=0&&r<n&&(r=n,t=-(r-i)/i),Math.abs(i-r)<1e-6||(Object(Et["h"])(this.tmpRayDir,this.tmpRayDir,t),this.currentCamera.eye=Object(Et["i"])(el,this.currentCamera.eye,this.tmpRayDir),Object(Et["l"])(el,this.currentCamera.center,this.tmpPoi,t),this.tmpPoi[2]>this.startCamera.center[2]?el[2]=Math.max(this.startCamera.center[2],el[2]):el[2]=Math.min(this.startCamera.center[2],el[2]),this.currentCamera.center=el,this.constraintOptions.interactionFactor=_s(this.dragBeginPoint,e),ys(this.view,this.currentCamera,this.constraintOptions))}end(){this.active&&this.finishController()}};Object(h["a"])([Object(M["b"])({constructOnly:!0})],Jc.prototype,"view",void 0),Jc=Object(h["a"])([Object(D["a"])("esri.views.3d.state.controllers.local.ZoomController")],Jc);const el=Object(F["f"])();class tl extends Nc["a"]{constructor(e,t,i){super(!0),this.view=e,this.pointerAction=t,this.registerIncoming("drag",i,e=>this.handleDrag(e))}handleDrag(e){const t=e.data;if(t.pointers.size>1)return;if(!Object(Gc["a"])(e.data,this.pointerAction))return;const i=Object(A["g"])(t.center.x,t.center.y);switch(t.action){case"start":this.cameraController&&(this.cameraController.end(),this.cameraController=null),this.view.state.isGlobal?this.cameraController=new Yc({view:this.view}):this.cameraController=new Jc({view:this.view}),this.view.state.switchCameraController(this.cameraController),this.cameraController.begin(i);break;case"update":this.cameraController&&this.cameraController.update(i);break;case"end":this.cameraController&&(this.cameraController.end(),this.cameraController=null)}e.stopPropagation()}}var il=i("3af1");const rl=Object(F["f"])(),nl=Object(F["f"])();function al(){return{direction:Object(F["f"])(),up:Object(F["f"])()}}function sl(e,t,i,r,n){let a=Object(Et["u"])(rl,e),s=Object(Et["k"])(a,r);const o=s>0;s=Math.abs(s),s>.99&&(s=Math.abs(Object(Et["k"])(t,r)),s<.99?(Object(Et["n"])(a,t),o&&Object(Et["h"])(a,a,-1)):a=null);let c=0;if(a){Object(Et["h"])(nl,r,Object(Et["k"])(r,a)),Object(Et["m"])(a,a,nl);const e=Object(Et["k"])(a,n)/(Object(Et["s"])(a)*Object(Et["s"])(n));Object(Et["j"])(nl,a,n),c=(Object(Et["k"])(nl,r)>0?1:-1)*Object(Oe["p"])(Object(Oe["b"])(e))}const l=Object(Oe["p"])(Object(Oe["b"])(-Object(Et["k"])(r,e)/Object(Et["s"])(e)));return i?(i.heading=c,i.tilt=l,i):{heading:c,tilt:l}}const ol=Object(F["h"])(0,1,0),cl=Object(F["h"])(0,0,1),ll=Object(Vt["d"])(),dl=Object(F["f"])(),hl=Object(F["f"])();function ul(e,t,i,r=al()){Object(Lt["j"])(ll);const{direction:n,up:a}=r;return Object(Lt["s"])(ll,ll,-Object(Oe["h"])(t)),Object(Lt["e"])(ll,ll,Object(Oe["h"])(i)),Object(Et["t"])(n,cl,ll),Object(Et["h"])(n,n,-1),Object(Et["t"])(a,ol,ll),r}function pl(e,t,i,r){return sl(t,i,r,cl,ol)}function fl(e,t,i,r){const n=ul(e,i,r),a=Object(F["f"])();return Object(Et["h"])(a,n.direction,-t),Object(Et["i"])(a,a,e),{up:n.up,eye:a,heading:i,tilt:r}}function bl(e){return Object(Oe["p"])(e)}function ml(e){return Object(Oe["h"])(e)}function gl(e,t,i,r,n){const a=e.renderSpatialReference,s=e.map&&e.spatialReference||t.spatialReference;return Object(L["t"])(t,dl,a),Object(L["t"])(t,hl,a),dl[0]-=i/2,hl[0]+=i/2,dl[1]-=r/2,hl[1]+=r/2,Object(L["y"])(dl,a,dl,s),Object(L["y"])(hl,a,hl,s),n?(n.xmin=dl[0],n.ymin=dl[1],n.xmax=hl[0],n.ymax=hl[1],n.spatialReference=s):n=new il["a"](dl[0],dl[1],hl[0],hl[1],s),n}const vl=Object.freeze({__proto__:null,headingTiltToDirectionUp:ul,directionToHeadingTilt:pl,eyeForCenterWithHeadingTilt:fl,lookAtTiltToEyeTilt:bl,eyeTiltToLookAtTilt:ml,toExtent:gl}),yl=Object(F["h"])(0,0,1),Ol=Object(Et["u"])(Object(F["f"])(),Object(F["h"])(1,1,1)),_l=new xe["a"](-180,180),xl=Object(Vt["d"])(),jl=Object(F["f"])(),wl=Object(F["f"])();function Sl(e,t,i,r=al()){Object(Et["j"])(jl,e,yl),0===Object(Et["k"])(jl,jl)&&Object(Et["j"])(jl,e,Ol),Object(Lt["j"])(xl),Object(Lt["f"])(xl,xl,-Object(Oe["h"])(t),e),Object(Lt["f"])(xl,xl,-Object(Oe["h"])(i),jl);const{up:n,direction:a}=r;return Object(Et["j"])(n,jl,e),Object(Et["u"])(n,n),Object(Et["t"])(n,n,xl),Object(Et["u"])(a,e),Object(Et["v"])(a,a),Object(Et["t"])(a,a,xl),r}function Tl(e,t,i,r){const n=jl,a=wl;return Object(Et["u"])(n,e),Object(Et["j"])(wl,n,yl),0===Object(Et["k"])(wl,wl)&&Object(Et["j"])(wl,n,Ol),Object(Et["j"])(a,wl,n),sl(t,i,r,n,a)}function Cl(e,t,i,r){const n={eye:Object(F["f"])(),up:null,tilt:r,heading:i},a=jl;a[0]=e[0],a[1]=e[2],a[2]=-e[1];const s=t,o=Object(Oe["h"])(i),c=Object(Oe["h"])(r),l=Math.sin(o),d=Math.cos(o),h=Math.sin(c),u=Math.cos(c),p=Object(Et["s"])(a);let f;if(Math.abs(c)<1e-8)f=s+p;else{const e=p/h,t=Object(Oe["d"])(s/e),i=Math.PI-c-t;f=e*Math.sin(i)}const b=u*s,m=s*s*(h*h),g=d*d*m,v=f-b,y=v*v,O=g*(g+y-a[1]*a[1]);if(O<0)return Object(Et["h"])(n.eye,a,f/p),n.tilt=0,n;const _=Math.sqrt(O),x=a[1]*v,j=g+y;let w;if(w=d>0?-_+x:_+x,Math.abs(j)<1e-8)return p<1e-8?(n.eye[0]=0,n.eye[1]=0,n.eye[2]=s):Object(Et["h"])(n.eye,a,f/p),n.tilt=0,Pl(n.eye),Al(n,e);n.eye[1]=w/j;const S=l*l*m,T=h*s,C=d*T*n.eye[1],P=n.eye[1]*n.eye[1],A=1-P,M=Math.sqrt(A),R=g*P+S-2*C*M*v+A*y;return Math.abs(R)<1e-8?(Object(Et["h"])(n.eye,a,f/p),n.tilt=0,Pl(n.eye),Al(n,e)):(n.eye[0]=(A*(f*a[0]-b*a[0])-T*M*(a[0]*n.eye[1]*d+a[2]*l))/R,n.eye[2]=(A*(f*a[2]-b*a[2])-T*M*(a[2]*n.eye[1]*d-a[0]*l))/R,Object(Et["h"])(n.eye,n.eye,f),Pl(n.eye),Al(n,e))}function Pl(e){const t=e[1];e[1]=-e[2],e[2]=t}function Al(e,t){const i=Sl(t,e.heading,e.tilt);return e.up=i.up,e}function Ml(e,t,i){const r=Object(Et["s"])(t),n=Math.sqrt(i*i+r*r-2*i*r*Math.cos(Math.PI-e)),a=Object(Oe["d"])(i/(n/Math.sin(e)));return Object(Oe["p"])(e-a)}function Rl(e,t,i){const r=Object(Oe["h"])(e),n=Object(Et["s"])(t);return Object(Oe["d"])(i/(n/Math.sin(r)))+r}function El(e,t,i,r,n){let a,s,o,l;const d=t.latitude,h=t.longitude,u=Hr(d,i,Object(zt["e"])(e.spatialReference).radius)/2;a=h-u,s=h+u;const p=Object(Oe["h"])(d),f=Object(zt["e"])(e.spatialReference).radius,b=(1+Math.sin(p))/(1-Math.sin(p)),m=(b+1)*Math.tan(r/f/2),g=m*m;function v(e){const t=Math.PI/2;return(e=xe["d"].normalize(e,-t))>t&&(e=Math.PI-e),e}if(o=1.5*Math.PI-2*Math.atan(.5*(m+Math.sqrt(4*b+g))),l=o+r/f,o=v(o),l=v(l),l<o){const e=l;l=o,o=e}if(o=Math.max(Object(Oe["p"])(o),-90),l=Math.min(Object(Oe["p"])(l),90),s=_l.monotonic(a,s),s-a>180){const e=(s-a-180)/2;a+=e,s-=e}const y=e.spatialReference&&e.spatialReference.isGeographic?e.spatialReference:c["a"].WGS84;return n?(n.xmin=a,n.ymin=o,n.xmax=s,n.ymax=l,n.spatialReference=y):n=new il["a"](a,o,s,l,y),e.spatialReference&&e.spatialReference.isWebMercator&&Object(X["b"])(n,!1,n),n}const Dl=Object.freeze({__proto__:null,headingTiltToDirectionUp:Sl,directionToHeadingTilt:Tl,eyeForCenterWithHeadingTilt:Cl,lookAtTiltToEyeTilt:Ml,eyeTiltToLookAtTilt:Rl,toExtent:El});var Il=i("ce27");const Fl=j["a"].getLogger("esri.views.3d.support.cameraUtils"),zl=39.37,Ll=96,Vl=1,kl=8,Ul=5,Bl=1,Nl=Object(F["f"])(),Gl=Object(F["f"])(),ql={heading:0,tilt:0},Hl=new Br["a"],Wl=new xe["a"](-20037508.342788905,20037508.342788905),$l=new xe["a"](-180,180);function Zl(e){return e.spatialReference||c["a"].WGS84}function Ql(e){return"global"===e.viewingMode?Dl:vl}function Xl(e,t,i,r,n){return Ql(e).headingTiltToDirectionUp(t,i,r,n)}function Yl(e,t){if(Object(w["k"])(t))return null;const i=e.renderSpatialReference,r=Ql(e).headingTiltToDirectionUp,n=Object(F["f"])();if(!Object(L["t"])(t.position,n,i))return null;const a=r(n,t.heading,t.tilt);Object(Et["h"])(a.direction,a.direction,e.state.camera.distance),Object(Et["i"])(a.direction,a.direction,n);const s=Jn(e,n,a.direction,a.up);return s.fov=Object(Oe["h"])(t.fov),s}const Kl=Object(F["f"])();function Jl(e,t,i){const r=e.renderSpatialReference,n=nd(e,t.eye,t.viewForward,t.up,ql);let a=Zl(e);return Object(L["y"])(t.eye,r,Kl,a)||(a=c["a"].WGS84,Object(L["y"])(t.eye,r,Kl,a)),Object(w["k"])(i)?new u["a"](new Br["a"](Kl,a),n.heading,n.tilt,Object(Oe["p"])(t.fov)):(i.position.x=Kl[0],i.position.y=Kl[1],i.position.z=Kl[2],i.position.spatialReference=a,i.heading=n.heading,i.tilt=n.tilt,i.fov=Object(Oe["p"])(t.fov),i)}function ed(e,t,i){const r=e.state.camera,n=r.width/2/r.pixelRatio;return 1===e.renderCoordsHelper.viewingMode&&null!=i&&(t*=Math.cos(Object(Oe["h"])(i))),t/=e.renderCoordsHelper.unitInMeters,n/(Ll*zl/t)/Math.tan(r.fovX/2)}function td(e,t,i){const r=e.state.camera,n=t*Math.tan(r.fovX/2),a=r.width/2/r.pixelRatio;let s=Ll*zl/(a/n);return 1===e.renderCoordsHelper.viewingMode&&(s/=Math.cos(Object(Oe["h"])(i))),s*=e.renderCoordsHelper.unitInMeters,s}function id(e,t,i,r,n,a){return rd(e,t,ed(e,i,t.latitude),r,n,a)}function rd(e,t,i,r,n,a){if(Td(a)){const s=new Sd(a.signal);return ld(e,r.heading,r.tilt,t,i,n,s),void s.resolver.promise.then(t=>{const i=Od(e,t,r.fov);if(!Object(w["k"])(i))return a.resolver.resolve(i);a.resolver.reject()},e=>a.resolver.reject(e))}const s=ld(e,r.heading,r.tilt,t,i,n);return Od(e,s,r.fov,a)}function nd(e,t,i,r,n){return Ql(e).directionToHeadingTilt(t,i,r,n)}function ad(e,t){return!!(e.basemapTerrain&&e.renderCoordsHelper.fromRenderCoords(t,Hl,e.spatialReference)&&Object(w["v"])(Object(K["b"])(e.elevationProvider,Hl),0)>Hl.z-Bl)}async function sd(e,t,i){if(!e.renderCoordsHelper.fromRenderCoords(t,Hl,e.spatialReference))return!1;const r=await e.elevationProvider.queryElevation(Hl.x,Hl.y,Hl.z,Hl.spatialReference,"ground",i);return Object(w["v"])(r,0)>Hl.z-Bl}async function od(e,t,i){const r=Object(F["f"])();if(t)if(t instanceof Br["a"]){if(Object(L["t"])(t,r,e.renderSpatialReference),null==t.z&&null!=e.basemapTerrain){const n=await e.elevationProvider.queryElevation(t.x,t.y,t.z,t.spatialReference,"ground",i);return Object(w["l"])(n)&&e.renderCoordsHelper.setAltitude(r,n),r}}else Object(Et["n"])(r,t);else Object(Et["n"])(r,e.state.camera.center);return r}function cd(e,t){const i=Object(F["f"])();if(t&&t instanceof Br["a"]){if(Object(L["t"])(t,i,e.renderSpatialReference),null==t.z&&null!=e.basemapTerrain){const r=Object(K["b"])(e.elevationProvider,t);Object(w["l"])(r)&&e.renderCoordsHelper.setAltitude(i,r)}}else Object(Et["n"])(i,t||e.state.camera.center);return i}function ld(e,t,i,r,n,a,s){const o=r&&r instanceof Br["a"]?r:null;if(Td(s))return od(e,r,s.signal).then(r=>{dd(e,t,i,o,r,n,a,s)},e=>s.resolver.reject(e)),null;const c=cd(e,r);return dd(e,t,i,o,c,n,a,s)}function dd(e,t,i,r,n,a,s,o){if(Object(w["k"])(r)){const t=e.renderSpatialReference;if(r=Object(L["x"])(n,t,Zl(e)),Object(w["k"])(r))return null}a=Math.max(a,e.state.constraints.minimumPoiDistance);const c=fd(e,t,i,n,a,s),l=(0,Ql(e).eyeForCenterWithHeadingTilt)(n,a,c.heading,c.tilt);if(1===s&&"global"===e.viewingMode&&i>0){const c=()=>{const c=vd(e,n,a,gd(e,a,i,n));return dd(e,t,c,r,n,a,s=i-c<1?0:1,o)},d=e.map.ground.navigationConstraint;if(!d||"stay-above"===d.type){if(ad(e,l.eye))return c();if(Td(o))return sd(e,l.eye,o.signal).then(e=>e?c():(o.resolver.resolve({eye:l.eye,up:l.up,center:Object(F["d"])(n),heading:l.heading,tilt:l.tilt}),null)),null}}const d=!o||Td(o)?{center:Object(F["f"])(),eye:Object(F["f"])(),up:Object(F["f"])(),tilt:0,heading:0}:o;return d.eye=l.eye,d.up=l.up,d.center=Object(F["d"])(n),d.heading=l.heading,d.tilt=l.tilt,Td(o)&&o.resolver.resolve(d),d}function hd(e,t,i,r,n,a=null){const s=null!=t.zmax&&null!=t.zmin;let o,c,l;if(e.state.isGlobal){if(!Object(Il["a"])(t.spatialReference,1))return Td(a)&&a.resolver.reject(),null;const e=new Br["a"](t.xmin,t.ymin,t.spatialReference),i=new Br["a"](t.xmax,t.ymax,t.spatialReference),r=t.spatialReference.isGeographic?$l:Wl;o=new Br["a"]({x:r.center(e.x,i.x),y:(i.y+e.y)/2,z:s?(t.zmax+t.zmin)/2:null,spatialReference:t.spatialReference});const n=Object(zt["e"])(t.spatialReference),d=qr(o,e,i);c=d.lon,l=d.lat,r.diff(e.x,i.x)>r.range/2&&(c+=n.halfCircumference),c=Math.min(c,n.halfCircumference),l=Math.min(l,n.halfCircumference)}else{const i=Object(w["v"])(e.renderSpatialReference,t.spatialReference);i.equals(t.spatialReference)||(t=Object(L["m"])(t,i)),c=t.xmax-t.xmin,l=t.ymax-t.ymin;const r=s?(t.zmax+t.zmin)/2:null;o=new Br["a"]({x:t.xmin+.5*c,y:t.ymin+.5*l,z:r,spatialReference:i})}const d=s?t.zmax-t.zmin:0,h=e.state.camera,u=1/Math.tan(h.fovX/2),p=1/Math.tan(h.fovY/2),f=1/Math.tan(h.fov/2),b=Math.max(.5*c*u,.5*l*p,.5*d*f)/Vl;if(Td(a)){const t=new Sd(a.signal);return ld(e,i,r,o,b,n,t),void t.resolver.promise.then(t=>{const i=Od(e,t,e.camera.fov);if(!Object(w["k"])(i))return a.resolver.resolve(i);a.resolver.reject()},e=>a.resolver.reject(e))}const m=ld(e,i,r,o,b,n);return Od(e,m,e.camera.fov,a)}function ud(e,t,i){const r=e.renderSpatialReference,n=Object(L["x"])(i,r,Zl(e));if(Object(w["k"])(n))return null;const a=Math.tan(t.fovX/2),s=Math.tan(t.fovY/2),o=Object(Et["q"])(t.eye,i),c=2*o*a*Vl,l=2*o*s*Vl;return"global"===e.viewingMode?El(e,n,c,l):gl(e,n,c,l)}function pd(e,t,i){const r=e.pointsOfInterest.centerOnSurfaceFrequent.distance;if(Math.log(i/r)/Math.LN2>kl)return!0;const n=e.renderSpatialReference,a=Zl(e),s=Object(L["x"])(t,n,a),o=Object(L["x"])(e.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,n,a);if(Object(w["k"])(s)||Object(w["k"])(o))return!1;const c=Math.tan(.5*e.state.camera.fov)*r;return o.distance(s)/c>Ul}function fd(e,t,i,r,n,a){let s=0;return 1===a&&pd(e,r,n)?(t=0,s=md(e,n,i,r)):s=yd(e,r,n,i),s=e.state.constraints.clampTilt(n,s),{heading:t,tilt:i=vd(e,r,n,s)}}const bd=.7;function md(e,t,i,r){const n=e.state.constraints.tilt(t);n.max=Math.min(n.max,.5*Math.PI);const a=n.min*(1-bd)+n.max*bd,s=yd(e,r,t,i);return Math.min(s,a)}function gd(e,t,i,r){const n=e.state.constraints.tilt(t);let a=yd(e,r,t,i);return a=Math.min(a,.5*Math.PI),n.min*(1-bd)+a*bd}function vd(e,t,i,r){return Ql(e).lookAtTiltToEyeTilt(r,t,i)}function yd(e,t,i,r){return Ql(e).eyeTiltToLookAtTilt(r,t,i)}function Od(e,t,i,r){if(Object(w["k"])(t))return null;const n=e.renderSpatialReference,a=Object(L["x"])(t.eye,n,Zl(e));return Object(w["k"])(a)?null:Object(w["l"])(r)?(r.position=a,r.heading=t.heading,r.tilt=t.tilt,r.fov=i,r):new u["a"](a,t.heading,t.tilt,i)}function _d(e,t){var i;const r=null==(i=e.basemapTerrain)?void 0:i.tilingScheme;if(r)return r.levelAtScale(t);Fl.error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")}function xd(e,t){var i;const r=null==(i=e.basemapTerrain)?void 0:i.tilingScheme;if(r)return r.scaleAtLevel(t);Fl.error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")}function jd(e,t){return e.spatialReference?Object(B["a"])(t,e.spatialReference):void 0}function wd(e,t,i){const r=e.renderSpatialReference;let n,a;t||(t=e.state.camera);const s=c["a"].WGS84;return t instanceof u["a"]?(n=t.position.latitude,Object(L["t"])(t.position,Nl,r),Object(L["t"])(i,Gl,r),a=Object(Et["p"])(Nl,Gl)):(Object(L["y"])(t.center,r,Gl,s),n=Gl[1],a=t.distance),td(e,a,n)}class Sd{constructor(e){this.signal=e,this.resolver=Object(S["g"])()}}function Td(e){return e&&"resolver"in e}var Cd=i("85d4");let Pd=class extends Hc{constructor(e){super(e),this.transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},this.keysButtonState=[0,0,0,0,0,0,0,0,0,0,0,0],this.tmpCamera=new Fs["a"],this.constraintOptions={selection:15,interactionType:0,interactionStartCamera:new Fs["a"],interactionFactor:0,interactionDirection:null,tiltMode:1}}handleEventGamepad(e){const t=Object(Cd["a"])(e,this.view.navigation.gamepad,this.transformation);("end"===e.action||Object(Cd["c"])(t))&&this.finishController()}activateDirection(e){this.keysButtonState[e]=1,Object(Cd["b"])(this.keysButtonState,this.transformation)}deactivateDirection(e){this.keysButtonState[e]=0;const t=Object(Cd["b"])(this.keysButtonState,this.transformation);Object(Cd["c"])(t)&&this.finishController()}onControllerStart(e){this.filteredSurfaceElevation=this.view.pointsOfInterest.cameraOnSurface.location.z,this.headingStart=this.view.camera.heading,super.onControllerStart(e)}updateFilteredSurfaceElevation(e){const t=this.view.pointsOfInterest.cameraOnSurface.location.z,i=1;this.filteredSurfaceElevation+=i*(t-this.filteredSurfaceElevation)*e}stepController(e,t){this.updateStartHeading(),this.updateFilteredSurfaceElevation(e),this.currentCamera.copyViewFrom(t),this.updateCameraCenter(),this.constraintOptions.interactionStartCamera.copyFrom(this.currentCamera),this.calculateControlTransformation(e,this.currentCamera,zd),this.applyDisabledMovementTypes(zd),this.applyPan(zd.pan),this.applyRotate(zd.rotate),this.applyZoom(zd.zoom),this.applyAscend(zd.ascend),this.constraintOptions.interactionType=0,this.constraintOptions.selection=8,ys(this.view,this.currentCamera,this.constraintOptions),super.stepController(e,t)}updateStartHeading(){0!==this.transformation.heading&&(this.headingStart=this.view.camera.heading)}applyRotate(e){if(!e.enabled)return;const t=this.currentCamera;Object(Et["m"])(Ld,t.center,t.eye),Object(Et["t"])(Ld,Ld,e.matrix),t.center=Object(Et["i"])(Ld,Ld,t.eye),t.up=Object(Et["t"])(Ld,t.up,e.matrix),this.constraintOptions.interactionType=3,this.constraintOptions.selection=7,ys(this.view,t,this.constraintOptions)}applyPan(e,t=this.currentCamera){e.enabled&&(t.eye=Object(Et["t"])(Ld,t.eye,e.matrix),t.center=Object(Et["t"])(Ld,t.center,e.matrix),this.view.state.isGlobal&&(t.up=Object(Et["t"])(Ld,t.up,e.matrix)),this.constraintOptions.interactionType=4,this.constraintOptions.selection=15,ys(this.view,t,this.constraintOptions))}applyZoom(e){if(!e)return;const t=this.currentCamera.viewForward;this.currentCamera.eye=Object(Et["i"])(Ld,this.currentCamera.eye,Object(Et["h"])(di["d"].get(),t,e)),Object(Et["n"])(Vd,t),Object(Et["v"])(Vd,Vd),this.constraintOptions.interactionDirection=Vd,this.constraintOptions.interactionType=1,this.constraintOptions.selection=7,ys(this.view,this.currentCamera,this.constraintOptions),this.constraintOptions.interactionDirection=null}applyAscend(e){if(!e)return;const t=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,di["d"].get());if(this.constraintOptions.interactionDirection=Object(Et["n"])(Vd,t),this.view.state.isGlobal){const t=Object(Et["s"])(this.currentCamera.eye),i=(t+e)/t;this.currentCamera.eye=Object(Et["h"])(Ld,this.currentCamera.eye,i),this.currentCamera.center=Object(Et["h"])(Ld,this.currentCamera.center,i)}else{const i=Object(Et["h"])(di["d"].get(),t,e);this.currentCamera.eye=Object(Et["i"])(Ld,this.currentCamera.eye,i),this.currentCamera.center=Object(Et["i"])(Ld,this.currentCamera.center,i)}this.updateCameraCenter(),this.constraintOptions.interactionType=5,this.constraintOptions.selection=8,ys(this.view,this.currentCamera,this.constraintOptions)&&this.updateCameraCenter(),this.constraintOptions.selection=7,ys(this.view,this.currentCamera,this.constraintOptions),this.constraintOptions.interactionDirection=null}calculateControlTransformation(e,t,i){Ud(i);const r=this.computeVelocities(e);this.view.state.isLocal?this.calculateControlTransformationLocal(r,t,i):this.calculateControlTransformationGlobal(r,t,i)}updateCameraCenter(){const e=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,t=this.view.renderCoordsHelper,i=this.currentCamera.ray;this.currentCamera.center=t.intersectManifoldClosestSilhouette(i,e,Ld)}calculateControlTransformationLocal(e,t,i){const{viewRight:r,viewForward:n}=t,a=this.transformation,s=this.view.navigation.gamepad,o=Object(Et["z"])(di["d"].get(),n[0],n[1],0);Object(Et["u"])(o,o);const c=a.translation[0]*e.pan;if(0!==c){const e=Object(Et["h"])(di["d"].get(),r,c);Object(Lt["b"])(i.pan.matrix,i.pan.matrix,e),i.pan.enabled=!0}switch(s.mode){case"pan":{const t=-a.translation[1]*e.pan;if(0!==t){const e=Object(Et["h"])(di["d"].get(),o,t);Object(Lt["b"])(i.pan.matrix,i.pan.matrix,e),i.pan.enabled=!0}i.zoom=a.zoom*e.zoom;break}case"zoom":i.zoom=(-a.translation[1]+a.zoom)*e.zoom;break;default:Object(ha["a"])(s.mode)}const l=a.translation[2]*e.ascend;i.ascend=l;const d=-a.heading*e.rotate;0!==d&&(Object(Lt["f"])(i.rotate.matrix,i.rotate.matrix,d,this.view.renderCoordsHelper.worldUpAtPosition(t.eye,di["d"].get())),i.rotate.enabled=!0);const h=a.tilt*e.rotate,u=ua(this.view.renderCoordsHelper,t.center,t.eye),p=Object(Oe["f"])(u+h,Ce.min,Ce.max)-u;p&&(Object(Lt["f"])(i.rotate.matrix,i.rotate.matrix,p,r),i.rotate.enabled=!0)}calculateControlTransformationGlobal(e,t,i){const{eye:r,viewRight:n}=t,a=this.transformation,s=this.view.navigation.gamepad,o=Object(Et["j"])(di["d"].get(),n,r);Object(Et["u"])(o,o),Object(Et["v"])(o,o),ac(this.startCamera,t,a,e,this.view.camera.heading,this.headingStart,this.view.camera.tilt,i,s),this.tmpCamera.copyFrom(this.currentCamera),this.applyPan(zd.pan,this.tmpCamera);const c=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,l=a.translation[2]*e.ascend;i.ascend=l;const d=-a.heading*e.rotate;0!==d&&(Object(Lt["f"])(i.rotate.matrix,i.rotate.matrix,d,this.tmpCamera.eye),i.rotate.enabled=!0);const h=a.tilt*e.rotate,u=this.clampTiltDeltaGlobalToValidRange(h,t.ray,c);0!==u&&(Object(Lt["f"])(i.rotate.matrix,i.rotate.matrix,u,this.tmpCamera.viewRight),i.rotate.enabled=!0),i.zoom+=a.zoom*e.zoom}clampTiltDeltaGlobalToValidRange(e,t,i){const r=Object(zt["e"])(this.view.spatialReference),n=Eo(Ce.min,t.origin,i,r);let a=0,s=0;const o=di["d"].get();if(this.view.renderCoordsHelper.intersectManifold(t,i,o)){const e=ua(this.view.renderCoordsHelper,o,t.origin);a=Eo(e,t.origin,i,r),s=Eo(Ce.max,t.origin,i,r)}else{Object(_n["h"])(Object(_n["j"])(i+r.radius),t,o);const e=Object(Oe["b"])(-Object(Et["k"])(t.direction,Object(Et["u"])(o,o)));a=Do(e,t.origin,i,r),s=Do(Ce.max,t.origin,i,r)}return Object(Oe["f"])(a+e,n,s)-a}getPointAbsoluteSurfaceElevation(e,t,i){const{renderCoordsHelper:r}=this.view,n=r.getAltitude(e),a=t+Math.abs(n-t);return r.setAltitude(i,a,e),a}clampedDistanceToSurface(e,t){const{renderCoordsHelper:i}=this.view,{camera:r}=this.view.state,{direction:n}=Xl(this.view,t,0,Md,kd),a=i.intersectManifoldClosestSilhouette(Object(xn["h"])(t,n),e,di["d"].get()),s=Object(Et["p"])(t,a),o=i.intersectManifoldClosestSilhouette(Object(xn["h"])(t,Object(Et["y"])(di["d"].get(),t,r.center)),e,di["d"].get()),c=Object(Et["p"])(t,o);return Math.min(s,c)}computeHeadingRotateRadius(e){const{renderCoordsHelper:t,state:i}=this.view,{camera:r,isGlobal:n}=i,a=t.intersectManifoldClosestSilhouette(r.ray,this.filteredSurfaceElevation,di["d"].get());if(n){const t=Object(Et["m"])(di["d"].get(),e,a),i=Object(Et["s"])(t);Object(Et["h"])(t,t,1/i);const r=Object(Et["u"])(di["d"].get(),e),n=Object(Oe["b"])(Object(Et["k"])(r,t));return i*Math.sin(Math.min(Rd,n))}{const i=Object(Et["n"])(di["d"].get(),e);return t.setAltitude(i,this.filteredSurfaceElevation),Object(Et["p"])(a,i)}}minimumAscendVelocity(){return this.view.state.constraints.collision.enabled?0:Dd}computeVelocities(e){const t=this.filteredSurfaceElevation,i=t+Object(zt["e"])(this.view.spatialReference).radius,{camera:r,isGlobal:n}=this.view.state,a=di["d"].get(),s=this.getPointAbsoluteSurfaceElevation(r.eye,t,a),o=this.clampedDistanceToSurface(t,a),c=r.width/2,l=Ed*r.width,d=Ed*r.width,h=o*Math.tan(.5*r.fovX)/c,u=h/i,p=h/this.computeHeadingRotateRadius(a),f=s-t;return{pan:(n?u:h)*l*e,ascend:Math.max(this.minimumAscendVelocity()*e,2**(l*e/c)*f-f),zoom:2**(l*e/c)*o-o,rotate:Object(Oe["f"])(p*d,Id,Fd)*e}}applyDisabledMovementTypes(e){!Object(w["l"])(this.disableMovements)||void 0!==this.disableMovements.mode&&this.view.state.viewingMode!==this.disableMovements.mode||(e.zoom=this.disableMovements.zoom?0:e.zoom,e.ascend=this.disableMovements.ascend?0:e.ascend,e.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&Object(Lt["j"])(e.pan.matrix),e.rotate.enabled=!this.disableMovements.rotate,this.disableMovements.rotate&&Object(Lt["j"])(e.rotate.matrix))}static activatesFor(e,t){const i=Object(Cd["a"])(t,e.navigation.gamepad,Ad);return!("end"===t.action||Object(Cd["c"])(i))}};Object(h["a"])([Object(M["b"])({constructOnly:!0})],Pd.prototype,"view",void 0),Object(h["a"])([Object(M["b"])({constructOnly:!0})],Pd.prototype,"gamepadDevice",void 0),Object(h["a"])([Object(M["b"])({constructOnly:!0})],Pd.prototype,"disableMovements",void 0),Pd=Object(h["a"])([Object(D["a"])("esri.views.3d.state.controllers.GamepadKeyboardController")],Pd);const Ad={translation:[0,0,0],heading:0,tilt:0,zoom:0},Md=80,Rd=Object(Oe["h"])(Md),Ed=.75,Dd=5,Id=Object(Oe["h"])(30),Fd=Object(Oe["h"])(80),zd={zoom:0,ascend:0,pan:{enabled:!1,matrix:Object(Vt["d"])()},rotate:{enabled:!1,matrix:Object(Vt["d"])()}},Ld=Object(F["f"])(),Vd=Object(F["f"])(),kd=al();function Ud(e){e.zoom=0,e.ascend=0,e.pan.enabled=!1,Object(Lt["j"])(e.pan.matrix),e.rotate.enabled=!1,Object(Lt["j"])(e.rotate.matrix)}class Bd extends Nc["a"]{constructor(e){super(!0),this.view=e,this.watchHandles=new $["a"],this.handle=this.registerIncoming("gamepad",e=>this.handleEventGamepad(e)),this.handle.pause()}onInstall(e){super.onInstall(e),this.watchHandles.add([Object(C["a"])(this.view.navigation.gamepad,"enabled",e=>{e?this.handle.resume():(this.handle.pause(),this.cameraControllerGamepad&&(this.cameraControllerGamepad.finishController(),this.cameraControllerGamepad=null))}),this.view.navigation.gamepad.watch("device",e=>{this.cameraControllerGamepad&&e&&this.cameraControllerGamepad.gamepadDevice!==e&&(this.cameraControllerGamepad.finishController(),this.cameraControllerGamepad=null)})])}onUninstall(){this.watchHandles.removeAll(),super.onUninstall()}handleEventGamepad(e){const t=this.view.navigation.gamepad.device;if(t&&e.data.device!==t)return;const i=this.cameraControllerGamepad&&this.cameraControllerGamepad.active;if(i||Pd.activatesFor(this.view,e.data)){if(!i){const t=new Pd({view:this.view,gamepadDevice:e.data.device});this.view.state.switchCameraController(t)&&(this.cameraControllerGamepad=t)}this.cameraControllerGamepad&&this.cameraControllerGamepad.active&&this.cameraControllerGamepad.gamepadDevice===e.data.device&&this.cameraControllerGamepad.handleEventGamepad(e.data)}}}class Nd extends Nc["a"]{constructor(e,t){super(!0),this.view=e,this.disableMovements={pan:!0,zoom:!1,ascend:!0,rotate:!1,mode:2},this.keyToNumber={[t.left]:0,[t.right]:1,[t.forward]:2,[t.backward]:3,[t.up]:4,[t.down]:5,[t.headingLeft]:6,[t.headingRight]:7,[t.tiltUp]:8,[t.tiltDown]:9,[t.zoomIn]:10,[t.zoomOut]:11},this.registerIncoming("key-down",null,e=>this.handleKeyDown(e)),this.registerIncoming("key-up",null,e=>this.handleKeyUp(e)),this.registerIncoming("blur",null,()=>this.handleBlur())}handleKeyDown(e){if(e.data.native.ctrlKey||e.data.native.metaKey)return;const t=this.keyToNumber[e.data.key];null!=t&&(this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active||(this.cameraControllerKeyboard=new Pd({view:this.view,disableMovements:this.disableMovements}),this.view.state.switchCameraController(this.cameraControllerKeyboard)),this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.activateDirection(t),e.stopPropagation()))}handleBlur(){this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.finishController(),this.cameraControllerKeyboard=null)}handleKeyUp(e){if(e.data.native.ctrlKey||e.data.native.metaKey)return;const t=this.keyToNumber[e.data.key];null!=t&&this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.deactivateDirection(t),e.stopPropagation())}}class Gd extends Nc["a"]{constructor(e,t){super(!0),this.view=e,this.registerIncoming("mouse-wheel",t,e=>this.handleMouseWheel(e))}handleMouseWheel(e){if(!this.view.navigation.mouseWheelZoomEnabled)return;const t=e.data;this.cameraController&&this.cameraController.active||(this.cameraController=this.view.state.isGlobal?new Ec({view:this.view,mode:"interaction"}):new Uc({view:this.view,mode:"interaction"}),this.view.state.switchCameraController(this.cameraController)),this.cameraController.zoomStep(-1/60*t.deltaY,Object(A["g"])(t.x,t.y)),e.preventDefault(),e.stopPropagation()}}class qd{constructor(e){this._gain=e}reset(e){this._value=e}set gain(e){this._gain=e}get value(){return void 0===this._value?0:this._value}update(e){void 0===this._value?this._value=e:this._value=this._gain*e+(1-this._gain)*this._value}}let Hd=class extends uo{constructor(e){super(e),this.view=null,this.beginCamera=new Fs["a"],this.elapsedTimeSec=0,this.constraintOptions={selection:15,interactionType:4,interactionFactor:0,interactionStartCamera:new Fs["a"],interactionDirection:null,tiltMode:0}}initialize(){this.constraintOptions.interactionType=this.interactionType,this.viewAnimation=new oe["a"]}get steppingFinished(){return this.momentum.isFinished(this.elapsedTimeSec)}onControllerStart(e){this.beginCamera.copyFrom(e),this.constraintOptions.interactionStartCamera=this.beginCamera,super.onControllerStart(e)}stepController(e,t){t.copyViewFrom(this.beginCamera),this.elapsedTimeSec+=e,this.momentumStep(this.elapsedTimeSec,t),ys(this.view,t,this.constraintOptions)}};Object(h["a"])([Object(M["b"])({constructOnly:!0})],Hd.prototype,"view",void 0),Hd=Object(h["a"])([Object(D["a"])("esri.views.3d.state.controllers.momentum.MomentumController")],Hd);let Wd=class extends Hd{constructor(e){super(e),this.interactionType=4,this.tmpPan=Object(F["f"])()}momentumStep(e,t){const i=this.momentum.value(e);Object(Et["h"])(this.tmpPan,this.momentum.direction,i),t.eye=Object(Et["m"])($d,t.eye,this.tmpPan),t.center=Object(Et["m"])($d,t.center,this.tmpPan),this.constraintOptions.interactionDirection=this.tmpPan}};Object(h["a"])([Object(M["b"])({constructOnly:!0})],Wd.prototype,"momentum",void 0),Wd=Object(h["a"])([Object(D["a"])("esri.views.3d.state.controllers.momentum.PanPlanarMomentumController")],Wd);const $d=Object(F["f"])(),Zd=Object(F["f"])(),Qd=Object(F["f"])();let Xd=class extends Hd{constructor(e){super(e),this.interactionType=4}momentumStep(e,t){const i=this.momentum.value1(e),r=this.momentum.value2(e);Object(Et["n"])(Qd,t.eye),Object(Et["u"])(Qd,Qd),Object(Et["j"])(this.momentum.axis2,Qd,this.momentum.axis1),Ko(t,Zd,this.momentum.axis1,i,this.momentum.axis2,r)}};Object(h["a"])([Object(M["b"])({constructOnly:!0})],Xd.prototype,"momentum",void 0),Xd=Object(h["a"])([Object(D["a"])("esri.views.3d.state.controllers.momentum.PanSphericalMomentumController")],Xd);let Yd=class extends Hd{constructor(e){super(e),this.interactionType=2}set center(e){this._set("center",Object(F["d"])(e))}set axis(e){this._set("axis",Object(F["d"])(e))}momentumStep(e,t){const i=this.momentum.value(e);So(t,this.center,ui(this.axis,i))}};Object(h["a"])([Object(M["b"])({constructOnly:!0})],Yd.prototype,"momentum",void 0),Object(h["a"])([Object(M["b"])({constructOnly:!0})],Yd.prototype,"center",null),Object(h["a"])([Object(M["b"])({constructOnly:!0})],Yd.prototype,"axis",null),Yd=Object(h["a"])([Object(D["a"])("esri.views.3d.state.controllers.momentum.MomentumController")],Yd);let Kd=class extends Hd{constructor(e){super(e),this.interactionType=1,this.constraintOptions.interactionDirection=Object(F["f"])()}set zoomCenter(e){this._set("zoomCenter",Object(F["d"])(e))}momentumStep(e,t){Object(Et["n"])(this.constraintOptions.interactionDirection,t.eye);const i=this.momentum.valueDelta(0,e);Po(t,this.zoomCenter,i,this.view.state.constraints.minimumPoiDistance),this.constraintOptions.interactionDirection=Object(Et["y"])(this.constraintOptions.interactionDirection,t.eye,this.constraintOptions.interactionDirection)}};Object(h["a"])([Object(M["b"])({constructOnly:!0})],Kd.prototype,"momentum",void 0),Object(h["a"])([Object(M["b"])({constructOnly:!0})],Kd.prototype,"zoomCenter",null),Kd=Object(h["a"])([Object(D["a"])("esri.views.3d.state.controllers.momentum.ZoomPlanarMomentumController")],Kd);let Jd=class extends Hd{constructor(e){super(e),this.interactionType=1,this.radius=0,this.tmpSceneCenter=Object(F["f"])(),this.tmpZoomAxisAngle=hi(),this.sphere=Object(_n["c"])()}set screenCenter(e){this._set("screenCenter",Object(A["g"])(e[0],e[1]))}set sceneCenter(e){this._set("sceneCenter",Object(F["d"])(e))}initialize(){this.sphere[3]=this.radius}momentumStep(e,t){const i=this.momentum.valueDelta(0,e);Ao(this.sphere,t,i),this.constraintOptions.interactionType=1,ys(this.view,t,this.constraintOptions),No(this.sphere,t,this.screenCenter,this.tmpSceneCenter),fi(this.sceneCenter,this.tmpSceneCenter,this.tmpZoomAxisAngle),So(t,this.sphere,this.tmpZoomAxisAngle),this.constraintOptions.interactionType=4}};Object(h["a"])([Object(M["b"])({constructOnly:!0})],Jd.prototype,"momentum",void 0),Object(h["a"])([Object(M["b"])({constructOnly:!0})],Jd.prototype,"screenCenter",null),Object(h["a"])([Object(M["b"])({constructOnly:!0})],Jd.prototype,"sceneCenter",null),Object(h["a"])([Object(M["b"])({constructOnly:!0})],Jd.prototype,"radius",void 0),Jd=Object(h["a"])([Object(D["a"])("esri.views.3d.state.controllers.momentum.ZoomSphericalMomentumController")],Jd);var eh=i("4e47"),th=i("0ca1");class ih{constructor(e){this.gain=e}update(e){this.hasFilteredValue?this.filteredValue=(1-this.gain)*this.filteredValue+this.gain*e:this.filteredValue=e}reset(){this.filteredValue=void 0}get hasFilteredValue(){return void 0!==this.filteredValue}}var rh=i("b33e");const nh=1e-5;class ah extends rh["a"]{constructor(e,t,i,r,n,a=0,s){super(e,t,i),this.angularVelocity1=r,this.axis1=n,this.angularVelocity2=a,this.axis2=s}value1(e){return super.valueFromInitialVelocity(this.angularVelocity1,e)}value2(e){return super.valueFromInitialVelocity(this.angularVelocity2,e)}}class sh{constructor(e=300,t=12,i=.84){this.minimumInitialVelocity=e,this.stopVelocity=t,this.friction=i,this.enabled=!0,this.tmpAxis1=Object(F["f"])(),this.tmpAxis2=Object(F["f"])(),this.tmpAngles=Object(Ut["b"])(),this.time=new th["a"](.3),this.screen=[new th["a"](.4),new th["a"](.4)],this.angle1=new ih(.6),this.angle2=new ih(.6),this.axis1=Object(F["f"])(),this.axis2=Object(F["f"])(),this.lastScene=Object(F["f"])()}addMomentumDirectRotation(e,t,i,r,n,a){if(this.enabled){if(this.time.hasLastValue){if(this.time.computeDelta(i)<.01)return;let e=Wo(this.lastScene,t,this.tmpAxis2,r,n,a);this.angle2.update(0),Object(Et["w"])(this.tmpAxis2)<nh?e=0:Object(Et["u"])(this.axis1,this.tmpAxis2),this.angle1.update(e),Object(Et["n"])(this.lastScene,t)}this.screen[0].update(e[0]),this.screen[1].update(e[1]),this.time.update(i)}}addMomentumPreserveHeading(e,t,i,r,n,a,s){if(this.enabled){if(this.time.hasLastValue){if(this.time.computeDelta(i)<.01)return;Xo(this.lastScene,t,this.tmpAxis2,this.tmpAxis1,this.tmpAngles,r,n,a,s,!1),Object(Et["w"])(this.tmpAxis2)<nh?(this.angle1.update(0),this.angle2.update(0)):(this.angle1.update(this.tmpAngles[1]),this.angle2.update(this.tmpAngles[0]),Object(Et["u"])(this.axis1,this.tmpAxis1),Object(Et["u"])(this.axis2,this.tmpAxis2)),Object(Et["n"])(this.lastScene,t)}this.screen[0].update(e[0]),this.screen[1].update(e[1]),this.time.update(i)}}reset(){this.screen[0].reset(),this.screen[1].reset(),this.angle1.reset(),this.angle2.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.screen[0].hasFilteredDelta)return null;const e=this.screen[0].filteredDelta,t=this.screen[1].filteredDelta,i=Math.sqrt(e*e+t*t)/this.time.filteredDelta;return Math.abs(i)<this.minimumInitialVelocity?null:this.createMomentum(i,this.stopVelocity,this.friction)}createMomentum(e,t,i){const r=this.angle1.filteredValue/this.time.filteredDelta,n=this.angle2.filteredValue/this.time.filteredDelta;return new ah(e,t,i,r,this.axis1,n,this.axis2)}}var oh=i("11d8"),ch=i("8e6f");let lh=class extends Hc{constructor(e){super(e),this.view=null,this.smoothRotation=new qd(.05),this.rotationAxis=Object(F["f"])(),this.panningPlane=Object(mo["d"])(),this.smoothScaling=new qd(.05),this.zoomCenterScreen=Object(A["g"])(),this.zoomMomentumEstimator=new ch["a"],this.rotationMomentumEstimator=new oh["a"],this.panSphericalMomentumEstimator=new sh,this.panPlanarMomentumEstimator=new eh["a"],this.adjustedSphere=Object(_n["c"])(),this.tmp3d=Object(F["f"])(),this.tmpScreenPointArray=Object(A["g"])(),this.beginScreenPoint=Object(A["g"])(),this.beginScenePoint=Object(F["f"])(),this.screenPickPoint=Object(A["g"])(),this.navMode=Io.Horizontal,this.tmpInteractionDirection=Object(F["f"])(),this.constraintOptions={selection:15,interactionType:0,interactionFactor:0,interactionStartCamera:new Fs["a"],interactionDirection:null,tiltMode:0}}get intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;const t=this.view.navigation.momentumEnabled;this.zoomMomentumEstimator.enabled=t,this.rotationMomentumEstimator.enabled=t,this.panPlanarMomentumEstimator.enabled=t,this.panSphericalMomentumEstimator.enabled=t,this.beginHeading=-xe["f"].normalize(Object(Oe["h"])(this.view.camera.heading)),this.beginRadius=e.radius,this.pointerCount=e.pointers.size,this.beginAngle=e.angle,this.smoothRotation.reset(),Object(A["j"])(e.center,this.screenPickPoint),Object(kt["c"])(this.beginScreenPoint,this.screenPickPoint);const i=Object(zt["e"])(this.view.spatialReference),r=Vo(this.intersectionHelper,this.startCamera,this.screenPickPoint,!0,i);this.scenePickPoint=r.scenePickPoint,this.sphere=r.sphere,Object(Et["n"])(this.beginScenePoint,this.scenePickPoint),this.navMode=ko(this.startCamera,this.screenPickPoint,r.hasGeometryIntersection,i),this.navMode===Io.Vertical&&this.preparePlanarPanMode(e),this.constraintOptions.interactionStartCamera.copyFrom(this.startCamera)}preparePlanarPanMode(e){const t=Object(Et["v"])(this.tmp3d,this.startCamera.viewForward);Object(mo["h"])(this.scenePickPoint,t,this.panningPlane);const i=Object(A["g"])(this.screenPickPoint[0],0),r=Object(F["f"])(),n=Object(Et["s"])(this.startCamera.eye);this.adjustedSphere[3]=n<this.sphere[3]?n-100:this.sphere[3],No(this.adjustedSphere,this.startCamera,i,r);const a=Object(A["e"])();this.startCamera.projectToRenderScreen(r,a);const s=.9*a[1];if(this.screenPickPoint[1]=Math.min(this.screenPickPoint[1],s),this.intersectionHelper.intersectScreen(this.screenPickPoint,this.scenePickPoint)&&Object(mo["h"])(this.scenePickPoint,Object(mo["r"])(this.panningPlane),this.panningPlane),!Object(Ic["a"])()){const e=Object(F["f"])(),t=Object(F["f"])(),i=Object(F["f"])(),r=80,n=5,a=50;Object(Et["m"])(e,this.scenePickPoint,this.currentCamera.eye),Object(Et["u"])(e,e);const s=n*Math.max(Math.abs(this.view.camera.position.z),a),o=this.view._stage.renderView.getMinimalDepthForArea(null,this.screenPickPoint[0],this.screenPickPoint[1],this.view.state.camera,r),c=o?Math.min(o,s):s;Object(Et["n"])(i,Object(Et["i"])(t,this.currentCamera.eye,Object(Et["h"])(t,e,c))),this.panningPlane[3]=-Object(Et["k"])(this.panningPlane,i),this.startCamera.center=Object(Et["i"])(t,this.startCamera.eye,Object(Et["h"])(t,this.startCamera.viewForward,c))}const o=Object(A["j"])(e.center,this.tmpScreenPointArray);Co(this.panningPlane,this.startCamera,o,this.beginScenePoint)}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const t=e.pointers.size>1;this.navMode===Io.Horizontal?(t&&this.zoomSpherical(e),this.panningSpherical(e),t&&this.rotateSpherical(e)):(t&&this.zoomPlanar(e),this.panningPlanar(e),t&&this.rotatePlanar(e))}end(e){e.pointers.size===this.pointerCount&&this.update(e),this.finishController();const t=this.zoomMomentumEstimator.evaluateMomentum();if(t)return this.navMode===Io.Horizontal?new Jd({view:this.view,momentum:t,screenCenter:this.zoomCenterScreen,sceneCenter:this.beginScenePoint,radius:this.sphere[3]}):new Kd({view:this.view,momentum:t,zoomCenter:this.beginScenePoint});const i=this.rotationMomentumEstimator.evaluateMomentum();if(i)return new Yd({view:this.view,momentum:i,center:this.sphere,axis:this.rotationAxis});if(this.navMode===Io.Horizontal){const e=this.panSphericalMomentumEstimator.evaluateMomentum();if(e)return new Xd({view:this.view,momentum:e})}else{const e=this.panPlanarMomentumEstimator.evaluateMomentum();if(e)return new Wd({view:this.view,momentum:e})}return null}zoomSpherical(e){const t=this.beginRadius/e.radius,i=.001875*Math.min(Math.max(e.radius,40),120);this.smoothScaling.gain=i,this.smoothScaling.update(t),Ao(this.sphere,this.currentCamera,this.smoothScaling.value),Object(A["j"])(e.center,this.zoomCenterScreen),this.zoomMomentumEstimator.add(this.smoothScaling.value,.001*e.timestamp),this.constraintOptions.interactionType=1,this.constraintOptions.interactionFactor=_s(e.radius-this.beginRadius),ys(this.view,this.currentCamera,this.constraintOptions)}panningSpherical(e){const t=Object(A["j"])(e.center,this.tmpScreenPointArray);No(this.sphere,this.currentCamera,t,this.tmp3d),Jo(this.beginScenePoint,Object(Et["k"])(this.currentCamera.up,this.beginScenePoint),this.sphere[3],this.beginHeading,this.view.camera.tilt,this.startCamera)?(tc(this.sphere,this.currentCamera,this.beginScenePoint,this.tmp3d,this.beginHeading,this.view.camera.tilt,!1),this.panSphericalMomentumEstimator.addMomentumPreserveHeading(t,this.tmp3d,.001*e.timestamp,this.startCamera,this.sphere,this.beginHeading,this.view.camera.tilt)):(ec(this.sphere,this.currentCamera,this.beginScenePoint,this.tmp3d,this.view.camera.tilt,!1),this.panSphericalMomentumEstimator.addMomentumDirectRotation(t,this.tmp3d,.001*e.timestamp,this.startCamera,this.sphere[3],this.view.camera.tilt)),this.constraintOptions.interactionType=4,this.constraintOptions.interactionFactor=_s(this.screenPickPoint,t),ys(this.view,this.currentCamera,this.constraintOptions)}rotateSpherical(e){Object(Et["u"])(this.rotationAxis,this.scenePickPoint),this.currentCamera.aboveGround||Object(Et["v"])(this.rotationAxis,this.rotationAxis);const t=this.smoothRotation.value,i=t+wo(e.angle-t),r=.00125*Math.min(Math.max(e.radius,40),120);this.smoothRotation.gain=r,this.smoothRotation.update(i);const n=this.smoothRotation.value-this.beginAngle;this.rotationMomentumEstimator.add(n,.001*e.timestamp),So(this.currentCamera,this.sphere,ui(this.rotationAxis,n)),this.constraintOptions.interactionType=2,this.constraintOptions.interactionFactor=_s(e.radius*i),ys(this.view,this.currentCamera,this.constraintOptions)}panningPlanar(e){const t=Object(A["j"])(e.center,this.tmpScreenPointArray);Co(this.panningPlane,this.currentCamera,t,this.tmp3d)&&(Uo(this.currentCamera,this.beginScenePoint,this.tmp3d),this.panPlanarMomentumEstimator.add(t,this.tmp3d,.001*e.timestamp),this.constraintOptions.interactionType=4,this.constraintOptions.interactionFactor=_s(this.beginScreenPoint,t),this.constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this.tmpInteractionDirection),ys(this.view,this.currentCamera,this.constraintOptions),this.constraintOptions.interactionDirection=null)}zoomPlanar(e){const t=this.beginRadius/e.radius,i=.001875*Math.min(Math.max(e.radius,40),120);this.smoothScaling.gain=i,this.smoothScaling.update(t),this.zoomMomentumEstimator.add(this.smoothScaling.value,.001*e.timestamp),Po(this.currentCamera,this.beginScenePoint,this.smoothScaling.value,this.view.state.constraints.minimumPoiDistance),this.constraintOptions.interactionType=1,this.constraintOptions.interactionFactor=_s(e.radius-this.beginRadius),ys(this.view,this.currentCamera,this.constraintOptions)}rotatePlanar(e){Object(Et["n"])(this.rotationAxis,this.beginScenePoint),this.currentCamera.aboveGround||Object(Et["v"])(this.rotationAxis,this.rotationAxis);const t=this.smoothRotation.value;let i=e.angle-t;i=wo(i);const r=t+i,n=.00125*Math.min(Math.max(e.radius,40),120);this.smoothRotation.gain=n,this.smoothRotation.update(r);const a=this.smoothRotation.value-this.beginAngle;this.rotationMomentumEstimator.add(a,.001*e.timestamp),So(this.currentCamera,this.sphere,ui(this.rotationAxis,a)),this.constraintOptions.interactionType=2,this.constraintOptions.interactionFactor=_s(e.radius*a),ys(this.view,this.currentCamera,this.constraintOptions)}};Object(h["a"])([Object(M["b"])({constructOnly:!0})],lh.prototype,"view",void 0),lh=Object(h["a"])([Object(D["a"])("esri.views.3d.state.controllers.global.PinchAndPanController")],lh);const dh=Object(F["h"])(0,0,1),hh={ELEVATION_THRESHOLD:3e4,ANGLE_THRESHOLD:16/180*Math.PI},uh=80;let ph=class extends Hc{constructor(e){super(e),this.view=null,this.rotationValueSmooth=new qd(.05),this.scalingValueSmooth=new qd(.05),this.planeHorizontal=Object(mo["d"])(),this.planeVertical=Object(mo["d"])(),this.rotationMomentumEstimator=new oh["a"],this.panMomentumEstimator=new eh["a"](300,12,.9),this.zoomMomentumEstimator=new ch["a"],this.beginCenter=Object(F["f"])(),this.tmpPoints=[],this.beginCenterScreen=Object(A["g"])(),this.tmpCentroid3d=Object(F["f"])(),this.tmpCentroid2d=Object(A["g"])(),this.tmp2d=Object(A["g"])(),this.constraintOptions={selection:15,interactionType:0,interactionFactor:0,interactionStartCamera:new Fs["a"],interactionDirection:null,tiltMode:0}}get intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;const t=this.view.navigation.momentumEnabled;this.zoomMomentumEstimator.enabled=t,this.rotationMomentumEstimator.enabled=t,this.panMomentumEstimator.enabled=t,this.beginRadius=e.radius,this.pointerCount=e.pointers.size,this.beginAngle=e.angle,this.rotationValueSmooth.reset(),this.scalingValueSmooth.reset(),Object(A["j"])(e.center,this.beginCenterScreen),Object(mo["f"])(dh,0,this.planeHorizontal);const i=Object(F["f"])();this.intersectionHelper.intersectScreenFreePointFallback(this.beginCenterScreen,i);const r=Object(F["f"])();Object(Et["v"])(r,this.startCamera.viewForward);const n=Object(F["f"])();Object(Et["n"])(n,dh);const a=Object(Et["k"])(r,n),s=Object(Oe["d"])(a<0?-a:a);if(this.panMode=s>=hh.ANGLE_THRESHOLD?Io.Horizontal:Io.Vertical,Object(mo["u"])(this.planeHorizontal,i,this.planeHorizontal),this.startCamera.aboveGround||Object(mo["q"])(this.planeHorizontal,this.planeHorizontal),this.panMode===Io.Vertical){if(Object(Et["h"])(n,n,a),Object(Et["m"])(this.planeVertical,r,n),Object(Et["u"])(this.planeVertical,this.planeVertical),Object(mo["u"])(this.planeVertical,i,this.planeVertical),!Object(Ic["a"])()){const e=Object(F["f"])(),t=Object(F["f"])(),r=Object(F["f"])();Object(Et["m"])(e,i,this.currentCamera.eye),Object(Et["u"])(e,e);const n=5*Math.max(Math.abs(this.view.camera.position.z),50),a=this.view._stage.renderView.getMinimalDepthForArea(this.view.getVoxelWasmPerSceneView(),this.beginCenterScreen[0],this.beginCenterScreen[1],this.view.state.camera,uh),s=a?Math.min(a,n):n;Object(Et["n"])(r,Object(Et["i"])(t,this.currentCamera.eye,Object(Et["h"])(t,e,s))),this.planeVertical[3]=-Object(Et["k"])(this.planeVertical,r)}this.computePlanePoints(e.pointers,this.planeVertical,this.startCamera,this.tmpPoints),Ro(this.tmpPoints,this.beginCenter)}else this.computePlanePoints(e.pointers,this.planeHorizontal,this.startCamera,this.tmpPoints),Ro(this.tmpPoints,this.beginCenter);this.constraintOptions.interactionStartCamera.copyFrom(this.startCamera)}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const t=e.pointers.size>1,i=this.panMode===Io.Horizontal?this.planeHorizontal:this.planeVertical,r=this.beginCenter;if(t){const t=this.beginRadius/e.radius,i=.001875*Math.min(Math.max(e.radius,40),120);this.scalingValueSmooth.gain=i,this.scalingValueSmooth.update(t),Po(this.currentCamera,r,this.scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance),this.zoomMomentumEstimator.add(this.scalingValueSmooth.value,.001*e.timestamp),this.constraintOptions.interactionType=1,this.constraintOptions.interactionFactor=_s(Math.abs(e.radius-this.beginRadius)),ys(this.view,this.currentCamera,this.constraintOptions)}if(this.computePlanePoints(e.pointers,i,this.currentCamera,this.tmpPoints),Ro(this.tmpPoints,this.tmpCentroid3d),Object(A["j"])(e.center,this.tmpCentroid2d),Uo(this.currentCamera,r,this.tmpCentroid3d),this.panMomentumEstimator.add(this.tmpCentroid2d,this.tmpCentroid3d,.001*e.timestamp),this.constraintOptions.interactionType=4,this.constraintOptions.interactionFactor=_s(this.beginCenterScreen,this.tmpCentroid2d),ys(this.view,this.currentCamera,this.constraintOptions),t){const t=this.planeHorizontal,i=r,n=this.rotationValueSmooth.value,a=n+wo(e.angle-n),s=.00125*Math.min(Math.max(e.radius,40),120);this.rotationValueSmooth.gain=s,this.rotationValueSmooth.update(a);const o=this.rotationValueSmooth.value-this.beginAngle;this.rotationMomentumEstimator.add(o,.001*e.timestamp),So(this.currentCamera,i,ui(t,o)),this.constraintOptions.interactionType=2,this.constraintOptions.interactionFactor=_s(Math.abs(e.radius*o)),ys(this.view,this.currentCamera,this.constraintOptions)}}end(e){e.pointers.size===this.pointerCount&&this.update(e),this.finishController();const t=this.zoomMomentumEstimator.evaluateMomentum();if(t)return new Kd({view:this.view,momentum:t,zoomCenter:this.beginCenter});const i=this.rotationMomentumEstimator.evaluateMomentum();if(i)return new Yd({view:this.view,momentum:i,center:this.beginCenter,axis:Object(mo["r"])(this.planeHorizontal)});const r=this.panMomentumEstimator.evaluateMomentum();return r?new Wd({view:this.view,momentum:r}):null}computePlanePoints(e,t,i,r){r.length=e.size;const n=this.tmp2d;let a=0;return e.forEach(e=>{n[0]=e.x,n[1]=e.y,void 0===r[a]&&(r[a]=Object(F["f"])()),Co(t,i,n,r[a]),a+=1}),r}};Object(h["a"])([Object(M["b"])({constructOnly:!0})],ph.prototype,"view",void 0),ph=Object(h["a"])([Object(D["a"])("esri.views.3d.state.controllers.local.PinchAndPanController")],ph);class fh extends Nc["a"]{constructor(e,t,i){super(!0),this.view=e,this.pointerAction=t,this.lastEndTimestamp=0,this.lastTimestamp=0,this.registerIncoming("drag",i,e=>this.handleDrag(e))}handleDrag(e){if("mouse"===e.data.pointerType&&!Object(Gc["a"])(e.data,this.pointerAction))return;const t=e.timestamp-this.lastEndTimestamp,i=40,r=this.momentum&&this.momentum.active&&t<i;switch(e.data.action){case"start":case"update":if(r)break;this.controller&&this.controller.active?e.data.timestamp-this.lastTimestamp>2&&(this.controller.update(e.data),this.lastTimestamp=e.timestamp):this.startController(e);break;case"end":case"removed":this.endController(e,!0);break;case"added":this.endController(e,!1),this.startController(e)}e.stopPropagation()}endController(e,t){if(this.controller&&this.controller.active){this.lastEndTimestamp=e.timestamp;const i=this.controller.end(e.data);t&&i&&(this.momentum=i,this.view.state.switchCameraController(this.momentum))}this.controller=null}startController(e){this.controller=this.createController(),this.view.state.switchCameraController(this.controller),this.controller.begin(e.data),this.lastTimestamp=e.timestamp}createController(){return this.view.state.isGlobal?new lh({view:this.view}):new ph({view:this.view})}}class bh extends Nc["a"]{constructor(e,t){super(!0),this.view=e,this.registerIncoming("pointer-down",t,()=>this.view.state.stopActiveCameraController())}}class mh extends Nc["a"]{constructor(e,t){super(!0),this.key=e,this.registerIncoming("key-down",t,e=>this._handleKeyDown(e))}_handleKeyDown(e){e.data.key===this.key&&(this.activate(),e.stopPropagation())}}class gh extends mh{constructor(e,t,i){super(t,i),this.view=e}activate(){this.view.goTo({heading:0}).catch(()=>{})}}class vh extends mh{constructor(e,t,i){super(t,i),this.view=e}activate(){this.view.goTo({tilt:0}).catch(()=>{})}}class yh extends Nc["a"]{constructor(e,t=!1){super(!0),this.view=e,this.invert=t,this.registerIncoming("vertical-two-finger-drag",e=>this.handleTwoFinger(e))}handleTwoFinger(e){var t,i,r;const n=this.invert?-1:1,a=Object(A["g"])(0,e.data.delta*n);switch(e.data.action){case"begin":null==(t=this.cameraController)||t.end(),this.cameraController=new Zc({view:this.view,pivot:0}),this.view.state.switchCameraController(this.cameraController),this.cameraController.begin(a);break;case"update":null==(i=this.cameraController)||i.update(a);break;case"end":null==(r=this.cameraController)||r.end(),this.cameraController=null}}}var Oh=i("6345"),_h=i("2589"),xh=i("16d5"),jh=i("0f18"),wh=i("82a5"),Sh=i("e35b"),Th=i("bec4"),Ch=i("2b7b");class Ph extends Nc["a"]{constructor(e=20,t=40){super(!1),this._threshold=e,this._maxDelta=t,this.state="ready",this.emittedArtificalEnd2=!1,this._vertical=this.registerOutgoing("vertical-two-finger-drag"),this._artificalDrag=this.registerOutgoing("drag"),this.dragEventSeparator=new Ch["a"]({start:(e,t)=>this.observeStart(e,t),update:(e,t,i)=>this.observeUpdate(e,t,i),end:(e,t)=>this.observeEnd(t)}),this.registerIncoming("drag",e=>this.dragEventSeparator.handle(e))}get failed(){return"failed"===this.state}observeStart(e,t){1===e&&this.emittedArtificalEnd2&&(this.emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:t.data.button,buttons:t.data.buttons,pointerType:t.data.pointerType,timestamp:t.data.timestamp,pointers:t.data.pointers,pointer:t.data.pointer,angle:t.data.angle,radius:t.data.radius,center:t.data.center}),t.stopPropagation()),this.state=2===e?"ready":"failed"}observeUpdate(e,t,i){if("failed"!==this.state&&2===e)return"active"===this.state?(this._vertical.emit({delta:t.data.center.y-this._thresholdReachedCenter.y,action:"update"}),void t.stopPropagation()):void(this.checkMovementWithinLimits(t.data,i.data)?this.checkVerticalThresholdReached(t.data,i.data)&&(this.state="active",this.emittedArtificalEnd2=!0,this._thresholdReachedCenter=t.data.center,this._artificalDrag.emit({action:"end",button:t.data.button,buttons:t.data.buttons,pointerType:t.data.pointerType,timestamp:t.data.timestamp,pointers:t.data.pointers,pointer:t.data.pointer,angle:t.data.angle,radius:t.data.radius,center:t.data.center}),this._vertical.emit({delta:t.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),t.stopPropagation()):this.state="failed")}observeEnd(e){"active"===this.state&&(this._vertical.emit({delta:e.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this.state="ready",e.stopPropagation())}checkMovementWithinLimits(e,t){let i=-1/0,r=1/0,n=-1/0,a=1/0;t.pointers.forEach(e=>{i=Math.max(i,e.x),r=Math.min(r,e.x),n=Math.max(n,e.y),a=Math.min(a,e.y)});let s=-1/0,o=1/0,c=-1/0,l=1/0;e.pointers.forEach(e=>{s=Math.max(s,e.x),o=Math.min(o,e.x),c=Math.max(c,e.y),l=Math.min(l,e.y)});const d=i-r,h=n-a,u=s-o,p=c-l;return Math.abs(e.center.x-t.center.x)<this._threshold&&Math.abs(u-d)<=this._maxDelta&&Math.abs(p-h)<=this._maxDelta}checkVerticalThresholdReached(e,t){let i=Math.abs(e.center.y-t.center.y);return e.pointers.forEach((e,r)=>{const n=t.pointers.get(r);i=Math.min(i,Math.abs(e.y-n.y))}),i>=this._threshold}}let Ah=class extends W["a"]{constructor(){super(...arguments),this._handles=new $["a"]}destroy(){this._handles&&(this._handles.removeAll(),this._handles=null),this.disconnect()}get primaryDragAction(){return this._get("primaryDragAction")}set primaryDragAction(e){"pan"!==e&&"rotate"!==e||e===this._get("primaryDragAction")||(this._set("primaryDragAction",e),this._updateMode())}get mode(){return this._get("mode")}set mode(e){"default"!==e&&"pro"!==e||e===this._get("mode")||(this._set("mode",e),this._updateMode())}disconnect(){this.view.viewEvents.disconnect(),this._inputManager&&(this._inputManager.destroy(),this._inputManager=null),this._source&&(this._source.destroy(),this._source=null)}connect(){const e=this.view;this._source=new Oh["a"](this.view.surface,e.input);const t=[new wh["a"],new Sh["a"],new Th["b"],new jh["a"](this.view.navigation),new Ph],i=new _h["a"]({eventSource:this._source,recognizers:t});this._inputManager=i,i.installHandlers("prevent-context-menu",[new xh["a"]],_h["b"].INTERNAL),this._modeDragPan=new fh(e,"primary"),this._modeDragRotate=new Xc(e,"secondary",0),this._modeDragZoom=new tl(e,"tertiary");const r={lookAround:"b",pan:{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j",headingLeft:"a",headingRight:"d",tiltUp:"w",tiltDown:"s",zoomIn:"+",zoomOut:"-"},resetHeading:"n",resetTilt:"p"};i.installHandlers("navigation",[new bh(e),new qc(e),new Bd(e),new Nd(e,r.pan),new Gd(e),new vh(e,r.resetTilt),new gh(e,r.resetHeading),new Xc(e,"primary",1,[r.lookAround]),new Xc(e,"secondary",0,[r.lookAround]),new fh(e,"tertiary",[r.lookAround]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,new yh(e)],_h["b"].INTERNAL),this.view.viewEvents.connect(i),this._updateMode(),Object(C["a"])(this.view.navigation,"browserTouchPanEnabled",e=>{this._source.browserTouchPanningEnabled=!e})}_updateMode(){const e=this.mode,t=this.primaryDragAction,i=Mh.get(e).get(t);this._modeDragPan&&(this._modeDragPan.pointerAction=i.pan),this._modeDragRotate&&(this._modeDragRotate.pointerAction=i.rotate),this._modeDragZoom&&(this._modeDragZoom.pointerAction=i.zoom)}get test(){return{inputManager:this._inputManager,modeDragPan:this._modeDragPan,modeDragRotate:this._modeDragRotate,modeDragZoom:this._modeDragZoom}}};Object(h["a"])([Object(M["b"])()],Ah.prototype,"view",void 0),Object(h["a"])([Object(M["b"])({value:"pan"})],Ah.prototype,"primaryDragAction",null),Object(h["a"])([Object(M["b"])({value:"default"})],Ah.prototype,"mode",null),Object(h["a"])([Object(M["b"])({readOnly:!0,aliasOf:"_inputManager.hasPendingInputs"})],Ah.prototype,"hasPendingInputs",void 0),Object(h["a"])([Object(M["b"])({readOnly:!0,aliasOf:"_inputManager.latestPointerType"})],Ah.prototype,"latestPointerType",void 0),Object(h["a"])([Object(M["b"])()],Ah.prototype,"_inputManager",void 0),Ah=Object(h["a"])([Object(D["a"])("esri.views.3d.input.SceneInputManager")],Ah);const Mh=new Map,Rh=new Map,Eh=new Map;Rh.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"}),Rh.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"}),Eh.set("pan",{pan:"primary",rotate:"tertiary",zoom:"secondary"}),Eh.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"}),Mh.set("default",Rh),Mh.set("pro",Eh);const Dh=Ah;var Ih=i("28eb"),Fh=i("8a44"),zh=i("7577"),Lh=i("6611");let Vh,kh,Uh=!1,Bh=!1,Nh=!1,Gh=!1,qh=null;function Hh(e,t){if(!Bh||!kh)return;$h();const i=kh;let r=0;for(let n=0;n<e.accBinsNumX;n++)for(let t=0;t<e.accBinsNumY;t++){const a=e.accBins[n][e.accBinsNumY-1-t];r+=a.length;const s=n*e.accBinsSizeX,o=(n+1)*e.accBinsSizeX,c=t*e.accBinsSizeY,l=(t+1)*e.accBinsSizeY;i.fillText(a.length.toFixed(),s+5,c+15),Qh(s,o,c,l,"blue")}i.fillText("total totalShownLabels: "+r,70,40),i.fillText("total visible labels: "+t.size,70,50),i.fillText("total numTests: "+e.accNumTests,70,30)}function Wh(e){Nh=Lh["a"].DECONFLICTOR_SHOW_VISIBLE,Gh=Lh["a"].DECONFLICTOR_SHOW_INVISIBLE,Uh=Nh||Gh,Bh=Lh["a"].DECONFLICTOR_SHOW_GRID,qh=null,Uh||Bh?qh=()=>Zh(e):Vh&&(Vh.parentElement.removeChild(Vh),Vh=null)}function $h(){qh&&(qh(),qh=null)}function Zh(e){null==Vh&&(Vh=document.createElement("canvas"),Vh.setAttribute("id","canvas2d"),e.surface.parentElement.style.position="relative",e.surface.parentElement.appendChild(Vh));const t=e.width*e.pixelRatio,i=e.height*e.pixelRatio;Vh.setAttribute("width",t+"px"),Vh.setAttribute("height",i+"px"),Vh.setAttribute("style",`position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:${e.width}px;height:${e.height}px`),kh=Vh.getContext("2d"),kh.clearRect(0,0,e.width,e.height),kh.font="12px Arial"}function Qh(e,t,i,r,n){$h();const a=Vh.height,s=kh;s.beginPath(),s.lineWidth=1,s.strokeStyle=n,s.moveTo(e,a-i),s.lineTo(t,a-i),s.stroke(),s.lineTo(t,a-r),s.stroke(),s.lineTo(t,a-i),s.stroke(),s.lineTo(e,a-i),s.stroke(),s.lineTo(e,a-i),s.stroke(),s.closePath()}function Xh(e,t){Uh&&(t&&Nh||!t&&Gh)&&Qh(e.aabr[0],e.aabr[2],e.aabr[1],e.aabr[3],t?"green":"red")}var Yh=i("da1c"),Kh=i("2df1");const Jh=Object(F["f"])(),eu=Object(Dt["e"])(),tu=Object(Dt["e"])(),iu=Object(F["f"])(),ru=Object(Vt["d"])(),nu=Object(_n["c"])(),au=Object(xn["c"])(),su=Object(F["f"])(),ou=Object(V["m"])();class cu{constructor(){this.aabr=Object(V["m"])(),this.distance=0,this.culled=!1,this.visible=!1}}class lu{constructor(e,t,i={}){this.graphics3DGraphic=e,this.slicePlaneEnabled=t,this.info=i}}class du{constructor(){this.active=new Map,this.visible=new Map}clear(){this.active.clear(),this.visible.clear()}}class hu{}class uu{constructor(){this.sortArray=new Fh["a"]({allocator:e=>e||new hu})}}class pu{constructor(){this.camera=new Fs["a"],this.slicePlane=Object(k["d"])(),this.slicePlaneEnabled=!1}copyFrom(e){this.camera.copyFrom(e.camera),Object(k["b"])(e.slicePlane,this.slicePlane),this.slicePlaneEnabled=e.slicePlaneEnabled}}let fu=class extends W["a"]{constructor(){super(...arguments),this._dirty=!1,this._runningViewState=new pu,this._state=0,this.graphics=new du,this.iterators=new uu,this.accBinsNumX=15,this.accBinsNumY=20,this.accBinsSizeX=0,this.accBinsSizeY=0,this.accBins=null,this.accNumTests=0}get dirty(){return this._dirty}get state(){return this._state}destroy(){this.graphics.clear(),this.iterators=null}setDirty(){!this._dirty&&this.graphics.active.size>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){return 0!==this._state||this._dirty}get updatingProgress(){if(!this.updating)return 1;const e=this._state/4;return this._dirty?.5*e:e}get running(){return this.view.ready&&null!=this.view.state&&this.updating}runTask(e){switch(this._state){case 0:this.startUpdate(),e.madeProgress();case 1:if(this._state=1,!this.processActiveGraphics(e))return;case 2:if(this._state=2,!this.sortVisibleGraphics(e))return;case 3:if(this._state=3,!this.deconflictVisibleGraphics(e))return;default:Hh(this,this.graphics.visible),this._state=0,this.notifyChange("updating")}}modifyGraphics(e,t){t?e.forEach(e=>this.addToActiveGraphics(e)):e.forEach(e=>this.removeFromActiveGraphics(e)),this.setDirty()}layerSupportsDeconfliction(e){if(Object(w["k"])(e)||"object3d"!==e.type)return!1;const t=e.stageObject;return 1===(t?t.geometryRecords.length:0)&&t.geometryRecords[0].material instanceof Kh["a"]}startUpdate(){Wh(this.view),this._dirty=!1,this._runningViewState.copyFrom(this.viewState);const{fullWidth:e,fullHeight:t}=this._runningViewState.camera;this.initBins(e,t),this.resetIterators()}addToActiveGraphics(e){e.info[this.visibilityGroup]=new cu,this.graphics.active.set(e.graphics3DGraphic.graphic.uid,e),this.setDirty()}removeFromActiveGraphics(e){this.removeFromVisibleGraphics(e),bu(e,this.visibilityGroup),delete e.info[this.visibilityGroup],this.graphics.active.delete(e.graphics3DGraphic.graphic.uid),this.setDirty()}addToVisibleGraphics(e){this.graphics.visible.set(e.graphics3DGraphic.graphic.uid,e)}removeFromVisibleGraphics(e){this.graphics.visible.delete(e.graphics3DGraphic.graphic.uid)}processActiveGraphics(e){const t=this.ensureActiveGraphicsIterator(),i=Object(Lt["c"])(ru,this._runningViewState.camera.projectionMatrix),r="global"===this.view.viewingMode&&1===this.view.map.ground.opacity&&this._runningViewState.camera.relativeElevation>0?nu:null;let n=0;for(Object(w["l"])(r)&&(Object(Et["t"])(r,F["c"],this._runningViewState.camera.viewMatrix),r[3]=Object(zt["e"])(this.view.spatialReference).radius,n=Object(_n["d"])(r,F["c"]));!e.done;){e.madeProgress();const a=t.next();if(a.done)return this.resetActiveGraphicsIterator(),!0;const s=a.value,o=s&&s.info[this.visibilityGroup];o&&(this.collectGraphics3DGraphics(s,i,r,n),o.culled?this.removeFromVisibleGraphics(s):this.addToVisibleGraphics(s))}return!1}sortVisibleGraphics(e){const t=this.ensureSortGraphicsIterator();for(;!e.done;){const i=t.next();if(e.madeProgress(),i.done)return this.resetSortGraphicsIterator(),!0}return!1}deconflictVisibleGraphics(e){const t=this.ensureVisibleGraphicsIterator(),i=1===this.visibilityGroup;for(;!e.done;){e.madeProgress();const r=t.next();if(r.done)return this.resetVisibleGraphicsIterator(),!0;const n=r.value,a=n.info[this.visibilityGroup];if(!a||a.culled)continue;const s=n.graphics3DGraphic,o=(!i||s.isVisible())&&!this.isConflicted(n);o&&this.addToBins(n),a.visible=o,this.setGraphicVisibility(n,o),Xh(a,o)}return!1}resetIterators(){this.iterators.active=null,this.iterators.visible=null,this.iterators.sort=null}ensureActiveGraphicsIterator(){return this.iterators.active||(this.iterators.active=mu(this.graphics.active)),this.iterators.active}resetActiveGraphicsIterator(){this.iterators.active=null}ensureVisibleGraphicsIterator(){return this.iterators.visible||(this.iterators.visible=mu(this.graphics.visible)),this.iterators.visible}resetVisibleGraphicsIterator(){this.iterators.visible=null}ensureSortGraphicsIterator(){return this.iterators.sort||(this.iterators.sort=gu(this.graphics.visible,this.iterators.sortArray,this.visibilityGroup)),this.iterators.sort}resetSortGraphicsIterator(){this.iterators.sort=null}collectGraphics3DGraphics(e,t,i,r){const n=e.graphics3DGraphic;if(n.destroyed)return;const a=e.info[this.visibilityGroup];if(!n.isVisible(0,3))return void(a.culled=!0);const s=this.getGraphicsLayers(n);Object(V["o"])(a.aabr);let o=null;for(const c of s){if(!this.layerSupportsDeconfliction(c))continue;const n=c.stageObject.geometryRecords[0].material;if(Object(w["k"])(o)){if(o=this.getProjectionInfo(c,t,Ou),o.isOutsideScreen||this.isCulledBySlice(e,Jh)||Object(w["l"])(i)&&this.isCulledByHorizon(o,i,r))return void(a.culled=!0);!Lh["a"].TESTS_DISABLE_OPTIMIZATIONS&&a.visible&&(o.distance*=.7)}this.expandBoundingRect(a,c,n,o)}Object(w["k"])(o)?a.culled=!0:(a.distance=o.distance,a.culled=!1)}getProjectionInfo(e,t,i){const r=this._runningViewState.camera,n=e.stageObject,a=n.geometryRecords[0],s=a.material,o=Object(_n["g"])(n.boundingVolumeWorldSpace.bounds);Object(Et["t"])(Jh,o,r.viewMatrix);const c=a.geometry.vertexAttributes,l=c.get("normal").data,d=c.get("auxpos1").data;return s.applyShaderOffsetsView(Jh,l,n.transformation,d,r,i.scaleInfo,Jh),Object(zh["l"])(eu,Jh[0],Jh[1],Jh[2],1),Object(zh["m"])(tu,eu,r.projectionMatrix),Object(Et["h"])(i.positionNDC,tu,1/tu[3]),s.applyShaderOffsetsNDC(i.positionNDC,d,r,i.positionNDC,iu),i.distanceWithoutPolygonOffset=r.depthNDCToWorld(iu[2]),i.distance=iu[2]===i.positionNDC[2]?i.distanceWithoutPolygonOffset:r.depthNDCToWorld(i.positionNDC[2]),Object(zh["l"])(tu,i.positionNDC[0],i.positionNDC[1],i.positionNDC[2],1),Object(zh["m"])(eu,tu,t),Object(zh["b"])(eu,eu,1/eu[3]),Object(Et["z"])(i.positionView,Jh[0],Jh[1],Jh[2]),i}isCulledByHorizon(e,t,i){return Object(Et["n"])(au.direction,e.positionView),Object(Et["z"])(au.origin,0,0,0),!!Object(_n["e"])(t,au,su)&&e.distanceWithoutPolygonOffset>i}isCulledBySlice(e,t){return e.slicePlaneEnabled&&this._runningViewState.slicePlaneEnabled&&Object(k["f"])(this._runningViewState.slicePlane,t)}expandBoundingRect(e,t,i,{positionNDC:r,scaleInfo:n}){const a=this._runningViewState.camera,s=t.getScreenSize(vu);Object(Yh["a"])(s,n.factor,s),s[0]*=a.pixelRatio,s[1]*=a.pixelRatio;const o=Object(V["A"])(i.calculateRelativeScreenBounds(s,n.factorAlignment.scale,ou),Object(Oe["l"])(0,a.fullWidth,.5+.5*r[0]),Object(Oe["l"])(0,a.fullHeight,.5+.5*r[1])),c=this.iconMarginFactor;if(0!==c){const e=c*Math.min(Object(V["C"])(o),Object(V["v"])(o));o[0]-=e,o[1]-=e,o[2]+=e,o[3]+=e}Object(V["q"])(e.aabr,o,e.aabr)}isConflicted(e){const t=e.graphics3DGraphic.graphic.uid,i=e.info[this.visibilityGroup];for(let r=Math.floor(i.aabr[0]/this.accBinsSizeX);r<=Math.floor(i.aabr[2]/this.accBinsSizeX);r++)if(!(r<0||r>=this.accBinsNumX))for(let e=Math.floor(i.aabr[1]/this.accBinsSizeY);e<=Math.floor(i.aabr[3]/this.accBinsSizeY);e++){if(e<0||e>=this.accBinsNumY)continue;const n=this.accBins[r][e];for(let e=0;e<n.length;e++){const r=n.data[e],a=r.info[this.visibilityGroup];if(a&&a.visible&&r.graphics3DGraphic.graphic.uid!==t&&(this.accNumTests++,Object(V["x"])(a.aabr,i.aabr)))return!0}}return!1}initBins(e,t){if(null==this.accBins){this.accBins=[];for(let e=0;e<this.accBinsNumX;e++){this.accBins.push([]);const e=this.accBins[this.accBins.length-1];for(let t=0;t<this.accBinsNumY;t++)e.push(new Fh["a"])}}else for(let i=0;i<this.accBinsNumX;i++)for(let e=0;e<this.accBinsNumY;e++)this.accBins[i][e].clear();this.accBinsSizeX=e/this.accBinsNumX,this.accBinsSizeY=t/this.accBinsNumY,this.accNumTests=0}addToBins(e){const t=e.info[this.visibilityGroup],i=Math.floor(t.aabr[0]/this.accBinsSizeX),r=Math.floor(t.aabr[2]/this.accBinsSizeX),n=Math.floor(t.aabr[1]/this.accBinsSizeY),a=Math.floor(t.aabr[3]/this.accBinsSizeY);for(let s=i;s<=r;s++)if(!(s<0||s>=this.accBinsNumX))for(let t=n;t<=a;t++)t<0||t>=this.accBinsNumY||this.accBins[s][t].push(e)}setGraphicVisibility(e,t){const i=e.graphics3DGraphic;i.destroyed||(i.setVisibilityFlag(3,t,this.visibilityGroup),1===this.visibilityGroup&&this.view.labeler.setLabelGraphicVisibility(i,t))}};function bu(e,t){const i=e.graphics3DGraphic;i.destroyed||i.clearVisibilityFlag(3,t)}function*mu(e){if(Map.prototype.entries){const t=e.entries();for(let e=t.next();!e.done;e=t.next())yield e.value[1]}else yield*e.values()}function*gu(e,t,i){t.clear(),e.forEach((e,r)=>{const n=t.pushNew();n.id=r,n.prio=e.info?-e.info[i].distance:Number.MAX_VALUE}),yield;const r=t.iterableSort((e,t)=>t.prio-e.prio);for(let n=r.next();!n.done;n=r.next())yield;t.forAll(t=>{const i=e.get(t.id);i&&(e.delete(t.id),e.set(t.id,i))}),t.clear()}Object(h["a"])([Object(M["b"])({constructOnly:!0})],fu.prototype,"view",void 0),Object(h["a"])([Object(M["b"])({type:Boolean,readOnly:!0})],fu.prototype,"updating",null),fu=Object(h["a"])([Object(D["a"])("esri.views.3d.layers.graphics.Deconflictor")],fu);const vu=Object(Ut["b"])();class yu{constructor(){this.positionView=Object(F["f"])(),this.positionNDC=Object(F["f"])(),this.distance=0,this.distanceWithoutPolygonOffset=0,this.scaleInfo={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}}}get isOutsideScreen(){const e=this.positionNDC;return e[0]<-1||e[1]<-1||e[2]<-1||e[0]>=1||e[1]>=1}}const Ou=new yu,_u=2e3;let xu=class extends fu{constructor(){super(...arguments),this.visibilityGroup=1,this.iconMarginFactor=0,this._lastDeconfliction=0}get viewState(){return this.parent.viewState}runTask(e){if(this.parent.running)return;const t=performance.now();(2===e.state||t-this._lastDeconfliction>_u)&&(super.runTask(e),0===this.state&&(this._lastDeconfliction=t))}enabledChanged(e,t){this.modifyGraphics(t,e.labelsEnabled)}getGraphicsLayers(e){return e.labelGraphics}};Object(h["a"])([Object(M["b"])({constructOnly:!0})],xu.prototype,"parent",void 0),xu=Object(h["a"])([Object(D["a"])("esri.views.3d.layers.graphics.LabelDeconflictor")],xu);let ju=class extends fu{constructor(){super(...arguments),this._handles=new $["a"],this._contexts=new Map,this._viewState=new pu,this.visibilityGroup=0,this._iconMarginFactor=-.1}get labels(){return this._labels}get viewState(){return this._viewState}initialize(){this._handles.add([this.view.watch("state.camera",()=>{this.updateViewState(),this.setDirty()}),this.view.watch("map.ground.opacity",(e,t)=>{1!==e&&1!==t||this.setDirty()}),Object(C["a"])(this.view,"slicePlane",()=>{this.updateSlicePlane(),this.slicePlaneChanged()})]),this._frameTask=this.view.resourceController.scheduler.registerTask(Fi["b"].GRAPHICS_DECONFLICTOR,this),this._labels=new xu({view:this.view,parent:this})}destroy(){this._labels.destroy(),this._labels=null,this._handles.destroy(),this._handles=null,this._frameTask&&(this._frameTask.remove(),this._frameTask=null)}get iconMarginFactor(){return this._iconMarginFactor}set iconMarginFactor(e){this._iconMarginFactor=e,this.setDirty()}setDirty(){this._contexts.size>0&&(super.setDirty(),this._labels.setDirty())}runTask(e){super.runTask(e),this.running||this._labels.setDirty()}setInitialIconVisibilityFlag(e,t){const i=!(this._graphicSupportsDeconfliction(t)&&wu(e));t.setVisibilityFlag(3,i,0)}updateViewState(){this.view&&this.view.state&&(this._viewState.camera.copyFrom(this.view.state.camera),this.updateSlicePlane())}updateSlicePlane(){const e=this.view?this.view.slicePlane:null;Object(w["l"])(e)&&Object(k["m"])(e,this._viewState.camera.viewMatrix,this._viewState.slicePlane),this._viewState.slicePlaneEnabled=Object(w["l"])(e)}slicePlaneChanged(){Object(Ih["c"])(this._contexts,(e,t)=>t.symbolCreationContext.slicePlaneEnabled)&&this.setDirty()}addGraphicsOwner(e){let t=this._contexts.get(e);return null==t&&(t=new Map,this._contexts.set(e,t),this.setDirty()),{addGraphic:i=>this.addGraphic(e,t,i),removeGraphic:e=>this.removeGraphic(t,e),labelingInfoChange:()=>this._labels.enabledChanged(e,t),featureReductionChange:()=>this.enabledChanged(e,t),slicePlaneEnabledChange:()=>this._slicePlaneEnabledChanged(e,t),clear:()=>t.forEach(e=>this.removeGraphic(t,e.graphics3DGraphic))}}removeGraphicsOwner(e){const t=this._contexts.get(e);t&&(t.forEach(e=>this.removeGraphic(t,e.graphics3DGraphic)),this._contexts.delete(e),this.setDirty())}addGraphic(e,t,i){const r=i.graphic.uid,n=new lu(i,e.symbolCreationContext.slicePlaneEnabled);t.set(r,n),wu(e)&&this.addToActiveGraphics(n),e.labelsEnabled&&this._labels.addToActiveGraphics(n)}removeGraphic(e,t){const i=t.graphic.uid,r=e.get(i);r&&(this.removeFromActiveGraphics(r),this._labels.removeFromActiveGraphics(r),e.delete(i),this.setDirty())}enabledChanged(e,t){const i=wu(e);i||Su(e),this.modifyGraphics(t,i)}_slicePlaneEnabledChanged(e,t){const i=e.symbolCreationContext.slicePlaneEnabled;t.forEach(e=>e.slicePlaneEnabled=i),this.setDirty()}getGraphicsLayers(e){return e.graphics}_graphicSupportsDeconfliction(e){if(e.isDraped)return!1;const t=e.graphics;if(!t||!t.length)return!1;for(const i of t)if(this.layerSupportsDeconfliction(i))return!0;return!1}};function wu(e){const t=e.layer;return!(!t||!t.featureReduction||"selection"!==t.featureReduction.type)}function Su(e){const t=e.graphics3DGraphics;t&&t.forEach(e=>e.clearVisibilityFlag(3))}ju=Object(h["a"])([Object(D["a"])("esri.views.3d.layers.graphics.GraphicsDeconflictor")],ju);var Tu=i("792b"),Cu=i("d3cf"),Pu=i("ccac"),Au=i("38bf"),Mu=i("1a64"),Ru=i("e6bc"),Eu=i("6339"),Du=i("e384");function Iu(e){return e instanceof Du["a"]?e.graphics3DSymbol:e instanceof Eu["a"]?e:null}var Fu=i("4261");const zu=j["a"].getLogger("esri.views.3d.layers.graphics.labelPlacement");function Lu(e){const t=Xu(e);if(Object(w["k"])(t))return null;const i=Vu(e,t);if(Object(w["k"])(i))return null;const r=i.anchor,n=!!t.hasLabelVerticalOffset;return Gu({anchor:r,verticalOffset:t.verticalOffset,screenOffset:Object(Ut["b"])(),centerOffset:Object(Dt["g"])(0,0,0,-1),centerOffsetUnits:"world",translation:Object(F["f"])(),elevationOffset:0,hasLabelVerticalOffset:n},i,e)}function Vu(e,t){if(t.anchor)return t;const i=e.labelClass.labelPlacement,r=Ku[i],n=r||Nu(e);return i&&!r&&zu.warnOncePerTick(`the requested label placement '${i}' is not currently supported in SceneView`),Uu(n,e)}function ku(e){const t=e.graphics3DGraphic.graphics3DSymbol,i=Iu(t);return Object(w["l"])(i)?i.symbol.symbolLayers.getItemAt(0):null}function Uu(e,t){const i=t.graphics3DGraphic.graphic.geometry;if(Object(w["k"])(i))return null;if(Object(w["l"])(t.disablePlacement))return t.labelClass.labelPlacement?(zu.warnOncePerTick(Bu(e.placement,t.disablePlacement.logEntityDescription)),Nu(t)):e;const r=i.type;switch(r){case"polyline":case"polygon":case"extent":case"multipoint":if(t.labelClass.labelPlacement)return zu.warnOncePerTick(Bu(e.placement,`'${r}' geometries`)),Nu(t);break;case"point":case"mesh":return e}return e}function Bu(e,t){return`the requested label placement '${e}' is currently unsupported for ${t} in SceneView`}function Nu(e){const t=e.graphics3DGraphic.graphic.geometry;if(Object(w["k"])(t))return null;switch(t.type){case"polyline":case"extent":case"multipoint":return{placement:"center-center",normalizedOffset:null,anchor:"center"};case"polygon":{const t=ku(e);return Object(w["l"])(t)&&"extrude"===t.type?Ku["above-center"]:{placement:"center-center",normalizedOffset:null,anchor:"center"}}case"point":case"mesh":return Ku["above-center"];default:return}}function Gu(e,t,i){const r=i.graphics3DGraphic.graphic.geometry;if(Object(w["k"])(r))return null;switch(r.type){case"point":Hu(e,t,i);break;case"polygon":qu(e,t,i);break;case"mesh":Zu(e,t,i.graphics3DGraphic.graphics[0])}return e}function qu(e,t,i){const r=ku(i);if(!Object(w["k"])(r))switch(r.type){case"extrude":{const r=i.graphics3DGraphic.graphics[0];Object(w["l"])(r)?(r.getBoundingBoxObjectSpace(ip),Object(Fu["e"])(ip,e.translation),e.translation[2]=Object(Fu["v"])(ip)/2):Object(Et["z"])(e.translation,0,0,0),Zu(e,t,r);break}}}function Hu(e,t,i){const r=ku(i);if(Object(w["k"])(r))return;const n=i.graphics3DGraphic.graphics[0];switch(Object(w["l"])(n)?n.getCenterObjectSpace(e.translation):Object(Et["z"])(e.translation,0,0,0),r.type){case"icon":case"text":Wu(e,t,i,n);break;case"object":Zu(e,t,n)}}function Wu(e,t,i,r){const{graphics3DGraphic:n}=i,a=Object(w["l"])(r)?r.getScreenSize():null;if(!n.isDraped&&Object(w["l"])(a)){const r=$u(i);ep[0]=a[0]/2*(t.normalizedOffset[0]-r[0]),ep[1]=a[1]/2*(t.normalizedOffset[1]-r[1]),e.screenOffset[0]=ep[0],e.hasLabelVerticalOffset?(e.centerOffset[1]=ep[1],e.centerOffsetUnits="screen"):e.screenOffset[1]=ep[1]}else e.hasLabelVerticalOffset||"center"===e.anchor||(Ku[i.labelClass.labelPlacement]&&zu.warnOncePerTick(`the requested placement '${t.placement}' is currently unsupported for draped graphics`),e.anchor="center")}function $u(e,t=tp){const{graphics3DGraphic:i}=e,r=i.graphics[0],n=Object(w["l"])(r)?r.stageObject.geometryRecords[0].material:null;if(n&&n instanceof Kh["a"]){const e=n.parameters.anchorPos;t[0]=2*(e[0]-.5),t[1]=2*(e[1]-.5)}else t[0]=0,t[1]=0;return t}function Zu(e,t,i){const r=Object(w["l"])(i)?i.getBoundingBoxObjectSpace(ip):ip,n=Object(F["h"])(r[3]-r[0],r[4]-r[1],r[5]-r[2]),a=Math.sqrt(n[0]*n[0]+n[1]*n[1]);e.centerOffset[0]=a/2*t.normalizedOffset[0];const s=e.translation[2],o=n[2]/2*t.normalizedOffset[1];e.translation[2]=0,e.elevationOffset=s+o;const c=Object(Et["s"])(n);e.centerOffset[2]=c/2*t.normalizedOffset[2]}function Qu(e){return"above-center"===e}function Xu(e){const t=e.labelClass.labelPlacement,{labelSymbol:i,graphics3DGraphic:r}=e,n=Iu(r.graphics3DSymbol),a=Object(w["l"])(n)?n.symbol:null,s=Ku[t]||Nu(e);return"point-3d"===a.type&&a.supportsCallout()&&a.hasVisibleVerticalOffset()&&!r.isDraped?{placement:null,hasLabelVerticalOffset:!1,verticalOffset:Yu(a.verticalOffset),anchor:null,normalizedOffset:null}:!i||!i.hasVisibleVerticalOffset()||"point-3d"===a.type&&a.supportsCallout()&&a.verticalOffset&&!r.isDraped?{placement:null,verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}:Qu(s.placement)?{placement:"above-center",verticalOffset:Yu(i.verticalOffset),anchor:"bottom",normalizedOffset:[0,s.normalizedOffset[1],0],hasLabelVerticalOffset:!0}:(zu.errorOncePerTick("Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+t+" placement)"),null)}function Yu(e){const{screenLength:t,minWorldLength:i,maxWorldLength:r}=e;return{screenLength:t,minWorldLength:i,maxWorldLength:r}}const Ku={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",normalizedOffset:[1,0,0],anchor:"left"}},Ju={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],"center-right":["esriServerPointLabelPlacementCenterRight"]};for(const ET in Ju){const e=Ju[ET],t=Ku[ET];e.forEach(e=>{Ku[e]=t})}Object.freeze&&(Object.freeze(Ku),Object.keys(Ku).forEach((function(e){Object.freeze(Ku[e]),Object.freeze(Ku[e].normalizedOffset)})));const ep=[0,0],tp=[0,0],ip=Object(Fu["h"])();class rp{constructor(e){this._stage=e,this._materials=new Map}get(e){return this._materials.get(e)}add(e,t){this._materials.set(e,t),this._stage.add(t)}dispose(){this._stage.removeMany(Array.from(this._materials.values())),this._materials.clear()}}var np,ap=i("0494"),sp=i("a37d"),op=i("f2e0");const cp=512,lp=4096,dp=.85,hp=.95;let up=np=class extends W["a"]{constructor(e){super(e),this.type=4,this.id=Object(op["b"])(),this.events=new Z["a"],this._glTexture=null,this.needsClear=!1,this.elementsToAddOrUpdate=new Map,this.elementsToRemove=new Map,this.elementsToRender=new Map,this.elements=new Map,this.stageObjects=new Map,this.updating=!1}initialize(){this.stage=this.view._stage,this.canvas=this.create2DCanvas(),this.ctx=this.canvas.getContext("2d"),this.stage.add(this);const e=this.computeAtlasResolution(this.view.width,this.view.height);this.createAtlasRegion(e),this.update2DCanvasSize(),this.resetAtlasCursor()}unload(){this._glTexture=Object(w["f"])(this._glTexture),this.updating=!1,this.events.emit("unloaded")}get width(){return this.atlas.size.width}get height(){return this.atlas.size.height}get requiresFrameUpdates(){return!1}createDescriptor(e){return{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,flipped:!0,samplingMode:9987,hasMipmap:!0,preMultiplyAlpha:!0,maxAnisotropy:e.parameters.maxMaxAnisotropy}}get glTexture(){return this._glTexture}load(e){return Object(w["l"])(this._glTexture)||(this._glTexture=new ir["a"](e,this.createDescriptor(e),this.canvas),this.frameWorker=this.view.resourceController.scheduler.registerTask(Fi["b"].TEXT_TEXTURE_ATLAS,this),this.setDirty()),this._glTexture}dispose(){this.elements=null,this.elementsToAddOrUpdate=null,this.elementsToRemove=null,this.elementsToRender=null,this.frameWorker=Object(w["t"])(this.frameWorker),this._glTexture&&(this.stage.remove(this),this._glTexture=Object(w["f"])(this._glTexture)),this.canvas.width=0,this.canvas.height=0,this.canvas=null,this.ctx=null}create2DCanvas(){const e=document.createElement("canvas");return e.setAttribute("id","canvas2d"),e.setAttribute("style","display:none"),e.setAttribute("width",cp.toString()),e.setAttribute("height",cp.toString()),e}update2DCanvasSize(){this.canvas.setAttribute("width",this.atlas.size.width.toString()),this.canvas.setAttribute("height",this.atlas.size.height.toString())}createAtlasRegion(e=cp){this.atlas={size:{width:e,height:e},cursor:{x:0,y:0},lineHeight:0}}computeAtlasResolution(e,t){let i=Math.max(e,t);return i+=256,i=Object(Oe["n"])(i),i=Math.min(i,lp),i}resizeAtlas(e,t){t=t||e;const i=this.atlas;i.size.width=e,i.size.height=t,Object(w["l"])(this._glTexture)&&this._glTexture.resize(e,t),this.update2DCanvasSize()}resetAtlasCursor(){const e=this.atlas;e.cursor.x=pp,e.cursor.y=pp+fp,e.lineHeight=0,this.needsClear=!0}getAtlasUsage(){const e=this.atlas;return(e.cursor.x+e.cursor.y*e.size.width)/(e.size.width*e.size.height)}getExpectedAtlasUsage(){const e=this.elementsToRemove.size,t=this.elementsToAddOrUpdate.size,i=this.elements.size;return this.getAtlasUsage()/i*(i+t-e)}addAtlasElement(e,t,i,r){const n=this.atlas,{renderedWidth:a,renderedHeight:s,displayWidth:o,displayHeight:c}=e.textRenderer;e.placement.offset.x=n.cursor.x,e.placement.offset.y=n.cursor.y,e.placement.size.width=a,e.placement.size.height=s,e.placement.size.displayWidth=o,e.placement.size.displayHeight=c,e.placement.uvMinMax=[e.placement.offset.x/n.size.width,1-(e.placement.offset.y+s)/n.size.height,(e.placement.offset.x+a)/n.size.width,1-e.placement.offset.y/n.size.height],n.cursor.x+=i,n.lineHeight=Math.max(n.lineHeight,r),this.elements.set(t,e)}removeAtlasElement(e){if(e&&this.elements.has(e.textId)){const t=e.placement.offset,i=e.placement.size;this.ctx.clearRect(t.x,t.y,i.width,i.height),this.elements.delete(e.textId)}}ensureStageObjects(e){const t=this.stageObjects.get(e);if(t)return t;const i=new Set;return this.stageObjects.set(e,i),i}addStageObject(e,t){this.ensureStageObjects(e).add(t)}removeStageObject(e,t){const i=this.stageObjects.get(e);i&&i.delete(t)&&(t.geometries[0].vertexAttributes.get("size").data=[0,0],t.geometryVertexAttrsUpdated(t.geometryRecords[0]))}_processAddition(e,t){const i=this.atlas,r=e.textId,n=e.textRenderer.renderedWidth,a=e.textRenderer.renderedHeight,s=n+pp,o=a+pp+fp;if(i.cursor.x+s<i.size.width&&i.cursor.y+o<i.size.height)this.addAtlasElement(e,r,s,o),this.elementsToRender.set(r,e),this.elementsToAddOrUpdate.delete(r);else{if(!(i.cursor.y+o+i.lineHeight<i.size.height)){const e=this.getExpectedAtlasUsage(),r=e>dp&&i.size.width<lp;return r&&this.resizeAtlas(2*i.size.width,2*i.size.height),!t||!r&&e>hp&&i.size.width===lp?(this.processRemovals(),0):(this.repack(),1)}i.cursor.x=pp,i.cursor.y+=i.lineHeight,i.lineHeight=0,this.addAtlasElement(e,r,s,o),this.elementsToRender.set(r,e),this.elementsToAddOrUpdate.delete(r)}return 0}processRemovals(){this.elementsToRemove.forEach((e,t)=>{const i=this.stageObjects.get(t);i&&0!==i.size||this.removeAtlasElement(e),i&&0===i.size&&this.stageObjects.delete(t)}),this.elementsToRemove.clear()}repack(){this.processRemovals(),this.elements.forEach((e,t)=>{e.rendered=!1,this.elementsToAddOrUpdate.set(t,e)}),this.elements.clear(),this.resetAtlasCursor(),this.elementsToRender.clear()}processRenderingRequest(e){this.ctx.clearRect(e.placement.offset.x,e.placement.offset.y,e.placement.size.width,e.placement.size.height),e.textRenderer.render(this.ctx,e.placement.offset.x,e.placement.offset.y);const t=this.stageObjects.get(e.textId);t&&t.forEach(t=>{t.geometries[0].vertexAttributes.get("uv0").data=new Float32Array(e.placement.uvMinMax),t.geometries[0].vertexAttributes.get("size").data=[e.placement.size.displayWidth,e.placement.size.displayHeight],t.geometryVertexAttrsUpdated(t.geometryRecords[0])}),e.rendered=!0}get running(){return this.updating}runTask(e,t=!0){if(!this._glTexture)return;let i=!1;if(Object(Ih["c"])(this.elementsToAddOrUpdate,(e,r)=>{const n=this.elements.get(r);if(n&&n.rendered){const e=this.stageObjects.get(r);return e&&e.forEach(e=>{const t=e.geometries[0].vertexAttributes,i=this.elements.get(r);t.get("uv0").data=new Float32Array(i.placement.uvMinMax),t.get("size").data=new Float32Array([i.placement.size.displayWidth,i.placement.size.displayHeight]),e.geometryVertexAttrsUpdated(e.geometryRecords[0])}),this.elementsToAddOrUpdate.delete(r),!1}return 1===this._processAddition(this.elementsToAddOrUpdate.get(r),t)&&(i=!0,!0)}),i)return void this.runTask(Fi["d"],!1);let r=!1;this.elementsToRender.size>0&&this.needsClear&&(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.needsClear=!1),Object(Ih["c"])(this.elementsToRender,(t,i)=>(this.processRenderingRequest(t),this.elementsToRender.delete(i),r=!0,e.madeProgress(),e.done)),r&&Object(w["l"])(this._glTexture)&&this._glTexture.setData(this.canvas),this.updating=this.elementsToRender.size>0,!this.updating&&np.test.orderedRepackingEnabled&&this.repackOrdered()}addTextTexture(e,t){const i=e.key;this.elementsToAddOrUpdate.has(i)||this.elementsToAddOrUpdate.set(i,{textId:i,placement:{offset:{x:0,y:0},size:{width:0,height:0,displayWidth:0,displayHeight:0},uvMinMax:[]},textRenderer:e,rendered:!1}),this.addStageObject(i,t),this.elementsToRemove.delete(i),this.setDirty()}removeTextTexture(e,t){const i=e.key;this.elementsToRemove.set(i,this.elements.get(i)),this.removeStageObject(i,t)}setDirty(){this._glTexture&&(this.updating=!0)}repackOrdered(){if(0===this.elements.size)return;const e=[];this.elements.forEach((t,i)=>e.push({element:t,key:i}));let t=!0;for(let i=0;i<e.length-1;i++)if(e[i].key.localeCompare(e[i+1].key)>0){t=!1;break}if(!t||this.elementsToRemove.size){e.sort((e,t)=>e.key.localeCompare(t.key)),this.elements.clear();for(const{element:t,key:i}of e)this.elements.set(i,t);this.repack(),this.setDirty()}}get test(){const{elements:e,stageObjects:t,elementsToRemove:i,atlas:r}=this,n=this;return{elements:e,stageObjects:t,elementsToRemove:i,atlas:r,resizeAtlas:(e,t)=>n.resizeAtlas(e,t),run:(e,t)=>n.runTask(e,t)}}};up.test={orderedRepackingEnabled:!1},Object(h["a"])([Object(M["b"])({constructOnly:!0})],up.prototype,"view",void 0),Object(h["a"])([Object(M["b"])({type:Boolean})],up.prototype,"updating",void 0),up=np=Object(h["a"])([Object(D["a"])("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],up);const pp=2,fp=2,bp=up;var mp=i("748f");const gp=j["a"].getLogger("esri.views.3d.layers.graphics.Labeler");let vp=class extends W["a"]{constructor(){super(...arguments),this._dirty=!1,this._labels=new Map,this._labelsToAdd=new Map,this._labelsToRemove=new Map,this._labelingContexts=new Array}setup(){this.dispose(),this._handles=new $["a"],this._handles.add([this.view.watch("state.camera",()=>this.setDirty()),this.view.watch("pixelRatio",()=>this._resetAllLabels()),this.view.resourceController.scheduler.registerTask(Fi["b"].LABELER,this)]),this._textTextureAtlas=new bp({view:this.view}),this._hudMaterialCollection=new rp(this.view._stage),this._calloutMaterialCollection=new rp(this.view._stage)}dispose(){this._handles=Object(w["e"])(this._handles),this._textTextureAtlas=Object(w["f"])(this._textTextureAtlas),this._hudMaterialCollection=Object(w["f"])(this._hudMaterialCollection),this._calloutMaterialCollection=Object(w["f"])(this._calloutMaterialCollection),this._labelingContexts.length=0,this._labels.clear(),this._labelsToAdd.clear(),this._labelsToRemove.clear()}_activateLabelingContext(e){e.labels.forEach((e,t)=>{this._labels.set(t,e),e.graphics3DGraphic.setVisibilityFlag(0,!0,1)}),e.active=!0}_deactivateLabelingContext(e){e.labels.forEach((e,t)=>{e.graphics3DGraphic.setVisibilityFlag(0,!1,1),this.setLabelGraphicVisibility(e.graphics3DGraphic,!1),this._labels.delete(t)}),e.active=!1}_addLabelTextureToAtlas(e){for(const t of e.graphics3DGraphic.labelGraphics){if(!t._labelClass)continue;const i=e.textRenderers[t._labelIndex];i&&this._textTextureAtlas.addTextTexture(i,t.stageObject)}e.rendered=!0}_removeLabelTextureFromAtlas(e){for(const t of e.graphics3DGraphic.labelGraphics){if(!t._labelClass)continue;const i=e.textRenderers[t._labelIndex];i&&this._textTextureAtlas.removeTextTexture(i,t.stageObject)}e.rendered=!1}get running(){var e;return!!this.view.ready&&(this._dirty||(null==(e=this._textTextureAtlas)?void 0:e.updating)||this.deconflictor.running)}runTask(e){this._updateLabels(e),!this._dirty&&this.deconflictor.running&&this.deconflictor.runTask(e)}_updateLabels(e){if(this._dirty){this._dirty=!1;for(const t of this._labelingContexts)if(yp(t)){if(!_p(t)){if(xp(t)){this._deactivateLabelingContext(t);continue}if(this._createLabelClassContext(t),Op(t)){this._dirty=!0;continue}if(!_p(t))continue}Object(Ih["c"])(t.labelsToInitialize,(i,r)=>(this._ensureGraphics3DResources(i)&&(this._labels.set(r,i),this.deconflictor.setDirty(),e.madeProgress()),(i.visible&&i.hasTextTextureResources||!i.visible&&i.hasGraphics3DResources)&&(t.labelsToInitialize.delete(r),e.madeProgress()),e.done))&&(this._dirty=!0)}this._labelsToRemove.forEach(e=>this._removeLabelTextureFromAtlas(e)),this._labelsToAdd.forEach(e=>this._addLabelTextureToAtlas(e)),this._labelsToRemove.clear(),this._labelsToAdd.clear(),this._dirty||this.notifyChange("updating")}}async _createLabelClassContextAsync(e){const t=e.labelClassAbortController.signal;await e.layer.when(),Object(S["w"])(t),e.scaleVisibility&&e.scaleVisibility.updateScaleRangeActive();const i=e.graphics3DCore,r=i.layer,n=r.labelingInfo&&r.labelingInfo.filter(e=>!!e.symbol);if(!n||0===n.length)return;const a=new Array(n.length);let s=!1;await Object(Tu["b"])(n,async(r,n)=>{const o=r.symbol,c=Iu(i.getOrCreateGraphics3DSymbol(o));if(Object(w["k"])(c))return void gp.error("Failed to create Graphics3DSymbol for label");await c.load(),Object(S["w"])(t);let l=null;Object(Au["d"])(o)&&o.hasVisibleCallout()&&(l=Object(Mu["a"])(o,i.symbolCreationContext),await l.load(),Object(S["w"])(t));const d=await Object(Tu["d"])(Object(Pu["createLabelFunction"])(r,e.layer.fieldsIndex,this.view.spatialReference));Object(S["w"])(t),!0===d.ok?a[n]={labelClass:r,labelFunction:d.value,graphics3DSymbol:c,graphics3DCalloutSymbolLayer:l,calloutSymbolLayerIndex:0,textRenderParameters:this._createTextRenderParameters(c.symbol)}:(gp.error("Label expression failed to evaluate: "+d.error),s=!0)}),Object(S["w"])(t),s||(e.labelClassContexts=a)}async _createLabelClassContext(e){return e.labelClassPromise||(e.labelClassPromise=this._createLabelClassContextAsync(e).catch(t=>{if(Object(S["m"])(t))throw t;e.labelClassContexts=null}).then(()=>{e.labelClassAbortController=null,this.notifyChange("updating")}).catch(()=>{}),this.notifyChange("updating")),e.labelClassPromise}_createTextRenderParameters(e){const t=e.symbolLayers.getItemAt(0);return t&&"text"===t.type?sp["a"].fromSymbol(t,this.view.pixelRatio):null}_destroyLabelClassContext(e){for(const i of e.labelClassContexts)--i.graphics3DSymbol.referenced,i.graphics3DSymbol=null;const t=e.labelClassAbortController;e.labelClassAbortController=new AbortController,t&&t.abort(),e.labelClassContexts=[],e.labelClassPromise=null,this.notifyChange("updating")}_createTextSymbolGraphic(e,t,i,r,n){const a={text:e.text,centerOffset:i.centerOffset,translation:i.translation,elevationOffset:i.elevationOffset,screenOffset:i.screenOffset,anchor:i.anchor,centerOffsetUnits:i.centerOffsetUnits,verticalOffset:i.verticalOffset,debugDrawBorder:Lh["a"].LABELS_SHOW_BORDER,displayWidth:e.displayWidth,displayHeight:e.displayHeight};return jp.graphic=t,jp.renderingInfo=null,jp.layer=r,n.createLabel(jp,a,this._hudMaterialCollection,this._textTextureAtlas)}_createLineCalloutGraphic(e,t,i,r,n){const a={symbol:t,translation:r.translation,elevationOffset:r.elevationOffset,screenOffset:r.screenOffset,centerOffset:r.centerOffset,centerOffsetUnits:r.centerOffsetUnits,materialCollection:this._calloutMaterialCollection};return jp.graphic=e,jp.renderingInfo=a,jp.layer=n,i.createGraphics3DGraphic(jp)}_ensureGraphics3DResources(e){if(e.hasGraphics3DResources)return!1;const t=e.graphics3DGraphic;if(t.destroyed)return!1;this._ensureTextTextureResources(e);const i=e.labelingContext,r=i.labelClassContexts;if(!r||0===r.length||!i.emptySymbolLabelSupported&&0===t.graphics.length)return!1;let n=!1;const a=t.graphic,s=i.layer,o=Object(G["a"])(i.layer),c=this.view._stage;for(let l=0;l<r.length;l++){const d=e.textRenderers[l];if(!d)continue;const h=r[l],u=h.graphics3DSymbol;let p=null;u.symbol&&"label-3d"===u.symbol.type&&(p=u.symbol);const f=u.symbolLayers[0];if(!f)continue;const b=h.labelClass,m=i.disablePlacement,g=Lu({graphics3DGraphic:t,labelSymbol:p,labelClass:b,disablePlacement:m});if(Object(w["k"])(g))continue;f.setElevationInfoOverride(i.elevationInfoOverride);const v=this._createTextSymbolGraphic(d,a,g,s,f);if(!v)return!1;v._labelClass=b,v._labelIndex=l,t.addLabelGraphic(v,c,i.stageLayer),t.setVisibilityFlag(0,o,1),t.clearVisibilityFlag(1,1),t.setVisibilityFlag(3,!1,1),n=!0;const y=h.graphics3DCalloutSymbolLayer;if(y&&g.hasLabelVerticalOffset){y.setElevationInfoOverride(i.elevationInfoOverride);const e=this._createLineCalloutGraphic(a,p,y,g,s);e&&(h.calloutSymbolLayerIndex=t.labelGraphics.length,t.addLabelGraphic(e,c,i.stageLayer))}break}return i.scaleVisibility&&n&&i.scaleVisibility.updateGraphicLabelScaleVisibility(t),e.hasGraphics3DResources=!0,!0}_destroyGraphics3DResources(e){const t=e.labelingContext.labelClassContexts;for(const i of e.graphics3DGraphic.labelGraphics){if(null==i._labelClass)continue;const e=t[i._labelIndex].graphics3DSymbol.symbolLayers[0];null!=e&&e.onRemoveGraphic(i)}e.graphics3DGraphic.clearLabelGraphics(),e.hasGraphics3DResources=!1}_ensureTextTextureResources(e){if(e.hasTextTextureResources)return;const t=e.labelingContext,i=t.labelClassContexts;if(!i||0===i.length)return;const r=e.graphics3DGraphic.graphic;for(let a=0;a<i.length;a++){const s=i[a];if(e.textRenderers[a]=null,!s.textRenderParameters)continue;const o=s.labelFunction;let c;if("arcade"===o.type)try{const e=o.needsHydrationToEvaluate()?Object(Cu["c"])(r,t.layer):r;c=o.evaluate(e)}catch(n){c=null}else c=o.evaluate(r);Object(w["k"])(c)||""===c||/^\s+$/.test(c)||(e.textRenderers[a]=new ap["a"](c,s.textRenderParameters))}e.hasTextTextureResources=!0}_destroyTextTextureResources(e){e.textRenderers=[],e.hasTextTextureResources=!1}_addGraphic(e,t){const i={hasGraphics3DResources:!1,hasTextTextureResources:!1,visible:!1,rendered:!1,labelingContext:e,graphics3DGraphic:t,textRenderers:[]},r=t.graphic.uid;e.labels.set(r,i),e.labelsToInitialize.set(r,i),this.setDirty(),this.deconflictor.setDirty()}_removeGraphic(e,t){const i=t.graphic.uid,r=e.labels.get(i);r&&(this._destroyGraphic(r,i),e.labels.delete(i),e.labelsToInitialize.delete(i),this.setDirty(),this.deconflictor.setDirty())}_destroyGraphic(e,t){this._labels.has(t)&&(this._labels.delete(t),this._labelsToAdd.delete(t),this._labelsToRemove.delete(t)),e.hasTextTextureResources&&(this._removeLabelTextureFromAtlas(e),this._destroyTextTextureResources(e)),e.hasGraphics3DResources&&this._destroyGraphics3DResources(e)}async _labelingInfoChange(e,t){if(!t)return this._visibilityInfoChange(e),this._resetLabels(e),this._createLabelClassContext(e);for(const i of t){const t=e.labels.get(i);t&&(this._removeGraphic(e,t.graphics3DGraphic),this._addGraphic(e,t.graphics3DGraphic))}}_globalPropertyChanged(e,t){for(const i of t.labelClassContexts){const r=new Map;t.labels.forEach(e=>{const t=e.graphics3DGraphic;r.set(t.graphic.uid,t)});const n=e=>e.labelGraphics[0];if(Object(w["u"])(i.graphics3DSymbol.symbolLayers[0]).globalPropertyChanged(e,r,n),i.graphics3DCalloutSymbolLayer){const t=e=>e.labelGraphics[i.calloutSymbolLayerIndex];i.graphics3DCalloutSymbolLayer.globalPropertyChanged(e,r,t)}}}_visibilityInfoChange(e){const t=e.layer.labelsVisible;t&&!e.active&&this._activateLabelingContext(e),!t&&e.active&&this._deactivateLabelingContext(e),this.setDirty()}_resetAllLabels(){for(const e of this._labelingContexts)this._resetLabels(e)}_resetLabels(e){e.labels.forEach((t,i)=>{this._destroyGraphic(t,i),t.visible=!1,t.rendered=!1,e.labelsToInitialize.set(i,t)}),this._destroyLabelClassContext(e),this.setDirty(),this.deconflictor.setDirty()}_findLabelingContext(e){for(const t of this._labelingContexts)if(t.graphics3DCore===e)return t;return null}addGraphicsOwner(e,t,i){const r=i&&i.emptySymbolLabelSupported||!1,n=i&&i.elevationInfoOverride||null,a=i&&i.disablePlacement||null;if(this._findLabelingContext(e))return;const s=e.layer,o={graphics3DCore:e,layer:s,scaleVisibility:t,emptySymbolLabelSupported:r,elevationInfoOverride:n,disablePlacement:a,active:s.labelsVisible,labelClassPromise:null,labelClassAbortController:new AbortController,labelClassContexts:[],labels:new Map,labelsToInitialize:new Map,stageLayer:new mp["a"]({isPickable:!0},s.uid)};return this.view._stage.add(o.stageLayer),this._labelingContexts.push(o),this.setDirty(),{addGraphic:e=>this._addGraphic(o,e),removeGraphic:e=>this._removeGraphic(o,e),featureReductionChange:()=>{},layerLabelsEnabled:()=>Object(G["a"])(o.layer),labelingInfoChange:e=>this._labelingInfoChange(o,e),elevationInfoChange:()=>this._globalPropertyChanged("elevationInfo",o),slicePlaneEnabledChange:()=>this._globalPropertyChanged("slicePlaneEnabled",o),visibilityInfoChange:()=>this._visibilityInfoChange(o),reset:()=>this._resetLabels(o),clear:()=>{}}}removeGraphicsOwner(e){const t=this._findLabelingContext(e);if(!t)return;const i=this._labelingContexts.indexOf(t);this._labelingContexts.splice(i,1),t.labels.forEach(e=>this._removeGraphic(t,e.graphics3DGraphic)),this.view._stage.remove(t.stageLayer),t.stageLayer=null,this.setDirty()}setLabelGraphicVisibility(e,t){const i=e.graphic.uid,r=this._labels.get(i);r&&r.visible!==t&&(t&&!r.rendered?(this._labelsToAdd.set(i,r),this._labelsToRemove.delete(i),r.hasTextTextureResources||r.labelingContext.labelsToInitialize.set(i,r)):!t&&r.rendered&&(this._labelsToRemove.set(i,r),this._labelsToAdd.delete(i)),r.visible=t,this.setDirty())}setDirty(){!this._dirty&&this._labelingContexts.length>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){var e;return this._dirty||(null==(e=this._textTextureAtlas)?void 0:e.updating)||this.deconflictor.updating||this._labelingContexts.some(e=>Op(e))}get updatingProgress(){if(!this.updating||!this._textTextureAtlas)return 1;const e=this._labelingContexts.length>0?this._labelingContexts.reduce((e,t)=>e+(Op(t)?0:1),0)/this._labelingContexts.length:1;return(this._dirty?0:.3)+(this._textTextureAtlas.updating?0:.1)+.1*e+.5*this.deconflictor.updatingProgress}get test(){return{textTextureAtlas:this._textTextureAtlas,resetAllLabels:()=>this._resetAllLabels()}}};function yp(e){return e.active&&Object(G["a"])(e.layer)}function Op(e){return e.labelClassPromise&&!!e.labelClassAbortController}function _p(e){return e.labelClassContexts&&e.labelClassContexts.length}function xp(e){return null===e.labelClassContexts}Object(h["a"])([Object(M["b"])({constructOnly:!0})],vp.prototype,"view",void 0),Object(h["a"])([Object(M["b"])({constructOnly:!0})],vp.prototype,"deconflictor",void 0),Object(h["a"])([Object(M["b"])()],vp.prototype,"_textTextureAtlas",void 0),Object(h["a"])([Object(M["b"])({type:Boolean,readOnly:!0})],vp.prototype,"updating",null),vp=Object(h["a"])([Object(D["a"])("esri.views.3d.layers.graphics.Labeler")],vp);const jp=new Ru["a"](null,null,null);var wp=i("2b60"),Sp=i("3c3b"),Tp=i("22f5");class Cp{constructor(){this.gltfCache=new Map,this.wosrCache=new Map,this.evictHandles=new $["a"]}loadGLTF(e,t,i){const r=i?"gltfPBR:"+e:"gltf:"+e;return this.fromCache(this.gltfCache,r,t=>Object(Sp["a"])(new wp["a"](t.streamDataRequester),e,t,i),t)}loadWOSR(e,t){const i=`wosr:${e}:${t.disableTextures}`;return this.fromCache(this.wosrCache,i,t=>Object(Tp["a"])(e,t),t)}destroy(){this.evictHandles.destroy(),this.gltfCache.clear(),this.wosrCache.clear()}get size(){return this.wosrCache.size+this.gltfCache.size}fromCache(e,t,i,r){return new Promise((n,a)=>{if(Object(S["n"])(r))return void a(Object(S["e"])());const s=Object(S["r"])(r,()=>{this.remove(e,t),a(Object(S["e"])())}),o=e.get(t);if(o)return this.evictHandles.remove(t),o.refCount++,void o.item.then(n,a);const c=new AbortController,l={...r,signal:c.signal},d={refCount:1,abortController:c,item:i(l).then(i=>(d.abortController=null,i.remove=()=>this.remove(e,t),i))};e.set(t,d),d.item.then(e=>{Object(w["l"])(s)&&s.remove(),n(e)},e=>{Object(w["l"])(s)&&s.remove(),a(e)})})}remove(e,t){const i=e.get(t);i&&(i.refCount--,0===i.refCount&&this.evictHandles.add(Object(O["e"])(()=>{e.delete(t),Object(w["l"])(i.abortController)&&i.abortController.abort()},Ap),t))}}const Pp=1e4;let Ap=Pp;class Mp{constructor(e,t,i,r=null){this.lij=[0,0,0],this.extent=Object(V["m"])(),this.resolution=0,this.loadPriority=0,this.measures={visibility:2,screenRect:Object(V["m"])(),distance:0,shouldSplit:!1},this.used=!1,r&&this.acquire(e,t,i,r)}acquire(e,t,i,r){this.tilingScheme=r,this.id=Mp.id(e,t,i),this.lij[0]=e,this.lij[1]=t,this.lij[2]=i,r.getExtent(e,t,i,this.extent),this.resolution=r.resolutionAtLevel(e)}release(){this.tilingScheme=null}getChildren(e){const t=this.lij[0]+1,i=2*this.lij[1],r=2*this.lij[2];return e?(e[0].acquire(t,i,r,this.tilingScheme),e[1].acquire(t,i+1,r,this.tilingScheme),e[2].acquire(t,i,r+1,this.tilingScheme),e[3].acquire(t,i+1,r+1,this.tilingScheme),e):[new Mp(t,i,r,this.tilingScheme),new Mp(t,i+1,r,this.tilingScheme),new Mp(t,i,r+1,this.tilingScheme),new Mp(t,i+1,r+1,this.tilingScheme)]}copyMeasurementsFrom(e){this.measures.visibility=e.measures.visibility,this.measures.shouldSplit=e.measures.shouldSplit,this.measures.distance=e.measures.distance,Object(V["l"])(e.measures.screenRect,this.measures.screenRect)}static id(e,t,i){return`${e}/${t}/${i}`}}var Rp=i("579f"),Ep=i("ecd7"),Dp=i("d359");class Ip{constructor(e){this.renderCoordsHelper=e,this.frustum=Object(Dp["c"])(),this._points=Object(Dp["d"])(),this.lines=new Array(12),this._origin=Object(F["f"])(),this._direction=Object(F["f"])(),this._altitude=null;for(let t=0;t<12;t++)this.lines[t]={origin:null,direction:Object(F["f"])(),endpoint:null}}get planes(){return this.frustum}get points(){return this._points}get mutablePoints(){return this._points}get direction(){return this._direction}update(e){Object(Dp["e"])(e.viewMatrix,e.projectionMatrix,this.frustum,this._points),Object(Et["n"])(this._origin,e.eye),Object(Et["n"])(this._direction,e.viewForward),this._altitude=this.renderCoordsHelper.getAltitude(this._origin),this.updateLines()}updatePoints(e){for(let t=0;t<this._points.length;t++)Object(Et["n"])(this._points[t],e[t]);Object(Dp["a"])(this.frustum,this._points),this.updateLines()}get altitude(){return this._altitude}intersectsSphere(e){return Object(Dp["k"])(this.frustum,e)}intersectsRay(e){return Object(Dp["j"])(this.frustum,e)}intersectsLineSegment(e,t){return Object(Dp["h"])(this.frustum,e,t)}intersectsPoint(e){return Object(Dp["i"])(this.frustum,e)}updateLines(){const e=this._points;for(let t=0;t<4;t++){const i=t+4;Fp(this.lines[t],e[t],e[i]),Fp(this.lines[t+4],e[t],3===t?e[0]:e[t+1]),Fp(this.lines[t+8],e[i],3===t?e[4]:e[i+1])}}}function Fp(e,t,i){e.origin=t,e.endpoint=i,Object(Et["y"])(e.direction,t,i)}Ip.planePointIndices=Dp["l"],Ip.nearFarLineIndices=[[0,4],[1,5],[2,6],[3,7]];var zp=i("6b38");class Lp{constructor(e){this.renderCoordsHelper=e,this.surfaceElevation=0,this.cache=new Map,this.frustum=new Ip(e),this.extendedFrustum=new Ip(e),this.intersector=new zp["a"]({renderCoordsHelper:e}),this.renderCoordsHelper=e}begin(e,t){this.surfaceElevation=t,this.aboveGround=this.renderCoordsHelper.getAltitude(e.eye)>t,this.frustum.update(e),this.shortenFrustumFarPlane(this.frustum),this.updateExtendedFrustum(e)}end(){this.cache.clear()}calculate(e){if(this.allTilesInvisible)return 0;const t=1===this.renderCoordsHelper.viewingMode&&e.lij[0]>=Vp&&e.lij[0]<kp,i=this.getOrCalculateSingleTileVisibility(e,!t);return 0!==i&&t?this.calculateAggregatedChildrenVisibility(e):i}shortenFrustumFarPlane(e){const t=Ip.nearFarLineIndices,i=e.mutablePoints;for(const r of t){const[e,t]=r,n=i[e],a=i[t];Object(Et["m"])(Gp,a,n),Object(Et["h"])(Gp,Gp,Bp),Object(Et["i"])(i[t],n,Gp)}e.updatePoints(i)}calculateAggregatedChildrenVisibility(e){let t=0;const i=this.cache.get(e.id);if(null!=i)return i;const r=Wp.acquire();e.getChildren(r);for(const n of r){const e=this.calculate(n);if(0!==e&&(t=e,2===e))break}return Wp.release(r),this.cache.set(e.id,t),t}getOrCalculateSingleTileVisibility(e,t){const i=this.cache.get(e.id);if(null!=i)return i;const r=this.calculateSingleTileVisibility(e);return t&&this.cache.set(e.id,r),r}calculateSingleTileVisibility(e){return!this.aboveGround&&1===this.renderCoordsHelper.viewingMode&&e.lij[0]<Up?0===this.calculateSingleTileVisibilitySided(e,!1)?this.calculateSingleTileVisibilitySided(e,!0):void 0:this.calculateSingleTileVisibilitySided(e,this.aboveGround)}calculateSingleTileVisibilitySided(e,t){this.intersector.update(e.extent,e.tilingScheme.spatialReference,this.surfaceElevation,t);const i=Object(zt["e"])(e.tilingScheme.spatialReference).radius;return this.intersector.isVisibleInFrustum(this.extendedFrustum,i)?this.intersector.isVisibleInFrustum(this.frustum,i,!0)?2:1:0}updateExtendedFrustum(e){this.extendedFrustum.update(e),this.shortenFrustumFarPlane(this.extendedFrustum);const t=this.renderCoordsHelper.worldUpAtPosition(e.eye,Gp);this.aboveGround||Object(Et["v"])(t,t);const i=Object(Oe["b"])(-Object(Et["k"])(t,e.viewForward));if(this.allTilesInvisible=i>(Math.PI+e.fovY)/2,this.allTilesInvisible)return;if(this.hasExtendedFrustum=i>e.fovY/2,!this.hasExtendedFrustum)return;const r=this.extendedFrustumParameters(),n=this.extendedFrustum.mutablePoints;for(let a=0;a<4;a++){const e=r.pointIndices[a],t=n[e],i=this.renderCoordsHelper.getAltitude(t);if(r.needsAltitudeAdjustment(i)){switch(this.renderCoordsHelper.worldUpAtPosition(t,Gp),e){case 4:case 7:case 0:case 3:Object(mo["t"])(this.extendedFrustum.planes[0],Gp,Gp);break;case 5:case 6:case 1:case 2:Object(mo["t"])(this.extendedFrustum.planes[1],Gp,Gp)}Object(Et["h"])(Gp,Gp,r.direction),this.renderCoordsHelper.intersectInfiniteManifold(Object(xn["h"])(t,Gp),r.zWithMargin,t)}}if(this.extendedFrustum.updatePoints(n),Object(mo["g"])(n[0],n[1],n[2],qp),Object(mo["g"])(n[1],n[2],n[3],Hp),Object(Et["k"])(Object(mo["r"])(qp),Object(mo["r"])(Hp))<0){const e=this.extendedFrustum.mutablePoints;this.aboveGround?[e[0],e[1]]=[e[1],e[0]]:[e[3],e[2]]=[e[2],e[3]],this.extendedFrustum.updatePoints(e)}}extendedFrustumParameters(){return this.aboveGround?this.extendedFrustumParametersAboveSurface():this.extendedFrustumParametersBelowSurface()}extendedFrustumParametersAboveSurface(){const e=this.surfaceElevation-Np;return{zWithMargin:e,pointIndices:Ip.planePointIndices.bottom,direction:-1,needsAltitudeAdjustment:t=>t>e}}extendedFrustumParametersBelowSurface(){const e=this.surfaceElevation+Np;return{zWithMargin:e,pointIndices:Ip.planePointIndices.top,direction:1,needsAltitudeAdjustment:t=>t<e}}}const Vp=2,kp=6,Up=12,Bp=.95,Np=1,Gp=Object(F["f"])(),qp=Object(mo["d"])(),Hp=Object(mo["d"])(),Wp=new Ep["a"](Array,e=>{4!==e.length&&(e[0]=new Mp,e[1]=new Mp,e[2]=new Mp,e[3]=new Mp)},e=>{e[0].release(),e[1].release(),e[2].release(),e[3].release()});class $p{constructor(e){this.camera=new Fs["a"],this.focusOnMap=[0,0],this.screenRect=Object(V["m"])(),this.tileSize=e.tileSize,this.renderCoordsHelper=e.renderCoordsHelper,this.tilingScheme=e.tilingScheme,this.visibility=new Lp(e.renderCoordsHelper)}begin(e,t,i){this.camera.copyFrom(e),this.surfaceElevation=i,this.focusOnMap[0]=t.x,this.focusOnMap[1]=t.y,Object(V["u"])(0,0,e.fullWidth,e.fullHeight,this.screenRect),this.visibility.begin(this.camera,i)}end(){this.visibility.end()}updateTile(e){e.measures.visibility=this.visibility.calculate(e),e.measures.distance=Object(V["n"])(e.extent,this.focusOnMap),0!==e.measures.visibility&&this.updateScreenMeasure(e)}updateScreenMeasure(e){const t=Qp,i=1<<t,r=e.measures.screenRect;Object(V["o"])(r);let n=0;const a=e.lij[0]+t,s=e.lij[1]<<t,o=e.lij[2]<<t,c=this.tileSizeWithBias(e),l=c*c;for(let d=0;d<i;d++)for(let t=0;t<i;t++)if(n+=this.computeScreenArea(e,a,s+d,o+t,r),n>l)return void(e.measures.shouldSplit=!0);e.measures.shouldSplit=!1}tileSizeWithBias(e){return 1===e.measures.visibility?this.tileSize*Xp:this.tileSize}computeScreenArea(e,t,i,r,n){const a=1===e.measures.visibility;this.projectToScreen(t,i,r,a,Yp),Object(V["o"])(Zp);for(let s=0;s<4;s++)Object(V["r"])(Zp,Yp[s]);return Object(V["q"])(n,Zp,n),Object(Rp["a"])(Yp[0],Yp[1],Yp[2])+Object(Rp["a"])(Yp[0],Yp[2],Yp[3])}projectToScreen(e,t,i,r,n){this.tilingScheme.ensureMaxLod(e),this.tilingScheme.getExtent(e,t,i,Kp),this.toRenderCoords(Kp,0,3,ef[0]),this.toRenderCoords(Kp,2,3,ef[1]),this.toRenderCoords(Kp,2,1,ef[2]),this.toRenderCoords(Kp,0,1,ef[3]),r&&(this.projectToPlane(ef,this.camera.frustum[4]),this.projectToPlane(ef,this.camera.frustum[3]),this.projectToPlane(ef,this.camera.frustum[2]));for(let a=0;a<4;a++)this.camera.projectToRenderScreen(ef[a],rf),this.camera.renderToScreen(rf,n[a])}projectToPlane(e,t){for(let r=0;r<4;r++)tf[r]=Object(mo["v"])(t,e[r]);const i=Math.max(tf[0],tf[1],tf[2],tf[3]);if(i>0){const r=Object(Et["h"])(Jp,Object(mo["r"])(t),-i);for(let t=0;t<4;t++)Object(Et["i"])(e[t],e[t],r)}}toRenderCoords(e,t,i,r){return Jp[0]=e[t],Jp[1]=e[i],Jp[2]=this.surfaceElevation,this.renderCoordsHelper.toRenderCoords(Jp,this.tilingScheme.spatialReference,r),r}}const Zp=Object(V["m"])(),Qp=2,Xp=5,Yp=[Object(A["g"])(),Object(A["g"])(),Object(A["g"])(),Object(A["g"])()],Kp=Object(V["m"])(),Jp=Object(F["f"])(),ef=[Object(F["f"])(),Object(F["f"])(),Object(F["f"])(),Object(F["f"])()],tf=[0,0,0,0],rf=Object(A["e"])();var nf=i("4b49");const af=j["a"].getLogger("esri.views.3d.layers.support.FeatureTileTree3D");let sf=class extends W["a"]{constructor(e){super(e),this.tiles=new m["a"],this.tileSize=512,this._idToTile=new Map,this._handles=new $["a"],this._clients=new Set,this._dirty=!1,this._newTiles=new Fh["a"]}get tilingScheme(){const e=this.tilingSchemeOwner.tilingScheme;return e?e.clone():null}set filterExtent(e){if(Object(w["l"])(e)&&!e.spatialReference.equals(this.viewState.spatialReference))return void af.error("#extent","extent spatial reference needs to be in the same spatial reference as the view");const t=this._get("filterExtent");if(t===e||Object(w["l"])(t)&&e&&t.equals(e))return;const i=Object(w["l"])(e)?e.clone():null;this._set("filterExtent",i),this._setDirty()}get filterExtentRect(){if(Object(w["k"])(this.filterExtent)||!this.tilingScheme)return null;const e=Object(V["m"])();return Object(nf["b"])(this.filterExtent,e,this.tilingScheme.spatialReference),e}get rootTileIds(){return this.filterExtentRect?this.tilingScheme.rootTilesInExtent(this.filterExtentRect):[[0,0,0]]}set suspended(e){e!==this._get("suspended")&&(this._set("suspended",e),this._setDirty())}get updating(){return this._dirty||!!this._pendingTiles}initialize(){this._handles.add(this.watch(["tilingScheme","tileSize"],()=>this._reset(),!0)),this._handles.add(Object(C["a"])(this,["tileSize","cameraOnSurface.location","tilingScheme","viewState.contentCamera","focus.location"],()=>this._setDirty(),!0)),this.scheduler&&(this._frameWorker=this.scheduler.registerTask(Fi["b"].FEATURE_TILE_TREE,this))}destroy(){this._frameWorker=Object(w["t"])(this._frameWorker),this._handles=Object(w["e"])(this._handles)}addClient(){const e=cf();return this._clients.add(e),1===this._clients.size&&this._setDirty(),{remove:()=>this._removeClient(e)}}_removeClient(e){this._clients.delete(e),this._hasClients||this._clear()}get _hasClients(){return this._clients.size>0}_setDirty(){!this._hasClients||this.suspended||this._dirty||(this._frameWorker?(this._dirty=!0,this.notifyChange("updating")):this.runTask(Fi["d"]))}_clear(){this.tiles.removeAll(),this._idToTile.clear(),this._reset(),this._dirty=!1,this.notifyChange("updating")}get running(){return this.updating}runTask(e){this._dirty=!1,this._pendingTiles||(this._startUpdate(),Object(w["l"])(this._frameWorker)&&(this._frameWorker.priority=Fi["b"].FEATURE_TILE_TREE_ACTIVE)),this._subdivideTilesForView(e),!this._pendingTiles&&Object(w["l"])(this._frameWorker)&&(this._frameWorker.priority=Fi["b"].FEATURE_TILE_TREE),this.notifyChange("updating")}_startUpdate(){if(this.suspended)return;if(!this.tilingScheme)return void this._clear();this._tileMeasurements||(this._tileMeasurements=new $p({renderCoordsHelper:this.renderCoordsHelper,tilingScheme:this.tilingScheme,tileSize:this.tileSize}));const e=this.viewState.contentCamera;this._tileMeasurements.begin(e,this.focus.location,this.cameraOnSurface.location.z),this._pendingTiles=this._getRootTiles()}_reset(){this._newTiles.clear(),this._tileMeasurements=null,this._pendingTiles=null,this._setDirty()}_getRootTiles(){return this.rootTileIds.map(e=>new Mp(e[0],e[1],e[2],this.tilingScheme))}_purgeHorizonTiles(e){e.sort((e,t)=>{const i=e.measures.screenRect,r=t.measures.screenRect;return i[1]+i[3]-(r[1]+r[3])}),Object(V["o"])(lf);for(let t=0;t<e.length;t++)if(Object(V["q"])(lf,e.data[t].measures.screenRect,lf),Object(V["v"])(lf)>df)return e.data.slice(t,e.length);return[]}_subdivideTilesForView(e){if(this._pendingTiles){for(;this._pendingTiles.length>0&&!e.done;){const t=this._pendingTiles.pop();e.madeProgress(),this.filterExtentRect&&!Object(V["x"])(this.filterExtentRect,t.extent)||(this._tileMeasurements.updateTile(t),0!==t.measures.visibility&&(t.measures.shouldSplit?(this.tilingScheme.ensureMaxLod(t.lij[0]+1),this._pendingTiles.push(...t.getChildren())):this._newTiles.push(t)))}0===this._pendingTiles.length&&(this._updateTiles(this._purgeHorizonTiles(this._newTiles)),this._newTiles.clear(),this._tileMeasurements.end(),this._pendingTiles=null)}}_updateTiles(e){for(const r of this.tiles.items)r.used=!1;const t=e.filter(e=>{const t=this._idToTile.get(e.id);return t?(t.copyMeasurementsFrom(e),t.used=!0):this._idToTile.set(e.id,e),!t}),i=this.tiles.items.filter(e=>!e.used&&(this._idToTile.delete(e.id),!0));this.tiles.removeMany(i),this.tiles.addMany(t),this.sortTiles()}sortTiles(){this.viewState.fixedContentCamera||this.tiles.sort((e,t)=>e.measures.visibility!==t.measures.visibility?2===e.measures.visibility?-1:1:e.measures.distance-t.measures.distance),this.tiles.forEach((e,t)=>e.loadPriority=t)}};Object(h["a"])([Object(M["b"])({constructOnly:!0})],sf.prototype,"scheduler",void 0),Object(h["a"])([Object(M["b"])({constructOnly:!0})],sf.prototype,"renderCoordsHelper",void 0),Object(h["a"])([Object(M["b"])({constructOnly:!0})],sf.prototype,"tilingSchemeOwner",void 0),Object(h["a"])([Object(M["b"])({constructOnly:!0})],sf.prototype,"cameraOnSurface",void 0),Object(h["a"])([Object(M["b"])({constructOnly:!0})],sf.prototype,"focus",void 0),Object(h["a"])([Object(M["b"])({constructOnly:!0})],sf.prototype,"viewState",void 0),Object(h["a"])([Object(M["b"])({constructOnly:!0})],sf.prototype,"terrain",void 0),Object(h["a"])([Object(M["b"])()],sf.prototype,"tiles",void 0),Object(h["a"])([Object(M["b"])()],sf.prototype,"tileSize",void 0),Object(h["a"])([Object(M["b"])({readOnly:!0})],sf.prototype,"tilingScheme",null),Object(h["a"])([Object(M["b"])()],sf.prototype,"filterExtent",null),Object(h["a"])([Object(M["b"])({readOnly:!0})],sf.prototype,"filterExtentRect",null),Object(h["a"])([Object(M["b"])({readOnly:!0})],sf.prototype,"rootTileIds",null),Object(h["a"])([Object(M["b"])({value:!1})],sf.prototype,"suspended",null),Object(h["a"])([Object(M["b"])({readOnly:!0})],sf.prototype,"updating",null),sf=Object(h["a"])([Object(D["a"])("esri.views.3d.layers.support.FeatureTileTree3D")],sf);let of=0;function cf(){return of++}const lf=Object(V["m"])(),df=10,hf=sf;var uf=i("0646"),pf=i("9714");let ff=class extends W["a"]{constructor(){super(...arguments),this._propertiesPool=new pf["a"]({camera:Fs["a"]},this),this._lastSeenCameraProjectionValues=new Fs["a"],this.events=new Z["a"],this.viewingMode=1,this._cameraChanged=!1,this.updateQueue=new Array,this.processingUpdates=!1}init(e,t){this._set("viewingMode",e),this._set("spatialReference",t),this._set("constraints",new Me({mode:this.viewingMode}))}exit(){this.cameraController=null,this._propertiesPool.destroy(),this._propertiesPool=new pf["a"]({camera:Fs["a"]},this)}createInitialCamera(){if(1===this.viewingMode){const e=Object(zt["e"])(this.spatialReference).radius;this.camera=new Fs["a"](Object(F["h"])(4*e,0,0),Object(F["h"])(e,0,0),Object(F["h"])(0,0,1))}else this.camera=new Fs["a"](Object(F["h"])(0,0,100),Object(F["h"])(0,0,0),Object(F["h"])(0,1,0))}get animation(){return this.cameraController instanceof uo&&Object(w["l"])(this.cameraController.viewAnimation)?this.cameraController.viewAnimation:null}get camera(){return this._get("camera")}set camera(e){e!==mf&&mf.copyFrom(e),mf.computeUp(this.viewingMode),gf.camera=mf,this.events.emit("before-camera-change",gf);const t=this._get("camera");if(this.cameraProjectionChanged(this._lastSeenCameraProjectionValues,mf)&&(this._lastSeenCameraProjectionValues.copyFrom(mf),vf.camera=this._lastSeenCameraProjectionValues,this.events.emit("camera-projection-changed",vf)),(!t||!t.equals(mf))&&(this._set("camera",this._propertiesPool.get("camera").copyFrom(mf)),this._cameraChanged=!t||!t.almostEquals(mf),this._cameraChanged)){const e=Object(uf["a"])(()=>{this._cameraChanged=!1,e.remove()})}}get contentCamera(){return Object(w["l"])(this._contentCamera)?this._contentCamera:this.camera}set contentCamera(e){this._contentCamera=Object(w["l"])(e)?e.clone():null}get fixedContentCamera(){return!!Object(w["l"])(this._contentCamera)}get isGlobal(){return 1===this.viewingMode}get isLocal(){return 2===this.viewingMode}get navigating(){return!(!this.cameraController||!this.cameraController.isInteractive)}get stationary(){return!this._cameraChanged&&!this.navigating}get cameraController(){return this._get("cameraController")}set cameraController(e){this.stopActiveCameraController()?(e&&(e.watch("state",t=>{t!==lo.Finished&&t!==lo.Stopped||(this._set("cameraController",null),this.updateCamera(t=>e.onControllerEnd(t)))},!0),e.onControllerStart(this.camera)),this._set("cameraController",e)):e&&(e.state=lo.Rejected)}switchCameraController(e){return this.cameraController=e,e.state!==lo.Rejected}stopActiveCameraController(){return!(this.cameraController&&!this.cameraController.stopController())}updateCamera(e){this.updateQueue.push(e),this.processUpdateQueue()}processUpdateQueue(){if(0===this.updateQueue.length||this.processingUpdates)return;this.processingUpdates=!0;const e=this.updateQueue.shift();mf.copyFrom(this._get("camera")),e(mf),this.camera=mf,this.processingUpdates=!1,this.processUpdateQueue()}cameraProjectionChanged(e,t){return e.fov!==t.fov||e.fullViewport[0]!==t.fullViewport[0]||e.fullViewport[1]!==t.fullViewport[1]||e.fullViewport[2]!==t.fullViewport[2]||e.fullViewport[3]!==t.fullViewport[3]||e.padding[0]!==t.padding[0]||e.padding[1]!==t.padding[1]||e.padding[2]!==t.padding[2]||e.padding[3]!==t.padding[3]}};Object(h["a"])([Object(M["b"])({readOnly:!0,type:oe["a"]})],ff.prototype,"animation",null),Object(h["a"])([Object(M["b"])({type:Fs["a"]})],ff.prototype,"camera",null),Object(h["a"])([Object(M["b"])({})],ff.prototype,"_contentCamera",void 0),Object(h["a"])([Object(M["b"])({type:Fs["a"]})],ff.prototype,"contentCamera",null),Object(h["a"])([Object(M["b"])({readOnly:!0})],ff.prototype,"fixedContentCamera",null),Object(h["a"])([Object(M["b"])({readOnly:!0})],ff.prototype,"constraints",void 0),Object(h["a"])([Object(M["b"])({readOnly:!0})],ff.prototype,"events",void 0),Object(h["a"])([Object(M["b"])({readOnly:!0})],ff.prototype,"isGlobal",null),Object(h["a"])([Object(M["b"])({readOnly:!0})],ff.prototype,"isLocal",null),Object(h["a"])([Object(M["b"])({readOnly:!0})],ff.prototype,"viewingMode",void 0),Object(h["a"])([Object(M["b"])({readOnly:!0})],ff.prototype,"spatialReference",void 0),Object(h["a"])([Object(M["b"])({readOnly:!0})],ff.prototype,"navigating",null),Object(h["a"])([Object(M["b"])({readOnly:!0})],ff.prototype,"stationary",null),Object(h["a"])([Object(M["b"])()],ff.prototype,"_cameraChanged",void 0),Object(h["a"])([Object(M["b"])()],ff.prototype,"cameraController",null),ff=Object(h["a"])([Object(D["a"])("esri.views.3d.state.ViewState")],ff);const bf=ff,mf=new Fs["a"],gf={camera:null},vf={camera:null};var yf=i("8048");function Of(e,t,i){return 1===e?new xf(i):new _f(t,i)}class _f{constructor(e,t){this.elevationProvider=e,this._referenceEllipsoid=Object(zt["e"])(t),this.unitInMeters=Object(yf["f"])(t,this._referenceEllipsoid.metersPerDegree)}compute(e,t,i,r,n){n||(n={near:0,far:0});let a=e[2]*this.unitInMeters;const s=a,o=a-r,c=this.elevationProvider?this.elevationProvider.elevationBounds:null;c&&(a=o>=0?s-this.unitInMeters*c.min:this.unitInMeters*c.max-s);const l={x:(i=Object(w["l"])(i)?i:new il["a"]({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0})).xmax-i.xmin,y:i.ymax-i.ymin,z:4*Math.max(i.xmax-i.xmin,i.ymax-i.ymin)},d=Math.max(l.x,l.y,l.z);Object(Et["m"])(Af,t,e),Pf[0]=Af[0]>0?i.xmax:i.xmin,Pf[1]=Af[1]>0?i.ymax:i.ymin,Pf[2]=Af[2]>0?d/2:-d/2,Object(Et["m"])(Pf,Pf,e),Object(Et["u"])(Af,Af);const h=1.1*Object(Et["k"])(Pf,Af)*this.unitInMeters,u=Math.sqrt(a*(a+2*this._referenceEllipsoid.radius)),p=Math.max(i.xmax-i.xmin,i.ymax-i.ymin),f=p*Tf*this.unitInMeters,b=p*Cf*this.unitInMeters;let m=Object(Oe["f"])((a-b)/(f-b),0,1);m*=m*m;let g=Object(Oe["l"])(u,h,m);return g*=Math.max(Math.log(Math.abs(o)),1),g=Math.min(g,Math.max(34064e4,d)),g/=this.unitInMeters,jf(g,wf,this.unitInMeters,n)}}class xf{constructor(e){this._referenceEllipsoid=Object(zt["e"])(e)}compute(e,t,i,r,n){n||(n={near:0,far:0});const a=Object(Et["s"])(e)-this._referenceEllipsoid.radius,s=this._referenceEllipsoid.radius+Math.min(0,r),o=Math.abs(a-r),c=Math.max(o,Math.abs(a));return jf(1.2*Math.sqrt(c*(c+2*s)),Object(Oe["f"])(2e4-(Math.log(c)-7.983)/9.011*19e3,1e3,2e4),1,n)}}function jf(e,t,i,r){const n=Sf/i;return e/t>n?(r.far=e,r.near=r.far/t):(r.near=n,r.far=r.near*t),r}const wf=2e4,Sf=2,Tf=.001,Cf=1e-4,Pf=Object(F["f"])(),Af=Object(F["f"])();let Mf=class extends W["a"]{constructor(e){super(e),this.handles=new $["a"]}initialize(){this.handles.add(this.view.basemapTerrain.on("elevation-change",e=>this.handleElevationChangeEvent(e)))}destroy(){this.handles&&(this.handles.destroy(),this.handles=null)}handleElevationChangeEvent(e){if(this.view.state.cameraController)return;const t=this.view.state.camera;Yn(this.view,t,e.extent,e.spatialReference)&&this.applyToCurrentCamera()}applyToCurrentCamera(){this.view.state.updateCamera(e=>{ca(this.view,e,1)})}};Object(h["a"])([Object(M["b"])({constructOnly:!0})],Mf.prototype,"view",void 0),Mf=Object(h["a"])([Object(D["a"])("esri.views.3d.state.ElevationCollisionConstraint")],Mf);const Rf=Mf;let Ef=class extends W["a"]{constructor(e){super(e),this._handles=new $["a"],this.nearFarHeuristic=Of(e.view.state.viewingMode,e.view.basemapTerrain,e.view.renderCoordsHelper.spatialReference)}initialize(){this._handles.add([this.view.watch(["constraints.clipDistance.near","constraints.clipDistance.far"],()=>this._clipDistanceNearFarChanged()),this.view.watch("constraints.clipDistance.mode",()=>this._updateNearFar()),this.view.state.events.on("before-camera-change",e=>this._updateCameraNearFar(e.camera)),this.view.watch("renderDataExtent",()=>this._updateNearFar(),!0),this.view.watch(["constraints.altitude.min","constraints.altitude.max"],()=>this._updateAltitude(),!0),this.view.watch("constraints.tilt.max",()=>this._updateTiltMax(),!0),this.view.watch("constraints.tilt.mode",()=>this._updateTilt(),!0),this.view.watch("state.camera",()=>this._updateTiltAutoMax(),!0),this.view.watch(["map.ground.navigationConstraint.type","constraints.collision.enabled"],()=>this._updateCollision(),!0)]),this.view.state.isLocal&&this._handles.add(Object(C["a"])(this.view,"renderDataExtent",e=>this._updateLocalSurfaceDistance(e))),this._updateNearFar(),2!==this.view.state.viewingMode&&this._updateAltitude(),this._updateTilt(),this._updateCollision(),this._set("surfaceCollisionConstraint",new Rf({view:this.view}))}destroy(){this._handles=Object(w["e"])(this._handles),this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),this._set("surfaceCollisionConstraint",null))}_clipDistanceNearFarChanged(){var e;const t=null==(e=this.view.constraints)?void 0:e.clipDistance;t&&"auto"!==t.mode&&this.view.state.updateCamera(e=>(this._updateCameraNearFarManual(e,t),!0))}_updateNearFar(){this.view.state.updateCamera(e=>(this._updateCameraNearFar(e),!0))}_updateCameraNearFar(e){const t=this.view.constraints&&this.view.constraints.clipDistance;"manual"===(t?t.mode:"auto")?this._updateCameraNearFarManual(e,t):this._updateCameraNearFarAuto(e,t)}_updateCameraNearFarAuto(e,t){this.nearFarHeuristic.compute(e.eye,e.center,this.view.renderDataExtent,Kn(this.view,e.eye),e),t&&t.autoUpdate(e.near,e.far)}_updateCameraNearFarManual(e,t){t&&(e.near=t.near,e.far=t.far)}_updateCollision(){var e,t,i;const r=null==(e=this.view.map)||null==(t=e.ground)||null==(i=t.navigationConstraint)?void 0:i.type,n=!r||"stay-above"===r,a=this.view.state.constraints.collision;if(n!==a.enabled){a.enabled=n,n&&this._reapplyConstraints(8);const e=this.view.constraints&&this.view.constraints.tilt;e&&"auto"!==e.mode||this._updateTiltAuto()}}_updateAltitude(){const e=this.view.constraints&&this.view.constraints.altitude;e&&2!==this.view.state.viewingMode?this.view.state.constraints.altitude={min:e.min,max:e.max}:this.view.state.constraints.altitude=null,this._reapplyConstraints()}_updateTiltMax(){const e=this.view.constraints&&this.view.constraints.tilt;e&&"auto"!==e.mode&&(this._updateTiltManual(e),this._reapplyConstraints())}_updateTilt(){const e=this.view.constraints&&this.view.constraints.tilt;"manual"===(e?e.mode:"auto")?this._updateTiltManual(e):this._updateTiltAuto(),this._reapplyConstraints()}_updateTiltManual(e){const t=this.view.state.constraints;t.tilt=t.createConstantMaxTilt(Object(Oe["h"])(e.max))}_updateTiltAuto(){const e=this.view.state.constraints;e.tilt=e.createDefaultTilt(),this._updateTiltAutoMax()}_updateTiltAutoMax(){const e=this.view.constraints&&this.view.constraints.tilt;if(!e||"auto"!==e.mode)return;const t=this.view.state.constraints;if(t.tilt){const i=t.tilt(this.view.state.camera.distance).max;e.autoUpdate(Object(Oe["p"])(i))}}_updateLocalSurfaceDistance(e){if(Object(w["k"])(e))return;let t=Math.max(e.width,e.height);if(t<=0)return;e.hasZ&&(t=Math.max(t,e.zmax-e.zmin));const i=this.view.state,r=3*t/Math.atan(i.camera.fov/2);r!==i.constraints.distance&&(i.constraints.distance=r)}_reapplyConstraints(e=15){this.view.state.updateCamera(t=>ys(this.view,t,{selection:e,interactionType:0,interactionFactor:null,interactionStartCamera:null,interactionDirection:null,tiltMode:0}))}};Object(h["a"])([Object(M["b"])({constructOnly:!0})],Ef.prototype,"view",void 0),Object(h["a"])([Object(M["b"])({readOnly:!0})],Ef.prototype,"surfaceCollisionConstraint",void 0),Ef=Object(h["a"])([Object(D["a"])("esri.views.3d.state.ConstraintsManager")],Ef);const Df=Ef;let If=class extends ho{constructor(e){super(e),this.handles=new $["a"]}set desiredCamera(e){this._set("desiredCamera",e.clone())}get canStop(){return!0}get constraintEnabled(){return this.view.state.constraints.collision.enabled}onControllerStart(){this.state=lo.Running,this.handles.add(this.view.basemapTerrain.on("elevation-change",e=>this.handleElevationChangeEvent(e))),this.applyCorrection()}onControllerEnd(){this.handles.removeAll()}stepController(){}handleElevationChangeEvent(e){Yn(this.view,this.desiredCamera,e.extent,e.spatialReference)&&this.applyCorrection()}applyCorrection(){this.view.state.updateCamera(e=>{e.copyViewFrom(this.desiredCamera),ca(this.view,e,1)||this.constraintEnabled||(this.state=lo.Stopped)})}};Object(h["a"])([Object(M["b"])({constructOnly:!0})],If.prototype,"view",void 0),Object(h["a"])([Object(M["b"])({constructOnly:!0})],If.prototype,"desiredCamera",null),If=Object(h["a"])([Object(D["a"])("esri.views.3d.state.controllers.SurfaceCollisionCorrectionController")],If);var Ff=i("3760");const zf=.66;function Lf(e){return 360-xe["e"].normalize(e)}function Vf(e){return xe["e"].normalize(360-e)}function kf(e){return Object(w["l"])(e)&&e.resolver&&e.resolver.reject(),null}function Uf(e,t){return Object(w["l"])(e)&&e.resolver&&e.resolver.resolve(t),t}function Bf(e,t,i,r=null){if(!t)return kf(r);const n=e.spatialReference||c["a"].WGS84;if(Object(w["l"])(t.camera)){const e=Object(X["d"])(t.camera.position,n);if(Object(w["k"])(e))return kf(r);const i=t.camera.clone();return i.position=e,Uf(r,i)}if(Object(w["k"])(t.targetGeometry))return kf(r);const a=t.get("targetGeometry.spatialReference");if(a&&!Object(X["a"])(a,n))return kf(r);const s=Jl(e,e.state.camera);let o=1;if(null!=t.rotation&&(s.heading=Lf(t.rotation),o=0),null!=i&&(s.tilt=i),"point"===t.targetGeometry.type){const i=t.targetGeometry;let n;const a=t.targetGeometry.clone();return n=null!=t.scale?ed(e,t.scale,i.latitude):e.state.camera.distance,rd(e,a,n,s,o,r)}const l=t.targetGeometry.extent;return hd(e,l,s.heading,s.tilt,o,r)}function Nf(e,t,i=null){return Object(w["k"])(i)&&(i=new b["a"]),$f(e,null,t.clone(),i)}async function Gf(e,t,i){const r=sb(e,t);if(!r)throw new v["a"]("viewpointutils-create:no-target","Missing target for creating viewpoint");const n=new u["a"]({fov:e.camera.fov}),a=new b["a"]({camera:n});if(r.target instanceof b["a"])return ob(await Yf(e,r.target,r,i,a));if(r.target instanceof u["a"])return ob(Kf(e,r.target,a));const s=null!=r.scale||null!=r.zoom;if(r.target instanceof il["a"]){const t=r.target.xmin===r.target.xmax||r.target.ymin===r.target.ymax;return ob(s||t?await eb(e,r,r.target.center,n,i,a):await rb(e,r,r.target,n,i,a))}const o={boundingBox:Object(Fu["k"])(),hasZ:!1,screenSpaceObjects:[]},c=s?Hf(e,r):void 0;if(await Xf(e,r.target,c,o),isFinite(o.boundingBox[0])){let t;if(Object(Fu["e"])(o.boundingBox,lb),vb.x=lb[0],vb.y=lb[1],vb.z=lb[2],vb.spatialReference=e.spatialReference,isFinite(vb.z)&&o.hasZ?t=Object(Fu["y"])(o.boundingBox):(vb.z=void 0,t=Object(V["z"])(Object(Fu["G"])(o.boundingBox,pb))),s||t)return ob(await eb(e,r,vb,n,i,a));const c=cb(e,o.screenSpaceObjects);return ob(await ab(e,r,vb,o.boundingBox,c,n,i,a))}return r.position?ob(tb(e,r,n,a)):ob(await ib(e,r,n,i,a))}function qf(e,t){return null==t.scale&&null!=t.zoom?xd(e,t.zoom):t.scale}function Hf(e,t){return jd(e,qf(e,t))}function Wf(e,t){let i=!1;return null!=t.heading?(e.heading=t.heading,i=!0):null!=t.rotation&&(e.heading=Lf(t.rotation),i=!0),null!=t.tilt&&(e.tilt=t.tilt,i=!0),null!=t.fov&&(e.fov=t.fov),i}function $f(e,t,i,r){const n=e.spatialReference||c["a"].WGS84;return t=Object(w["l"])(t)?t:Yl(e,i),Object(w["k"])(t)||(r.targetGeometry=Object(L["x"])(t.center,e.renderSpatialReference,n),r.scale=wd(e,t),r.rotation=Vf(i.heading),r.camera=i),r}function Zf(e,t,i){if(!t)return;if(!Object(X["a"])(t.spatialReference,e.spatialReference))throw new v["a"]("viewpointutils:incompatible-spatialreference",`Spatial reference (${t.spatialReference?t.spatialReference.wkid:"unknown"}) is incompatible with the view (${e.spatialReference.wkid})`,{geometry:t});const r=[];if(!t.hasZ&&e.basemapTerrain){let i;switch(t.type){case"point":i=t;break;case"multipoint":case"polyline":i=t.extent.center;break;case"mesh":i=t.origin;break;case"extent":i=t.center;break;case"polygon":i=t.centroid}i&&Object(X["a"])(i,e.basemapTerrain.spatialReference)?lb[2]=Object(w["v"])(Object(K["b"])(e.elevationProvider,i),0):lb[2]=0}(0,yb[t.type])(t,e=>{r.push(e[0],e[1],e[2])},lb);const n=r.length/3;if(0===n)return;const a=new Array(r.length);if(Object(L["p"])(r,t.spatialReference,0,a,e.spatialReference,0,n)){t.hasZ&&(i.hasZ=!0);for(let e=0;e<a.length;e+=3)t.hasZ?(lb[0]=a[e+0],lb[1]=a[e+1],lb[2]=a[e+2]):(lb[0]=a[e+0],lb[1]=a[e+1]),Object(Fu["r"])(i.boundingBox,lb)}}async function Qf(e,t,i,r){const n=await Object(Tu["d"])(e.whenViewForGraphic(t));if(!1===n.ok||Object(w["k"])(n.value)||!("whenGraphicBounds"in n.value))return void Zf(e,t.geometry,r);const a=n.value,s=await Object(Tu["d"])(a.whenGraphicBounds(t,{minDemResolution:i}));if(!1===s.ok)return void Zf(e,t.geometry,r);const{screenSpaceObjects:o,boundingBox:c}=s.value;Object(Fu["m"])(r.boundingBox,c),o&&o.forEach(e=>{r.screenSpaceObjects.push(e)}),isFinite(c[2])&&(r.hasZ=!0)}async function Xf(e,t,i,r){if(Array.isArray(t)&&2===t.length){const i=t[0],n=t[1];if("number"==typeof i&&"number"==typeof n)return vb.x=i,vb.y=n,vb.z=void 0,vb.spatialReference=e.spatialReference.isGeographic?e.spatialReference:c["a"].WGS84,void Zf(e,vb,r)}t&&"function"==typeof t.map?await Object(S["j"])(t.map(t=>Xf(e,t,i,r))):t instanceof Ff["a"]?Zf(e,t,r):t instanceof p["a"]&&await Qf(e,t,i,r)}async function Yf(e,t,i,r,n){if(Object(w["l"])(t.camera))return Kf(e,t.camera,n);n.scale=t.scale,n.rotation=t.rotation,n.targetGeometry=Object(w["l"])(t.targetGeometry)?t.targetGeometry.clone():null,n.camera=null,null!=i.heading?n.rotation=Vf(i.heading):null!=i.rotation&&(n.rotation=i.rotation);const a=qf(e,i);null!=a&&(n.scale=a);const s=new Sd(r);return Bf(e,n,i.tilt,s),n.camera=await s.resolver.promise,n}function Kf(e,t,i){const r=e.spatialReference,n=Object(X["d"])(t.position,r);return Object(w["k"])(n)?null:((t=t.clone()).fov=e.camera.fov,t.position=n,$f(e,null,t,i))}function Jf(e,t,i,r,n,a){const s=e.renderSpatialReference;return Object(L["t"])(i.position,bb,s),Object(L["t"])(t,mb,s),a.targetGeometry=new Br["a"](t),n.position=new Br["a"](i.position),Object(Et["m"])(fb,mb,bb),nd(e,bb,fb,r.up,n),a.scale=td(e,Object(Et["p"])(bb,mb),a.targetGeometry.latitude),a.rotation=Vf(n.heading),a.camera=n,a}async function eb(e,t,i,r,n,a){if(Object(w["k"])(i))throw new v["a"]("createfromcenter","invalid point");a.targetGeometry=i.clone();const s=Jn(e);if(t.position)return Jf(e,a.targetGeometry,t,s,r,a);if(t.zoomFactor){const r=s.distance/t.zoomFactor,n=Object(Et["h"])(lb,s.viewForward,-r);s.eye=Object(Et["i"])(lb,s.center,n),a.scale=td(e,r,i.latitude)}Jl(e,s,r);const o=Wf(r,t)?0:1;if(!t.zoomFactor){a.scale=qf(e,t),null==a.scale&&(Object(L["t"])(i,lb,e.renderSpatialReference),Object(Dp["i"])(s.frustum,lb)?a.scale=td(e,Object(Et["p"])(s.eye,lb),i.latitude):a.scale=wd(e,s));const c=new Sd(n);id(e,a.targetGeometry,a.scale,r,o,c),a.camera=await c.resolver.promise}return a}function tb(e,t,i,r){const n=Jn(e);return Object(Et["n"])(fb,n.viewForward),nd(e,n.eye,fb,n.up,gb),i.position=new Br["a"](t.position),i.heading=null!=t.heading?t.heading:gb.heading,i.tilt=null!=t.tilt?t.tilt:gb.tilt,$f(e,null,i,r)}async function ib(e,t,i,r,n){const a=Jn(e);return eb(e,t,Object(L["x"])(a.center,e.renderSpatialReference,e.spatialReference),i,r,n)}async function rb(e,t,i,r,n,a){a.targetGeometry=i.clone();const s=Jn(e);Jl(e,s,r);const o=Wf(r,t)?0:1,c=new Sd(n);return hd(e,i,r.heading,r.tilt,o,c),a.camera=await c.resolver.promise,a}function nb(e,t,i,r,n){let a=0;i.hasZ?a=i.z:e.basemapTerrain&&(a=Object(w["u"])(Object(K["b"])(e.elevationProvider,i))),Object(Et["z"])(lb,i.x,i.y,a),Object(L["d"])(e.spatialReference,lb,db,e.renderSpatialReference),Object(Pi["f"])(hb,db),Object(Pi["o"])(hb,hb),Object(Fu["k"])(ub);const s=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(let f=0;f<s.length;f++){const t=s[f];let i=r[t[2]];isFinite(i)||(i=a),Object(Et["z"])(lb,r[t[0]],r[t[1]],i),Object(L["y"])(lb,e.spatialReference,lb,e.renderSpatialReference),Object(Fu["r"])(ub,Object(Et["A"])(lb,lb,hb))}const o=Object(Fu["H"])(ub),c=Object(Fu["v"])(ub),l=Object(Fu["i"])(ub),d=1/Math.tan(t.fovX/2),h=1/Math.tan(t.fovY/2),u=.5*Math.sqrt(o*o+l*l)*Math.max(h,d)+.5*c,p=.5*c*h+.5*Math.max(o,l);return Math.max(u,p)/n}async function ab(e,t,i,r,n,a,s,o){o.targetGeometry=i.clone();const c=Jn(e),l=nb(e,c,i,r,n);Jl(e,c,a);const d=Wf(a,t)?0:1;o.scale=td(e,l,o.targetGeometry.latitude);const h=new Sd(s);return id(e,o.targetGeometry,o.scale,a,d,h),o.camera=await h.resolver.promise,o}function sb(e,t){if(!t||!e.spatialReference)return null;const i={target:null};if("declaredClass"in t||Array.isArray(t))i.target=t;else{for(const e in t)i[e]=t[e];t.center&&!i.target&&(i.target=t.center)}return i}function ob(e){return e&&Object(w["l"])(e.camera)&&(e.rotation=Vf(e.camera.heading)),e}function cb(e,t){const i=zf;if(!t.length)return i;let r=Number.NEGATIVE_INFINITY;for(let n=0;n<t.length;n++){const e=t[n].screenSpaceBoundingRect;r=Math.max(r,Math.abs(e[0]),Math.abs(e[1]),Math.abs(e[2]),Math.abs(e[3]))}return i-r/Math.min(e.width,e.height)*2}const lb=Object(F["f"])(),db=Object(Vt["d"])(),hb=Object(Ai["b"])(),ub=Object(Fu["h"])(),pb=Object(V["m"])(),fb=Object(F["f"])(),bb=Object(F["f"])(),mb=Object(F["f"])(),gb={heading:0,tilt:0},vb=new Br["a"],yb={point(e,t,i){i[0]=e.x,i[1]=e.y,e.hasZ&&(i[2]=e.z),t(i)},polygon(e,t,i){const r=e.hasZ;for(let n=0;n<e.rings.length;n++){const a=e.rings[n];for(let e=0;e<a.length;e++)i[0]=a[e][0],i[1]=a[e][1],r&&(i[2]=a[e][2]),t(i)}},polyline(e,t,i){const r=e.hasZ;for(let n=0;n<e.paths.length;n++){const a=e.paths[n];for(let e=0;e<a.length;e++)i[0]=a[e][0],i[1]=a[e][1],r&&(i[2]=a[e][2]),t(i)}},multipoint(e,t,i){const r=e.points,n=e.hasZ;for(let a=0;a<r.length;a++)i[0]=r[a][0],i[1]=r[a][1],n&&(i[2]=r[a][2]),t(i)},extent(e,t,i){e.hasZ?(t(Object(Et["z"])(i,e.xmin,e.ymin,e.zmin)),t(Object(Et["z"])(i,e.xmax,e.ymin,e.zmin)),t(Object(Et["z"])(i,e.xmin,e.ymax,e.zmin)),t(Object(Et["z"])(i,e.xmax,e.ymax,e.zmin)),t(Object(Et["z"])(i,e.xmin,e.ymin,e.zmax)),t(Object(Et["z"])(i,e.xmax,e.ymin,e.zmax)),t(Object(Et["z"])(i,e.xmin,e.ymax,e.zmax)),t(Object(Et["z"])(i,e.xmax,e.ymax,e.zmax))):(t(Object(Et["z"])(i,e.xmin,e.ymin,i[2])),t(Object(Et["z"])(i,e.xmax,e.ymin,i[2])),t(Object(Et["z"])(i,e.xmin,e.ymax,i[2])),t(Object(Et["z"])(i,e.xmax,e.ymax,i[2])))},mesh(e,t,i){const r=e.vertexAttributes&&e.vertexAttributes.position;if(r)for(let n=0;n<r.length;n+=3)t(Object(Et["z"])(i,r[n+0],r[n+1],r[n+2]))}};class Ob{constructor(e,t,i){this.target=e,this.options=t,this.view=i,this.state="pending",this.abortController=null,this.animationController=null,this.promise=new Promise((e,t)=>{this.resolveCallback=e,this.rejectCallback=t;const i=new AbortController;Object(w["l"])(this.options.signal)&&Object(S["r"])(this.options.signal,()=>{this.abort()}),this.abortController=i,this.waitForReady()})}then(e,t){return this.promise.then(e,t)}catch(e){return this.promise.catch(e)}resolve(e){return this.state="finished",this.resolveCallback(e)}reject(e){return this.state="finished",this.rejectCallback(e)}abort(e=!1){switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":this.reject(Object(S["e"])());break;case"wait-for-animation-finish":!e&&Object(w["l"])(this.animationController)&&this.view.state.cameraController===this.animationController&&this.animationController.active&&this.animationController.stopController(),this.reject(Object(S["e"])())}}waitForReady(){this.state="wait-for-ready",this.view.ready?this.createViewPoint():Object(C["k"])(this.view,"ready",this.abortController.signal).then(()=>{this.createViewPoint()},e=>{this.reject(e)})}createViewPoint(){"finished"!==this.state&&(this.state="wait-for-viewpoint",this.animationController=this.options.animate?this.getAnimationController():null,Gf(this.view,this.target,this.abortController.signal).then(e=>{if("finished"===this.state)return;const t=this.getCameraFromViewpoint(e);if(!Object(w["k"])(t))if(this.options.animate){if(Object(w["k"])(this.animationController))return;this.startAnimation(t,this.animationController)}else this.view.stateManager.setStateCamera(t.camera,{applyConstraints:!t.isFullySpecified,positionAndOrientationOnly:!0,doNotCancelGoToOperation:!0}),this.resolve()},e=>{this.reject(e)}))}getCameraFromViewpoint(e){const t=!!(this.target instanceof b["a"]&&this.target.camera||this.target instanceof u["a"]),i=e.camera;if(Object(w["k"])(i))return null;if(!this.view.stateManager.isCompatible(i)){const e=i.position,t=e&&e.spatialReference,r=t?t.wkid:"none",n=this.view.spatialReference.wkid;return this.reject(new v["a"]("GotoAnimation:incompatible-spatialreference",`Resulting camera has an incompatible spatial reference (camera: ${r}, view: ${n})`,{camera:i})),null}const r=Yl(this.view,i);return Object(w["k"])(r)?(this.reject(new v["a"]("GotoAnimation:invalid-camera","Resulting camera is invalid")),null):{viewpoint:e,camera:r,isFullySpecified:t}}startAnimation(e,t){this.state="wait-for-animation-finish";const i=t.viewAnimation;if(Object(w["k"])(i))return void this.reject(new v["a"]("GotoAnimation:missing-animation","Unreachable code in view.stateManager"));if(i.update(e.viewpoint,"running"),!t.active||Object(w["k"])(t.viewAnimation)||t.viewAnimation.target!==e.viewpoint||this.view.state.cameraController!==t)return this.abort();let r;e.isFullySpecified?(r=new If({view:this.view,desiredCamera:e.camera}),ca(this.view,e.camera,1)):ys(this.view,e.camera),t.begin(e.camera,this.options);const n=()=>{const i=this.view.state.cameraController;r&&(i&&i.active?i instanceof po&&Object(w["l"])(i.viewAnimation)&&i.viewAnimation.target===e.viewpoint&&(this.view.state.cameraController=r):Object(w["l"])(t.viewAnimation)&&t.viewAnimation.target===e.viewpoint&&"finished"===t.state&&(this.view.state.cameraController=r))},a=e=>{if(!Object(w["k"])(this.view.state))switch(t.state){case lo.Finished:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.resolve()}break;case lo.Ready:case lo.Rejected:case lo.Running:case lo.Stopped:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.reject(e)}}};i.when(n,e=>a(e)),t.asyncResult={resolve:()=>a(),reject:e=>a(e)}}getAnimationController(){let e,t=null;const i=this.view.state.cameraController;return i instanceof po&&(i.updateStateFromViewAnimation(),i.active&&(e=i,t=e.viewAnimation)),null!=e||(e=new po({view:this.view,mode:"animation"}),t=e.viewAnimation,this.view.state.switchCameraController(e))?e:(Object(w["l"])(t)&&t.stop(),this.reject(new v["a"]("GotoAnimation:goto-cannot-interrupt","Cannot start an animation while interacting")),null)}}const _b=j["a"].getLogger("esri.views.3d.state.ViewStateManager");let xb=class extends W["a"]{constructor(e){super(e),this.propertiesPool=new pf["a"]({frustum:Ip},this),this.handles=new $["a"],this.cameraSetByUser=!1,this.gotoOperation=null,this.ready=!1,this.updateDevicePixelRatio=null,this.test={contentCameraResetState:new Map}}get camera(){const e=this._get("camera");if(!this.ready)return e;const t=Jl(this.view,this.view.state.camera);return t&&e&&t.equals(e)?e:t}set camera(e){this.updatePropertyBeforeReady("camera",e)||(this.view.elevationProvider.enableElevationCache(!0),this.setStateCamera(Yl(this.view,e),{applyConstraints:!1})||_b.error("#camera=","Invalid camera",e),this.view.elevationProvider.enableElevationCache(!1))}get contentCamera(){const e=this._get("contentCamera");if(!this.ready)return e;const t=Jl(this.view,this.view.state.contentCamera);return t&&e&&t.equals(e)?e:t}set contentCamera(e){if(this.updatePropertyBeforeReady("contentCamera",e))return;const t=Yl(this.view,e);Object(w["k"])(t)?this.view.state.contentCamera=null:(this.updateElevation(t),this.view.state.contentCamera=t)}installContentCameraReset(e){if(this.handles.remove("contentCameraReset"),this.test.contentCameraResetState.clear(),!this.view.state.fixedContentCamera)return!1;const t=this.zoom,i=this.view.state.camera.distance**2,r=Object(F["g"])(this.view.state.camera.center),n=e.sticky?this.contentCamera.clone():null;return this.handles.add([this.watch("contentCamera",()=>{e.sticky||(this.handles.remove("contentCameraReset"),this.test.contentCameraResetState.clear())}),this.watch("zoom",e=>{this.test.contentCameraResetState.set("view.zoom",Math.abs(e-t)/2),Math.abs(e-t)>2?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=n)}),this.view.state.watch("camera",e=>{const t=Object(Et["o"])(r,e.center);this.test.contentCameraResetState.set("camera.center",t/i),t>i?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=n)})],"contentCameraReset"),!0}get center(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")}set center(e){this.updatePropertyBeforeReady("center",e)||(e?this.isCompatible(e)?this.setStateCamera(this.centerToCamera(e),{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.runTask():_b.error("#center=","Invalid center",e):_b.error("#center=","Center has an incompatible spatial reference (center: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",e):_b.error("#center=","Center may not be null or undefined"))}get extent(){if(!this.ready)return this._get("extent");const e=this.view,t=ud(e,e.state.camera,e.pointsOfInterest.centerOnContent.renderLocation);return Object(w["l"])(t)?t:this._get("extent")}set extent(e){this.updatePropertyBeforeReady("extent",e)||(e?this.isCompatible(e)?this.setStateCamera(this.extentToCamera(e),{applyConstraints:!0})||_b.error("#extent=","Invalid extent",e):_b.error("#extent=","Extent has an incompatible spatial reference (extent: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",e):_b.error("#extent=","Extent may not be null or undefined"))}get frustum(){const e=this.propertiesPool.get("frustum");return e.renderCoordsHelper=this.view.renderCoordsHelper,e.update(this.view.state.camera),e}get hasInitialView(){return!!this.view.get("map.initialViewProperties.viewpoint")}get scale(){if(this.ready){const e=this.view.pointsOfInterest.centerOnContent;return td(this.view,e.distance,e.location.latitude)}return this._get("scale")}set scale(e){this.updatePropertyBeforeReady("scale",e)||this.setStateCamera(this.scaleToCamera(e),{applyConstraints:!0})||_b.error("#scale=","Invalid scale",e)}get padding(){if(!this.ready)return this._get("padding");const e=this.view.state.camera,t=e.padding,i=e.pixelRatio,r=this._get("padding"),n=Math.round(t[0]/i),a=Math.round(t[1]/i),s=Math.round(t[2]/i),o=Math.round(t[3]/i);return null!=r&&r.top===n&&r.right===a&&r.bottom===s&&r.left===o?r:{top:n,right:a,bottom:s,left:o}}set padding(e){this.updatePropertyBeforeReady("padding",e)||(this.paddingToArray(e,this.view.state.camera.pixelRatio,Ab),this.view.state.updateCamera(e=>e.padding=Ab))}paddingToArray(e,t,i){e?Object(zh["l"])(i,e.top||0,e.right||0,e.bottom||0,e.left||0):Object(zh["l"])(i,0,0,0,0);for(let r=0;r<4;r++)i[r]=Math.round(i[r]*t)}get screenCenter(){const e=this.padding;return Object(A["f"])((this.view.width-(e.left+e.right))/2+e.left,(this.view.height-(e.top+e.bottom))/2+e.top)}get viewpoint(){return this.ready?Nf(this.view,this.camera):this._get("viewpoint")}set viewpoint(e){if(!this.updatePropertyBeforeReady("viewpoint",e))if(e)if(this.isCompatible(e))this.setStateCamera(this.viewpointToCamera(e),{applyConstraints:!e.camera})||_b.error("#viewpoint=","Invalid viewpoint",e);else{const t=Object(w["l"])(e.camera)?e.camera.position:e.targetGeometry,i=Object(w["l"])(t)&&t.spatialReference;_b.error("#viewpoint=","Viewpoint has an incompatible spatial reference (viewpoint: "+(i?i.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",e)}else _b.error("#viewpoint=","Viewpoint may not be null or undefined")}get zoom(){return this.ready?_d(this.view,this.scale):this._get("zoom")}set zoom(e){this.updatePropertyBeforeReady("zoom",e)||this.setStateCamera(this.zoomToCamera(e),{applyConstraints:!0})||_b.error("#zoom=","Invalid zoom",e)}initialize(){this.handles.add([Object(C["b"])(this.view,"state.events","before-camera-change",e=>this.updateElevation(e.camera))]),Object(C["c"])(this.view.state,"camera",e=>this.updateElevation(e),!0),this.handles.add(Object(T["a"])({prepare:()=>this.prepareFrame()})),this.handles.add(this.view.state.watch("cameraController",()=>{this.cameraSetByUser=!0,this.handles.remove(Mb)})),this.handles.add(Object(C["b"])(this.view,"state.events","camera-projection-changed",()=>this.notifyChange("scale")))}destroy(){this.deinit(),this.handles&&(this.handles.destroy(),this.handles=null),this.propertiesPool&&(this.propertiesPool.destroy(),this.propertiesPool=null)}init(){this.constraintsManager=new Df({view:this.view}),this.prepareFrame();const e=this.getInitialProperties();this.cameraSetByUser=!1,this._set("ready",!0);for(const t of e)this.set(t.name,t.value);if(!this.cameraSetByUser){const e=this.view.get("map.initialViewProperties.viewpoint")||this.view.initialExtent;e&&this.isCompatible(e)?this.setInitialView(e):2===this.view.state.viewingMode&&this.handles.add(Object(C["k"])(this.view.basemapTerrain,"ready",()=>{this.handles.remove(Mb),this.setInitialView(this.view.dataExtent)}),Mb)}}deinit(){this.cancelGoToOperation(),this.ready&&(this._override("padding",this.padding),this._set("ready",!1),this._clearOverride("hasInitialView"),this.cameraSetByUser=!1,this.handles.remove(Mb),this.constraintsManager&&(this.constraintsManager.destroy(),this.constraintsManager=null))}async goTo(e,t){const i={animate:!0,...t};return Object(w["l"])(this.gotoOperation)&&this.gotoOperation.abort(i.animate),this.gotoOperation=new Ob(e,i,this.view),this.view.resourceController.scheduler.stopFrame(),this.gotoOperation}debugSetCameraOnContent(){this.setStateCamera(Jn(this.view),{applyConstraints:!1})}step(e){const t=this.view.state,i=t&&this.view.state.cameraController;i&&(t.updateCamera(t=>{i.stepController(e,t)}),i.steppingFinished&&i.finishController())}cancelGoToOperation(){Object(w["l"])(this.gotoOperation)&&(this.gotoOperation.abort(),this.gotoOperation=null)}getInitialProperties(){const e=new Set,t=[];for(const{propertyName:i,overrides:r}of Sb){const n=e.has(i),a=this._isOverridden(i);!n&&a&&t.push({name:i,value:this._get(i)}),this._clearOverride(i),(n||a)&&r.forEach(t=>e.add(t))}return t}setInitialView(e){if(Object(w["k"])(e)||this.cameraSetByUser)return;if(e instanceof u["a"])return void this.setStateCamera(Yl(this.view,e),{applyConstraints:!1});if(e instanceof b["a"]){if(e.targetGeometry instanceof il["a"]){const t=hd(this.view,e.targetGeometry,0,.5,0);return void(Object(w["l"])(t)&&this.setStateCamera(Yl(this.view,t),{applyConstraints:!0}))}const t={applyConstraints:!e.camera},i=this.viewpointToCamera(e);return void this.setStateCamera(i,t)}const t=hd(this.view,e,0,.5,0);Object(w["l"])(t)&&this.setStateCamera(Yl(this.view,t),{applyConstraints:!0})}updatePropertyBeforeReady(e,t){return!this.ready&&(this._override(e,t),t&&-1!==wb.indexOf(e)&&this._override("hasInitialView",!0),!0)}isCompatible(e){return!Object(w["k"])(e)&&(e instanceof b["a"]?e.camera?this.isCompatible(e.camera):this.isCompatible(e.targetGeometry):e instanceof u["a"]?this.isCompatible(e.position):e.spatialReference&&Object(X["a"])(e.spatialReference,this.view.spatialReference))}getPreservingHeadingTilt(e=Tb){return this.cameraSetByUser?(e.heading=this.camera.heading,e.tilt=this.camera.tilt):(e.heading=0,e.tilt=.5),e}centerPointAtDistanceToCamera(e,t,i=Pb){const{heading:r,tilt:n}=this.getPreservingHeadingTilt(),a=ld(this.view,r,n,e,t,1);return Object(w["k"])(a)?null:(i.copyFrom(this.view.state.camera),i.eye=a.eye,i.center=a.center,i.up=a.up,i)}centerToCamera(e){const t=this.view.pointsOfInterest.centerOnContent;t.runTask();const i=t.distance;return this.centerPointAtDistanceToCamera(e,i)}extentToCamera(e){const{heading:t,tilt:i}=this.getPreservingHeadingTilt(),r=hd(this.view,e,t,i,1,Cb);return Object(w["l"])(r)?Yl(this.view,r):null}scaleToCamera(e){if(null==e)return null;const t=this.view.pointsOfInterest.centerOnContent;t.runTask();const i=t.renderLocation,r=t.location.latitude,n=ed(this.view,e,r);return this.centerPointAtDistanceToCamera(i,n)}zoomToCamera(e){return this.scaleToCamera(xd(this.view,e))}viewpointToCamera(e){return Yl(this.view,Bf(this.view,e))}setStateCamera(e,t){return!(Object(w["k"])(e)||!this.view.state.stopActiveCameraController())&&(this.cameraSetByUser=!0,t.doNotCancelGoToOperation||this.cancelGoToOperation(),this.view.state.updateCamera(i=>{t.positionAndOrientationOnly?(i.eye=e.eye,i.center=e.center,i.up=e.up):i.copyFrom(e),t.applyConstraints&&ys(this.view,i)}),t.applyConstraints||(this.view.state.cameraController=new If({view:this.view,desiredCamera:e})),!0)}prepareFrame(){const{container:e,canvas:t}=this.view;if(!e||!t)return;Object(w["l"])(this.updateDevicePixelRatio)&&this.updateDevicePixelRatio();const i=this.view.pixelRatio,r=Math.round(e.clientWidth*i),n=Math.round(e.clientHeight*i);if(0!==r&&0!==n&&(t.width===r&&t.height===n||(t.width=r,t.height=n),this.view.state)){const e=this.view.state.camera;e.fullWidth===r&&e.fullHeight===n&&e.pixelRatio===i||(Pb.copyFrom(e),Pb.pixelRatio!==i&&(this.paddingToArray(this.padding,i,Ab),Pb.padding=Ab),Pb.fullWidth=r,Pb.fullHeight=n,Pb.pixelRatio=i,this.view.state.camera=Pb)}}updateElevation(e){const t=this.view.basemapTerrain&&this.view.basemapTerrain.spatialReference,i=this.view.renderCoordsHelper.getAltitude(e.eye),r=t?Kn(this.view,e.eye):0;e.relativeElevation=i-r}};Object(h["a"])([Object(M["b"])({type:u["a"],dependsOn:["view.state.camera","ready"]})],xb.prototype,"camera",null),Object(h["a"])([Object(M["b"])({type:u["a"],dependsOn:["view.state.contentCamera","ready"]})],xb.prototype,"contentCamera",null),Object(h["a"])([Object(M["b"])({type:Br["a"]})],xb.prototype,"center",null),Object(h["a"])([Object(M["b"])({type:il["a"]})],xb.prototype,"extent",null),Object(h["a"])([Object(M["b"])({readOnly:!0})],xb.prototype,"frustum",null),Object(h["a"])([Object(M["b"])({readOnly:!0})],xb.prototype,"hasInitialView",null),Object(h["a"])([Object(M["b"])({readOnly:!0,type:Boolean})],xb.prototype,"ready",void 0),Object(h["a"])([Object(M["b"])({type:Number})],xb.prototype,"scale",null),Object(h["a"])([Object(M["b"])()],xb.prototype,"padding",null),Object(h["a"])([Object(M["b"])({readOnly:!0})],xb.prototype,"screenCenter",null),Object(h["a"])([Object(M["b"])({constructOnly:!0})],xb.prototype,"view",void 0),Object(h["a"])([Object(M["b"])({type:b["a"]})],xb.prototype,"viewpoint",null),Object(h["a"])([Object(M["b"])({type:Number})],xb.prototype,"zoom",null),Object(h["a"])([Object(M["b"])({constructOnly:!0})],xb.prototype,"updateDevicePixelRatio",void 0),xb=Object(h["a"])([Object(D["a"])("esri.views.3d.state.ViewStateManager")],xb);const jb=xb,wb=["camera","viewpoint","extent","scale","center","zoom"],Sb=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"center",overrides:[]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],Tb={heading:0,tilt:0},Cb=new u["a"],Pb=new Fs["a"],Ab=Object(Dt["e"])(),Mb="pending-initial-view";var Rb=i("a978");class Eb{constructor(e,t,i){this.viewingMode=e,this._forEachLayer=t,this.view=i,this.externalIntersectionHandlers=new Fh["a"],this.tolerance=Xn["a"],this.tmpRay=Object(xn["c"])(),this.validateHUDIntersector=Object(Xn["b"])(this.viewingMode),this.validateHUDIntersector.options.hud=!1}intersectScreen(e,t){return this.intersectRay(this._getPickRay(e,this.tmpRay),Ib(this.viewingMode),t)}intersectScreenFreePointFallback(e,t){return this.intersectRayFreePointFallback(this._getPickRay(e,this.tmpRay),t)}intersectRayFreePointFallback(e,t){return this.intersectRay(e,Ib(this.viewingMode),t)||this._intersectRayFreePointLocal(e,t)}intersectRay(e,t,i,r){return t.options.selectionMode=!1,t.options.store=0,this.computeIntersection(e,t,r),!!t.results.min&&t.results.min.getIntersectionPoint(i)}getCenterRayWithSubpixelOffset(e,t,i=.5,r=.5){return e.getRenderCenter(Vb,i,r),Vb[0]+=.0466,Vb[1]-=.0123,Object(go["b"])(e,Vb,t)}intersectIntersectorScreen(e,t,i){this.computeIntersection(this._getPickRay(e,this.tmpRay),t,i)}intersectToolIntersectorScreen(e,t,i){const r=this._getPickRay(e,this.tmpRay);this.intersectToolIntersectorRay(r,t,i)}intersectToolIntersectorRay(e,t,i){t.options.selectionMode=!0,this.computeIntersection(e,t,i);const r=t.results.min;this.view.basemapTerrain&&this.view.basemapTerrain.opaque||Object(Rb["c"])(r)&&2!==r.intersector||(t.options.selectionMode=!1,this.computeIntersection(e,t,i))}setTolerance(e=Xn["a"]){this.tolerance=e}addIntersectionHandler(e){this.externalIntersectionHandlers.push(e),this.externalIntersectionHandlers.sort((e,t)=>2===e.type?1:2===t.type?-1:0)}removeIntersectionHandler(e){this.externalIntersectionHandlers.removeUnordered(e),this.externalIntersectionHandlers.sort((e,t)=>2===e.type?1:2===t.type?-1:0)}_getPickRay(e,t){const i=this.view.state.camera;return Object(go["c"])(i,e,t)}_intersectRayFreePointLocal(e,t){if(2!==this.viewingMode||Object(w["k"])(e))return!1;const i=this.view.renderDataExtent;if(Object(w["k"])(i))return Object(Et["i"])(t,e.origin,Object(Et["u"])(di["d"].get(),e.direction)),!0;const r={x:i.xmax-i.xmin,y:i.ymax-i.ymin,z:8*Math.max(i.xmax-i.xmin,i.ymax-i.ymin)},n=Math.max(r.x,r.y,r.z);if(0===n)return Object(Et["i"])(t,e.origin,Object(Et["u"])(di["d"].get(),e.direction)),!0;const a=this.view.state.camera,s=Math.max(0,i.xmin-a.eye[0],a.eye[0]-i.xmax),o=Math.max(0,i.ymin-a.eye[1],a.eye[1]-i.ymax),c=Math.sqrt(s*s+o*o),l=Math.abs(a.relativeElevation)+Number.MIN_VALUE,d=Math.max(0,Math.log(n/l))**2;let h=n/Math.max(1,d);h=Math.max(h,Math.min(c,n));const u=Object(Et["h"])(di["d"].get(),e.direction,h/Object(Et["s"])(e.direction));return Object(Et["i"])(t,e.origin,u),!0}intersectElevationFromScreen(e,t,i=0,r=null){return this.intersectElevation(this._getPickRay(e,this.tmpRay),t,i,r)}intersectElevation(e,t,i=0,r=null){if(Object(w["k"])(e))return null;const n=Object(w["l"])(t)?t.mode:"absolute-height",a=Object(w["l"])(t)?Object(w["v"])(t.offset,0):0,s="on-the-ground"!==n?a+i:0,o=s/this.view.renderCoordsHelper.unitInMeters;if("absolute-height"===n){if(this.view.renderCoordsHelper.intersectInfiniteManifold(e,s,Lb)){const e=this.view.computeMapPointFromVec3d(Lb);return e.z-=a,e}return null}const c=this.view.state.camera,l=Object(A["b"])(di["d"].get());c.projectToRenderScreen(e.origin,l);const d=new Fb(null,this._forEachLayer),h=this.view.slicePlane,u=Object(w["l"])(h)?Object(Rb["d"])(h):null,p=Object(Xn["b"])(this.viewingMode);p.options.store=0,p.options.verticalOffset=o;const f=e.origin,b=Object(Et["i"])(di["d"].get(),f,e.direction);p.reset(f,b,c),p.point=l;const m=Object(w["l"])(r)?"type"in r&&"graphics"===r.type?e=>e.metadata.layerUid!==r.uid:e=>e.metadata.graphicUid!==r.uid:null;switch(n){case"relative-to-scene":{const e=e=>(Object(w["k"])(m)||m(e))&&e.metadata&&e.metadata.isElevationSource;p.intersect(d.layers,l,this.tolerance,null,e),this.externalIntersectionHandlers.forAll(e=>{if(4===e.type||2===e.type){const t=e.slicePlaneEnabled?u:null;e.intersect(p,t,p.rayBegin,p.rayEnd,l)}})}break;case"on-the-ground":case"relative-to-ground":this.externalIntersectionHandlers.forAll(e=>{if(e.isGround){const t=e.slicePlaneEnabled?u:null;e.intersect(p,t,p.rayBegin,p.rayEnd,l)}})}if(p.results.min.getIntersectionPoint(Lb)){const e=this.view.computeMapPointFromVec3d(Lb);return e.z=i,e}return null}computeIntersection(e,t,i){if(Object(w["k"])(e))return;const r=this.view.state.camera,n=Object(A["b"])(di["d"].get());r.projectToRenderScreen(e.origin,n);const a=new Fb(i,this._forEachLayer);t.options.selectOpaqueTerrainOnly=!i||!("include"in i||"exclude"in i);const s=e.origin,o=Object(Et["i"])(di["d"].get(),e.origin,e.direction);t.reset(s,o,r),t.intersect(a.layers,n,this.tolerance);const c=this.view.slicePlane,l=Object(w["l"])(c)?Object(Rb["d"])(c):null;t.intersect(a.sliceableLayers,n,this.tolerance,l);const d=i&&(i.requiresGroundFeedback||i.enableDraped);this.externalIntersectionHandlers.forAll(e=>{if(t.options.isFiltered=!a.filterLayerUid(e.layerUid),e.isGround&&d||!t.options.isFiltered){const i=e.slicePlaneEnabled?l:null;e.intersect(t,i,s,o,n)}});const h=di["d"].get();if(i&&i.enableDraped&&t.results.ground.getIntersectionPoint(h)){const e=this.view.basemapTerrain.overlayManager.renderer,i=this.view.renderCoordsHelper.spatialReference,r=di["d"].get();this.view.renderCoordsHelper.fromRenderCoords(h,r,this.view.spatialReference),r[2]=Object(w["v"])(this.view.elevationProvider.getElevation(h[0],h[1],h[2],i,"ground"),0),e.intersect(t,r,t.results.ground,e=>a.filterRenderGeometry(e))}t.sortResults();const u=t.results.hud;if(Object(Rb["a"])(u)){const e=Object(A["b"])(di["d"].get()),i=di["d"].get(),n=di["d"].get();this.unprojectHUDResultRay(u.target.center,e,i,n);const s=Object(Et["p"])(u.target.center,i)/Object(Et["p"])(i,n)*.99;this.validateHUDIntersector.reset(i,n,r),this.validateHUDIntersector.intersect(a.layers,e,this.tolerance),this.validateHUDIntersector.intersect(a.sliceableLayers,e,this.tolerance,l),this.externalIntersectionHandlers.forAll(t=>{if(!a.filterLayerUid(t.layerUid))return;const r=t.slicePlaneEnabled?l:null;t.intersect(this.validateHUDIntersector,r,i,n,e)});const o=this.validateHUDIntersector.results.min;(null==o.dist||s<=o.dist)&&(t.results.min.copy(u),t.results.all.splice(0,0,u))}}unprojectHUDResultRay(e,t,i,r){const n=this.view.state.camera;n.projectToRenderScreen(e,t);const a=Object(A["b"])(di["d"].get());a[0]=t[0],a[1]=t[1],a[2]=0,n.unprojectFromRenderScreen(a,i),a[2]=1,n.unprojectFromRenderScreen(a,r)}}let Db;function Ib(e){return Db&&Db.viewingMode===e||(Db=Object(Xn["b"])(e)),Db}class Fb{constructor(e,t){this.layers=new Array,this.sliceableLayers=new Array,this.include=null==e?void 0:e.include,this.exclude=null==e?void 0:e.exclude,t(e=>{e.isPickable&&this.filterLayerUid(e.apiLayerUid)&&(e.isSliceable?this.sliceableLayers:this.layers).push(e)})}filterLayerUid(e){const{include:t,exclude:i}=this;return Object(w["k"])(e)?null==t&&null==i:(null==t||t.has(e))&&(null==i||!i.has(e))}filterRenderGeometry(e){return this.filterLayerUid(e.layerUid)}}function zb(e){return"object"==typeof e&&"intersect"in e}const Lb=Object(F["f"])(),Vb=Object(A["e"])();var kb=i("1797");let Ub=class extends(Z["a"].EventedMixin(W["a"])){constructor(e){super(e),this.im=new Array,this.ground=new Array,this.scene=new Array,this.handles=new Map,this.lastElevationQuery=null,this.elevationCacheEnabled=!1}destroy(){this._elevationQuery=Object(w["e"])(this._elevationQuery)}get elevationQuery(){return Object(w["k"])(this._elevationQuery)&&(this._elevationQuery=new kb["a"](this.view.resourceController.scheduler,this.view.spatialReference,()=>this.view.map&&this.view.map.ground,{maximumAutoTileRequests:4})),this._elevationQuery}enableElevationCache(e){e||(this.lastElevationQuery=null),this.elevationCacheEnabled=e}getElevation(e,t,i,r,n){if(this.elevationCacheEnabled&&null!=this.lastElevationQuery){const a=this.lastElevationQuery;if(e===a.x&&t===a.y&&i===a.z&&r.equals(a.spatialReference)&&n===a.queryContext)return a.result}let a=null;return a=Bb(a,this.im,e,t,i,r,n),Object(w["k"])(a)&&(a=Bb(a,this.ground,e,t,i,r,n)),"scene"===n&&(a=Bb(a,this.scene,e,t,i,r,n)),this.elevationCacheEnabled&&(this.lastElevationQuery={x:e,y:t,z:i,spatialReference:r,queryContext:n,result:a}),a}queryElevation(e,t,i,r,n,a=null,s=0){const o=Object(S["g"])();return this.elevationQuery.queryElevation(e,t,a,s).then(a=>{"scene"===n&&(a=Bb(a,this.scene,e,t,i,r,n)),o.resolve(a)}).catch(a=>{Object(S["m"])(a)?o.reject(a):o.resolve(this.getElevation(e,t,i,r,n))}),o.promise}register(e,t){this.handles.set(t,t.on("elevation-change",e=>this.emit("elevation-change",e))),this[e].push(t)}unregister(e){this.handles.has(e)&&(this.handles.get(e).remove(),this.handles.delete(e));for(const t of[this.im,this.ground,this.scene]){const i=t.indexOf(e);i>-1&&t.splice(i,1)}}};function Bb(e,t,i,r,n,a,s){for(const o of t){const t=o.getElevation(i,r,n,a,s);Object(w["l"])(t)&&(e=Object(w["l"])(e)?Math.max(t,e):t)}return e}Object(h["a"])([Object(M["b"])({constructOnly:!0})],Ub.prototype,"view",void 0),Object(h["a"])([Object(M["b"])({readOnly:!0,aliasOf:"view.basemapTerrain.spatialReference"})],Ub.prototype,"spatialReference",void 0),Ub=Object(h["a"])([Object(D["a"])("esri.views.3d.support.CombinedElevationProvider")],Ub);class Nb{static isValidProfile(e){return e in Nb.profiles}static getDefaultProfile(){return Object(_["a"])("trident")||Object(_["a"])("esri-iPhone")?"low":"medium"}static apply(e,t){const i=Nb.profiles[e];t.graphics3D.maxTotalNumberOfFeatures=i.graphics3D.maxTotalNumberOfFeatures,t.graphics3D.maxTotalNumberOfPrimitives=i.graphics3D.maxTotalNumberOfPrimitives,t.graphics3D.polygonLodFactor=i.graphics3D.polygonLodFactor,t.graphics3D.polylineLodFactor=i.graphics3D.polylineLodFactor,t.graphics3D.snapshotAvailable=i.graphics3D.snapshotAvailable;{const e=t.sceneService["3dObject"],r=i.sceneService["3dObject"];e.lodFactor=r.lodFactor,e.lodCrossfadeinDuration=r.lodCrossfadeinDuration,e.lodCrossfadeoutDuration=r.lodCrossfadeoutDuration,e.lodCrossfadeUncoveredDuration=r.lodCrossfadeUncoveredDuration}t.sceneService.point.lodFactor=i.sceneService.point.lodFactor,t.sceneService.integratedMesh.lodFactor=i.sceneService.integratedMesh.lodFactor,t.sceneService.pointCloud.lodFactor=i.sceneService.pointCloud.lodFactor,t.sceneService.uncompressedTextureDownsamplingEnabled=i.sceneService.uncompressedTextureDownsamplingEnabled,t.tiledSurface.lodBias=i.tiledSurface.lodBias,t.tiledSurface.angledSplitBias=i.tiledSurface.angledSplitBias,t.tiledSurface.reduceTileLevelDifferences=i.tiledSurface.reduceTileLevelDifferences,t.tiledSurface.textureFadeDuration=i.tiledSurface.textureFadeDuration,t.antialiasingEnabled=i.antialiasingEnabled,t.physicallyBasedRenderingEnabled=i.physicalBasedRenderingEnabled,t.highQualityTransparency=i.highQualityTransparency,t.memoryLimit=i.memoryLimit,t.additionalCacheMemory=i.additionalCacheMemory,t.frameRate=i.frameRate,t.maximumRenderResolution=i.maximumRenderResolution,t.maximumPixelRatio=i.maximumPixelRatio}}function Gb(){const e=!!Object(_["a"])("esri-mobile"),t=!!Object(_["a"])("ios");return{low:{graphics3D:{maxTotalNumberOfFeatures:25e3,maxTotalNumberOfPrimitives:85e4,polygonLodFactor:.5,polylineLodFactor:1,snapshotAvailable:!1},sceneService:{"3dObject":{lodFactor:.2,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:0},point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5,reduceTileLevelDifferences:!1,textureFadeDuration:0},antialiasingEnabled:!1,physicalBasedRenderingEnabled:!1,highQualityTransparency:!1,memoryLimit:200,additionalCacheMemory:0,frameRate:0,maximumRenderResolution:null,maximumPixelRatio:1},medium:{graphics3D:{maxTotalNumberOfFeatures:5e4,maxTotalNumberOfPrimitives:17e5,polygonLodFactor:e?.8:1,polylineLodFactor:e?1.2:1.5,snapshotAvailable:!t},sceneService:{"3dObject":{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:400},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:e},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!Object(_["a"])("disable-feature:reduce-map-tile-levels"),textureFadeDuration:400},antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,memoryLimit:e?600:750,additionalCacheMemory:e?0:150,frameRate:0,maximumRenderResolution:null,maximumPixelRatio:1},high:{graphics3D:{maxTotalNumberOfFeatures:5e4,maxTotalNumberOfPrimitives:17e5,polygonLodFactor:e?1.2:2,polylineLodFactor:e?1.2:2,snapshotAvailable:!t},sceneService:{"3dObject":{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:400},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!Object(_["a"])("disable-feature:reduce-map-tile-levels"),textureFadeDuration:400},antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,memoryLimit:e?900:1500,additionalCacheMemory:0,frameRate:0,maximumRenderResolution:e?null:4096,maximumPixelRatio:e?1:null}}}Nb.debug={reset(){const e=Gb();for(const t in e)Nb.profiles[t]=e[t]}},function(e){e.profiles=Gb()}(Nb||(Nb={}));const qb=Nb;var Hb=i("5ef2");let Wb=class extends W["a"]{constructor(){super(...arguments),this.color=new gt["a"]([0,255,255]),this.haloColor=null,this.haloOpacity=1,this.fillOpacity=.25,this.shadowOpacity=.4,this.shadowColor=new gt["a"]([0,0,0]),this.shadowDifference=.2}static toEngineOptions(e){const t=gt["a"].toUnitRGBA(e.color),i=Object(w["l"])(e.haloColor)?gt["a"].toUnitRGBA(e.haloColor):t,r=gt["a"].toUnitRGBA(e.shadowColor);return{color:Object(Hb["c"])(t[0],t[1],t[2],t[3]),haloColor:Object(Hb["c"])(i[0],i[1],i[2],i[3]),haloOpacity:e.haloOpacity,haloOpacityOccluded:.25*e.haloOpacity,fillOpacity:e.fillOpacity,fillOpacityOccluded:.25*e.fillOpacity,shadowOpacity:e.shadowOpacity,shadowColor:Object(Hb["c"])(r[0],r[1],r[2],r[3]),occludedShadowOpacity:e.shadowOpacity*(1-e.shadowDifference)}}};Object(h["a"])([Object(M["b"])({type:gt["a"]})],Wb.prototype,"color",void 0),Object(h["a"])([Object(M["b"])({type:gt["a"]})],Wb.prototype,"haloColor",void 0),Object(h["a"])([Object(M["b"])()],Wb.prototype,"haloOpacity",void 0),Object(h["a"])([Object(M["b"])()],Wb.prototype,"fillOpacity",void 0),Object(h["a"])([Object(M["b"])()],Wb.prototype,"shadowOpacity",void 0),Object(h["a"])([Object(M["b"])({type:gt["a"]})],Wb.prototype,"shadowColor",void 0),Object(h["a"])([Object(M["b"])()],Wb.prototype,"shadowDifference",void 0),Wb=Object(h["a"])([Object(D["a"])("esri.views.3d.support.HighlightOptions")],Wb);const $b=Wb;var Zb=i("e2e8"),Qb=i("ac91"),Xb=i("7e6b");class Yb{constructor(e,t){this.spatialReference=t,this.unitInMeters=Object(yf["f"])(this.spatialReference,Object(zt["e"])(this.spatialReference).metersPerDegree),this._geometryServiceURLPromise=Object(Zb["getGeometryServiceURL"])(e&&e.get("portalItem")).catch(()=>{throw new v["a"]("mapcoordshelper:missing-geometry-service","Must specify geometryService in esri/config")})}async toGeographic(e){const t=await this._geometryServiceURLPromise;let i,r=!0;Array.isArray(e[0])&&"number"!=typeof e[0]?i=e:(i=[e],r=!1);const n=i.map(e=>e instanceof Br["a"]?e:new Br["a"](e,this.spatialReference)),a=new Xb["a"]({geometries:n,outSpatialReference:c["a"].WGS84}),s=(await Object(Qb["a"])(t,a)).map(e=>"point"===e.type?[e.x,e.y]:void 0);return r?s:s[0]}}let Kb=class extends W["a"]{constructor(){super(...arguments),this.minTotalNumberOfFeatures=2e3,this.maxTotalNumberOfFeatures=5e4,this.maxTotalNumberOfPrimitives=17e5,this.snapshotAvailable=!0,this.polygonLodFactor=1,this.polylineLodFactor=1}};Object(h["a"])([Object(M["b"])()],Kb.prototype,"minTotalNumberOfFeatures",void 0),Object(h["a"])([Object(M["b"])()],Kb.prototype,"maxTotalNumberOfFeatures",void 0),Object(h["a"])([Object(M["b"])()],Kb.prototype,"maxTotalNumberOfPrimitives",void 0),Object(h["a"])([Object(M["b"])()],Kb.prototype,"snapshotAvailable",void 0),Object(h["a"])([Object(M["b"])()],Kb.prototype,"polygonLodFactor",void 0),Object(h["a"])([Object(M["b"])()],Kb.prototype,"polylineLodFactor",void 0),Kb=Object(h["a"])([Object(D["a"])("esri.views.3d.support.QualitySettings.Graphics3DSettings")],Kb);let Jb=class extends W["a"]{constructor(){super(...arguments),this.lodFactor=1}};Object(h["a"])([Object(M["b"])()],Jb.prototype,"lodFactor",void 0),Jb=Object(h["a"])([Object(D["a"])("esri.views.3d.support.QualitySettings.LoDFactorSettings")],Jb);let em=class extends Jb{constructor(){super(...arguments),this.lodCrossfadeinDuration=0,this.lodCrossfadeoutDuration=0,this.lodCrossfadeUncoveredDuration=0}};em=Object(h["a"])([Object(D["a"])("esri.views.3d.support.QualitySettings.LoDFactor3DObjectSettings")],em);let tm=class extends W["a"]{constructor(){super(...arguments),this["3dObject"]=new em,this.point=new Jb,this.integratedMesh=new Jb,this.pointCloud=new Jb,this.uncompressedTextureDownsamplingEnabled=!1}};Object(h["a"])([Object(M["b"])({type:em})],tm.prototype,"3dObject",void 0),Object(h["a"])([Object(M["b"])({type:Jb})],tm.prototype,"point",void 0),Object(h["a"])([Object(M["b"])({type:Jb})],tm.prototype,"integratedMesh",void 0),Object(h["a"])([Object(M["b"])({type:Jb})],tm.prototype,"pointCloud",void 0),Object(h["a"])([Object(M["b"])()],tm.prototype,"uncompressedTextureDownsamplingEnabled",void 0),tm=Object(h["a"])([Object(D["a"])("esri.views.3d.support.QualitySettings.SceneServiceSettings")],tm);let im=class extends W["a"]{constructor(){super(...arguments),this.lodBias=0,this.angledSplitBias=1,this.reduceTileLevelDifferences=!0,this.textureFadeDuration=500}};Object(h["a"])([Object(M["b"])()],im.prototype,"lodBias",void 0),Object(h["a"])([Object(M["b"])()],im.prototype,"angledSplitBias",void 0),Object(h["a"])([Object(M["b"])()],im.prototype,"reduceTileLevelDifferences",void 0),Object(h["a"])([Object(M["b"])()],im.prototype,"textureFadeDuration",void 0),im=Object(h["a"])([Object(D["a"])("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],im);let rm=class extends W["a"]{constructor(){super(...arguments),this.graphics3D=new Kb,this.sceneService=new tm,this.tiledSurface=new im,this.antialiasingEnabled=!0,this.physicallyBasedRenderingEnabled=!1,this.highQualityTransparency=!0}};Object(h["a"])([Object(M["b"])({type:Kb})],rm.prototype,"graphics3D",void 0),Object(h["a"])([Object(M["b"])({type:tm})],rm.prototype,"sceneService",void 0),Object(h["a"])([Object(M["b"])({type:im})],rm.prototype,"tiledSurface",void 0),Object(h["a"])([Object(M["b"])()],rm.prototype,"antialiasingEnabled",void 0),Object(h["a"])([Object(M["b"])()],rm.prototype,"physicallyBasedRenderingEnabled",void 0),Object(h["a"])([Object(M["b"])()],rm.prototype,"highQualityTransparency",void 0),Object(h["a"])([Object(M["b"])()],rm.prototype,"memoryLimit",void 0),Object(h["a"])([Object(M["b"])()],rm.prototype,"additionalCacheMemory",void 0),Object(h["a"])([Object(M["b"])()],rm.prototype,"frameRate",void 0),Object(h["a"])([Object(M["b"])()],rm.prototype,"maximumRenderResolution",void 0),Object(h["a"])([Object(M["b"])()],rm.prototype,"maximumPixelRatio",void 0),rm=Object(h["a"])([Object(D["a"])("esri.views.3d.support.QualitySettings.QualitySettings")],rm);const nm=rm;var am=i("92a1"),sm=i("2aa2"),om=i("aefa");function cm(e){return"function"==typeof e.getUsedMemory}const lm=j["a"].getLogger("esri.views.3d.support.MemoryController");function dm(e){return new mm(e)}const hm=1,um=1,pm=.75,fm=.6,bm=1.3;class mm{constructor(e){this._view=e,this.events=new Z["a"],this.minQuality=.1,this._maxMemory=500,this._additionalCacheMemory=100,this._quality=1,this._stableQuality=0,this._downscaleMemoryUsed=0,this._canFastRecover=!1,this._memoryUsed=0,this._memoryPredicted=0,this._cacheStorage=new om["c"],this._numQualityChanges=0,this._updating=!1}destroy(){this.events=null,this._cacheStorage.destroy()}newCache(e,t){return new om["b"](e,this._cacheStorage,t)}set maxMemory(e){null!=e&&e>0&&(this._stableQuality=0,this._canFastRecover=!1,this._maxMemory<e&&this._updateQuality(hm),this._maxMemory=e)}get maxMemory(){return this._maxMemory}set additionalCacheMemory(e){null!=e&&e>=0&&(this._additionalCacheMemory=e)}disableMemCache(){this._additionalCacheMemory=-4096}get memoryFactor(){return this._quality}get updating(){return this._updating}get usedMemory(){return this._memoryUsed}resetStableQuality(){this._stableQuality=0}update(){if(this._updateMemory(),this._memoryPredicted<=0&&!this._updating)return;let e=this._layersUpdating();if(this._memoryPredicted<fm&&this._canFastRecover)this._downscaleMemoryUsed=0,this._stableQuality=0,this._canFastRecover=!1,this._updateQuality(hm);else if(e)(this._memoryPredicted>1.1*um||this._memoryUsed>um)&&(this._stableQuality>0?(this._downscaleMemoryUsed=0,this._updateQuality(this._stableQuality)):this._quality>this.minQuality&&this._downscaleMemoryUsed<this._memoryUsed&&(this._updateQuality(this._quality/bm),this._downscaleMemoryUsed=this._memoryUsed,this._canFastRecover=!1));else if(this._downscaleMemoryUsed=0,this._memoryUsed>um)this._stableQuality=0,this._canFastRecover=!1,e=this._updateQuality(this._quality/bm),this._downscaleMemoryUsed=this._memoryPredicted;else if(this._stableQuality!==this._quality)if(this._memoryUsed<pm&&this._quality<hm){this._stableQuality=this._quality;const t=.05;e=this._updateQuality(this._quality+t)}else this._quality<1&&(this._canFastRecover=!0);this.updating!==e&&(this._updating=e,this.events.emit("updating-changed",this.updating))}_updateQuality(e){return(e=Math.min(Math.max(e,this.minQuality),hm))!==this._quality&&(this._quality=e,this.events.emit("quality-changed",this._quality),++this._numQualityChanges,!0)}_layersUpdating(){return this._view.allLayerViews.some(e=>!!e.updating)}_updateMemory(){let e=0,t=0;this._view.basemapTerrain&&this._view.basemapTerrain.getUsedMemory&&(e+=this._view.basemapTerrain.getUsedMemory());const i=this._view._stage&&this._view._stage.renderView&&this._view._stage.renderView.edgeView;Object(w["l"])(i)&&(e+=i.usedMemory),this._view.allLayerViews&&this._view.allLayerViews.forEach(i=>{if(cm(i)){const r=i.ignoresMemoryFactor()?this._quality:1;e+=i.getUsedMemory()*r,t+=i.getUnloadedMemory()*r}});const r=null==this._warnMemoryUsage||Math.round(10*e)!==Math.round(10*this._warnMemoryUsage),n=1048576*this._maxMemory;if(e>n&&r){this._warnMemoryUsage=e;const i=e=>(e/1048576).toLocaleString(void 0,{maximumFractionDigits:1})+" MB",r=Math.round(100*this._quality);lm.warn(`Memory Limit exceeded! Limit: ${i(n)} Current: ${i(e)} Projected: ${i(e+t)} Quality: ${r}%`)}this._memoryUsed=e/n,this._memoryPredicted=(e+t)/n;const a=n-e;this._cacheStorage.maxSize=Math.max(0,a+1048576*this._additionalCacheMemory),this.events.emit("memory-used",this._memoryUsed)}get test(){const e=this;return{cacheStorage:this._cacheStorage,resetQualityChanges:()=>{const t=e._numQualityChanges;return e._numQualityChanges=0,t}}}}var gm=i("3af9");let vm=class extends W["a"]{constructor(){super(...arguments),this.updating=!1}};function ym(e,t=(()=>performance.now())){return new Om.ResourceController({view:e,now:t})}var Om;function _m(e){return"performanceInfo"in e}Object(h["a"])([Object(M["b"])({readOnly:!0})],vm.prototype,"updating",void 0),vm=Object(h["a"])([Object(D["a"])("esri.views.3d.support.ResourceController")],vm),function(e){let t=class extends vm{constructor(){super(...arguments),this._scheduler=null,this._memoryController=null,this._streamDataLoader=null,this._cameraChangeTime=0,this._handles=new $["a"],this._frameTask=null,this._scheduleTask=Fi["a"],this._state=2}initialize(){this._cameraChangeTime=this.now(),this._scheduler=Object(Fi["c"])(this.now),this._memoryController=dm(this.view),this._streamDataLoader=new gm["b"],this._streamDataLoader.setup(sm["b"],sm["a"],this._scheduler),this._handles.add([this.view.watch("state.camera",(e,t)=>this._cameraChangedHandler(e,t),!0),this.view.watch("stationary",()=>this._stationaryChangedHandler()),this._memoryController.events.on("updating-changed",()=>this.notifyChange("updating"))]),this._frameTask=Object(T["a"])({update:e=>this.frame(e)}),this._scheduleTask=this._scheduler.registerTask(Fi["b"].RESOURCE_CONTROLLER)}destroy(){this._handles=Object(w["e"])(this._handles),this._scheduleTask.remove(),this._frameTask=Object(w["t"])(this._frameTask),this._streamDataLoader=Object(w["e"])(this._streamDataLoader),this._memoryController=Object(w["e"])(this._memoryController),this._scheduler=Object(w["e"])(this._scheduler)}get updating(){var e,t;return!!(null!=(e=this._memoryController)&&e.updating||null!=(t=this._streamDataLoader)&&t.updating)}get scheduler(){return this._scheduler}get memoryController(){return this._memoryController}schedule(e,t,i){return this._scheduleTask.schedule(e,t,i)}createStreamDataRequester(e){const t=this._streamDataLoader;return{request:(i,r,n)=>t.request(i,r,e,n),get busy(){return!t.hasDownloadSlots(e)}}}frame(e){this.view.suspended||this.view.stateManager&&(this.view.stateManager.step(Object(On["d"])(e.deltaTime)),!this._scheduler)||(this._updateState(),this._scheduler.state=this._state,this._scheduler.updateBudget(e)?(this._memoryController.update(),this._scheduler.frame()):this._memoryController.updating&&this._memoryController.update())}_cameraChangedHandler(e,t){e&&t&&e.almostEquals(t)||(this._cameraChangeTime=this._scheduler.now,this._updateState(),this._scheduler.state=this._state)}_stationaryChangedHandler(){this.memoryController.resetStableQuality()}_updateState(){this.view.animation?this._state=0:this.view.interacting?this._state=1:(0===this._state&&(this._cameraChangeTime=0),this._scheduler.now-this._cameraChangeTime<=i?this._state=1:this._state=2)}get test(){return{getQueueStats:e=>this._streamDataLoader.test.loadQueue.getStatsForType(e),state:this._state}}};Object(h["a"])([Object(M["b"])({constructOnly:!0})],t.prototype,"view",void 0),Object(h["a"])([Object(M["b"])({constructOnly:!0})],t.prototype,"now",void 0),Object(h["a"])([Object(M["b"])()],t.prototype,"_scheduler",void 0),Object(h["a"])([Object(M["b"])()],t.prototype,"_memoryController",void 0),Object(h["a"])([Object(M["b"])()],t.prototype,"_streamDataLoader",void 0),Object(h["a"])([Object(M["b"])({readOnly:!0})],t.prototype,"updating",null),t=Object(h["a"])([Object(D["a"])("esri.views.3d.support.ResourceController")],t),e.ResourceController=t;const i=300}(Om||(Om={}));var xm=i("8b9d");class jm{constructor(e,t){if(this.layer=null,this.memory=0,this.displayedNumberOfFeatures=0,this.maximumNumberOfFeatures=null,this.totalNumberOfFeatures=null,this.layer=e.layer,this.memory=Object(xm["j"])(e)?t.basemapTerrain.getUsedMemoryForLayerView(e):e.getUsedMemory(),_m(e)){const t=e.performanceInfo;this.displayedNumberOfFeatures=t.displayedNumberOfFeatures,this.maximumNumberOfFeatures=t.maximumNumberOfFeatures,this.totalNumberOfFeatures=t.totalNumberOfFeatures}}}class wm{constructor(e){this.totalMemory=0,this.usedMemory=0,this.quality=1,this.load=0,this.terrainMemory=0,this.edgesMemory=0,this.layerPerformanceInfos=new Array;const t=e.resourceController.memoryController;this.totalMemory=1048576*t.maxMemory,this.usedMemory=Math.round(t.usedMemory*this.totalMemory),this.quality=t.memoryFactor,this.load=e.resourceController.scheduler.load,this.terrainMemory=e.basemapTerrain?e.basemapTerrain.getUsedMemory():0;const i=e._stage&&e._stage.renderView&&e._stage.renderView.edgeView;this.edgesMemory=Object(w["l"])(i)?i.usedMemory:0,e.allLayerViews.items.forEach(t=>{(cm(t)||Object(xm["j"])(t))&&this.layerPerformanceInfos.push(new jm(t,e))}),this.layerPerformanceInfos.sort((e,t)=>t.memory-e.memory)}}var Sm=i("e041"),Tm=i("1dbc"),Cm=i("1e2c");class Pm extends Tm["a"]{constructor(e,t,i,r){super(t,r),this._streamDataRequester=e,this._parameters=i}async fromUrl(e,t,i){Object(S["w"])(i);const r=Object(w["l"])(i)&&i.signal,n=this.makeUid(e,t);let a=this._textureRequests.get(n);if(!a){const i=new AbortController,r=this._streamDataRequester.request(e,"image",{uid:n,signal:i.signal});a={referenceCount:0,texture:null,textureAsync:null,abortController:i},this._textureRequests.set(n,a),a.textureAsync=r.then(async i=>{const r=this._createTexture(e,i,t);return a.texture=r,a.abortController=null,this._stage.add(r),await this._stage.load(r),{uid:n,texture:r,release:()=>this._release(n)}},e=>{throw a.abortController=null,e})}return a.referenceCount++,new Promise((e,t)=>{Object(S["r"])(r,()=>{t(Object(S["e"])())}),a.textureAsync.then(e,t)}).catch(e=>{throw this._release(n),e})}_createTexture(e,t,i){const r={...this._parameters,powerOfTwoResizeMode:2};if(Object(Sm["x"])(e)){if(i||0===t.width&&0===t.height){const e=t.width?t.height/t.width:1;i=i||64,e>1?(t.width=Math.round(i/e),t.height=i):(t.width=i,t.height=Math.round(i*e))}this._stage.renderView&&this._stage.renderView.renderingContext.driverTest.svgAlwaysPremultipliesAlpha&&(r.preMultiplyAlpha=!1)}return r.width=t.width,r.height=t.height,new Cm["a"](t,r)}}class Am{constructor(e){this.textures=null,this.streamDataRequester=null,this.graphicsOwners=[],this.screenSizePerspectiveHandles=null,this.cimSymbolRasterizer=null,this.viewState=e.viewState,this.view=e.view,this.pointsOfInterest=e.pointsOfInterest,this.objectResourceCache=e.objectResourceCache,this.streamDataRequester=e.resourceController.createStreamDataRequester(4),this.textures=new Pm(this.streamDataRequester,e.view._stage,{preMultiplyAlpha:!0,wrap:{s:33071,t:33071}},e.resourceController.scheduler);const t=Object(zt["e"])(this.view.spatialReference).radius;this.screenSizePerspectiveSettings=Object(Yh["d"])(e.viewingMode,t),this.screenSizePerspectiveSettingsLabels=Object(Yh["c"])(e.viewingMode,t)}destroy(){this.textures.destroy(),this.textures=null,this.streamDataRequester=null}addGraphicsOwner(e){if(!e)return{remove(){}};this.graphicsOwners.push(e);const t="layer"in e?e.watch("layer.screenSizePerspectiveEnabled",()=>this.updateScreenSizePerspectiveEnabled()):null;return this.updateScreenSizePerspectiveEnabled(),{remove:()=>{t&&(t.remove(),Object(R["k"])(this.graphicsOwners,e),this.updateScreenSizePerspectiveEnabled())}}}updateScreenSizePerspectiveEnabled(){const e=this.graphicsOwners.some(e=>!0===e.get("layer.screenSizePerspectiveEnabled"));if(e&&!this.screenSizePerspectiveHandles){this.screenSizePerspectiveHandles=new $["a"];const e=()=>this.updateScreenSizePerspectiveSettings();this.screenSizePerspectiveHandles.add([this.pointsOfInterest.centerOnSurfaceInfrequent.watch("distance",e,!0),this.viewState.events.on("camera-projection-changed",e)]),this.updateScreenSizePerspectiveSettings()}else!e&&this.screenSizePerspectiveHandles&&(this.screenSizePerspectiveHandles.destroy(),this.screenSizePerspectiveHandles=null)}updateScreenSizePerspectiveSettings(){const e=this.pointsOfInterest;Mm.distance=e.centerOnSurfaceInfrequent.distance,Mm.fovY=this.viewState.camera.fovY,this.screenSizePerspectiveSettings.update(Mm),this.screenSizePerspectiveSettingsLabels.update(Mm),this.view._stage.renderView.requestRender()}}const Mm={distance:0,fovY:0};i("1fd7"),i("1219"),i("c128"),i("35c9");var Rm=i("7533"),Em=i("6005"),Dm=i("a957");class Im{constructor(e,t,i=""){this.graphics=e,this._symbol=new Rm["a"]({symbolLayers:[new Em["a"]({material:{color:t},outline:{color:[255,255,255],size:1},resource:{primitive:"circle"}}),new Dm["a"]({text:i,halo:{color:"white",size:1/.75},material:{color:t},size:12})]})}show(e,t){if(Object(w["k"])(t))return;this.hide();const i=new Br["a"]({x:e[0],y:e[1],z:e[2],spatialReference:t});this._graphic=new p["a"]({geometry:i,symbol:this._symbol}),this.graphics.add(this._graphic)}hide(){Object(w["l"])(this._graphic)&&(this.graphics.remove(this._graphic),this._graphic=null)}}let Fm=class extends W["a"]{constructor(e){super(e),this.handles=new $["a"]}destroy(){this.handles.destroy()}};Object(h["a"])([Object(M["b"])({constructOnly:!0})],Fm.prototype,"renderCoordsHelper",void 0),Object(h["a"])([Object(M["b"])({constructOnly:!0})],Fm.prototype,"surface",void 0),Object(h["a"])([Object(M["b"])({constructOnly:!0})],Fm.prototype,"state",void 0),Fm=Object(h["a"])([Object(D["a"])("esri.views.3d.support.PointOfInterest")],Fm);const zm=Array;let Lm=class extends Fm{constructor(e){super(e),this._dirty=!1,this._propertiesPool=new pf["a"]({location:Br["a"],renderLocation:zm},this),this._estimatedSurfaceAltitude=0,this._pendingElevationQueryController=null,this.cameraName="camera",this.renderLocation=Object(F["f"])(),this.tmpPoint=new Br["a"]}initialize(){if(this.scheduler&&this.handles.add(this.scheduler.registerTask(this.task,this)),this.runTask(),this.map){const e=()=>this._setDirty();this.handles.add(Object(C["b"])(this.map,"ground.layers","change",e,e,e))}this._updateRenderLocation()}destroy(){this._cancelPendingRequest(),this._propertiesPool.destroy(),this._propertiesPool=null}get _camera(){return this.state[this.cameraName]}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}get scale(){const e=this._camera,t=Object(Et["p"])(e.eye,this.renderLocation),i={renderCoordsHelper:this.renderCoordsHelper,state:{camera:e}};return td(i,t,0)}get updating(){return this._dirty||null!=this._pendingElevationQueryController}updateRenderLocation(){this._setDirty(),this._updateRenderLocation()}_setDirty(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))}_cancelPendingRequest(){const e=this._pendingElevationQueryController;e&&(this._pendingElevationQueryController=null,e.abort(),this.notifyChange("updating"))}get running(){return!this._pendingElevationQueryController&&this._dirty}runTask(){if(this._cancelPendingRequest(),this._dirty=!1,this.notifyChange("updating"),!this.map||!this.map.ground)return void this._updateSurfaceAltitude(0);this.renderCoordsHelper.fromRenderCoords(this._camera.eye,this.tmpPoint,this.state.spatialReference);let e=new AbortController;this.map.ground.queryElevation(this.tmpPoint,{signal:e.signal,cache:this.cache}).then(e=>this._updateSurfaceAltitude(e.geometry.z)).catch(e=>{Object(S["m"])(e)||this._updateSurfaceAltitude(0)}).catch(()=>{}).then(()=>{this._pendingElevationQueryController===e&&(this._pendingElevationQueryController=null,this.notifyChange("updating")),e=null}),this._pendingElevationQueryController=e}_updateSurfaceAltitude(e){this._estimatedSurfaceAltitude!==e&&(this._estimatedSurfaceAltitude=e,this._updateRenderLocation())}_updateRenderLocation(){this.renderCoordsHelper.setAltitude(Vm,this._estimatedSurfaceAltitude,this._camera.eye),Object(Et["r"])(this._get("renderLocation"),Vm)||this._set("renderLocation",Object(Et["n"])(this._propertiesPool.get("renderLocation"),Vm))}};Object(h["a"])([Object(M["b"])({constructOnly:!0})],Lm.prototype,"scheduler",void 0),Object(h["a"])([Object(M["b"])({constructOnly:!0})],Lm.prototype,"cache",void 0),Object(h["a"])([Object(M["b"])({constructOnly:!0})],Lm.prototype,"task",void 0),Object(h["a"])([Object(M["b"])({constructOnly:!0})],Lm.prototype,"cameraName",void 0),Object(h["a"])([Object(M["b"])({readOnly:!0})],Lm.prototype,"location",null),Object(h["a"])([Object(M["b"])({constructOnly:!0})],Lm.prototype,"map",void 0),Object(h["a"])([Object(M["b"])({readOnly:!0})],Lm.prototype,"renderLocation",void 0),Object(h["a"])([Object(M["b"])({readOnly:!0})],Lm.prototype,"scale",null),Object(h["a"])([Object(M["b"])({readOnly:!0})],Lm.prototype,"updating",null),Lm=Object(h["a"])([Object(D["a"])("esri.views.3d.support.CameraOnSurface")],Lm);const Vm=Object(F["f"])(),km=Lm,Um=Array;let Bm=class extends Fm{constructor(e){super(e),this._propertiesPool=new pf["a"]({location:Br["a"],renderLocation:Um},this),this._currentSurfaceAltitude=0,this._latestSurfaceAltitude=0,this.cameraName="camera",this.distance=0,this.renderLocation=Object(F["f"])(),this.updating=!1}initialize(){this._frameWorker=this.scheduler.registerTask(this.task,this),this.runTask()}destroy(){this._frameWorker&&(this._frameWorker.remove(),this._frameWorker=null),this._propertiesPool.destroy(),this._propertiesPool=null}get _camera(){return this.state[this.cameraName]}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}updateRenderLocation(){this.updating=!0,this._updateRenderLocation()}get estimatedSurfaceAltitude(){return this._latestSurfaceAltitude}get running(){return this.updating}runTask(){this._latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter(),this._updateRenderLocation(),this.updating=!1}_updateRenderLocation(){const e=Gm;let t=this.calculateSurfaceIntersection(this._currentSurfaceAltitude,e);const i=this._currentSurfaceAltitude!==this._latestSurfaceAltitude;!t&&i&&(t=this.calculateSurfaceIntersection(this._latestSurfaceAltitude,e),t&&(this._currentSurfaceAltitude=this._latestSurfaceAltitude));const r=qm;t&&this.latestSurfaceAltitudeChangesDistanceSignificantly(e,r)&&(Object(Et["n"])(e,r),this._currentSurfaceAltitude=this._latestSurfaceAltitude),t?this.distance=Object(Et["p"])(this._camera.eye,e):(Object(Et["h"])(e,this._camera.viewForward,this._get("distance")),Object(Et["i"])(e,e,this._camera.eye)),Object(Et["r"])(this._get("renderLocation"),e)||this._set("renderLocation",Object(Et["n"])(this._propertiesPool.get("renderLocation"),e))}calculateSurfaceIntersection(e,t){const i=this._camera;if(!this.renderCoordsHelper.intersectManifold(i.ray,e,t))return!1;if(this.state.isGlobal){const r=Object(zt["e"])(this.renderCoordsHelper.spatialReference).radius,n=r+e,a=Object(Et["w"])(i.eye),s=a<n*n,o=Object(Et["p"])(i.eye,t);if(s&&o>r/4){const e=n-Math.sqrt(a);return Object(Et["h"])(t,i.viewForward,e),Object(Et["i"])(t,t,i.eye),!0}}else{const e=this.surface.ready?this.surface.extent:null;Object(w["l"])(e)&&Object(L["n"])(e,this.surface.spatialReference,Hm,this.renderCoordsHelper.spatialReference)&&(t[0]=Object(Oe["f"])(t[0],Hm[0],Hm[2]),t[1]=Object(Oe["f"])(t[1],Hm[1],Hm[3]))}return!0}latestSurfaceAltitudeChangesDistanceSignificantly(e,t){if(this._latestSurfaceAltitude===this._currentSurfaceAltitude||null==e)return!1;if(this.calculateSurfaceIntersection(this._latestSurfaceAltitude,t)){if(Lh["a"].TESTS_DISABLE_OPTIMIZATIONS)return!0;const i=this._camera.eye,r=Object(Et["p"])(i,e),n=Object(Et["p"])(i,t);if(Math.abs(n-r)/r>Nm)return!0}return!1}};Object(h["a"])([Object(M["b"])({constructOnly:!0})],Bm.prototype,"scheduler",void 0),Object(h["a"])([Object(M["b"])({constructOnly:!0})],Bm.prototype,"task",void 0),Object(h["a"])([Object(M["b"])({constructOnly:!0})],Bm.prototype,"cameraName",void 0),Object(h["a"])([Object(M["b"])()],Bm.prototype,"distance",void 0),Object(h["a"])([Object(M["b"])({constructOnly:!0})],Bm.prototype,"estimateSurfaceAltitudeAtCenter",void 0),Object(h["a"])([Object(M["b"])({readOnly:!0})],Bm.prototype,"location",null),Object(h["a"])([Object(M["b"])({readOnly:!0})],Bm.prototype,"renderLocation",void 0),Object(h["a"])([Object(M["b"])()],Bm.prototype,"updating",void 0),Bm=Object(h["a"])([Object(D["a"])("esri.views.3d.support.CenterOnSurface")],Bm);const Nm=.05,Gm=Object(F["f"])(),qm=Object(F["f"])(),Hm=Object(V["m"])(),Wm=Bm;class $m{constructor(e){this.handles=new $["a"],this.events=new Z["a"],this.contentLayerViews=e.contentLayerViews,this.handles.add(this.contentLayerViews.on("change",e=>this.layerViewsChanged(e))),this.layerViewsChanged({added:this.contentLayerViews.toArray(),removed:[],moved:[],target:this.contentLayerViews})}destroy(){this.handles&&(this.handles.destroy(),this.handles=null)}layerViewsChanged(e){e.added.forEach(e=>{"esri.views.3d.layers.SceneLayerView3D"===e.declaredClass&&this.handles.add(e.on("visible-geometry-changed",()=>this.contentChanged()),e.uid)}),e.removed.forEach(e=>this.handles.remove(e.uid))}contentChanged(){this.events.emit("request-update",Zm)}}const Zm={},Qm=Array;let Xm=class extends Fm{constructor(e){super(e),this._propertiesPool=new pf["a"]({location:Br["a"],renderLocation:Qm},this),this._dirty=!0,this.renderLocation=this._propertiesPool.get("renderLocation")}initialize(){this.handles.add([this.centerOnSurface.watch("renderLocation",()=>this.updateRenderLocation()),this.state.watch("contentCamera",()=>this.updateRenderLocation())]),this.scheduler&&this.handles.add(this.scheduler.registerTask(Fi["b"].POINT_OF_INTEREST_FREQUENT,this))}destroy(){this._propertiesPool.destroy(),this._propertiesPool=null}get updating(){return this._dirty||this.centerOnSurface.updating}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}get running(){return this._dirty}runTask(){const e=this._get("renderLocation"),t=this.centerOnSurface.renderLocation,i=this.renderCoordsHelper,r=this.state.contentCamera;this._dirty=!1,i.worldUpAtPosition(t,Ym);const n=Math.max(0,(Math.acos(Object(Et["k"])(Ym,r.viewForward))-.5*Math.PI)*(r.aboveGround?1:-1));if(Number.isNaN(n)){if(!e||!Object(Et["G"])(e,t)){const e=this._propertiesPool.get("renderLocation");Object(Et["n"])(e,t),this._set("renderLocation",e)}return}const a=1-Object(Oe["f"])(n/(.5*Math.PI),0,1),s=a*a*a;this._calculateScreenHorizontalEdgeOnSurface(Jm);const o=this._propertiesPool.get("renderLocation");Object(Et["l"])(o,t,Jm,s),e&&Object(Et["G"])(e,o)||this._set("renderLocation",o)}_calculateScreenHorizontalEdgeOnSurface(e){const t=this.state.contentCamera,i=t.getRenderCenter(Object(A["e"])());if(i[1]=t.aboveGround?t.padding[2]:t.fullHeight-t.padding[0],this.estimateSurfaceIntersectionAtRenderPoint(i,e))return e;const r=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation);if(t.unprojectFromRenderScreen(i,Km)){Object(Et["m"])(Km,Km,t.eye);const i=Object(Et["u"])(Km,Km);if(this.renderCoordsHelper.intersectManifold(Object(xn["h"])(t.eye,i),r,e))return e}return this.renderCoordsHelper.setAltitude(e,r,t.eye)}updateRenderLocation(){this._dirty=!0}};Object(h["a"])([Object(M["b"])()],Xm.prototype,"_dirty",void 0),Object(h["a"])([Object(M["b"])({constructOnly:!0})],Xm.prototype,"scheduler",void 0),Object(h["a"])([Object(M["b"])({constructOnly:!0})],Xm.prototype,"centerOnSurface",void 0),Object(h["a"])([Object(M["b"])({constructOnly:!0})],Xm.prototype,"estimateSurfaceIntersectionAtRenderPoint",void 0),Object(h["a"])([Object(M["b"])({readOnly:!0})],Xm.prototype,"updating",null),Object(h["a"])([Object(M["b"])({readOnly:!0})],Xm.prototype,"location",null),Object(h["a"])([Object(M["b"])({readOnly:!0})],Xm.prototype,"renderLocation",void 0),Xm=Object(h["a"])([Object(D["a"])("esri.views.3d.support.CenterOnSurface")],Xm);const Ym=Object(F["f"])(),Km=Object(F["f"])(),Jm=Object(F["f"])(),eg=Xm;let tg=class extends W["a"]{constructor(e){super(e),this.location=null,this._updateController=null,this._handles=new $["a"]}get renderLocation(){if(!this.location)return null;const e=Object(F["f"])();return this.view.renderCoordsHelper.toRenderCoords(this.location,e),e}initialize(){this.view.state.isLocal&&(this._handles.add([this.watch(["surfaceView.spatialReference","surfaceView.extent"],()=>this._update()),Object(C["b"])(this,"surface.layers","change",()=>this._update())]),this._update())}destroy(){this._handles.destroy()}_update(){if(this._updateController&&(this._updateController.abort(),this._updateController=null),!this.surfaceView||Object(w["k"])(this.surfaceView.extent)||!this.surfaceView.spatialReference)return void this._set("location",null);const e=Object(V["e"])(this.surfaceView.extent),t=new Br["a"]({x:e[0],y:e[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&this.surface.layers.length>0?(this._set("location",null),this._updateController=new AbortController,this.surface.queryElevation(t,{noDataValue:0,signal:this._updateController.signal,cache:this.cache}).then(e=>{this._updateController=null,this._set("location",e.geometry)}).catch(e=>{Object(S["m"])(e)||e&&"elevation-query:invalid-layer"===e.name||console.error("StableSurfaceCenter failed to update: ",e)})):this._set("location",t)}};Object(h["a"])([Object(M["b"])({constructOnly:!0})],tg.prototype,"view",void 0),Object(h["a"])([Object(M["b"])({constructOnly:!0})],tg.prototype,"cache",void 0),Object(h["a"])([Object(M["b"])({readOnly:!0,aliasOf:"view.map.ground"})],tg.prototype,"surface",void 0),Object(h["a"])([Object(M["b"])({readOnly:!0,aliasOf:"view.basemapTerrain"})],tg.prototype,"surfaceView",void 0),Object(h["a"])([Object(M["b"])({readOnly:!0})],tg.prototype,"location",void 0),Object(h["a"])([Object(M["b"])({readOnly:!0})],tg.prototype,"renderLocation",null),tg=Object(h["a"])([Object(D["a"])("esri.views.3d.terrain.StableSurfaceCenter")],tg);let ig=class extends W["a"]{constructor(){super(...arguments),this.handles=new $["a"],this._tileGeometryUpdateExtent=Object(V["o"])(),this._tileGeometryUpdateSpatialReference=null,this.events=new Z["a"],this.updating=!1}initialize(){this.handles.add([this.surface.on("elevation-change",e=>this._tileGeometryChanged(e)),this.scheduler.registerTask(Fi["b"].SURFACE_GEOMETRY_UPDATES,this)])}destroy(){this.handles&&(this.handles.destroy(),this.handles=null)}get running(){return this.updating}runTask(){this.updating&&(this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",rg),Object(V["o"])(this._tileGeometryUpdateExtent),this._set("updating",!1))}_tileGeometryChanged(e){this._tileGeometryUpdateSpatialReference=e.spatialReference,Object(V["q"])(this._tileGeometryUpdateExtent,e.tile.extent,this._tileGeometryUpdateExtent),this._set("updating",!0)}_furthestCenterOnSurface(){let e=this.centerOnSurfaces[0];for(let t=1;t<this.centerOnSurfaces.length;t++){const i=this.centerOnSurfaces[t];i.distance>e.distance&&(e=i)}return e}_centerIntersectsExtent(e,t){const i=this.state.camera.eye,r=sg,n=this._furthestCenterOnSurface();return this.renderCoordsHelper.fromRenderCoords(i,ng,t),this.renderCoordsHelper.fromRenderCoords(n.renderLocation,ag,t),ng[0]<ag[0]?(r[0]=ng[0],r[2]=ag[0]):(r[0]=ag[0],r[2]=ng[0]),ng[1]<ag[1]?(r[1]=ng[1],r[3]=ag[1]):(r[1]=ag[1],r[3]=ng[1]),Object(V["x"])(r,e)}};Object(h["a"])([Object(M["b"])({constructOnly:!0})],ig.prototype,"state",void 0),Object(h["a"])([Object(M["b"])({constructOnly:!0})],ig.prototype,"centerOnSurfaces",void 0),Object(h["a"])([Object(M["b"])({constructOnly:!0})],ig.prototype,"renderCoordsHelper",void 0),Object(h["a"])([Object(M["b"])({constructOnly:!0})],ig.prototype,"scheduler",void 0),Object(h["a"])([Object(M["b"])({constructOnly:!0})],ig.prototype,"surface",void 0),Object(h["a"])([Object(M["b"])({readOnly:!0})],ig.prototype,"updating",void 0),ig=Object(h["a"])([Object(D["a"])("esri.views.3d.support.SurfaceGeometryUpdates")],ig);const rg={},ng=Object(F["f"])(),ag=Object(F["f"])(),sg=Object(V["o"])();var og=i("89bf");let cg=class extends W["a"]{constructor(e){super(e),this._handles=new $["a"],this._tmpRay=Object(xn["c"])(),this._centerRayDirty=!0,this._surfaceAltitudeAtCenter=0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenter=0,this._contentAltitudeAtCenterDirty=!0,this._propertiesPool=new pf["a"]({renderPointOfView:lg},this),this.renderPointOfView=Object(F["f"])(),this._pois=new Array,this._debugCenters=new Map}initialize(){var e;const{state:t,basemapTerrain:i,renderCoordsHelper:r,map:n}=this.view;this._surfaceIntersector=Object(Xn["b"])(t.viewingMode),t.isGlobal?this._surfaceIntersector.options.backfacesTerrain=!1:this._surfaceIntersector.options.backfacesTerrain=!0,this._surfaceIntersector.options.invisibleTerrain=!1,this._surfaceIntersector.options.store=0,this._contentIntersector=Object(Xn["b"])(t.viewingMode);const a=()=>this._estimateSurfaceAltitudeAtCenter(),s=this.view.resourceController.scheduler,o=Object(w["u"])(null==(e=this.view.basemapTerrain)?void 0:e.elevationQueryCache),c={state:t,scheduler:s,surface:i,renderCoordsHelper:r};this._set("centerOnSurfaceInfrequent",new Wm({...c,task:Fi["b"].POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:a})),this._set("centerOnSurfaceFrequent",new Wm({...c,task:Fi["b"].POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:a})),this._set("contentCenterOnSurface",new Wm({...c,task:Fi["b"].POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:a,cameraName:"contentCamera"})),this._set("centerOnContent",new Wm({...c,task:Fi["b"].POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:()=>this._estimateContentAltitudeAtCenter()})),this._set("cameraOnSurface",new km({...c,cache:o,task:Fi["b"].POINT_OF_INTEREST_INFREQUENT,map:n})),this._set("contentCameraOnSurface",new km({...c,cache:o,task:Fi["b"].POINT_OF_INTEREST_INFREQUENT,map:n,cameraName:"contentCamera"})),this._set("surfaceGeometryUpdates",new ig({...c,centerOnSurfaces:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]})),this._set("contentGeometryUpdates",new $m({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:r})),this._set("surfaceOrigin",new tg({cache:o,view:this.view})),this._set("focus",new eg({state:t,scheduler:s,surface:i,renderCoordsHelper:r,centerOnSurface:this.contentCenterOnSurface,estimateSurfaceIntersectionAtRenderPoint:(e,t)=>this._estimateSurfaceIntersectionAtRenderPoint(e,this.view.state.contentCamera,t)})),this._pois.push(this.centerOnContent,this.centerOnSurfaceFrequent,this.centerOnSurfaceInfrequent,this.contentCenterOnSurface,this.cameraOnSurface,this.contentCameraOnSurface,this.focus);const l=this.view.graphics;this._debugCenters.set(this.centerOnContent,new Im(l,"red","CenterOnContent")),this._debugCenters.set(this.centerOnSurfaceFrequent,new Im(l,"red","CenterOnSurface")),this._debugCenters.set(this.centerOnSurfaceInfrequent,new Im(l,"red","CenterOnSurface")),this._debugCenters.set(this.contentCenterOnSurface,new Im(l,"red","ContentCenterOnSurface")),this._debugCenters.set(this.cameraOnSurface,new Im(l,"blue","CameraOnSurface")),this._debugCenters.set(this.contentCameraOnSurface,new Im(l,"blue","ContentCameraOnSurface")),this._debugCenters.set(this.focus,new Im(l,"green","Focus")),this._handles.add([t.watch("camera",e=>this._cameraChanged(e),!0),i.watch("extent",()=>this._updateCenterPointsOfInterest()),Object(C["g"])(i,"updating",()=>this._updateCenterPointsOfInterest(),!0),this.surfaceGeometryUpdates.events.on("request-update",()=>this._updateCenterPointsOfInterest()),this.contentGeometryUpdates.events.on("request-update",()=>this._updateCenterOnContent()),Object(C["a"])(Lh["a"],"SHOW_POI",e=>this._setDebug(e))]),this._cameraChanged(this.view.state.camera);for(const d of this._pois)d.runTask()}destroy(){this._setDebug(!1),this._handles.destroy(),this._propertiesPool.destroy();for(const e of this._pois)e.destroy();this.surfaceOrigin.destroy()}get updating(){var e;return!!(null!=(e=this.surfaceGeometryUpdates)&&e.updating||this._pois.some(e=>e.updating))}get centerRay(){return this._centerRayDirty&&(this._centerRay=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(this.view.state.camera,this._tmpRay),this._centerRayDirty=!1),this._centerRay}_estimateContentAltitudeAtCenter(){if(!this._contentAltitudeAtCenterDirty)return this._contentAltitudeAtCenter;this._contentAltitudeAtCenterDirty=!1;const e=this.centerRay;return Object(w["k"])(e)||(this.view.sceneIntersectionHelper.intersectRay(e,this._contentIntersector,dg,ug)?this._contentAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(dg):this._contentAltitudeAtCenter=this._estimateSurfaceAltitudeAtCenter()),this._contentAltitudeAtCenter}_estimateSurfaceAltitudeAtCenter(){if(!this.view.basemapTerrain)return 0;if(!this._surfaceAltitudeAtCenterDirty)return this._surfaceAltitudeAtCenter;this._surfaceAltitudeAtCenterDirty=!1;const e=this.centerRay;if(Object(w["k"])(e))return this._surfaceAltitudeAtCenter;const t=e.origin,i=Object(Et["i"])(dg,e.origin,e.direction);return this._surfaceIntersector.resetWithRay(e,this.view.state.camera),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,t,i),this._surfaceIntersector.results.min.getIntersectionPoint(dg)&&(this._surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(dg)),this._surfaceAltitudeAtCenter}_estimateSurfaceIntersectionAtRenderPoint(e,t,i){const r=Object(go["b"])(t,e,hg);if(Object(w["k"])(r))return null;const n=r.origin,a=Object(Et["i"])(dg,r.origin,r.direction);return this._surfaceIntersector.resetWithRay(r,t),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,n,a),this._surfaceIntersector.results.min.getIntersectionPoint(i)?i:null}_cameraChanged(e){this._updateCenterPointsOfInterest();const t=e.eye;Object(Et["r"])(this.renderPointOfView,t)||this._set("renderPointOfView",Object(Et["n"])(this._propertiesPool.get("renderPointOfView"),t))}_updateCenterPointsOfInterest(){this._centerRayDirty=!0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenterDirty=!0;for(const e of this._pois)e.updateRenderLocation()}_updateCenterOnContent(){this._contentAltitudeAtCenterDirty=!0,this.centerOnContent.updateRenderLocation()}_setDebug(e){if(!e)return this._debugCenters.forEach(e=>e.hide()),void this._handles.remove("debug");for(const t of this._pois)this._handles.add(Object(C["a"])(t,"renderLocation",e=>this._debugCenters.get(t).show(e,t.renderCoordsHelper.spatialReference)),"debug")}get test(){return{update:()=>{this.surfaceGeometryUpdates.runTask();for(const e of this._pois)e.runTask()},surfaceGeometryUpdates:this.surfaceGeometryUpdates}}};Object(h["a"])([Object(M["b"])({readOnly:!0})],cg.prototype,"centerOnContent",void 0),Object(h["a"])([Object(M["b"])({readOnly:!0})],cg.prototype,"centerOnSurfaceFrequent",void 0),Object(h["a"])([Object(M["b"])({readOnly:!0})],cg.prototype,"centerOnSurfaceInfrequent",void 0),Object(h["a"])([Object(M["b"])({readOnly:!0})],cg.prototype,"contentCenterOnSurface",void 0),Object(h["a"])([Object(M["b"])({readOnly:!0})],cg.prototype,"cameraOnSurface",void 0),Object(h["a"])([Object(M["b"])({readOnly:!0})],cg.prototype,"contentCameraOnSurface",void 0),Object(h["a"])([Object(M["b"])({readOnly:!0})],cg.prototype,"focus",void 0),Object(h["a"])([Object(M["b"])({readOnly:!0})],cg.prototype,"renderPointOfView",void 0),Object(h["a"])([Object(M["b"])({readOnly:!0})],cg.prototype,"surfaceOrigin",void 0),Object(h["a"])([Object(M["b"])({readOnly:!0})],cg.prototype,"contentGeometryUpdates",void 0),Object(h["a"])([Object(M["b"])({readOnly:!0})],cg.prototype,"surfaceGeometryUpdates",void 0),Object(h["a"])([Object(M["b"])({constructOnly:!0})],cg.prototype,"view",void 0),Object(h["a"])([Object(M["b"])({readOnly:!0})],cg.prototype,"updating",null),cg=Object(h["a"])([Object(D["a"])("esri.views.3d.support.PointsOfInterest")],cg);const lg=Array,dg=Object(F["f"])(),hg=Object(xn["c"])(),ug={exclude:new Set([og["b"]])},pg=cg;var fg=i("4d10"),bg=i("4adc"),mg=i("8e17");class gg{constructor(e){this.store=e}destroy(){this.store.destroy()}get(e){return this.store.get(e)}put(e,t){this.store.put(e,t,t.values.byteLength+256)}}var vg=i("d378"),yg=i("66b9"),Og=i("1dc3"),_g=i("deae");class xg{constructor(e=0,t=0){this.min=e,this.max=t,this.level=0,this.hasNoDataValues=!1}copyFrom(e){this.min=e.min,this.max=e.max,this.level=e.level,this.hasNoDataValues=e.hasNoDataValues}}class jg{constructor(e,t,i){this.type="elevation",this.samplerData=null,this.level=e[0],this.i=e[1],this.j=e[2],this.extent=t;const r=i.noDataValue,n=i.values;let a=1/0,s=-1/0,o=!0,c=!1;for(let l=0;l<n.length;l++){const e=n[l];e!==r?(a=e<a?e:a,s=e>s?e:s,o=!1):c=!0}o&&(a=0,s=0),s=s>-3e38?s:0,this.samplerData={pixelData:i.values,width:i.width,height:i.height,noDataValue:r,safeWidth:.99999999*(i.width-1),dx:(i.width-1)/(t[2]-t[0]),dy:(i.width-1)/(t[3]-t[1]),x0:t[0],y1:t[3]},this.bounds=[a,s],this.hasNoDataValues=c}release(){this.samplerData=null,this.bounds=null}computeMinMaxValue(e,t,i,r){r.min=1/0,r.max=-1/0,r.hasNoDataValues=!1;const n=e-this.level;if(n<=0)return r;const a=2**n;if(Math.floor(t/a)!==this.i||Math.floor(i/a)!==this.j)return r;let s=1/0,o=-1/0;const c=this.samplerData.width,l=this.samplerData.pixelData,d=.5*J["b"];let h=(c-1)/a,u=(i-this.j*a)*h,p=(t-this.i*a)*h;if(h<1){const e=Math.floor(u),t=Math.floor(p),i=e+t*c,n=l[i],a=l[i+1],s=l[i+c],o=l[i+c+1];if(n+a+s+o<d){const i=u-e,c=p-t,l=Object(xe["c"])(n,a,s,o,i,c),d=Object(xe["c"])(n,a,s,o,i+h,c),f=Object(xe["c"])(n,a,s,o,i,c+h),b=Object(xe["c"])(n,a,s,o,i+h,c+h);return r.min=Math.min(l,d,f,b),r.max=Math.max(l,d,f,b),r}u=e,p=t,h=1}else u=Math.floor(u),p=Math.floor(p),h=Math.ceil(h);for(let f=u;f<=u+h;f++)for(let e=p;e<=p+h;e++){const t=l[f+e*c];t<d?(s=Math.min(s,t),o=Math.max(o,t)):r.hasNoDataValues=!0}return r.min=s,r.max=o,r}static sample(e,t,i){for(const r of i){if(!r)continue;const i=r.safeWidth,n=r.width,a=r.pixelData;let s=Object(Oe["f"])(r.dy*(r.y1-t),0,i),o=Object(Oe["f"])(r.dx*(e-r.x0),0,i);const c=Math.floor(s),l=Math.floor(o),d=c*n+l,h=d+n,u=a[d],p=a[h],f=a[d+1],b=a[h+1];if(u+p+f+b<.5*J["b"]){s-=c,o-=l;const e=u+(f-u)*o;return e+(p+(b-p)*o-e)*s}}return null}}let wg=class extends W["a"]{constructor(e){super(e),this._handles=new $["a"]}initialize(){this._handles.add([this.layerViews.on("change",()=>this.notifyChange("stencilEnabledExtents"))])}destroy(){this._handles.destroy(),this._handles=null}get layerViewsExtent(){return this._computeLayerViewsExtent()}get tiledLayersExtent(){return this._computeTiledLayersExtent()}get stencilEnabledExtents(){return this._computeStencilEnabledExtents()}_computeStencilEnabledExtents(){const e=[];return this.layerViews.forEach(t=>{const i=t.layer;if("IntegratedMeshLayer"===i.operationalLayerType&&null!=this.viewSpatialReference){const t=Pg(i.fullExtent,this.viewSpatialReference);Object(w["l"])(t)&&e.push(Object(V["t"])(t))}}),e}};function Sg(e,t){return 1===e?new Tg(t):new Cg(t)}Object(h["a"])([Object(M["b"])({readOnly:!0})],wg.prototype,"layerViewsExtent",null),Object(h["a"])([Object(M["b"])({readOnly:!0})],wg.prototype,"tiledLayersExtent",null),Object(h["a"])([Object(M["b"])({readOnly:!0})],wg.prototype,"stencilEnabledExtents",null),Object(h["a"])([Object(M["b"])()],wg.prototype,"viewSpatialReference",void 0),Object(h["a"])([Object(M["b"])()],wg.prototype,"tilingScheme",void 0),Object(h["a"])([Object(M["b"])()],wg.prototype,"defaultTiledLayersExtent",void 0),Object(h["a"])([Object(M["b"])({constructOnly:!0})],wg.prototype,"layers",void 0),Object(h["a"])([Object(M["b"])({constructOnly:!0})],wg.prototype,"layerViews",void 0),wg=Object(h["a"])([Object(D["a"])("esri.views.3d.terrain.ExtentHelper")],wg);let Tg=class extends wg{_computeLayerViewsExtent(){return this._globalExtent}_computeTiledLayersExtent(){return this._globalExtent}get _globalExtent(){return this.viewSpatialReference.isWebMercator?J["k"]:J["c"]}};Tg=Object(h["a"])([Object(D["a"])("esri.views.3d.terrain.ExtentHelperGlobal")],Tg);let Cg=class extends wg{_computeLayerViewsExtent(){const e=Object(V["o"])(),t=this.viewSpatialReference;this.layerViews.forEach(i=>{const r=i.layer;if(i.isResolved()&&("graphics"!==r.type||!r.internal)){const r=Pg("fullExtentInLocalViewSpatialReference"in i&&i.fullExtentInLocalViewSpatialReference||i.layer.fullExtent,t);Object(V["q"])(e,r,e)}});const i=Object(V["c"])(e)?e:null,r=this._get("layerViewsExtent");return Object(V["p"])(i,r)?r:i}_computeTiledLayersExtent(){const e=this.tilingScheme;if(!e)return null;const t=this.viewSpatialReference,i=Object(V["o"])();this.layers.forEach(r=>{if(r.loaded&&Object(G["c"])(r)){const n=Object(xm["d"])(r,t,2);if(Object(w["k"])(n))return;const{tileInfo:a,fullExtent:s}=n;(Object(w["l"])(a)&&Object(xm["h"])(r)&&Object(w["l"])(s)||Object(w["l"])(a)&&e.compatibleWith(a)&&Object(w["l"])(s)&&s.spatialReference.equals(e.spatialReference))&&Object(V["q"])(i,s,i)}}),Object(V["q"])(i,this.defaultTiledLayersExtent,i);const r=Object(V["c"])(i)?i:null,n=this._get("tiledLayersExtent");return Object(V["p"])(r,n)?n:r}};function Pg(e,t){return Object(w["l"])(e)&&!e.spatialReference.equals(t)?Object(L["A"])(e,e.spatialReference,t):e}Cg=Object(h["a"])([Object(D["a"])("esri.views.3d.terrain.ExtentHelperLocal")],Cg);const Ag=[0,1],Mg=25,Rg=Object(On["a"])(1e3/Mg),Eg=20,Dg=Object(On["a"])(1e3/Eg);var Ig=i("4294"),Fg=i("7585"),zg=i("7abc");function Lg(){var e;const t=null==(e=globalThis.require)?void 0:e.modules;if(t){const e=Object.keys(t);for(const i of e)-1!==i.search(".glsl")&&delete t[i]}}const Vg=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]];let kg,Ug=class extends W["a"]{constructor(e){super(e),this._handles=new $["a"],this._spatialReference=null,this._renderSR=null,this._overlaySREqualsRenderSR=!0,this._drapeSources=new Map,this._drapeTargets=new Set,this._placementDirty=!1,this._contentUpdated=!1,this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1,this._layerViewsDirty=!0,this._hasUnusedRenderTargets=!1,this._longitudeCyclical=null,this._latestOriginId=0,this._maxResolution=Object(_["a"])("esri-mobile")?2048:4096,this._animationTimeLast=0}get running(){return(this._placementDirty||this._layerViewsDirty)&&(this._drapeSources.size>0||this.view.graphics.length>0||Lh["a"].OVERLAY_DRAW_DEBUG_TEXTURE)&&!!this._spatialReference&&!this.suspended&&this.surface.ready}get _isSpherical(){return this.view.state.isGlobal}get _worldToPCSRatio(){return Object(w["l"])(this._spatialReference)&&this._spatialReference.isGeographic&&!this.view.state.isLocal?Object(zt["e"])(this._spatialReference).metersPerDegree:1}get view(){return this.surface.view}get updating(){return this.running||this.renderer.updating||this._contentUpdated}get hasHighlights(){return this.renderer.hasHighlights}get rendersOccluded(){return this.renderer.rendersOccluded}initialize(){const e=this.view;this.renderer=new Fg["b"]({view:e,worldToPCSRatio:this._worldToPCSRatio,spatialReference:this._spatialReference}),this._groundIntersector=Object(Xn["b"])(this.view.state.viewingMode),this._groundIntersector.options.backfacesTerrain=!0,this._groundIntersector.options.invisibleTerrain=!0,this._groundIntersector.options.hud=!1,this._handles.add([this.renderer.events.on("has-highlights",()=>{this._setDrawTexturesDirty(),this.notifyChange("hasHighlights")}),this.renderer.events.on("has-water",t=>{var i;return null==(i=e._stage)?void 0:i.renderView.setRenderParameters({hasOverlayWater:t})}),this.renderer.events.on("renders-occluded",()=>{this._setDrawTexturesDirty(),this.notifyChange("rendersOccluded")}),this.renderer.events.on("content-changed",()=>this._setDrawTexturesDirty()),this.renderer.events.on("textures-disposed",()=>this.updateDrapeTargets()),e.watch(["pointsOfInterest.renderPointOfView","pointsOfInterest.centerOnSurfaceFrequent.location","pixelRatio"],()=>this.setPlacementDirty()),this.surface.on("elevation-change",()=>this.setPlacementDirty()),e.allLayerViews.on("after-changes",()=>this._layerViewsDirty=!0),e.watch("graphicsView",()=>this._layerViewsDirty=!0),e.on("resize",()=>this.setPlacementDirty()),Object(T["a"])({preRender:e=>{this._contentUpdated=!1,this.renderer.processSyncLayers(),this._updateLayerViews(),this.renderer.hasOverlays&&(this._dispatchRendererUpdate(e),this._drawOverlayTextures(this.renderer.overlays,1)),this._hasUnusedRenderTargets&&this._collectUnusedRenderTargetMemory()}}),e.resourceController.scheduler.registerTask(Fi["b"].OVERLAY,this),e._stage.renderView.events.on("force-camera-for-screenshot",e=>{this._updateOverlays(e,0),this.renderer.hasOverlays&&this._drawOverlayTextures(this.renderer.overlays,0,e)})]),this._updateLayerViews()}destroy(){this._drapeSources.forEach((e,t)=>this.unregisterDrapeSource(t)),this._drapeTargets.forEach(e=>this._unregisterDrapeTarget(e)),this.renderer.dispose(),this._handles&&(this._handles.destroy(),this._handles=null),Object(w["l"])(kg)&&(kg.hide(),kg=null)}get hasOverlays(){return this.renderer.hasOverlays}setSpatialReference(e){this._spatialReference=e,this.renderer.spatialReference=e,this._longitudeCyclical=null;const t=this.view.renderSpatialReference;Object(w["l"])(e)&&Object(w["l"])(t)?(this._renderSR=t,this._overlaySREqualsRenderSR=e.equals(this._renderSR),this._isSpherical&&(this._longitudeCyclical=e.isWebMercator?new xe["a"](-20037508.342787,20037508.342787):new xe["a"](-180,180),this.renderer.longitudeCyclical=this._longitudeCyclical),this.renderer&&(this.renderer.worldToPCSRatio=this._worldToPCSRatio)):this.renderer.disposeOverlays()}get gpuMemoryUsage(){return this.renderer.gpuMemoryUsage}_updateLayerViews(){if(!this._layerViewsDirty)return;const e=new Set;for(const i of this.view.allLayerViews.items)e.add(i.uid),"drapeSourceType"in i&&!this._drapeSources.has(i)&&this._registerDrapeSource(i,0),"drapeTargetType"in i&&!this._drapeTargets.has(i)&&this._registerDrapeTarget(i);const t=this.view.graphicsView;Object(w["l"])(t)&&!this._drapeSources.has(t)&&(this._registerDrapeSource(t,0),e.add(t.uid)),this._drapeSources.forEach((t,i)=>{0!==t||e.has(i.uid)||this.unregisterDrapeSource(i)}),this._drapeTargets.forEach(t=>{e.has(t.uid)||this._unregisterDrapeTarget(t)}),this.renderer.updateLayerOrder(),this._setDrawTexturesDirty(),this._layerViewsDirty=!1}registerDrapeSource(e){this._registerDrapeSource(e,1)}_registerDrapeSource(e,t){this._drapeSources.set(e,t),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources),this._updateDrapeSourceExtent(e),this._setContentDirty(),this.notifyChange("running")}_updateDrapeSourceExtent(e){2===this.renderer.overlays.length&&Object(w["l"])(e.setDrapingExtent)&&Object(w["l"])(this._spatialReference)&&e.setDrapingExtent(this.renderer.overlays,this._spatialReference)}unregisterDrapeSource(e){this._drapeSources.has(e)&&(this._drapeSources.delete(e),this.renderer.ensureDrapeSources(this._drapeSources),this._setContentDirty(),this.notifyChange("running"))}_registerDrapeTarget(e){this._drapeTargets.add(e),this._updateDrapeTarget(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources)}updateDrapeTargets(){this._drapeTargets.forEach(e=>this._updateDrapeTarget(e))}_updateDrapeTarget(e){e.setDrapingTextures(this.renderer.overlays)}_unregisterDrapeTarget(e){this._drapeTargets.delete(e),this.renderer.ensureDrapeTargets(this._drapeTargets)}_setContentDirty(){this.setPlacementDirty(),this._setDrawTexturesDirty()}setPlacementDirty(){this._placementDirty=!0}runTask(){this._updateOverlays(this.view.state.camera,1)}_updateOverlays(e,t){if(!this._spatialReference)return;this._updateLayerViews();const i=Object(Ig["b"])(e.fullWidth,e.fullHeight,this._maxResolution);this._computeOverlayExtents(e,i,qg);const r=Object(V["C"])(qg.inner)/Object(V["C"])(qg.outer);this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const n=this._updateOverlay(0,qg.inner,i,1*qg.pixelRatioAdjustment,qg.mapUnitsPerPixel),a=this._updateOverlay(1,qg.outer,i,r*qg.pixelRatioAdjustment,qg.mapUnitsPerPixel);1!==n&&1!==a||(this._drapeSources.forEach((e,t)=>this._updateDrapeSourceExtent(t)),this.surface.updateTileOverlayParams(t)),0===n&&0===a||this._setDrawTexturesDirty(),this._placementDirty=!1}_updateOverlay(e,t,i,r,n){if(0===this.renderer.overlays.length)return 0;const a=this.renderer.overlays[e],s=a.mapUnitsPerPixel;if(a.mapUnitsPerPixel=n,a.pixelRatio=r,Bg(t,a.extent)&&i===a.resolution)return s===n?0:2;Object(V["l"])(a.extent,t),a.resolution=i;const o=Object(V["e"])(a.extent);return a.renderLocalOrigin=Object(zg["a"])(o[0],o[1],0,"OV_"+this._latestOriginId++),1}setTileParameters(e){const t=e.renderData.overlay;if(this.renderer.overlays.length>0){const i=this.renderer.overlays[0],r=this.renderer.overlays[1],n=Object(V["w"])(e.extent,this.surface.extent,Hg);this._rectInsideRect(i.extent,n)||this._rectanglesOverlap(n,i.extent)||this._rectanglesOverlap(n,r.extent)?(this._setTileOverlayData(n,0,t),this._setTileOverlayData(n,1,t)):(this._clearTileOverlayData(0,t),this._clearTileOverlayData(1,t))}else this._clearTileOverlayData(0,t),this._clearTileOverlayData(1,t)}overlayPixelSizeInMapUnits(e){if(0===this.renderer.overlays.length)return 0;const t=this.renderer.overlays[0],i=this.renderer.overlays[1],r=this._pointIsInExtent(e,t.extent)?t:i;return(r.extent[2]-r.extent[0])/r.resolution}_setTileOverlayData(e,t,i){if(0===this.renderer.overlays.length)return;const r=this.renderer.overlays[t].extent,n=Object(V["C"])(r),a=Object(V["v"])(r);let s=e[0];if(this._longitudeCyclical){s=this._longitudeCyclical.minimalMonotonic(r[0],s);const t=this._longitudeCyclical.minimalMonotonic(r[0],e[2]);s>t&&(s=t-(e[2]-e[0]))}i.setScale(t,Object(V["C"])(e)/n,Object(V["v"])(e)/a),i.setOffset(t,(s-r[0])/n,(e[1]-r[1])/a)}_clearTileOverlayData(e,t){t.setScale(e,-1,-1),t.setOffset(e,-1,-1)}async reloadShaders(){Lg(),await this.renderer.reloadShaders(),this._setDrawTexturesDirty(),this.runTask()}_dispatchRendererUpdate(e){const t=Object(On["a"])(e.time-this._animationTimeLast);t<Dg&&Object(w["k"])(this.forcedAnimationTime)||(this._animationTimeLast=e.time,this.renderer.updateLogic({dt:t,forcedTime:this.forcedAnimationTime,camera:this.view.state.camera})&&(this._drawTexturesAnimateDirty=!0))}_setDrawTexturesDirty(){this.renderer.hasOverlays?(this._contentUpdated=!0,this._drawTexturesDirty=!0):this.setPlacementDirty()}_intersectGroundFromView(e,t,i,r){const n=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(e,$g,t,i);if(Object(w["k"])(n))return!1;const a=n.origin,s=Object(Et["i"])(Gg,n.origin,n.direction);return this._groundIntersector.reset(a,s,e),this._groundIntersector.intersect([],null),this.view.basemapTerrain.intersect(this._groundIntersector,null,a,s),this._groundIntersector.results.min.getIntersectionPoint(r)}_findHorizonBasedPointOfInterest(e,t){let i=.5;const r=.55,n=this.view.renderCoordsHelper.getAltitude(e.eye),a=this.view.pointsOfInterest.centerOnSurfaceFrequent,s=1e-5,o=Object(Oe["f"])(a.estimatedSurfaceAltitude,e.aboveGround?-1/0:n+s,e.aboveGround?n-s:1/0),c=e.aboveGround;if("global"===this.view.viewingMode){const t=Gg;Object(_n["h"])(Object(_n["j"])(Object(zt["e"])(this.view.spatialReference).radius+o),Object(xn["h"])(e.eye,e.viewForward),t),Object(Et["m"])(t,t,e.eye);const n=xe["f"].normalize(Object(li["b"])(e.viewForward,t,e.viewRight))/e.fovY+.5,a=n<=0||n>=1?.5:r;i=c?a*n:n+a*(1-n)}else{const t=.5*Math.PI-Math.acos(-e.viewForward[2]),n=Math.tan(t),a=Object(Dt["g"])(0,n,1,0),s=Object(zh["m"])(a,a,e.projectionMatrix)[1],o=Object(Oe["f"])(.5+.5*s,0,1);i=1===o||0===o?.5:c?o*r:1-(1-o)*r}return!!this._intersectGroundFromView(e,.5,i,t)&&Object(Et["E"])(t,e.eye)<a.distance*a.distance}_computeOverlayExtents(e,t,i){const r=this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,n=Object(F["f"])();this._findHorizonBasedPointOfInterest(e,n)||Object(Et["n"])(n,r);const a=Math.max(.1,Object(Et["p"])(e.eye,n)),s=ua(this.view.renderCoordsHelper,r,e.eye),o=Math.PI/2-Math.abs(s-Math.PI/2);Lh["a"].OVERLAY_SHOW_CENTER?(Object(w["k"])(kg)&&(kg=new Im(this.view.graphics,"red")),kg.show(n,this._renderSR)):Object(w["l"])(kg)&&kg.hide(),this._overlaySREqualsRenderSR||Object(L["y"])(n,this._renderSR,n,this._spatialReference);const c=this.surface.extent,l=!this._isSpherical&&Object(w["l"])(this._spatialReference)&&this._spatialReference.isGeographic,d=l&&Object(w["l"])(this._spatialReference)?1/Object(zt["e"])(this._spatialReference).metersPerDegree:1,h=e.perRenderPixelRatio*a*d;i.mapUnitsPerPixel=h/this._worldToPCSRatio;let u=t*h/2,p=!1,f=l?90:1/0;this._isSpherical&&Object(w["l"])(c)&&Object(w["l"])(this._spatialReference)&&(this._spatialReference.isWebMercator?(u/=Math.cos(Object(X["h"])(n[1])),f=c[3]):(p=!0,u/=Object(zt["e"])(this._spatialReference).metersPerDegree,f=90),u>=f&&(u=f,n[1]=0,this._spatialReference.isWebMercator&&(n[0]=0)));let b=1;p&&(b=1/Math.max(.2,Math.cos(Math.abs(Object(Oe["h"])(n[1])))),u*b>180&&(b=180/u),i.mapUnitsPerPixel*=b);const m=Math.log(2)/12;u=Math.exp(Math.round(Math.log(u)/m)*m);const g=u*b,v=32,y=.5*t/(v*g),O=.5*t/(v*u);n[0]=Math.round(n[0]*y)/y,n[1]=Math.round(n[1]*O)/O;const _=i.inner;_[0]=n[0]-g,_[1]=n[1]-u,_[2]=n[0]+g,_[3]=n[1]+u,this._isSpherical&&this._shiftExtentToFitBounds(_,1/0,f);const x=i.outer;if(6*g>Object(V["C"])(c))Object(V["l"])(x,Object(w["u"])(c));else if(o<=.25*Math.PI)x[0]=_[0]-g,x[1]=_[1]-u,x[2]=_[2]+g,x[3]=_[3]+u;else{Object(L["y"])(e.eye,this._renderSR,Gg,this._spatialReference),Object(kt["f"])(Ng,n,Gg);let t=-Math.atan2(Ng[1],Ng[0])+.125*Math.PI;t<0&&(t+=2*Math.PI);const i=Math.floor(t/(.25*Math.PI));Object(zh["b"])(Ng,Vg[i],2*u),Ng[0]*=b,Ng[2]*=b,Object(zh["a"])(x,_,Ng)}if(this._isSpherical)x[0]=this._longitudeCyclical.clamp(x[0]),x[2]=this._longitudeCyclical.clamp(x[2]),x[1]=Math.max(x[1],-f),x[3]=Math.min(x[3],f);else{const e=Object(V["w"])(_,c,Hg),t=Object(V["w"])(x,c,Wg);Object(V["g"])(e,t)&&(x[2]=x[0],x[3]=x[1])}const j=Math.abs(_[2]-_[0])/t;i.mapUnitsPerPixel=Math.max(i.mapUnitsPerPixel,j),i.pixelRatioAdjustment=i.mapUnitsPerPixel/j}_drawOverlayTextures(e,t,i=this.view.state.camera){if(0===e.length||!this._drawTexturesDirty&&!this._drawTexturesAnimateDirty)return;const r=this._drawTexturesDirty;this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1;const n=this._drawOverlay(e[0],i),a=this._drawOverlay(e[1],i);0!==n&&0!==a||this.surface.updateTileOverlayParams(1),this._collectUnusedRenderTargetMemory(),this.updateDrapeTargets(),r?(this.surface.requestRender(t),1===t&&this.surface.requestUpdate()):this.surface.requestRender(0)}_drawOverlay(e,t){return this._longitudeCyclical?e.setupGeometryViewsCyclical(this._longitudeCyclical):e.setupGeometryViewsDirect(),e.draw(this.renderer,t.pixelRatio)}_collectUnusedRenderTargetMemory(){if(this._hasUnusedRenderTargets=!1,this.renderer.hasOverlays){const e=performance.now();this._hasUnusedRenderTargets=this.renderer.collectUnusedRenderTargetMemory(e)}}_rectanglesOverlap(e,t){return!Object(w["k"])(e)&&(this._longitudeCyclical?(this._longitudeCyclical.contains(t[0],t[2],e[0])||this._longitudeCyclical.contains(t[0],t[2],e[2])||this._longitudeCyclical.contains(e[0],e[2],t[0]))&&!(e[1]>t[3]||e[3]<t[1]):Object(V["x"])(e,t))}_rectInsideRect(e,t){return!Object(w["k"])(t)&&(this._longitudeCyclical?this._longitudeCyclical.contains(e[0],e[2],t[0])&&this._longitudeCyclical.contains(e[0],e[2],t[2])&&t[1]>e[1]&&t[3]<e[3]:Object(V["g"])(e,t))}_pointIsInExtent(e,t){if(this._longitudeCyclical)return this._longitudeCyclical.contains(t[0],t[2],e.x)&&e.y>=t[1]&&e.y<=t[3];const i=e.x,r=e.y;return i>t[0]&&i<t[2]&&r>t[1]&&r<t[3]}_shiftExtentToFitBounds(e,t,i){let r=0,n=0;e[0]<-t?r=e[0]+t:e[2]>t&&(r=t-e[2]),e[1]<-i?n=e[1]+i:e[3]>i&&(n=i-e[3]),Object(V["A"])(e,r,n)}get test(){return{renderer:this.renderer,update:()=>this.runTask()}}};function Bg(e,t){const i=1e-5,r=Lh["a"].TESTS_DISABLE_OPTIMIZATIONS?0:i*Math.max(e[2]-e[0],e[3]-e[1],t[2]-t[0],t[3]-t[1]);return Math.abs(t[0]-e[0])<=r&&Math.abs(t[1]-e[1])<=r&&Math.abs(t[2]-e[2])<=r&&Math.abs(t[3]-e[3])<=r}Object(h["a"])([Object(M["b"])()],Ug.prototype,"_spatialReference",void 0),Object(h["a"])([Object(M["b"])({readOnly:!0})],Ug.prototype,"running",null),Object(h["a"])([Object(M["b"])()],Ug.prototype,"_placementDirty",void 0),Object(h["a"])([Object(M["b"])()],Ug.prototype,"_contentUpdated",void 0),Object(h["a"])([Object(M["b"])()],Ug.prototype,"_layerViewsDirty",void 0),Object(h["a"])([Object(M["b"])()],Ug.prototype,"_isSpherical",null),Object(h["a"])([Object(M["b"])()],Ug.prototype,"_worldToPCSRatio",null),Object(h["a"])([Object(M["b"])()],Ug.prototype,"renderer",void 0),Object(h["a"])([Object(M["b"])({constructOnly:!0})],Ug.prototype,"surface",void 0),Object(h["a"])([Object(M["b"])({readOnly:!0,aliasOf:"surface.suspended"})],Ug.prototype,"suspended",void 0),Object(h["a"])([Object(M["b"])({readOnly:!0})],Ug.prototype,"updating",null),Object(h["a"])([Object(M["b"])({type:Boolean})],Ug.prototype,"hasHighlights",null),Object(h["a"])([Object(M["b"])({type:Boolean})],Ug.prototype,"rendersOccluded",null),Ug=Object(h["a"])([Object(D["a"])("esri.views.3d.terrain.OverlayManager")],Ug);const Ng=Object(Dt["e"])(),Gg=Object(F["f"])(),qg={inner:Object(V["m"])(),outer:Object(V["m"])(),mapUnitsPerPixel:0,pixelRatioAdjustment:1},Hg=Object(V["m"])(),Wg=Object(V["m"])(),$g=Object(xn["c"])();class Zg{constructor(e,t){this._factoryCallback=e,this._lengthCallback=t,this._pool=new Map}acquire(e){if(!Zg.test.disabled){const t=this._pool.get(e);if(t&&0!==t.length)return t.pop()}try{return this._factoryCallback(e)}catch(t){const i=window.performance&&window.performance.memory;let r="";throw i&&(r=`\n  totalJSHeapSize: ${i.totalJSHeapSize}, usedJSHeapSize: ${i.usedJSHeapSize}, jsHeapSizeLimit: ${i.jsHeapSizeLimit}`),console.log("Array allocation of size "+e+" failed: "+t+r),t}}release(e){if(Zg.test.disabled)return;const t=this._lengthCallback(e);let i=this._pool.get(t);i||(i=new Fh["a"]({shrink:!0}),this._pool.set(t,i)),i.push(e)}clear(){this._pool.clear()}get test(){return{size:this._pool.size}}}Zg.test={disabled:!1};var Qg=i("7c51");const Xg=Object(Ki["a"])().vec3f("position").vec2f("uv0"),Yg=new Zg(e=>Xg.createBuffer(e),e=>e.count);class Kg{constructor(){this.indices=null,this.vertexAttributes=null,this.boundingBox=Object(Fu["k"])(),this.numSurfaceIndices=0,this.numSkirtIndices=0,this.numWithoutSkirtIndices=0,this.numVertsPerRow=0,this.skirtLength=0,this.uvOffsetAndScale=Object(Dt["e"])()}}class Jg{constructor(e,t,i){this.values=e,this.numSurfaceIndices=t,this.numSkirtIndices=i}}function ev(){Yg.clear(),av.clear()}function tv(e){Yg.release(e.vertexAttributes),e.vertexAttributes=null,e.indices=null}const iv=65536;function rv(e,t,i,r,n,a,s,o){const c=n[0],l=n[1],d=n[2],h=n[3],u=.1*s.radius*(h-l),p=e.numVertsPerRow-1,f=e.numVertsPerRow-1,b=e.numVertsPerRow*e.numVertsPerRow,m=2*p+2*f,g=Yg.acquire(b+m),v=g.position.typedBuffer,y=g.uv0.typedBuffer,O=r.geometryInfo.boundingBox;Object(Fu["k"])(O);const _=t[2]-t[0],x=t[3]-t[1],j=d-c,w=i[0],S=i[1],T=i[2];for(let M=0;M<=p;M++){const e=M/p,i=c+e*j;bv[M]=Math.sin(i),mv[M]=Math.cos(i),gv[M]=e,vv[M]=t[0]+e*_}const C=a&&!!(1&o),P=a&&!!(2&o);let A=0;for(let M=0;M<=f;M++){let i=M/f;const r=Object(Oe["l"])(l,h,i),n=Math.cos(r),o=Math.sin(r);let c;a?(c=s.halfSemiMajorAxis*Math.log((1+o)/(1-o)),i=(c-t[1])/x):c=180*r/Math.PI;for(let t=0;t<=p;t++){const r=gv[t],a=bv[t],l=mv[t];let d=s.radius;e.samplerData&&(d+=jg.sample(vv[t],c,e.samplerData)||0);const h=l*n*d-w,m=a*n*d-S,g=o*d-T;cv(h,m,g,O);const _=J["d"]*A;v[_+0]=h,v[_+1]=m,v[_+2]=g,y[_+0]=r,y[_+1]=i;const x=dv(t,M,p,f);if(x>-1){const e=J["d"]*(b+x),t=C&&0===M?-1:P&&M===f?1:0,n=0===t?h:-w,a=0===t?m:-S,o=0===t?g:s.radius*t-T;v[e+0]=n,v[e+1]=a,v[e+2]=o,y[e+0]=0===t?lv(r,i):r,y[e+1]=0===t?u:i,0!==t&&cv(n,a,o,O)}++A}}r.geometryInfo.numVertsPerRow=e.numVertsPerRow,r.geometryInfo.vertexAttributes=g,r.geometryInfo.skirtLength=u,Object(zh["l"])(r.geometryInfo.uvOffsetAndScale,0,0,1,1),sv(r.geometryInfo,e.numVertsPerRow,a?o:0,e.wireframe),r.intersectionData=null,r.skirtIntersectionData=null}function nv(e,t,i,r,n){const a=t[0],s=t[1],o=t[2]-a,c=t[3]-s,l=e.clippingArea,d=Object(w["l"])(l)?Math.max(0,(l[0]-t[0])/o):0,h=Object(w["l"])(l)?Math.max(0,(l[1]-t[1])/c):0,u=Object(w["l"])(l)?Math.min(1,(l[2]-t[0])/o):1,p=Object(w["l"])(l)?Math.min(1,(l[3]-t[1])/c):1,f=u>d?1/(u-d):1,b=p>h?1/(p-h):1,m=-d*f,g=-h*b,v=o*r*.1,y=e.numVertsPerRow-1,O=e.numVertsPerRow-1,_=e.numVertsPerRow*e.numVertsPerRow,x=2*y+2*O,j=Yg.acquire(_+x),S=j.position.typedBuffer,T=j.uv0.typedBuffer,C=n.geometryInfo.boundingBox;Object(Fu["k"])(C);let P=0;for(let A=0;A<=O;A++){const t=A/O;let n=g+t*b,d=s+t*c;Object(w["l"])(l)&&(d<l[1]?(d=l[1],n=0):d>l[3]&&(d=l[3],n=1));for(let s=0;s<=y;s++){const t=s/y;let c=m+t*f,h=a+t*o;Object(w["l"])(l)&&(h<l[0]?(h=l[0],c=0):h>l[2]&&(h=l[2],c=1));const u=e.samplerData&&jg.sample(h,d,e.samplerData)||0,p=h*r-i[0],b=d*r-i[1],g=u-i[2];cv(p,b,g,C);const O=J["d"]*P;S[O+0]=p,S[O+1]=b,S[O+2]=g,T[O+0]=c,T[O+1]=n;const x=dv(s,A,y,y);if(x>-1){const e=J["d"]*(_+x);S[e+0]=p,S[e+1]=b,S[e+2]=g,T[e+0]=lv(c,n),T[e+1]=v}++P}}n.geometryInfo.numVertsPerRow=e.numVertsPerRow,n.geometryInfo.vertexAttributes=j,n.geometryInfo.skirtLength=v,Object(zh["l"])(n.geometryInfo.uvOffsetAndScale,d,h,u-d,p-h),sv(n.geometryInfo,e.numVertsPerRow,0,e.wireframe),n.intersectionData=null,n.skirtIntersectionData=null}const av=new Map;function sv(e,t,i,r){const n=(2&i)>0,a=t+(r?1024:0)+(n?2048:0);let s=av.get(a);s||(s=ov(t,n,r),av.set(a,s)),e.indices=s.values,e.numSurfaceIndices=s.numSurfaceIndices,e.numSkirtIndices=s.numSkirtIndices,e.numWithoutSkirtIndices=e.numSurfaceIndices+(i?6*(t-1)*(r?2:1):0)}function ov(e,t,i){const r=e-1,n=e-1,a=e*e,s=2*r+2*n;let o=r*n*2*3,c=6*s,l=6*(2*r+n-1);i&&(o*=2,c*=2,l*=2);const d=a+s>iv?new Uint32Array(o+c):new Uint16Array(o+c);let h,u,p,f,b=0,m=0,g=o,v=0;for(let y=0;y<=n;y++){t&&(v=0===y?l:y===n?-l:0),g+=v;for(let e=0;e<=r;e++){const t=dv(e,y,r,n);if(t>-1){const s=hv(e,y,r,n);0!==s&&(h=b,u=a+t,p=a+(0===e&&1===y?0:t+1),f=b+s,i?(d[g+0]=h,d[g+1]=u,d[g+2]=u,d[g+3]=p,d[g+4]=p,d[g+5]=h,d[g+6]=p,d[g+7]=f,d[g+8]=f,d[g+9]=h,d[g+10]=h,d[g+11]=p,g+=12):(d[g+0]=h,d[g+1]=u,d[g+2]=p,d[g+3]=p,d[g+4]=f,d[g+5]=h,g+=6))}++b,e<r&&y<n&&(h=y*(r+1)+e,u=h+1,p=u+(r+1),f=p-1,i?(d[m+0]=h,d[m+1]=u,d[m+2]=u,d[m+3]=p,d[m+4]=p,d[m+5]=h,d[m+6]=p,d[m+7]=f,d[m+8]=f,d[m+9]=h,d[m+10]=h,d[m+11]=p,m+=12):(d[m+0]=h,d[m+1]=u,d[m+2]=p,d[m+3]=p,d[m+4]=f,d[m+5]=h,m+=6))}g-=v}return new Jg(d,o,c)}function cv(e,t,i,r){e<r[0]&&(r[0]=e),e>r[3]&&(r[3]=e),t<r[1]&&(r[1]=t),t>r[4]&&(r[4]=t),i<r[2]&&(r[2]=i),i>r[5]&&(r[5]=i)}function lv(e,t){const i=t>e?1:0;return 2+4*i+(1-2*i)*(e+t)}function dv(e,t,i,r){return 0===t?e:e===i?i+t:t===r?i+r+(i-e):0===e&&t>0?2*i+r+(r-t):-1}function hv(e,t,i,r){return 0===t&&e!==i?1:e===i&&t!==r?i+1:t===r&&0!==e?-1:0===e&&0!==t?-(i+1):0}function uv(e,t,i,r,n,a,s,o,c,l){const d=a.position,h=a.uv0,u=e[0],p=e[1],f=e[2],b=t[0]-u,m=t[1]-p,g=t[2]-f;r*=3;for(let v=i*=3;v<r;v+=3){const e=n[v],t=n[v+1],i=n[v+2];let r=d.get(e,0),a=d.get(e,1),y=d.get(e,2),O=d.get(t,0),_=d.get(t,1),x=d.get(t,2),j=d.get(i,0),S=d.get(i,1),T=d.get(i,2);if(h.get(e,0)>=2){const e=r+o[0],t=a+o[1],i=y+o[2],n=s/Math.sqrt(e*e+t*t+i*i);r+=e*n,a+=t*n,y+=i*n}if(h.get(t,0)>=2){const e=O+o[0],t=_+o[1],i=x+o[2],r=s/Math.sqrt(e*e+t*t+i*i);O+=e*r,_+=t*r,x+=i*r}if(h.get(i,0)>=2){const e=j+o[0],t=S+o[1],i=T+o[2],r=s/Math.sqrt(e*e+t*t+i*i);j+=e*r,S+=t*r,T+=i*r}Object(w["l"])(c)&&([r,a,y]=c.applyToVertex(r,a,y),[O,_,x]=c.applyToVertex(O,_,x),[j,S,T]=c.applyToVertex(j,S,T));const C=O-r,P=_-a,A=x-y,M=j-r,R=S-a,E=T-y,D=m*E-R*g,I=g*M-E*b,F=b*R-M*m,z=C*D+P*I+A*F;if(Math.abs(z)<=Number.EPSILON)continue;const L=u-r,V=p-a,k=f-y,U=L*D+V*I+k*F;if(z>0){if(U<0||U>z)continue}else if(U>0||U<z)continue;const B=V*A-P*k,N=k*C-A*L,G=L*P-C*V,q=b*B+m*N+g*G;if(z>0){if(q<0||U+q>z)continue}else if(q>0||U+q<z)continue;const H=(M*B+R*N+E*G)/z;H>=0&&l(H,Object(Qg["d"])(C,P,A,M,R,E,yv))}}function pv(e,t,i,r,n,a){const s=r.position,o=r.uv0,c=new Map,l=3*t,d=3*i-l,h=new Uint32Array(d);let u=0;for(let f=0;f<d;++f){const t=e[f+l];if(c.has(t))h[f]=c.get(t);else{const e=u++;c.set(t,e),h[f]=e}}const p=new Float64Array(3*u);return c.forEach((e,t)=>{let i=s.get(t,0),r=s.get(t,1),c=s.get(t,2);if(o.get(t,0)>=2){const e=i+a[0],t=r+a[1],s=c+a[2],o=n/Math.sqrt(e*e+t*t+s*s);i+=e*o,r+=t*o,c+=s*o}p[3*e+0]=i,p[3*e+1]=r,p[3*e+2]=c}),{vertices:p,indices:h}}function fv(e,t,i,r,n,a,s,o,c){const l=a.position,d=a.uv0,h=e[0],u=e[1],p=e[2],f=t[0]-h,b=t[1]-u,m=t[2]-p;r*=3;for(let g=i*=3;g<r;g+=3){const e=n[g],t=n[g+1],i=n[g+2];let r=l.get(e,0),a=l.get(e,1),v=l.get(e,2),y=l.get(t,0),O=l.get(t,1),_=l.get(t,2),x=l.get(i,0),j=l.get(i,1),S=l.get(i,2);d.get(e,0)>=2&&(v+=s),d.get(t,0)>=2&&(_+=s),d.get(i,0)>=2&&(S+=s),Object(w["l"])(o)&&([r,a,v]=o.applyToVertex(r,a,v),[y,O,_]=o.applyToVertex(y,O,_),[x,j,S]=o.applyToVertex(x,j,S));const T=y-r,C=O-a,P=_-v,A=x-r,M=j-a,R=S-v,E=b*R-M*m,D=m*A-R*f,I=f*M-A*b,F=T*E+C*D+P*I;if(Math.abs(F)<=Number.EPSILON)continue;const z=h-r,L=u-a,V=p-v,k=z*E+L*D+V*I;if(F>0){if(k<0||k>F)continue}else if(k>0||k<F)continue;const U=L*P-C*V,B=V*T-P*z,N=z*C-T*L,G=f*U+b*B+m*N;if(F>0){if(G<0||k+G>F)continue}else if(G>0||k+G<F)continue;const q=(A*U+M*B+R*N)/F;q>=0&&c(q,Object(Qg["d"])(T,C,P,A,M,R,yv))}}const bv=new Array(J["f"]+1),mv=new Array(J["f"]+1),gv=new Array(J["f"]+1),vv=new Array(J["f"]+1),yv=Object(F["f"])();var Ov=i("a03d");class _v{get updating(){return!!this._tileRequested}init(e,t,i,r){this.tile=e,this._layerIdx=t,this._layerClass=i,this._suspended=r,this._tileLayerInfo=e.getLayerInfo(t,i),this._tileRequested=null;const n=this._findAncestorWithData();this._setUpsampleTile(n)}startLoading(){return this._requestNext()}dispose(){this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null),this.tile=null,this._tileLayerInfo=null}setSuspension(e){e!==this._suspended&&(this._suspended=e,e?this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null):this._tileLayerInfo.data||this.update())}update(){const e=this._findAncestorWithData();return this._setUpsampleTile(e),this._requestNext()}dataArrived(e){this._setUpsampleTile(e),this._tileRequested=null,e===this.tile?this.tile.updateRenderData(this._layerClass,0):this._requestNext()}dataMissing(){this._tileRequested=null,this._tileLayerInfo.data=null,this._requestNext()}_agentDone(){this.tile.agentDone(this._layerIdx,this._layerClass),this.dispose()}_requestNext(){if(this._suspended)return!0;const e=this._findNextDownload();if(this._tileRequested){if(e===this._tileRequested)return!0;this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null}return Object(w["l"])(e)?e.requestLayerData(this._layerIdx,this._layerClass,this)&&(this._tileRequested=e):this._agentDone(),!!this._tileRequested}_findNextDownload(){const e=this._layerIdx,t=this._layerClass,i=this.tile.surface.layerViewByIndex(e,t),r=Object(xm["c"])(i),{minLevel:n,maxLevel:a}=i.dataLevelRange,s=this._desiredMinLevelDelta,o=this._progressiveLevelModulo+s,c=this._scaleRangeEnabled?Ov["e"]:()=>!0;let l=this.tile;const d=l.level;let h;const u=this._tileLayerInfo.upsampleInfo,p=u?u.tile.level:-1,f=Object(w["j"])(r,"tilemapCache");for(;l&&c(l,r,!1)&&l.level>=n;){const i=l.level,r=d-i,c=l.layerInfo[t][e];if(c.data&&r>=s){i>p&&this._setUpsampleTile(l),c.dataInvalidated&&(h=l);break}if((Object(w["k"])(f)||"unavailable"!==f.getAvailability(l.lij[0],l.lij[1],l.lij[2]))&&i<=a&&!c.data&&!c.dataMissing&&((Object(w["k"])(h)||l.level===n||i%J["h"]==0||d-h.level<s)&&(h=l),r>=o))break;l=l.parent}return Object(w["l"])(h)&&d-h.level<s&&this._tileLayerInfo.upsampleInfo&&(h=null),h}_findAncestorWithData(){const e=this.tile.vlevel,t=this._desiredMinLevelDelta;let i;for(let r=this.tile;r;r=r.parent)if(r.hasLayerData(this._layerIdx,this._layerClass)){if(e-r.level>=t)return r;i=r}return i}_setUpsampleTile(e){this._tileLayerInfo.setUpsampleInfo(this.tile,e),this.tile.updateRenderData(this._layerClass,0)}get test(){return{findNextDownload:()=>this._findNextDownload(),tileLayerInfo:this._tileLayerInfo}}}class xv extends _v{get _desiredMinLevelDelta(){throw jv}get _progressiveLevelModulo(){throw jv}dispose(){}}const jv=new Error("Abstract method called on TileAgent"),wv=new xv;class Sv extends _v{constructor(){super(...arguments),this._scaleRangeEnabled=!1}get _desiredMinLevelDelta(){return Object(J["l"])(this.tile.level)-(this.tile.vlevel-this.tile.level)}get _progressiveLevelModulo(){return 0}}class Tv extends _v{constructor(){super(),this._scaleRangeEnabled=!0}get _desiredMinLevelDelta(){return 0}get _progressiveLevelModulo(){return J["h"]}}var Cv=i("d4de");class Pv{constructor(){this.waitingAgents=new Fh["a"],this._upsampleInfo=null,this.loadingAgent=null,this.requestPromise=null,this.requestAbort=null,this.pendingUpdates=0}static acquire(e){const t=Av.acquire();return t._init(e),t}release(){this.dispose(),Mv.delete(this),Av.release(this)}dispose(){this.loadingAgent=Object(w["f"])(this.loadingAgent),this.abortRequest(),this._unsetUpsampleInfo(),this.pendingUpdates=0,this._data=Object(xm["p"])(this._data)}static prune(){Av.prune(0)}_init(e){this.waitingAgents.clear(),this._data=Object(xm["p"])(this._data),this.dataMissing=!1,this.dataInvalidated=!1,this._unsetUpsampleInfo(),this.abortRequest(),this.loadingAgent=null,this.pendingUpdates=0,this._pool=e,this.elevationBounds=null}invalidateSourceData(){this.dataInvalidated=!0,this.dataMissing=!1,this._unsetUpsampleInfo()}abortRequest(){this.requestAbort=Object(w["a"])(this.requestAbort),this.requestPromise=null}get upsampleInfo(){return this._upsampleInfo}_unsetUpsampleInfo(){this._upsampleInfo&&(this._upsampleInfo.tile.unrefMapData(),this._pool.release(this._upsampleInfo),this._upsampleInfo=null)}setUpsampleInfo(e,t){if(e===t||Object(w["k"])(t))this._unsetUpsampleInfo();else{if(null==this._upsampleInfo)this._upsampleInfo=this._pool.acquire();else{if(this._upsampleInfo.tile===t)return;this._upsampleInfo.tile.unrefMapData()}t.refMapData(),Object(Ov["d"])(e,t,this._upsampleInfo)}}get data(){return this._data}set data(e){Object(xm["p"])(this._data),this._data=e}}const Av=new Ep["a"](Pv,null,()=>{}),Mv=new Map;function Rv(){Mv.size>0&&(console.log(Mv.size+" live TilePerLayerInfo allocations:"),Mv.forEach(e=>console.log(e,"\n")))}class Ev{constructor(e){this._texture=e,this.type="tile-texture",this._refCount=1}retain(){++this._refCount}release(){--this._refCount,0===this._refCount&&this._texture.dispose()}get texture(){return this._texture}generateMipmap(){this._texture.generateMipmap()}get descriptor(){return this._texture.descriptor}}const Dv=Object(F["f"])(),Iv=Object(F["f"])(),Fv=Object(F["f"])(),zv=.1;class Lv{constructor(){this.fovX=0,this.fovY=0,this.relativeWidthLimit=0,this.relativeHeightLimit=0,this.maxLod=0,this.angledSplitBias=0,this.aboveGround=!0}}class Vv{constructor(){this.lij=[0,0,0],this._children=[null,null,null,null],this._pendingUpdates=0,this._dirty=!0,this._previouslyRendered=!1,this.extent=Object(V["m"])(),this._elevationBounds=Object(Ut["b"])(),this.layerInfo=[[],[]],this.extentInRadians=Object(V["m"])(),this.centerAtSeaLevel=Object(F["f"])(),this._center=[Object(F["f"])(),Object(_n["c"])(),Object(F["f"])()],this.up=Object(F["i"])(),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._maxTesselation=0,this._usedMemory=qv,this._mapTileMemory=0,this._mapDataRefCount=0,this._screenDepth=0,this.renderOrder=0,this._edgeLen=0,this._edgeLen2=0,this._curvatureHeight=0}static prune(){Bv.prune(0),Nv.prune(0),Pv.prune()}get usedMemory(){return this._usedMemory===qv&&this._updateMemoryUsed(),this._usedMemory+(this.isCached?0:this.mapTileMemory)}get cachedMemory(){return this.isCached?this.mapTileMemory:0}get mapTileMemory(){this._usedMemory===qv&&this._updateMemoryUsed();let e=this._mapTileMemory;for(const{data:t}of this.layerInfo[1])t instanceof yg["a"]&&(e+=t.memoryUsage);return e}get isCached(){return!this.shouldLoad&&this._mapDataRefCount<=0}get maxTesselation(){return this._maxTesselation}get isWithinClippingArea(){return this._isWithinClippingArea}get intersectsClippingArea(){return this._intersectsClippingArea}get clippingArea(){return this._clippingArea}get parent(){return this._parent}get children(){return this._children}get surface(){return this._surface}get elevationBounds(){return this._elevationBounds}get level(){return this.lij[0]}get key(){return`${this.lij[0]}/${this.lij[1]}/${this.lij[2]}`}get edgeLen(){return this._edgeLen}get radius(){return this._center[1][3]}get screenDepth(){return this._screenDepth}get visible(){return this._dirty&&this.updateVisibilityNow(),this._visible}updateVisibilityNow(){this._dirty=!1;const e=this._intersectsClippingArea&&this._isVisible(this.surface.frustum);return e!==this._visible&&(this._visible=e,this._surface.emit("tiles-visibility-changed"),this._surface.renderer.setNeedsRender(),this.updateAgentSuspension()),this._visible}get loadable(){return this.visible||this._surface.view.state.fixedContentCamera}get rendered(){const e=!!this.renderData;return e!==this._previouslyRendered&&(this._surface.emit("tiles-visibility-changed"),this._previouslyRendered=e,this._surface.renderer.setNeedsRender()),e}get shouldLoad(){if(!this.loadable)return!1;if(1===this._surface.lodSnapping){const e=this.level-this._surface.snapLevel;if(0===e)return!0;if(1===e)return!1}return this.isLeaf}init(e,t,i){this.lij[0]=e[0],this.lij[1]=e[1],this.lij[2]=e[2],this.ellipsoid=Object(zt["e"])(i.tilingScheme.spatialReference),i.tilingScheme.getExtent(e[0],e[1],e[2],this.extent),i.tilingScheme.convertExtentToRadians(this.extent,this.extentInRadians),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._clippingArea=null,this._mapDataRefCount=0,i.upsampleMapCache.pop(this.key),this._edgeLen=0,this._edgeLen2=0,this._center[1][3]=0,this.vlevel=e?e[0]:0,t&&t.elevationBounds?Object(kt["c"])(this._elevationBounds,t.elevationBounds):Object(kt["s"])(this._elevationBounds,0,0),this._pendingUpdates=0,this.renderData=null,this._screenDepth=0,this._visible=!1,this._previouslyRendered=!1,this._parent=t,this.unsetChildren(),this._surface=i,this.updateVisibility();for(const r of Ag){const e=i.numLayers(r),t=this.layerInfo[r];for(const i of t)i.release();t.length=e;for(let i=0;i<e;i++)t[i]=Pv.acquire(this._surface.upsampleInfoPool),0===r&&this.findElevationBoundsForLayer(i,-1)}this.computeElevationBounds(),this._maxTesselation=Math.min(i.tilingScheme.pixelSize,J["f"])}release(){Object(xm["s"])(!this.renderData,"tile.renderData was not unloaded"),this._surface.upsampleMapCache.pop(this.key);for(const e of Ag){for(const t of this.layerInfo[e])t.release();this.layerInfo[e].length=0}this._parent=null,this._surface=null,this._usedMemory=qv}refMapData(){++this._mapDataRefCount,this.isCached||this._surface.upsampleMapCache.pop(this.key)}unrefMapData(){if(--this._mapDataRefCount,this.isCached){const e=this.cachedMemory;e>0&&(this._surface.upsampleMapCache.put(this.key,this,e),this.setMemoryDirty())}}setMemoryDirty(){this._usedMemory=qv}get cpuImageMemorySize(){const e=4,t=this._surface.tilingScheme.pixelSize;return t*t*e}_updateMemoryUsed(){this._usedMemory=0,this._mapTileMemory=0;const e=this.cpuImageMemorySize;for(const{data:t}of this.layerInfo[1])t instanceof Ev?this._mapTileMemory+=Object(rr["c"])(t.texture):t instanceof HTMLImageElement||t instanceof gm["a"]?this._mapTileMemory+=e:t instanceof Cv["a"]&&(this._mapTileMemory+=t.memoryUsage);for(const t of this.layerInfo[0])this._usedMemory+=t.data?e:0;this.renderData&&(this._usedMemory+=this.renderData.estimatedGeometryMemoryUsage,this._mapTileMemory+=Object(rr["c"])(this.renderData.textureDescriptor)),this.isCached&&this._surface.upsampleMapCache.updateSize(this.key,this,this.cachedMemory)}getUsedMemoryForLayer(e,t){const i=this.layerInfo[e][t];if(!i||!i.data)return 0;if(1!==e||this.isCached){if(0===e)return this.cpuImageMemorySize}else{const e=i.data;if(e instanceof Ev)return Object(rr["c"])(e.texture);if(e instanceof HTMLImageElement||e instanceof gm["a"])return this.cpuImageMemorySize;if(e instanceof yg["a"]||e instanceof Cv["a"])return e.memoryUsage}return 0}updateScreenDepth(e){const t=this._center[1],i=e,r=t[0],n=t[1],a=t[2],s=i[2]*r+i[6]*n+i[10]*a+i[14];this._screenDepth=s<0?0:s/(i[3]*r+i[7]*n+i[11]*a+i[15])}shouldSplit(e,t,i){if(Object(w["l"])(e.frustum)&&(!this._intersectsClippingArea||!this._isVisible(e.frustum)))return 0;const r=this.level;Object(Et["m"])(Dv,this._center[1],t);let n=Object(Et["w"])(Dv),a=1;Object(Et["m"])(Iv,this._center[0],t);const s=Object(Et["w"])(Iv);s<n&&(n=s,a=0),Object(Et["m"])(Iv,this._center[2],t);const o=Object(Et["w"])(Iv);if(o<n&&(n=o,a=2),this._edgeLen2>n&&r<e.maxLod)return 2;const c=Math.sqrt(n),l=e.fovX*c*2,d=this._edgeLen/l,h=()=>{const t=r+Math.ceil(-Math.log2(e.relativeWidthLimit/d));return t!==this.vlevel?(this.vlevel=t,4):1};if(1===i&&1===this._surface.snapLevel-r)return r>=e.maxLod?h():2;const u=Object(Et["k"])(this.up,Dv),p=this._elevationBounds[1]-this._elevationBounds[0],f=p/this.edgeLen;if(e.aboveGround&&u>0&&f<.001&&u/c-Math.sin(this._curvatureHeight/(this.edgeLen*Math.SQRT1_2)*Math.PI)-f>0)return 0;if(d<e.relativeWidthLimit)return this.vlevel!==this.level?(this.vlevel=this.level,4):0;if(r>=e.maxLod)return h();if(r>6){Object(Et["m"])(Iv,this._center[a],t),Object(Et["h"])(Fv,this.up,u),Object(Et["m"])(Fv,Fv,Iv);const i=Object(Et["w"])(Fv);if(i>this.radius*this.radius){Object(Et["h"])(Fv,Fv,this.radius/Math.sqrt(i)),Object(Et["i"])(Fv,Fv,this._center[a]),Object(Et["m"])(Fv,t,Fv);const r=Math.min(1,(Math.abs(Object(Et["k"])(Fv,this.up))+.5*p+this._curvatureHeight)/Object(Et["s"])(Fv)),n=zv/e.angledSplitBias,s=e.fovY*c*2;if(r*(this._edgeLen/s)<n*e.relativeHeightLimit)return 0}}return 2}setChildren(e,t,i,r){Object(xm["s"])(!!(e&&t&&i&&r),"Null child passed"),this._children[0]=e,this._children[1]=t,this._children[2]=i,this._children[3]=r}unsetChildren(){this._children[0]=null,this._children[1]=null,this._children[2]=null,this._children[3]=null}load(e){this.refMapData();for(const t of Ag)this._createOrUpdateAgents(0,t);e.loadTile(this)}unload(e){e.unloadTile(this);for(const t of Ag){const e=this.layerInfo[t];for(const t of e)t.loadingAgent&&t.loadingAgent!==wv&&(Uv(t.loadingAgent),t.loadingAgent=null),t.pendingUpdates=0}this.resetPendingUpdate(32),this.resetPendingUpdate(64),this.resetPendingUpdate(128),this.unrefMapData()}unloadMapData(){const e=this.layerInfo[1];for(const t of e)t.loadingAgent&&t.loadingAgent!==wv&&(Uv(t.loadingAgent),t.loadingAgent=null),t.pendingUpdates=0;this.renderData&&this.renderData.releaseTexture(),this.setMemoryDirty()}updateClippingStatus(e){if(Object(V["p"])(e,this._clippingArea))return!1;const t=this._intersectsClippingArea,i=this._isWithinClippingArea;Object(w["l"])(e)?(this._intersectsClippingArea=this.intersectsExtent(e),this._isWithinClippingArea=this._isWithinExtent(e)):(this._intersectsClippingArea=!0,this._isWithinClippingArea=!0),this._clippingArea=e,this.updateVisibility();const r=i&&this._isWithinClippingArea,n=!(i||t||this._isWithinClippingArea||this._intersectsClippingArea);return!this.renderData||r||n||this.setPendingUpdate(32),!0}updateVisibility(){this._dirty=!0,this._surface.setTileTreeDirty()}getLayerInfo(e,t){return this.layerInfo[t][e]}hasLayerData(e,t){const i=this.layerInfo[t][e];return!(!i||!i.data||i.dataInvalidated)}get updating(){if(this.hasPendingUpdates)return!0;for(const e of Ag){const t=this.layerInfo[e];for(const e of t)if(e.loadingAgent&&e.loadingAgent!==wv&&e.loadingAgent.updating)return!0}return!1}isSuspended(e){return!!this.hasPendingUpdate(2)||0!==e&&!this.loadable}get hasPendingUpdates(){return 0!==this._pendingUpdates}hasPendingUpdate(e){return(this._pendingUpdates&e)===e}setPendingUpdate(e){this._pendingUpdates|=e,2===e||8===e?this._surface.setTileTreeDirty():this._surface.requestUpdate()}resetPendingUpdate(e){return!!this.hasPendingUpdate(e)&&(this._pendingUpdates&=~e,!0)}requestLayerData(e,t,i){const r=this.layerInfo[t][e];if(r.waitingAgents.has(i))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),i.tile.lij.toString(),t,e),!0;if(r.waitingAgents.push(i),r.data&&!r.dataInvalidated)return console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),i.tile.lij.toString(),t,e),i.dataArrived(this),!0;if(r.requestPromise)return!0;Object(w["a"])(r.requestAbort),r.requestAbort=new AbortController;const n=this._surface.requestTileData(this,e,t,r.requestAbort);if(!n)return r.requestAbort=null,!1;const a=()=>{r.requestPromise===n&&(r.requestPromise=null,r.requestAbort=null)};return r.requestPromise=n,n.then(a,a),!0}get isLeaf(){return null==this._children[0]}hasLij(e){return this.lij[0]===e[0]&&this.lij[1]===e[1]&&this.lij[2]===e[2]}findByLij(e){if(this.hasLij(e))return this;if(this.isLeaf)return null;const t=this._children[0].findByLij(e)||this._children[1].findByLij(e)||this._children[2].findByLij(e)||this._children[3].findByLij(e);return t||null}distanceToSquared(e){return Object(Et["w"])(Object(Et["m"])(Fv,this._center[1],e))}containsPoint(e){const t=this.extent;return e[0]>=t[0]&&e[1]>=t[1]&&e[0]<=t[2]&&e[1]<=t[3]}unrequestLayerData(e,t,i){const r=this.layerInfo[t][e],n=r.waitingAgents,a=null!=n.removeUnordered(i);Object(xm["s"])(a,"agent has not requested this piece of map data"),n.length<1&&(r.abortRequest(),this._updateMemoryUsed())}dataArrived(e,t,i){const r=this.layerInfo[t][e];r.data=i,r.dataInvalidated=!1,r.waitingAgents.forAll(e=>e.dataArrived(this)),r.waitingAgents.clear(),this._updateMemoryUsed()}dataMissing(e,t,i){i.notInTilemap||console.error(`Tile ${this.lij.toString()} layer ${t}/${e} error ${i}`);const r=this.layerInfo[t][e];r.dataMissing=!0,r.waitingAgents.forAll(e=>e.dataMissing()),r.waitingAgents.clear(),this._updateMemoryUsed()}updateRenderData(e,t){switch(e){case 1:return this.updateTexture(t);case 0:return this.updateGeometry()}}updateTexture(e){this.renderData&&(this.resetPendingUpdate(0===e?64:128),this.setPendingUpdate(0===e?128:64))}updateGeometry(){this.setPendingUpdate(32);for(const e of this.layerInfo[0])e.pendingUpdates|=32}invalidateLayerData(e,t){this.layerInfo[t][e].invalidateSourceData(),this.restartAgents(t)}computeElevationBounds(){Object(kt["s"])(this._elevationBounds,Number.MAX_VALUE,-Number.MAX_VALUE);const e=this.layerInfo[0];let t=!0;for(const i of e)Object(w["l"])(i.elevationBounds)&&(this._elevationBounds[0]=Math.min(this._elevationBounds[0],i.elevationBounds.min),this._elevationBounds[1]=Math.max(this._elevationBounds[1],i.elevationBounds.max),i.elevationBounds.hasNoDataValues||(t=!1));t&&(this._elevationBounds[0]=Math.min(this._elevationBounds[0],0),this._elevationBounds[1]=Math.max(this._elevationBounds[1],0)),this.updateRadiusAndCenter(),this._surface.setTileTreeDirty()}_updateCenter(){const e=.5*(this._elevationBounds[0]+this._elevationBounds[1]);Object(Et["h"])(Fv,this.up,e),Object(Et["i"])(this._center[1],this.centerAtSeaLevel,Fv),Object(Et["h"])(Fv,this.up,this._elevationBounds[0]),Object(Et["i"])(this._center[0],this.centerAtSeaLevel,Fv),Object(Et["h"])(Fv,this.up,this._elevationBounds[1]),Object(Et["i"])(this._center[2],this.centerAtSeaLevel,Fv)}findElevationBoundsForLayer(e,t){const i=this.layerInfo[0][e];if(Object(w["l"])(i.elevationBounds)&&i.elevationBounds.level>=t)return;const r=this._surface.layerViewByIndex(e,0),n=Object(xm["c"])(r);if(!Object(Ov["e"])(this,n,!1))return;const a=Gv;let s=!1;if(i.data){const e=i.data;a.min=e.bounds[0],a.max=e.bounds[1],a.hasNoDataValues=e.hasNoDataValues,a.level=this.lij[0],s=!0}else{let t,i,r=0;for(let n=this._parent;n&&(!i||r<Object(J["l"])(this.level))&&(r=this.vlevel-n.level,t=i||t,i=n.layerInfo[0][e].data,!(!i&&t&&r>=Object(J["l"])(this.level)));n=n.parent);i=i||t,i&&(i.computeMinMaxValue(this.lij[0],this.lij[1],this.lij[2],a),a.min!==1/0&&(a.level=i.level,s=!0))}s&&(Object(w["k"])(i.elevationBounds)&&(i.elevationBounds=new xg),i.elevationBounds.copyFrom(a))}modifyLayers(e,t,i){const r=this.layerInfo[i];for(const s of r)s.loadingAgent&&s.loadingAgent!==wv&&(Uv(s.loadingAgent),s.loadingAgent=null),s.waitingAgents.clear();for(let s=0;s<r.length;++s)void 0===e[s]&&r[s].release();const n=new Array(...r),a=t.length;r.length=a;for(let s=0;s<a;s++){const e=t[s];r[s]=e>-1?n[e]:Pv.acquire(this._surface.upsampleInfoPool)}this._updateMemoryUsed()}restartAgents(e){this.renderData&&(this._createOrUpdateAgents(0,e),this.updateRenderData(e,0))}updateAgents(e){if(this.renderData){const t=this.layerInfo[e];for(const e of t)e.loadingAgent===wv&&(e.loadingAgent=null);this._createOrUpdateAgents(0,e)}}updateAgentSuspension(){for(const e of Ag){const t=this.isSuspended(e);for(const i of this.layerInfo[e])i.loadingAgent&&i.loadingAgent!==wv&&(i.loadingAgent.setSuspension(t),i.loadingAgent===wv&&this.updateRenderData(e,0))}}removeLayerAgent(e,t){const i=this.layerInfo[t][e];i.loadingAgent&&i.loadingAgent!==wv&&i.loadingAgent.dispose(),i.loadingAgent=null}agentDone(e,t){const i=this.layerInfo[t][e];i.loadingAgent=wv,i.data||i.upsampleInfo||this._createOrUpdateAgents(e+1,t)}_createOrUpdateAgents(e,t){const i=this.isSuspended(t),r=this.layerInfo[t];for(let n=e;n<r.length;++n){const e=r[n];let a=!1;const s=this._surface.layerViewByIndex(n,t),o=Object(xm["c"])(s);if(e.loadingAgent?Object(Ov["e"])(this,o,!1)?(e.loadingAgent!==wv&&e.loadingAgent.setSuspension(i),e.loadingAgent!==wv&&(a=e.loadingAgent.update())):e.dispose():Object(Ov["e"])(this,o,!1)&&(e.loadingAgent=kv(this,n,t,i),a=e.loadingAgent.startLoading(),a?e.loadingAgent===wv&&this.setPendingUpdate(32):(Uv(e.loadingAgent),e.loadingAgent=wv)),e.loadingAgent===wv&&this.updateRenderData(t,0),a&&s.isOpaque)return}}_isWithinExtent(e){const t=this.extent;return t[0]>=e[0]&&e[2]>=t[2]&&t[1]>=e[1]&&e[3]>=t[3]}intersectsExtent(e){const t=this.extent;return t[2]>=e[0]&&e[2]>=t[0]&&t[3]>=e[1]&&e[3]>=t[1]}getElevationBasedVerticesPerRow(e){const t=this.vlevel-this.level,i=Math.max(this.level-e,Object(J["l"])(this.level)-t);return Object(Oe["f"])(1+(this.maxTesselation>>i),2,this.maxTesselation+1)}get test(){return{cachedMemory:this.cachedMemory}}}function kv(e,t,i,r){const n=0===i?Nv.acquire():Bv.acquire();return n.init(e,t,i,r),n}function Uv(e){e.dispose(),e instanceof Sv?Nv.release(e):e instanceof Tv&&Bv.release(e)}const Bv=new Ep["a"](Tv),Nv=new Ep["a"](Sv),Gv=new xg,qv=-1;class Hv extends Vv{constructor(e,t,i){super(),this.horizontalScaleFactor=1,void 0!==e&&this.init(e,t,i)}init(e,t,i){super.init(e,t,i);const r=i.view.renderSpatialReference,n=Object(w["l"])(r)&&Object(It["k"])(r)&&i.spatialReference.isGeographic;this.horizontalScaleFactor=n?this.ellipsoid.radius*Math.PI/180:1,this._edgeLen=(this.extent[2]-this.extent[0])*this.horizontalScaleFactor,this._edgeLen2=this._edgeLen*this._edgeLen,this.centerAtSeaLevel[0]=Object(Oe["l"])(this.extent[0],this.extent[2],.5)*this.horizontalScaleFactor,this.centerAtSeaLevel[1]=Object(Oe["l"])(this.extent[1],this.extent[3],.5)*this.horizontalScaleFactor,this.centerAtSeaLevel[2]=0,this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateCenter();const e=(this.extent[2]-this.extent[0])*Math.SQRT1_2,t=.5*(this.elevationBounds[0]-this.elevationBounds[1]);this._center[1][3]=Math.sqrt(e*e+t*t)}_isVisible(e){return Object(Dp["g"])(e,this._aabb())}_aabb(){return Object(Fu["I"])(this.extent[0]*this.horizontalScaleFactor,this.extent[1]*this.horizontalScaleFactor,this.elevationBounds[0],this.extent[2]*this.horizontalScaleFactor,this.extent[3]*this.horizontalScaleFactor,this.elevationBounds[1])}intersectsRay(e,t,i,r,n){Wv[0]=1/t[0],Wv[1]=1/t[1],Wv[2]=1/t[2];const a=n*(this.extent[2]-this.extent[0])*this.horizontalScaleFactor*.1;return Object(Qg["g"])(this._aabb(),e,Wv,i+a,r)}createGeometry(e,t){nv(e,this.extent,t,this.horizontalScaleFactor,this.renderData),this.setMemoryDirty()}getDefaultVerticesPerRowOnLevel(){return this.level<9?3:2}}const Wv=Object(F["f"])();class $v extends Vv{constructor(e,t,i){super(),this.obb=new Array(8),this.isWebMercator=!1;for(let r=0;r<8;r++)this.obb[r]=Object(F["f"])();void 0!==e&&this.init(e,t,i)}init(e,t,i){super.init(e,t,i),this.isWebMercator=i.tilingScheme.spatialReference.isWebMercator;const r=this.ellipsoid.radius,n=this.extentInRadians[0],a=this.extentInRadians[1],s=this.extentInRadians[2],o=this.extentInRadians[3],c=e[0],l=Object(Oe["l"])(a,o,.5),d=Object(Oe["l"])(n,s,.5),h=0===c?0:Math.min(Math.abs(a),Math.abs(o));this._edgeLen=(s-n)*Math.cos(h)*r,this._edgeLen2=this._edgeLen*this._edgeLen,this._curvatureHeight=r-Math.sqrt(r*r-this._edgeLen2/4),Object(L["k"])(this.centerAtSeaLevel,d,l,this.ellipsoid.radius,0);const u=Object(F["g"])(this.centerAtSeaLevel);Object(Et["u"])(u,u),this.up=u,this._updateOBB(),this.updateRadiusAndCenter()}updateRadiusAndCenter(){if(0===this.lij[0])Object(Et["z"])(this._center[1],0,0,0),Object(Et["z"])(this._center[0],0,0,0),Object(Et["z"])(this._center[2],0,0,0),this.ellipsoid||(this.ellipsoid=Object(zt["e"])(this.surface.spatialReference)),this._center[1][3]=this.ellipsoid.radius+this.elevationBounds[1];else{this._updateCenter();const e=Math.max(Object(Et["o"])(this._center[1],this.obb[0]),Object(Et["o"])(this._center[1],this.obb[1]));this._center[1][3]=Math.sqrt(e)}}_isVisible(e){if(!Object(Dp["k"])(e,this._center[1]))return!1;if(this.lij[0]<10)return!0;const t=this.obb;for(let i=0;i<6;i++){const r=4===i,n=e[i];r&&(Qv[0]=n[0],Qv[1]=n[1],Qv[2]=n[2],Qv[3]=n[3]-this.surface.view.state.camera.near);const a=r?Qv:n;let s;for(s=0;s<8;s++){const e=t[s];if(a[0]*e[0]+a[1]*e[1]+a[2]*e[2]+a[3]<0)break}if(8===s)return!1}return!0}computeElevationBounds(){super.computeElevationBounds(),this._updateOBB()}createGeometry(e,t){const i=this._isPole(this.lij[1],this.lij[0]);rv(e,this.extent,t,this.renderData,this.extentInRadians,this.isWebMercator,this.ellipsoid,i),this.setMemoryDirty()}_updateOBB(){const e=this.extentInRadians,t=this.obb;for(let i=0;i<2;i++){const r=this.elevationBounds[i];let n=4*i;Object(L["k"])(t[n++],e[0],e[1],this.ellipsoid.radius,r),Object(L["k"])(t[n++],e[0],e[3],this.ellipsoid.radius,r),Object(L["k"])(t[n++],e[2],e[3],this.ellipsoid.radius,r),Object(L["k"])(t[n++],e[2],e[1],this.ellipsoid.radius,r)}if(this.isWebMercator){const e=this._isPole(this.lij[1],this.lij[0]);2===e?(Object(Et["z"])(t[1],0,0,this.ellipsoid.radius),Object(Et["z"])(t[2],0,0,this.ellipsoid.radius),Object(Et["z"])(t[5],0,0,this.ellipsoid.radius),Object(Et["z"])(t[6],0,0,this.ellipsoid.radius)):1===e&&(Object(Et["z"])(t[0],0,0,-this.ellipsoid.radius),Object(Et["z"])(t[3],0,0,-this.ellipsoid.radius),Object(Et["z"])(t[4],0,0,-this.ellipsoid.radius),Object(Et["z"])(t[7],0,0,-this.ellipsoid.radius))}}_isPole(e,t){let i=0;return e===(1<<t)-1&&(i+=1),0===e&&(i+=2),i}intersectsRay(e,t,i,r,n){const a=this._center[1],s=a[3]+i+.2*this.ellipsoid.radius*Math.abs(n*(this.extentInRadians[3]-this.extentInRadians[1])),o=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],c=a[0]-e[0],l=a[1]-e[1],d=a[2]-e[2],h=(c*t[0]+l*t[1]+d*t[2])/o,u=t[0]*h-c,p=t[1]*h-l,f=t[2]*h-d;return u*u+p*p+f*f<s*s}getDefaultVerticesPerRowOnLevel(){return this.level<Zv.length?Zv[this.level]+1:2}}const Zv=[128,64,32,16,16,8,8,4],Qv=Object(mo["d"])();var Xv=i("8190");class Yv{constructor(e){this._getFadeDuration=e,this._fadeStart=0,this._delayedTime=0}clear(){this._current=Object(w["e"])(this._current),this._next=Object(w["e"])(this._next),this._waiting=Object(w["e"])(this._waiting),this._delayed=Object(w["e"])(this._delayed)}get current(){if(Object(w["k"])(this._current))return null;if(!this._isFadingEnabled){const e=this._delayed||this._waiting||this._next||this._current;e!==this._current&&(this._current=null,this.clear(),this._current=e)}let e=Yv.test.fadeMoment;if(Object(w["l"])(this._delayed)&&(e=e||performance.now(),e>=this._delayedTime&&(this._push(this._delayed,0),this._delayed=null)),Object(w["l"])(this._next)){e=e||performance.now();const t=this._fadeDuration,i=Object(w["l"])(this._current)&&this._next.texture===this._current.texture,r=0!==this._next.type,n=e-this._fadeStart>=t;(i||r||n)&&(Object(w["e"])(this._current),this._current=this._next,this._next=this._waiting,this._waiting=null,this._fadeStart=this._alignFadeStart(e))}return this._current}get next(){return this._next}get fadeFactor(){if(Object(w["k"])(this._next))return 1;const e=Yv.test.fadeMoment||performance.now(),t=Math.max(0,e-this._fadeStart),i=this._fadeDuration;return t>i?0:1-t/i}get isFading(){return Object(w["l"])(this._next)||Object(w["l"])(this._delayed)}push(e,t=0){this._delayed=Object(w["e"])(this._delayed),this._push(e,t)}_push(e,t){if(this._isFadingEnabled||this.clear(),Object(w["k"])(this._current))return void(this._current=e);const i=Yv.test.fadeMoment||performance.now();return 0!==t?(this._delayed=e,void(this._delayedTime=i+t)):Object(w["k"])(this._next)?(this._next=e,void(this._fadeStart=this._alignFadeStart(i))):void(Object(w["k"])(e)||(Object(w["e"])(this._waiting),this._waiting=e))}get _fadeDuration(){return Object(w["k"])(this._waiting)?this._getFadeDuration():.5*this._getFadeDuration()}_alignFadeStart(e){const t=this._getFadeDuration();return e+t-e%t}get _isFadingEnabled(){return this._getFadeDuration()>0}}Yv.test={fadeMoment:0};class Kv{constructor(){this._scales=[-1,-1,-1,-1],this._offsets=[-1,-1,-1,-1]}clear(){this._scales[0]=this._scales[1]=this._scales[2]=this._scales[3]=-1,this._offsets[0]=this._offsets[1]=this._offsets[2]=this._offsets[3]=-1}setScale(e,t,i){this._scales[2*e]=t,this._scales[2*e+1]=i}setOffset(e,t,i){this._offsets[2*e]=t,this._offsets[2*e+1]=i}get scales(){return this._scales}get offsets(){return this._offsets}}class Jv{constructor(){this.geometryInfo=new Kg,this.intersectionData=null,this.skirtIntersectionData=null,this._textureRef=new Yv(()=>this.tile.surface.textureFadeDuration),this.overlay=new Kv}init(e){this.tile=e,this.clear();const t=this.geometryInfo;t.indices=null,t.vertexAttributes=null,Object(Fu["k"])(t.boundingBox),t.numSurfaceIndices=0,t.numSkirtIndices=0,t.numWithoutSkirtIndices=0,t.numVertsPerRow=0,this.intersectionData=null,this.skirtIntersectionData=null,this.geometryState={numVertsPerRow:0,samplerData:null,clippingArea:null,wireframe:!1},this.localOrigin=null,this.overlay.clear()}clear(){this.releaseGeometry(),this.releaseTexture(),this._textureRef.clear()}updateGeometry(e,t){return!!this._updateGeometryState(t)&&(this._releaseGeometry(),this._createGeometry(e),!0)}releaseGeometry(){return!!this._releaseGeometry()&&(this.geometryState={numVertsPerRow:0,samplerData:null,clippingArea:null,wireframe:!1},!0)}ensureTexture(e,t){return Object(w["l"])(this._texture)&&this._texture.descriptor.width!==e&&this.releaseTexture(),Object(w["k"])(this._texture)&&(this._texture=t(),this.tile.setMemoryDirty()),this._texture}releaseTexture(){Object(w["l"])(this._texture)&&(this._texture.release(),this._texture=null,this.tile.setMemoryDirty())}_updateGeometryState(e){const t=this._getElevationInfo(),i=t.samplerData?this.tile.getElevationBasedVerticesPerRow(t.maxTileLevel):this.tile.getDefaultVerticesPerRowOnLevel();let r=this.tile.clippingArea;this.tile.intersectsClippingArea&&!this.tile.isWithinClippingArea||(r=null);const n=this.geometryState;let a=!1;return n.numVertsPerRow!==i&&(n.numVertsPerRow=i,a=!0),t.changed&&(n.samplerData=t.samplerData,a=!0),Object(R["e"])(n.clippingArea,r)||(n.clippingArea=r,a=!0),n.wireframe!==e&&(n.wireframe=e,a=!0),a}_createGeometry(e){this.tile.createGeometry(this.geometryState,this.localOrigin);const t=this.geometryInfo.vertexAttributes,i=this.geometryInfo.indices,r=e.gl;this._vao=new nr["a"](e,Jt["a"],{geometry:Object(Yi["a"])(t.layout)},{geometry:tr["a"].createVertex(e,r.STATIC_DRAW,t.buffer)},tr["a"].createIndex(e,r.STATIC_DRAW,i))}_releaseGeometry(){return!!this._vao&&(this._vao.dispose(),this._vao=null,tv(this.geometryInfo),!0)}get vao(){return this._vao}setTextureReference(e,t=0){Object(w["l"])(e)&&e.texture!==this._texture&&this.releaseTexture(),this._textureRef.push(e,t)}get textureReference(){return this._textureRef.current}get nextTextureReference(){return this._textureRef.next}get textureFadeFactor(){return this._textureRef.fadeFactor}get textureIsFading(){return this._textureRef.isFading}_getElevationInfo(){const e=this.geometryState.samplerData,t=this.tile.layerInfo[0],i=t.length;let r=new Array(i),n=0,a=0,s=!1;for(let o=0;o<i;o++){const i=t[o];if(i.upsampleInfo){const t=i.upsampleInfo.tile,c=t.layerInfo[0][o].data,l=c&&c.samplerData;e&&e[n]===l||(s=!0),r[n++]=l,a=Math.max(a,t.lij[0])}else if(i.data){const t=this.tile.surface.layerViewByIndex(o,0);if(Object(Ov["e"])(this.tile,t.layer,!1)){const t=i.data;e&&e[n]===t.samplerData||(s=!0),r[n++]=t.samplerData,a=this.tile.level}}}return e&&e.length!==n&&(s=!0),n>0?r.length=n:r=null,{changed:s,samplerData:r,maxTileLevel:a}}get estimatedGeometryMemoryUsage(){const e=Object(w["o"])(this.intersectionData,0,e=>e.estimatedMemoryUsage)+Object(w["o"])(this.skirtIntersectionData,0,e=>e.estimatedMemoryUsage+e.vertexPositionBuffer.byteLength);return this.geometryInfo.indices.byteLength+this.geometryInfo.vertexAttributes.byteLength+e}get textureDescriptor(){return Object(w["l"])(this._texture)?this._texture.descriptor:null}get test(){return{hasTexture:null!=this._texture}}}class ey{constructor(){this.extent=Object(Dt["e"])(),this.minLevel=0,this.maxLevel=0,this.callback=null}}class ty{constructor(){this._queries=new Fh["a"]({initialSize:10}),this._queriesInvPtr=0,this._queryQueue=new Fh["a"]({initialSize:30}),this._queryPool=new Ep["a"](ey)}queryVisibleLevelRange(e,t,i,r){const n=this._queryPool.acquire();Object(zh["c"])(n.extent,e),n.minLevel=t||-Number.MAX_VALUE,n.maxLevel=null!=i?i:Number.MAX_VALUE,n.callback=r,this._queryQueue.push(n)}hasPendingQueries(){return 0!==this._queryQueue.length}prepareQueries(){for(;this._queries.length<this._queries.data.length&&this._queryQueue.length>0;){const e=this._queryQueue.pop();this._queries.push(e)}this._queriesInvPtr=this._queries.length}processQueries(){for(let e=0;e<this._queries.length;e++){const t=this._queries.data[e];this._queryPool.release(t),t.callback(e>=this._queriesInvPtr),t.callback=null}this._queries.clear()}scaleQueriesForTile(e){const t=e.level;let i=0;for(;i<this._queriesInvPtr;){const r=this._queries.data[i],n=r.extent;t>=r.minLevel&&t<=r.maxLevel&&n[0]<=e.extent[2]&&n[2]>=e.extent[0]&&n[1]<=e.extent[3]&&n[3]>=e.extent[1]?(this._queries.swapElements(i,this._queriesInvPtr-1),this._queriesInvPtr--):i++}}}i("1956"),i("d17d"),i("9f8b");var iy=i("ec6a");const ry=.125;class ny{constructor(){this._renderParams={context:null,drawPhase:1,state:new iy["a"]({viewpoint:new b["a"]({targetGeometry:new Br["a"](0,0),scale:1,rotation:0}),size:[256,256]}),stationary:!0,pixelRatio:1,displayLevel:-1,requiredLevel:-1,globalOpacity:1,renderPass:"background",styleLayer:null,styleLayerUID:-1,painter:null,glyphMosaic:null,spriteMosaic:null,profiler:null,renderingOptions:null,deltaTime:-1,timeline:null,time:0,hasClipping:!1,blendMode:null,dataUploadCounter:0,effects:null,inFadeTransition:!1,requireFBO:!1}}dispose(){this._renderParams=null}render(e,t,i,r,n,a,s,o,c,l){const d=a.adjustLevel(t[0]),h=this._renderParams;h.context=e,h.painter=r,h.glyphMosaic=r.glyphMosaic,h.spriteMosaic=r.spriteMosaic,h.pixelRatio=l,h.displayLevel=d,h.requiredLevel=d;const u=a.getScale(t[0]),[p,f]=a.getShift(t,s*u),b=ry*s*u/c,m=i.transforms.dvs;m[0]=b,m[4]=-b,m[6]=-1-p-o[0]*s*2,m[7]=1+f+(1-o[1])*s*2-2,h.state.size[0]=c,h.state.size[1]=c,i.stage||i.attachWithContext(e),i.triangleCount=0,r.drawTile(h,i,n)}}var ay=i("affb");class sy extends Yt["a"]{initializeProgram(e){const t=sy.shader.get().build();return new ei["a"](e.rctx,t,Jt["a"])}initializePipeline(){const e=2===this.configuration.mode?Object(ti["i"])(1,771):1===this.configuration.mode?Object(ti["i"])(0,770):null;return Object(ti["g"])({blending:e,colorWrite:ti["d"]})}}sy.shader=new Xt["a"](ay["a"],()=>i.e("chunk-2d0e149c").then(i.bind(null,"7a95")));class oy extends Kt["a"]{constructor(){super(...arguments),this.mode=0}}Object(h["a"])([Object(Kt["b"])({count:3})],oy.prototype,"mode",void 0);var cy=i("f6ac"),ly=i("beba");class dy extends Yt["a"]{get uniformLocationInfos(){return this._uniformLocationInfos||(this._uniformLocationInfos=Object(ly["i"])(this._context,this.program)),this._uniformLocationInfos}initializeProgram(e){const t=dy.shader.get(),i=this.configuration,r=t.build({output:i.colorizerType,applyColormap:i.applyColormap,stretchType:i.stretchType});return this._context=e.rctx,new ei["a"](e.rctx,r,Jt["a"])}initializePipeline(){const e=2===this.configuration.mode?Object(ti["i"])(1,771):1===this.configuration.mode?Object(ti["i"])(0,770):null;return Object(ti["g"])({blending:e,colorWrite:ti["d"]})}bindPass(e){Object(ly["k"])(this.program,this.uniformLocationInfos,e.basic),Object(ly["k"])(this.program,this.uniformLocationInfos,e.common),Object(w["l"])(e.colormap)&&Object(ly["k"])(this.program,this.uniformLocationInfos,e.colormap),0===this.configuration.colorizerType&&Object(w["l"])(e.stretch)?Object(ly["k"])(this.program,this.uniformLocationInfos,e.stretch):2===this.configuration.colorizerType&&Object(w["l"])(e.hillshade)&&Object(ly["k"])(this.program,this.uniformLocationInfos,e.hillshade)}}dy.shader=new Xt["a"](cy["a"],()=>i.e("chunk-2d222785").then(i.bind(null,"cf6b")));class hy extends Kt["a"]{constructor(){super(...arguments),this.mode=2,this.colorizerType=0,this.stretchType=0,this.applyColormap=!0}}Object(h["a"])([Object(Kt["b"])({count:3})],hy.prototype,"mode",void 0),Object(h["a"])([Object(Kt["b"])({count:3})],hy.prototype,"colorizerType",void 0),Object(h["a"])([Object(Kt["b"])({count:2})],hy.prototype,"stretchType",void 0),Object(h["a"])([Object(Kt["b"])()],hy.prototype,"applyColormap",void 0);class uy{constructor(e,t,i,r,n,a,s){this.texture=e,this.type=t,e.retain(),this.offsetAndScale=Object(Dt["g"])(i.offset[0],i.offset[1],i.scale,i.scale),this.opacities=Object(F["h"])(r,s?a:0,n)}destroy(){this.texture.release()}}class py{constructor(e){this._rctx=e,this._pools=new Map}acquire(e){return this.getPool(e).acquire()}release(e){this.getPool(e.width).release(e)}clear(){this._pools.forEach(e=>e.destroy()),this._pools.clear()}getPool(e){let t=this._pools.get(e);if(!t){const i=zi["a"].bind(zi["a"],this._rctx,{colorTarget:0,depthStencilTarget:1,width:e,height:e});t=new Ep["a"](i),this._pools.set(e,t)}return t}}class fy{constructor(e,t,i){this._rctx=e,this.tileSize=t,this._techniqueRepository=i,this._backgroundIsGrid=!1,this._backgroundTexture=null,this._backgroundColor=null,this._blackTex=null,this._vectorTileHelper=new ny,this._maxAnisotropy=this._rctx.parameters.maxMaxAnisotropy,this._vaoQuad=Object(ai["d"])(this._rctx,ni["b"]),this._blackTex=new Ev(Object(ai["a"])(this._rctx,[0,0,0,1])),this._fboPool=new py(this._rctx)}dispose(){this._fboPool&&(this._fboPool.clear(),this._fboPool=null),this._vaoQuad=Object(w["f"])(this._vaoQuad),this._backgroundTexture=Object(w["s"])(this._backgroundTexture),this._blackTex=Object(w["s"])(this._blackTex),this._blendLayersTechnique=Object(w["f"])(this._blendLayersTechnique),this._applyOpacityTechnique=Object(w["f"])(this._applyOpacityTechnique),this._vectorTileHelper=Object(w["f"])(this._vectorTileHelper)}get blendLayersTechnique(){if(Object(w["k"])(this._blendLayersTechnique)){const e=new oy;e.mode=2,this._blendLayersTechnique=this._techniqueRepository.acquire(sy,e)}return this._blendLayersTechnique}get applyOpacityTechnique(){if(Object(w["k"])(this._applyOpacityTechnique)){const e=new oy;e.mode=1,this._applyOpacityTechnique=this._techniqueRepository.acquire(sy,e)}return this._applyOpacityTechnique}get backgroundIsGrid(){return this._backgroundIsGrid}get backgroundColor(){return this._backgroundColor}updateTileTexture(e,t){const i=e.layerInfo[1];for(const f of i)f.pendingUpdates&=-1;if(!e.renderData)return;const r=e.surface,n=r.baseOpacity;let a=0,s=0,o=this.tileSize,c=!1;const l=r.view.pixelRatio;let d=i.length,h=0;for(;h<i.length&&!c;h++){const t=r.layerViewByIndex(h,1),u=t.fullOpacity;if(gy[h]=u,Object(G["b"])(t.layer)&&d>=i.length&&(d=h),0===u)continue;++s;const p=my(e,h,vy);p&&(Object(xm["n"])(t)?o=Math.max(o,this.tileSize*l):1===n&&1===u&&(t.isOpaque||this._dataToTexture(p)&&p.sourceLayerInfo.data.descriptor.isOpaque)&&(c=!0),++a)}this._cleanupFBOPool(l,i.length),o=by(o);const u=o/this.tileSize,p=h-1;0!==a?1===a&&(c||this._backgroundIsGrid||Object(w["l"])(this._backgroundColor))&&this._useLayerTexture(e,p,d,gy[p])||this._composeMapLayers(e,t,p,d,c,gy,o,u):this._useBackgroundTexture(e,s)}_useBackgroundTexture(e,t){let i=0;(e.surface.view.layerViewManager.updating||t>0)&&(i=5e3),this._backgroundTexture&&Object(w["k"])(e.renderData.textureReference)&&(i=0),e.renderData.setTextureReference(Object(w["l"])(this._backgroundTexture)?new uy(this._backgroundTexture,0,yy,e.surface.baseOpacity,1,1,!1):null,i)}_useLayerTexture(e,t,i,r){const n=t<i,a=n?1:e.surface.baseOpacity,s=n?e.surface.baseOpacity:1,o=my(e,t,vy);return!!this._dataToTexture(o)&&(e.renderData.setTextureReference(new uy(o.sourceLayerInfo.data,0,o,a,r,s,!0)),!0)}_composeMapLayers(e,t,i,r,n,a,s,o){const c=this._rctx,l=this._fboPool.acquire(s);c.bindFramebuffer(l),c.setViewport(0,0,s,s),c.setClearColor(0,0,0,0),c.setClearDepth(1),c.clearSafe(16640);let d=!1;!n&&Object(w["l"])(this._backgroundTexture)&&this._drawRasterData(this.blendLayersTechnique,this._backgroundTexture.texture,1,Ut["a"]);const h=e.surface.baseOpacity;let u=!1,p=9987;for(let v=i;v>=0;v--){const t=my(e,v,vy);t&&(v<r&&h<1&&!u&&(this._drawRasterData(this.applyOpacityTechnique,this._blackTex.texture,1,Ut["a"],h),u=!0),0!==a[v]&&(Object(xm["o"])(t)?d=this._drawVectorData(this.blendLayersTechnique,t,o,a[v],s,l,d):Object(xm["g"])(t)?(this._drawImageryTileData(t,a[v]),this.hasNearestInterpolation(t)&&(p=9728)):this._dataToTexture(t)&&this._drawRasterData(this.blendLayersTechnique,t.sourceLayerInfo.data.texture,t.scale,t.offset,a[v])))}const f=e.renderData.ensureTexture(s,()=>this._buildTexture(s,p)),b=c.bindTexture(f.texture,ir["a"].TEXTURE_UNIT_FOR_UPDATES),m=f.descriptor;c.gl.copyTexImage2D(c.gl.TEXTURE_2D,0,m.pixelFormat,0,0,m.width,m.height,0),f.generateMipmap(),c.bindTexture(b,ir["a"].TEXTURE_UNIT_FOR_UPDATES),c.bindFramebuffer(null),this._fboPool.release(l);const g=u?1:h;e.renderData.setTextureReference(new uy(f,t,yy,g,1,1,!1))}_drawQuad(e){this._rctx.bindVAO(this._vaoQuad),e.assertCompatibleVertexAttributeLocations(this._vaoQuad),this._rctx.drawArrays(5,0,Object(rr["e"])(this._vaoQuad,"geometry"))}_drawRasterData(e,t,i,r,n=1){if(Object(w["k"])(t))return;const a=this._rctx,s=e.program;e.bindPipelineState(a),a.useProgram(s),s.bindTexture(t,"tex"),s.setUniform1f("scale",i),s.setUniform2f("offset",r[0],r[1]),s.setUniform1f("opacity",n),this._drawQuad(s)}hasNearestInterpolation(e){const t=e.sourceLayerInfo.data;return!!t.source&&"nearest"===t.interpolation}_drawImageryTileData(e,t=1){const i=e.sourceLayerInfo.data;if(!i.source)return;e.tile.surface.layerViewByIndex(e.layerIndex,1).ensureSymbolizerParameters(i);const r=this._getRasterColorizerTechnique(i),n=this._rctx,a=r.program;if(r.bindPipelineState(n),n.useProgram(a),!i.bind(n))return;i.opacity=t,i.scale=e.scale,i.offset=e.offset;const{names:s,textures:o}=i.getTextures();s.forEach((e,t)=>a.bindTexture(o[t],e)),r.bindPass(i.getUniforms()),this._drawQuad(a),n.bindVAO()}_getRasterColorizerTechnique(e){const t=e.symbolizerParameters,i=["stretch","lut","hillshade"].indexOf(t.type);return Object(w["k"])(this._rasterColorizerConfig)&&(this._rasterColorizerConfig=new hy,this._rctx.gl.getExtension("WEBGL_color_buffer_float"),this._rctx.gl.getExtension("OES_texture_float")),this._rasterColorizerConfig.colorizerType=i,this._rasterColorizerConfig.applyColormap=!!t.colormap,this._rasterColorizerConfig.stretchType=e.hasStretchTypeNone()?0:1,this._rasterColorizerTechnique=this._techniqueRepository.releaseAndAcquire(dy,this._rasterColorizerConfig,this._rasterColorizerTechnique),this._rasterColorizerTechnique}_drawVectorData(e,t,i,r,n,a,s){const o=this._rctx,c=t.sourceLayerInfo.data,l=t.tile.surface.layerViewByIndex(t.layerIndex,1);let d;return e.bindPipelineState(o),r<1?(d=this._fboPool.acquire(n),o.bindFramebuffer(d),o.setClearColor(1,1,1,0),o.clearSafe(16640)):s&&o.clearSafe(256),this._vectorTileHelper.render(o,t.sourceLod,c,l.painter,l.layer.styleRepository,l.schemaHelper,Math.round(1/t.scale),t.offset,this.tileSize,i),!Object(w["l"])(d)||(o.bindFramebuffer(a),this._drawRasterData(e,d.colorTexture,1,[0,0],r),this._fboPool.release(d),s)}_dataToTexture(e){return Object(xm["i"])(e)&&this._rasterDataToTexture(e),Object(xm["k"])(e)}_rasterDataToTexture(e){const t=e.sourceLayerInfo;t.data=this._buildTexture(t.data),e.tile.setMemoryDirty()}setBackground(e,t){Object(w["s"])(this._backgroundTexture),this._backgroundIsGrid=t,e instanceof HTMLImageElement?(this._backgroundTexture=this._buildTexture(e),this._backgroundColor=null):(this._backgroundTexture=new Ev(Object(ai["a"])(this._rctx,Object(Dt["g"])(e[0]||0,e[1]||0,e[2]||0,1))),this._backgroundColor=Object(F["h"])(e[0]||0,e[1]||0,e[2]||0))}_buildTexture(e,t=9987){if(Object(w["k"])(e))return null;const i={target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:t,maxAnisotropy:this._maxAnisotropy,flipped:!0,hasMipmap:!0},r=this._rctx;let n;if("number"==typeof e)i.width=i.height=e,n=new Ev(new ir["a"](r,i));else if(e instanceof gm["a"])i.isOpaque=e.isOpaque,n=new Ev(new ir["a"](r,i,e.image)),e.release();else try{n=new Ev(new ir["a"](r,i,e))}catch(s){n=new Ev(Object(ai["c"])(r)),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}const a=r.bindTexture(n.texture,ir["a"].TEXTURE_UNIT_FOR_UPDATES);return n.generateMipmap(),r.bindTexture(a,ir["a"].TEXTURE_UNIT_FOR_UPDATES),n}_cleanupFBOPool(e,t){e===this._lastPixelRatio&&t===this._lastNumLayers||(this._fboPool.clear(),this._lastPixelRatio=e,this._lastNumLayers=t)}get test(){return{backgroundTexture:this._backgroundTexture}}}function by(e){const t=Object(Oe["n"])(e),i=t*t,r=e*e;if(i===r)return e;const n=t/2;return i-r<r-n*n?t:n}function my(e,t,i){i.layerIndex=t;const r=e.layerInfo[1][t];if(r.data)return Object(kt["s"])(i.offset,0,0),i.tile=e,i.scale=1,i.sourceLod=e.lij,i.sourceLayerInfo=r,i;const n=r.upsampleInfo;if(n){const e=n.tile.layerInfo[1][t];return i.tile=n.tile,Object(kt["c"])(i.offset,n.offset),i.scale=n.scale,i.sourceLod=n.tile.lij,i.sourceLayerInfo=e,i}return null}const gy=new Array,vy={tile:null,sourceLayerInfo:null,sourceLod:null,offset:[0,0],scale:1,layerIndex:0},yy={offset:[0,0],scale:1},Oy=40,_y=20,xy=.8,jy=15,wy=1e-6;function Sy(e,t,i){const r=t,n=i;let a=0,s=1/0;for(let o=0;o<3;++o){{const t=e[o];if(r[o]<t){if(n[o]<=wy)return!1;const e=(t-r[o])/n[o];a=Math.max(a,e)}else if(n[o]<=-wy){const e=(t-r[o])/n[o];s=Math.min(s,e)}if(a>s)return!1}{const t=e[o+3];if(r[o]>t){if(n[o]>=-wy)return!1;const e=(t-r[o])/n[o];a=Math.max(a,e)}else if(n[o]>=wy){const e=(t-r[o])/n[o];s=Math.min(s,e)}if(a>s)return!1}}return!0}class Ty{constructor(e,t,i,r,n){this.aabb=e,this.axis=t,this.d=i,this.midStartIndex=r,this.rightStartIndex=n}}class Cy{constructor(e,t,i,r){this.globalTriangleVertexIndices=e,this.firstTriangleIndex=t,this.positionAttribute=r,this.rayDirection=Object(F["f"])(),this.bspNodeTree=new Array,this.vertexPositionBuffer=r.data,this.vertexPositionStride=r.stride;const n=i-t,a=n<=zy?new Uint16Array(n):new Uint32Array(n);this.indices=a;for(let s=0;s<n;++s)a[s]=s;{const s=Iy(e,t,i,r.data,r.stride),o=(e,t,i)=>{const r=Ey(a,s,e,t),n=t-e;if(n<=_y){const i=new Ty(r,void 0,0,e,t);return this.bspNodeTree.push(i),i}const{axis:c,midValue:l}=Dy(r),d=Ry(a,s,e,t,c,l),h=(e,t)=>{if(i>jy)return;const r=t-e;return r<_y||r>=xy*n?void 0:o(e,t,i+1)},u=new Ty(r,c,l,d.next,d.mid);return this.bspNodeTree.push(u),u.leftNode=h(e,d.next),u.rightNode=h(d.mid,t),u};o(0,n,0),this.triangleVertexIndices=Fy(a,e,t,i)}}intersectRayTriangleRange(e,t){{if(e>=t)return;const i=this.triangleVertexIndices,r=this.positionAttribute.data,n=this.positionAttribute.stride,a=this.rayOrigin,s=a[0],o=a[1],c=a[2],l=this.rayDirection,d=l[0],h=l[1],u=l[2];for(let p=e,f=3*e;p<t;++p){const e=i[f]*n,t=r[e],a=r[e+1],l=r[e+2],b=i[f+1]*n,m=r[b],g=r[b+1],v=r[b+2],y=i[f+2]*n,O=r[y],_=r[y+1],x=r[y+2];f+=3;const j=m-t,w=g-a,S=v-l,T=O-t,C=_-a,P=x-l,A=h*P-C*u,M=u*T-P*d,R=d*C-T*h,E=j*A+w*M+S*R;if(Math.abs(E)<=Number.EPSILON)continue;const D=s-t,I=o-a,F=c-l,z=D*A+I*M+F*R;if(E>0){if(z<0||z>E)continue}else if(z>0||z<E)continue;const L=I*S-w*F,V=F*j-S*D,k=D*w-j*I,U=d*L+h*V+u*k;if(E>0){if(U<0||z+U>E)continue}else if(U>0||z+U<E)continue;const B=(T*L+C*V+P*k)/E;if(B>=0){const e=this.indices[p]+this.firstTriangleIndex,t=Object(Qg["d"])(j,w,S,T,C,P,Py);this.callback(B,t,e,!1)}}}Cy.numFacesTested+=t-e}intersectRay(e,t){Cy.numFacesTested=0;const i=Object(F["h"])(e.r0[0],e.r0[1],e.r0[2]),r=Object(F["h"])(e.r1[0],e.r1[1],e.r1[2]),n=r[0]-i[0],a=r[1]-i[1],s=r[2]-i[2];if(n*n+a*a+s*s<wy)return;this.rayOrigin=i;const o=this.rayDirection;o[0]=n,o[1]=a,o[2]=s;const c=this.triangleVertexIndices.length/3;this.callback=t;const l=this.bspNodeTree[0];this.intersectRayBSP(l,0,c)}intersectRayBSP(e,t,i){const r=this.rayOrigin,n=this.rayDirection;if(!Sy(e.aabb,r,n))return;const a=e.axis,s=e.d;if(r[a]<s||n[a]<0){const i=t,r=e.midStartIndex;if(i<r){const t=e.leftNode;void 0!==t?this.intersectRayBSP(t,i,r):this.intersectRayTriangleRange(i,r)}}if(this.intersectRayTriangleRange(e.midStartIndex,e.rightStartIndex),r[a]>s||n[a]>0){const t=e.rightStartIndex,r=i;if(t<r){const i=e.rightNode;void 0!==i?this.intersectRayBSP(i,t,r):this.intersectRayTriangleRange(t,r)}}}get estimatedMemoryUsage(){return this.triangleVertexIndices.byteLength+this.indices.byteLength}}Cy.numFacesTested=0;const Py=Object(F["f"])(),Ay=[1/0,1/0,1/0],My=[-1/0,-1/0,-1/0];function Ry(e,t,i,r,n,a){let s=i,o=r;for(;s<o;){const i=e[s];t[6*i+n+3]<=a?++s:(--o,e[s]=e[o],e[o]=i)}let c=s;for(o=r;c<o;){const i=e[o-1];t[6*i+n]>=a?--o:(e[o-1]=e[c],e[c]=i,++c)}return{next:s,mid:c}}function Ey(e,t,i,r){if(r<=i)return Object(Fu["t"])(NaN,NaN,NaN,NaN,NaN,NaN);{const r=6*e[i];for(let e=0;e<3;++e)Ay[e]=t[r+0+e],My[e]=t[r+3+e]}for(let n=i+1;n<r;++n){const i=6*e[n];for(let e=0;e<3;++e)Ay[e]=Math.min(Ay[e],t[i+0+e]),My[e]=Math.max(My[e],t[i+3+e])}return Object(Fu["t"])(Ay[0],Ay[1],Ay[2],My[0],My[1],My[2])}function Dy(e){const t=e[3]-e[0],i=e[4]-e[1],r=e[5]-e[2],n=t>i?t>r?0:i>r?1:2:i>r?1:r>t?2:0;return{axis:n,midValue:(e[n]+e[n+3])/2}}function Iy(e,t,i,r,n){const a=i-t,s=new Float32Array(6*a);for(let o=0;o<a;++o){const i=3*(o+t),a=e[i+0]*n,c=e[i+1]*n,l=e[i+2]*n;for(let e=0;e<3;++e){const t=r[a+e],i=r[c+e],n=r[l+e];s[6*o+e]=Math.min(t,i,n),s[6*o+3+e]=Math.max(t,i,n)}}return s}function Fy(e,t,i,r){const n=r-i;let a=0;for(let o=i;o<r;++o)for(let e=0;e<3;++e)a=Math.max(t[3*o+e],a);const s=a<=zy?new Uint16Array(3*n):new Uint32Array(3*n);for(let o=0;o<n;++o){const r=3*(e[o]+i);for(let e=0;e<3;++e){const i=t[r+e];s[3*o+e]=i}}return s}const zy=65535;var Ly=i("d272"),Vy=i("df77"),ky=i("572a"),Uy=i("87b7");class By extends Yt["a"]{constructor(){super(...arguments),this.useStencil=!1}initializeProgram(e){const t=By.shader.get(),i=this.configuration,r=t.build({overlayMode:i.overlayMode,output:i.output,viewingMode:e.viewingMode,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,textureFadingEnabled:i.textureFadingEnabled&&!i.renderOccluded,hasBackgroundColor:i.hasBackgroundColor,useGrid:i.useGrid,receiveShadows:i.receiveShadows&&!i.renderOccluded,receiveAmbientOcclusion:!1,atmosphere:i.atmosphere,tileBorders:i.tileBorders,screenSizePerspective:i.screenSizePerspective,pbrMode:0,ssrEnabled:i.ssrEnabled,highStepCount:!1});return new ei["a"](e.rctx,r,Jt["a"])}initializePipeline(){return this._stencilPipelineState=this.createPipeline(!0),this.createPipeline(!1)}createPipeline(e){const t=this.configuration,i=t.backfaceCullingEnabled&&!t.renderOccluded;return Object(ti["g"])({blending:t.renderOccluded?Object(ti["i"])(1,771):null,culling:i&&ti["b"],depthTest:!t.renderOccluded&&{func:513},depthWrite:!t.renderOccluded&&ti["e"],colorWrite:ti["d"],stencilTest:e?Object(Uy["c"])(1):null})}getPipelineState(e,t){return this.useStencil?this._stencilPipelineState:super.getPipelineState(e,t)}}By.shader=new Xt["a"](ky["a"],()=>i.e("chunk-2d0dacb2").then(i.bind(null,"6cb1")));class Ny extends Kt["a"]{constructor(){super(...arguments),this.output=0,this.overlayMode=0,this.atmosphere=!1,this.receiveShadows=!1,this.slicePlaneEnabled=!1,this.backfaceCullingEnabled=!1,this.stencilEnabled=!1,this.textureFadingEnabled=!1,this.hasBackgroundColor=!1,this.useGrid=!1,this.renderOccluded=!1,this.ssrEnabled=!1,this.tileBorders=!1,this.screenSizePerspective=!1}}Object(h["a"])([Object(Kt["b"])({count:8})],Ny.prototype,"output",void 0),Object(h["a"])([Object(Kt["b"])({count:3})],Ny.prototype,"overlayMode",void 0),Object(h["a"])([Object(Kt["b"])()],Ny.prototype,"atmosphere",void 0),Object(h["a"])([Object(Kt["b"])()],Ny.prototype,"receiveShadows",void 0),Object(h["a"])([Object(Kt["b"])()],Ny.prototype,"slicePlaneEnabled",void 0),Object(h["a"])([Object(Kt["b"])()],Ny.prototype,"backfaceCullingEnabled",void 0),Object(h["a"])([Object(Kt["b"])()],Ny.prototype,"stencilEnabled",void 0),Object(h["a"])([Object(Kt["b"])()],Ny.prototype,"textureFadingEnabled",void 0),Object(h["a"])([Object(Kt["b"])()],Ny.prototype,"hasBackgroundColor",void 0),Object(h["a"])([Object(Kt["b"])()],Ny.prototype,"useGrid",void 0),Object(h["a"])([Object(Kt["b"])()],Ny.prototype,"renderOccluded",void 0),Object(h["a"])([Object(Kt["b"])()],Ny.prototype,"ssrEnabled",void 0),Object(h["a"])([Object(Kt["b"])()],Ny.prototype,"tileBorders",void 0),Object(h["a"])([Object(Kt["b"])()],Ny.prototype,"screenSizePerspective",void 0);const Gy=7,qy=10,Hy=Object(Fu["h"])(),Wy=Object(Dt["e"])();let $y=class extends W["a"]{constructor(e){super(e),this.type=2,this.isGround=!0,this.tileSize=256,this.rctx=null,this._isTransparent=!1,this._scaleRangeQueries=new ty,this.renderDataPool=new Ep["a"](Jv),this._patchGroups=new Fh["a"]({allocator:e=>e||{root:null,origin:null,patches:new Fh["a"]},deallocator:e=>(e.root=null,e.origin=null,e.patches.clear(),e)}),this.patchGroupsDirty=!0,this.patchGroupsMap=new Map,this.tileIterator=new Ov["b"],this.highestVisibleLODTile=null,this.visible=!0,this._opaque=!0,this._skirtScale=1,this._velvetOverground=!0,this.castShadows=!0,this._ssrEnabled=!1,this.emptyTex=null,this.tileRenderer=null,this.tileBackgroundInitialized=!1,this.tileBackgroundUpdating=!1,this.stencilEnabledLayerExtents=[],this.numTrianglesRendered=0,this.numTilesRendered=0,this.numTilesCulled=0,this.numOriginsRendered=0,this.overlayOpacity=1,this.needsHighlight=!1,this.renderOccludedFlags=1}get isGlobal(){return 1===this.stage.viewingMode}initialize(){const e=[1,6,8];this.stage.addRenderPlugin(e,this)}destroy(){this.stage.removeRenderPlugin(this),ev()}get updating(){return!this.tileBackgroundInitialized||this.tileBackgroundUpdating}get canRender(){return this.visible&&!!this._rootTiles&&this.tileBackgroundInitialized&&!this.renderingDisabled}set renderingDisabled(e){this._set("renderingDisabled",!!e),this.setNeedsRender()}set opaque(e){this._opaque!==e&&(this._opaque=e,this.setNeedsRender())}get needsLinearDepth(){return this.overlayRenderer.hasWater}get opaque(){return this._opaque&&!this.shaderTechniqueConfig.slicePlaneEnabled}set isTransparent(e){this._isTransparent!==e&&(this._isTransparent=e,this.setNeedsRender())}get isTransparent(){return this._isTransparent}set skirtScale(e){e!==this._skirtScale&&(this._skirtScale=e,this.setNeedsRender())}get skirtScale(){return this._skirtScale}get renderPatchBorders(){return!!this.shaderTechniqueConfig.tileBorders}set renderPatchBorders(e){this.shaderTechniqueConfig.tileBorders!==e&&(this.shaderTechniqueConfig.tileBorders=e,this.setNeedsRender(),this.notifyChange("renderPatchBorders"))}get cullBackFaces(){return this.shaderTechniqueConfig.backfaceCullingEnabled}set cullBackFaces(e){this.shaderTechniqueConfig.backfaceCullingEnabled!==e&&(this.shaderTechniqueConfig.backfaceCullingEnabled=e,this.notifyChange("cullBackFaces"),this.setNeedsRender())}set renderOrder(e){this._set("renderOrder",e),this.setNeedsRender()}set velvetOverground(e){this._velvetOverground!==e&&(this._velvetOverground=e,this.setNeedsRender())}get layerUid(){return og["b"]}get slicePlaneEnabled(){return this.shaderTechniqueConfig.slicePlaneEnabled}set slicePlaneEnabled(e){this.shaderTechniqueConfig.slicePlaneEnabled!==e&&(this.shaderTechniqueConfig.slicePlaneEnabled=e,this.setNeedsRender())}set textureFadingEnabled(e){this.shaderTechniqueConfig.textureFadingEnabled!==e&&(this.shaderTechniqueConfig.textureFadingEnabled=e,this.setNeedsRender())}setDebugScreenSizePerspective(e){this.shaderTechniqueConfig.screenSizePerspective!==e&&(this.shaderTechniqueConfig.screenSizePerspective=e,this.setNeedsRender())}setRootTiles(e){this._rootTiles=e,this.setNeedsRender()}setNeedsHighlight(e){this.needsHighlight=e,this.setNeedsRender()}setRenderOccludedOverlay(e){this.renderOccludedFlags=e?Fg["c"]:1,this.setNeedsRender()}setStencilEnabledLayerExtents(e){this.stencilEnabledLayerExtents=e,this.setNeedsRender()}setTileSize(e){this.tileSize=e,this.tileRenderer&&(this.tileRenderer.tileSize=e),this.setNeedsRender()}loadTile(e){e.renderData||(e.renderData=this.renderDataPool.acquire(),e.renderData.init(e),e.renderData.localOrigin=this._getLocalOriginOfTile(e)),this.updateTileGeometry(e),this.updateTileTexture(e,128)}queryVisibleLevelRange(e,t,i,r){this._scaleRangeQueries.queryVisibleLevelRange(e,t,i,r),this.setNeedsRender()}updateTileTexture(e,t){this.tileRenderer&&this.tileBackgroundInitialized&&(this.tileRenderer.updateTileTexture(e,128===t?0:2),this.setNeedsRender(),e.resetPendingUpdate(t))}updateTileGeometry(e){for(const t of e.layerInfo[0])t.pendingUpdates&=-33;e.resetPendingUpdate(32),e.renderData.updateGeometry(this.rctx,this.wireframe)&&this.setNeedsRender()}unloadTile(e){e.renderData&&(e.renderData.releaseGeometry()&&this.setNeedsRender(),this.renderDataPool.release(e.renderData),e.renderData.clear(),e.renderData=null,e.setMemoryDirty(),this.setNeedsRender())}_getLocalOriginOfTile(e){const t=qy-Gy,i=Math.max(0,Math.floor((e.level-t)/Gy)*Gy);if(this.isGlobal&&0===i)return F["c"];for(;e.parent&&e.level>i;)e=e.parent;return e.centerAtSeaLevel}setVisibility(e){this.visible=e,this.setNeedsRender()}getStats(){return{numTilesRendered:this.numTilesRendered,numTilesCulled:this.numTilesCulled,numTrianglesRendered:this.numTrianglesRendered,numOriginsRendered:this.numOriginsRendered}}set wireframe(e){this._get("wireframe")!==e&&(this._set("wireframe",e),this.allTiles.forAll(t=>{var i;return null==(i=t.renderData)?void 0:i.updateGeometry(this.rctx,e)}),this.setNeedsRender())}setNeedsRender(e=1){this.patchGroupsDirty=!0,this.context.requestRender(e)}setTileBackground(e){this.tileBackground=e,this._updateTileBackground()}initializeRenderContext(e){this.context=e,this.rctx=e.renderContext.rctx,this.shaderTechniques=e.shaderTechniqueRep,this.shaderTechniqueConfig=new Ny,this.tileRenderer=new fy(this.rctx,this.tileSize,this.shaderTechniques),this.tileBackground&&this._updateTileBackground(),this.emptyTex=Object(ai["c"])(this.rctx)}uninitializeRenderContext(){null!=this.emptyTex&&(this.emptyTex.dispose(),this.emptyTex=null),this.tileRenderer&&(this.tileRenderer.dispose(),this.tileRenderer=null)}intersect(e,t,i,r){if(!this._rootTiles||e.options.selectOpaqueTerrainOnly&&e.options.selectionMode&&!this._opaque)return;const n=Jy,a=eO;Object(Et["m"])(n,r,i),Object(Et["z"])(a,1/n[0],1/n[1],1/n[2]);const s=e.results.min,o=e.results.max,c=e.results.ground,l=0===e.options.store,d=!!e.results.ground.target,h=Object(og["e"])(e.verticalOffset),u=this._skirtScale,p=e.tolerance;let f,b=l&&Object(w["l"])(s.dist)?s.dist:1/0;const m=d=>{const m=d.renderData;if(null==m)return;const g=m.geometryInfo;Object(Fu["C"])(Hy,g.boundingBox);const v=m.localOrigin;Object(w["l"])(h)&&(h.localOrigin=v,h.applyToAabb(Hy));const y=-u*g.skirtLength;if(0!==y){const e=d.up;Object(Fu["p"])(Hy,y*e[0],y*e[1],y*e[2])}const O=Hy;if(tO[0]=i[0]-v[0],tO[1]=i[1]-v[1],tO[2]=i[2]-v[2],!Object(Qg["g"])(O,tO,a,p,b))return;const _=(e,t,i)=>{e.set(this.type,d,t,i,Vt["a"]),b=l&&Object(w["l"])(s.dist)?s.dist:1/0},x=(a,l)=>{if(Object(w["l"])(l)&&a>=0&&(e.options.backfacesTerrain||Object(Et["k"])(l,n)<0)&&(e.options.invisibleTerrain||!e.options.selectionMode||null==t||t(i,r,a))){if((null==c.dist||a<c.dist)&&_(c,a,l),e.options.isFiltered)return;2===e.options.store&&(Object(w["k"])(f)?(f=Object(Xn["c"])(e.ray),_(f,a,l),e.results.all.push(f)):a<f.dist&&_(f,a,l)),(null==s.dist||a<s.dist)&&_(s,a,l),0!==e.options.store&&(null==o.dist||a>o.dist)&&_(o,a,l)}},j=iO;Object(Et["m"])(j,r,v);const S=g.indices,T=g.vertexAttributes,C={data:T.getField("position",Xv["u"]).typedBuffer,size:3,stride:T.stride/4},P=g.numWithoutSkirtIndices/3;if(!Object(w["l"])(h)&&P>Oy){const e=d.renderData;Object(w["l"])(e.intersectionData)||(e.intersectionData=new Cy(S,0,P,C)),e.intersectionData.intersectRay({r0:tO,r1:j},x)}else Object(Qg["j"])(tO,j,0,P,S,C,null,h,x);if(0!==y){const e=S.length/3;if(this.isGlobal){const t=e-P;if(!Object(w["l"])(h)&&t>Oy){const i=d.renderData;if(!Object(w["l"])(i.skirtIntersectionData)){const r=pv(S,P,e,T,y,v);i.skirtIntersectionData=new Cy(r.indices,0,t,{data:r.vertices,stride:3})}i.skirtIntersectionData.intersectRay({r0:tO,r1:j},x)}else uv(tO,j,P,e,S,T,y,v,h,x)}else fv(tO,j,P,e,S,T,y,h,x)}},g=this._rootTiles;Object(w["l"])(g)&&(()=>{const t=this.tileIterator;t.reset(g);const r=e.options.invisibleTerrain;for(;!t.done;){const e=t.next();!(e.visible||r&&e.intersectsClippingArea)||!Object(w["l"])(h)&&!e.intersectsRay(i,n,p,b,u)||d&&this._useStencilForTile(e)?t.skipSubtree():m(e)}})()}render(e){if(8===e.slot){if(0==(e.renderOccludedMask&Fg["c"]))return!1}else{const t=this.opaque?1:6;if(e.slot!==t)return!1}const t=e.pass,i=1===e.scenelightingData.globalFactor,r=this._updatePatchGroups();let n=!1;switch(t){case 0:{const t=e.shadowMap&&e.shadowMap.enabled;this.shaderTechniqueConfig.receiveShadows!==t&&(this.shaderTechniqueConfig.receiveShadows=t);const i=this.overlayRenderer.isEmpty()?0:this.overlayRenderer.hasWater?2:1;this.shaderTechniqueConfig.overlayMode!==i&&(this.shaderTechniqueConfig.overlayMode=i);const a=8===e.slot?3:1;this._renderMaterialPass(e,0,r,a),n=!0;break}case 4:case 6:this.castShadows&&i&&(this._renderAuxiliaryPass(e,3,r,0),n=!0);break;case 2:this.isTransparent&&this.overlayRenderer.isEmpty()||(this._renderAuxiliaryPass(e,1,r,0),n=!0);break;case 3:this._renderAuxiliaryPass(e,2,r,0),n=!0;break;case 5:this.needsHighlight&&(this._renderAuxiliaryPass(e,4,r,2),e.rctx.clearSafe(256),n=!0)}return this._scaleRangeQueries.hasPendingQueries()&&this.setNeedsRender(),n}_renderMaterialPass(e,t,i,r){const{rctx:n,camera:a}=e;this._ssrEnabled=e.ssrParams.ssrEnabled,this._setTerrainTechnique(t,3===r);const s=this._shaderTechnique.program;n.useProgram(s),0!==this.shaderTechniqueConfig.overlayMode&&1===r&&e.ssrParams&&Object(Vy["b"])(s,e.ssrParams),e.shadowMap.bind(s),e.ssaoHelper.bind(s,e.camera),this._bindOverlayData(s,r),s.setUniformMatrix4fv("viewNormal",a.viewInverseTransposeMatrix),Object(Ji["c"])(s,a.projectionMatrix),e.scenelightingData.setUniforms(s,!0);const o=a.viewMatrix;Object(Et["z"])(Ky,o[12],o[13],o[14]),Object(Et["u"])(Ky,Ky),s.setUniform3fv("viewDirection",Ky),this.numTilesRendered=0,this.numTilesCulled=0,this.numTrianglesRendered=0,this.numOriginsRendered=0,this._scaleRangeQueries.prepareQueries(),this.opaque?this._renderPatchGroups(e,s,i,r):e.offscreenRenderingHelper.renderToTargets(()=>this._renderPatchGroups(e,s,i,r),e.offscreenRenderingHelper.tmpColor,e.offscreenRenderingHelper.mainDepth,[0,0,0,0]),this._scaleRangeQueries.processQueries()}_renderAuxiliaryPass(e,t,i,r){this._setTerrainTechnique(t,3===r);const n=e.rctx,a=this._shaderTechnique.program;if(n.useProgram(a),5===e.pass){const t=e.offscreenRenderingHelper;a.bindTexture(t.depthTexture,"depthTex"),a.setUniform4f("highlightViewportPixelSz",0,0,1/t.width,1/t.height)}else a.setUniformMatrix4fv("viewNormal",e.camera.viewInverseTransposeMatrix),2!==e.pass&&4!==e.pass&&6!==e.pass||a.setUniform2fv("nearFar",e.camera.nearFar);this._renderPatchGroupsAuxiliary(e,a,i,r)}_updateTileBackground(){if(!this.tileRenderer)return;this.tileBackgroundUpdating=!0;const e=()=>{this.tileBackgroundInitialized=!0,this.tileBackgroundUpdating=!1,this.shaderTechniqueConfig.useGrid=this.tileRenderer.backgroundIsGrid,this.shaderTechniqueConfig.hasBackgroundColor=!this.tileRenderer.backgroundIsGrid&&!!Object(w["l"])(this.tileRenderer.backgroundColor),this.allTiles.forAll(e=>this.tileRenderer.updateTileTexture(e,0)),this.setNeedsRender()};if("string"==typeof this.tileBackground){const t=this.tileBackground;Object(Wi["a"])(t).then(i=>{t===this.tileBackground&&this.tileRenderer&&(this.tileRenderer.setBackground(i,this.tileBackground===J["a"]),e())})}else{const t=this.tileBackground?gt["a"].toUnitRGBA(this.tileBackground):[0,0,0,0];this.tileRenderer.setBackground(t,!1),e()}}_updatePatchGroups(){const e=this._patchGroups;if(!this.patchGroupsDirty)return e;if(this.highestVisibleLODTile=null,this._renderCollectOrigins(e),0!==this.renderOrder){for(let t=0;t<e.length;t++)Object(Ov["g"])(this.renderOrder,e.data[t].patches);e.sort((e,t)=>Qy(e,t,this.renderOrder))}return this.patchGroupsDirty=!1,e}_renderCollectOrigins(e){const t=this._rootTiles;if(Object(w["k"])(t))return;const i=this.isGlobal;e.clear();for(const r of t){const t=e.pushNew();t.root=r,t.origin=i?F["c"]:r.centerAtSeaLevel,t.patches.clear(),this._renderCollectOriginsForRoot(e,t)}e.filterInPlace(e=>e.patches.length>0)}_renderCollectOriginsForRoot(e,t){const i=this.tileIterator;i.resetOne(t.root);const r=this.patchGroupsMap;for(r.clear(),r.set(t.origin,t);!i.done;){const t=i.next(),n=t.renderData;if(!n||t.visible){if(t.level%Gy==0){const i=e.pushNew();i.root=t,i.origin=t.centerAtSeaLevel,r.set(t.centerAtSeaLevel,i),i.patches.clear()}if(t.rendered){if(n){const e=r.get(n.localOrigin);e&&e.patches.push(t),(!this.highestVisibleLODTile||t.vlevel>this.highestVisibleLODTile.vlevel)&&(this.highestVisibleLODTile=t),i.skipSubtree()}}else this.numTilesCulled++}else this.numTilesCulled++,i.skipSubtree()}}_useStencilForTile(e){for(const t of this.stencilEnabledLayerExtents)if(e.intersectsExtent(t))return!0;return!1}_renderPatchGroupsAuxiliary(e,t,i,r){const n=e.rctx;this._shaderTechnique.useStencil=!1,this._shaderTechnique.bindPipelineState(n,e.slot);const a=this.stencilEnabledLayerExtents.length>0;t.setUniformMatrix4fv("proj",e.camera.projectionMatrix),t.setUniform1f("skirtScale",this._skirtScale),0!==r&&this._bindOverlayData(t,r);for(let s=0;s<i.length;s++){const n=i.data[s];this._bindPatchGroupData(t,n,e.camera.eye,e.camera.viewMatrix);for(let i=0;i<n.patches.length;i++)this._renderPatch(e,t,n.patches.data[i],4,a,r)}e.rctx.bindVAO(null)}_renderPatchGroups(e,t,i,r){const n=e.rctx,a=e.camera,s=a.viewMatrix;if(this._shaderTechnique.useStencil=!1,this._shaderTechnique.bindPipelineState(n,e.slot),this.shaderTechniqueConfig.screenSizePerspective&&this.pointsOfInterest){const e=Object(Yh["d"])(this.stage.viewingMode,this.ellipsoidRadius),i=this.pointsOfInterest.centerOnSurfaceFrequent.distance;e.update({distance:i,fovY:a.fovY}),Object(Qg["a"])(e,t,"screenSizePerspective")}const o=this.stencilEnabledLayerExtents.length>0,c=3===r;c&&(t.bindTexture(this.emptyTex,"tex"),t.setUniform1f("blend",1),t.setUniform4fv("texOffsetAndScale",Dt["b"]));const l=Object(w["l"])(this.tileRenderer.backgroundColor)?this.tileRenderer.backgroundColor:F["c"];this.shaderTechniqueConfig.hasBackgroundColor&&t.setUniform3fv("backgroundColor",l);const d=c?0:this._skirtScale;t.setUniform1f("skirtScale",d);const h=this.wireframe?1:4;this.shaderTechniqueConfig.textureFadingEnabled&&t.bindTexture(this.emptyTex,"texNext");for(let u=0;u<i.length;u++){const n=i.data[u],l=n.patches;this._bindPatchGroupData(t,n,a.eye,s);const d=e.sliceHelper&&e.sliceHelper.plane;Object(Ly["b"])(t,this._shaderTechnique.configuration,d,n.origin),e.shadowMap&&e.shadowMap.bindView(t,n.origin),this.numOriginsRendered++;for(let i=0;i<l.length;i++){const n=l.data[i],a=n.renderData.textureReference;if(Object(w["k"])(a))continue;if(!c){this._scaleRangeQueries.scaleQueriesForTile(n),Xy(n.renderData.geometryInfo.uvOffsetAndScale,a.offsetAndScale,Wy),t.setUniform4fv("texOffsetAndScale",Wy),t.bindTexture(a.texture.texture,"tex");const e=n.renderData.textureFadeFactor,i=e<1?n.renderData.nextTextureReference:null;this.shaderTechniqueConfig.textureFadingEnabled&&Object(w["l"])(i)&&e<1?(Xy(n.renderData.geometryInfo.uvOffsetAndScale,i.offsetAndScale,Wy),t.setUniform1f("fadeFactor",e),t.setUniform4fv("nextTexOffsetAndScale",Wy),t.setUniform3fv("nextTexOpacities",i.opacities),t.bindTexture(i.texture.texture,"texNext")):t.setUniform1f("fadeFactor",1),n.renderData.textureIsFading&&this.setNeedsRender(),t.setUniform3fv("textureOpacities",a.opacities)}const s=this._renderPatch(e,t,n,h,o,r);n.renderOrder=this.numTilesRendered,this.numTilesRendered++,this.numTrianglesRendered+=s/3}}n.bindVAO(null)}_renderPatch(e,t,i,r,n,a){if(Object(w["k"])(i.renderData.vao.indexBuffer))return 0;0!==a&&this._bindOverlayPatchData(t,i.renderData.overlay),n&&(this._shaderTechnique.useStencil=this._useStencilForTile(i),this._shaderTechnique.bindPipelineState(e.rctx,e.slot));const s=0===this._skirtScale?i.renderData.geometryInfo.numWithoutSkirtIndices:i.renderData.vao.indexBuffer.size;return e.rctx.bindVAO(i.renderData.vao),t.assertCompatibleVertexAttributeLocations(i.renderData.vao),e.rctx.drawElements(r,s,i.renderData.vao.indexBuffer.indexType,0),s}_bindPatchGroupData(e,t,i,r){e.setUniform3fv("origin",t.origin),Object(Lt["b"])(Yy,r,t.origin),e.setUniformMatrix4fv("view",Yy),e.setUniform3f("camPos",i[0]-t.origin[0],i[1]-t.origin[1],i[2]-t.origin[2])}_bindOverlayData(e,t){if(0===this.shaderTechniqueConfig.overlayMode)return;e.setUniform1f("overlayOpacity",this.overlayOpacity);const i=this.overlayRenderer.overlays;if(i.length>0){const r=i[0],n=r.getColorTexture(t);if(e.bindTexture(Object(w["l"])(n)?n:this.emptyTex,"ovColorTex"),2===this.shaderTechniqueConfig.overlayMode){const i=r.getNormalTexture(t);e.bindTexture(Object(w["l"])(i)?i:this.emptyTex,"ovWaterTex")}}}_bindOverlayPatchData(e,t){e.setUniform4fv("overlayTexOffset",t.offsets),e.setUniform4fv("overlayTexScale",t.scales)}_setTerrainTechnique(e,t){this.shaderTechniqueConfig.output=e,0===e&&(this.shaderTechniqueConfig.atmosphere=this.isGlobal&&this._velvetOverground,this.shaderTechniqueConfig.ssrEnabled=this._ssrEnabled),this.shaderTechniqueConfig.renderOccluded=t,this.shaderTechniqueConfig.stencilEnabled=!1,this._shaderTechnique=this.shaderTechniques.releaseAndAcquire(By,this.shaderTechniqueConfig,this._shaderTechnique)}get test(){return{tileRenderer:this.tileRenderer}}};Object(h["a"])([Object(M["b"])()],$y.prototype,"tileBackgroundInitialized",void 0),Object(h["a"])([Object(M["b"])()],$y.prototype,"tileBackgroundUpdating",void 0),Object(h["a"])([Object(M["b"])({constructOnly:!0})],$y.prototype,"overlayRenderer",void 0),Object(h["a"])([Object(M["b"])({constructOnly:!0})],$y.prototype,"stage",void 0),Object(h["a"])([Object(M["b"])({readOnly:!0})],$y.prototype,"isGlobal",null),Object(h["a"])([Object(M["b"])({constructOnly:!0})],$y.prototype,"allTiles",void 0),Object(h["a"])([Object(M["b"])({constructOnly:!0})],$y.prototype,"ellipsoidRadius",void 0),Object(h["a"])([Object(M["b"])({readOnly:!0})],$y.prototype,"updating",null),Object(h["a"])([Object(M["b"])({value:!1})],$y.prototype,"renderingDisabled",null),Object(h["a"])([Object(M["b"])()],$y.prototype,"renderPatchBorders",null),Object(h["a"])([Object(M["b"])()],$y.prototype,"cullBackFaces",null),Object(h["a"])([Object(M["b"])({value:1})],$y.prototype,"renderOrder",null),Object(h["a"])([Object(M["b"])()],$y.prototype,"wireframe",null),$y=Object(h["a"])([Object(D["a"])("esri.views.3d.terrain.TerrainRenderer")],$y);const Zy=$y;function Qy(e,t,i){return 0===e.patches.length?-i:0===t.patches.length?i:Object(Ov["c"])(e.patches.data[0],t.patches.data[0],i)}function Xy(e,t,i){const r=e[0]*t[2]+t[0],n=e[1]*t[3]+t[1],a=e[2]*t[2],s=e[3]*t[3];Object(zh["l"])(i,r,n,a,s)}const Yy=Object(Vt["d"])(),Ky=Object(F["f"])(),Jy=Object(F["f"])(),eO=Object(F["f"])(),tO=Object(F["f"])(),iO=Object(F["f"])();class rO{constructor(){this.numNodes=0,this.numLeaves=0,this.numVisible=0,this.numRendered=0,this.numSplit=0,this.numMerged=0,this.numRenderedPerLevel=new Array,this.numLoadedPerLevel=new Array}}var nO=i("ee83");let aO=class extends W["a"]{constructor(e){super(e),this._handles=new $["a"]}initialize(){this._handles.add(this.layers.on("change",()=>this._update())),this._handles.add(this.extentHelper.watch("layerViewsExtent",()=>this._setAdHocTilingScheme())),this._update(),this.tilingSchemeLocked||this._setAdHocTilingScheme()}destroy(){this._handles=Object(w["e"])(this._handles),this._waitTask=null}_update(){if(this._waitTask=null,this.tilingSchemeLocked)return;let e;if(this._set("tilingSchemeDone",!1),this.layers.some(t=>!(!Object(G["c"])(t)||t.isRejected())&&!(t.isFulfilled()&&!sO(t,this.viewSpatialReference,this.viewingMode))&&(e=t,!Object(xm["m"])(t)&&!Object(xm["h"])(t))),e)if(e.isResolved()){const t=Object(xm["d"])(e,this.viewSpatialReference,this.viewingMode);if(Object(w["l"])(t)){const e=new nO["a"](t.tileInfo);this._set("tilingSchemeDone",!0),this._lockTilingScheme(e)}}else this._updateWhen(e);else this._set("tilingSchemeDone",!0)}_updateWhen(e){const t=e.when().catch(()=>{}).then(()=>{t!==this._waitTask||this.destroyed||this._update()});this._waitTask=t}_lockTilingScheme(e){if(1===this.viewingMode){const t=e.levels.length-1;e.spatialReference.isWebMercator?e=nO["a"].makeWebMercatorAuxiliarySphere(t):Object(L["a"])(e.spatialReference)&&(e=nO["a"].makeGCSWithTileSize(e.spatialReference,e.pixelSize,t))}this.tilingSchemeLocked=!0,this.tilingScheme=e,this.extentHelper.tilingScheme=this.tilingScheme,this._updateTiledLayerExtent(),this._handles.removeAll(),this._handles.add(this.extentHelper.watch("tiledLayersExtent",()=>this._updateTiledLayerExtent()))}_updateTiledLayerExtent(){this._set("extent",this.extentHelper.tiledLayersExtent)}_setAdHocTilingScheme(){if(1===this.viewingMode){const e=this.extentHelper.viewSpatialReference,t=Object(L["a"])(e)||Object(It["i"])(e)||Object(It["j"])(e);e.isWebMercator?this.tilingScheme=nO["a"].WebMercatorAuxiliarySphere:t&&(this.tilingScheme=nO["a"].makeGCSWithTileSize(e,256)),this._set("extent",this.extentHelper.layerViewsExtent)}else{const e=this.extentHelper.layerViewsExtent;Object(w["l"])(e)&&!Object(V["p"])(e,this.extent)&&(this.tilingScheme=nO["a"].fromExtent(e,this.extentHelper.viewSpatialReference),this._set("extent",e))}}get test(){return{lockTilingScheme:e=>this._lockTilingScheme(e),done:!this._waitTask}}};function sO(e,t,i){return Object(w["l"])(Object(xm["d"])(e,t,i))}Object(h["a"])([Object(M["b"])()],aO.prototype,"tilingScheme",void 0),Object(h["a"])([Object(M["b"])({readOnly:!0})],aO.prototype,"extent",void 0),Object(h["a"])([Object(M["b"])({value:!1})],aO.prototype,"tilingSchemeLocked",void 0),Object(h["a"])([Object(M["b"])({readOnly:!0,value:!1})],aO.prototype,"tilingSchemeDone",void 0),Object(h["a"])([Object(M["b"])({constructOnly:!0})],aO.prototype,"viewSpatialReference",void 0),Object(h["a"])([Object(M["b"])({constructOnly:!0})],aO.prototype,"layers",void 0),Object(h["a"])([Object(M["b"])({constructOnly:!0})],aO.prototype,"extentHelper",void 0),Object(h["a"])([Object(M["b"])({constructOnly:!0})],aO.prototype,"viewingMode",void 0),aO=Object(h["a"])([Object(D["a"])("esri.views.3d.terrain.TilingSchemeLogic")],aO);class oO{constructor(){this.offset=Object(Ut["b"])(),this.scale=0,this.tile=null}init(e,t,i,r){this.tile=e,this.offset[0]=t,this.offset[1]=i,this.scale=r}dispose(){this.tile=null,this.offset[0]=0,this.offset[1]=0,this.scale=0}}const cO=j["a"].getLogger("esri.views.3d.terrain.TerrainSurface"),lO=.25;let dO=class extends(Z["a"].EventedMixin(W["a"])){constructor(e){super(e),this._elevationBounds=new xg,this._iteratorPool=new Ep["a"](Ov["b"],e=>e.remove=()=>this._iteratorPool.release(e)),this._postorderIterator=new Ov["a"],this._hasPendingUpdates=!1,this._pendingUpdates=0,this._asyncWorkItems=0,this._allTilesDirty=!0,this._allTilesSorted=!0,this._visible=!1,this._usedMemory=bO,this._performanceInfo=new rO,this._viewChanged=!1,this._inFrameTask=!1,this._viewChangeUpdateDirty=!1,this._eyePosRenderSR=Object(F["f"])(),this._eyePosSurfaceSR=Object(F["f"])(),this._splitLimits=new Lv,this._snapLevel=1/0,this._frustum=Object(Dp["c"])(),this._viewProjectionMatrix=Object(Vt["d"])(),this._layerViews=[new Array,new Array],this._layerIndexByUid=[new Map,new Map],this._basemapLayerViewHandles=new Map,this._handles=new $["a"],this._watchUpdatingTracking=new Mr["a"],this._frameTask=Fi["a"],this._allTiles=new Fh["a"],this._upsampleInfoPool=new Ep["a"](oO),this._rootTilesExtent=Object(V["m"])(),this._maxNumUpdating=1,this.maxTextureScale=1.2,this.backgroundImage=J["a"],this.backgroundColor=null,this._layerViewsDirty=!1}initialize(){this._lercDecoder=Object(vg["a"])(this.view.resourceController),this._tilePool=this.view.state.isLocal?new Ep["a"](Hv):new Ep["a"]($v);const e=this.view.resourceController.memoryController;this._upsampleMapCache=e.newCache("esri.views.3d.terrain.upsample",e=>e.unloadMapData()),this._elevationQueryCache=new gg(e.newCache("elevation-query")),this._set("overlayManager",new Ug({surface:this})),this._handles.add([this.watch("overlayManager.hasHighlights",e=>this._renderer.setNeedsHighlight(e)),this.watch("overlayManager.rendersOccluded",e=>this._renderer.setRenderOccludedOverlay(e))],"overlayManager"),this._renderer=new Zy({overlayRenderer:this.overlayManager.renderer,ellipsoidRadius:Object(zt["e"])(this.view.spatialReference).radius,stage:this.view._stage,allTiles:this._allTiles}),this._handles.add([Object(C["a"])(this,"baseOpacity",e=>{this._handleLayerViewChanges(),this._updateBaseOpacity(e)},!0),Object(C["a"])(this,"_background",()=>{this._handleLayerViewChanges(),this._renderer.setTileBackground(this._background)},!0),this.view.watch("pointsOfInterest",e=>{this._renderer.pointsOfInterest=e,this._watchUpdatingTracking.removeAll(),e&&this._watchUpdatingTracking.add(e.focus,"renderLocation",()=>()=>this._allTilesSorted=!1)}),Object(C["a"])(Lh["a"],"TERRAIN_TILE_TREE_SHOW_TILES",e=>{e&&!this._treeDebugger?i.e("chunk-5d24f1e4").then(i.bind(null,"2944")).then(({TerrainTileTree3DDebugger:e})=>{!this._treeDebugger&&Lh["a"].TERRAIN_TILE_TREE_SHOW_TILES&&(this._treeDebugger=new e({view:this.view}))}):e||(this._treeDebugger=Object(w["e"])(this._treeDebugger))})]),this._extentHelper=Sg(this.viewingMode,{layers:this.view.map.allLayers,layerViews:this.view.allLayerViews,viewSpatialReference:this.view.spatialReference});const t=this.view.defaultsFromMap?new fg["a"]({getCollections:()=>{var e,t,i;return null==(e=this.view)||null==(t=e.defaultsFromMap)||null==(i=t.mapCollections)?void 0:i.map(({layers:e})=>e)},getChildrenFunction:e=>e&&"layers"in e?e.layers:null}):this.view.map.allLayers,r=new aO({layers:t,extentHelper:this._extentHelper,viewingMode:this.viewingMode,viewSpatialReference:this.view.spatialReference});this._set("tilingSchemeLogic",r),this._updateTilingScheme(),this._elevationDataRequester=this.view.resourceController.createStreamDataRequester(0),this._mapDataRequester=this.view.resourceController.createStreamDataRequester(1);const n=this.view.resourceController.scheduler;this._frameTask=n.registerTask(Fi["b"].TERRAIN_SURFACE,this),this.view.resourceController.memoryController.events.on("quality-changed",()=>this._viewChangeUpdate()),this._handles.add([Object(C["a"])(this._extentHelper,"stencilEnabledExtents",e=>this._renderer.setStencilEnabledLayerExtents(e)),this.tilingSchemeLogic.watch("tilingScheme",()=>this._updateTilingScheme(),!0),Object(C["a"])(this,"extent",()=>this._updateRootTiles()),this.view.on("resize",()=>this._viewChangeUpdate()),this.view.watch("state.camera",()=>this._viewChangeUpdate(),!0),this.view.watch("state.contentCamera",()=>this.view.state.fixedContentCamera&&this._viewChangeUpdate(),!0),this.view.watch("qualitySettings.tiledSurface.lodBias",()=>this._viewChangeUpdate()),Object(C["a"])(this.view,"qualitySettings.tiledSurface.textureFadeDuration",e=>this._renderer.textureFadingEnabled=e>0),this.view.watch("lodSnapping",()=>this._viewChangeUpdate()),Object(Ft["b"])(()=>this._userClippingExtent,()=>this._updateClippingExtent(),Ft["d"])]),this._handles.add(this.view.allLayerViews.on("after-changes",()=>this._layerViewsDirty=!0)),this._layerViewsDirty=!0,this._handleLayerViewChanges()}destroy(){this._frameTask.remove(),this._handles.destroy(),this._watchUpdatingTracking.destroy(),this._lercDecoder=Object(w["s"])(this._lercDecoder),this._removeAllTiles(),this._upsampleMapCache=Object(w["e"])(this._upsampleMapCache),this._elevationQueryCache=Object(w["e"])(this._elevationQueryCache),this._set("tilingSchemeLogic",Object(w["e"])(this.tilingSchemeLogic)),this._extentHelper=Object(w["e"])(this._extentHelper),this._basemapLayerViewHandles.forEach((e,t)=>this._unregisterTiledLayerView(t)),this._elevationDataRequester=null,this._mapDataRequester=null,this._set("overlayManager",Object(w["e"])(this.overlayManager)),this._tilePool=Object(w["e"])(this._tilePool),Vv.prune(),this._treeDebugger&&(this._treeDebugger.destroy(),this._treeDebugger=null),this._renderer=Object(w["e"])(this._renderer),this._iteratorPool=Object(w["e"])(this._iteratorPool),this._set("view",null),this._upsampleInfoPool=Object(w["e"])(this._upsampleInfoPool),Object(yg["b"])(),Rv()}get renderer(){return this._renderer}get frustum(){return this._frustum}get snapLevel(){var e,t;const i=null==(e=this.view.pointsOfInterest)||null==(t=e.contentCameraOnSurface)?void 0:t.scale;if(i){const e=this.view.state.contentCamera;let t=nd(this.view,e.eye,e.viewForward,e.up).tilt;t>90&&(t=180-t);const r=2*(t/90)**2,n=_d(this.view,i)-r;Math.abs(this._snapLevel-n)>lO&&(Math.round(n)!==Math.round(this._snapLevel)&&(this._viewChanged=!0),this._snapLevel=n)}return Math.round(this._snapLevel)}get lodSnapping(){return this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences?1:0}get upsampleInfoPool(){return this._upsampleInfoPool}get upsampleMapCache(){return this._upsampleMapCache}get elevationQueryCache(){return this._elevationQueryCache}get mapTileRequester(){return this._mapDataRequester}get _userClippingExtent(){const{spatialReference:e}=this,{clippingArea:t}=this.view;if(Object(w["k"])(t)||Object(w["k"])(e))return null;const i=Object(V["m"])(),r=Object(nf["b"])(t,i,e)?i:null,n=this._get("extent");return Object(V["p"])(r,n)?n:r}get extent(){const e=Object(V["w"])(this.groundExtent,this._userClippingExtent,Object(V["m"])()),t=this._get("extent");return Object(V["p"])(e,t)?t:e}get groundExtent(){return Object(w["v"])(this._tilingSchemeExtent,this._rootTilesExtent)}get _tilingSchemeExtent(){var e;return null==(e=this.tilingSchemeLogic)?void 0:e.extent}get updating(){return this._hasPendingUpdates||(this._maxNumUpdating=1),!!((this._watchUpdatingTracking.updating||this._hasPendingUpdates||this._viewChanged||this._allTilesDirty||this._asyncWorkItems>0||!this._allTilesSorted||this._renderer.updating||this._layerViewsDirty)&&this.ready&&!this.suspended||this.overlayManager.updating||this._frameTask.updating)}get updatingProgressValue(){return this._maxNumUpdating=Math.max(this._pendingUpdates,this._maxNumUpdating),1-this._pendingUpdates/this._maxNumUpdating}get viewingMode(){return this.view.state.viewingMode}get ready(){return Object(w["l"])(this.rootTiles)}set renderOrder(e){this._renderer.renderOrder=e,this._set("renderOrder",e)}set skirtScale(e){this._renderer.skirtScale=e}get skirtScale(){return this._renderer.skirtScale}get spatialReference(){var e,t;return null!=(e=null==(t=this.tilingScheme)?void 0:t.spatialReference)?e:null}get _background(){return null!=this.backgroundColor?this.backgroundColor:this.backgroundImage}set slicePlaneEnabled(e){var t,i;this._renderer.slicePlaneEnabled=e,this._set("slicePlaneEnabled",e),null==(t=this.view)||null==(i=t._stage)||i.renderView.setRenderParameters({opaqueTerrain:this.opaque})}set velvetOverground(e){e!==this.velvetOverground&&(this._renderer.velvetOverground=e),this._set("velvetOverground",e)}set visible(e){e!==this._visible&&(this._visible=e,this._renderer.setVisibility(e),this.suspended=!e)}get opaque(){return this._renderer.opaque}set suspended(e){this._set("suspended",e),this._viewChangeUpdate()}intersect(e,t,i,r){this._renderer.intersect(e,t,i,r)}getElevation(e,t,i,r){const n=mO,a=this.getTileWithElevation(e,t,i,r,n);return Object(w["k"])(a)?null:jg.sample(n[0],n[1],a.renderData.geometryState.samplerData)}getTileWithElevation(e,t,i,r,n=mO){var a;const s=this.rootTiles;if(Object(w["k"])(s)||!s.length)return null;if(0===s[0].layerInfo[0].length)return null;if(n[0]=e,n[1]=t,n[2]=i,!Object(L["y"])(n,r,n,null==(a=this.tilingScheme)?void 0:a.spatialReference))return cO.error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null;for(let o of s){if(!o.containsPoint(n))continue;for(;o&&!o.rendered&&!o.isLeaf;){let e=0;n[0]>.5*(o.extent[0]+o.extent[2])&&(e+=1),n[1]<.5*(o.extent[1]+o.extent[3])&&(e+=2),o=o.children[e]}const e=o.renderData;return e&&e.geometryState&&e.geometryState.samplerData?o:null}return null}get elevationBounds(){return this._elevationBounds}getScale(e){if(this.tilingScheme){if(!Object(L["t"])(e,mO,this.spatialReference))return cO.error("TerrainSurface.getScale(): could not project given point to tiling scheme coordinate system"),null;const t=this.rootTiles;if(Object(w["l"])(t))for(let e of t)if(e.containsPoint(mO)){for(;null!=e.children[0];){let t=0;mO[0]>e.children[0].extent[2]&&(t+=1),mO[1]<e.children[0].extent[1]&&(t+=2),e=e.children[t]}return this._getLodBiasCorrectedScale(e.level)}}return 1e100}getSphereScale(e,t){if(!this.tilingScheme)return null;if(!Object(L["t"])(e,mO,this.spatialReference))return cO.error("TerrainSurface.getSphereScale(): could not project given point to tiling scheme coordinate system"),null;mO[3]=t;let i=null;const r=e=>{if(e&&Object(V["y"])(e.extent,mO))if(null!=e.children[0])for(const t of e.children)r(t);else{const t=this._getLodBiasCorrectedScale(e.level);i=null==i?t:Math.min(i,t)}},n=this.rootTiles;if(Object(w["l"])(n))for(const a of n)r(a);return i}queryVisibleScaleRange(e,t,i,r){const n=t?this.tilingScheme.levelAtScale(t):0,a=i?this.tilingScheme.levelAtScale(i):1/0,s=this.lodBias;this._renderer.queryVisibleLevelRange(e,n+s,a+s,r)}_updateBaseOpacity(e){const t=this._renderer.opaque;this._renderer.opaque=e>=1,this._renderer.isTransparent=this._allTransparentSurfaceLayers();const i=t===this._renderer.opaque?2:1;var r,n;1===i&&(null==(r=this.view)||null==(n=r._stage)||n.renderView.setRenderParameters({opaqueTerrain:this.opaque})),this._updateTileTextures(i)}_updateTilingScheme(){const e=this.tilingSchemeLogic.tilingScheme;e!==this.tilingScheme&&(Object(xm["s"])(!!e,"tiling scheme cannot be reset to undefined"),this.tilingScheme&&this._removeAllTiles(),this._set("tilingScheme",e),this._updateClippingExtent(),e&&(this._updateTiledLayers(),this._renderer.setTileSize(e.pixelSize),this.overlayManager.setSpatialReference(e.spatialReference),this._updateRootTiles()))}_acquireTile(e,t,i,r){const n=this._tilePool.acquire();return vO[0]=e,vO[1]=t,vO[2]=i,n.init(vO,r,this),n}_updateRootTiles(){const{extent:e,tilingScheme:t}=this;if(!t)return;const i=gO;let r=t.rootTilesInExtent(e,i,5*J["g"]);if(Object(w["l"])(this.rootTiles)){if(r.length>J["g"])return void cO.warn(J["i"]);const e=this.rootTiles.map(e=>e.lij),t=Object(R["d"])(e,r,uO);if(t.removed.length>0||t.added.length>0){const e=this.rootTiles.filter(e=>!(t.removed.findIndex(t=>uO(t,e.lij))>-1)||(this._purgeTile(e),!1));t.added.forEach(t=>e.push(this._newRootTile(t))),this._setRootTiles(e)}}else r.length>J["g"]&&(cO.warn(J["j"]),r=t.rootTilesInExtent(e,i,J["g"])),this._setRootTiles(r.map(e=>this._newRootTile(e)));Object(V["p"])(i,this._rootTilesExtent)||(this._rootTilesExtent=Object(V["m"])(i)),this.visible=!0,this._viewChangeUpdate(),this.overlayManager.setPlacementDirty(),this.notifyChange("ready")}_newRootTile(e){const t=this._acquireTile(0,e[1],e[2],null);return 2===t.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.lodSnapping)&&t.setPendingUpdate(2),this._loadTile(t),t}_setRootTiles(e){if(this._set("rootTiles",e),this._allTiles.clear(),Object(w["l"])(e)){const t=this._iteratorPool.acquire();for(t.reset(e);!t.done;)this._allTiles.push(t.next());t.remove()}this._renderer.setRootTiles(this.rootTiles),this._updateTilesVisibility(e)}_runViewChangeUpdateIfDirty(){this._viewChangeUpdateDirty&&(this._viewChangeUpdateDirty=!1,this._viewChangeUpdate())}_viewChangeUpdate(){this.view&&!this.suspended&&this.tilingScheme&&this._visible&&(this._inFrameTask?this._viewChangeUpdateDirty=!0:(this._viewChangeUpdateDirty=!1,this._updateViewDependentParameters(),this._updateSkirts(),this._updateTilesVisibility(this.rootTiles)))}_updateClippingStatus(e){e.updateClippingStatus(this.extent)&&e.resetPendingUpdate(32)&&this._updateTileGeometry(e)}_updateTilesVisibility(e){if(Object(w["k"])(e))return;const t=Object(Ov["f"])(e);let i=t?this._elevationBounds.min:1/0,r=t?this._elevationBounds.max:-1/0;const n=this.view.state.fixedContentCamera,a=this.extent,s=this._viewProjectionMatrix;this.setTileTreeDirty();const o=this._iteratorPool.acquire();for(o.reset(e);!o.done;){const e=o.next();e.updateClippingStatus(a)&&e.resetPendingUpdate(32)&&this._updateTileGeometry(e),e.setPendingUpdate(16);const t=e.updateVisibilityNow();n||t?(e.updateScreenDepth(s),e.renderData&&(i=Math.min(e.elevationBounds[0],i),r=Math.max(e.elevationBounds[1],r))):o.skipSubtree()}o.remove(),this._viewChanged=!0,this._allTilesDirty=!0,isFinite(i)&&isFinite(r)&&(this._elevationBounds.min===i&&this._elevationBounds.max===r||(this._elevationBounds.min=i,this._elevationBounds.max=r,this.emit("elevation-bounds-change",null)))}_updateViewDependentParameters(){const e=this.view.state.camera,t=this.view.state.contentCamera,i=Math.tan(.5*t.fovX),r=Math.tan(.5*t.fovY),n=this.tilingScheme.pixelSize,a=2**-this.lodBias*e.pixelRatio;this._splitLimits.aboveGround=e.aboveGround,this._splitLimits.fovX=i,this._splitLimits.fovY=r,this._splitLimits.relativeWidthLimit=n/e.width*this.maxTextureScale*a,this._splitLimits.relativeHeightLimit=n/e.height*this.maxTextureScale*a,this._splitLimits.maxLod=this.tilingScheme.getMaxLod(),this._splitLimits.angledSplitBias=this.view.qualitySettings.tiledSurface.angledSplitBias,this.view.state.fixedContentCamera?(Object(w["k"])(this._splitLimits.frustum)&&(this._splitLimits.frustum=Object(Dp["c"])()),Object(Dp["b"])(t.frustum,this._splitLimits.frustum)):this._splitLimits.frustum=null,Object(Dp["b"])(e.frustum,this._frustum),Object(Lt["n"])(this._viewProjectionMatrix,t.projectionMatrix,t.viewMatrix),Object(Et["n"])(this._eyePosRenderSR,t.eye),Object(L["y"])(e.eye,this.view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)}_updateSkirts(){const e=this.view.state.camera,t=this.view.state.constraints.collision.enabled?0:1.11*e.near;this.skirtScale=Object(xm["b"])(this,this._eyePosSurfaceSR,t)}_updateRenderData(e){e.rendered&&!e.shouldLoad&&(pO(e)?this._loadChildren(e):fO(e)&&this._loadParent(e))}_updateTileGeometry(e){e.updateVisibility(),this._renderer.updateTileGeometry(e),this._elevationUpdate(e),this._usedMemory=bO}_updateTileTexture(e,t){const i=e.resetPendingUpdate(128)?128:!!e.resetPendingUpdate(64)&&64;i&&(this._renderer.updateTileTexture(e,i),this._usedMemory=bO,t.madeProgress())}_elevationUpdate(e){OO.spatialReference=this.spatialReference,OO.tile=e,OO.extent=e.extent,this.emit("elevation-change",OO),Object(V["h"])(e.extent,this._eyePosSurfaceSR)&&this._updateSkirts()}get running(){return this.updating&&this.ready&&!this.suspended}runTask(e){this._handleLayerViewChanges(e),this._frameTask.processQueue(e),this._inFrameTask=!0,this._pendingUpdates=0,this._hasPendingUpdates=!1,this._updateTileStatus(e),this._sortTiles(e);const t=!this.view.state.fixedContentCamera;this._mergeAndSplit(e,t),e.run(()=>this._updateElevation(e)),e.run(()=>this._updateTextures(e)),t||this._mergeAndSplit(e,!0),this._inFrameTask=!1,this._runViewChangeUpdateIfDirty(),e.done&&this.requestUpdate(),this.notifyChange("updatingProgressValue")}_updateTileStatus(e){if(!this._viewChanged||!this.rootTiles||e.done)return;this._viewChanged=!1;const t=this._iteratorPool.acquire();for(t.reset(this.rootTiles);!t.done;){const e=t.next();if(e.loadable){const i=e.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.lodSnapping);if(2===i){e.resetPendingUpdate(8),e.isLeaf&&(e.setPendingUpdate(2),t.skipSubtree());continue}e.resetPendingUpdate(2)&&e.updateAgentSuspension(),4===i&&e.updateAgents(0)}if(t.skipSubtree(),!e.isLeaf){e.setPendingUpdate(8),e.resetPendingUpdate(2);const t=this._iteratorPool.acquire();t.resetOne(e);for(let e=t.next();!t.done;e=t.next())this._updateClippingStatus(e),e.updateVisibility(),e.loadable&&e.updateScreenDepth(this._viewProjectionMatrix);t.remove()}}t.remove(),this.requestUpdate(),e.madeProgress()}_sortTiles(e){e.done||this._allTilesSorted||(Object(Ov["h"])(this._allTiles,this.view.pointsOfInterest.focus.renderLocation),this._allTilesSorted=!0,this._treeDebugger&&this._treeDebugger.update(),e.madeProgress())}_mergeAndSplit(e,t){if(this.suspended||e.done||!this._allTilesDirty)return;this._allTilesDirty=!1,this.requestUpdate();let i=0;for(;!e.done;){let r=!1;i=0;const n=!this._allTiles.some(n=>{if(i+=n.usedMemory,n.resetPendingUpdate(8)){if(!t)return n.setPendingUpdate(8),e.done;this._mergeTile(n),r=!0,e.madeProgress()}else n.resetPendingUpdate(2)&&(this._splitTile(n),r=!0,e.madeProgress());return!e.done&&n.resetPendingUpdate(16)&&(this._updateRenderData(n),e.madeProgress()),e.done});if(r&&(this._allTilesSorted=!1,this._allTilesDirty=!0),n){if(this._usedMemory=i,!r)break;this._updateTilesVisibility(this.rootTiles)}else this._allTilesDirty=!0}0===i&&(this._allTilesDirty=!0),this._sortTiles(e)}_updateElevation(e){return this._allTiles.some(t=>(t.resetPendingUpdate(32)&&(this._updateTileGeometry(t),this._updateTileTexture(t,e),e.madeProgress()),e.done)),e.hasProgressed}_updateTextures(e){return this._allTiles.some(t=>(this._updateTileTexture(t,e),e.done)),e.hasProgressed}_updateClippingExtent(){this.spatialReference&&(this.updateTileOverlayParams(1),this.overlayManager.setPlacementDirty(),this._updateRootTiles())}get lodBias(){const e=this.view.resourceController.memoryController.memoryFactor;return this.view.qualitySettings.tiledSurface.lodBias-(1-e)*J["e"]}_getLodBiasCorrectedScale(e){const t=this.tilingScheme.levels,i=Object(Oe["f"])(e-this.lodBias,0,t.length-1),r=i-Math.floor(i);return t[Math.floor(i)].scale*(1-r)+t[Math.ceil(i)].scale*r}_removeAllTiles(){Object(w["l"])(this.rootTiles)&&(this.rootTiles.forEach(e=>this._purgeTile(e)),this._setRootTiles(null),this.notifyChange("ready")),this._allTiles.clear(),this.visible=!1}_purgeChildTiles(e){if(e.isLeaf)return!1;let t=this._purgeTile(e.children[0]);return t=this._purgeTile(e.children[1])||t,t=this._purgeTile(e.children[2])||t,t=this._purgeTile(e.children[3])||t,e.unsetChildren(),t}_purgeTile(e){const t=this._purgeChildTiles(e)||e.rendered;return this._allTiles.removeUnordered(e),e.unload(this._renderer),this._tilePool.release(e),t}_splitTile(e){Object(xm["s"])(e.isLeaf,"tile that is already split should not be split again!");const t=e.level+1,i=2*e.lij[1],r=2*e.lij[2];e.setChildren(this._createTile(t,i,r,e),this._createTile(t,i,r+1,e),this._createTile(t,i+1,r,e),this._createTile(t,i+1,r+1,e)),e.setPendingUpdate(16),e.updateAgentSuspension(),this._allTiles.pushArray(e.children),this._allTilesDirty=!0,this._emitTileScaleChange(e,t),++this._performanceInfo.numSplit}_emitTileScaleChange(e,t=e.level){_O.spatialReference=this.spatialReference,_O.extent=e.extent,_O.scale=this._getLodBiasCorrectedScale(t),this.emit("scale-change",_O)}_createTile(e,t,i,r){Object(xm["s"])(!!r,"_createTile sanity check");const n=this._acquireTile(e,t,i,r);return n.updateClippingStatus(this.extent),n.loadable&&(n.updateScreenDepth(this._viewProjectionMatrix),2===n.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.lodSnapping)&&n.setPendingUpdate(2)),n}_mergeTile(e){Object(xm["s"])(!e.hasPendingUpdate(2),"_mergeTile sanity check"),this._purgeChildTiles(e)&&(Object(xm["s"])(!e.renderData,"_mergeTile sanity check"),this._loadTile(e)),this._allTilesDirty=!0,++this._performanceInfo.numMerged,this._emitTileScaleChange(e)}_loadChildren(e){Object(xm["s"])(e.rendered,"parent should be rendered"),e.unload(this._renderer),this._loadTile(e.children[0]),this._loadTile(e.children[1]),this._loadTile(e.children[2]),this._loadTile(e.children[3])}_loadParent(e){const t=e.parent;this._unloadChildren(t),this._loadTile(t)}_unloadChildren(e){e.isLeaf||(this._unloadChildren(e.children[0]),e.children[0].unload(this._renderer),this._unloadChildren(e.children[1]),e.children[1].unload(this._renderer),this._unloadChildren(e.children[2]),e.children[2].unload(this._renderer),this._unloadChildren(e.children[3]),e.children[3].unload(this._renderer))}_loadTile(e){e.load(this._renderer),e.setPendingUpdate(16),this.requestUpdate(),this._allTilesDirty=!0,this.overlayManager&&this.overlayManager.hasOverlays&&this.overlayManager.setTileParameters(e),this._elevationUpdate(e)}_elevationDataArrived(e,t,i){const r=new jg(e.lij,e.extent,i);e.dataArrived(t,0,r);const n=[e],a=e.level,s=this._iteratorPool.acquire();for(s.reset(n);!s.done;){const e=s.next();e.findElevationBoundsForLayer(t,a),e.computeElevationBounds()}s.remove(),this._updateTilesVisibility(n)}_handleLayerViewChanges(e=Fi["d"]){if(!this._layerViewsDirty)return;this._layerViewsDirty=!1;let t=!1;const i=new Set;let r=-1;for(const n of this.view.allLayerViews.items)if(i.add(n.uid),Object(xm["j"])(n))if(this._basemapLayerViewHandles.has(n.uid)){const e=this.layerClassFromLayerView(n),i=this._layerIndexByUid[e].get(n.uid);i<r&&(t=!0),r=i}else this._registerTiledLayerView(n),n.layer.loaded&&(t=!0);this._basemapLayerViewHandles.forEach((e,r)=>{i.has(r)||(this._unregisterTiledLayerView(r),t=!0)}),t&&this._updateTiledLayers(),this._renderer.isTransparent=this._allTransparentSurfaceLayers(),e.madeProgress()}_allTransparentSurfaceLayers(){let e=0===this.view.map.ground.opacity;for(const t of this.view.allLayerViews.items)if(Object(xm["j"])(t)&&!Object(xm["e"])(t)&&!Object(G["b"])(t.layer)&&0!==t.fullOpacity)return e=!1,e;return e}layerClassFromLayerView(e){return Object(xm["e"])(e)?0:1}_registerTiledLayerView(e){const t=[],i=this.layerClassFromLayerView(e);t.push(e.watch("suspended",()=>this._updateTiledLayers())),t.push(e.watch("fullOpacity",()=>this._updateTileTextures(2))),t.push(e.layer.watch("scaleRangeId",()=>this._restartAllAgents(i))),e.on("data-changed",()=>{const t=this._layerIndexByUid[i].get(e.uid);null!=t&&this._invalidateLayerData(t,i)}),this._basemapLayerViewHandles.set(e.uid,t)}_unregisterTiledLayerView(e){const t=this._basemapLayerViewHandles.get(e);if(t){for(let e=0;e<t.length;e++)t[e].remove();this._basemapLayerViewHandles.delete(e)}}_updateTiledLayers(){if(!this.tilingScheme||this.view.suspended)return;const e=this.view.allLayerViews,t=[[],[]];let i=null;const r=Object(V["o"])();e.forEach(e=>{const n=e.layer;if(!n||e.suspended||!Object(xm["j"])(e))return;const a=e.fullExtent;if(!a)return void cO.warn("Terrain: Map or elevation layer does not have fullExtent: "+n.id);if(!this.tilingScheme.compatibleWith(e.tileInfo))return void cO.warn("Terrain: tiling scheme of layer "+n.id+" is incompatible with other tiled layers, will not be drawn");Object(V["q"])(r,a,r);const s=this.layerClassFromLayerView(e);if(1===s){const t=e.displayLevelRange;t.maxLevel!==1/0&&(null===i||t.maxLevel>i)&&(i=t.maxLevel)}t[s].push(e)});for(const n of Ag){const e=this._layerViews[n],i=t[n];i.reverse();const r=i.length;let a=e.length!==r;const s=new Array(r),o=new Array(e.length);this._layerIndexByUid[n].clear();for(let t=0;t<r;t++){const r=i[t].uid;this._layerIndexByUid[n].set(r,t);const c=e.indexOf(i[t]);s[t]=c,t!==c&&(a=!0),c>-1&&(o[c]=t)}if(a){const e=this._postorderIterator;for(e.reset(this.rootTiles);!e.done;)e.next().modifyLayers(o,s,n);this._layerViews[n]=i,this._restartAllAgents(n),this._updateTilesVisibility(this.rootTiles)}}this.tilingScheme.ensureMaxLod(i)&&this._viewChangeUpdate()}_restartAllAgents(e){const t=this._postorderIterator;for(t.reset(this.rootTiles);!t.done;){const i=t.next();i.restartAgents(e),0===e&&i.computeElevationBounds()}}layerViewByIndex(e,t){return this._layerViews[t][e]}numLayers(e){return this._layerViews[e].length}_updateTileTextures(e){this._allTiles.forAll(t=>{t.updateAgents(1),1===e?this.renderer.updateTileTexture(t,64):t.updateRenderData(1,e)}),this._renderer.isTransparent=this._allTransparentSurfaceLayers()}_invalidateLayerData(e,t){this._allTiles.forAll(i=>i.removeLayerAgent(e,t)),this._allTiles.forAll(i=>i.invalidateLayerData(e,t))}setTileTreeDirty(){this._allTilesDirty=!0}requestRender(e=1){this.renderer.setNeedsRender(e)}requestUpdate(){1==++this._pendingUpdates&&(this._hasPendingUpdates=!0)}requestTileData(e,t,i,r){const n=this.layerViewByIndex(t,i),a=n.layer;return!a.tilemapCache||Object(xm["n"])(n)?this._requestTileData(e,i,n,r):(++this._asyncWorkItems,a.tilemapCache.fetchAvailability(e.lij[0],e.lij[1],e.lij[2],{...r,timeout:6e3}).then(()=>--this._asyncWorkItems).catch(t=>{throw--this._asyncWorkItems,Object(S["m"])(t)||this._dataMissing(e,i,n,{notInTilemap:!0}),t}).then(()=>this._frameTask.schedule(()=>this._requestTileData(e,i,n,r),r.signal)))}_requestTileData(e,t,i,r){return 0===t?this._requestElevationTileData(e,i,r):this._requestMapTileData(e,i,r)}_requestElevationTileData(e,t,i){if(!Object(xm["e"])(t))return void Object(xm["s"])(!1,"_requestElevationTileData can only be called for elevation layer views");const r=r=>{if(--this._asyncWorkItems,Object(S["n"])(i))return;const n=this._layerIndexByUid[0].get(t.uid);null!=n?(this._usedMemory=bO,this.requestUpdate(),this._elevationDataArrived(e,n,r)):cO.warn("TerrainSurface: received data from unknown layer %d %s",0,e.lij.toString())},n=i=>{--this._asyncWorkItems,Object(S["m"])(i)||(this._dataMissing(e,0,t,i),this.requestUpdate())};if(++this._asyncWorkItems,Object(xm["r"])(t.layer))return t.layer.fetchTile(e.lij[0],e.lij[1],e.lij[2],{noDataValue:J["b"],signal:i.signal}).then(e=>{if(Object(S["n"])(i))return cO.warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true."),void n(Object(S["e"])());this._frameTask.schedule(()=>r(e),i.signal,n)},n);const a=t.getTileUrl(e.lij[0],e.lij[1],e.lij[2]);return this._elevationDataRequester.request(a,"binary",i).then(e=>this._lercDecoder.decode(e,{noDataValue:J["b"]},i.signal)).then(e=>{r({values:e.pixelData,width:e.width,height:e.height,noDataValue:e.noDataValue,minValue:e.minValue,maxValue:e.maxValue})},n)}_requestMapTileData(e,t,i){if(t instanceof Og["default"])return Promise.reject();++this._asyncWorkItems;const r=(r,n)=>{--this._asyncWorkItems,Object(xm["p"])(n),Object(S["n"])(i)||(this._dataMissing(e,1,t,r),this.requestUpdate())},n=e=>t=>r(t,e),a=r=>this._frameTask.schedule(()=>{--this._asyncWorkItems,this.requestUpdate(),Object(S["n"])(i)?Object(xm["p"])(r):this._mapTileDataArrived(e,t,r)},i.signal,n(r)).catch(n(r)),s=(e,t=null)=>this._frameTask.schedule(()=>r(e,t));if(Object(xm["n"])(t)){const r=t.schemaHelper.getLevelRowColumn(e.lij);return t.fetchTile(r[0],r[1],r[2],i).then(a,s)}if(Object(xm["f"])(t))return t.fetchTile(e.lij[0],e.lij[1],e.lij[2],i).then(a,s);if(Object(xm["l"])(t)&&Object(xm["r"])(t.layer))return t.layer.fetchTile(e.lij[0],e.lij[1],e.lij[2],i).then(e=>{if(Object(S["n"])(i))return cO.warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true."),void s(Object(S["e"])());a(e)},s);let o=t.getTileUrl(e.lij[0],e.lij[1],e.lij[2]);Object(mg["b"])(t.layer)&&t.layer.refreshTimestamp&&(o+=`${o.includes("?")?"&":"?"}_ts=${t.layer.refreshTimestamp}`);const c=t.hasMixedImageFormats?"image+type":"image";return this._mapDataRequester.request(o,c,i).then(a,s)}_mapTileDataArrived(e,t,i){const r=this._layerIndexByUid[1].get(t.uid);null!=r?e.dataArrived(r,1,i):(Object(xm["p"])(i),cO.warn("TerrainSurface: received data from unknown layer"))}_dataMissing(e,t,i,r){const n=this._layerIndexByUid[t].get(i.uid);null!=n?e.dataMissing(n,t,r):cO.warn("TerrainSurface: received data from unknown layer")}updateTileOverlayParams(e){this.rootTiles&&this.overlayManager&&(this._allTiles.forAll(e=>{e.renderData&&this.overlayManager.setTileParameters(e)}),this._renderer.setNeedsRender(e))}get performanceInfo(){const e=this._performanceInfo;return e.numNodes=this._allTiles.length,e.numLeaves=e.numVisible=e.numRendered=e.numLoadedPerLevel.length=e.numRenderedPerLevel.length=0,this._allTiles.forAll(t=>{t.isLeaf&&e.numLeaves++;const i=t.level;t.renderData&&(e.numLoadedPerLevel[i]=(e.numLoadedPerLevel[i]||0)+1),t.visible&&(e.numVisible++,t.rendered&&(e.numRenderedPerLevel[i]=(e.numRenderedPerLevel[i]||0)+1,e.numRendered++))}),e}getUsedMemory(){return this.tilingScheme?(this._usedMemory===bO&&(this._usedMemory=0,this._allTiles.forAll(e=>this._usedMemory+=e.usedMemory)),this._usedMemory):0}getUsedMemoryForLayerView(e){let t=0;const i=this.layerClassFromLayerView(e),r=this._layerIndexByUid[i].get(e.uid);return this._allTiles.forAll(e=>t+=e.getUsedMemoryForLayer(i,r)),t}getTile(e){if(Object(w["k"])(e)||Object(w["k"])(this.rootTiles))return null;const t=e.split("/").map(e=>+e);if(0===t[0])return this.rootTiles.find(e=>e.lij[1]===t[1]&&e.lij[2]===t[2]);const i=2**t[0],r=Math.floor(t[1]/i),n=Math.floor(t[2]/i);let a;if(this.rootTiles.some(e=>e.lij[1]===r&&e.lij[2]===n&&(a=e,!0)),a){let e=1<<t[0]-1;for(;a.lij[0]<t[0];){let i=t[1]&e?2:0;if((t[2]&e)>0&&i++,!a.children[i])return null;a=a.children[i],e>>=1}return Object(xm["s"])(a.lij[0]===t[0]&&a.lij[1]===t[1]&&a.lij[2]===t[2],"not the right tile?"),a}return null}get test(){const e=this;return{renderer:e._renderer,lercDecoder:e._lercDecoder,forceReload:()=>{Object(w["l"])(e.rootTiles)&&(e._mergeTile(e.rootTiles[0]),e._viewChangeUpdate())},getTiles:()=>e._allTiles.toArray(),getRenderedTiles:()=>(yO.clear(),e._allTiles.forAll(e=>{e.visible&&e.rendered&&yO.push(e)}),Object(Ov["g"])(e.renderOrder,yO),yO.toArray()),lockTilingScheme(t,i){e._extentHelper.defaultTiledLayersExtent=i,e.tilingSchemeLogic.test.lockTilingScheme(t)}}}};Object(h["a"])([Object(M["b"])()],dO.prototype,"_renderer",void 0),Object(h["a"])([Object(M["b"])()],dO.prototype,"_hasPendingUpdates",void 0),Object(h["a"])([Object(M["b"])()],dO.prototype,"_asyncWorkItems",void 0),Object(h["a"])([Object(M["b"])()],dO.prototype,"_allTilesDirty",void 0),Object(h["a"])([Object(M["b"])()],dO.prototype,"_allTilesSorted",void 0),Object(h["a"])([Object(M["b"])()],dO.prototype,"_viewChanged",void 0),Object(h["a"])([Object(M["b"])({readOnly:!0})],dO.prototype,"_watchUpdatingTracking",void 0),Object(h["a"])([Object(M["b"])()],dO.prototype,"_frameTask",void 0),Object(h["a"])([Object(M["b"])({readOnly:!0})],dO.prototype,"snapLevel",null),Object(h["a"])([Object(M["b"])({readOnly:!0})],dO.prototype,"lodSnapping",null),Object(h["a"])([Object(M["b"])({constructOnly:!0})],dO.prototype,"view",void 0),Object(h["a"])([Object(M["b"])()],dO.prototype,"_userClippingExtent",null),Object(h["a"])([Object(M["b"])()],dO.prototype,"_rootTilesExtent",void 0),Object(h["a"])([Object(M["b"])({readOnly:!0})],dO.prototype,"extent",null),Object(h["a"])([Object(M["b"])({readOnly:!0})],dO.prototype,"groundExtent",null),Object(h["a"])([Object(M["b"])({readOnly:!0})],dO.prototype,"_tilingSchemeExtent",null),Object(h["a"])([Object(M["b"])({readOnly:!0})],dO.prototype,"updating",null),Object(h["a"])([Object(M["b"])(_g["a"])],dO.prototype,"updatingProgress",void 0),Object(h["a"])([Object(M["b"])({readOnly:!0})],dO.prototype,"updatingProgressValue",null),Object(h["a"])([Object(M["b"])()],dO.prototype,"_maxNumUpdating",void 0),Object(h["a"])([Object(M["b"])({aliasOf:"view.map.ground.opacity"})],dO.prototype,"baseOpacity",void 0),Object(h["a"])([Object(M["b"])({readOnly:!0})],dO.prototype,"overlayManager",void 0),Object(h["a"])([Object(M["b"])({readOnly:!0})],dO.prototype,"viewingMode",null),Object(h["a"])([Object(M["b"])()],dO.prototype,"maxTextureScale",void 0),Object(h["a"])([Object(M["b"])({readOnly:!0})],dO.prototype,"ready",null),Object(h["a"])([Object(M["b"])({value:1})],dO.prototype,"renderOrder",null),Object(h["a"])([Object(M["b"])({readOnly:!0})],dO.prototype,"rootTiles",void 0),Object(h["a"])([Object(M["b"])({readOnly:!0})],dO.prototype,"spatialReference",null),Object(h["a"])([Object(M["b"])()],dO.prototype,"backgroundImage",void 0),Object(h["a"])([Object(M["b"])({type:gt["a"],aliasOf:"view.map.ground.surfaceColor"})],dO.prototype,"backgroundColor",void 0),Object(h["a"])([Object(M["b"])()],dO.prototype,"_background",null),Object(h["a"])([Object(M["b"])({value:!1})],dO.prototype,"slicePlaneEnabled",null),Object(h["a"])([Object(M["b"])({readOnly:!0})],dO.prototype,"tilingScheme",void 0),Object(h["a"])([Object(M["b"])({readOnly:!0,aliasOf:"tilingSchemeLogic.tilingSchemeLocked"})],dO.prototype,"tilingSchemeLocked",void 0),Object(h["a"])([Object(M["b"])({readOnly:!0,aliasOf:"tilingSchemeLogic.tilingSchemeDone"})],dO.prototype,"tilingSchemeDone",void 0),Object(h["a"])([Object(M["b"])({readOnly:!0})],dO.prototype,"tilingSchemeLogic",void 0),Object(h["a"])([Object(M["b"])({value:!0})],dO.prototype,"velvetOverground",null),Object(h["a"])([Object(bg["a"])("_renderer.wireframe")],dO.prototype,"wireframe",void 0),Object(h["a"])([Object(M["b"])({value:!1})],dO.prototype,"suspended",null),Object(h["a"])([Object(M["b"])({readOnly:!0,aliasOf:"view.qualitySettings.tiledSurface.textureFadeDuration"})],dO.prototype,"textureFadeDuration",void 0),Object(h["a"])([Object(M["b"])()],dO.prototype,"_layerViewsDirty",void 0),Object(h["a"])([Object(bg["a"])("_renderer.renderPatchBorders")],dO.prototype,"renderPatchBorders",void 0),Object(h["a"])([Object(bg["a"])("_renderer.renderingDisabled")],dO.prototype,"renderingDisabled",void 0),dO=Object(h["a"])([Object(D["a"])("esri.views.3d.terrain.TerrainSurface")],dO);const hO=dO;function uO(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function pO(e){return!e.isLeaf&&(e.children[0].shouldLoad||e.children[1].shouldLoad||e.children[2].shouldLoad||e.children[3].shouldLoad||pO(e.children[0])||pO(e.children[1])||pO(e.children[2])||pO(e.children[3]))}function fO(e){return e.isLeaf&&e.parent&&e.parent.shouldLoad}const bO=-1,mO=Object(Dt["e"])(),gO=Object(V["m"])(),vO=[0,0,0],yO=new Fh["a"],OO={spatialReference:null,tile:null,extent:null,context:"ground"},_O={spatialReference:null,extent:null,scale:0};var xO=i("70a2"),jO=i("fdc9"),wO=i("697e"),SO=i("adf1");let TO=class extends W["a"]{constructor(e){super(e),this._residentGeomRecords=new Map,this._dirtyGeomRecords=new Map,this.dirty=!1}commit(e){this.dirty=!1,this._dirtyGeomRecords.forEach((t,i)=>this.commitLayer(i,e))}commitLayer(e,t){const i=this._dirtyGeomRecords.get(e);i&&(i.forEach((i,r)=>{const n=this._ensureGeomRecord(e,r);i.forEach((e,i)=>{const a=e[0],s=e[1],o=e[2];let c=!1;if(2&s){const e=n.get(i);if(e){const i=e[1];if(4&o){const e=this.model.getObject(r);this.model.updateRenderGeometryTransformation(e,a,i)&&(c=!0)}c||t.updates.push({renderGeometry:i,updateType:o})}else Object(hr["a"])(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid update")}if(4&s||c){const e=n.get(i);e?(t.removes.push(e[1]),n.delete(i),e[0].disposed&&wO["a"].pool.release(e[0])):4===s&&Object(hr["a"])(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid remove")}if(1&s||c){const e=this.model.getObject(r);if(Object(w["l"])(e)){const r=this.model.getRenderGeometry(e,a),s=[a,r];t.adds.push(r),n.set(i,s)}}}),0===n.size&&this._residentGeomRecords.get(e).delete(r)}),0===this._residentGeomRecords.get(e).size&&this._residentGeomRecords.delete(e),this._dirtyGeomRecords.delete(e))}getResidentRenderGeometries(e,t){const i=this._residentGeomRecords.get(e);i&&i.forEach(e=>e.forEach(e=>t.push(e[1])))}_objectStateChanged(e,t){for(const i of t.geometryRecords)this._updateOrCreateDirtyRecord(t,i,null,2,0,0,2,5,e)}visibilityChanged(e){this._objectStateChanged(1,e)}highlightChanged(e){this._objectStateChanged(8,e)}occlusionChanged(e){this._objectStateChanged(16,e)}vertexAttrsUpdated(e){this._updateOrCreateDirtyRecord(e.object,e.record,null,2,0,0,2,5,2)}layerAdded(e){e.objects.forAll(t=>this._layerObjectAdded(e,t))}layerRemoved(e){e.objects.forAll(t=>this._layerObjectRemoved(e,t))}layerObjectAdded(e){this._layerObjectAdded(e.layer,e.object)}_layerObjectAdded(e,t){const i=e.id;for(const r of t.geometryRecords)this._objectGeometryAdded(t,r,i)}layerObjectRemoved(e){this._layerObjectRemoved(e.layer,e.object)}layerObjectsAdded(e){for(const t of e.objects)this._layerObjectAdded(e.layer,t)}layerObjectsRemoved(e){for(const t of e.objects)this._layerObjectRemoved(e.layer,t)}_layerObjectRemoved(e,t){const i=e.id;for(const r of t.geometryRecords)this._objectGeometryRemoved(t,r,i)}shaderTransformationChanged(e){const t=this._residentGeomRecords.get(e.id);t&&t.forEach((e,t)=>{const i=this.model.getObject(t);i&&i.hasVolativeTransformation()&&e.forEach(e=>{e[1].shaderTransformationChanged()})})}objectTransformation(e){const t=this._getParentLayerId(e),i=e.id;this._ensureGeomRecord(t,i).forEach(i=>{this._updateOrCreateDirtyRecord(e,i[0],t,2,0,0,2,5,4)})}objectGeometryAdded(e){this._objectGeometryAdded(e.object,e.record)}_objectGeometryAdded(e,t,i=null){this._updateOrCreateDirtyRecord(e,t,i,1,4,0,0,0)}objectGeometryRemoved(e){this._objectGeometryRemoved(e.object,e.record)}_objectGeometryRemoved(e,t,i=null){this._updateOrCreateDirtyRecord(e,t,i,4,1,2,0,0)}_updateOrCreateDirtyRecord(e,t,i,r,n,a,s,o,c){i=Object(w["v"])(i,this._getParentLayerId(e));const l=e.id,d=t.id,h=this._ensureDirtyRecord(i,l),u=h.get(d);if(u){const e=u[1];e&n?(h.delete(d),u[0].disposed&&wO["a"].pool.release(u[0])):e&a?(u[1]=r,u[2]=c):e&s?u[2]|=c:e&o||Object(hr["a"])(!1,"ModelDirtySet.objectGeometryAdded: inconsistent state")}else h.set(d,[t,r,c]);this.dirty=this._hasDirtyGeometryRecords}_ensureGeomRecord(e,t){let i=this._residentGeomRecords.get(e);i||(i=new Map,this._residentGeomRecords.set(e,i));let r=i.get(t);return r||(r=new Map,i.set(t,r)),r}get _hasDirtyGeometryRecords(){return Object(Ih["c"])(this._dirtyGeomRecords,e=>Object(Ih["c"])(e,e=>e&&e.size>0))}_ensureDirtyRecord(e,t){let i=this._dirtyGeomRecords.get(e);i||(i=new Map,this._dirtyGeomRecords.set(e,i));let r=i.get(t);return r||(r=new Map,i.set(t,r)),r}_getParentLayerId(e){return Object(w["l"])(e.parentLayer)?e.parentLayer.id:op["a"]}formatDebugInfo(){const e=["ADD","UPD",void 0,"REM"];let t="";return this._dirtyGeomRecords.forEach((i,r)=>{i.forEach((i,n)=>{t.length>0&&(t+="\n"),t+=r+"."+n;const a=[];i.forEach(e=>{const t=e[1];a[t]||(a[t]=[]),a[t].push(e[0].geometry.id)});for(let r=0;r<a.length;r++)if(a[r]){t+=" "+e[r-1]+": ";for(let e=0;e<a[r].length;e++)t+=a[r][e]+", "}})}),t}get test(){const e=this;return{get residentLayerCount(){return e._residentGeomRecords.size},get residentObjectCount(){return Array.from(e._residentGeomRecords.values()).reduce((e,t)=>e+t.size,0)}}}};Object(h["a"])([Object(M["b"])({constructOnly:!0})],TO.prototype,"model",void 0),Object(h["a"])([Object(M["b"])()],TO.prototype,"dirty",void 0),TO=Object(h["a"])([Object(D["a"])("esri.views.3d.webgl-engine.lib.ModelDirtySet")],TO);const CO=TO;var PO=i("6061");let AO=class extends W["a"]{constructor(){super(...arguments),this.dirtySet=new CO({model:this}),this._content=new Map,this._originFactory=new SO["a"](null,75e4)}getObject(e){return this._content.get(e)}add(e){const t=e.id;Object(hr["a"])(!this._content.has(t),"Model/Stage already contains object to be added"),this._content.set(t,e),Object(mp["b"])(e)&&this.dirtySet.layerAdded(e)}remove(e){Object(hr["a"])(this._content.has(e.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(e.id),e.unload(),Object(mp["b"])(e)&&this.dirtySet.layerRemoved(e)}addMany(e){for(const t of e)Object(w["l"])(t)&&(Object(hr["a"])(!this._content.has(t.id),"Model/Stage already contains object to be added"),this._content.set(t.id,t))}removeMany(e){for(const t of e)Object(hr["a"])(this._content.has(t.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(t.id),t.unload()}has(e){return this._content.has(e.id)}forEachOfType(e,t){this._content.forEach(i=>{i.type===e&&t(i)})}getRenderGeometry(e,t){const{geometry:i,material:r,id:n,shaderTransformation:a,origin:s,instanceParameters:o}=t,c=new PO["a"](i,r,null,null,n,i.boundingInfo,a,e.castShadow);return c.updateTransformation(i=>e.getCombinedStaticTransformation(t,i)),c.origin=s||this._originFactory.getOrigin(c.boundingSphere),c.instanceParameters=o,c}updateRenderGeometryTransformation(e,t,i){if(Object(w["k"])(e))return!1;i.updateTransformation(i=>e.getCombinedStaticTransformation(t,i));const r=this._originFactory.getOrigin(i.boundingSphere);return i.origin!==r}getStats(){const e={},t=Array.from(this._content.values());for(let i=0;i<5;++i)e[i]=t.filter(e=>e.type===i).length;return{contentTypes:e,dirtySet:this.dirtySet.formatDebugInfo()}}get test(){return{content:Array.from(this._content.values())}}};Object(h["a"])([Object(M["b"])({constructOnly:!0})],AO.prototype,"dirtySet",void 0),AO=Object(h["a"])([Object(D["a"])("esri.views.3d.webgl-engine.parts.Model")],AO);var MO=i("8c71"),RO=i("caf1"),EO=i("cee3"),DO=i("a21b");class IO{constructor(e){this._totalCount=e,this._indexRanges=[0,e]}componentCount(){const e=this._indexRanges;let t=0;for(let i=0;i<e.length;i+=2)t+=e[i+1];return t}reset(e){"all"===e||e.length===this._totalCount?this._indexRanges=[0,this._totalCount]:this._indexRanges=FO(e)}forEachComponent(e){const t=this._indexRanges;for(let i=0;i<t.length;i+=2){const r=t[i],n=r+t[i+1];for(let t=r;t<n;t++)if(!e(t))return!1}return!0}forEachComponentRange(e){const t=this._indexRanges;for(let i=0;i<t.length;i+=2){const r=t[i];if(!e(r,r+t[i+1]))return!1}return!0}computeOffsetRanges(e){const t=new Array(this._indexRanges.length),i=this._indexRanges;for(let r=0;r<i.length;r+=2){const n=i[r],a=n+i[r+1],s=e[n],o=e[a];t[r]=s,t[r+1]=o-s}return t}}function FO(e){const t=new Array;if(0===e.length)return t;let i=e[0],r=1;for(let n=1;n<e.length;n++){const a=e[n];i+r===a?r+=1:(t.push(i),t.push(r),i=a,r=1)}return t.push(i),t.push(r),t}class zO extends xO["a"]{constructor(e,t){super(),this.pickability=null,this.highlightCounts=null,this.cachedGeometryRanges=null,this.cachedHighlightRanges=null,this.cachedDefaultRanges=null,this.offsets=Object(DO["m"])(t);const i=this.count;this.visibility=new IO(i),this.materialDataBuffer=e.getBuffer(i),this.materialDataIndices=new Uint16Array(i);for(let r=0;r<i;r++)this.materialDataIndices[r]=this.materialDataBuffer.acquireIndex()}dispose(){super.dispose();for(let e=0;e<this.count;e++)this.materialDataBuffer.releaseIndex(this.materialDataIndices[e])}get count(){return this.offsets.length-1}get geometryRanges(){return Object(w["k"])(this.cachedGeometryRanges)&&(this.cachedGeometryRanges=this.visibility.computeOffsetRanges(this.offsets)),this.cachedGeometryRanges}get highlightRanges(){return Object(w["k"])(this.highlightCounts)?null:(this.updateCachedHighlightRanges(),this.cachedHighlightRanges)}get defaultShadowMapRanges(){return Object(w["k"])(this.highlightCounts)?this.geometryRanges:(this.updateCachedHighlightRanges(),this.cachedDefaultRanges)}highlightsDirty(){this.cachedHighlightRanges=null,this.cachedDefaultRanges=null}visibilityDirty(){this.cachedGeometryRanges=null,this.highlightsDirty()}updateCachedHighlightRanges(){if((Object(w["k"])(this.cachedHighlightRanges)||Object(w["k"])(this.cachedDefaultRanges))&&Object(w["l"])(this.highlightCounts)){const{highlightRanges:e,defaultRanges:t}=LO(this.highlightCounts,this.visibility,this.offsets);this.cachedHighlightRanges=e,this.cachedDefaultRanges=t}}}function LO(e,t,i){const r=[],n=[];let a=i.length,s=i.length;return t.forEachComponent(t=>(e[t]>0?(a!==t-1&&(r.length&&r.push(i[a+1]-r[r.length-1]),r.push(i[t])),a=t):(s!==t-1&&(n.length&&n.push(i[s+1]-n[n.length-1]),n.push(i[t])),s=t),!0)),r.length&&r.push(i[a+1]-r[r.length-1]),n.length&&n.push(i[s+1]-n[n.length-1]),{highlightRanges:r,defaultRanges:n}}class VO extends xO["a"]{constructor(){super(...arguments),this.visible=0}}function kO(e){return"function"==typeof e}function UO(e,t,i,r){if(i>=t)return e;null==e&&(e=NO());const n=e.isVisibleBit;let a=e.data;const s=qO(a),o=i/s|0,c=i-s*o,l=(t-1)/s|0,d=a,h=r===n;if(!(i<d.length*s)&&h){const e=1.5,t=o+1,i=Math.ceil(d.length*e),r=l+1;let n=Math.max(t,i);n=Math.min(n,r),a=new Uint32Array(n),a.set(d)}return o<a.length&&(a[o]=HO(a[o],c,h)),e.data=a,e}function BO(e,t){if(null==e)return!0;const{isVisibleBit:i,data:r}=e,n=qO(r);return t<r.length*n?GO(i,r,t,n):!e.isVisibleBit}function NO(e=!0){return{isVisibleBit:!e,data:new Uint32Array(0)}}function GO(e,t,i,r){const n=i/r|0,a=i-n*r;return WO(t[n],a)===e}function qO(e){const t=8;return e.BYTES_PER_ELEMENT*t}function HO(e,t,i){return e&~(1<<t)|(i?1:0)<<t}function WO(e,t){return 0!=(e&1<<t)}Object(h["a"])([Object(xO["c"])()],VO.prototype,"renderable",void 0),Object(h["a"])([Object(xO["c"])()],VO.prototype,"components",void 0);var $O=i("1038");class ZO{constructor(e,t){this._indices=Object(w["l"])(e.indices)?e.indices:Object($O["d"])(e.positions.length/3),this._positions=new Xv["u"](e.positions),this._components=t,this._componentIntersectionData=new Array(t.count)}getComponentAabb(e,t){if(Object(w["l"])(this._perComponentAabbs)){for(let i=0;i<6;i++)t[i]=this._perComponentAabbs[6*e+i];return t}return this._computePerComponentAabbs(),this.getComponentAabb(e,t)}getComponentPositions(e,t){t.indices=this._indices,t.data=this._positions.typedBuffer,t.stride=this._positions.typedBufferStride,t.startIndex=this._components.offsets[e],t.endIndex=this._components.offsets[e+1]}intersect(e,t,i,r,n,a){const s={data:this._positions.typedBuffer,stride:this._positions.typedBufferStride,size:3},o=this._indices,c=this._components.offsets,l=Object(Qg["c"])(e,t,QO);this._components.visibility.forEachComponent(d=>{if(!BO(this._components.pickability,d))return!0;const h=this.getComponentAabb(d,XO);if(Object(w["l"])(n)&&n.applyToAabb(h),!Object(Qg["f"])(h,e,l,i))return!0;const u=c[d]/3,p=c[d+1]/3,f=(e,t,i)=>{a(d,e,Object(Et["A"])(t,t,r),i)},b=p-u;return Object(w["k"])(n)&&b>Oy?(null==this._componentIntersectionData[d]&&(this._componentIntersectionData[d]=new Cy(this._indices,u,p,s)),this._componentIntersectionData[d].intersectRay({r0:e,r1:t},f)):Object(Qg["j"])(e,t,u,p,o,s,void 0,n,f),!0})}_computePerComponentAabbs(){const e=this._components.count;this._perComponentAabbs=new Float32Array(6*e);for(let t=0;t<e;t++)this._computeAABB(t)}_computeAABB(e){const t=this._indices,i=this._positions,r=this._components.offsets,n=r[e],a=r[e+1],s=[0,0,0],o=[1/0,1/0,1/0],c=[-1/0,-1/0,-1/0];for(let d=n;d<a;d++){const e=t[d];i.getVec(e,s),Object(Et["a"])(o,o,s),Object(Et["b"])(c,c,s)}let l=6*e;this._perComponentAabbs[l++]=o[0],this._perComponentAabbs[l++]=o[1],this._perComponentAabbs[l++]=o[2],this._perComponentAabbs[l++]=c[0],this._perComponentAabbs[l++]=c[1],this._perComponentAabbs[l]=c[2]}get positions(){return this._positions}get indices(){return this._indices}}const QO=Object(F["f"])(),XO=Object(Fu["h"])();class YO{constructor(e,t,i,r){this.material=e,this.drawParameters=t,this.geometry=i,this.meta=r}dispose(){this.material.dispose(),this.geometry.dispose()}}class KO extends xO["a"]{constructor(e,t,i,r){super(),this.primitiveType=t,this.parameters=i,this.indexed=r,this.vao=e}}function JO(e,t){return{near:e,far:t}}function e_(e){return e?t_(e,1/0,-1/0):JO(1/0,-1/0)}function t_(e,t,i){return e.near=t,e.far=i,e}function i_(e,t,i=e){return i.near=Math.min(e.near,t.near),i.far=Math.max(e.far,t.far),i}function r_(e,t){return e.near<=t&&t<=e.far}Object(h["a"])([Object(xO["c"])()],KO.prototype,"vao",void 0);const n_={near:0,far:0};function a_(e,t){const i=e_(),{eye:r,frustum:n,viewForward:a}=e;t.forAll(e=>{const t=e.obb,s=Object(Et["k"])(Object(Et["C"])(__,t.center,r),a),o=Object(EO["k"])(t,a);if(r_(i,s-o)&&r_(i,s+o))return;const c=v_(t,n);if(-1===c)return;if(0===c)return o_.far=s+o,o_.near=s-o,void i_(i,o_);const l=s_.pushNew();l.near=s-o,l.far=s+o,l.mask=c,l.object=e});for(let s=0;s<s_.length;s++){const e=s_.data[s];if(r_(i,e.near)&&r_(i,e.far))continue;o_.far=e.far,o_.near=1/0;const t=b_(e.object.obb,r,d_,t=>{let i=h_;for(let r=0;r<g_&&t.length>0;r++){if(0==(e.mask&1<<r))continue;u_(n[r],t,i);const a=t;t=i,i=a}for(let e=0;e<t.length;e+=3){Object(Et["z"])(c_,t.data[e+0],t.data[e+1],t.data[e+2]);const i=Object(Et["k"])(Object(Et["C"])(c_,c_,r),a);o_.near=Math.min(o_.near,i)}});0===t&&(o_.near=0),i_(i,o_)}return s_.length=0,i}const s_=new Fh["a"]({allocator:e=>e||{near:1/0,far:-1/0,mask:0,object:null},deallocator:e=>(e.object=null,e)}),o_=e_(),c_=Object(F["f"])(),l_=Object(F["f"])(),d_=new Fh["a"]({deallocator:null}),h_=new Fh["a"]({deallocator:null});function u_(e,t,i){i.length=0;const r=t.length-3;p_(c_,t,r);const n=Object(mo["v"])(e,c_);n<=0&&(i.push(c_[0]),i.push(c_[1]),i.push(c_[2]));let a=0,s=n;for(;a<r;a+=3){p_(l_,t,a);const r=Object(mo["v"])(e,l_);s*r<0&&(Object(Et["l"])(c_,l_,c_,r/(r-s)),f_(i,c_)),r<=0&&f_(i,l_),s=r,Object(Et["n"])(c_,l_)}s*n<0&&(p_(l_,t,r),Object(Et["l"])(c_,l_,c_,n/(n-s)),f_(i,c_))}function p_(e,t,i){return Object(Et["z"])(e,t.data[i+0],t.data[i+1],t.data[i+2])}function f_(e,t){e.push(t[0]),e.push(t[1]),e.push(t[2])}function b_(e,t,i,r){Object(oi["b"])(O_,e.quaternion),Object(Et["C"])(__,t,e.center),Object(Et["x"])(__,__,O_);const n=8*((__[0]<-e.halfSize[0]?-1:__[0]>e.halfSize[0]?1:0)+3*(__[1]<-e.halfSize[1]?-1:__[1]>e.halfSize[1]?1:0)+9*(__[2]<-e.halfSize[2]?-1:__[2]>e.halfSize[2]?1:0)+13),a=m_[n];if(0===a)return a;Object(Pi["h"])(y_,e.quaternion),Object(Pi["d"])(y_,y_,e.halfSize);const s=(t,i)=>{const r=m_[n+i+1];return Object(Et["z"])(t,((1&r)<<1)-1,(2&r)-1,((4&r)>>1)-1),Object(Et["A"])(t,t,y_),Object(Et["i"])(t,e.center,t)};return i.length=0,f_(i,s(x_,0)),f_(i,s(j_,1)),f_(i,s(__,2)),f_(i,s(w_,3)),r(i),1===a||(i.length=0,f_(i,x_),f_(i,w_),f_(i,s(__,4)),f_(i,s(S_,5)),r(i),2===a||(i.length=0,f_(i,x_),f_(i,S_),f_(i,s(__,6)),f_(i,j_),r(i))),a}const m_=(()=>{const e=new Int8Array(216);let t=0;const i=i=>{for(let r=0;r<i.length;r++)e[t+r]=i[r];t+=8};return i([3,0,6,2,3,1,5,4]),i([2,0,2,3,1,5,4,0]),i([3,1,0,2,3,7,5,4]),i([2,0,1,3,2,6,4,0]),i([1,0,1,3,2,0,0,0]),i([2,1,5,7,3,2,0,0]),i([3,2,0,1,3,7,6,4]),i([2,2,0,1,3,7,6,0]),i([3,3,0,1,5,7,6,2]),i([2,0,1,5,4,6,2,0]),i([1,0,1,5,4,0,0,0]),i([2,1,3,7,5,4,0,0]),i([1,0,2,6,4,0,0,0]),i([0,0,0,0,0,0,0,0]),i([1,1,3,7,5,0,0,0]),i([2,2,3,7,6,4,0,0]),i([1,2,3,7,6,0,0,0]),i([2,3,1,5,7,6,2,0]),i([3,4,0,1,5,7,6,2]),i([2,5,7,6,4,0,1,0]),i([3,5,0,1,3,7,6,4]),i([2,4,5,7,6,2,0,0]),i([1,4,5,7,6,0,0,0]),i([2,5,1,3,7,6,4,0]),i([3,6,0,2,3,7,5,4]),i([2,6,2,3,7,5,4,0]),i([3,7,6,2,3,1,5,4]),e})(),g_=4;function v_(e,t){let i=0;for(let r=0;r<g_;r++){const n=Object(EO["g"])(e,t[r]);if(n>0)return-1;0===n&&(i|=1<<r)}return i}const y_=Object(Ai["b"])(),O_=Object(ci["b"])(),__=Object(F["f"])(),x_=Object(F["f"])(),j_=Object(F["f"])(),w_=Object(F["f"])(),S_=Object(F["f"])();class T_{constructor(e){this._objects=e}submit(e,t){this._objects.preSubmit(t),this._objects.visibleObjects.forAll(t=>t.renderable.material.submit(e,t))}queryShadowCasterDepthRange(e){return this._objects.visibleObjects.length?a_(e,this._objects.visibleObjects):null}}var C_=i("7752"),P_=i("e66f"),A_=i("bc40"),M_=i("6a07"),R_=i("a7d7"),E_=i("6a21"),D_=i("7438");class I_ extends Yt["a"]{bindPass(e){const t=this.program;A_["a"].bindViewProjTransform(t,e.viewTransform),Object(Ly["b"])(this.program,this.configuration,e.slicePlane),0===e.identifier&&(void 0!==e.ssrParams&&Object(Vy["b"])(this.program,e.ssrParams),t.setUniformMatrix3fv("uTransformNormal_ViewFromGlobal",e.transformNormal_ViewFromGlobal),2===e.subPass&&t.setUniform2fv("cameraNearFar",e.cameraNearFar),0===e.subPass&&e.lighting.setUniforms(this.program,e.integratedMesh)),1===e.identifier&&this.program.setUniform2fv("cameraNearFar",e.cameraNearFar)}bindMaterial(e,t){this._material=e;const i=this.program;i.setUniform4fv("uBaseColor",e.baseColor),i.setUniform1f("uObjectOpacity",e.objectOpacity),i.setUniform1f("textureAlphaCutoff",e.alphaCutoff),1===e.componentParameters.type?e.componentParameters.texture.bind(i,"uComponentColorTex","uComponentColorTexInvDim"):(i.setUniform4fv("uExternalColor",e.componentParameters.externalColor),i.setUniform1i("uExternalColorMixMode",e.componentParameters.externalColorMixMode)),Object(w["l"])(e.baseColorTexture)&&e.baseColorTexture.bind(i,"uBaseColorTexture","uBaseColorTextureSize"),0!==this.configuration.output&&7!==this.configuration.output||(Object(R_["c"])(this.program,e,this.configuration.isSchematic),Object(w["l"])(e.metallicRoughnessTexture)&&e.metallicRoughnessTexture.bind(i,"texMetallicRoughness","texMetallicRoughnessSize"),Object(w["l"])(e.emissionTexture)&&e.emissionTexture.bind(i,"texEmission","texEmissionSize"),Object(w["l"])(e.occlusionTexture)&&e.occlusionTexture.bind(i,"texOcclusion","texOcclusionSize"),Object(w["l"])(e.normalTexture)&&e.normalTexture.bind(i,"normalTexture","normalTextureSize")),e.isIntegratedMesh&&(0===t.identifier&&0===t.subPass?(i.bindTexture(e.overlayColor,"ovColorTex"),i.bindTexture(e.overlayNormal,"ovNormalTex")):2===t.identifier&&i.bindTexture(e.overlayHighlight,"ovColorTex"),i.setUniform1f("overlayOpacity",1)),2===t.identifier&&Object(M_["b"])(this.program,t),0===t.identifier&&0===t.subPass&&(t.ambientOcclusionEnabled&&t.bindAmbientOcclusion(i),t.shadowsEnabled&&t.bindShadowMap(i)),0!==t.identifier||0!==t.subPass&&1!==t.subPass||!t.multipassTerrainParams.multipassTerrainEnabled||(this.program.setUniform2fv("cameraNearFar",t.cameraNearFar),i.setUniform2fv("inverseViewport",t.inverseViewport),t.multipassTerrainParams.terrainLinearDepthTexture&&i.bindTexture(t.multipassTerrainParams.terrainLinearDepthTexture,"terrainDepthTexture"))}bindDraw(e){if(A_["a"].bindModelTransform(this.program,e),this.program.setUniformMatrix3fv("uTransformNormal_GlobalFromModel",e.transformNormal_GlobalFromModel),this.program.rebindTextures(),Object(w["l"])(this._material)&&this._material.isIntegratedMesh){const t=this._material.overlayTexScale,i=this._material.overlayTexOffset;this.program.setUniform4fv("overlayTexOffset",[e.toMapSpace[0]*t[0]+i[0],e.toMapSpace[1]*t[1]+i[1],e.toMapSpace[0]*t[2]+i[2],e.toMapSpace[1]*t[3]+i[3]]),this.program.setUniform4fv("overlayTexScale",[e.toMapSpace[2]*t[0],e.toMapSpace[3]*t[1],e.toMapSpace[2]*t[2],e.toMapSpace[3]*t[3]])}}initializeProgram(e){const t=I_.shader.get(),i=this.configuration,r=t.build({multipassTerrainEnabled:i.multipassTerrainEnabled,cullAboveGround:i.cullAboveGround,OITEnabled:0===i.transparencyPassType,output:i.output,normalType:0===i.integratedMeshMode?i.hasNormals?1:3:2,attributeColor:i.hasVertexColors,attributeTextureCoordinates:i.vertexTextureCoordinates,componentData:i.componentData,alphaDiscardMode:i.alphaDiscardMode,baseColorTexture:i.baseColorTexture,doubleSidedMode:i.doubleSidedMode,receiveAmbientOcclusion:i.receiveAmbientOcclusion,receiveShadows:i.receiveShadows,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,viewingMode:e.viewingMode,vertexDiscardMode:i.vertexDiscardMode,pbrMode:3===i.integratedMeshMode?4:i.usePBR?i.isSchematic?2:1:0,hasMetalnessAndRoughnessTexture:i.hasMetalnessAndRoughnessTexture,hasEmissionTexture:i.hasEmissionTexture,hasOcclusionTexture:i.hasOcclusionTexture,hasNormalTexture:i.hasNormalTexture,vertexTangents:!1,supportsTextureAtlas:!0,doublePrecisionRequiresObfuscation:Object(E_["b"])(e.rctx),overlayEnabled:2===i.integratedMeshMode||3===i.integratedMeshMode,ssrEnabled:i.ssrEnabled,highStepCount:!1,ellipsoidMode:i.ellipsoidMode});return new ei["a"](e.rctx,r,t.attributeLocations)}setPipelineState(e){const t=this.configuration,i=0!==t.integratedMeshMode,r=3===e,n=2===e;return Object(ti["g"])({blending:0!==t.output&&7!==t.output||!t.blendingEnabled?null:r?D_["g"]:Object(D_["a"])(e),culling:Object(ti["c"])(t.cullFace),depthTest:{func:Object(D_["b"])(e)},depthWrite:r||n?ti["e"]:null,colorWrite:ti["d"],stencilWrite:i||t.sceneHasOcludees?Uy["j"]:null,stencilTest:i?Object(Uy["d"])(1):t.sceneHasOcludees?Uy["e"]:null,polygonOffset:r||n?t.polygonOffsetEnabled?{factor:2,units:2}:null:D_["d"]})}initializePipeline(){return this.setPipelineState(this.configuration.transparencyPassType)}}I_.shader=new Xt["a"](P_["a"],()=>i.e("chunk-2d0c8f4a").then(i.bind(null,"56a4")));class F_ extends A_["a"].ModelTransform{constructor(){super(...arguments),this.transformNormal_GlobalFromModel=Object(Ai["b"])(),this.toMapSpace=Object(Dt["e"])()}}class z_ extends Kt["a"]{constructor(){super(...arguments),this.output=0,this.hasVertexColors=!1,this.hasNormals=!1,this.vertexTextureCoordinates=0,this.componentData=0,this.slicePlaneEnabled=!1,this.cullFace=2,this.baseColorTexture=!1,this.receiveAmbientOcclusion=!0,this.receiveShadows=!0,this.vertexDiscardMode=0,this.doubleSidedMode=2,this.blendingEnabled=!0,this.alphaDiscardMode=1,this.integratedMeshMode=0,this.ssrEnabled=!1,this.polygonOffsetEnabled=!1,this.usePBR=!1,this.isSchematic=!1,this.hasMetalnessAndRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.sceneHasOcludees=!1,this.transparencyPassType=3,this.ellipsoidMode=1,this.multipassTerrainEnabled=!1,this.cullAboveGround=!1}}Object(h["a"])([Object(Kt["b"])({count:8})],z_.prototype,"output",void 0),Object(h["a"])([Object(Kt["b"])()],z_.prototype,"hasVertexColors",void 0),Object(h["a"])([Object(Kt["b"])()],z_.prototype,"hasNormals",void 0),Object(h["a"])([Object(Kt["b"])({count:3})],z_.prototype,"vertexTextureCoordinates",void 0),Object(h["a"])([Object(Kt["b"])({count:2})],z_.prototype,"componentData",void 0),Object(h["a"])([Object(Kt["b"])()],z_.prototype,"slicePlaneEnabled",void 0),Object(h["a"])([Object(Kt["b"])({count:3})],z_.prototype,"cullFace",void 0),Object(h["a"])([Object(Kt["b"])()],z_.prototype,"baseColorTexture",void 0),Object(h["a"])([Object(Kt["b"])()],z_.prototype,"receiveAmbientOcclusion",void 0),Object(h["a"])([Object(Kt["b"])()],z_.prototype,"receiveShadows",void 0),Object(h["a"])([Object(Kt["b"])({count:3})],z_.prototype,"vertexDiscardMode",void 0),Object(h["a"])([Object(Kt["b"])({count:3})],z_.prototype,"doubleSidedMode",void 0),Object(h["a"])([Object(Kt["b"])()],z_.prototype,"blendingEnabled",void 0),Object(h["a"])([Object(Kt["b"])({count:4})],z_.prototype,"alphaDiscardMode",void 0),Object(h["a"])([Object(Kt["b"])({count:4})],z_.prototype,"integratedMeshMode",void 0),Object(h["a"])([Object(Kt["b"])()],z_.prototype,"ssrEnabled",void 0),Object(h["a"])([Object(Kt["b"])()],z_.prototype,"polygonOffsetEnabled",void 0),Object(h["a"])([Object(Kt["b"])()],z_.prototype,"usePBR",void 0),Object(h["a"])([Object(Kt["b"])()],z_.prototype,"isSchematic",void 0),Object(h["a"])([Object(Kt["b"])()],z_.prototype,"hasMetalnessAndRoughnessTexture",void 0),Object(h["a"])([Object(Kt["b"])()],z_.prototype,"hasEmissionTexture",void 0),Object(h["a"])([Object(Kt["b"])()],z_.prototype,"hasOcclusionTexture",void 0),Object(h["a"])([Object(Kt["b"])()],z_.prototype,"hasNormalTexture",void 0),Object(h["a"])([Object(Kt["b"])()],z_.prototype,"sceneHasOcludees",void 0),Object(h["a"])([Object(Kt["b"])({count:4})],z_.prototype,"transparencyPassType",void 0),Object(h["a"])([Object(Kt["b"])({count:4})],z_.prototype,"ellipsoidMode",void 0),Object(h["a"])([Object(Kt["b"])()],z_.prototype,"multipassTerrainEnabled",void 0),Object(h["a"])([Object(Kt["b"])()],z_.prototype,"cullAboveGround",void 0);class L_{constructor(){this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){if(this._dirty=!1,null!=this._parameterBlocks)for(const e of this._parameterBlocks)this[e]._setClean()}get dirty(){return this._dirty||this._checkParameterBlocksDirty()}_checkParameterBlocksDirty(){if(null==this._parameterBlocks)return!1;for(const e of this._parameterBlocks)if(this[e].dirty)return!0;return!1}}class V_{constructor(){this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){this._dirty=!1}get dirty(){return this._dirty}}function k_(e={}){return(t,i)=>{var r;const n=null!=(r=t._parameterCount)?r:0;if(t._parameterCount=n+1,e.vectorOps){const r=e.vectorOps;Object.defineProperty(t,i,{get(){return this[n]},set(e){const t=this[n];if(null==t)this[n]=e;else{if(r.equals(t,e))return;r.copy(t,e)}this._setDirty()}})}else Object.defineProperty(t,i,{get(){return this[n]},set(t){this[n]!==t&&(e.dispose&&this[n]&&this[n].dispose(),this[n]=t,this._setDirty())}})}}function U_(){return(e,t)=>{var i;const r=null!=(i=e._parameterCount)?i:0;e._parameterCount=r+1,e._parameterBlocks=e._parameterBlocks||[],e._parameterBlocks.push(r),Object.defineProperty(e,t,{get(){return this[r]},set(e){this[r]!==e&&(this[r]=e,this._setDirty())}})}}var B_=i("ebd5");class N_ extends L_{constructor(){super(...arguments),this.baseColor=Object(Hb["c"])(1,1,1,1),this.usePBR=!1,this.hasParametersFromSource=!1,this.mrrFactors=Object(Mi["d"])(1,1,.5),this.emissiveFactor=Object(Mi["d"])(0,0,0),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null,this.overlayTexOffset=Object(Dt["g"])(-1,-1,-1,-1),this.overlayTexScale=Object(Dt["g"])(0,0,0,0),this.overlayColor=null,this.overlayHighlight=null,this.overlayNormal=null,this.objectOpacity=1,this.commonMaterialParameters=new G_,this.componentParameters=new q_,this.alphaCutoff=B_["b"],this.alphaDiscardMode=1,this.isIntegratedMesh=!1,this.polygonOffsetEnabled=!1,this.ellipsoidMode=1,this.sceneHasOcludees=!1,this._techniqueConfig=new z_}dispose(){this._technique=Object(w["s"])(this._technique),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null}getTechnique(e,t,i){const r=this._techniqueConfig;if(r.hasVertexColors=i.colors,r.hasNormals=i.normals,r.vertexTextureCoordinates=i.textureCoordinates,r.usePBR=this.usePBR,r.hasMetalnessAndRoughnessTexture=Object(w["l"])(this.metallicRoughnessTexture),r.hasEmissionTexture=Object(w["l"])(this.emissionTexture),r.hasOcclusionTexture=Object(w["l"])(this.occlusionTexture),r.hasNormalTexture=Object(w["l"])(this.normalTexture),r.transparencyPassType=0===t.identifier&&null!=t.transparencyPassType?t.transparencyPassType:3,r.multipassTerrainEnabled=0===t.identifier&&null!=t.multipassTerrainParams&&t.multipassTerrainParams.multipassTerrainEnabled,r.cullAboveGround=0===t.identifier&&null!=t.multipassTerrainParams&&t.multipassTerrainParams.cullAboveGround,r.ellipsoidMode=this.ellipsoidMode,this.dirty){r.componentData=this.componentParameters.type,r.cullFace=this.commonMaterialParameters.cullFace,r.doubleSidedMode=this.commonMaterialParameters.doubleSided?1:0,r.baseColorTexture=Object(w["l"])(this.baseColorTexture),r.isSchematic=this.hasParametersFromSource&&!Object(w["l"])(this.baseColorTexture);const e=this._computeWhichMaterialPass();r.blendingEnabled=1===e||2===e,r.alphaDiscardMode=this.alphaDiscardMode,r.integratedMeshMode=this.isIntegratedMesh?this.overlayColor?this.overlayNormal?3:2:1:0,r.polygonOffsetEnabled=this.polygonOffsetEnabled,this._setClean()}return r.slicePlaneEnabled=t.slicePlaneEnabled&&this.commonMaterialParameters.slicePlaneEnabled,1===t.identifier?(r.output=3,r.vertexDiscardMode=0):2===t.identifier?(r.output=4,r.vertexDiscardMode=0):(2===this._computeWhichMaterialPass()?r.vertexDiscardMode=t.transparent?2:1:r.vertexDiscardMode=0,r.output=W_(t.subPass),1===t.subPass&&(r.sceneHasOcludees=t.sceneHasOcludees),0===t.subPass?(r.receiveAmbientOcclusion=t.ambientOcclusionEnabled,r.sceneHasOcludees=t.sceneHasOcludees,r.receiveShadows=t.shadowsEnabled,r.ssrEnabled=t.ssrParams.ssrEnabled):(r.receiveAmbientOcclusion=!1,r.receiveShadows=!1)),this._technique=e.releaseAndAcquire(I_,r,this._technique),this._technique}submit(e,t){if(0===this.objectOpacity)return;const i=t.renderable.geometry,r=t.components,n=t.renderable.drawParameters,a=t.renderable.meta.cameraDepthSquared,s=r.geometryRanges,o=r.highlightRanges,c=r.defaultShadowMapRanges;switch(this._computeWhichMaterialPass()){case 0:e.materialOpaque.submitDraw(this,i,s,n,a);break;case 1:e.materialTransparent.submitDraw(this,i,s,n,a);break;case 2:e.materialOpaque.submitDraw(this,i,s,n,a),e.materialTransparent.submitDraw(this,i,s,n,a);break;case 3:e.materialIntegratedMesh.submitDraw(this,i,s,n,a),this.overlayHighlight&&e.highlightIntegratedMesh.submitDraw(this,i,s,n,a)}const l=2!==this.componentParameters.castShadows;l&&e.shadowMap.submitDraw(this,i,s,n,a),Object(w["l"])(o)&&(e.highlight.submitDraw(this,i,o,n,a),l&&e.highlightShadowMap.submitDraw(this,i,o,n,a)),l&&Object(w["l"])(c)&&e.defaultShadowMap.submitDraw(this,i,c,n,a)}get attributeLocations(){return P_["b"]}_computeWhichMaterialPass(){return this.isIntegratedMesh?3:this.objectOpacity<1?1:0===this.componentParameters.opaqueOverride?0:this.baseColor[3]<1||0===this.alphaDiscardMode||3===this.alphaDiscardMode?1:2===this.componentParameters.transparent?0:0===this.componentParameters.transparent?1:2}}Object(h["a"])([k_({vectorOps:zh["n"]})],N_.prototype,"baseColor",void 0),Object(h["a"])([k_()],N_.prototype,"usePBR",void 0),Object(h["a"])([k_()],N_.prototype,"hasParametersFromSource",void 0),Object(h["a"])([k_({vectorOps:Et["c"]})],N_.prototype,"mrrFactors",void 0),Object(h["a"])([k_({vectorOps:Et["c"]})],N_.prototype,"emissiveFactor",void 0),Object(h["a"])([k_({dispose:!0})],N_.prototype,"baseColorTexture",void 0),Object(h["a"])([k_({dispose:!0})],N_.prototype,"metallicRoughnessTexture",void 0),Object(h["a"])([k_({dispose:!0})],N_.prototype,"emissionTexture",void 0),Object(h["a"])([k_({dispose:!0})],N_.prototype,"occlusionTexture",void 0),Object(h["a"])([k_({dispose:!0})],N_.prototype,"normalTexture",void 0),Object(h["a"])([k_({vectorOps:{equals:zh["g"],copy:zh["c"]}})],N_.prototype,"overlayTexOffset",void 0),Object(h["a"])([k_({vectorOps:{equals:zh["g"],copy:zh["c"]}})],N_.prototype,"overlayTexScale",void 0),Object(h["a"])([k_()],N_.prototype,"overlayColor",void 0),Object(h["a"])([k_()],N_.prototype,"overlayHighlight",void 0),Object(h["a"])([k_()],N_.prototype,"overlayNormal",void 0),Object(h["a"])([k_()],N_.prototype,"objectOpacity",void 0),Object(h["a"])([U_()],N_.prototype,"commonMaterialParameters",void 0),Object(h["a"])([U_()],N_.prototype,"componentParameters",void 0),Object(h["a"])([k_()],N_.prototype,"alphaCutoff",void 0),Object(h["a"])([k_()],N_.prototype,"alphaDiscardMode",void 0),Object(h["a"])([k_()],N_.prototype,"isIntegratedMesh",void 0),Object(h["a"])([k_()],N_.prototype,"polygonOffsetEnabled",void 0),Object(h["a"])([k_()],N_.prototype,"ellipsoidMode",void 0),Object(h["a"])([k_()],N_.prototype,"sceneHasOcludees",void 0);class G_ extends V_{constructor(){super(...arguments),this.doubleSided=!1,this.cullFace=2,this.slicePlaneEnabled=!0}}Object(h["a"])([k_()],G_.prototype,"doubleSided",void 0),Object(h["a"])([k_()],G_.prototype,"cullFace",void 0),Object(h["a"])([k_()],G_.prototype,"slicePlaneEnabled",void 0);class q_ extends V_{constructor(){super(...arguments),this.externalColor=Object(Hb["c"])(1,1,1,1),this.externalColorMixMode=1,this.castShadows=0}get transparent(){return this.externalColor[3]<1?0:2}get opaqueOverride(){return 3===this.externalColorMixMode&&1===this.externalColor[3]?0:2}get visible(){return this.externalColor[3]>0?0:2}get type(){return 0}}Object(h["a"])([k_({vectorOps:zh["n"]})],q_.prototype,"externalColor",void 0),Object(h["a"])([k_()],q_.prototype,"externalColorMixMode",void 0),Object(h["a"])([k_()],q_.prototype,"castShadows",void 0);class H_ extends V_{constructor(){super(...arguments),this.texture=null,this.transparent=2,this.opaqueOverride=2,this.castShadows=2}get type(){return 1}}function W_(e){switch(e){case 0:return 0;case 1:return 7;case 2:return 1;case 3:return 2}}Object(h["a"])([k_()],H_.prototype,"texture",void 0),Object(h["a"])([k_()],H_.prototype,"transparent",void 0),Object(h["a"])([k_()],H_.prototype,"opaqueOverride",void 0),Object(h["a"])([k_()],H_.prototype,"castShadows",void 0);class $_{constructor(e){this._low=Object(Mi["c"])(),this._high=Object(Mi["c"])(),e&&this.set(e)}get low(){return this._low}get high(){return this._high}set(e){const t=this._low,i=this._high;Object(Et["n"])(t,e),Object(Et["C"])(i,e,t)}setElements(e,t,i){Object(Et["z"])(Z_,e,t,i),this.set(Z_)}get(e){return Object(Et["i"])(e,this._low,this._high)}getLowScaled(e){return Object(Et["h"])(e,this._low,1)}}const Z_=Object(F["f"])();class Q_{constructor(e){this.maxCount=e,this._nextIndex=0,this.recycledIndices=[]}get activeCount(){return this._nextIndex-this.recycledIndices.length}get availableCount(){return this.recycledIndices.length+this.maxCount-this._nextIndex}acquire(){return this.recycledIndices.length>0?this.recycledIndices.pop():this.availableCount?this._nextIndex++:void 0}release(e){this.recycledIndices.push(e)}}class X_{constructor(e,t=1){this.rctx=e,this.fieldCount=t,this.textureWidth=4096,this.dirty=!0,this.texture=new ir["a"](this.rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:this.textureWidth,height:1,flipped:!1}),this.data=new Xv["J"](new ArrayBuffer(4*this.textureWidth))}dispose(){this.texture.dispose(),this.texture=void 0,this.data=void 0}setData(e,t,i,r,n,a){const s=e*this.fieldCount+t;this.dirty=!0,this.data.set(s,0,i),this.data.set(s,1,r),this.data.set(s,2,n),this.data.set(s,3,a)}setDataElement(e,t,i,r){const n=e*this.fieldCount+t;this.dirty=!0,this.data.set(n,i,r)}resizeToFit(e){const t=e*this.fieldCount;if(t>=this.data.count){const e=Math.ceil((t+1)/this.textureWidth)*this.textureWidth,i=new Xv["J"](new ArrayBuffer(4*e));i.typedBuffer.set(this.data.typedBuffer),this.data=i}}updateTexture(){if(!this.dirty)return;const e=this.texture.descriptor.width,t=this.texture.descriptor.height;this.data.count>e*t&&this.texture.resize(e,this.data.count/e),this.texture.setData(this.data.typedBuffer),this.dirty=!1}bind(e,t,i){e.bindTexture(this.texture,t),e.setUniform2f(i,1/this.texture.descriptor.width,1/this.texture.descriptor.height)}}const Y_=65536;class K_{constructor(e,t=1){this.textureBuffer=new X_(e,t),this.indexManager=new Q_(Y_)}dispose(){this.textureBuffer.dispose(),this.textureBuffer=void 0}get availableCount(){return this.indexManager.availableCount}get activeCount(){return this.indexManager.activeCount}acquireIndex(){const e=this.indexManager.acquire();return this.textureBuffer.resizeToFit(e),e}releaseIndex(e){this.indexManager.release(e)}}class J_{constructor(e,t=1){this.rctx=e,this.fieldCount=t,this.buffers=[]}garbageCollect(){this.buffers=this.buffers.filter(e=>0!==e.activeCount||(e.dispose(),!1))}destroy(){this.buffers.forEach(e=>e.dispose()),this.buffers=[]}getBuffer(e){for(const i of this.buffers)if(i.availableCount>=e)return i;if(e>Y_)return null;const t=new K_(this.rctx,this.fieldCount);return this.buffers.push(t),t}updateTextures(){for(const e of this.buffers)e.textureBuffer.updateTexture()}}const ex=j["a"].getLogger("esri.views.3d.webgl-engine.collections.Component.ComponentObjectCollection");class tx{constructor(e){this._renderManager=e,this._objects=[new Fh["a"],new Fh["a"]],this._renderSubmit=new T_(this),this._renderManager.register(this._renderSubmit),this._componentBufferManager=new J_(e.rctx)}dispose(){Object(hr["a"])(0===this._objects[0].length&&0===this._objects[1].length,"ObjectCollection should be empty upon disposal"),this._componentBufferManager.destroy()}createObject(e){const t=new VO;return t.toMapSpace=e.toMapSpace.slice(),t.transform=e.transform,t.obb=Object(EO["b"])(e.obb),t.components=new zO(this._componentBufferManager,e.geometry.componentOffsets),t.renderable=this._createRenderable(e,t.components),t.intersectionGeometry=new ZO(e.geometry.positionData,t.components),this._objects[t.visible].push(t),t}destroyObject(e){const t=e;this._objects[t.visible].removeUnordered(t),t.dispose(),this._notifyDirty()}setObjectVisibility(e,t){const i=e;t!==i.visible&&(this._objects[i.visible].removeUnordered(i),this._objects[t].push(i),i.visible=t,this._notifyDirty())}preSubmit(e){const t=e.camera.eye;this.visibleObjects.forAll(e=>{const i=Object(Et["o"])(t,e.obb.center);e.renderable.meta.cameraDepthSquared=i})}getMaterial(e){return e.renderable.material}updateMaterial(e,t){const i=e.renderable.material;t(i),i.dirty&&this._notifyDirty()}setAllComponentVisibilities(e,t){const i=e;i.components.visibility.reset(t),i.components.visibilityDirty(),this._notifyDirty()}forEachVisibleComponent(e,t){return e.components.visibility.forEachComponent(t)}getComponentCount(e){const t=e,i=t.components.visibility.componentCount();return{visible:i,invisible:t.components.count-i}}setComponentData(e,t){const i=e,r=i.renderable.material;if(kO(t)){const e=i.components,n=e.materialDataBuffer,a=e.materialDataIndices,s={castShadows:!0,pickable:!0,externalColor:Object(Hb["b"])(),externalColorMixMode:1},o=n.textureBuffer,c=new Uint8Array(4),l=new Uint32Array(c.buffer);let d=0,h=0,u=0,p=!1,f=0;for(let i=0;i<e.count;i++)t(i,s),d+=+(s.externalColor[3]<1),h+=+(3===s.externalColorMixMode&&1===s.externalColor[3]),u+=+s.castShadows,Object(RO["a"])(s.externalColor,s.externalColorMixMode,c),c[2]=254&c[2]|+s.castShadows,o.setData(a[i],0,c[0],c[1],c[2],c[3]),p=p||i>0&&f!==l[0],f=l[0],s.pickable!==BO(e.pickability,i)&&(e.pickability=UO(e.pickability,e.count,i,s.pickable));p?(r.componentParameters=new H_,r.componentParameters.castShadows=rx(u,e.count),r.componentParameters.transparent=rx(d,e.count),r.componentParameters.opaqueOverride=rx(h,e.count),r.componentParameters.texture=o,o.updateTexture()):(r.componentParameters=new q_,r.componentParameters.castShadows=s.castShadows?0:2,r.componentParameters.externalColor=s.externalColor,r.componentParameters.externalColorMixMode=s.externalColorMixMode)}else r.componentParameters=new q_,r.componentParameters.castShadows=t.castShadows?0:2,r.componentParameters.externalColor=t.externalColor,r.componentParameters.externalColorMixMode=t.externalColorMixMode;this._notifyDirty()}getComponentAabb(e,t,i){return e.intersectionGeometry.getComponentAabb(t,i)}getComponentObb(e){return e.obb}getObjectTransform(e){return e.transform}getComponentPositions(e,t,i){return e.intersectionGeometry.getComponentPositions(t,i)}intersect(e,t,i,r,n,a){const s=e;Object(w["l"])(n)&&(n.localOrigin=s.transform.position);const o=Object(Pi["e"])(nx,s.transform.rotationScale);Object(Et["C"])(ax,t,s.transform.position),Object(Et["C"])(sx,i,s.transform.position),Object(Et["A"])(ax,ax,o),Object(Et["A"])(sx,sx,o);const c=Object(Pi["o"])(nx,o);return s.intersectionGeometry.intersect(ax,sx,r,c,n,a)}addEdges(e,t,i,r){const n=e,{indices:a,positions:s}=n.intersectionGeometry,o=n.components.offsets;return t.addComponentObject(e,n.transform,{center:n.obb.center,radius:Object(EO["l"])(n.obb)},s,a,o,i,r)}addComponentHighlight(e,t){const i=e.components;Object(w["k"])(i.highlightCounts)&&(i.highlightCounts=new Uint32Array(i.count+1)),0===i.highlightCounts[t]++&&(i.highlightsDirty(),this._notifyDirty()),i.highlightCounts[i.count]++}removeComponentHighlight(e,t){const i=e.components;if(Object(w["k"])(i.highlightCounts))return void ex.warn("Removing non-existing highlight.");const r=i.highlightCounts[t],n=i.highlightCounts[i.count];if(0!==r){if(r>1)return i.highlightCounts[t]=r-1,void(i.highlightCounts[i.count]=n-1);i.highlightCounts[t]=0,i.highlightsDirty(),this._notifyDirty(),1===n?i.highlightCounts=null:i.highlightCounts[i.count]=n-1}else ex.warn("Removing non-existing highlight.")}clearHighlights(e){const t=e.components;Object(w["l"])(t.highlightCounts)&&(t.highlightCounts=null,t.highlightsDirty(),this._notifyDirty())}getObjectGPUMemoryUsage(e){return e.renderable.meta.gpuMemoryEstimate}get visibleObjects(){return this._objects[1]}_createRenderable(e,t){const i=this._renderManager.rctx,r=e.geometry,n=r.vertices.layoutParameters,a=tr["a"].createVertex(i,35044,r.vertices.data),s=Object(w["c"])(r.indices,e=>tr["a"].createIndex(i,35044,e)),o=Object(Yi["a"])(Object(C_["a"])(n)),c=new Uint16Array(r.vertices.count);for(let g=0;g<t.count;g++){const e=t.offsets[g],i=t.offsets[g+1],n=t.materialDataIndices[g];if(Object(w["l"])(r.indices))for(let t=e;t<i;t++)c[r.indices[t]]=n;else for(let t=e;t<i;t++)c[t]=n}const l=tr["a"].createVertex(i,35044,c.buffer),d=new $_(e.transform.position),h=Object(MO["a"])(e.transform.rotationScale);Object(Pi["e"])(h,h),Object(Pi["o"])(h,h);const u=new F_;Object(Et["n"])(u.worldFromModel_TL,d.low),Object(Et["n"])(u.worldFromModel_TH,d.high),Object(Pi["g"])(u.worldFromModel_RS,e.transform.rotationScale),Object(Pi["g"])(u.transformNormal_GlobalFromModel,h),Object(zh["c"])(u.toMapSpace,e.toMapSpace);const p=new N_,f=new nr["a"](i,p.attributeLocations,{data:o,componentIndices:ix},{data:a,componentIndices:l},Object(w["u"])(s)),b=new KO(f,4,n,Object(w["l"])(s)),m={cameraDepthSquared:.5,gpuMemoryEstimate:a.byteSize+l.byteSize+(Object(w["l"])(s)?s.byteSize:0)};return new YO(p,u,b,m)}_notifyDirty(){this._renderManager.notifyDirty()}}const ix=Object(Yi["a"])(Object(Ki["a"])().u16("componentIndex"));function rx(e,t){return e===t?0:0===e?2:1}const nx=Object(MO["b"])(),ax=Object(F["f"])(),sx=Object(F["f"])();var ox=i("0e88"),cx=i("e508");class lx extends Yt["a"]{initializeProgram(e){const t=lx.shader.get().build(this.configuration);return new ei["a"](e.rctx,t,Jt["a"])}initializePipeline(){if(1===this.configuration.function)return Object(ti["g"])({colorWrite:{r:!1,g:!0,b:!1,a:!1}});switch(this.configuration.alphaMode){case 0:return Object(ti["g"])({colorWrite:ti["d"]});case 1:return Object(ti["g"])({blending:Object(ti["h"])(770,1,771,771),colorWrite:ti["d"]});default:return Object(ti["g"])({blending:Object(ti["i"])(1,771),colorWrite:ti["d"]})}}}lx.shader=new Xt["a"](cx["a"],()=>i.e("chunk-2d217e1d").then(i.bind(null,"c92c")));class dx extends Kt["a"]{constructor(){super(...arguments),this.function=0,this.alphaMode=0,this.hasOpacityFactor=!1}}Object(h["a"])([Object(Kt["b"])({count:4})],dx.prototype,"function",void 0),Object(h["a"])([Object(Kt["b"])({count:3})],dx.prototype,"alphaMode",void 0),Object(h["a"])([Object(Kt["b"])()],dx.prototype,"hasOpacityFactor",void 0);class hx{constructor(e,t){this._rctx=e,this._techniqueRepository=t}dispose(){this._vao=Object(w["f"])(this._vao)}compositeTransparent(e,t,i,r=1){const n=this._rctx;ux.alphaMode=1,ux.function=2,ux.hasOpacityFactor=1!==r;const a=this._techniqueRepository.acquire(lx,ux);n.useProgram(a.program),a.bindPipelineState(n),a.program.bindTexture(e,"colorTexture"),a.program.bindTexture(t,"alphaTexture"),a.program.bindTexture(i,"frontFaceTexture");const s=this.ensureVAO();n.bindVAO(s),n.drawArrays(5,0,Object(rr["e"])(s,"geometry")),a.release()}composite(e,t=0,i=1,r=0,n=0){const a=this._rctx;ux.alphaMode=t,ux.function=r,ux.hasOpacityFactor=1!==i;const s=this._techniqueRepository.acquire(lx,ux);a.useProgram(s.program),s.bindPipelineState(a),s.program.bindTexture(e,"tex"),ux.hasOpacityFactor&&s.program.setUniform1f("opacity",i),3===r&&s.program.setUniform1i("overlayIdx",n);const o=this.ensureVAO();a.bindVAO(o),a.drawArrays(5,0,Object(rr["e"])(o,"geometry")),s.release()}ensureVAO(){return Object(w["k"])(this._vao)&&(this._vao=Object(ai["d"])(this._rctx)),this._vao}}const ux=new dx;var px=i("661c");const fx=1e4,bx=100,mx=500,gx=500,vx=.1;function yx(e,t,i){return Object(px["b"])(t,e)*(i[1]-i[0])+i[0]}function Ox(e,t,i){if(t.size<fx)return Fx.compute(e,t);const r=e_();return i.forAll(t=>{t.isVisible&&i_(r,_x(e,t))}),r}function _x(e,t){if(!t.isVisible)return;const i=e_(),r=t.getSpatialQueryAccelerator();return Object(w["l"])(r)?xx(i,e,r):jx(i,e,t.objects),i}function xx(e,t,i){const r=t.eye,n=t.viewForward,a=t.frustum,s=e=>e.isVisible,o=i.objectCount;if(o<mx)t_(Dx,t.near,Math.min(e.near,t.far)),i.forEachInDepthRange(r,n,1,Dx,(i,r)=>{wx(e,t,i),Dx.far=e.near,r.setRange(Dx)},a,s),t_(Dx,Math.max(e.far,t.near),t.far),i.forEachInDepthRange(r,n,-1,Dx,(i,r)=>{wx(e,t,i),Dx.near=e.far,r.setRange(Dx)},a,s);else{const r=Math.max(Math.min(o,gx),Math.ceil(o*vx)),c=i.findClosest(n,1,a,s,r),l=i.findClosest(n,-1,a,s,r);c&&l&&(Tx(e,t,c.boundingVolumeWorldSpace.bounds),Tx(e,t,l.boundingVolumeWorldSpace.bounds))}}function jx(e,t,i){Ix.clear(),i.forAll(e=>{e.isVisible&&0!==e.geometryRecords.length&&Ix.add(e)}),Ix.empty||(Ix.sort(t),t_(Dx,t.near,Math.min(e.near,t.far)),Ix.forEachInDepthRange(Dx,1,(i,r)=>{r<e.near&&wx(e,t,i)}),t_(Dx,Math.max(e.far,t.near),t.far),Ix.forEachInDepthRange(Dx,-1,(t,i,r)=>{e.far=Math.max(e.far,r)}))}function wx(e,t,i){if(!i.isVisible)return;if(!Object(Dp["k"])(t.frustum,i.boundingVolumeWorldSpace.bounds))return;const r=i.transformation,n=Ex;i.geometryRecords.forEach(i=>{Object(Lt["n"])(n,r,i.getShaderTransformation());const a=Object(xe["i"])(n);Sx(e,t,i.geometry.boundingInfo,n,a)})}function Sx(e,t,i,r,n){if(Object(w["k"])(i))return;const a=t.eye,s=t.viewForward;Object(Et["t"])(Rx,i.center,r);const o=s[0]*(Rx[0]-a[0])+s[1]*(Rx[1]-a[1])+s[2]*(Rx[2]-a[2]);if(Rx[3]=i.radius*n,!(o-Rx[3]>e.near&&o+Rx[3]<e.far)&&Object(Dp["k"])(t.frustum,Rx))if(i.radius>bx&&i.getChildren()){const a=i.getChildren();for(let i=0;i<8;++i)a[i]&&Sx(e,t,a[i],r,n)}else zx.unionDepthRangeWithAABB(e,t.viewProjectionMatrix,r,i.bbMin,i.bbMax)}function Tx(e,t,i){const r=t.eye,n=t.viewForward,a=(i[0]-r[0])*n[0]+(i[1]-r[1])*n[1]+(i[2]-r[2])*n[2];e.near=Math.min(e.near,a-i[3]),e.far=Math.max(e.far,a+i[3])}class Cx{constructor(){this._items=new Fh["a"]({allocator:e=>e||{obj:null,distance:0,near:0,far:0},deallocator:e=>(e.obj=null,e.distance=0,e.near=0,e.far=0,e)})}get length(){return this._items.length}get empty(){return 0===this._items.length}clear(){this._items.clear()}add(e){this._items.pushNew().obj=e}sort(e){const t=e.eye,i=e.viewForward;this._items.forAll(e=>{const r=e.obj.boundingVolumeWorldSpace.bounds,n=(r[0]-t[0])*i[0]+(r[1]-t[1])*i[1]+(r[2]-t[2])*i[2];e.distance=n,e.near=n-r[3],e.far=n+r[3]}),this._items.sort((e,t)=>e.distance-t.distance)}forEachInDepthRange(e,t,i){if(1===t)for(let r=0;r<this._items.length;++r){const t=this._items.data[r];t.far<e.near||t.near>e.far||i(t.obj,t.near,t.far)}else for(let r=this._items.length-1;r>=0;--r){const t=this._items.data[r];t.far<e.near||t.near>e.far||i(t.obj,t.near,t.far)}}}class Px{constructor(){this.view=Object(Vt["d"])(),this.viewProj=Object(Vt["d"])(),this.frustum=Object(Dp["c"])(),this.geometries=[],this.near=[],this.far=[],this.nearCandidates=[],this.farCandidates=[],this.range={near:0,far:0},this.looseRange={near:0,far:0}}compute(e,t){this.reset(),Object(Lt["d"])(this.view,e.viewMatrix),Object(Lt["n"])(this.viewProj,e.projectionMatrix,this.view),Object(Dp["b"])(e.frustum,this.frustum);const i=this.view,r=i[2],n=i[6],a=i[10],s=i[14],o=this.range;let c=0;if(t.forEach(e=>{if(!e.instanceParameters.visible)return;if(!e.castShadow)return;let t;e.hasShaderTransformation?(e.computeBoundingSphere(e.getShaderTransformation(),Rx,1),t=Rx):t=e.boundingSphere;const i=r*t[0]+n*t[1]+a*t[2]+s,o=i-t[3],l=i+t[3];this.geometries[c]=e,this.near[c]=-l,this.far[c]=-o,++c}),0===this.geometries.length)return o;for(let u=0;u<this.geometries.length;++u)this.near[u]>o.far&&(o.far=this.near[u]),this.near[u]>2&&this.far[u]<o.near&&(o.near=this.far[u]);const l=this.looseRange;l.near=Math.max(.5*o.near,2),l.far=2*o.far;let d=0,h=0;for(let u=0;u<this.geometries.length;++u)this.near[u]<o.near&&(this.near[u]>=l.near?o.near=this.near[u]:this.nearCandidates[d++]=u),this.far[u]>o.far&&(this.far[u]<=l.far?o.far=this.far[u]:this.farCandidates[h++]=u);if(0===this.nearCandidates.length&&0===this.farCandidates.length)return o;this.nearCandidates.sort((e,t)=>this.near[e]<this.near[t]?-1:this.near[e]>this.near[t]?1:0),this.farCandidates.sort((e,t)=>this.far[e]<this.far[t]?1:this.far[e]>this.far[t]?-1:0);for(let u=0;u<this.nearCandidates.length;++u){const e=this.nearCandidates[u];if(this.near[e]<o.near){const t=this.geometries[e],i=t.boundingInfo;this.includeNearBoundingInfoRec(i,t.getShaderTransformation())}}for(let u=0;u<this.farCandidates.length;++u){const e=this.farCandidates[u];if(this.far[e]>o.far){const t=this.geometries[e],i=t.boundingInfo;this.includeFarBoundingInfoRec(i,t.getShaderTransformation())}}return o}reset(){this.geometries.length=0,this.near.length=0,this.far.length=0,this.nearCandidates.length=0,this.farCandidates.length=0,this.range.near=Number.MAX_VALUE,this.range.far=-Number.MAX_VALUE}includeNearBoundingInfoRec(e,t){if(Object(w["k"])(e))return;const i=e.getCenter();Object(Et["t"])(Rx,i,t);const r=Object(xe["i"])(t),n=Rx[0],a=Rx[1],s=Rx[2],o=e.getBSRadius()*r,c=this.frustum;if(c[0][0]*n+c[0][1]*a+c[0][2]*s+c[0][3]>o||c[1][0]*n+c[1][1]*a+c[1][2]*s+c[1][3]>o||c[2][0]*n+c[2][1]*a+c[2][2]*s+c[2][3]>o||c[3][0]*n+c[3][1]*a+c[3][2]*s+c[3][3]>o)return;const l=this.view[2]*n+this.view[6]*a+this.view[10]*s+this.view[14],d=l+o;if(!(-(l-o)<2||-d>=this.range.near))if(-d>this.looseRange.near)this.range.near=-d;else{if(o>bx){const i=e.getChildren();if(void 0!==i){for(let e=0;e<8;++e)void 0!==i[e]&&this.includeNearBoundingInfoRec(i[e],t);return}}zx.unionDepthRangeWithAABB(this.range,this.viewProj,t,e.getBBMin(),e.getBBMax())}}includeFarBoundingInfoRec(e,t){if(Object(w["k"])(e))return;let i=e.getBSRadius();const r=e.getCenter();Object(Et["t"])(Rx,r,t);const n=Object(xe["i"])(t),a=Rx[0],s=Rx[1],o=Rx[2];i*=n;const c=this.frustum;if(c[0][0]*a+c[0][1]*s+c[0][2]*o+c[0][3]>i||c[1][0]*a+c[1][1]*s+c[1][2]*o+c[1][3]>i||c[2][0]*a+c[2][1]*s+c[2][2]*o+c[2][3]>i||c[3][0]*a+c[3][1]*s+c[3][2]*o+c[3][3]>i)return;const l=this.view[2]*a+this.view[6]*s+this.view[10]*o+this.view[14]-i;if(!(-l<=this.range.far))if(-l<this.looseRange.far)this.range.far=-l;else{if(i>bx){const i=e.getChildren();if(void 0!==i){for(let e=0;e<8;++e)void 0!==i[e]&&this.includeFarBoundingInfoRec(i[e],t);return}}zx.unionDepthRangeWithAABB(this.range,this.viewProj,t,e.getBBMin(),e.getBBMax())}}}class Ax{constructor(){this.modelViewProj=Object(Vt["d"])(),this.clipPosition=[Object(Dt["e"])(),Object(Dt["e"])(),Object(Dt["e"])(),Object(Dt["e"])(),Object(Dt["e"])(),Object(Dt["e"])(),Object(Dt["e"])(),Object(Dt["e"])()]}unionDepthRangeWithAABB(e,t,i,r,n){const a=this.modelViewProj;Object(Lt["n"])(a,t,i);let s=!1;for(let o=0;o<8;++o){const e=this.clipPosition[o],t=0===o||3===o||4===o||7===o?r[0]:n[0],i=0===o||1===o||4===o||5===o?r[1]:n[1],s=o<4?r[2]:n[2];e[0]=a[0]*t+a[4]*i+a[8]*s+a[12],e[1]=a[1]*t+a[5]*i+a[9]*s+a[13],e[2]=a[2]*t+a[6]*i+a[10]*s+a[14],e[3]=a[3]*t+a[7]*i+a[11]*s+a[15]}for(let o=0;o<12;++o){const t=this.clipPosition[Mx[o][0]],i=this.clipPosition[Mx[o][1]],r=this.clipPosition[Mx[o][2]],n=this.clipTriangle(t,i,r);let a=!0;for(let e=0;e<n.length;++e)if(n[e][3]>=2){a=!1;break}if(!a){s=!0;for(let t=0;t<n.length;++t){const i=n[t][3];i<e.near&&(e.near=i),i>e.far&&(e.far=i)}}}return s}inside(e,t){return 0===t?e[0]>=-e[3]:1===t?e[1]>=-e[3]:2===t?e[0]<=e[3]:3===t?e[1]<=e[3]:void Object(hr["a"])(!1)}intersect(e,t,i){let r=0;return 0===i?r=(-e[3]-e[0])/(t[0]-e[0]+t[3]-e[3]):1===i?r=(-e[3]-e[1])/(t[1]-e[1]+t[3]-e[3]):2===i?r=(e[3]-e[0])/(t[0]-e[0]-t[3]+e[3]):3===i&&(r=(e[3]-e[1])/(t[1]-e[1]-t[3]+e[3])),Object(zh["j"])(Object(Dt["e"])(),e,t,r)}clipTriangle(e,t,i){let r=[e,t,i];for(let n=0;n<4;++n){const e=r;r=[];for(let t=0;t<e.length;++t){const i=e[t],a=e[(t+1)%e.length];this.inside(a,n)?(this.inside(i,n)||r.push(this.intersect(i,a,n)),r.push(a)):this.inside(i,n)&&r.push(this.intersect(i,a,n))}}return r}}const Mx=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],Rx=Object(_n["c"])(),Ex=Object(Vt["d"])(),Dx=e_(),Ix=new Cx,Fx=new Px,zx=new Ax;var Lx=i("4395"),Vx=i("3886"),kx=i("690a");function Ux(){const e=new kx["a"];return e.attributes.add("position","vec2"),e.vertex.uniforms.add("proj","mat4"),e.vertex.uniforms.add("drawPosition","vec4"),e.varyings.add("vUV","vec2"),e.vertex.code.add(Vx["a"]`void main(void) {
vUV = position;
gl_Position = vec4(drawPosition.xy + vec2(position - 0.5) * drawPosition.zw, 0.0, 1.0);
}`),e.fragment.uniforms.add("textureInput","sampler2D"),e.fragment.uniforms.add("textureMask","sampler2D"),e.fragment.uniforms.add("textureOverlay","sampler2D"),e.fragment.uniforms.add("maskEnabled","bool"),e.fragment.uniforms.add("overlayEnabled","bool"),e.fragment.code.add(Vx["a"]`const float barrelFactor = 1.1;
vec2 barrel(vec2 uv) {
vec2 uvn = uv * 2.0 - 1.0;
if (uvn.x == 0.0 && uvn.y == 0.0) {
return vec2(0.5, 0.5);
}
float theta = atan(uvn.y, uvn.x);
float r = pow(length(uvn), barrelFactor);
return r * vec2(cos(theta), sin(theta)) * 0.5 + 0.5;
}
void main() {
float mask = maskEnabled ? texture2D(textureMask, vUV).a : 1.0;
vec4 inputColor = texture2D(textureInput, barrel(vUV)) * mask;
vec4 overlayColor = overlayEnabled ? texture2D(textureOverlay, vUV) : vec4(0);
gl_FragColor = overlayColor + (1.0 - overlayColor.a) * inputColor;
}`),e}var Bx=i("5015");let Nx=class extends W["a"]{constructor(){super(...arguments),this._handles=new $["a"],this._magnifier=null,this._imageSources=null,this._imageLoadTask=null,this._resources=null,this.events=new Z["a"],this.attributeLocations=new Map([["position",0]]),this.tmpScreenPoint=Object(A["g"])(),this.tmpRenderPoint=Object(A["d"])()}get updating(){return Object(w["k"])(this._imageSources)&&Object(w["l"])(this._imageLoadTask)&&!this._imageLoadTask.task.finished}get magnifier(){return this._magnifier}set magnifier(e){if(e===this._magnifier)return;this._handles.removeAll(),this._magnifier=e;const t=()=>{this.updateResourceLoading(),this.events.emit("request-render")};Object(w["l"])(this._magnifier)&&this._handles.add(this._magnifier.watch("version",t)),t()}get enabled(){return Object(w["l"])(this._validMagnifier)}get _validMagnifier(){return Object(w["l"])(this._magnifier)&&this._magnifier.visible&&Object(w["l"])(this._magnifier.position)&&this._magnifier.size>0?this._magnifier:null}get factor(){return Object(w["l"])(this._magnifier)&&this._magnifier.factor||1}dispose(){this._magnifier=null,this._handles.destroy(),Object(w["l"])(this._imageLoadTask)&&(this._imageLoadTask.task.abort(),this._imageLoadTask=null),this.disposeResources()}render(e,t){const i=this._validMagnifier;if(Object(w["k"])(i))return;const r=t.camera.pixelRatio,n=Math.ceil(r*i.size);if(this.updateResources(e,n),Object(w["k"])(this._resources))return;const a=this._resources.program;e.useProgram(a);const s=this._resources.textures,o=Math.ceil(1/this.factor*n);s.input.resize(o,o);const c=t.camera.fullWidth,l=t.camera.fullHeight;Object(A["j"])(i.position,this.tmpScreenPoint);const d=t.camera.screenToRender(this.tmpScreenPoint,this.tmpRenderPoint),h=.5*o,u=.5*o;d[0]=Object(Oe["f"])(d[0],h,c-h-1),d[1]=Object(Oe["f"])(d[1],u,l-u-1);const p=Math.floor(d[0]-h),f=Math.floor(d[1]-u);a.bindTexture(s.input,"textureInput"),e.gl.copyTexImage2D(s.input.descriptor.target,0,s.input.descriptor.pixelFormat,p,f,o,o,0);const b=i.offset.x*r,m=i.offset.y*r,g=(d[0]+b)/c*2-1,v=(d[1]-m)/l*2-1,y=n/c*2,O=n/l*2;e.bindVAO(this._resources.vao),a.bindTexture(s.overlay,"textureOverlay"),a.bindTexture(s.mask,"textureMask"),a.setUniform4f("drawPosition",g,v,y,O),a.setUniform1i("maskEnabled",i.maskEnabled?1:0),a.setUniform1i("overlayEnabled",i.overlayEnabled?1:0),e.setPipelineState(this._resources.pipelineState),e.drawArrays(5,0,4)}updateResourceLoading(){const e=this._validMagnifier;if(Object(w["k"])(e))return;const t=e.maskUrl,i=e.overlayUrl;!Object(w["l"])(this._imageLoadTask)||this._imageLoadTask.maskUrl===t&&this._imageLoadTask.overlayUrl===i||(this._imageLoadTask.task.abort(),this._imageLoadTask=null,this._imageSources=null),Object(w["l"])(this._imageSources)||Object(w["l"])(this._imageLoadTask)||(this._imageLoadTask={maskUrl:t,overlayUrl:i,task:Object(S["h"])(async e=>{const r=Object(w["k"])(t)||Object(w["k"])(i)?Object(Bx["a"])(e):null,n=Object(w["l"])(t)?Object(Wi["a"])(t,{signal:e}):r.then(e=>e.mask),a=Object(w["l"])(i)?Object(Wi["a"])(i,{signal:e}):r.then(e=>e.overlay);this._imageSources={mask:await n,overlay:await a},this.disposeResources(),this.events.emit("request-render")})},this._imageLoadTask.task.promise.then(()=>this.notifyChange("updating"),()=>this.notifyChange("updating")))}updateResources(e,t){if(!this.enabled)return void this.disposeResources();if(Object(w["l"])(this._resources)){if(this._resources.textures.size!==t){const i=this.createTextureResources(e,t);if(Object(w["k"])(i))return void this.disposeResources();this.disposeTextureResources(this._resources.textures),this._resources.textures=i}return}const i=this.createTextureResources(e,t);Object(w["k"])(i)||(this._resources={textures:i,program:this.createProgram(e),vao:Object(ai["d"])(e,ni["a"],this.attributeLocations,0,1),pipelineState:Object(ti["g"])({blending:Object(ti["i"])(1,771),depthTest:null,depthWrite:null,colorWrite:ti["d"]})})}disposeResources(){Object(w["k"])(this._resources)||(this.disposeTextureResources(this._resources.textures),this._resources.program.dispose(),this._resources.vao.dispose(),this._resources=null)}disposeTextureResources(e){e.mask.dispose(),e.overlay.dispose(),e.input.dispose()}createTextureResources(e,t){if(Object(w["k"])(this._imageSources))return null;this._imageSources.overlay.width=t,this._imageSources.overlay.height=t,this._imageSources.mask.width=t,this._imageSources.mask.height=t;const i=new ir["a"](e,{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!0,preMultiplyAlpha:!Object(Sm["x"])(this._imageSources.overlay.src)||!e.driverTest.svgAlwaysPremultipliesAlpha},this._imageSources.overlay),r=new ir["a"](e,{target:3553,pixelFormat:6406,internalFormat:6406,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!0},this._imageSources.mask);return{input:new ir["a"](e,{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!1}),mask:r,overlay:i,size:t}}createProgram(e){const t=Ux();return new ei["a"](e,t,this.attributeLocations)}};Object(h["a"])([Object(M["b"])()],Nx.prototype,"_imageSources",void 0),Object(h["a"])([Object(M["b"])()],Nx.prototype,"_imageLoadTask",void 0),Object(h["a"])([Object(M["b"])({readOnly:!0})],Nx.prototype,"updating",null),Nx=Object(h["a"])([Object(D["a"])("esri/views/3d/webgl-engine/lib/MagnifierHelper")],Nx);class Gx{constructor(){this.viewTransform=new A_["a"].ViewProjectionTransform,this.slicePlane=Object(k["d"])()}}class qx extends Gx{constructor(){super(...arguments),this.identifier=0,this.slicePlaneEnabled=!0,this.transparent=!1,this.integratedMesh=!1,this.transformNormal_ViewFromGlobal=Object(Ai["b"])(),this.cameraNearFar=Object(Ut["b"])(),this.inverseViewport=Object(Ut["b"])(),this.ambientOcclusionEnabled=!0,this.shadowsEnabled=!0,this.sceneHasOcludees=!1,this.transparencyPassType=3}}class Hx extends Gx{constructor(){super(...arguments),this.identifier=1,this.cameraNearFar=Object(Ut["b"])()}}class Wx extends Gx{constructor(){super(...arguments),this.identifier=2,this.inverseViewport=Object(Ut["b"])(),this.viewport=Object(Dt["e"])()}}class $x{constructor(e,t,i=0){this._rctx=e,this._techniqueRepository=t,this._sorting=i,this._draws=new Fh["a"]({initialSize:32,allocator:e=>e||{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}}),this._passBoundTechniques=new Set,this._previouslyBoundMaterials=new Map,this._previouslyBoundDraw=new Map}submitDraw(e,t,i,r,n){const a=this._draws.pushNew();a.geometry=t,a.geometryRanges=i,a.material=e,a.bindDrawParams=r,a.depthSquaredHint=n,a.indexType=t.indexed?Object(w["u"])(t.vao.indexBuffer).indexType:0}dispatch(e){const t=this._rctx;this._passBoundTechniques.clear(),this._previouslyBoundMaterials.clear(),this._previouslyBoundDraw.clear();let i=null;const r=this._draws.length;for(let n=0;n<r;n++){const r=this._draws.data[n],a=r.geometry,s=r.material.getTechnique(this._techniqueRepository,e,a.parameters);s===i&&3===s.configuration.transparencyPassType||(t.useProgram(s.program),s.bindPipelineState(t,e.slot),i=s),this._passBoundTechniques.has(s)||(s.bindPass(e),this._passBoundTechniques.add(s)),t.bindVAO(a.vao),this._previouslyBoundMaterials.get(s)!==r.material&&(s.bindMaterial(r.material,e),this._previouslyBoundMaterials.set(s,r.material)),this._previouslyBoundDraw.get(s)!==r.bindDrawParams&&(s.bindDraw(r.bindDrawParams),this._previouslyBoundDraw.set(s,r.bindDrawParams));const o=r.geometryRanges,c=o.length;if(0!==r.indexType){const e=Zx.get(r.indexType);for(let i=0;i<c;i+=2){const n=o[i],s=o[i+1];t.drawElements(a.primitiveType,s,r.indexType,n*e)}}else for(let e=0;e<c;e+=2){const i=o[e],r=o[e+1];t.drawArrays(a.primitiveType,i,r)}}return r>0}prepareSubmit(){this._draws.clear()}finishSubmit(){const e=0===this._sorting?1:-1;this._draws.sort((t,i)=>{const r=e*(t.depthSquaredHint-i.depthSquaredHint);return 0!==r?r:t.geometry.vao.size-i.geometry.vao.size})}get count(){return this._draws.length}}const Zx=new Map;Zx.set(5121,1),Zx.set(5123,2),Zx.set(5125,4);class Qx{constructor(e,t){this.rctx=e,this.shaderTechniqueRepository=t,this.canRender=!0,this._materialPassParams=new qx,this._shadowPassParams=new Hx,this._highlightPassParams=new Wx,this._systems=new Set,this._passes={materialOpaque:new $x(e,this.shaderTechniqueRepository),materialTransparent:new $x(e,this.shaderTechniqueRepository,1),materialIntegratedMesh:new $x(e,this.shaderTechniqueRepository),shadowMap:new $x(e,this.shaderTechniqueRepository),highlight:new $x(e,this.shaderTechniqueRepository),highlightIntegratedMesh:new $x(e,this.shaderTechniqueRepository),highlightShadowMap:new $x(e,this.shaderTechniqueRepository),defaultShadowMap:new $x(e,this.shaderTechniqueRepository)}}register(e){this._systems.add(e)}prepareRender(e){if(0!==this._systems.size){for(const e of Object.values(this._passes))e.prepareSubmit();this._systems.forEach(t=>t.submit(this._passes,{camera:e}));for(const e of Object.values(this._passes))e.finishSubmit();this.shaderTechniqueRepository.frameUpdate()}}render(e){if(0===this._systems.size)return!1;switch(this._configure(e),e.slot){case 3:switch(e.pass){case 0:return this._materialPassParams.subPass=0,this._configureMaterialColorPass(e),this._passes.materialOpaque.dispatch(this._materialPassParams);case 2:return this._materialPassParams.subPass=2,this._passes.materialOpaque.dispatch(this._materialPassParams);case 3:return this._materialPassParams.subPass=3,this._passes.materialOpaque.dispatch(this._materialPassParams);case 5:return this._passes.highlight.dispatch(this._highlightPassParams);case 4:return this._passes.shadowMap.dispatch(this._shadowPassParams);case 7:return this._passes.highlightShadowMap.dispatch(this._shadowPassParams);case 6:return this._passes.defaultShadowMap.dispatch(this._shadowPassParams)}return!1;case 5:switch(e.pass){case 0:return this._materialPassParams.subPass=0,this._configureMaterialColorPass(e),this._passes.materialTransparent.dispatch(this._materialPassParams);case 1:return this._materialPassParams.subPass=1,this._configureMaterialColorPass(e),this._passes.materialTransparent.dispatch(this._materialPassParams);case 2:return this._materialPassParams.subPass=2,this._passes.materialTransparent.dispatch(this._materialPassParams);case 3:return this._materialPassParams.subPass=3,this._passes.materialTransparent.dispatch(this._materialPassParams)}return!1;case 0:switch(e.pass){case 0:return this._materialPassParams.subPass=0,this._configureMaterialColorPass(e),this._materialPassParams.ssrParams=e.ssrParams,this._passes.materialIntegratedMesh.dispatch(this._materialPassParams);case 2:return this._materialPassParams.subPass=2,this._passes.materialIntegratedMesh.dispatch(this._materialPassParams);case 3:return this._materialPassParams.subPass=3,this._passes.materialIntegratedMesh.dispatch(this._materialPassParams);case 5:return this._passes.highlightIntegratedMesh.dispatch(this._highlightPassParams)}return!1}return!1}notifyDirty(){this._context.requestRender()}slots(){return[3,5,0]}initializeRenderContext(e){this._context=e}uninitializeRenderContext(){}queryDepthRange(e){const t={near:1/0,far:-1/0};return this._systems.forEach(i=>{const r=i.queryShadowCasterDepthRange(e);Object(w["l"])(r)&&i_(t,r,t)}),t}get shadowCastingEnabled(){return this._materialPassParams.shadowsEnabled}set shadowCastingEnabled(e){this._materialPassParams.shadowsEnabled=e}get screenSpaceReflectionsEnabled(){return Object(w["l"])(this._materialPassParams.ssrParams.ssrEnabled)}set screenSpaceReflectionsEnabled(e){this._materialPassParams.ssrParams.ssrEnabled=!!e}_configureMaterialColorPass(e){this._materialPassParams.bindShadowMap=t=>{e.shadowMap.bind(t);const i=this._materialPassParams.viewTransform;Object(Et["i"])(Xx,i.worldFromView_TL,i.worldFromView_TH),e.shadowMap.bindView(t,Xx)},this._materialPassParams.bindAmbientOcclusion=t=>e.ssaoHelper.bind(t,e.camera),this._materialPassParams.ambientOcclusionEnabled=!!e.ssaoHelper&&e.ssaoHelper.ready,this._materialPassParams.sceneHasOcludees=e.hasOccludees}_configure(e){const t=4===e.pass||7===e.pass||6===e.pass?this._shadowPassParams:5===e.pass?this._highlightPassParams:this._materialPassParams;this._updateParameters(e,t)}_updateParameters(e,t){const i=e.camera,r=i.viewInverseTransposeMatrix;Object(Et["z"])(Xx,r[3],r[7],r[11]),Kx.set(Xx),Object(Et["n"])(t.viewTransform.worldFromView_TH,Kx.high),Object(Et["n"])(t.viewTransform.worldFromView_TL,Kx.low),Object(Pi["f"])(t.viewTransform.viewFromCameraRelative_RS,i.viewMatrix),Object(Lt["d"])(t.viewTransform.projFromView,i.projectionMatrix),0===t.identifier?(this._materialPassParams.transparent=5===e.slot,this._materialPassParams.integratedMesh=0===e.slot,this._materialPassParams.lighting=e.scenelightingData,Object(Pi["o"])(Yx,t.viewTransform.viewFromCameraRelative_RS),Object(Pi["e"])(t.transformNormal_ViewFromGlobal,Yx),Object(kt["s"])(t.cameraNearFar,i.near,i.far)):1===t.identifier?Object(kt["s"])(t.cameraNearFar,i.near,i.far):2===t.identifier&&(t.highlightDepthTexture=e.highlightDepthTexture,Object(zh["c"])(t.viewport,i.fullViewport)),0!==t.identifier&&2!==t.identifier||(t.inverseViewport[0]=1/i.fullViewport[2],t.inverseViewport[1]=1/i.fullViewport[3]),Object(k["e"])(e.sliceHelper.plane,t.slicePlane),Object(Et["m"])(t.slicePlane.origin,t.slicePlane.origin,Xx),t.slicePlaneEnabled=e.sliceHelper.isEnabled,this._materialPassParams.slot=e.slot,this._materialPassParams.transparencyPassType=e.transparencyPassType,this._materialPassParams.multipassTerrainParams=e.multipassTerrainParams}get needsHighlight(){return this._passes.highlight.count>0||this._passes.highlightIntegratedMesh.count>0}}const Xx=Object(F["f"])(),Yx=Object(Ai["b"])(),Kx=new $_;var Jx=i("b616"),ej=i("ce99");const tj=8.6,ij=.4;class rj extends Yt["a"]{initializeProgram(e){const t=rj.shader.get().build(this.configuration);return new ei["a"](e.rctx,t,Jt["a"])}bindApplyPass(e){this.program.setUniform4fv("color",e.color),this.program.setUniform4fv("haloColor",e.haloColor),this.program.setUniform1f("outlineSize",tj),this.program.setUniform1f("blurSize",ij),this.program.setUniform4f("opacities",e.haloOpacity,e.haloOpacityOccluded,e.fillOpacity,e.fillOpacityOccluded)}initializePipeline(){return 1===this.configuration.highlightStage?Object(ti["g"])({blending:Object(ti["h"])(770,1,771,771),colorWrite:ti["d"]}):Object(ti["g"])({colorWrite:ti["d"]})}get primitiveType(){return this.configuration.gridOptimization?4:5}}rj.shader=new Xt["a"](ej["a"],()=>i.e("chunk-2d0f0fc1").then(i.bind(null,"9f64")));class nj extends Kt["a"]{constructor(){super(...arguments),this.highlightStage=0,this.gridOptimization=!1}}Object(h["a"])([Object(Kt["b"])({count:3})],nj.prototype,"highlightStage",void 0),Object(h["a"])([Object(Kt["b"])()],nj.prototype,"gridOptimization",void 0);const aj=32;class sj{constructor(e,t){this._techniqueRep=e,this._rctx=t,this.viewportToRestore=Object(Dt["e"])(),this.defaultOptions={color:Object(Hb["c"])(1,0,1,1),haloColor:Object(Hb["c"])(1,0,1,1),haloOpacity:1,fillOpacity:.2,haloOpacityOccluded:.25,fillOpacityOccluded:.05,shadowColor:Object(Hb["c"])(1,0,1,1),shadowOpacity:.15,occludedShadowOpacity:.075},this._grid={coverageMipmap:null,vao:null,verticalCellCount:0,horizontalCellCount:0,cellPixelSize:0,mipmapLevels:0,viewportWidth:0,viewportHeight:0}}assertResources(){if(this.quadVAO)return;this.quadVAO=Object(ai["d"])(this._rctx);const e={colorTarget:0,depthStencilTarget:0,width:0,height:0},t={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:0,height:0};this.blur0Fbo=new zi["a"](this._rctx,e,t),this.blur1Fbo=new zi["a"](this._rctx,e,t);const i=new nj;i.highlightStage=0,i.gridOptimization=!1,this.blurTechnique=this._techniqueRep.acquire(rj,i),i.highlightStage=0,i.gridOptimization=!0,this.blurGridTechnique=this._techniqueRep.acquire(rj,i),i.highlightStage=1,i.gridOptimization=!1,this.applyTechnique=this._techniqueRep.acquire(rj,i),i.highlightStage=1,i.gridOptimization=!0,this.applyGridTechnique=this._techniqueRep.acquire(rj,i),i.highlightStage=2,i.gridOptimization=!1,this.downsampleTechnique=this._techniqueRep.acquire(rj,i)}dispose(){if(this._grid.coverageMipmap)for(let e=1;e<this._grid.coverageMipmap.length;e++)this._grid.coverageMipmap[e].dispose();this._grid.vao&&this._grid.vao.dispose(!0),this.quadVAO&&(this.quadVAO.dispose(!0),this.quadVAO=null),this.blur0Fbo=Object(w["f"])(this.blur0Fbo),this.blur1Fbo=Object(w["f"])(this.blur1Fbo)}get profilingCallback(){return Lh["a"].HIGHLIGHTS_PROFILE_TO_CONSOLE?e=>console.log(e):null}setDefaultOptions(e){this.defaultOptions=e}render(e,t,i){const r=e.pixelRatio,n=Lh["a"].HIGHLIGHTS_GRID_OPTIMIZATION_ENABLED,a=this._rctx;this.assertResources(),Object(zh["c"])(this.viewportToRestore,e.fullViewport);const s=e.fullWidth,o=e.fullHeight,c=Math.ceil(s/r),l=Math.ceil(o/r);this.blur0Fbo.resize(c,l),this.blur1Fbo.resize(c,l),a.bindVAO(this.quadVAO);let d=null;const h=n?this.blurGridTechnique:this.blurTechnique;h.bindPipelineState(a),a.useProgram(h.program),n?(this._gridUpdateResources(t,aj),this._gridComputeMipmap(),d=this._grid.vao,h.program.bindTexture(this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture,"coverageTex")):d=this.quadVAO,a.bindVAO(d),a.bindFramebuffer(this.blur0Fbo),a.setViewport(0,0,c,l),a.setClearColor(0,0,0,0),a.clear(16384),h.program.bindTexture(t.colorTexture,"tex"),h.program.setUniform2f("blurSize",1/c,0),a.drawArrays(h.primitiveType,0,Object(rr["e"])(d,"geometry")),a.bindFramebuffer(this.blur1Fbo),a.clear(16384),h.program.bindTexture(this.blur0Fbo.colorTexture,"tex"),h.program.setUniform2f("blurSize",0,1/l),a.drawArrays(h.primitiveType,0,Object(rr["e"])(d,"geometry"));const u=n?this.applyGridTechnique:this.applyTechnique;if(a.bindFramebuffer(i),u.bindPipelineState(a),a.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],this.viewportToRestore[3]),a.useProgram(u.program),u.program.bindTexture(this.blur1Fbo.colorTexture,"tex"),u.program.bindTexture(t.colorTexture,"origin"),n){const e=this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture;u.program.bindTexture(e,"coverageTex")}u.bindApplyPass(this.defaultOptions),a.drawArrays(u.primitiveType,0,Object(rr["e"])(d,"geometry")),a.bindVAO(null)}_gridUpdateResources(e,t){const i=this._rctx,r=this._grid;let n=!1;if(null===r.coverageMipmap&&(r.coverageMipmap=[e],n=!0),r.viewportWidth===e.width&&r.viewportHeight===e.height||(n=!0,r.viewportWidth=e.width,r.viewportHeight=e.height),r.coverageMipmap[0]=e,r.cellPixelSize!==t&&(r.cellPixelSize=t,n=!0),n){for(let e=1;e<r.coverageMipmap.length;e++)r.coverageMipmap[e].dispose();r.mipmapLevels=Math.ceil(Math.log(r.cellPixelSize)*Math.LOG2E),r.coverageMipmap.length=r.mipmapLevels+1;for(let e=0;e<r.mipmapLevels;e++){const t=r.coverageMipmap[e],n={target:3553,pixelFormat:6407,dataType:33635,samplingMode:9729,wrapMode:33071,width:Math.ceil(t.width/2),height:Math.ceil(t.height/2)},a={colorTarget:0,depthStencilTarget:0,width:Math.ceil(t.width/2),height:Math.ceil(t.height/2)};r.coverageMipmap[e+1]=new zi["a"](i,a,n)}}const a=Math.ceil(e.height/r.cellPixelSize),s=Math.ceil(e.width/r.cellPixelSize);if(!r.vao||r.verticalCellCount!==a||r.horizontalCellCount!==s){r.verticalCellCount=a,r.horizontalCellCount=s;const e=a+1,t=s+1,n=1/a,o=1/s,c=6,l=4,d=new Float32Array(c*l*e*t);let h=0;for(let i=0;i<e;i++)for(let e=0;e<t;e++)d[h+0]=(e-.5)*o*2-1,d[h+1]=(i-.5)*n*2-1,d[h+2]=e*o,d[h+3]=i*n,d[h+4]=(e+.5)*o*2-1,d[h+5]=(i-.5)*n*2-1,d[h+6]=e*o,d[h+7]=i*n,d[h+8]=(e-.5)*o*2-1,d[h+9]=(i+.5)*n*2-1,d[h+10]=e*o,d[h+11]=i*n,d[h+12]=(e-.5)*o*2-1,d[h+13]=(i+.5)*n*2-1,d[h+14]=e*o,d[h+15]=i*n,d[h+16]=(e+.5)*o*2-1,d[h+17]=(i-.5)*n*2-1,d[h+18]=e*o,d[h+19]=i*n,d[h+20]=(e+.5)*o*2-1,d[h+21]=(i+.5)*n*2-1,d[h+22]=e*o,d[h+23]=i*n,h+=c*l;r.vao&&r.vao.dispose(!0),r.vao=new nr["a"](i,Jt["a"],{geometry:ni["b"]},{geometry:tr["a"].createVertex(i,35044,d)})}}_gridComputeMipmap(){const e=this._rctx,t=this._grid,i=this.downsampleTechnique.program;this.downsampleTechnique.bindPipelineState(e),e.bindVAO(this.quadVAO),e.useProgram(i);for(let r=0;r<t.mipmapLevels;r++){e.bindFramebuffer(t.coverageMipmap[r+1]),i.bindTexture(t.coverageMipmap[r].colorTexture,"tex");const n=t.coverageMipmap[r+1].width,a=t.coverageMipmap[r+1].height;i.setUniform2f("invFramebufferDim",1/n,1/a),e.setViewport(0,0,n,a),e.drawArrays(5,0,Object(rr["e"])(this.quadVAO,"geometry"))}}get gpuMemoryUsage(){let e=(Object(w["l"])(this.blur0Fbo)?this.blur0Fbo.gpuMemoryUsage:0)+(Object(w["l"])(this.blur1Fbo)?this.blur1Fbo.gpuMemoryUsage:0);if(this._grid.coverageMipmap)for(const t of this._grid.coverageMipmap)e+=t.gpuMemoryUsage;return e}get test(){return{coverage:this._grid.coverageMipmap,blur:[this.blur0Fbo,this.blur1Fbo]}}}var oj=i("91b0");const cj={dataType:5121,internalFormat:6408},lj={};class dj{constructor(e){this.rctx=e,this._activeTargets=new Set,this._depthTextures=new Map,this._depthBuffers=new Map,this._colorTextures=new Map,this._framebuffers=new Map,this.depthTextureSupported=e.capabilities.depthTexture}dispose(){this._depthBuffers.forEach(e=>e.dispose()),this._depthBuffers.clear(),this._depthTextures.forEach(e=>e.dispose()),this._depthTextures.clear(),this._colorTextures.forEach(e=>e.dispose()),this._colorTextures.clear(),this._framebuffers.forEach(e=>e.dispose()),this._framebuffers.clear()}disposeTargetResource(e){const t=e.id;this._activeTargets.has(t)&&(this._activeTargets.delete(t),this.disposeWithFramebuffers(this._depthTextures,t),this.disposeWithFramebuffers(this._depthBuffers,t),this.disposeWithFramebuffers(this._colorTextures,t))}disposeWithFramebuffers(e,t){const i=e.get(t);i&&(this._framebuffers.forEach((e,t)=>{e.colorAttachment!==i&&e.depthStencilAttachment!==i||(e.detachAll(),e.dispose(),this._framebuffers.delete(t))}),i.dispose(),e.delete(t))}getDepthTexture(e,t){if(!this.depthTextureSupported)return null;let i=this._depthTextures.get(e.id);return!i||i.descriptor.width===t.width&&i.descriptor.height===t.height||(i.dispose(),i=null),i||(i=new ir["a"](this.rctx,{target:3553,pixelFormat:34041,dataType:34042,samplingMode:9728,wrapMode:33071,width:t.width,height:t.height}),this._depthTextures.set(e.id,i),this._activeTargets.add(e.id)),i}getAllocatedDepthTexture(e){return this._depthTextures.get(e.id)}getDepthBuffer(e,t){if(this.depthTextureSupported)return null;let i=this._depthBuffers.get(e.id);return i?i.descriptor.width===t.width&&i.descriptor.height===t.height||i.resize(t.width,t.height):(i=new oj["a"](this.rctx,{internalFormat:34041,...t}),this._depthBuffers.set(e.id,i),this._activeTargets.add(e.id)),i}getColorTexture(e,t){let i=this._colorTextures.get(e.id);return i&&(i.descriptor.width===t.width&&i.descriptor.height===t.height||(i.dispose(),i=null)),i||(i=new ir["a"](this.rctx,{target:3553,pixelFormat:6408,internalFormat:e.internalFormat,dataType:e.dataType,samplingMode:null!=e.samplingMode?e.samplingMode:9729,wrapMode:33071,width:t.width,height:t.height}),this._colorTextures.set(e.id,i),this._activeTargets.add(e.id)),i}getAllocatedColorTexture(e){return this._colorTextures.get(e.id)}registerDepthTarget(e={}){return{id:Object(op["b"])(),...lj,...e}}registerColorTarget(e={}){return{id:Object(op["b"])(),...cj,...e}}getFramebuffer(e,t,i){const r=this.getKey(t,i);let n=this._framebuffers.get(r);const a=this.getColorTexture(t,e);if(this.depthTextureSupported){const t=i?this.getDepthTexture(i,e):void 0;return n?((n.width!==e.width||n.height!==e.height||n.colorTexture!==a||n.depthStencilTexture!==t)&&(n.detachAll(),n.resize(e.width,e.height),n.attachColorTexture(a),n.attachDepthStencilTexture(t)),n):(n=Object(w["l"])(i)?new zi["a"](this.rctx,{colorTarget:0,depthStencilTarget:4},a,t):new zi["a"](this.rctx,{colorTarget:0,depthStencilTarget:0},a),this._framebuffers.set(r,n),n)}const s=i?this.getDepthBuffer(i,e):void 0;return n?((n.width!==e.width||n.height!==e.height||n.colorTexture!==a)&&(n.detachAll(),n.resize(e.width,e.height),n.attachColorTexture(a),n.attachDepthStencilBuffer(s)),n):(n=new zi["a"](this.rctx,{colorTarget:0,depthStencilTarget:i?3:0},a,s),this._framebuffers.set(r,n),n)}getKey(e,t){return`${e.id}_${t?t.id:"X"}_${e.name}${t?"_"+t.name:""}`}get gpuMemoryUsage(){let e=0;const t=new Set,i=i=>{t.has(i)||(t.add(i),e+=Object(rr["c"])(i))};return this._depthTextures.forEach(i),this._colorTextures.forEach(i),this._depthBuffers.forEach(i),e}}class hj{constructor(e,t){this._rctx=e,this._compositingHelper=t,this._mainColorTarget=0,this._dimensions={width:4,height:4},this._needLastFrameColorTexture=!1,this._background={type:"color",color:[0,0,0,1]};const i="webgl2"===e.webglVersion;this._renderTargetHelper=new dj(e);const r=this._renderTargetHelper;this.mainColorTargets=[r.registerColorTarget({name:"mainColorTarget0"}),r.registerColorTarget({name:"mainColorTarget1"})],this.frontFaceTarget=r.registerColorTarget({name:"frontFaceTarget"});const n=e=>r.registerColorTarget({name:e,dataType:5126,internalFormat:i?34836:6408,samplingMode:9728});this.colorFloatTarget=n("colorFloatTarget"),this.alphaFloatTarget=n("alphaFloatTarget"),this.mainDepth=r.registerDepthTarget({name:"mainDepth"}),this.linearDepth=r.registerColorTarget({name:"linearDepth",samplingMode:9728}),this.terrainLinearDepth=r.registerColorTarget({name:"terrainLinearDepth"}),this.geometryLinearDepth=r.registerColorTarget({name:"geometryLinearDepth"}),this.normal=r.registerColorTarget({name:"normal"}),this.highlight=r.registerColorTarget({name:"highlight",internalFormat:i?32854:6408,dataType:32819}),this.hudVisibility=r.registerColorTarget({name:"hudVisibility",internalFormat:i?32854:6408,dataType:32819}),this.tmpColor=r.registerColorTarget({name:"tmpColor"}),this.tmpDepth=r.registerDepthTarget({name:"tmpDepth"}),this.hudColor=r.registerColorTarget({name:"hudColor"})}dispose(){this._renderTargetHelper.dispose()}get width(){return this._dimensions.width}get height(){return this._dimensions.height}set background(e){this._background=e}get background(){return this._background}get currentColorTarget(){return this.mainColorTargets[this._mainColorTarget]}get previousColorTarget(){return this.mainColorTargets[1-this._mainColorTarget]}get framebuffer(){return this.getFramebuffer(this.currentColorTarget,this.mainDepth)}getFramebuffer(e,t){return this._renderTargetHelper.getFramebuffer(this._dimensions,e,t)}get colorTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.currentColorTarget)}get depthTexture(){return this._renderTargetHelper.getAllocatedDepthTexture(this.mainDepth)}get linearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.linearDepth)}get terrainLinearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.terrainLinearDepth)}get geometryLinearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.geometryLinearDepth)}get lastFrameColorTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.previousColorTarget)}get normalTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.normal)}get highlightTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.highlight)}get hudVisibilityTexture(){return this.getColorTexture(this.hudVisibility)}get tmpColorTexture(){return this.getColorTexture(this.tmpColor)}get hudColorTexture(){return this.getColorTexture(this.hudColor)}get mainColorTexture(){return this.getColorTexture(this.currentColorTarget)}advanceCurrentRenderTarget(){this._mainColorTarget=0===this._mainColorTarget&&this._needLastFrameColorTexture?1:0}initializeFrame(e){const t=this._rctx;this._dimensions.width=e.fullWidth,this._dimensions.height=e.fullHeight,this.bindTarget(this.currentColorTarget,this.mainDepth),t.setClearStencil(0);const i=this._background.color;t.setClearColor(i[0]*i[3],i[1]*i[3],i[2]*i[3],i[3]),t.clearSafe(17664)}composite(){Object(w["l"])(this.colorTexture)&&this._compositingHelper.composite(this.colorTexture,0)}renderTmpAndCompositeToMain(e,t,i=!1){this.renderToTargets(e,this.tmpColor,i?this.tmpDepth:this.mainDepth,uj),this._compositingHelper.composite(this.getColorTexture(this.tmpColor),t)}renderHUDVisibility(e,t=!1){this.renderToTargets(e,this.hudVisibility,t?this.tmpDepth:this.mainDepth,pj)}compositeTransparentTerrainOntoHUDVisibility(){this.renderToTargets(()=>this._compositingHelper.composite(this.getColorTexture(this.tmpColor),0,1,1),this.hudVisibility,this.tmpDepth)}renderOITPass(e,t,i){let r,n;switch(t){case 0:r=this.colorFloatTarget,n=[0,0,0,0];break;case 1:r=this.alphaFloatTarget,n=[1,1,1,1];break;case 2:r=this.frontFaceTarget,n=[0,0,0,0]}i?this.renderToTargets(e,r,this.tmpDepth,n,!0,!0):this.renderToTargets(e,r,this.mainDepth,n,!1)}compositeTransparentTerrainOntoMain(){this.bindFramebuffer(),this._compositingHelper.composite(this.getColorTexture(this.tmpColor),2)}compositeOccludedOntoMain(e){this.bindFramebuffer(),this._compositingHelper.composite(this.getColorTexture(this.tmpColor),2,e)}compositeTransparentOntoOpaque(e){e?(this.bindTarget(this.hudColor,this.tmpDepth),this._rctx.setClearColor(0,0,0,1e-13),this._rctx.clearSafe(16384)):this.bindFramebuffer(),this._compositingHelper.compositeTransparent(this.getColorTexture(this.colorFloatTarget),this.getColorTexture(this.alphaFloatTarget),this.getColorTexture(this.frontFaceTarget))}bindFramebuffer(){this._rctx.bindFramebuffer(this.framebuffer)}renderDepthDetached(e){this.bindTarget(this.currentColorTarget),e(),this.bindTarget(this.currentColorTarget,this.mainDepth)}disposeTarget(e){this._renderTargetHelper.disposeTargetResource(e)}set needLastFrameColorTexture(e){!e&&this._needLastFrameColorTexture&&(this._mainColorTarget=0,this.disposeTarget(this.mainColorTargets[1])),this._needLastFrameColorTexture=e}get needLastFrameColorTexture(){return this._needLastFrameColorTexture}renderToTargets(e,t,i,r,n=!1,a=!1){const s=this._rctx,o=this.bindTarget(t,i);let c=0;if(r){const e=1e-13,t=Math.max(e,r[3]);s.setClearColor(r[0],r[1],r[2],t),c|=16384}return n&&(c|=256),!1===a?a=0:(!0===a&&(a=255),c|=1024),c&&s.clearSafe(c,a),e(),s.gl.flush(),this.bindTarget(this.currentColorTarget,this.mainDepth),o}bindTarget(e,t){const i=this._renderTargetHelper.getFramebuffer(this._dimensions,e,t);return this._rctx.bindFramebuffer(i),i}getColorTexture(e){return this._renderTargetHelper.getColorTexture(e,this._dimensions)}get gpuMemoryUsage(){let e=0;return this._renderTargetHelper&&(e+=this._renderTargetHelper.gpuMemoryUsage),e}}const uj=[0,0,0,0],pj=[0,1,0,1];var fj=i("d6e5"),bj=i("9def");class mj{constructor(e){this.context=e,this.renderPlugins=new Array,this.slots=[];for(let t=0;t<23;++t)this.slots[t]=[]}add(e,t,i){const r=()=>{this.renderPlugins.push(t);for(const i of e)this.slots[i].push(t);this.context.requestRender()},n=t.initializeRenderContext(this.context,i);if(Object(S["o"])(n))return n.then(r);r()}remove(e){const t=this.renderPlugins.length;this.renderPlugins=this.renderPlugins.filter(t=>t!==e),Object(hr["a"])(this.renderPlugins.length<t,"Removing non-added render plugin");for(let i=0;i<this.slots.length;++i)this.slots[i]=this.slots[i].filter(t=>t!==e);e.uninitializeRenderContext(),this.context.requestRender()}prepareRender(e,t){for(const i of this.renderPlugins)i.prepareRender&&i.prepareRender(e,t)}render(){const e=this.slots[this.context.renderContext.slot];let t=!1;for(const i of e)i.canRender&&i.render(this.context.renderContext)&&(t=!0);return t}queryDepthRange(e){const t=gj;t.near=1/0,t.far=-1/0;for(const i of this.renderPlugins)if(i.queryDepthRange){const r=i.queryDepthRange(e);r&&i_(t,r,t)}return t}get needsHighlight(){return this.renderPlugins.some(e=>e.needsHighlight)}get needsLinearDepth(){return this.renderPlugins.some(e=>e.needsLinearDepth)}get needsLaserlineWithContrastControl(){const e=this.slots[15];return!!e&&e.length>0}get renderOccludedFlags(){let e=0;return this.renderPlugins.forEach(t=>{t.renderOccludedFlags&&(e|=t.renderOccludedFlags)}),e}}const gj={near:0,far:0};var vj=i("6ad6");class yj extends Yt["a"]{initializeProgram(e){const t=yj.shader.get().build(this.configuration);return new ei["a"](e.rctx,t,Jt["a"])}initializePipeline(e){switch(this.configuration.pass){case 0:return Object(ti["g"])({blending:Object(ti["h"])(1,1,1,1),colorWrite:ti["d"],depthTest:null,depthWrite:null});case 1:case 2:return Object(ti["g"])({blending:D_["g"],colorWrite:ti["d"],depthTest:null,depthWrite:null})}return Object(ti["g"])({})}bindPass(e){if(0===this.configuration.pass||2===this.configuration.pass){const t=e;this.program.bindTexture(t.linearDepthTexture,"depthMap"),t.shadowMap.bind(this.program),t.shadowMap.bindView(this.program,t.camera.center),this.program.setUniform2fv("nearFar",t.camera.nearFar),this.program.setUniformMatrix4fv("inverseView",t.inverseView),this.program.setUniform4fv("projInfo",t.projInfo),this.program.setUniform2fv("zScale",t.zScale)}else if(1===this.configuration.pass){const t=e;if(this.program.bindTexture(t.shadowCastMap,"shadowCastMap"),this.program.setUniform1f("sampleScale",t.sampleScale),this.program.setUniform1f("opacityFromElevation",t.opacityFromElevation),this.program.setUniform4fv("color",t.color),0===this.configuration.visualization&&this.configuration.bandsEnabled){const t=e;this.program.setUniform1f("bandSize",t.bandSize)}else if(1===this.configuration.visualization){const t=e;this.program.setUniform1f("threshold",t.threshold)}}}get primitiveType(){return 5}}yj.shader=new Xt["a"](vj["a"],()=>i.e("chunk-2d0ccf76").then(i.bind(null,"4fd2")));class Oj extends Kt["a"]{constructor(){super(...arguments),this.pass=0,this.visualization=0,this.bandsEnabled=!1}}Object(h["a"])([Object(Kt["b"])({count:3})],Oj.prototype,"pass",void 0),Object(h["a"])([Object(Kt["b"])()],Oj.prototype,"visualization",void 0),Object(h["a"])([Object(Kt["b"])()],Oj.prototype,"bandsEnabled",void 0);const _j=Object(Dt["g"])(.01,0,.25,1),xj=4e4,jj=5e4,wj=1/512;let Sj=class extends W["a"]{constructor(e,t,i,r){super({}),this._techniqueRepository=e,this._rctx=t,this._shadowAccumulator=i,this._requestRender=r,this._visualizationParams={shadowCastMap:this._shadowCastTexture,sampleScale:0,color:_j,threshold:.5,bandSize:.1,opacityFromElevation:1},this._techniqueConfig=new Oj,this._enabled=!1,this._vao=Object(ai["d"])(t),this._techniqueConfig.pass=1,this._techniqueConfig.visualization=0}normalizeCtorArgs(){return{}}dispose(){this._stop(),this._vao=Object(w["f"])(this._vao),this._techniqueRepository.release(this._technique),this._technique=null,this._shadowAccumulator=null}get visualizeShadowCastTechnique(){return this._technique=this._techniqueRepository.releaseAndAcquire(yj,this._techniqueConfig,this._technique),this._technique}render(){if(!this._isRenderingVisualization)return;this._sampleScale=1/this._computedSamples,this._rctx.bindVAO(this._vao);const e=this.visualizeShadowCastTechnique;this._rctx.useProgram(e.program),e.bindPipelineState(this._rctx),e.bindPass(this._visualizationParams),this._rctx.drawArrays(e.primitiveType,0,Object(rr["e"])(this._vao,"geometry"))}setOptions(e){void 0!==e.enabled&&this._setEnabled(e.enabled),void 0!==e.color&&this._setColor(e.color),void 0!==e.threshold&&(this._threshold=e.threshold),void 0!==e.visualization&&(this._visualization=e.visualization),void 0!==e.bandSize&&(this._bandSize=e.bandSize),void 0!==e.bandsEnabled&&(this._bandsEnabled=e.bandsEnabled)}get opacityFromElevation(){return this._visualizationParams.opacityFromElevation}set opacityFromElevation(e){this._visualizationParams.opacityFromElevation!==e&&(this._visualizationParams.opacityFromElevation=e,this.notifyChange("opacityFromElevation"))}get _isRenderingVisualization(){return this._enabled&&this._computedSamples>0&&this.opacityFromElevation>wj}get _computedSamples(){return this._shadowAccumulator.computedSamples}get _shadowCastTexture(){return this._shadowAccumulator.shadowCastTexture}get _sampleScale(){return this._visualizationParams.sampleScale}set _sampleScale(e){this._visualizationParams.sampleScale=e}get _threshold(){return this._visualizationParams.threshold}set _threshold(e){this._threshold!==e&&(this._visualizationParams.threshold=e,this._requestRenderIfRunning())}get _visualization(){return this._techniqueConfig.visualization}set _visualization(e){e!==this._visualization&&(this._techniqueConfig.visualization=e,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}get _bandSize(){return this._visualizationParams.bandSize}set _bandSize(e){e!==this._bandSize&&(this._visualizationParams.bandSize=e,this._requestRenderIfRunning())}get _bandsEnabled(){return this._techniqueConfig.bandsEnabled}set _bandsEnabled(e){e!==this._bandsEnabled&&(this._techniqueConfig.bandsEnabled=e,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}_setColor(e){const t=this._visualizationParams.color;Object(zh["g"])(e,t)||(Object(zh["c"])(this._visualizationParams.color,e),this._requestRenderIfRunning())}_setEnabled(e){e!==this._enabled&&(e?this._start():this._stop())}_requestRenderIfRunning(){this._enabled&&this._requestRender()}_start(){this._enabled=!0,this._requestRender()}_stop(){this._enabled=!1,this._requestRender()}};Object(h["a"])([Object(M["b"])()],Sj.prototype,"opacityFromElevation",null),Sj=Object(h["a"])([Object(D["a"])("esri.views.3d.webgl-engine.lib.ShadowCastRenderer")],Sj);class Tj{constructor(){this.camera=new Fs["a"],this.lightMat=Object(Vt["d"])()}}class Cj{constructor(e,t,i=0){this.rctx=e,this.viewingMode=t,this._enabled=!1,this._snapshots=new Array,this.textureSize=0,this.maxTextureSize=0,this.numCascades=1,this.maxNumCascades=4,this.splitSchemeLambda=0,this.warp=!0,this.cascadeDistances=[0,0,0,0,0],this.cascades=[],this.maxTextureSize=this.rctx.parameters.maxTextureSize;for(let r=0;r<4;++r)this.cascades.push(new Tj);this.snapshotCount=i}dispose(){this.discardDepthTexture(),this.discardAllSnapshots()}set maxCascades(e){this.maxNumCascades=Object(Oe["f"])(Math.floor(e),1,4)}get maxCascades(){return this.maxNumCascades}set enabled(e){this._enabled=e,e||(this.discardDepthTexture(),this.discardAllSnapshots())}get enabled(){return this._enabled}get snapshotCount(){return this._snapshots.length}set snapshotCount(e){const t=this._snapshots.length;if(e>t){const i=e-t;this._snapshots.length=e;for(let e=0;e<i;++e)this._snapshots[t+e]=null}else if(e<this.snapshotCount){const i=t-e;for(let t=0;t<i;++t)this.discardSnapshot(e+t);this._snapshots.length=e}}getSnapshot(e){return this.enabled?this._snapshots[e]:null}getCascades(){for(let e=0;e<this.numCascades;++e)Nj[e]=this.cascades[e];return Nj.length=this.numCascades,Nj}start(e,t,i){Object(hr["a"])(this.enabled),this.textureSize=this.computeTextureSize(e.fullWidth,e.fullHeight),this.ensureDepthTexture();const{near:r,far:n}=this.clampNearFar(i);this.computeCascadeDistances(n,r),this.setupMatrices(e,t);const a=e.viewMatrix,s=e.projectionMatrix;for(let o=0;o<this.numCascades;++o)this.constructCascade(o,s,a,t);this.lastOrigin=null,this.clear()}finish(e){Object(hr["a"])(this.enabled),this.rctx.bindFramebuffer(e)}bind(e){this.enabled?(this._depthTextureUnit=e.bindTexture(this._depthTexture,"uShadowMapTex"),e.setUniform1f("uDepthHalfPixelSz",.5/this.textureSize),e.setUniform1i("uShadowMapNum",this.numCascades),e.setUniform4f("uShadowMapDistance",this.cascadeDistances[0],this.numCascades>1?this.cascadeDistances[1]:1/0,this.numCascades>2?this.cascadeDistances[2]:1/0,this.numCascades>3?this.cascadeDistances[3]:1/0)):e.setUniform1f("uDepthHalfPixelSz",-1)}bindView(e,t){if(!this.enabled)return;const i=this.lastOrigin;if(!i||i[0]!==t[0]||i[1]!==t[1]||i[2]!==t[2]){this.lastOrigin=this.lastOrigin||Object(F["f"])(),Object(Et["n"])(this.lastOrigin,t);for(let e=0;e<this.numCascades;++e){Object(Lt["b"])(Gj,this.cascades[e].lightMat,t);for(let t=0;t<16;++t)qj[16*e+t]=Gj[t]}}e.setUniformMatrix4fv("uShadowMapMatrix",qj)}takeCascadeSnapshotTo(e,t){Object(hr["a"])(this.enabled),this.ensureSnapshot(t),this._bindFbo();const i=this.rctx,r=i.bindTexture(this._snapshots[t],ir["a"].TEXTURE_UNIT_FOR_UPDATES);i.gl.copyTexSubImage2D(3553,0,e.camera.viewport[0],e.camera.viewport[1],e.camera.viewport[0],e.camera.viewport[1],e.camera.viewport[2],e.camera.viewport[3]),i.bindTexture(r,ir["a"].TEXTURE_UNIT_FOR_UPDATES)}clear(){const e=this.rctx;this._bindFbo(),e.setClearColor(1,1,1,1),e.clearSafe(16640)}computeTextureSize(e,t){const i=.5*Math.log(e*e+t*t)*Math.LOG2E,r=.35,n=2**Math.round(i+r);return Math.min(this.maxTextureSize,2*n)}ensureDepthTexture(){if(null!=this._depthTexture&&this._depthTexture.descriptor.width===this.textureSize)return;this.discardDepthTexture();const e={target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9728,flipped:!0,width:this.textureSize,height:this.textureSize};this._depthTexture=new ir["a"](this.rctx,e),this.fbo=new zi["a"](this.rctx,{colorTarget:0,depthStencilTarget:1,width:this.textureSize,height:this.textureSize},this._depthTexture)}ensureSnapshot(e){const t=this._snapshots[e];if(Object(w["l"])(t)&&t.descriptor.width===this.textureSize)return;this.discardSnapshot(e);const i={target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9728,flipped:!0,width:this.textureSize,height:this.textureSize};this._snapshots[e]=new ir["a"](this.rctx,i)}discardDepthTexture(){this.fbo=Object(w["f"])(this.fbo),this._depthTexture=Object(w["f"])(this._depthTexture)}discardSnapshot(e){this._snapshots[e]=Object(w["f"])(this._snapshots[e])}discardAllSnapshots(){for(let e=0;e<this.snapshotCount;++e)this.discardSnapshot(e)}_bindFbo(){const e=this.rctx;Object(w["l"])(this._depthTextureUnit)&&(e.bindTexture(null,this._depthTextureUnit),this._depthTextureUnit=null),e.bindFramebuffer(this.fbo)}constructCascade(e,t,i,r){const n=this.cascades[e],a=-this.cascadeDistances[e],s=-this.cascadeDistances[e+1],o=(t[10]*a+t[14])/Math.abs(t[11]*a+t[15]),c=(t[10]*s+t[14])/Math.abs(t[11]*s+t[15]);Object(hr["a"])(o<c);for(let d=0;d<8;++d){Object(zh["l"])(Rj,d%4==0||d%4==3?-1:1,d%4==0||d%4==1?-1:1,d<4?o:c,1),Object(zh["m"])(Ej[d],Rj,Mj);for(let e=0;e<3;++e)Ej[d][e]/=Ej[d][3]}Object(Et["v"])(Bj,Ej[0]),Object(Lt["b"])(Pj,Uj,Bj),n.camera.viewMatrix=Pj;for(let d=0;d<8;++d)Object(Et["t"])(Ej[d],Ej[d],n.camera.viewMatrix);Object(Et["n"])(Dj,Ej[0]),Object(Et["n"])(Ij,Ej[0]);for(let d=1;d<8;++d)for(let e=0;e<3;++e)Dj[e]=Math.min(Dj[e],Ej[d][e]),Ij[e]=Math.max(Ij[e],Ej[d][e]);Dj[2]-=200,Ij[2]+=200,n.camera.near=-Ij[2],n.camera.far=-Dj[2],this.warp?this.constructTrapezoidalProjection(i,r,n):this.constructOrthogonalProjection(n),Object(Lt["n"])(n.lightMat,n.camera.projectionMatrix,n.camera.viewMatrix);const l=this.textureSize/2;n.camera.viewport[0]=e%2==0?0:l,n.camera.viewport[1]=0===Math.floor(e/2)?0:l,n.camera.viewport[2]=l,n.camera.viewport[3]=l}constructOrthogonalProjection(e){Object(Lt["p"])(e.camera.projectionMatrix,Dj[0],Ij[0],Dj[1],Ij[1],e.camera.near,e.camera.far)}constructTrapezoidalProjection(e,t,i){const r=1/Ej[0][3],n=1/Ej[4][3];Object(hr["a"])(r<n);let a=r+Math.sqrt(r*n);const s=Math.sin(Object(Oe["b"])(e[2]*t[0]+e[6]*t[1]+e[10]*t[2]));a/=s,tw(Ej,a,s,Fj,zj,Lj,Vj,kj),ow(Fj,zj,Vj,kj,i.camera.projectionMatrix),i.camera.projectionMatrix[10]=2/(Dj[2]-Ij[2]),i.camera.projectionMatrix[14]=-(Dj[2]+Ij[2])/(Dj[2]-Ij[2])}setupMatrices(e,t){Object(Lt["n"])(Aj,e.projectionMatrix,e.viewMatrix),Object(Lt["c"])(Mj,Aj);const i=1===this.viewingMode?e.eye:Object(Et["z"])(Bj,0,0,1);Object(Lt["m"])(Uj,[0,0,0],[-t[0],-t[1],-t[2]],i)}clampNearFar(e){let{near:t,far:i}=e;return t<2&&(t=2),i<2&&(i=2),t>=i&&(t=2,i=4),{near:t,far:i}}computeCascadeDistances(e,t){this.numCascades=Math.min(1+Math.floor(Object(hr["h"])(e/t,4)),this.maxNumCascades);const i=(e-t)/this.numCascades,r=(e/t)**(1/this.numCascades);let n=t,a=t;for(let s=0;s<this.numCascades+1;++s)this.cascadeDistances[s]=Object(Oe["l"])(n,a,this.splitSchemeLambda),n*=r,a+=i}get gpuMemoryUsage(){var e,t;return this._snapshots.reduce((e,t)=>e+Object(rr["c"])(t),null!=(e=null==(t=this.fbo)?void 0:t.gpuMemoryUsage)?e:0)}get test(){const e=this;return{maxNumCascades:this.maxNumCascades,cascades:this.cascades,textureSize:this.textureSize,depthTexture:this._depthTexture,set splitSchemeLambda(t){e.splitSchemeLambda=t},get splitSchemeLambda(){return e.splitSchemeLambda},set warp(t){e.warp=t},get warp(){return e.warp}}}}const Pj=Object(Vt["d"])(),Aj=Object(Vt["d"])(),Mj=Object(Vt["d"])(),Rj=Object(Dt["e"])(),Ej=[];for(let ET=0;ET<8;++ET)Ej.push(Object(Dt["e"])());const Dj=Object(F["f"])(),Ij=Object(F["f"])(),Fj=Object(Ut["b"])(),zj=Object(Ut["b"])(),Lj=Object(Ut["b"])(),Vj=Object(Ut["b"])(),kj=Object(Ut["b"])(),Uj=Object(Vt["d"])(),Bj=Object(F["f"])(),Nj=[],Gj=Object(Vt["d"])(),qj=new Float32Array(64),Hj=Object(Ut["b"])(),Wj=Object(Ut["b"])(),$j=[Object(Ut["b"])(),Object(Ut["b"])(),Object(Ut["b"])(),Object(Ut["b"])()],Zj=Object(Ut["b"])(),Qj=Object(Ut["b"])(),Xj=Object(Ut["b"])(),Yj=Object(Ut["b"])(),Kj=Object(Ut["b"])(),Jj=Object(Ut["b"])(),ew=Object(Ut["b"])();function tw(e,t,i,r,n,a,s,o){Object(kt["s"])(Hj,0,0);for(let _=0;_<4;++_)Object(kt["m"])(Hj,Hj,e[_]);Object(kt["g"])(Hj,Hj,.25),Object(kt["s"])(Wj,0,0);for(let _=4;_<8;++_)Object(kt["m"])(Wj,Wj,e[_]);Object(kt["g"])(Wj,Wj,.25),Object(kt["o"])($j[0],e[4],e[5],.5),Object(kt["o"])($j[1],e[5],e[6],.5),Object(kt["o"])($j[2],e[6],e[7],.5),Object(kt["o"])($j[3],e[7],e[4],.5);let c=0,l=Object(kt["a"])($j[0],Hj);for(let _=1;_<4;++_){const e=Object(kt["a"])($j[_],Hj);e<l&&(l=e,c=_)}Object(kt["f"])(Zj,$j[c],e[c+4]);const d=Zj[0];let h,u;Zj[0]=-Zj[1],Zj[1]=d,Object(kt["f"])(Qj,Wj,Hj),Object(kt["k"])(Qj,Zj)<0&&Object(kt["n"])(Zj,Zj),Object(kt["o"])(Zj,Zj,Qj,i),Object(kt["i"])(Zj,Zj),h=u=Object(kt["k"])(Object(kt["f"])(Xj,e[0],Hj),Zj);for(let _=1;_<8;++_){const t=Object(kt["k"])(Object(kt["f"])(Xj,e[_],Hj),Zj);t<h?h=t:t>u&&(u=t)}Object(kt["c"])(r,Hj),Object(kt["g"])(Xj,Zj,h-t),Object(kt["m"])(r,r,Xj);let p=-1,f=1,b=0,m=0;for(let _=0;_<8;++_){Object(kt["f"])(Yj,e[_],r),Object(kt["i"])(Yj,Yj);const t=Zj[0]*Yj[1]-Zj[1]*Yj[0];t>0?t>p&&(p=t,b=_):t<f&&(f=t,m=_)}Object(hr["m"])(p>0,"leftArea"),Object(hr["m"])(f<0,"rightArea"),Object(kt["g"])(Kj,Zj,h),Object(kt["m"])(Kj,Kj,Hj),Object(kt["g"])(Jj,Zj,u),Object(kt["m"])(Jj,Jj,Hj),ew[0]=-Zj[1],ew[1]=Zj[0];const g=Object(hr["k"])(r,e[m],Jj,Object(kt["m"])(Xj,Jj,ew),1,n),v=Object(hr["k"])(r,e[b],Jj,Xj,1,a),y=Object(hr["k"])(r,e[b],Kj,Object(kt["m"])(Xj,Kj,ew),1,s),O=Object(hr["k"])(r,e[m],Kj,Xj,1,o);Object(hr["m"])(g,"rayRay"),Object(hr["m"])(v,"rayRay"),Object(hr["m"])(y,"rayRay"),Object(hr["m"])(O,"rayRay")}function iw(e,t){return 3*t+e}const rw=Object(Ut["b"])();function nw(e,t){return Object(kt["s"])(rw,e[t],e[t+3]),rw}const aw=Object(Ut["b"])(),sw=Object(Ai["b"])();function ow(e,t,i,r,n){Object(kt["f"])(aw,i,r),Object(kt["g"])(aw,aw,.5),sw[0]=aw[0],sw[1]=aw[1],sw[2]=0,sw[3]=aw[1],sw[4]=-aw[0],sw[5]=0,sw[6]=aw[0]*aw[0]+aw[1]*aw[1],sw[7]=aw[0]*aw[1]-aw[1]*aw[0],sw[8]=1,sw[iw(0,2)]=-Object(kt["k"])(nw(sw,0),e),sw[iw(1,2)]=-Object(kt["k"])(nw(sw,1),e);let a=Object(kt["k"])(nw(sw,0),i)+sw[iw(0,2)],s=Object(kt["k"])(nw(sw,1),i)+sw[iw(1,2)],o=Object(kt["k"])(nw(sw,0),r)+sw[iw(0,2)],c=Object(kt["k"])(nw(sw,1),r)+sw[iw(1,2)];a=-(a+o)/(s+c),sw[iw(0,0)]+=sw[iw(1,0)]*a,sw[iw(0,1)]+=sw[iw(1,1)]*a,sw[iw(0,2)]+=sw[iw(1,2)]*a,a=1/(Object(kt["k"])(nw(sw,0),i)+sw[iw(0,2)]),s=1/(Object(kt["k"])(nw(sw,1),i)+sw[iw(1,2)]),sw[iw(0,0)]*=a,sw[iw(0,1)]*=a,sw[iw(0,2)]*=a,sw[iw(1,0)]*=s,sw[iw(1,1)]*=s,sw[iw(1,2)]*=s,sw[iw(2,0)]=sw[iw(1,0)],sw[iw(2,1)]=sw[iw(1,1)],sw[iw(2,2)]=sw[iw(1,2)],sw[iw(1,2)]+=1,a=Object(kt["k"])(nw(sw,1),t)+sw[iw(1,2)],s=Object(kt["k"])(nw(sw,2),t)+sw[iw(2,2)],o=Object(kt["k"])(nw(sw,1),i)+sw[iw(1,2)],c=Object(kt["k"])(nw(sw,2),i)+sw[iw(2,2)],a=-.5*(a/s+o/c),sw[iw(1,0)]+=sw[iw(2,0)]*a,sw[iw(1,1)]+=sw[iw(2,1)]*a,sw[iw(1,2)]+=sw[iw(2,2)]*a,a=Object(kt["k"])(nw(sw,1),t)+sw[iw(1,2)],s=Object(kt["k"])(nw(sw,2),t)+sw[iw(2,2)],o=-s/a,sw[iw(1,0)]*=o,sw[iw(1,1)]*=o,sw[iw(1,2)]*=o,n[0]=sw[0],n[1]=sw[1],n[2]=0,n[3]=sw[2],n[4]=sw[3],n[5]=sw[4],n[6]=0,n[7]=sw[5],n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=sw[6],n[13]=sw[7],n[14]=0,n[15]=sw[8]}var cw;let lw=cw=class extends W["a"]{constructor(e,t,i,r,n,a){super({}),this._rctx=e,this._stage=i,this._prepareForShadowMapPass=r,this._renderToShadowMap=n,this._requestRender=a,this._progress=0,this._sampleCount=0,this._cachedCamera=new Fs["a"],this._contentCamera=new Fs["a"],this._enabled=!1,this._cachedLightDirections=[],this._depthRange=n_,this._previewing=!1,this._handles=new $["a"],this._cameraForcedForScreenshot=!1,this._shadowMap=new Cj(e,i.viewingMode),this._shadowMap.enabled=!0,this._vao=Object(ai["d"])(e);const s={colorTarget:0,depthStencilTarget:0,width:0,height:0},o={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:0,height:0};this._fbo=new zi["a"](e,s,o),this._accumulationParams={camera:this._cachedCamera,linearDepthTexture:null,shadowMap:this._shadowMap,inverseView:Object(Vt["d"])(),projInfo:Object(Dt["e"])(),zScale:Object(Ut["b"])()},this._accumulationRenderer=new Sj(t,e,this,a);const c=this._stage.resourceController.scheduler;this._handles.add(c.registerTask(Fi["b"].SHADOW_ACCUMULATOR,this)),this._handles.add(Object(Ft["b"])(()=>i.renderView,e=>{this._handles.remove(cw.renderViewHandleKey),Object(w["k"])(e)||this._handles.add(e.events.on("force-camera-for-screenshot",()=>this._cameraForcedForScreenshot=!0),cw.renderViewHandleKey)},Ft["e"]))}normalizeCtorArgs(){return{}}get computedSamples(){return this._progress}get shadowCastTexture(){return this._fbo.colorTexture}get isAccumulating(){return this._isPreviewing||this._isRefining}get accumulationTechnique(){if(Object(w["k"])(this._accumulationTechnique)){const e={rctx:this._rctx,viewingMode:this._stage.viewingMode},t=new Oj;t.pass=0,this._accumulationTechnique=new yj(e,t)}return this._accumulationTechnique}get _isRefining(){return this._isActive&&!this._isDoneAccumulating&&!this._previewing}get _isPreviewing(){return this._isActive&&this._previewing}get _isActive(){return this._enabled&&this._sampleCount>0}get _canAccumulate(){return null!==this._accumulationParams.linearDepthTexture&&this._depthRange!==n_&&this._opacityFromElevation>wj}get _isDoneAccumulating(){return this._progress>=this._sampleCount}get _lightDirections(){return this._cachedLightDirections}set _lightDirections(e){const t=this._cachedLightDirections;if(Object(R["e"])(t,e,Et["G"]))return;const i=e.length;t.length=i,this._sampleCount=Math.min(vj["c"],i);for(let r=0;r<i;++r){const i=e[r],n=t[r]||Object(F["f"])();Object(Et["n"])(n,i),t[r]=n}this._invalidate()}get _projInfo(){return this._accumulationParams.projInfo}get _zScale(){return this._accumulationParams.zScale}get _inverseView(){return this._accumulationParams.inverseView}get _opacityFromElevation(){return this._accumulationRenderer.opacityFromElevation}set _opacityFromElevation(e){this._accumulationRenderer.opacityFromElevation=e}get running(){return this._isRefining&&this._canAccumulate&&this._progress>0}runTask(e){for(this._prepareForShadowMapPass(this._cachedCamera,this._contentCamera);!e.done&&!this._isDoneAccumulating;)this._accumulateShadow(),e.madeProgress();this._requestRender()}accumulateFixedSamples(){if(!this.isAccumulating||!this._canAccumulate)return;(this._previewing||0===this._progress||this._cameraForcedForScreenshot)&&this._clear();const e=this._cameraForcedForScreenshot?this._sampleCount:Math.min(cw.previewSamples,this._sampleCount-this._progress);for(let t=0;t<e;++t)this._accumulateShadow();this._cameraForcedForScreenshot=!1}render(){this._accumulationRenderer.render()}dispose(){this._stop(),this._handles.destroy(),this._accumulationRenderer=Object(w["f"])(this._accumulationRenderer),this._shadowMap=Object(w["f"])(this._shadowMap),this._fbo=Object(w["f"])(this._fbo),this._vao=Object(w["f"])(this._vao),this._accumulationTechnique=Object(w["f"])(this._accumulationTechnique),this._cachedLightDirections.length=0,this._sampleCount=0}setOptions(e){void 0!==e.enabled&&this._setEnabled(e.enabled),void 0!==e.previewing&&this.setPreviewing(e.previewing),void 0!==e.lightDirections&&this.setLightDirections(e.lightDirections),this._accumulationRenderer.setOptions(e)}setPreviewing(e){this._previewing!==e&&(this._previewing=e,this._requestRenderIfEnabled())}setLightDirections(e){this._lightDirections=e}setAccumulationDependencies(e,t,i,r){this._accumulationParams.linearDepthTexture=e,this._depthRange=t,this._updateCamera(i),this._contentCamera=r,this.notifyChange("_canAccumulate")}readAccumulatedShadow(e,t){if(!this._isActive||this._progress<1||e<0||e>this._fbo.width||t<0||t>this._fbo.height)return 0;const i=dw;return this._fbo.readPixels(e,t,1,1,6408,5121,i),i[0]/this._progress}_start(){this._progress=0,this._enabled=!0}_stop(){this._enabled=!1}_invalidate(){this._progress=0,this._requestRenderIfEnabled()}_clear(){this._rctx.bindFramebuffer(this._fbo),this._rctx.setClearColor(0,0,0,0),this._rctx.clearSafe(16384),this._progress=0}_accumulateShadow(){const e=this._lightDirections[this._progress],t=this._cachedCamera;this._renderToShadowMap(this._shadowMap,e,t,this._depthRange),this._rctx.bindFramebuffer(this._fbo);const i=this.accumulationTechnique;this._rctx.useProgram(i.program),i.bindPipelineState(this._rctx),i.bindPass(this._accumulationParams),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(i.primitiveType,0,Object(rr["e"])(this._vao,"geometry")),this._progress++}_updateCamera(e){if(e.equals(this._cachedCamera))return;const{fullWidth:t,fullHeight:i,projectionMatrix:r,viewMatrix:n,center:a}=e;this._cachedCamera.copyFrom(e),this._fbo.resize(t,i),Object(hr["f"])(r,t,i,this._projInfo,this._zScale),Object(Lt["b"])(this._inverseView,n,a),Object(Lt["c"])(this._inverseView,this._inverseView),this._opacityFromElevation=1-Object(Oe["r"])(xj,jj,e.relativeElevation)}_setEnabled(e){e!==this._enabled&&(e?this._start():this._stop())}_requestRenderIfEnabled(){this._enabled&&this._requestRender()}get test(){return{lightDirections:this._lightDirections,isDone:()=>this._isDoneAccumulating,isActive:()=>this._isActive}}};lw.previewSamples=6,lw.renderViewHandleKey="renderView",Object(h["a"])([Object(M["b"])()],lw.prototype,"_progress",void 0),Object(h["a"])([Object(M["b"])()],lw.prototype,"_sampleCount",void 0),Object(h["a"])([Object(M["b"])()],lw.prototype,"_enabled",void 0),Object(h["a"])([Object(M["b"])()],lw.prototype,"_depthRange",void 0),Object(h["a"])([Object(M["b"])()],lw.prototype,"_previewing",void 0),Object(h["a"])([Object(M["b"])()],lw.prototype,"_accumulationRenderer",void 0),Object(h["a"])([Object(M["b"])()],lw.prototype,"_isRefining",null),Object(h["a"])([Object(M["b"])()],lw.prototype,"_isActive",null),Object(h["a"])([Object(M["b"])()],lw.prototype,"_canAccumulate",null),Object(h["a"])([Object(M["b"])()],lw.prototype,"_isDoneAccumulating",null),Object(h["a"])([Object(M["b"])()],lw.prototype,"_opacityFromElevation",null),Object(h["a"])([Object(M["b"])()],lw.prototype,"running",null),lw=cw=Object(h["a"])([Object(D["a"])("esri.views.3d.webgl-engine.lib.ShadowAccumulator")],lw);const dw=new Uint8Array(4);var hw=i("65c9");const uw=0,pw=1;class fw extends Yt["a"]{initializeProgram(e){const t=fw.shader.get().build({highlightedThreshold:.99999,selfShadowThreshold:.025});return new ei["a"](e.rctx,t,Jt["a"])}initializePipeline(e){return Object(ti["g"])({blending:Object(ti["h"])(770,1,771,771),colorWrite:ti["d"],depthTest:null,depthWrite:null})}bindPass(e,t){if(Object(w["k"])(t.linearDepthTexture))return;this.program.bindTexture(t.linearDepthTexture,"depthMap"),this.program.bindTexture(t.highlightColorTexture,"highlightMap"),Object(Et["t"])(bw,t.lighting.lightingMainDirection,t.camera.viewInverseTransposeMatrix),Object(Et["u"])(bw,bw),Object(hr["f"])(t.camera.projectionMatrix,t.camera.fullWidth,t.camera.fullHeight,gw,mw),Object(Lt["b"])(vw,t.camera.viewMatrix,t.camera.center),Object(Lt["c"])(vw,vw),this.program.setUniform4fv("color",e.shadowColor),this.program.setUniform1f("opacity",e.shadowOpacity),this.program.setUniform1f("occludedOpacity",e.occludedShadowOpacity),this.program.setUniform1f("terminationFactor",e.opacityElevation*e.dayNightTerminator),this.program.setUniform2fv("nearFar",t.camera.nearFar),this.program.setUniformMatrix4fv("inverseView",vw),this.program.setUniform4fv("projInfo",gw),this.program.setUniform2fv("zScale",mw),this.program.setUniform3fv("lightingMainDirectionView",bw),this.program.setUniform2f("texelSize",1/t.linearDepthTexture.descriptor.width,1/t.linearDepthTexture.descriptor.height),t.shadowMap.bind(this.program),t.shadowMap.bindView(this.program,t.camera.center);let i=t.shadowMap.getSnapshot(uw);Object(w["l"])(i)&&this.program.bindTexture(i,"highlightDepthTex"),i=t.shadowMap.getSnapshot(pw),Object(w["l"])(i)&&this.program.bindTexture(i,"defaultDepthTex")}get primitiveType(){return 5}}fw.shader=new Xt["a"](hw["a"],()=>i.e("chunk-2d0bd404").then(i.bind(null,"2acb")));const bw=Object(F["f"])(),mw=Object(Ut["b"])(),gw=Object(Dt["e"])(),vw=Object(Vt["d"])(),yw=.001953125,Ow=4e4,_w=5e4;class xw{constructor(e,t){this._rctx=e,this._viewingMode=t,this._maxOpacity=1,this._parameters={shadowColor:Object(Hb["c"])(1,0,1,1),shadowOpacity:.2,occludedShadowOpacity:.1,opacityElevation:1,dayNightTerminator:1},this._vao=Object(ai["d"])(this._rctx)}get technique(){return Object(w["k"])(this._technique)&&(this._technique=new fw({rctx:this._rctx,viewingMode:this._viewingMode},null)),this._technique}render(e,t){if(this._updateParameters(e),!e.shadowMap.enabled||!e.linearDepthTexture||!this.isVisible)return;const i=this.technique;this._rctx.bindFramebuffer(t),this._rctx.useProgram(i.program),i.bindPipelineState(this._rctx),i.bindPass(this._parameters,e),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(i.primitiveType,0,Object(rr["e"])(this._vao,"geometry"))}get gpuMemoryUsage(){var e,t;return null!=(e=null==(t=this._vao)?void 0:t.size)?e:0}setDefaultOptions(e){this._parameters={...this._parameters,...e},this._updateMaxOpacity()}_updateParameters(e){this._parameters.opacityElevation=1-Object(Oe["r"])(Ow,_w,e.camera.relativeElevation);const t=1===this._viewingMode?Object(Et["u"])(jw,e.camera.center):Object(Et["z"])(jw,0,0,1),i=Object(Et["k"])(t,e.lighting.lightingMainDirection);this._parameters.dayNightTerminator=Object(Oe["r"])(0,1,Object(Oe["f"])(30*i,0,1))}dispose(){this._vao=Object(w["f"])(this._vao),this._technique=Object(w["f"])(this._technique)}get isVisible(){return this._maxOpacity*this._parameters.opacityElevation*this._parameters.dayNightTerminator>=yw}_updateMaxOpacity(){const e=this._parameters,t=e.shadowColor,i=Math.max(e.shadowOpacity,e.occludedShadowOpacity);this._maxOpacity=i*t[3]}}const jw=Object(F["f"])(),ww=Object(k["d"])();class Sw{constructor(){this._worldPlane=ww}get isEnabled(){return this.plane!==ww}get plane(){return this._worldPlane}set plane(e){this._worldPlane=e||ww}}var Tw=i("43a4");class Cw extends Yt["a"]{initializeProgram(e){const t=Cw.shader.get(),i=this.configuration,r=t.build({output:i.output,threshold:.05,localConstrastAdaption:2,maxSearchSteps:8,maxDistanceAreaTex:16});return new ei["a"](e.rctx,r,Jt["a"])}initializePipeline(){return Object(ti["g"])({colorWrite:ti["d"]})}}Cw.shader=new Xt["a"](Tw["a"],()=>i.e("chunk-2d237d1f").then(i.bind(null,"fd6a")));class Pw extends Kt["a"]{constructor(){super(...arguments),this.output=0}}Object(h["a"])([Object(Kt["b"])({count:3})],Pw.prototype,"output",void 0);let Aw=class extends W["a"]{constructor(e,t){super({}),this.rctx=e,this._techniqueRep=t,this._isEnabled=!1}normalizeCtorArgs(){return{}}dispose(){this._abortController=Object(w["a"])(this._abortController),this.disable()}_loadResources(e){if(Object(w["l"])(this._abortController))return!1;if(Object(w["l"])(this._searchTexture))return!0;this._abortController=new AbortController;const t=this._abortController.signal;return i.e("chunk-2d21aaeb").then(i.bind(null,"bd0c")).then(e=>this._loadTextures(e,t)).then(()=>e()).finally(()=>this._abortController=null),!1}_loadTextures(e,t){return Object(S["w"])(t),Promise.all([this.loadTextureFromBase64(e.areaTexture,9729,6407),this.loadTextureFromBase64(e.searchTexure,9728,6409)]).then(([e,i])=>{Object(S["n"])(t)?(e.dispose(),i.dispose(),Object(S["w"])(t)):(this._areaTexture=e,this._searchTexture=i)})}get updating(){return Object(w["l"])(this._abortController)}enable(e){if(this._isEnabled)return!0;if(!this._edgeDetectTechnique||!this._blendWeights||!this._blur){const e=new Pw,t=(e,t)=>this._techniqueRep.releaseAndAcquire(Cw,e,t);e.output=0,this._edgeDetectTechnique=t(e,this._edgeDetectTechnique),e.output=1,this._blendWeights=t(e,this._blendWeights),e.output=2,this._blur=t(e,this._blur)}return!!this._loadResources(e)&&(this._vao=Object(ai["e"])(this.rctx),this._edges=new zi["a"](this.rctx,{colorTarget:0,depthStencilTarget:0},{target:3553,pixelFormat:6407,dataType:5121,samplingMode:9729,wrapMode:33071,width:4,height:4}),this._blend=new zi["a"](this.rctx,{colorTarget:0,depthStencilTarget:0},{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:4,height:4}),this._isEnabled=!0,!0)}disable(){this._isEnabled&&(this._vao=Object(w["f"])(this._vao),this._areaTexture=Object(w["f"])(this._areaTexture),this._searchTexture=Object(w["f"])(this._searchTexture),this._blend=Object(w["f"])(this._blend),this._edges=Object(w["f"])(this._edges),this._isEnabled=!1)}render(e){if(!this._isEnabled)return;const t=this.rctx,i=t.getBoundFramebufferObject(),r={x:0,y:0,width:e.descriptor.width,height:e.descriptor.height};t.bindVAO(this._vao),this._edgeDetectTechnique.bindPipelineState(t),t.setViewport(r.x,r.y,r.width,r.height),this._edges.resize(r.width,r.height),t.bindFramebuffer(this._edges),t.setClearColor(0,0,0,1),t.clear(16384),t.useProgram(this._edgeDetectTechnique.program),this._edgeDetectTechnique.program.bindTexture(e,"tColor"),this._edgeDetectTechnique.program.setUniform4f("uResolution",1/r.width,1/r.height,r.width,r.height),t.drawArrays(4,0,3),this._blend.resize(r.width,r.height),t.bindFramebuffer(this._blend),t.setClearColor(0,0,1,1),t.clear(16384),t.useProgram(this._blendWeights.program),this._blendWeights.program.setUniform4f("uResolution",1/r.width,1/r.height,r.width,r.height),this._blendWeights.program.bindTexture(this._searchTexture,"tSearch"),this._blendWeights.program.bindTexture(this._areaTexture,"tArea"),this._blendWeights.program.bindTexture(this._edges.colorTexture,"tEdges"),t.drawArrays(4,0,3),t.bindFramebuffer(i),t.setClearColor(0,1,0,1),t.clear(16384),t.useProgram(this._blur.program),this._blur.program.setUniform4f("uResolution",1/r.width,1/r.height,r.width,r.height),this._blur.program.bindTexture(e,"tColor"),this._blur.program.bindTexture(this._blend.colorTexture,"tBlendWeights"),t.drawArrays(4,0,3)}loadTextureFromBase64(e,t,i){const r=new ir["a"](this.rctx,{pixelFormat:i,dataType:5121,wrapMode:33071,samplingMode:t},null);return Object(Wi["a"])(e).then(e=>(r.resize(e.width,e.height),r.setData(e),r))}};Object(h["a"])([Object(M["b"])()],Aw.prototype,"_abortController",void 0),Object(h["a"])([Object(M["b"])({readOnly:!0})],Aw.prototype,"updating",null),Aw=Object(h["a"])([Object(D["a"])("esri.views.3d.webgl-engine.lib.SmaaRenderPass")],Aw);var Mw=i("36df");class Rw extends Yt["a"]{initializeProgram(e){const t=Rw.shader.get(),i=this.configuration,r=(Rw.filterRadius+1)/2,n=1/(2*r*r),a=t.build({output:i.output,samples:Rw.samples,filterRadius:Rw.filterRadius,blurFalloff:n});return new ei["a"](e.rctx,a,Jt["a"])}initializePipeline(){return Object(ti["g"])({colorWrite:ti["d"]})}}Rw.shader=new Xt["a"](Mw["a"],()=>i.e("chunk-2d0ab6a6").then(i.bind(null,"14d1"))),Rw.samples=16,Rw.filterRadius=4;class Ew extends Kt["a"]{constructor(){super(...arguments),this.output=0}}Object(h["a"])([Object(Kt["b"])({count:2})],Ew.prototype,"output",void 0);class Dw{constructor(e,t,i){this._techniqueRep=e,this._rctx=t,this._requestRender=i,this._enabled=!1,this._ssaoTechniqueConfig=new Ew,this.quadVAO=null,this._blurSizePx=2,this._attenuation=.5}dispose(){this.quadVAO=Object(w["f"])(this.quadVAO)}set enabled(e){e?this._enable():this._disable()}get enabled(){return this._enabled}get ready(){return this.enabled&&Object(w["l"])(this._noiseTexture)&&Object(w["l"])(this._ssaoFBO)&&Object(w["l"])(this._blur0FBO)&&Object(w["l"])(this._blur1FBO)}computeSSAO(e,t,i){if(!this.enabled||Object(w["k"])(t)||Object(w["k"])(i)||Object(w["k"])(this._noiseTexture)||Object(w["k"])(this._ssaoFBO)||Object(w["k"])(this._blur0FBO)||Object(w["k"])(this._blur1FBO))return;const r=this._rctx,n=e.fullViewport,a=n[2],s=n[3],o=a/this._blurSizePx,c=s/this._blurSizePx;this._ssaoFBO.resize(a,s),this._blur0FBO.resize(o,c),this._blur1FBO.resize(o,c);const l=1,d=1,h=a*l,u=s*d;r.bindFramebuffer(this._ssaoFBO),r.setViewport(0,0,a,s);const p=this._ssaoTechnique.program;r.useProgram(p),this._ssaoTechnique.bindPipelineState(r),p.setUniform2f("rnmScale",a/this._noiseTexture.descriptor.width,s/this._noiseTexture.descriptor.height),Object(hr["f"])(e.projectionMatrix,e.fullWidth,e.fullHeight,Fw,Iw),p.setUniform4fv("projInfo",Fw),p.setUniform2fv("zScale",Iw),p.setUniform2f("nearFar",e.near,e.far);let f=1/e.computeRenderPixelSizeAtDist(1);p.setUniform1f("projScale",f*l),p.setUniform2f("screenDimensions",h,u);const b=Object(Et["p"])(e.eye,e.center);let m=20*e.computeRenderPixelSizeAtDist(b);m=Math.max(.1,m),p.setUniform1f("radius",m),p.setUniform1f("intensity",4*this._attenuation/m**6),p.bindTexture(this._noiseTexture,"rnm"),p.bindTexture(i,"normalMap"),p.bindTexture(t,"depthMap"),Object(w["k"])(this.quadVAO)&&(this.quadVAO=Object(ai["d"])(this._rctx)),r.bindVAO(this.quadVAO),r.drawArrays(5,0,Object(rr["e"])(this.quadVAO,"geometry"));const g=this._blurTechnique.program;r.useProgram(g),g.bindTexture(this._ssaoFBO.colorTexture,"tex"),g.bindTexture(i,"normalMap"),g.bindTexture(t,"depthMap"),r.setViewport(0,0,h/this._blurSizePx,u/this._blurSizePx),r.bindFramebuffer(this._blur0FBO),g.setUniform2f("screenDimensions",h,u),g.setUniform2f("blurSize",0,this._blurSizePx*l/u),g.setUniform2f("nearFar",e.near,e.far),b>5e4&&(f=Math.max(0,f-(b-5e4))),g.setUniform1f("projScale",f),r.drawArrays(5,0,Object(rr["e"])(this.quadVAO,"geometry")),g.setUniform2f("blurSize",this._blurSizePx*d/h,0),r.bindFramebuffer(this._blur1FBO),g.bindTexture(this._blur0FBO.colorTexture,"tex"),r.drawArrays(5,0,Object(rr["e"])(this.quadVAO,"geometry")),r.setViewport(n[0],n[1],n[2],n[3])}bind(e,t){this.enabled&&Object(w["l"])(this._blur1FBO)&&Object(w["l"])(this._ssaoFBO)?(e.bindTexture(this._blur1FBO.colorTexture,"ssaoTex"),e.setUniform4f("viewportPixelSz",t.fullViewport[0],t.fullViewport[1],1/this._ssaoFBO.width,1/this._ssaoFBO.height)):e.setUniform4f("viewportPixelSz",-1,-1,-1,-1)}_selectPrograms(){this._ssaoTechniqueConfig.output=0,this._ssaoTechnique=this._techniqueRep.releaseAndAcquire(Rw,this._ssaoTechniqueConfig,this._ssaoTechnique),this._ssaoTechniqueConfig.output=1,this._blurTechnique=this._techniqueRep.releaseAndAcquire(Rw,this._ssaoTechniqueConfig,this._blurTechnique)}_enable(){this.enabled||(this._enabled=!0,this._loadResources(()=>{this._enabled&&this._initialize()}))}_loadResources(e){this._data?e():i.e("chunk-2d0be660").then(i.bind(null,"2fa7")).then(t=>{this._data=t,e()})}_initialize(){const e={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:0,height:0},t={colorTarget:0,depthStencilTarget:0};Object(Wi["a"])(this._data.noiseTexture).then(i=>{this._enabled&&(this._ssaoFBO=new zi["a"](this._rctx,t,e),this._blur0FBO=new zi["a"](this._rctx,t,e),this._blur1FBO=new zi["a"](this._rctx,t,e),this._noiseTexture=new ir["a"](this._rctx,{target:3553,pixelFormat:6408,dataType:5121,hasMipmap:!0,width:i.width,height:i.height},i),this._requestRender())}),this._selectPrograms()}_disable(){this._enabled=!1,this._noiseTexture=Object(w["f"])(this._noiseTexture),this._blur1FBO=Object(w["f"])(this._blur1FBO),this._blur0FBO=Object(w["f"])(this._blur0FBO),this._ssaoFBO=Object(w["f"])(this._ssaoFBO)}get gpuMemoryUsage(){return(Object(w["l"])(this._blur0FBO)?this._blur0FBO.gpuMemoryUsage:0)+(Object(w["l"])(this._blur1FBO)?this._blur1FBO.gpuMemoryUsage:0)+(Object(w["l"])(this._ssaoFBO)?this._ssaoFBO.gpuMemoryUsage:0)}get test(){return{ssao:this._ssaoFBO,blur:this._blur1FBO}}}const Iw=Object(Ut["b"])(),Fw=Object(Dt["e"])();var zw=i("4c96");function Lw(e,t){const i=t,r=-e[0],n=-e[1],a=-e[2],s=i[3],o=i[7],c=i[11],l=i[15];i[0]+=s*r,i[1]+=s*n,i[2]+=s*a,i[4]+=o*r,i[5]+=o*n,i[6]+=o*a,i[8]+=c*r,i[9]+=c*n,i[10]+=c*a,i[12]+=l*r,i[13]+=l*n,i[14]+=l*a}function Vw(e,t){const i=t,r=e[0],n=e[1],a=e[2];i[12]+=r*i[0]+n*i[4]+a*i[8],i[13]+=r*i[1]+n*i[5]+a*i[9],i[14]+=r*i[2]+n*i[6]+a*i[10],i[14]+=r*i[3]+n*i[7]+a*i[11]}class kw{constructor(e){this.factory=e,this.originData=new Map}acquire(e){return this.register(this.factory.getOrigin(e))}register(e){const t=this.originData.get(e.id);return t?(t.refCount++,t.origin):(this.originData.set(e.id,{refCount:1,viewMatrix:Object(Vt["d"])(),origin:e}),e)}release(e){const t=this.originData.get(e.id);t&&(t.refCount--,0===t.refCount&&this.originData.delete(e.id))}updateViewMatrices(e){this.originData.forEach(t=>{Object(Lt["d"])(t.viewMatrix,e),Vw(t.origin.vec3,t.viewMatrix)})}getViewMatrix(e){return this.originData.get(e.id).viewMatrix}}var Uw=i("5a22"),Bw=i("0c9d"),Nw=i("7e0c"),Gw=i("c6d7"),qw=i("5e2a");const Hw=-4e-4,Ww=.5;class $w extends Yt["a"]{bindPass(e){const t=this.program,{edgeRenderParameters:i,bindParameters:r}=e;A_["a"].bindViewProjTransform(t,i.viewProjectionTransform),t.setUniformMatrix3fv("uTransformNormal_ViewFromGlobal",i.transformNormal_ViewFromGlobal),t.setUniformMatrix4fv("uProj",r.camera.projectionMatrix),t.setUniform2f("uDepthBias",Ww,Hw),t.setUniform2f("uPixelToNDC",2/r.camera.fullViewport[2],2/r.camera.fullViewport[3]),t.setUniform2f("uNDCToPixel",r.camera.fullViewport[2]/2,r.camera.fullViewport[3]/2),t.setUniform1f("uDistanceFalloffFactor",i.distanceFalloffFactor),t.setUniform2f("uViewportDimInv",1/r.camera.fullViewport[2],1/r.camera.fullViewport[3]),t.setUniform1f("uPixelRatio",r.camera.pixelRatio||1)}initializeProgram(e){const t=$w.shader.get(),i=this.configuration,r=t.build({slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,silhouette:i.silhouette,legacy:i.legacy,antialiasing:i.antialiasing,mode:i.mode,doublePrecisionRequiresObfuscation:i.doublePrecisionRequiresObfuscation,multipassTerrainEnabled:i.multipassTerrainEnabled,cullAboveGround:i.cullAboveGround});return new ei["a"](e.rctx,r,Bw["b"])}initializePipeline(e){const t=e.rctx.capabilities.blendMinMax;return Object(ti["g"])(t?{blending:Object(ti["h"])(1,1,0,1,32774,t.MAX),depthTest:{func:515},colorWrite:ti["d"]}:{depthTest:{func:515},depthWrite:ti["e"],colorWrite:ti["d"]})}}$w.shader=new Xt["a"](qw["a"],()=>i.e("chunk-2d21444b").then(i.bind(null,"afe5"))),function(e){class t extends Kt["a"]{constructor(){super(...arguments),this.slicePlaneEnabled=!1,this.silhouette=!1,this.legacy=!1,this.antialiasing=!1,this.mode=0,this.doublePrecisionRequiresObfuscation=!1,this.multipassTerrainEnabled=!1,this.cullAboveGround=!1}}Object(h["a"])([Object(Kt["b"])()],t.prototype,"slicePlaneEnabled",void 0),Object(h["a"])([Object(Kt["b"])()],t.prototype,"silhouette",void 0),Object(h["a"])([Object(Kt["b"])()],t.prototype,"legacy",void 0),Object(h["a"])([Object(Kt["b"])()],t.prototype,"antialiasing",void 0),Object(h["a"])([Object(Kt["b"])({count:3})],t.prototype,"mode",void 0),Object(h["a"])([Object(Kt["b"])()],t.prototype,"doublePrecisionRequiresObfuscation",void 0),Object(h["a"])([Object(Kt["b"])()],t.prototype,"multipassTerrainEnabled",void 0),Object(h["a"])([Object(Kt["b"])()],t.prototype,"cullAboveGround",void 0),e.Configuration=t}($w||($w={}));const Zw=8,Qw=128,Xw={type:"uber",slicePlaneEnabled:!1,sliceHighlightDisabled:!1,strokesTexture:null,legacy:!0};class Yw{constructor(){this._value=0}get value(){return this._value}increment(){this._value++}decrement(){this._value--}}const Kw={solid:0,sketch:1,uber:2};class Jw{constructor(e,t,i){this.rctx=e,this.shaderTechniqueRepository=t,this.config=new $w.Configuration,this.technique=null,this.refCount=new Yw,this.renderables=new Set,this.sortedRenderables={1:{1:new Fh["a"],2:new Fh["a"]},2:{1:new Fh["a"],2:new Fh["a"]}},this.renderablesDirty=!1,this.settings={...Xw,...i},this.key=Jw.getKey(this.settings.type,this.settings.slicePlaneEnabled,this.settings.legacy);const r=this.settings.strokesTexture.variants;this.writerSettings={variants:r,reducedPrecision:Lh["a"].TESTS_DISABLE_OPTIMIZATIONS},this.config.legacy=this.settings.legacy,this.config.mode=Kw[this.settings.type],this.config.silhouette=!1,this.config.antialiasing=!!this.rctx.capabilities.blendMinMax,this.config.slicePlaneEnabled=this.settings.slicePlaneEnabled,this.config.doublePrecisionRequiresObfuscation=Object(E_["b"])(e)}dispose(){this.technique=Object(w["s"])(this.technique)}addRenderable(e){this.renderables.add(e),this.renderablesDirty=!0}removeRenderable(e){this.renderables.delete(e),this.renderablesDirty=!0}setRenderablesDirty(){this.renderablesDirty=!0}forEachRenderable(e,t){this.renderablesDirty&&this.sortRenderables(),this.sortedRenderables[t][1].forAll(e),this.sortedRenderables[t][2].forAll(e)}setMultipassParameters(e){this.config.multipassTerrainEnabled=!!e.multipassTerrainEnabled&&e.multipassTerrainEnabled,this.config.cullAboveGround=!!e.cullAboveGround&&e.cullAboveGround}bindRegularEdges(e,t){this.setMultipassParameters(e),this.config.silhouette=!1,this.technique=this.shaderTechniqueRepository.releaseAndAcquire($w,this.config,this.technique),this.technique.bindPass({bindParameters:e,edgeRenderParameters:t}),this.technique.bindPipelineState(this.rctx,e.slot),this.rctx.useProgram(this.technique.program)}bindSilhouetteEdges(e,t){this.setMultipassParameters(e),this.config.silhouette=!0,this.technique=this.shaderTechniqueRepository.releaseAndAcquire($w,this.config,this.technique),this.technique.bindPass({bindParameters:e,edgeRenderParameters:t}),this.technique.bindPipelineState(this.rctx,e.slot),this.rctx.useProgram(this.technique.program)}renderRegularEdges(e,t,i){this.render(e,e.regular.vao,t,i)}renderSilhouetteEdges(e,t,i){this.render(e,e.silhouette.vao,t,i)}render(e,t,i,r){this.setUniforms(e,i),this.rctx.bindVAO(t),this.rctx.capabilities.instancing.drawArraysInstanced(6,0,4,r)}setUniforms(e,t){const i=this.technique.program;if(e.components.buffer.textureBuffer.bind(i,eS,tS),t.multipassTerrainEnabled&&(i.setUniform2fv("cameraNearFar",t.camera.nearFar),i.setUniform2fv("inverseViewport",t.inverseViewport),Object(Gw["a"])(i,t)),"origin"in e.transform)i.setUniformMatrix4fv("uView",t.localViewMatrixForEdges),i.setUniformMatrix4fv("uModel",e.transform.modelMatrix),Object(Ly["b"])(i,this.settings,t.slicePlane,e.transform.origin.vec3);else{const r=new $_(e.transform.position),n=Object(Pi["o"])(iS,Object(Pi["e"])(iS,e.transform.rotationScale)),a=new F_;Object(Et["n"])(a.worldFromModel_TL,r.low),Object(Et["n"])(a.worldFromModel_TH,r.high),Object(Pi["g"])(a.worldFromModel_RS,e.transform.rotationScale),Object(Pi["g"])(a.transformNormal_GlobalFromModel,n),A_["a"].bindModelTransform(i,a),i.setUniformMatrix3fv("uTransformNormal_GlobalFromModel",a.transformNormal_GlobalFromModel);const s=t.camera.viewInverseTransposeMatrix,o=Object(Et["z"])(rS,s[3],s[7],s[11]);Object(Ly["b"])(i,this.settings,t.slicePlane,o)}"uber"!==this.settings.type&&"sketch"!==this.settings.type||this.setSketchUniforms(i),i.setUniform1f("uWorldLineRadiusPerDistance",Math.tan(t.camera.fovY/2)/(t.camera.fullViewport[3]/2))}setSketchUniforms(e){const t=this.settings.strokesTexture,i=t.texture;Object(w["k"])(i)||(e.bindTexture(i,"uStrokesTexture"),e.setUniform2f("uStrokesTextureScale",1/i.descriptor.width,1/i.descriptor.height),e.setUniform1f("uStrokesLog2Resolution",Math.log2(t.resolution)),e.setUniform1f("uStrokesNormalizationScale",t.normalizationScale),e.setUniform1f("uStrokesAmplitude",t.amplitude),e.setUniform1f("uStrokeVariants",t.variants))}sortRenderables(){this.renderablesDirty=!1,this.sortedRenderables[1][1].clear(),this.sortedRenderables[1][2].clear(),this.sortedRenderables[2][1].clear(),this.sortedRenderables[2][2].clear(),this.renderables.forEach(e=>{0!==e.objectTransparency&&0!==e.edgeTransparency&&this.sortedRenderables[e.objectTransparency][e.edgeTransparency].push(e)});const e=(e,t)=>"origin"in e.transform&&"origin"in t.transform?e.transform.origin.id<t.transform.origin.id?-1:e.transform.origin.id>t.transform.origin.id?1:0:0;this.sortedRenderables[1][1].sort(e),this.sortedRenderables[1][2].sort(e),this.sortedRenderables[2][1].sort(e),this.sortedRenderables[2][2].sort(e)}static getKey(e,t,i){return`edges-t:${e}:${t}:${i}`}}const eS="uComponentDataTex",tS="uComponentDataTexInvDim",iS=Object(MO["b"])(),rS=Object(F["f"])();var nS=i("78ba"),aS=i("0480"),sS=i("2273");class oS extends nS["a"]{constructor(e){super("EdgeProcessingWorker","wrappedWork",e)}async process(e,t,i){if(i)return Object(sS["work"])(e);const r=this._packInput(e),n=await this.invoke(r,t);return this._unpackOutput(n)}getTransferList(e){return[e.dataBuffer]}_packInput(e){return{dataBuffer:e.data.buffer,writerSettings:e.writerSettings,skipDeduplicate:e.skipDeduplicate,indicesBuffer:e.indices.buffer,indicesType:Object(DO["j"])(e.indices)?"Uint32Array":"Uint16Array",indicesLength:e.indicesLength}}_unpackOutput(e){return{regular:{instancesData:Object(aS["b"])(e.regular.instancesData),lodInfo:{lengths:new Float32Array(e.regular.lodInfo.lengths)}},silhouette:{instancesData:Object(aS["b"])(e.silhouette.instancesData),lodInfo:{lengths:new Float32Array(e.silhouette.lodInfo.lengths)}},averageEdgeLength:e.averageEdgeLength}}}function cS(e){const t=4,i=pS.resolution,r=i/2,n=new Uint8Array(t*i*i),a=t*i*r,s=pS.amplitude,o=2*s,c=t*i,l=Math.log2(i)+1,d=pS.strokes.length;let h=(l-1)*d*c;for(const{distance:p,pressure:f}of pS.strokes){let e=p,i=f,r=h;for(let s=0;s<l;s++){0!==s&&(e=lS(e,0),i=lS(i,1));for(let s=0;s<pS.resolution;s++){const c=.5+(e?e[s%e.length]/o:0),l=i?i[s%i.length]:1;Object(px["a"])(c,n,r),Object(px["a"])(l,n,r+a),r+=t}r-=c*(d+1)}h+=c}const u=new ir["a"](e,{pixelFormat:6408,dataType:5121,hasMipmap:!1,samplingMode:9729,width:i,height:i,wrapMode:10497},n);return new uS(i,o,s,d,u)}function lS(e,t){if(!e)return null;const i=e.length/2,r=dS*i,n=new Array(i);let a=0;const s=1===t;for(let o=0;o<e.length;o+=2){const t=(e[o]+e[o+1])/2;n[a++]=s?Math.min(r,1-(1-t)*hS):Math.min(r,t*hS)}return n}const dS=.1,hS=.5;class uS{constructor(e,t,i,r,n){this.resolution=e,this.normalizationScale=t,this.amplitude=i,this.variants=r,this.texture=n}dispose(){this.texture=Object(w["f"])(this.texture)}}const pS={amplitude:8,resolution:256,strokes:[{distance:[-1.59027,-1.59426,-1.59674,-1.59766,-1.59702,-1.59479,-1.59095,-1.5855,-1.57843,-1.56973,-1.55942,-1.5475,-1.53398,-1.5189,-1.50226,-1.4841,-1.46446,-1.44337,-1.42088,-1.39703,-1.37188,-1.34547,-1.31786,-1.28912,-1.2593,-1.22847,-1.19668,-1.16402,-1.13053,-1.09629,-1.06137,-1.02582,-.98972,-.95313,-.91611,-.87872,-.84102,-.80306,-.76488,-.72654,-.68807,-.64952,-.61092,-.57232,-.53375,-.49527,-.45692,-.41874,-.38078,-.34309,-.3057,-.26867,-.23204,-.19585,-.16015,-.12497,-.09036,-.05634,-.02296,.00977,.04183,.07321,.10389,.13386,.16313,.19169,.21956,.24672,.27321,.299,.32413,.34858,.37237,.3955,.41798,.43981,.461,.48154,.50145,.52073,.53939,.55744,.57488,.5917,.6079,.62347,.63837,.65259,.66609,.67885,.69083,.70201,.71235,.72183,.73042,.73812,.7449,.75076,.7557,.75973,.76284,.76507,.76642,.76692,.76659,.76545,.76352,.76083,.7574,.75324,.74837,.74279,.73652,.72959,.72199,.71377,.70493,.69553,.68558,.67515,.66426,.65298,.64135,.62944,.6173,.60499,.59257,.58008,.56759,.55513,.54275,.5305,.51842,.50654,.4949,.48353,.47246,.4617,.45128,.44121,.43149,.42213,.41313,.40448,.39617,.38818,.3805,.37309,.36594,.35902,.35229,.34572,.33927,.33292,.32663,.32035,.31407,.30774,.30135,.29486,.28824,.28148,.27454,.26739,.26002,.25241,.24454,.23639,.22796,.21922,.21016,.20076,.19098,.18082,.17023,.1592,.14768,.13566,.1231,.10996,.09624,.08188,.06688,.05121,.03485,.01778,0,-.0185,-.03771,-.05763,-.07824,-.09952,-.12144,-.14396,-.16706,-.19069,-.21481,-.23938,-.26436,-.28971,-.31539,-.34136,-.36759,-.39404,-.42067,-.44746,-.47437,-.50136,-.52839,-.55544,-.58248,-.60948,-.63642,-.66329,-.6901,-.71684,-.74352,-.77015,-.79675,-.82332,-.84988,-.87644,-.90301,-.92958,-.95615,-.98272,-1.00926,-1.03575,-1.06217,-1.08847,-1.11463,-1.1406,-1.16633,-1.19178,-1.2169,-1.24164,-1.26595,-1.28979,-1.31312,-1.3359,-1.35809,-1.37963,-1.4005,-1.42064,-1.44,-1.45853,-1.47616,-1.49285,-1.50853,-1.52313,-1.53659,-1.54886,-1.55986,-1.56955,-1.57788,-1.5848],pressure:[-.01365,-.00206,.01025,.02327,.03696,.05129,.06619,.08163,.09755,.11393,.1307,.14784,.16531,.18308,.20111,.21938,.23786,.25651,.2753,.29419,.31315,.33215,.35115,.37015,.38913,.40806,.42694,.44576,.46449,.48313,.50167,.5201,.53839,.55653,.57448,.59222,.60971,.62692,.6438,.66033,.67648,.69221,.70753,.72242,.73688,.75093,.76456,.77779,.79063,.80309,.81517,.82686,.83817,.84911,.85967,.86987,.87972,.88924,.89845,.90734,.91594,.92425,.93229,.94005,.94754,.95475,.96166,.96826,.97451,.9804,.98588,.99092,.99549,.99957,.99685,.99381,.99131,.98936,.98796,.98711,.98681,.98706,.98787,.98923,.99113,.99357,.99654,1,.99607,.99171,.98695,.98181,.97634,.97057,.96452,.95824,.95175,.94506,.93818,.93113,.92389,.91647,.90887,.90109,.89314,.88501,.87672,.86831,.85978,.85119,.84256,.83393,.82533,.8168,.80836,.80002,.79181,.78374,.77582,.7681,.76059,.75331,.74629,.73955,.73311,.72697,.72116,.71568,.71054,.70572,.70121,.697,.69304,.68931,.68576,.68236,.67905,.67582,.67262,.66941,.66619,.66291,.65957,.65613,.65259,.64892,.6451,.6411,.6369,.63248,.62783,.62295,.61783,.61247,.60688,.60104,.59498,.58868,.58216,.57542,.56845,.56125,.5538,.5461,.53813,.52986,.52129,.51239,.50316,.49359,.4837,.47349,.46299,.45223,.44124,.43005,.41869,.40719,.39557,.38386,.37207,.36023,.34836,.33648,.32464,.31287,.30119,.28963,.27822,.26698,.25594,.2451,.23448,.22409,.21391,.20394,.19415,.18452,.17503,.16565,.15636,.14713,.13794,.1288,.11968,.11058,.10151,.09247,.08346,.07447,.06552,.05659,.0477,.03885,.03007,.02137,.01278,.00433,-.00393,-.012,-.01983,-.02738,-.03463,-.04155,-.0481,-.05429,-.0601,-.06553,-.07057,-.07524,-.07954,-.08347,-.08703,-.09022,-.09303,-.09544,-.09744,-.09898,-.10004,-.10059,-.1006,-.10005,-.09892,-.0972,-.09487,-.09192,-.08833,-.08409,-.07918,-.07357,-.06724,-.06019,-.0524,-.04386,-.03455,-.02448]},{distance:[-3.46259,-3.47131,-3.47668,-3.47863,-3.47712,-3.4721,-3.46352,-3.45138,-3.43566,-3.41635,-3.39347,-3.36704,-3.33709,-3.30368,-3.26684,-3.22667,-3.18322,-3.1366,-3.08689,-3.0342,-2.97865,-2.92036,-2.85946,-2.79607,-2.73034,-2.66241,-2.59242,-2.52052,-2.44686,-2.37159,-2.29485,-2.2168,-2.13757,-2.05731,-1.97616,-1.89426,-1.81174,-1.72875,-1.64543,-1.56191,-1.47833,-1.39483,-1.3115,-1.22847,-1.14581,-1.06361,-.98193,-.90083,-.82036,-.74054,-.66141,-.583,-.50532,-.4284,-.35228,-.277,-.20261,-.12916,-.05672,.01463,.08485,.15384,.22153,.28784,.35269,.41602,.47776,.53787,.59629,.653,.70799,.76123,.81274,.86253,.9106,.95698,1.0017,1.04477,1.0862,1.126,1.16415,1.20065,1.23546,1.26857,1.29994,1.32953,1.35731,1.38321,1.40719,1.42921,1.44922,1.46719,1.48309,1.49691,1.50862,1.51825,1.52581,1.53133,1.53486,1.53644,1.53616,1.53409,1.53031,1.52493,1.51803,1.50972,1.50009,1.48924,1.47725,1.46421,1.45019,1.43527,1.4195,1.40295,1.38568,1.36778,1.34929,1.3303,1.31087,1.29108,1.27099,1.25066,1.23018,1.2096,1.18898,1.16838,1.14785,1.12745,1.10721,1.08719,1.06741,1.04791,1.02871,1.00986,.99136,.97324,.95551,.93819,.92127,.90476,.88866,.87296,.85767,.84277,.82823,.81406,.80022,.7867,.77346,.76049,.74774,.73519,.72278,.71049,.69827,.68606,.67381,.66145,.64893,.63618,.62313,.60973,.5959,.5816,.56675,.5513,.53516,.51826,.50053,.4819,.46231,.44169,.42002,.39725,.37336,.34834,.32219,.2949,.2665,.23698,.20638,.17469,.14193,.10809,.07316,.03714,0,-.03827,-.07772,-.11836,-.16022,-.20332,-.24768,-.29332,-.34024,-.38844,-.43788,-.48854,-.54036,-.59329,-.64724,-.70211,-.75782,-.81425,-.87128,-.92881,-.98674,-1.04498,-1.10346,-1.1621,-1.22086,-1.27969,-1.33854,-1.3974,-1.45625,-1.51511,-1.57396,-1.63283,-1.69173,-1.75067,-1.80968,-1.86875,-1.9279,-1.98712,-2.04639,-2.10568,-2.16495,-2.22416,-2.28322,-2.34208,-2.40063,-2.4588,-2.51647,-2.57354,-2.62989,-2.68543,-2.74002,-2.79357,-2.84597,-2.89711,-2.94689,-2.99521,-3.04195,-3.087,-3.13023,-3.17152,-3.21075,-3.24779,-3.28252,-3.3148,-3.34451,-3.37154,-3.39577,-3.41709,-3.43539,-3.45059],pressure:[.87183,.87151,.87129,.87118,.87117,.87128,.87149,.87182,.87225,.8728,.87347,.87424,.87513,.87613,.87723,.87845,.87978,.88122,.88276,.88441,.88616,.88801,.88996,.892,.89414,.89637,.89868,.90108,.90356,.90611,.90874,.91144,.91421,.91704,.91993,.92287,.92587,.92892,.93201,.93514,.93831,.94151,.94474,.94799,.95126,.95456,.95786,.96118,.9645,.96783,.97116,.97448,.9778,.98111,.98441,.9877,.99096,.99421,.99742,.99938,.99622,.9931,.99001,.98697,.98397,.98101,.97811,.97526,.97246,.96972,.96703,.96441,.96185,.95935,.95691,.95455,.95225,.95002,.94786,.94577,.94376,.94182,.93995,.93817,.93646,.93483,.93328,.93181,.93042,.92911,.92788,.92673,.92566,.92467,.92376,.92293,.92217,.92149,.92088,.92034,.91987,.91947,.91913,.91886,.91864,.91849,.91838,.91833,.91834,.91839,.91849,.91863,.91883,.91907,.91935,.91968,.92005,.92046,.92092,.92142,.92195,.92253,.92314,.9238,.92449,.92521,.92598,.92677,.9276,.92847,.92936,.93029,.93125,.93224,.93325,.9343,.93537,.93646,.93758,.93872,.93988,.94106,.94225,.94346,.94469,.94593,.94718,.94844,.94971,.95098,.95226,.95354,.95482,.9561,.95738,.95867,.95995,.96122,.9625,.96377,.96504,.9663,.96757,.96883,.97009,.97135,.97261,.97387,.97513,.9764,.97767,.97895,.98023,.98153,.98284,.98416,.98549,.98684,.98821,.9896,.99101,.99244,.99389,.99537,.99688,.99842,1,.99839,.99675,.99508,.99336,.99161,.98982,.98799,.98613,.98422,.98228,.98029,.97827,.97622,.97414,.97202,.96987,.9677,.96551,.9633,.96107,.95882,.95656,.9543,.95202,.94975,.94747,.94519,.94292,.94065,.93838,.93613,.93388,.93164,.92941,.9272,.92499,.9228,.92062,.91846,.91631,.91418,.91207,.90998,.90792,.90588,.90387,.90189,.89995,.89804,.89617,.89434,.89256,.89083,.88914,.88752,.88595,.88443,.88299,.88161,.8803,.87907,.87791,.87683,.87584,.87494,.87412,.8734,.87278,.87225]},{distance:[.39335,.43437,.47737,.52234,.56923,.61801,.66864,.72109,.7753,.83123,.88882,.94801,1.00875,1.07097,1.13461,1.1996,1.26586,1.33333,1.40193,1.47158,1.54221,1.61373,1.68607,1.75913,1.83284,1.90711,1.98186,2.05699,2.13243,2.20809,2.28387,2.35971,2.4355,2.51117,2.58663,2.66179,2.73658,2.81092,2.88473,2.95792,3.03043,3.10217,3.17308,3.24309,3.31211,3.3801,3.44697,3.51267,3.57712,3.64028,3.70208,3.76247,3.8214,3.87881,3.93467,3.98892,4.04152,4.09244,4.14164,4.18908,4.23474,4.27859,4.32061,4.36077,4.39905,4.43544,4.46992,4.50249,4.53314,4.56185,4.58864,4.61349,4.63642,4.65745,4.67657,4.69381,4.7092,4.72274,4.73447,4.74441,4.75259,4.75903,4.76376,4.76682,4.76822,4.768,4.76618,4.76279,4.75786,4.75142,4.74348,4.73409,4.72326,4.71102,4.69739,4.68241,4.6661,4.64849,4.6296,4.60948,4.58816,4.56567,4.54204,4.51732,4.49154,4.46473,4.43694,4.4082,4.37854,4.348,4.31662,4.28443,4.25145,4.21773,4.1833,4.14819,4.11243,4.07606,4.03912,4.00162,3.96361,3.92512,3.88618,3.84683,3.80708,3.76697,3.72653,3.68579,3.64478,3.60351,3.56202,3.52033,3.47845,3.43642,3.39425,3.35196,3.30957,3.2671,3.22455,3.18196,3.13933,3.09668,3.05402,3.01136,2.96873,2.92613,2.88357,2.84108,2.79865,2.75631,2.71407,2.67195,2.62994,2.58807,2.54634,2.50477,2.46338,2.42216,2.38114,2.34032,2.29971,2.25933,2.21916,2.17923,2.13954,2.10008,2.06087,2.02189,1.98316,1.94468,1.90644,1.86845,1.83069,1.79316,1.75586,1.71877,1.68189,1.6452,1.60868,1.57232,1.53611,1.50004,1.46407,1.4282,1.39241,1.35668,1.321,1.28535,1.24972,1.2141,1.17849,1.14286,1.10723,1.07158,1.03593,1.00028,.96464,.92902,.89344,.85793,.8225,.78719,.75203,.71705,.68231,.64784,.61369,.57991,.54656,.51368,.48134,.44959,.41849,.3881,.35848,.32967,.30174,.27474,.24872,.22373,.19982,.17702,.15539,.13497,.11579,.09791,.08137,.06621,.05248,.04022,.02948,.02029,.01271,.00677,.00252,0,-76e-5,27e-5,.00314,.00788,.01451,.02307,.03357,.04604,.0605,.07697,.09546,.11599,.13858,.16322,.18992,.21869,.24952,.28241,.31735,.35434],pressure:[.95248,.95236,.95228,.95223,.95222,.95224,.95231,.95241,.95256,.95274,.95296,.95322,.95352,.95385,.95423,.95465,.9551,.9556,.95613,.9567,.95731,.95796,.95864,.95936,.96012,.96091,.96173,.96259,.96348,.9644,.96535,.96633,.96734,.96838,.96944,.97053,.97164,.97277,.97393,.9751,.97629,.9775,.97873,.97997,.98122,.98249,.98376,.98505,.98634,.98763,.98893,.99023,.99154,.99284,.99414,.99544,.99673,.99802,.9993,.99942,.99816,.99691,.99568,.99445,.99324,.99205,.99087,.98972,.98858,.98746,.98636,.98528,.98423,.9832,.98219,.98121,.98025,.97931,.9784,.97752,.97666,.97582,.97501,.97423,.97347,.97274,.97203,.97135,.9707,.97007,.96948,.9689,.96836,.96784,.96735,.96689,.96646,.96605,.96567,.96533,.965,.96471,.96445,.96421,.964,.96382,.96367,.96355,.96346,.96339,.96335,.96334,.96336,.9634,.96348,.96358,.9637,.96385,.96403,.96423,.96446,.96471,.96499,.96529,.96561,.96595,.96631,.96669,.96709,.96751,.96795,.9684,.96887,.96935,.96984,.97035,.97087,.9714,.97194,.97249,.97304,.97361,.97418,.97476,.97534,.97592,.97651,.97711,.9777,.9783,.9789,.9795,.9801,.9807,.9813,.9819,.9825,.98309,.98369,.98428,.98486,.98545,.98603,.98661,.98718,.98775,.98832,.98888,.98944,.99,.99056,.99112,.99167,.99223,.99279,.99335,.99392,.99449,.99507,.99565,.99624,.99684,.99745,.99807,.9987,.99934,1,.99933,.99866,.99797,.99727,.99656,.99583,.9951,.99435,.99359,.99283,.99205,.99126,.99046,.98966,.98885,.98803,.9872,.98637,.98554,.9847,.98387,.98303,.98219,.98134,.9805,.97967,.97883,.978,.97717,.97634,.97552,.97471,.97389,.97309,.97229,.9715,.97071,.96993,.96915,.96838,.96762,.96687,.96612,.96539,.96466,.96395,.96324,.96255,.96187,.9612,.96055,.95991,.95929,.95869,.95811,.95754,.957,.95648,.95599,.95552,.95508,.95467,.95428,.95393,.9536,.95331,.95305,.95283,.95264]},{distance:[2.85606,2.86149,2.86432,2.8645,2.862,2.85686,2.84912,2.83886,2.82618,2.81117,2.79393,2.77456,2.75314,2.72975,2.70447,2.67734,2.64844,2.61784,2.58564,2.55196,2.5169,2.48057,2.44305,2.40438,2.36462,2.32383,2.28208,2.23943,2.19591,2.15153,2.10628,2.06016,2.01321,1.96548,1.91702,1.86793,1.8183,1.76829,1.71803,1.66767,1.61737,1.56726,1.51746,1.46803,1.41902,1.37044,1.32228,1.27452,1.22716,1.18023,1.13376,1.08781,1.04244,.99769,.95357,.91003,.86701,.82447,.78238,.74069,.69938,.65836,.61758,.57699,.53656,.49627,.45611,.41611,.37632,.33683,.29776,.25924,.22141,.18441,.14839,.11346,.07972,.04727,.01619,-.01348,-.0417,-.0684,-.09351,-.11698,-.13875,-.1588,-.17713,-.19381,-.20889,-.22242,-.23444,-.24501,-.25421,-.26216,-.26897,-.27473,-.27951,-.28336,-.28631,-.28836,-.28948,-.28963,-.28873,-.28673,-.28355,-.27916,-.27354,-.26673,-.25878,-.2498,-.23992,-.22929,-.21802,-.20623,-.19398,-.18134,-.16836,-.1551,-.14163,-.12809,-.11461,-.1013,-.08826,-.07557,-.06335,-.0517,-.04077,-.03065,-.02143,-.01321,-.00606,0,.00496,.00888,.01181,.01385,.01511,.0157,.01574,.01533,.01458,.01358,.0124,.01112,.00979,.00851,.00738,.0065,.006,.00596,.00646,.00754,.00924,.01161,.01471,.01858,.02323,.02865,.03481,.04169,.0493,.05765,.06677,.07671,.08754,.09934,.11222,.12628,.14159,.15823,.17624,.19561,.21632,.23828,.26142,.28563,.31083,.33696,.36397,.39185,.42057,.4501,.48036,.51125,.54264,.5744,.60646,.63871,.67105,.70337,.73556,.76751,.79918,.83048,.86139,.8919,.92202,.95184,.98144,1.01094,1.04045,1.0701,1.10002,1.13029,1.16103,1.1923,1.22416,1.25664,1.28979,1.32364,1.35824,1.39363,1.42985,1.4669,1.50475,1.54332,1.58252,1.62227,1.6625,1.70312,1.744,1.78501,1.82598,1.8668,1.90734,1.94754,1.98732,2.02666,2.06555,2.10402,2.1421,2.17985,2.2173,2.25448,2.29139,2.328,2.36424,2.4,2.43515,2.46955,2.50309,2.53565,2.56717,2.59761,2.62692,2.65505,2.68191,2.7074,2.73138,2.75375,2.7744,2.79324,2.81017,2.82504,2.83772,2.8481],pressure:[.22758,.23641,.24578,.25568,.26609,.27699,.28835,.30016,.31237,.32495,.33789,.35113,.36466,.37843,.39241,.40658,.4209,.43535,.44989,.4645,.47916,.49385,.50853,.5232,.53784,.55243,.56696,.58141,.59578,.61004,.62419,.63821,.65209,.6658,.67934,.69268,.70582,.71873,.73139,.7438,.75594,.76779,.77935,.79061,.80156,.81221,.82254,.83258,.84231,.85176,.86091,.86978,.87837,.88669,.89473,.9025,.91,.91725,.92425,.931,.93752,.9438,.94985,.95566,.96124,.96658,.97168,.97652,.98109,.98539,.98939,.99309,.99646,.99949,.99783,.99552,.99361,.99209,.99098,.99029,.99003,.99019,.99079,.99181,.99324,.9951,.99735,1,.99698,.99361,.98992,.98592,.98163,.97709,.97231,.96731,.96212,.95676,.95122,.94554,.93973,.93378,.92773,.92157,.91532,.90899,.90258,.89612,.88961,.88308,.87653,.87,.8635,.85705,.85068,.8444,.83823,.83219,.82628,.82052,.81493,.80952,.8043,.79929,.7945,.78994,.78561,.78151,.77765,.77402,.77062,.76742,.76443,.76161,.75896,.75645,.75406,.75175,.74951,.7473,.74511,.74289,.74064,.73833,.73592,.73341,.73078,.728,.72507,.72197,.71869,.71522,.71156,.70769,.70363,.69936,.69489,.69021,.68533,.68023,.67492,.66939,.66363,.65765,.65145,.64501,.63833,.63143,.62428,.61691,.60931,.60148,.59344,.58521,.57679,.5682,.55948,.55063,.54167,.53264,.52354,.51439,.50522,.49603,.48686,.47773,.46865,.45964,.45072,.44192,.43324,.42469,.41629,.40804,.39994,.392,.3842,.37655,.36903,.36164,.35437,.3472,.34012,.33312,.3262,.31933,.31251,.30574,.299,.2923,.28563,.27899,.27239,.26583,.25933,.25288,.24652,.24025,.2341,.22808,.22221,.21653,.21104,.20576,.20072,.19592,.19138,.18712,.18313,.17943,.17602,.17292,.17013,.16766,.16551,.16369,.16222,.1611,.16036,.16001,.16007,.16055,.16148,.16286,.16471,.16705,.16988,.17321,.17706,.18144,.18636,.19182,.19785,.20443,.21158,.2193]},{distance:[-2.31317,-2.3191,-2.32189,-2.32154,-2.31811,-2.31174,-2.30254,-2.29062,-2.27609,-2.25904,-2.23954,-2.21767,-2.19355,-2.16732,-2.13907,-2.10885,-2.07672,-2.04268,-2.00677,-1.96911,-1.92985,-1.88914,-1.84713,-1.80397,-1.75979,-1.71467,-1.66864,-1.62171,-1.57395,-1.52546,-1.47625,-1.42628,-1.3755,-1.32384,-1.27131,-1.218,-1.16408,-1.10972,-1.05508,-1.00031,-.94551,-.89077,-.83615,-.7817,-.72757,-.6739,-.62076,-.56821,-.51625,-.46484,-.41397,-.36366,-.314,-.26506,-.21689,-.16957,-.12316,-.07766,-.03301,.01085,.05399,.09643,.13827,.17967,.22079,.26176,.30265,.34342,.38397,.42414,.46381,.50285,.54115,.57863,.61524,.65093,.6856,.71914,.75153,.78275,.81283,.84182,.86972,.89651,.92208,.94634,.96919,.99052,1.01025,1.02835,1.04484,1.05976,1.07309,1.08479,1.09492,1.1036,1.11096,1.11714,1.12224,1.12627,1.12916,1.13083,1.13125,1.13036,1.12816,1.12466,1.11992,1.11397,1.10677,1.09827,1.08849,1.07746,1.06527,1.05203,1.03786,1.02283,1.00695,.99025,.97279,.9546,.93573,.9163,.8965,.8765,.85647,.83652,.81687,.79775,.77939,.76199,.74568,.73049,.71635,.70316,.69082,.67925,.66834,.65804,.64831,.63911,.63032,.62184,.61363,.60564,.59788,.59036,.58308,.57597,.5689,.56177,.55447,.5469,.53896,.53062,.5219,.51283,.5034,.49355,.48335,.47287,.46223,.45154,.44085,.43012,.41923,.40805,.39648,.38441,.37176,.35849,.34458,.32999,.31461,.29833,.28109,.26288,.2437,.22361,.20265,.18082,.15807,.13434,.1096,.0838,.0569,.02894,0,-.0298,-.0604,-.09173,-.12364,-.15594,-.18843,-.22092,-.25331,-.28559,-.31781,-.35006,-.38244,-.41502,-.44785,-.48098,-.5144,-.54811,-.58218,-.61666,-.65153,-.68677,-.72232,-.75807,-.79397,-.83002,-.86628,-.90281,-.93968,-.97693,-1.01465,-1.05282,-1.09139,-1.13031,-1.16956,-1.20917,-1.24905,-1.28907,-1.32908,-1.36891,-1.40844,-1.44765,-1.48658,-1.52527,-1.56376,-1.60206,-1.64016,-1.67801,-1.71552,-1.75264,-1.78936,-1.8257,-1.86161,-1.89702,-1.93182,-1.96584,-1.99894,-2.03102,-2.06203,-2.0919,-2.12056,-2.14794,-2.17397,-2.19852,-2.22138,-2.24235,-2.26129,-2.27805,-2.29243,-2.30422],pressure:[.9681,.97424,.98046,.98674,.99309,.9995,.99404,.98754,.981,.97444,.96785,.96124,.95462,.94801,.94139,.93479,.92822,.92167,.91515,.90868,.90225,.89589,.88959,.88336,.87722,.87115,.86519,.85932,.85356,.84792,.84239,.83699,.83173,.8266,.82162,.81679,.81211,.80759,.80324,.79906,.79505,.79121,.78756,.78409,.78081,.77771,.77481,.77211,.76959,.76728,.76516,.76324,.76153,.76001,.75869,.75757,.75665,.75593,.7554,.75507,.75493,.75498,.75523,.75565,.75627,.75706,.75803,.75917,.76049,.76197,.76361,.76541,.76737,.76947,.77172,.77409,.7766,.77923,.78198,.78484,.7878,.79086,.79401,.79724,.80055,.80394,.8074,.81092,.8145,.81813,.82182,.82556,.82934,.83317,.83703,.84093,.84487,.84884,.85284,.85687,.86094,.86503,.86915,.87329,.87746,.88166,.88587,.89011,.89436,.89863,.90291,.9072,.91149,.91579,.92009,.92438,.92867,.93295,.9372,.94144,.94566,.94985,.954,.95812,.96219,.96623,.97021,.97415,.97802,.98184,.9856,.9893,.99293,.9965,1,.99657,.9932,.98991,.98668,.98352,.98042,.97738,.9744,.97148,.9686,.96577,.96298,.96023,.95751,.95482,.95214,.94949,.94684,.9442,.94156,.93892,.93627,.93361,.93094,.92825,.92555,.92284,.9201,.91735,.91458,.91179,.90899,.90616,.90332,.90047,.8976,.89472,.89183,.88893,.88603,.88314,.88024,.87735,.87448,.87162,.86878,.86597,.86319,.86044,.85774,.85508,.85247,.84993,.84744,.84503,.84269,.84042,.83825,.83616,.83417,.83227,.83048,.8288,.82724,.82578,.82445,.82324,.82215,.82119,.82037,.81967,.81911,.81868,.81839,.81824,.81823,.81835,.81862,.81903,.81957,.82026,.82109,.82206,.82317,.82443,.82583,.82737,.82906,.83089,.83287,.83499,.83726,.83968,.84223,.84494,.84778,.85077,.8539,.85717,.86058,.86412,.86781,.87163,.87559,.87968,.88391,.88826,.89275,.89737,.90211,.90698,.91198,.91709,.92233,.92768,.93315,.93873,.94441,.95019,.95607,.96205]},{distance:[4.72925,4.81721,4.9037,4.98859,5.07177,5.15311,5.23249,5.3098,5.38491,5.45772,5.52811,5.59598,5.66122,5.72375,5.78346,5.84028,5.8941,5.94486,5.99248,6.03689,6.07803,6.11584,6.15028,6.18128,6.20882,6.23285,6.25336,6.27031,6.28369,6.29348,6.29969,6.3023,6.30133,6.29678,6.28867,6.27703,6.26187,6.24324,6.22116,6.19567,6.16683,6.13468,6.09928,6.06068,6.01896,5.97417,5.92639,5.87569,5.82217,5.76589,5.70696,5.64545,5.58147,5.5151,5.44644,5.37559,5.30265,5.2277,5.15085,5.0722,4.99184,4.90987,4.82639,4.74151,4.65533,4.56794,4.47945,4.38996,4.29959,4.20843,4.11658,4.02416,3.93125,3.83796,3.74437,3.65057,3.55666,3.46272,3.36884,3.27509,3.18155,3.08831,2.99545,2.90303,2.81114,2.71984,2.62922,2.53933,2.45026,2.36207,2.27484,2.18862,2.10349,2.01951,1.93675,1.85528,1.77515,1.69644,1.61919,1.54348,1.46935,1.39685,1.32605,1.25698,1.18967,1.12417,1.06049,.99863,.93862,.88044,.82408,.76953,.71676,.66574,.61644,.56882,.52282,.47841,.43553,.39413,.35414,.31551,.27817,.24206,.20712,.17328,.14048,.10866,.07776,.04772,.01848,-.00999,-.03776,-.06487,-.09134,-.11721,-.14251,-.16725,-.19144,-.21509,-.2382,-.26076,-.28275,-.30416,-.32496,-.34511,-.36459,-.38334,-.40134,-.41852,-.43485,-.45026,-.46471,-.47815,-.49052,-.50179,-.51189,-.52081,-.52849,-.5349,-.54003,-.54383,-.54627,-.54734,-.54702,-.54528,-.54211,-.53752,-.53149,-.52403,-.51515,-.50487,-.4932,-.48015,-.46575,-.45001,-.43297,-.41463,-.39503,-.37419,-.35213,-.32887,-.30443,-.27885,-.25214,-.22432,-.19541,-.16544,-.13442,-.10235,-.06926,-.03514,0,.03616,.07336,.11159,.15088,.19125,.23272,.27531,.31906,.36401,.41019,.45764,.5064,.55651,.60802,.66096,.71538,.77129,.82874,.88776,.94836,1.01056,1.07438,1.13982,1.20687,1.27554,1.34581,1.41766,1.49107,1.56599,1.64239,1.72025,1.79951,1.88013,1.96209,2.04532,2.12979,2.21546,2.30226,2.39017,2.47911,2.56905,2.65991,2.75164,2.84416,2.93742,3.03133,3.12582,3.2208,3.31619,3.41191,3.50785,3.60393,3.70006,3.79612,3.89202,3.98765,4.08291,4.17767,4.27182,4.36525,4.45783,4.54944,4.63995],pressure:[.30942,.30838,.30765,.30724,.30715,.30738,.30795,.30884,.31007,.31164,.31354,.31578,.31837,.32129,.32455,.32815,.33209,.33636,.34097,.34591,.35117,.35675,.36265,.36887,.37539,.38221,.38933,.39674,.40442,.41238,.4206,.42907,.43779,.44675,.45593,.46533,.47493,.48473,.49471,.50486,.51517,.52563,.53623,.54694,.55777,.5687,.57971,.59079,.60194,.61313,.62435,.6356,.64686,.65811,.66935,.68056,.69174,.70286,.71391,.72489,.73579,.74659,.75728,.76785,.7783,.7886,.79876,.80877,.81861,.82827,.83776,.84706,.85617,.86507,.87378,.88227,.89056,.89863,.90649,.91412,.92153,.92872,.93568,.94241,.94892,.95519,.96122,.96702,.97258,.97791,.98299,.98783,.99242,.99677,.99911,.99525,.99164,.98827,.98515,.98228,.97966,.97728,.97514,.97324,.97159,.97017,.96898,.96801,.96727,.96674,.96641,.96629,.96635,.96661,.96703,.96762,.96838,.96928,.97032,.97149,.97279,.9742,.97572,.97734,.97905,.98085,.98273,.98468,.98669,.98877,.99091,.99311,.99535,.99765,1,.9976,.99516,.99267,.99014,.98755,.98491,.98222,.97947,.97666,.97378,.97083,.96781,.96471,.96153,.95826,.9549,.95144,.94787,.9442,.94042,.93651,.93249,.92834,.92407,.91966,.91512,.91045,.90564,.90069,.8956,.89037,.885,.87949,.87384,.86806,.86214,.85608,.84988,.84356,.83711,.83053,.82383,.81702,.81009,.80306,.79594,.78872,.78141,.77403,.76657,.75905,.75148,.74385,.73619,.72849,.72076,.71302,.70526,.69749,.68972,.68195,.67419,.66644,.65871,.65099,.64329,.63561,.62795,.62032,.61271,.60512,.59755,.59001,.58248,.57497,.56749,.56002,.55256,.54512,.5377,.5303,.52291,.51554,.50819,.50087,.49358,.48632,.4791,.47192,.4648,.45773,.45072,.44378,.43692,.43015,.42346,.41687,.41039,.40403,.39779,.39168,.38571,.37989,.37423,.36873,.36342,.35828,.35335,.34862,.34409,.3398,.33573,.3319,.32831,.32498,.32192,.31912,.3166,.31436,.31242,.31077]}]};function fS(e){let t=null;for(const i of e){const e=i.type;if(vS(i))if(Object(w["k"])(t))t=e;else if(t!==e)return"uber"}return Object(w["l"])(t)?t:"uber"}function bS(e){let t=0;for(const{material:i}of e)if(gS(i)){if(i.color[3]*i.opacity<1)return 1;t=2}return t}function mS(e){let t=0;for(const{material:i}of e)if(gS(i)){switch(i.objectTransparency){case 1:case 0:return 1;case 2:if(i.opacity<1)return 1}t=2}return t}function gS(e){return e.size*e.color[3]*e.opacity>0}function vS(e){return e.size*e.color[3]>0}function yS(e,t){const i=Object(R["b"])(e,t,!0);return-1===i?t<e[0]?0:e.length:i}function OS(e,t,i){return e.length-yS(e,t*i.minimumEdgeLength)}function _S(e,t,i,r){for(let n=0;n<e.length;n++){const a=e[n].index,s=t[n],o=t[n+1];if(r)for(let e=s;e<o;e++){const t=r[e];i.set(t,a)}else for(let e=s;e<o;e++)i.set(e,a)}}const xS=j["a"].getLogger("esri.views.3d.webgl-engine.lib.edgeRendering.EdgeView");let jS=class extends W["a"]{constructor(e){super(e),this.updatingHandles=new Mr["a"],this.perObjectData=new Map,this.perObjectDataEvictionCache=new Set,this.renderers=new Map,this.numberOfRenderedEdges=0,this.gpuMemoryUsage=0,this.workerAbort=new AbortController,this.tmpModelPosition=Object(F["f"])(),this.localOrigins=new kw(new SO["a"](e.renderSR))}initialize(){this.worker=new oS(this.schedule),this.componentColorManager=new J_(this.rctx,2);const e=Bw["e"].createBuffer(4);for(let t=0;t<4;t++)e.sideness.set(t,0,0===t||3===t?0:1),e.sideness.set(t,1,0===t||1===t?0:1);this.verticesBufferObject=tr["a"].createVertex(this.rctx,35044,e.buffer)}destroy(){this.destroyed||(this.perObjectData.forEach(e=>this._discardObjectEntry(e)),this.perObjectData.clear(),this.strokesTexture=Object(w["f"])(this.strokesTexture),this.componentColorManager=Object(w["e"])(this.componentColorManager),this.workerAbort.abort(),this.worker.destroy(),this.verticesBufferObject=Object(w["f"])(this.verticesBufferObject),this.renderers.clear(),this.updatingHandles.destroy())}get updating(){return this.updatingHandles.updating}get usedMemory(){return this.gpuMemoryUsage}get numberOfRenderedPrimitives(){return this.numberOfRenderedEdges}shouldRender(){return this.renderers.size>0}async addComponentObject(e,t,i,r,n,a,s,o){if(this.hasObject(e))return;let c;const l=new TS(new Promise(e=>c=e),i.center,i.radius);this.perObjectData.set(e,l),await this.updatingHandles.addPromise(this.addComponentGeometry(t,l,r,n,a,s,o)),this.setNeedsRender(),c()}async addOrUpdateObject3D(e,t,i,r){if(this.destroyed)return void xS.warn("Attempt to add an object to a destroyed instance");const n=this.perObjectData.get(e);let a;(null==n?void 0:n.renderables.length)>0&&this.perObjectDataEvictionCache.add(n);const s=e.boundingVolumeWorldSpace.bounds,o=new TS(new Promise(e=>a=e),Object(_n["g"])(s),Object(_n["l"])(s));this.perObjectData.set(e,o);const c=new Array;if(i.mergeGeometries&&e.geometries.length>1&&SS(e))c.push(this.addObjectMergedGeometries(e,o,t,i,r));else for(let l=0;l<e.geometries.length;l++){const n=e.geometryRecords[l];if(!n.material.supportsEdges)continue;const a=e.geometries[l];c.push(this.addGeometry(e,o,a,n,t[0],i,r))}await this.updatingHandles.addPromise(Promise.all(c)),this.perObjectDataEvictionCache.delete(o),this._discardObjectEntry(n),this.setNeedsRender(),a()}_discardObjectEntry(e){e&&(e.renderables.length&&(e.renderables.forEach(e=>this.removeRenderable(e)),this.setNeedsRender()),e.loaded=null)}hasObject(e){return this.perObjectData.has(e)}async updateAllComponentOpacities(e,t){const i=t instanceof Array?e=>t[e]:()=>t;(await this.updatingHandles.addPromise(this.getObjectEntry(e))).renderables.forEach(e=>{const t=e.components.meta.length;for(let r=0;r<t;r++){const t=i(r),n=e.components.meta[r],a=n.index;n.material.opacity=t,e.components.buffer.textureBuffer.setDataElement(a,1,3,255*t)}this.updateTransparency(e)}),this.setNeedsRender()}async updateAllComponentMaterials(e,t,i,r){const n=e instanceof Uw["a"],a=!!i.slicePlaneEnabled,s=fS(t),o=Jw.getKey(s,a,n);(await this.updatingHandles.addPromise(this.getObjectEntry(e))).renderables.forEach(e=>{if(o!==e.rendererKey){const t=this.renderers.get(e.rendererKey),i=this.acquireRenderer(s,a,n);t.removeRenderable(e),t.refCount.decrement(),e.rendererKey=o,i.addRenderable(e)}for(let i=0;i<t.length;i++)e.components.meta[i].material=t[i];r&&this.updateComponentBuffer(e.components),this.updateTransparency(e)}),this.setNeedsRender()}async updateObjectVisibility(e,t){(await this.updatingHandles.addPromise(this.getObjectEntry(e))).renderables.forEach(e=>e.visible=t),this.setNeedsRender()}removeObject(e){const t=this.perObjectData.get(e);t&&(this.perObjectData.delete(e),this._discardObjectEntry(t))}async getObjectEntry(e){const t=this.perObjectData.get(e);if(!t)throw"no object";return await t.loaded,t}removeAll(){this.perObjectData.forEach((e,t)=>this.removeObject(t))}render(e,t){if(Object(w["k"])(this.componentColorManager))return;this.localOrigins.updateViewMatrices(e.camera.viewMatrix);const i=e.camera.viewInverseTransposeMatrix,r=Object(F["f"])(),n=new $_,a=new A_["a"].ViewProjectionTransform,s=Object(Ai["b"])();Object(Et["z"])(r,i[3],i[7],i[11]),n.set(r),Object(Et["n"])(a.worldFromView_TH,n.high),Object(Et["n"])(a.worldFromView_TL,n.low),Object(Pi["f"])(a.viewFromCameraRelative_RS,e.camera.viewMatrix),Object(Lt["d"])(a.projFromView,e.camera.projectionMatrix);const o=Object(Ai["b"])();Object(Pi["o"])(o,a.viewFromCameraRelative_RS),Object(Pi["e"])(s,o);let c=0,l=0;if(this.renderers.forEach(e=>{0===e.refCount.value?(this.renderers.delete(e.key),e.dispose()):e.forEachRenderable(e=>{c+=e.statistics.averageEdgeLength,l++},t)}),this.componentColorManager.garbageCollect(),this.componentColorManager.updateTextures(),0===l)return;const d={distanceFalloffFactor:40*c/l,minimumEdgeLength:e.camera.perScreenPixelRatio,transparency:t,viewProjectionTransform:a,transformNormal_ViewFromGlobal:s};this.updateObjectCameraDistances(e),this.numberOfRenderedEdges=0,this.renderers.forEach(t=>{this.renderRegularEdges(t,e,d),this.renderSilhouetteEdges(t,e,d)})}updateTransparency(e){const t=bS(e.components.meta),i=mS(e.components.meta);t===e.edgeTransparency&&i===e.objectTransparency||(e.edgeTransparency=t,e.objectTransparency=i,this.renderers.get(e.rendererKey).setRenderablesDirty())}computeModelTransformWithLocalOrigin(e,t,i){if(e.getCombinedStaticTransformation(t,i),Object(w["l"])(t.origin))this.localOrigins.register(t.origin);else{const e=Object(Et["z"])(this.tmpModelPosition,i[12],i[13],i[14]);t.origin=this.localOrigins.acquire(e)}return Lw(t.origin.vec3,i),t.origin}updateComponentBuffer(e){const{meta:t,buffer:i}=e;for(let r=0;r<t.length;r++){const e=t[r].material,n=t[r].index,a=Object(Oe["f"])(Math.round(e.size*Zw),0,255),s=Object(Oe["f"])(e.extensionLength,-Qw,255-Qw)+Qw,o="solid"===e.type?0:1,c=255*e.opacity,l=e.color,d=255*l[0],h=255*l[1],u=255*l[2],p=255*l[3];i.textureBuffer.setData(n,0,d,h,u,p),i.textureBuffer.setData(n,1,a,s,o,c)}}createComponentBuffers(e){if(Object(w["k"])(this.componentColorManager))return null;const t=new Array,i=this.componentColorManager.getBuffer(e.length);for(let n=0;n<e.length;n++){const r=e[n],a=i.acquireIndex();t.push({index:a,material:r})}const r={meta:t,buffer:i};return this.updateComponentBuffer(r),r}extractEdges(e,t,i,r,n,a=n.length){return this.worker.process({data:t,indices:n,indicesLength:a,writerSettings:e,skipDeduplicate:i},this.workerAbort.signal,r)}createEdgeResources(e){const t={};if(Object(w["k"])(this.verticesBufferObject))return t;if(e.regular.lodInfo.lengths.length>0){const i=new nr["a"](this.rctx,Bw["b"],{vertices:Bw["f"],instances:Nw["a"].glLayout},{vertices:this.verticesBufferObject,instances:tr["a"].createVertex(this.rctx,35044,e.regular.instancesData.buffer)});t.regular={vao:i,lod:e.regular.lodInfo}}if(e.silhouette.lodInfo.lengths.length>0){const i=new nr["a"](this.rctx,Bw["b"],{vertices:Bw["f"],instances:Nw["b"].glLayout},{vertices:this.verticesBufferObject,instances:tr["a"].createVertex(this.rctx,35044,e.silhouette.instancesData.buffer)});t.silhouette={vao:i,lod:e.silhouette.lodInfo}}return t}async addGeometry(e,t,i,r,n,a,s){const o=i.vertexAttributes.get("position"),c=i.indices.get("position"),l=Object(Vt["d"])(),d={position:o,indices:c,modelTransform:l,origin:this.computeModelTransformWithLocalOrigin(e,r,l)};return this.addPositionData(t,d,i.edgeIndicesLength,n,a,s)}async addPositionData(e,t,i,r,n,a=!1){if(null==e.loaded)return;const s=this.createComponentBuffers([r]);if(Object(w["k"])(s)||i<=0)return;const o=this.acquireRenderer(r.type,!!n.slicePlaneEnabled),{modelTransform:c,origin:l}=t,d=t.indices,h=t.position,u=h.data.length/h.size,p=Bw["a"].createBuffer(u);for(let y=0;y<u;y++)p.position.set(y,0,h.data[y*h.size+0]),p.position.set(y,1,h.data[y*h.size+1]),p.position.set(y,2,h.data[y*h.size+2]);_S(s.meta,[0,p.componentIndex.count],p.componentIndex);const f=await this.updatingHandles.addPromise(this.extractEdges(o.writerSettings,p,!1,a,d,i));if(null==e.loaded)return;const{regular:b,silhouette:m}=this.createEdgeResources(f),g=(b?b.vao.size:0)+(m?m.vao.size:0),v={regular:b,silhouette:m,transform:{modelMatrix:c,origin:l},statistics:{gpuMemoryUsage:g,averageEdgeLength:f.averageEdgeLength},components:s,visible:!0,edgeTransparency:bS(s.meta),objectTransparency:mS(s.meta),distanceToCamera:0,rendererKey:o.key};e.renderables.push(v),o.addRenderable(v),this.gpuMemoryUsage+=g}async addComponentGeometry(e,t,i,r,n,a,s){if(null==t.loaded)return;const o=this.createComponentBuffers(a);if(Object(w["k"])(o))return;const c=fS(a),l=this.acquireRenderer(c,s.slicePlaneEnabled||!1,!1),d=Bw["a"].createBuffer(i.count);Object(zw["a"])(d.position,i),_S(o.meta,n,d.componentIndex,r);const h=!0,u=l.writerSettings,p=await this.updatingHandles.addPromise(this.extractEdges(u,d,h,!1,r));if(null==t.loaded)return;const{regular:f,silhouette:b}=this.createEdgeResources(p),m=(f?f.vao.size:0)+(b?b.vao.size:0),g={regular:f,silhouette:b,transform:e,statistics:{gpuMemoryUsage:m,averageEdgeLength:p.averageEdgeLength},components:o,visible:!0,edgeTransparency:bS(o.meta),objectTransparency:mS(o.meta),distanceToCamera:0,rendererKey:l.key};t.renderables.push(g),l.addRenderable(g),this.gpuMemoryUsage+=m}async addObjectMergedGeometries(e,t,i,r,n){const a=new Map;let s=0,o=null,c=0;for(let g=0;g<e.geometries.length;g++){const t=e.geometries[g],i=e.geometryRecords[g];if(!i.material.supportsEdges)continue;!o&&i.origin&&(o=i);const r=t.vertexAttributes.get("position");c+=r.data.length/r.size,s+=t.edgeIndicesLength}const l=c>=65536?Uint32Array:Uint16Array,d=s?new l(s):null,h=[];let u=0;for(let g=0;g<e.geometries.length;g++){const t=e.geometries[g];if(!e.geometryRecords[g].material.supportsEdges)continue;const i=t.vertexAttributes.get("position"),r=t.indices.get("position");let n=a.get(i.data);if(null==n){n=h.length/3;for(let e=0;e<i.data.length;e+=i.size)h.push(i.data[e+0]),h.push(i.data[e+1]),h.push(i.data[e+2]);a.set(i.data,n)}if(r)for(let e=0;e<t.edgeIndicesLength;e++)d[u++]=n+r[e]}const p=o||e.geometryRecords[0],f=Object(Vt["d"])(),b=this.computeModelTransformWithLocalOrigin(e,p,f);for(let g=0;g<e.geometryRecords.length;g++)e.geometryRecords[g].origin=b;const m={position:{data:h,size:3},indices:d,modelTransform:f,origin:b};await this.updatingHandles.addPromise(this.addPositionData(t,m,d.length,i[0],r,n))}acquireRenderer(e,t,i=!0){const r=Jw.getKey(e,t,i);let n=this.renderers.get(r);return Object(w["k"])(this.strokesTexture)&&(this.strokesTexture=cS(this.rctx)),n||(n=new Jw(this.rctx,this.techniqueRepository,{type:e,slicePlaneEnabled:t,strokesTexture:this.strokesTexture,legacy:i}),this.renderers.set(r,n)),n.refCount.increment(),n}removeRenderable(e){wS(e);const t=this.renderers.get(e.rendererKey);if(t){t.removeRenderable(e),t.refCount.decrement(),"origin"in e.transform&&this.localOrigins.release(e.transform.origin),this.gpuMemoryUsage-=e.statistics.gpuMemoryUsage;for(const t of e.components.meta)e.components.buffer.releaseIndex(t.index)}}updateObjectCameraDistances(e){const t=e.camera.eye,i=e.camera.viewForward,r=Object(F["f"])(),n=e=>{const{center:n,radius:a}=e;Object(Et["C"])(r,n,t);const s=Object(Et["k"])(r,i),o=s<-a?1/0:s<a?0:s-a;e.renderables.forEach(e=>e.distanceToCamera=o)};this.perObjectData.forEach(n),this.perObjectDataEvictionCache.forEach(n)}renderRegularEdges(e,t,i){e.bindRegularEdges(t,i);const r=i.transparency;e.forEachRenderable(r=>{if(!r.visible||!r.regular)return;const n=OS(r.regular.lod.lengths,r.distanceToCamera,i);"origin"in r.transform&&(t.localViewMatrixForEdges=this.localOrigins.getViewMatrix(r.transform.origin)),e.renderRegularEdges(r,t,n),this.numberOfRenderedEdges+=n},r)}renderSilhouetteEdges(e,t,i){e.bindSilhouetteEdges(t,i);const r=i.transparency;e.forEachRenderable(r=>{if(!r.visible||!r.silhouette)return;const n=OS(r.silhouette.lod.lengths,r.distanceToCamera,i);"origin"in r.transform&&(t.localViewMatrixForEdges=this.localOrigins.getViewMatrix(r.transform.origin)),e.renderSilhouetteEdges(r,t,n),this.numberOfRenderedEdges+=n},r)}};function wS(e){e.regular&&(e.regular.vao.vertexBuffers.instances.dispose(),e.regular.vao.dispose(!1),e.regular.vao=null),e.silhouette&&(e.silhouette.vao.vertexBuffers.instances.dispose(),e.silhouette.vao.dispose(!1),e.silhouette.vao=null)}function SS(e){let t=null,i=null;for(let n=0;n<e.geometries.length;n++){var r;const a=e.geometryRecords[n];if(a.material.supportsEdges){if(t){if(!Object(R["e"])(t,a.transformation))return!1}else t=a.transformation;if(!i&&Object(w["l"])(a.origin))i=a;else if(Object(w["l"])(null==(r=i)?void 0:r.origin)&&Object(w["l"])(a.origin)&&i.origin.id!==a.origin.id)return!1}}return!0}Object(h["a"])([Object(M["b"])({constructOnly:!0})],jS.prototype,"rctx",void 0),Object(h["a"])([Object(M["b"])({constructOnly:!0})],jS.prototype,"renderSR",void 0),Object(h["a"])([Object(M["b"])({constructOnly:!0})],jS.prototype,"techniqueRepository",void 0),Object(h["a"])([Object(M["b"])({constructOnly:!0})],jS.prototype,"setNeedsRender",void 0),Object(h["a"])([Object(M["b"])({constructOnly:!0})],jS.prototype,"schedule",void 0),Object(h["a"])([Object(M["b"])({readOnly:!0})],jS.prototype,"updatingHandles",void 0),Object(h["a"])([Object(M["b"])({readOnly:!0})],jS.prototype,"updating",null),jS=Object(h["a"])([Object(D["a"])("esri.views.3d.webgl-engine.lib.edgeRendering.EdgeView")],jS);class TS{constructor(e,t,i){this.center=t,this.radius=i,this.renderables=new Array,this.loaded=e,this.loaded.then(()=>{null!=this.loaded&&(this.loaded=!0)})}}var CS=i("2245"),PS=i("191a"),AS=i("2ff3"),MS=i("4c37");function RS(e){const t=e.capabilities.disjointTimerQuery;return Object(w["k"])(t)?null:t.timestampBits()>0?new ES(t):IS?null:new DS(t)}class ES{constructor(e){this.timer=e,this.start=e.createQuery(),e.createTimestamp(this.start)}stop(e,t=50){this.end=this.timer.createQuery(),this.timer.createTimestamp(this.end),this.checkQueryResult(e,t)}checkQueryResult(e,t){if(!this.timer.resultAvailable(this.end))return void setTimeout(()=>this.checkQueryResult(e,t),t);if(this.timer.disjoint())return void e(null);const i=this.timer.getResult(this.start),r=this.timer.getResult(this.end);e((r-i)/1e6)}}class DS{constructor(e){this.timer=e,this.query=e.createQuery(),IS=!0,this.timer.beginTimeElapsed(this.query)}stop(e,t=50){this.timer.endTimeElapsed(),IS=!1,this.checkQueryResult(e,t)}checkQueryResult(e,t){const i=this.timer.resultAvailable(this.query),r=this.timer.disjoint();if(!i||r)r?e(null):setTimeout(()=>this.checkQueryResult(e,t),t);else{const t=this.timer.getResult(this.query);e(t/1e6)}}}let IS=!1;const FS=["prepare","shadowmap","lineardepth","normals","ssao","opaque","opaque edges","transparent","transparent edges","hudvisibility","transparent terrain","atmosphere","laserline","occluded","antialiasing","highlights","hudOccluded","hudNotoccluded"];class zS extends AS["a"]{constructor(){super("total"),this.total=0,this.frameCount=0}}class LS{constructor(){this._startTime=0,this._lastSample=0,this._enableGPUTimer=0,this.totalTime=new zS,this.gpuTime=new AS["a"]("gpu",9),this.renderPassTimings=FS.map(e=>new AS["a"](e))}enableGPUTimer(){return++this._enableGPUTimer,{remove:Object(MS["d"])(()=>--this._enableGPUTimer)}}prerender(e){this._startTime=this._lastSample=performance.now(),this._enableGPUTimer&&(this._gpuTimer=RS(e))}advance(e){const t=performance.now();this.renderPassTimings[e].record(t-this._lastSample),this._lastSample=t}postrender(){Object(w["l"])(this._gpuTimer)&&(this._gpuTimer.stop(e=>Object(w["l"])(e)&&this.gpuTime.record(e),16),this._gpuTimer=null);const e=performance.now()-this._startTime;this.totalTime.record(e),this.totalTime.total+=e,this.totalTime.frameCount++}}let VS=class extends W["a"]{constructor(e,t,i,r,n,a,s,o,c){super({}),this._materialRepository=e,this._shaderTechniqueRepository=i,this._rctx=r,this._compositingHelper=n,this._magnifierHelper=a,this._requestRender=s,this._stage=c,this._materialRenderers=new Map,this._hasHighlights=!1,this._hasOccludees=!1,this._hasWater=!1,this._hasOverlayWater=!1,this._content=new Map,this._isRendering=!1,this._fallbackDepthStencilTexture=null,this.performanceInfo=new LS,this._antialiasing=1,this._oitEnabled=!1,this._multipassTerrain=!0,this._opaqueTerrain=!0,this._lighting=new CS["a"],this._handles=new $["a"],this.renderHiddenTransparentEdges=()=>{},this._smaaPass=new Aw(this._rctx,i),this._oitEnabled=this._hasOITSupport,this._requestRender(),this._offscreenRendering=new hj(this._rctx,this._compositingHelper),this._sliceHelper=new Sw,this._shadowMap=new Cj(this._rctx,c.viewingMode,2),this._ssaoHelper=new Dw(i,this._rctx,()=>this._requestRender()),this._highlightHelper=new sj(i,this._rctx),this._shadowHighlightHelper=new xw(this._rctx,c.viewingMode),this._shadowAccumulator=new lw(this._rctx,i,c,(e,t)=>{this.renderPassManager.shadowCastingEnabled=!0,this._renderPlugins.prepareRender(e,t),this.renderPassManager.shadowCastingEnabled=this._shadowMap.enabled},(e,t,i,r)=>{e.start(i,t,r),this.renderShadowCascades(4,e),i.setGLViewport(this._rctx),this.ensureCameraBindParameters(i)},()=>this._requestRender()),this._bindParameters={slot:null,camera:null,inverseViewport:Object(Ut["b"])(),shadowMap:this._shadowMap,shadowMappingEnabled:this._shadowMap.enabled,ssaoHelper:this._ssaoHelper,ssaoEnabled:this._ssaoHelper.enabled,origin:null,screenToWorldRatio:null,screenToPCSRatio:null,slicePlane:this._sliceHelper.plane,highlightDepthTexture:null,hasOccludees:!1,linearDepthTexture:null,terrainLinearDepthTexture:null,geometryLinearDepthTexture:null,multipassTerrainEnabled:!1,multipassGeometryEnabled:!1,cullAboveGround:!1,lastFrameColorTexture:null,reprojectionMatrix:Vt["a"],ssrEnabled:!1,lighting:this._lighting,highlightColorTexture:null},this._renderContext=new fj["b"](this._rctx,this._offscreenRendering,this._lighting,this._shadowMap,this._ssaoHelper,this._sliceHelper),this._renderContext.multipassTerrainParams={camera:null,multipassTerrainEnabled:!1,cullAboveGround:!1,terrainLinearDepthTexture:null},this._renderContext.multipassGeometryParams={multipassGeometryEnabled:!1,geometryLinearDepthTexture:null},this._renderContext.ssrParams={camera:null,linearDepthTexture:null,lastFrameColorTexture:null,reprojectionMatrix:Vt["a"],ssrEnabled:!1},this._renderPlugins=new mj({renderContext:this._renderContext,shaderTechniqueRep:i,textureRep:t,materialRep:this._materialRepository,requestRender:this._requestRender,schedule:o}),this.renderPassManager=new Qx(this._rctx,this._shaderTechniqueRepository),this._renderPlugins.add(this.renderPassManager.slots(),this.renderPassManager),this._handles.add([Object(C["a"])(Lh["a"],"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",e=>{this.renderHiddenTransparentEdges=e?()=>this.renderEdges(1):()=>{},this._requestRender()}),Object(C["a"])(this._stage,"camera",()=>this._requestRender(),!0)])}get hasWater(){return this._hasWater||this._hasOverlayWater}get hasWaterReflection(){return this.hasWater&&this._waterReflectionEnabled}normalizeCtorArgs(){return{}}dispose(){this._handles.destroy(),this._smaaPass.dispose(),this._materialRenderers.forEach(e=>e.dispose()),this._materialRenderers.clear(),this._edgeView=Object(w["e"])(this._edgeView),this._offscreenRendering.dispose(),this._fallbackDepthStencilTexture=Object(w["f"])(this._fallbackDepthStencilTexture),this._shadowMap.enabled=!1,this._shadowMap.dispose(),this._ssaoHelper.enabled=!1,this._ssaoHelper.dispose(),this._highlightHelper.dispose(),this._shadowHighlightHelper.dispose(),this._shadowAccumulator.dispose(),Jx["a"].prune(),this._content.clear()}get updating(){return 1===this._antialiasing&&this._smaaPass.updating||Object(w["l"])(this._edgeView)&&this._edgeView.updating||this._shadowAccumulator.running||!this.isCameraFinal}ensureEdgeView(){return Object(w["k"])(this._edgeView)&&(this._edgeView=new jS({rctx:this._rctx,renderSR:this._stage.renderSR,techniqueRepository:this._shaderTechniqueRepository,setNeedsRender:()=>this._requestRender(),schedule:e=>this._stage.resourceController.schedule(e)}),this._handles.add(this._edgeView.watch("updating",()=>this._requestRender(),!0)),this._requestRender()),this._edgeView}get edgeView(){return this._edgeView}get isCameraFinal(){return null===this._bindParameters.reprojectionMatrix||Object(Lt["o"])(this._bindParameters.reprojectionMatrix,Vt["a"])}set _reprojectionMatrix(e){Object(Lt["o"])(this._bindParameters.reprojectionMatrix,e)||(this._bindParameters.reprojectionMatrix=e,this.notifyChange("isCameraFinal"))}get hasShadowsEnabled(){var e;return!(null==(e=this._shadowMap)||!e.enabled)}setRenderParameters(e){const{renderPassManager:t,_shadowMap:i,_ssaoHelper:r}=this;void 0!==e.screenSpaceReflectionsEnabled&&t.screenSpaceReflectionsEnabled!==e.screenSpaceReflectionsEnabled&&(t.screenSpaceReflectionsEnabled=e.screenSpaceReflectionsEnabled,this._requestRender()),void 0===e.shadowMap||i.enabled===e.shadowMap&&t.shadowCastingEnabled===e.shadowMap||(i.enabled=e.shadowMap,t.shadowCastingEnabled=e.shadowMap,this._requestRender()),void 0!==e.shadowMapMaxCascades&&i.maxCascades!==e.shadowMapMaxCascades&&(i.maxCascades=e.shadowMapMaxCascades,this._requestRender()),void 0!==e.ssao&&r.enabled!==e.ssao&&(r.enabled=e.ssao,this._requestRender()),e.background&&this._offscreenRendering.background!==e.background&&(this._offscreenRendering.background=e.background,this._requestRender());const n=e.antialiasingEnabled?1:0;void 0!==e.antialiasingEnabled&&this._antialiasing!==n&&(this._antialiasing=n,this._requestRender()),void 0!==e.highQualityTransparency&&this._multipassTerrain!==e.highQualityTransparency&&(this._multipassTerrain=e.highQualityTransparency,this._oitEnabled=e.highQualityTransparency&&this._hasOITSupport,this._requestRender()),void 0!==e.defaultHighlightOptions&&(this._highlightHelper.setDefaultOptions(e.defaultHighlightOptions),this._shadowHighlightHelper.setDefaultOptions(e.defaultHighlightOptions),this._requestRender()),void 0!==e.slicePlane&&this._sliceHelper.plane!==e.slicePlane&&(this._sliceHelper.plane=Object(w["u"])(e.slicePlane),this._requestRender()),void 0!==e.waterReflectionEnabled&&this._waterReflectionEnabled!==e.waterReflectionEnabled&&(this._waterReflectionEnabled=e.waterReflectionEnabled,this._requestRender()),void 0!==e.opaqueTerrain&&this._opaqueTerrain!==e.opaqueTerrain&&(this._opaqueTerrain=e.opaqueTerrain,this._requestRender()),void 0!==e.hasOverlayWater&&this._hasOverlayWater!==e.hasOverlayWater&&(this._hasOverlayWater=e.hasOverlayWater,this._requestRender()),void 0!==e.shadowCastOptions&&this._shadowAccumulator.setOptions(e.shadowCastOptions)}get hasSlicePlane(){return!!this._sliceHelper.plane}get renderPlugins(){return this._renderPlugins}get _hasOITSupport(){return this._rctx.driverTest.floatBufferBlendWorking}modify(e){this._isRendering&&console.warn("Renderer.modify called while rendering");const{adds:t,removes:i,updates:r}=e;if(0===t.length&&0===i.length&&0===r.length)return;i.forAll(({id:e})=>this._content.delete(e)),t.forAll(e=>this._content.set(e.id,e));const n=Object(bj["a"])(e);let a=!1;n.forEach((e,t)=>{let i=this._materialRenderers.get(t);if(!i){if(!(e.adds.length>0))return;i=new PS["a"](this._rctx,this._materialRepository,t),this._materialRenderers.set(t,i)}i.modify(e),i.isEmpty&&(a=!0)}),a&&this._materialRenderers.forEach((e,t)=>{e.isEmpty&&(this._materialRenderers.delete(t),e.dispose())}),this._hasHighlights=Object(Ih["c"])(this._materialRenderers,e=>e.hasHighlights),this._hasOccludees=Object(Ih["c"])(this._materialRenderers,e=>e.hasOccludees),this._hasWater=Object(Ih["c"])(this._materialRenderers,e=>e.hasWater),this._requestRender()}updateLogic(e){let t=!1;return this._materialRenderers.forEach(i=>t=i.updateLogic(e)||t),t}updateLightSources(e,t,i){this._lighting.groundLightingFactor=t,this._lighting.globalFactor=i,this._lighting.set(e)}render(e,t,i,r){this._isRendering=!0,this.performanceInfo.prerender(this._rctx),this._bindParameters.lighting=this._lighting,this._renderContext.hasOccludees=this._hasOccludees,this._renderContext.transparencyPassType=3,this._bindParameters.transparencyPassType=3;const n=this._offscreenRendering;n.needLastFrameColorTexture=this.hasWaterReflection,n.advanceCurrentRenderTarget();const a=this._sliceHelper.plane;0===r&&(this._sliceHelper.plane=null),this._rctx.bindFramebuffer(e),t.setGLViewport(this._rctx),this.needsShadowCast&&(this.renderPassManager.shadowCastingEnabled=!0),this._renderPlugins.prepareRender(t,i),this.performanceInfo.advance(0);const s=this.computeDepthRange(t);this.renderShadowMap(e,t,this._lighting.lightingMainDirection,s),this.performanceInfo.advance(1),n.initializeFrame(t),this.ensureBindParameters(t),this.renderLinearDepth(),this.performanceInfo.advance(2),this.accumulateShadows(s,t,i),this.renderNormal(),this.performanceInfo.advance(3),this.ensureBindParametersSSR(),this._ssaoHelper.computeSSAO(t,n.linearDepthTexture,n.normalTexture),this.performanceInfo.advance(4),this._renderContext.pass=0,n.bindFramebuffer(),this.renderOpaqueGeometry(),this.performanceInfo.advance(5);const o=this._multipassTerrain&&!this._opaqueTerrain;this.renderTerrainLinearDepth(o),this.setMultipassFlags(o),this.setTerrainCulling(o),this.renderEdges(2),this.performanceInfo.advance(6),this.renderHiddenTransparentEdges(),this._oitEnabled?this.renderOrderIndependentTransparency(()=>this.renderTransparentGeometry(),!1):this.renderTransparentGeometry(),this.performanceInfo.advance(7),this.renderGeometryLinearDepth(o);const c={hudVisibility:!1,transparentTerrain:!1};c.hudVisibility=this.renderHUDVisibility(),o||this.renderInternalSlot(18),this.performanceInfo.advance(9),this.renderEdges(1,o),this.performanceInfo.advance(8),this.renderSlot(22),c.transparentTerrain=this.renderTransparentTerrain(),c.transparentTerrain&&c.hudVisibility&&(o?this.renderLineCallouts(0):n.compositeTransparentTerrainOntoHUDVisibility(),this.renderHUD(0,n.framebuffer),this.performanceInfo.advance(16)),this.performanceInfo.advance(10),this.setTerrainCulling(!1),c.transparentTerrain&&(n.compositeTransparentTerrainOntoMain(),o&&(this.renderEdges(2),this.performanceInfo.advance(6),this._oitEnabled?this.renderOrderIndependentTransparency(()=>this.renderTransparentGeometry(),!1):this.renderTransparentGeometry(),this.performanceInfo.advance(7),this.renderEdges(1),this.performanceInfo.advance(8))),o&&this.renderLineCallouts(1),this.setMultipassFlags(!1),this._shadowAccumulator.render(),n.renderToTargets(()=>{this.renderInternalSlot(7),this.renderSlot(13),this.renderSlot(14)},n.currentColorTarget,n.mainDepth),this.performanceInfo.advance(11),this._renderPlugins.needsLaserlineWithContrastControl&&n.renderTmpAndCompositeToMain(()=>this.renderSlot(15),2),this.performanceInfo.advance(12),this.renderOccluded(),this.performanceInfo.advance(13);const l=1===r&&this._magnifierHelper.enabled,d=l&&Object(w["k"])(e)?this._offscreenRendering.getFramebuffer(this._offscreenRendering.tmpColor,this._offscreenRendering.tmpDepth):e;this._rctx.bindFramebuffer(d);const h=this._offscreenRendering.colorTexture;!this.renderAntiAliasing(this._antialiasing,h)&&Object(w["l"])(h)&&this._compositingHelper.composite(h,0),this.performanceInfo.advance(14),this.renderHUD(1,d),this.performanceInfo.advance(17),this.renderHighlights(d,this._bindParameters),this.performanceInfo.advance(15),l&&this._magnifierHelper.render(this._rctx,this._bindParameters),d!==e&&(this._rctx.bindFramebuffer(e),this._compositingHelper.composite(this._offscreenRendering.tmpColorTexture,0)),this._renderContext.lastFrameCamera.copyFrom(this._renderContext.camera),this._sliceHelper.plane=a,this._isRendering=!1,this.onPostRender&&this.onPostRender(),this.performanceInfo.postrender()}readDepthPixels(e,t,i,r,n,a){const s=this._offscreenRendering.bindTarget(this._offscreenRendering.linearDepth,this._offscreenRendering.tmpDepth);if(!this._needsLinearDepth){this.ensureBindParameters(e),this._renderContext.camera.setGLViewport(this._rctx),this._rctx.setClearColor(0,0,0,0);const t=17664;this._rctx.clearSafe(t),this.renderGeometryAndTransparentTerrainPass(2)}s.readPixels(t,i,r,n,6408,5121,a)}readAccumulatedShadow(e,t){return this._shadowAccumulator.readAccumulatedShadow(e,t)}setMultipassFlags(e){this._renderContext.multipassTerrainParams.multipassTerrainEnabled=this._bindParameters.multipassTerrainEnabled=e,this._renderContext.multipassGeometryParams.multipassGeometryEnabled=this._bindParameters.multipassGeometryEnabled=e}setTerrainCulling(e){this._renderContext.multipassTerrainParams.cullAboveGround=this._bindParameters.cullAboveGround=e}renderSlot(e){return this._renderContext.slot=e,this._renderPlugins.render()}renderEdges(e,t=!1){const i=this._edgeView;Object(w["l"])(i)&&i.shouldRender()&&this._offscreenRendering.renderTmpAndCompositeToMain(()=>i.render(this._bindParameters,e),1,t)}renderShadowMap(e,t,i,r){const n=this._shadowMap;n.enabled&&(n.start(t,i,r),this.needsShadowHighlight?(this.renderShadowCascades(7,this._shadowMap,e=>n.takeCascadeSnapshotTo(e,uw)),n.clear(),this.renderShadowCascades(6,this._shadowMap,e=>{n.takeCascadeSnapshotTo(e,pw),this.renderGeometryAndTransparentTerrainPass(7)})):this.renderShadowCascades(4),n.finish(e),t.setGLViewport(this._rctx))}renderShadowCascades(e,t=this._shadowMap,i=(e=>{})){for(const r of t.getCascades())r.camera.setGLViewport(this._rctx),this.ensureCameraBindParameters(r.camera),this.renderGeometryAndTransparentTerrainPass(e),i(r)}get _needsLinearDepth(){return this._ssaoHelper.enabled||this._renderPlugins.needsLinearDepth||this._hasWater&&this._waterReflectionEnabled||this.needsShadowHighlight||this.needsShadowCast}renderLinearDepth(){this._needsLinearDepth?this._offscreenRendering.renderToTargets(()=>this.renderGeometryAndTransparentTerrainPass(2),this._offscreenRendering.linearDepth,this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0):this._offscreenRendering.disposeTarget(this._offscreenRendering.linearDepth),this._renderContext.ssrParams.linearDepthTexture=this._bindParameters.linearDepthTexture=this._offscreenRendering.linearDepthTexture}renderTerrainLinearDepth(e){if(e){const e=this._renderContext.pass;this._renderContext.pass=2,this._offscreenRendering.renderToTargets(()=>this.renderTransparentTerrain(),this._offscreenRendering.terrainLinearDepth,this._offscreenRendering.tmpDepth,[-1e10,-1e10,-1e10,1],!0,!0),this._renderContext.pass=e}else this._offscreenRendering.disposeTarget(this._offscreenRendering.terrainLinearDepth);this._renderContext.multipassTerrainParams.terrainLinearDepthTexture=this._bindParameters.terrainLinearDepthTexture=this._offscreenRendering.terrainLinearDepthTexture}renderGeometryLinearDepth(e){if(e){const e=this._renderContext.pass;this._offscreenRendering.renderToTargets(()=>this.renderGeometryPass(2),this._offscreenRendering.geometryLinearDepth,this._offscreenRendering.tmpDepth,[1,1,1,1],!0,!0),this._renderContext.pass=e}else this._offscreenRendering.disposeTarget(this._offscreenRendering.geometryLinearDepth);this._renderContext.multipassGeometryParams.geometryLinearDepthTexture=this._bindParameters.geometryLinearDepthTexture=this._offscreenRendering.geometryLinearDepthTexture}get needsNormal(){return this._ssaoHelper.enabled}renderNormal(){this.needsNormal?this._offscreenRendering.renderToTargets(()=>{this.renderGeometryAndTransparentTerrainPass(3)},this._offscreenRendering.normal,this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0):this._offscreenRendering.disposeTarget(this._offscreenRendering.normal)}get needsDepthRange(){return this._shadowMap.enabled||this.needsShadowCast}computeDepthRange(e){if(!this.needsDepthRange)return n_;const t=Ox(e,this._content,this._stage.layers);return i_(t,this.renderPlugins.queryDepthRange(e)),t.near=Math.max(e.near,t.near),t.far=Math.min(e.far,t.far),t}renderGeometryAndTransparentTerrainPass(e){this._renderContext.pass=e,this.renderGeometryPass(e),this.renderTransparentTerrain()}renderGeometryPass(e){this._renderContext.pass=e,this.renderOpaqueGeometry(),this.renderTransparentGeometry()}renderOpaqueGeometry(){this.renderSlot(0),this.renderSlot(1),this.renderInternalSlot(2),this.renderSlot(3),this.renderSlot(12)}renderTransparentGeometry(){this.renderInternalSlot(4),this.renderSlot(5)}renderTransparentTerrain(){return this.renderSlot(6)}renderHUDVisibility(){let e=!1;return this._renderContext.offscreenRenderingHelper&&this._renderContext.offscreenRenderingHelper.renderHUDVisibility(()=>{this._bindParameters.hudVisibilityTexture=this._renderContext.offscreenRenderingHelper?this._renderContext.offscreenRenderingHelper.hudVisibilityTexture:null,e=this.renderInternalSlot(11)},this._multipassTerrain&&!this._opaqueTerrain),e}renderLineCallouts(e){this._bindParameters.renderTransparentlyOccludedHUD=e,0===e?this._offscreenRendering.renderToTargets(()=>this.renderInternalSlot(18),this._offscreenRendering.currentColorTarget,this._offscreenRendering.tmpDepth,void 0,!0,!0):this.renderInternalSlot(18)}renderHUD(e,t){this._oitEnabled?(this.renderOrderIndependentTransparency(()=>this.renderHUDElements(e),!0),this._rctx.bindFramebuffer(t),this._compositingHelper.composite(this._offscreenRendering.hudColorTexture,2)):0===e?this._offscreenRendering.renderToTargets(()=>this.renderHUDElements(0),this._offscreenRendering.currentColorTarget,this._offscreenRendering.tmpDepth,void 0,!0,!0):this.renderHUDElements(e)}renderHUDElements(e){this._bindParameters.renderTransparentlyOccludedHUD=e,this.renderInternalSlot(19),this.renderInternalSlot(16),this.renderInternalSlot(17)}get needsHighlight(){return this._hasHighlights||this._renderPlugins.needsHighlight}get needsShadowHighlight(){return this._shadowMap.enabled&&this._shadowHighlightHelper.isVisible&&this.needsHighlight}renderHighlights(e,t){if(!this.needsHighlight)return void this._offscreenRendering.disposeTarget(this._offscreenRendering.highlight);const i=this._highlightHelper,r=i.profilingCallback&&RS(this._renderContext.rctx);this._renderContext.highlightDepthTexture=t.highlightDepthTexture;const n=this._offscreenRendering.renderToTargets(()=>{this.renderGeometryAndTransparentTerrainPass(5),this._rctx.clearSafe(256),this.renderHUDElements(2)},this._offscreenRendering.highlight,this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0);this._bindParameters.highlightColorTexture=n.colorTexture,this.needsShadowHighlight&&this._shadowHighlightHelper.render(t,e),i.render(this._renderContext.camera,n,e),Object(w["l"])(r)&&i.profilingCallback&&r.stop(e=>{i.profilingCallback&&i.profilingCallback(e)})}get needsShadowCast(){return this._shadowAccumulator.isAccumulating}accumulateShadows(e,t,i){this.needsShadowCast&&(this._shadowAccumulator.setAccumulationDependencies(this._offscreenRendering.linearDepthTexture,e,t,i),this._shadowAccumulator.accumulateFixedSamples(),this.renderPassManager.shadowCastingEnabled=this._shadowMap.enabled)}renderOrderIndependentTransparency(e,t){const i=i=>{this._renderContext.transparencyPassType=i,this._bindParameters.transparencyPassType=this._renderContext.transparencyPassType,this._offscreenRendering.renderOITPass(()=>e(),i,t)},r=this._renderContext.pass;this._renderContext.pass=1,i(1),this._renderContext.pass=0,i(0),i(2),this._offscreenRendering.compositeTransparentOntoOpaque(t),this._renderContext.transparencyPassType=3,this._bindParameters.transparencyPassType=this._renderContext.transparencyPassType,this._renderContext.pass=r}renderOccluded(){let e=0;this._materialRenderers.forEach((t,i)=>{i&&i.isVisible()&&8===i.renderOccluded&&(e|=i.renderOccluded,US.push(i))});const t=this._offscreenRendering,i=(i,r,n,a,s)=>{0!=(e&r)&&(t.renderToTargets(n,t.tmpColor,t.mainDepth,[0,0,0,0],a,s),t.compositeOccludedOntoMain(i))};0!==US.length&&(this.renderInternalSlot(9,US),i(.5,8,()=>this.renderInternalSlot(10,US),!1,!1),US.length=0),this._materialRenderers.forEach((t,i)=>{i&&i.isVisible()&&(4===i.renderOccluded||2===i.renderOccluded||16===i.renderOccluded)&&(e|=i.renderOccluded,kS.push(i))});const r=this._renderPlugins.renderOccludedFlags;if(e|=r,!e)return;const n=e=>{this._renderContext.renderOccludedMask=e,r>1&&this.renderSlot(8),this.renderInternalSlot(2,kS),this.renderInternalSlot(4,kS),this.renderInternalSlot(7,kS),this._renderContext.resetRenderOccludedMask()};this._renderContext.pass=0,i(.5,4,()=>n(4),!0,2),i(.5,2,()=>n(2),!0,2),i(1,16,()=>n(16),!0,2),kS.length=0}renderAntiAliasing(e,t){if(1===e){if(this._smaaPass.enable(()=>this._requestRender())&&Object(w["l"])(t))return this._smaaPass.render(t),!0}else this._smaaPass.disable();return!1}ensureCameraBindParameters(e){this._renderContext.camera=e,this._bindParameters.camera=this._renderContext.camera,this._bindParameters.inverseViewport[0]=1/this._renderContext.camera.fullViewport[2],this._bindParameters.inverseViewport[1]=1/this._renderContext.camera.fullViewport[3]}ensureBindParameters(e){var t;this.ensureCameraBindParameters(e);const i=this._renderContext.offscreenRenderingHelper;this._bindParameters.shadowMap=this._renderContext.shadowMap,this._bindParameters.shadowMappingEnabled=this._renderContext.shadowMap.enabled,this._bindParameters.ssaoHelper=this._renderContext.ssaoHelper,this._bindParameters.ssaoEnabled=this._renderContext.ssaoHelper.enabled,this._bindParameters.slicePlane=this._renderContext.sliceHelper.plane,this._bindParameters.hasOccludees=this._renderContext.hasOccludees,this._renderContext.multipassTerrainParams.camera=this._renderContext.camera,this._bindParameters.hudVisibilityTexture=i.hudVisibilityTexture,this._bindParameters.highlightDepthTexture=null!=(t=i.depthTexture)?t:this.getFallbackDepthTexture()}ensureBindParametersSSR(){this.hasWaterReflection?(this._renderContext.lastFrameCamera.equals(this._renderContext.camera)?this._renderContext.ssrParams.reprojectionMatrix=this._reprojectionMatrix=Vt["a"]:(Object(Lt["b"])(BS,this._renderContext.lastFrameCamera.viewMatrix,this._bindParameters.origin?this._bindParameters.origin:[0,0,0]),Object(Lt["b"])(GS,this._renderContext.camera.viewMatrix,this._bindParameters.origin?this._bindParameters.origin:[0,0,0]),Object(Lt["c"])(GS,GS),Object(Lt["c"])(NS,this._renderContext.camera.projectionMatrix),Object(Lt["n"])(qS,GS,NS),Object(Lt["n"])(qS,BS,qS),Object(Lt["n"])(qS,this._renderContext.lastFrameCamera.projectionMatrix,qS),this._renderContext.ssrParams.reprojectionMatrix=this._reprojectionMatrix=qS),this._renderContext.ssrParams.camera=this._renderContext.camera,this._renderContext.ssrParams.lastFrameColorTexture=this._bindParameters.lastFrameColorTexture=this._offscreenRendering.lastFrameColorTexture):this._renderContext.ssrParams.lastFrameColorTexture=this._bindParameters.lastFrameColorTexture=null,this._renderContext.ssrParams.ssrEnabled=this._bindParameters.ssrEnabled=this.hasWaterReflection}renderInternalSlot(e,t){let i=!1;return this._bindParameters.slot=e,Object(w["l"])(t)?t.forEach(t=>{if(!t.shouldRender(this._renderContext))return;const r=this._materialRenderers.get(t);Object(w["l"])(r)&&(i=r.render(e,this._renderContext.pass,this._bindParameters)||i)}):this._materialRenderers.forEach((t,r)=>{r.shouldRender(this._renderContext)&&(i=t.render(e,this._renderContext.pass,this._bindParameters)||i)}),i}getFallbackDepthTexture(){return this._fallbackDepthStencilTexture||(this._fallbackDepthStencilTexture=Object(ai["b"])(this._rctx)),this._fallbackDepthStencilTexture}get gpuMemoryUsage(){var e,t,i,r,n,a,s,o,c,l;return{offscreen:null!=(e=null==(t=this._offscreenRendering)?void 0:t.gpuMemoryUsage)?e:0,highlights:(null!=(i=null==(r=this._highlightHelper)?void 0:r.gpuMemoryUsage)?i:0)+(null!=(n=null==(a=this._shadowHighlightHelper)?void 0:a.gpuMemoryUsage)?n:0),shadows:null!=(s=null==(o=this._shadowMap)?void 0:o.gpuMemoryUsage)?s:0,ssao:null!=(c=null==(l=this._ssaoHelper)?void 0:l.gpuMemoryUsage)?c:0}}get test(){const e=this;return{offscreen:this._offscreenRendering,shadowMap:this._shadowMap,ssao:this._ssaoHelper,highlight:this._highlightHelper,lighting:this._lighting,materialRenderers:this._materialRenderers,shadowAccumulator:this._shadowAccumulator,getFramebufferTexture:t=>{var i;switch(t){case 0:return e._offscreenRendering.colorTexture;case 1:return e._offscreenRendering.linearDepthTexture;case 2:return e._offscreenRendering.normalTexture;case 3:return null==(i=e._shadowMap)?void 0:i.test.depthTexture;case 4:return e._offscreenRendering.hudVisibilityTexture;case 5:return e._offscreenRendering.highlightTexture}}}}};Object(h["a"])([Object(M["b"])()],VS.prototype,"_shadowAccumulator",void 0),Object(h["a"])([Object(M["b"])()],VS.prototype,"_smaaPass",void 0),Object(h["a"])([Object(M["b"])()],VS.prototype,"_antialiasing",void 0),Object(h["a"])([Object(M["b"])()],VS.prototype,"_edgeView",void 0),Object(h["a"])([Object(M["b"])()],VS.prototype,"updating",null),Object(h["a"])([Object(M["b"])()],VS.prototype,"isCameraFinal",null),VS=Object(h["a"])([Object(D["a"])("esri.views.3d.webgl-engine.lib.Renderer")],VS);const kS=[],US=[],BS=Object(Vt["d"])(),NS=Object(Vt["d"])(),GS=Object(Vt["d"])(),qS=Object(Vt["d"])();var HS=i("6df2");class WS extends HS["a"]{constructor(e,t,i){super(e,t),this.newCache=i}}var $S=i("7aed");const ZS=j["a"].getLogger("esri.views.3d.webgl-engine.lib.TextureRepository");let QS=class extends W["a"]{constructor(e,t,i){super({}),this._stage=e,this._techniqueRepository=t,this._rctx=i,this._idToRefCountedTexture=new Map,this._loadingCount=0,this._frameUpdates=new Map,this.events=new Z["a"],this._frameTask=e.resourceController.scheduler.registerTask(Fi["b"].TEXTURE_UNLOAD)}normalizeCtorArgs(){return{}}dispose(){this._frameTask.remove(),this._stage.forEachOfType(4,e=>e.unload())}get updating(){return this._loadingCount>0||this._frameTask.updating}get textureTechnique(){return Object(w["k"])(this._textureTechnique)&&(this._textureTechnique=this._techniqueRepository.acquire($S["a"],new $S["b"])),this._textureTechnique}acquire(e){const t=this._idToRefCountedTexture.get(e);return t?(t.ref(),Promise.resolve(t)):this._createNewRef(e)}update(){let e=!1;this._frameUpdates.forEach(t=>{const i=t.texture.frameUpdate(this._rctx,this.textureTechnique,t.previousToken);i>=0&&i!==t.previousToken&&(t.previousToken=i,e=!0)}),e&&this.events.emit("changed",0)}async _createNewRef(e){const t=this._stage.getObject(e);if(Object(w["k"])(t))return Object(hr["a"])(void 0!==t),null;const i=t.events.on("unloaded",()=>{i.remove(),this._onTextureUnloaded(e)}),r=new XS(e,()=>{this._frameTask.schedule(()=>{r.isUnreferenced&&t.unload()})});return this._idToRefCountedTexture.set(e,r),r.ref(),Object(w["l"])(t.glTexture)?(this._updateGLTexture(r,t.glTexture),t.requiresFrameUpdates&&this._frameUpdates.set(e,{texture:t,previousToken:-1})):(this._loadingCount++,await this._stage.schedule(()=>{const i=t.load(this._rctx,()=>this.textureTechnique),n=i=>(this._loadingCount--,this._updateGLTexture(r,i),t.requiresFrameUpdates&&this._frameUpdates.set(e,{texture:t,previousToken:-1}),r),a=e=>{this._loadingCount--,Object(S["m"])(e)||ZS.error(e)};return Object(S["p"])(i)?i.then(n,a):n(i)})),r}_updateGLTexture(e,t){e.glTexture=t,this.events.emit("changed",1)}_onTextureUnloaded(e){this._idToRefCountedTexture.delete(e),this._frameUpdates.delete(e)}};Object(h["a"])([Object(M["b"])()],QS.prototype,"_loadingCount",void 0),Object(h["a"])([Object(M["b"])()],QS.prototype,"_frameTask",void 0),Object(h["a"])([Object(M["b"])()],QS.prototype,"updating",null),QS=Object(h["a"])([Object(D["a"])("esri.views.3d.webgl-engine.lib.TextureRepository")],QS);class XS{constructor(e,t){this.id=e,this._release=t,this._refCount=0}get isUnreferenced(){return 0===this._refCount}ref(){++this._refCount}release(){--this._refCount,this._refCount>0||(0!==this._refCount?(ZS.error("Cannot dereference texture that has no references!"),this._refCount=0):this._release())}}var YS=i("c1c0");const KS=j["a"].getLogger("esri.views.3d.webgl-engine.materials.internal.waterMaterialUtils");let JS=class extends W["a"]{constructor(){super(...arguments),this._data=new Array,this.loadingState=0}dispose(){this.loadingState=0,this._data.forEach(e=>e.dispose()),this._data.length=0}get updating(){return 1===this.loadingState}get ready(){return 2===this.loadingState}loadTextures(e){const t=[Object(Tr["b"])("esri/images/materials/water/normals.jpg"),Object(Tr["b"])("esri/images/materials/water/perturbation.jpg")];this.loadingState=1,Promise.all(t.map(e=>Object(Wi["a"])(e))).then(t=>{t.forEach(t=>this._data.push(new ir["a"](e,{target:3553,pixelFormat:6408,dataType:5121,wrapMode:10497,samplingMode:9987,hasMipmap:!0,maxAnisotropy:8,width:t.width,height:t.height},t))),this.loadingState=2}).catch(e=>{KS.error("Failed to load textures for water material.",e),this.loadingState=0})}bind(e){this.ready&&(e.bindTexture(this._data[0],"texWaveNormal"),e.bindTexture(this._data[1],"texWavePerturbation"))}};Object(h["a"])([Object(M["b"])()],JS.prototype,"loadingState",void 0),Object(h["a"])([Object(M["b"])({type:Boolean,readOnly:!0})],JS.prototype,"updating",null),JS=Object(h["a"])([Object(D["a"])("esri.views.3d.webgl-engine.materials.internal.WaterTextureRepository")],JS);var eT=i("4dc1");class tT extends xO["a"]{constructor(e,t,i,r=null,n,a=!0){super(),this._rctx=e,this._renderScene=t,this._requestRenderScene=i,this._renderOverlay=r,this.forceCameraHook=n,this.supersample=a,this._screenshotQueue=new Array}dispose(){this._rctx=null}takeScreenshot(e){this._requestRenderScene(0);const t=Object(S["g"])();return this._screenshotQueue.push({settings:e,resolver:t}),t.promise}update(e){for(const t of this._screenshotQueue){if(this.isDisposed){t.resolver.reject();continue}const i={...t.settings,pixelRatio:t.settings.pixelRatio*e.viewCamera.pixelRatio},r=this._ensureScreenshotEncodeCanvas(),n=this._renderScreenshot(e,i),a=Object(eT["b"])(n,i,r,{flipY:!0,premultipliedAlpha:!0});t.resolver(a)}this._screenshotQueue.length=0}_renderScreenshotOverlay(e,t,i){if(Object(w["k"])(this._renderOverlay))return t;e.width=t.width,e.height=t.height;const r=e.getContext("2d"),n=i.pixelRatio;return r.save(),r.translate(0,t.height),r.scale(1,-1),i.region&&r.translate(-i.region.x,-i.region.y),r.scale(n,n),t=this._renderOverlay(e,t),r.restore(),t}_readbackScreenshot(e){return e.resample?this._readbackScreenshotResampled(e):this._readbackScreenshotImmediate(e)}_readbackScreenshotResampled(e){const{framebufferWidth:t,framebufferHeight:i,region:r,resample:n}=e,a=this._ensureScreenshotEncodeCanvas();let s=Object(eT["a"])(t,i,a);this._rctx.gl.readPixels(0,0,t,i,6408,5121,new Uint8Array(s.data.buffer)),s=this._renderScreenshotOverlay(a,s,{...e,region:null});const o=Object(eT["a"])(r.width,r.height,a);return Object(eT["e"])(s,o,!0,n.region.x,i-(n.region.y+n.region.height),n.region.width,n.region.height)}_readbackScreenshotImmediate(e){const{framebufferHeight:t,region:i}=e,r=this._ensureScreenshotEncodeCanvas(),n=Object(eT["a"])(i.width,i.height,r);return this._rctx.gl.readPixels(i.x,t-(i.y+i.height),i.width,i.height,6408,5121,new Uint8Array(n.data.buffer)),this._renderScreenshotOverlay(r,n,e)}_renderScreenshot(e,t){let i=null;const r=e.viewCamera,{framebufferWidth:n,framebufferHeight:a}=t;let s=!1;const o=t.disableDecorations&&e.frameHasDecorations,c=n!==r.fullWidth||a!==r.fullHeight,l=t.ignorePadding&&r.pixelRatio!==t.pixelRatio,d=c||o||l;if(d){const e=r.clone();if(t.ignorePadding){const i=Object(Dt["d"])(e.padding);for(let r=0;r<4;r++)i[r]=Math.round(i[r]/e.pixelRatio*t.pixelRatio);e.padding=i}e.fullWidth=n,e.fullHeight=a,e.pixelRatio=t.pixelRatio;const o=r.fovX-e.fovX,c=r.fovY-e.fovY;o<0&&o<c?e.fovX=r.fovX:c<0&&c<o&&(e.fovY=r.fovY),this.forceCameraHook(e),s=!0,i=new zi["a"](this._rctx,{width:e.fullWidth,height:e.fullHeight,colorTarget:0,depthStencilTarget:3}),this._renderScene(i,e,t.disableDecorations?0:1),!0===t.renderScreenshotTwice&&this._renderScene(i,e,t.disableDecorations?0:1)}const h=this._readbackScreenshot(t);if(d&&!this._rctx.contextAttributes.alpha)for(let u=3;u<h.data.length;u+=4)h.data[u]=255;return i&&i.dispose(),this._rctx.bindFramebuffer(null),s&&this.forceCameraHook(r),h}_ensureScreenshotEncodeCanvas(){return this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas")),this._screenshotEncodeCanvas}}var iT=i("cc15");const rT=j["a"].getLogger("esri.views.3d.webgl-engine.parts.View");let nT=class extends(Object(xO["b"])(W["a"])){constructor(e){super({}),this.events=new Z["a"],this.waterTextureRepository=new JS,this._magnifierHelper=new Nx,this._needsUpdate=!0,this._needsRender=!0,this._idleSuspend=!0,this._needsWaterReflectionUpdate=!1,this._logicUpdateLast=0,this._container=e.container,this._initializeContext(e),Object(C["a"])(this.waterTextureRepository,"loadingState",()=>this.requestRender()),this._magnifierHelper.events.on("request-render",()=>this.requestRender()),this._stippleTextureRepository=new YS["a"](this._rctx),this._shaderTechniqueRepository=new ox["a"]({rctx:this._rctx,viewingMode:e.viewingMode,stippleTextureRepository:this._stippleTextureRepository,waterTextureRepository:this.waterTextureRepository}),this._textureRepository=new QS(e,this._shaderTechniqueRepository,this._rctx),this._textureRepository.events.on("changed",e=>this.requestRender(e)),this._materialRepository=new Lx["a"](this._textureRepository,this._shaderTechniqueRepository,()=>this.requestRender(),()=>this.requestRender()),this._compositingHelper=new hx(this._rctx,this._shaderTechniqueRepository),this._renderer=new VS(this._materialRepository,this._textureRepository,this._shaderTechniqueRepository,this._rctx,this._compositingHelper,this._magnifierHelper,e=>this.requestRender(e),(t,i)=>e.schedule(t,i),e),this._screenshotManager=new tT(this._rctx,(e,t,i)=>this._renderer.render(e,t,t,i),e=>this.requestRender(e),e.options.screenshot.renderOverlay,e=>this.events.emit("force-camera-for-screenshot",e)),this._registerFrameTask(e)}normalizeCtorArgs(){return{}}dispose(){this._container.contains(this._canvas)&&this._container.removeChild(this._canvas),this._frameTask=Object(w["t"])(this._frameTask),this._shaderTechniqueRepository=Object(w["f"])(this._shaderTechniqueRepository),super.dispose(),this._tmpDepthBuffer=null,this._rctx=null}get performanceInfo(){const e=this._rctx.gl;return{renderer:this._renderer.performanceInfo,textureMemory:void 0!==e.getUsedTextureMemory?e.getUsedTextureMemory():void 0,renderbufferMemory:void 0!==e.getUsedRenderbufferMemory?e.getUsedRenderbufferMemory():void 0,VBOMemory:void 0!==e.getUsedVBOMemory?e.getUsedVBOMemory():void 0}}requestRender(e=1){1===e?this._needsUpdate=!0:this._needsRender=!0}get updating(){return this._needsUpdate||this._needsWaterReflectionUpdate||this._renderer.updating||this._textureRepository.updating||this.waterTextureRepository.updating||this._magnifierHelper.updating}ensureEdgeView(){return this._renderer.ensureEdgeView()}get edgeView(){return this._renderer.edgeView}get textureRepository(){return this._textureRepository}get compositingHelper(){return this._compositingHelper}set magnifier(e){this._magnifierHelper.magnifier=e}updateLightSources(e,t,i){this._renderer.updateLightSources(e,t,i),this.requestRender()}setRenderParameters(e){void 0!==e.idleSuspend&&this._idleSuspend!==!!e.idleSuspend&&(this._idleSuspend=!!e.idleSuspend,this.requestRender()),this._renderer.setRenderParameters(e)}get renderingContext(){return this._rctx}get capabilities(){return this._rctx.capabilities}modify(e){this._renderer.modify(e),e.clear()}get canvas(){return this._canvas}takeScreenshot(e){return this._screenshotManager.takeScreenshot(e)}get hasShadowsEnabled(){return this._renderer.hasShadowsEnabled}readAccumulatedShadow(e){return this._renderer.readAccumulatedShadow(e[0],e[1])}getMinimalDepthForArea(e,t,i,r,n,a=n){const s=r.constrainWindowSize(t,i,n*r.pixelRatio,a*r.pixelRatio),o=this._ensureDepthBuffer(s);this._renderer.readDepthPixels(r,s[0],s[1],s[2],s[3],o);let c=Number.MAX_VALUE;for(let l=0;l<s[2]*s[3];l++){const e=yx(4*l,o,r.nearFar);c>e&&e!==r.nearFar[0]&&e!==r.nearFar[1]&&(c=e)}if(Object(w["l"])(e)){const n=e.pickDepth(t*r.pixelRatio,i*r.pixelRatio,r);Object(w["l"])(n)&&c>n&&n!==r.nearFar[0]&&n!==r.nearFar[1]&&(c=n)}return c===Number.MAX_VALUE?void 0:c}_ensureDepthBuffer(e){const t=4*e[2]*e[3];return(Object(w["k"])(this._tmpDepthBuffer)||this._tmpDepthBuffer.byteLength<t)&&(this._tmpDepthBuffer=new Uint8Array(t)),this._tmpDepthBuffer}get renderPlugins(){return this._renderer.renderPlugins}get test(){return{renderer:this._renderer}}get gpuMemoryUsage(){return this._renderer.gpuMemoryUsage}async reloadShaders(){Lg(),await this._shaderTechniqueRepository.reloadAll(),this.requestRender()}_registerFrameTask(e){const t=e.state,i={viewCamera:t.camera,frameHasDecorations:!1},r={preRender:i=>{e.processSyncLayers();const r=Object(On["a"])(i.time-this._logicUpdateLast);if(r>Rg||Object(w["l"])(this.forcedAnimationTime)){const e={camera:t.camera,dt:r,forcedTime:this.forcedAnimationTime};this._logicUpdateLast=i.time,this._renderer.updateLogic(e)&&this.requestRender(0)}},render:()=>{if((this._needsUpdate||this._needsRender||!this._idleSuspend||!this._renderer.isCameraFinal||this._needsWaterReflectionUpdate)&&t.camera.fullWidth>0&&t.camera.fullHeight>0){const e=this._needsUpdate&&this._idleSuspend&&this._renderer.isCameraFinal;this._needsRender=!1,this._needsUpdate=!1,this._needsWaterReflectionUpdate=!1,this._renderer.render(null,t.camera,t.contentCamera,1),e&&this._renderer.hasWaterReflection&&(this.requestRender(0),this._needsWaterReflectionUpdate=!0)}},update:()=>{i.viewCamera=t.camera,i.frameHasDecorations=this._renderer.hasSlicePlane||this._magnifierHelper.enabled,this._textureRepository.update(),this._screenshotManager.update(i)}};this._frameTask=Object(T["a"])(r)}_initializeContext(e){const t=e.options;this._canvas=t.canvas,this._canvas||(this._canvas=document.createElement("canvas")),this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");const i={alpha:t.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:null==t.stencil||t.stencil,powerPreference:"high-performance"};let r;const n=Object(_["a"])("esri-force-webgl");if(1===n||2===n?r=Object(iT["b"])(this._canvas,n,i):(r=Object(iT["a"])(this._canvas,2,i),Object(w["k"])(r)&&(r=Object(iT["b"])(this._canvas,1,i))),Object(w["k"])(r))return void rT.error(n);const a={disabledExtensions:t.deactivatedWebGLExtensions||{},debugWebGLExtensions:t.debugWebGLExtensions||{},maxAnisotropy:8};this._rctx=new WS(r,a,(t,i)=>e.resourceController.memoryController.newCache(t,i)),this._loadShaderOnlyExtensions(),!t.alpha&&this._rctx.contextAttributes.alpha&&rT.error("WebGL context has alpha channel even though no alpha channel was requested"),!this._rctx.contextAttributes.alpha&&Object(_["a"])("safari")>=11&&(this._container.style.backgroundColor="black"),this._container.appendChild(this._canvas)}_loadShaderOnlyExtensions(){this._rctx.capabilities.enable("standardDerivatives"),this._rctx.capabilities.enable("shaderTextureLOD"),this._rctx.capabilities.enable("textureFloat")}get componentObjectCollection(){return Object(w["k"])(this._componentObjectCollection)&&(this._componentObjectCollection=new tx(this._renderer.renderPassManager)),this._componentObjectCollection}set componentObjectCollection(e){this._componentObjectCollection=e}};var aT;Object(h["a"])([Object(M["b"])({type:Boolean,readOnly:!0})],nT.prototype,"updating",null),Object(h["a"])([Object(xO["c"])()],nT.prototype,"_rctx",void 0),Object(h["a"])([Object(xO["c"])()],nT.prototype,"_container",void 0),Object(h["a"])([Object(xO["c"])()],nT.prototype,"_canvas",void 0),Object(h["a"])([Object(xO["c"])()],nT.prototype,"_stippleTextureRepository",void 0),Object(h["a"])([Object(xO["c"])(),Object(M["b"])()],nT.prototype,"waterTextureRepository",void 0),Object(h["a"])([Object(xO["c"])(),Object(M["b"])()],nT.prototype,"_magnifierHelper",void 0),Object(h["a"])([Object(xO["c"])(),Object(M["b"])()],nT.prototype,"_textureRepository",void 0),Object(h["a"])([Object(xO["c"])()],nT.prototype,"_compositingHelper",void 0),Object(h["a"])([Object(xO["c"])()],nT.prototype,"_renderer",void 0),Object(h["a"])([Object(xO["c"])()],nT.prototype,"_screenshotManager",void 0),Object(h["a"])([Object(xO["c"])()],nT.prototype,"componentObjectCollection",null),Object(h["a"])([Object(xO["c"])()],nT.prototype,"_componentObjectCollection",void 0),Object(h["a"])([Object(M["b"])()],nT.prototype,"_needsUpdate",void 0),Object(h["a"])([Object(M["b"])()],nT.prototype,"_needsWaterReflectionUpdate",void 0),nT=Object(h["a"])([Object(D["a"])("esri.views.3d.webgl-engine.parts.RenderView")],nT);let sT=aT=class extends(Object(xO["b"])(W["a"])){constructor(e){super(e),this._handles=new $["a"],this._model=new AO,this._layers=new Fh["a"],this._changeSet=new jO["a"],this._layerSyncSet=new Set}initialize(){this._set("renderView",new nT(this)),this._frameTask=this.resourceController.scheduler.registerTask(Fi["b"].STAGE,this),this._handles.add(this._frameTask)}destroy(){wO["a"].pool.prune(0),this._handles.destroy(),this.dispose()}get viewingMode(){return this.state.viewingMode}get updating(){return this._model.dirtySet.dirty||this.renderView.updating||this._frameTask.updating}add(e){this._model.add(e),Object(mp["b"])(e)&&(e.attachStage(this),this._addLayer(e)),this.renderView.requestRender()}remove(e){Object(w["k"])(e)||(this.renderView.requestRender(),this._model.remove(e),Object(mp["b"])(e)&&(this._removeLayer(e),e.detachStage()))}addMany(e){Object(w["l"])(e)&&(this._model.addMany(e),this.renderView.requestRender())}removeMany(e){Object(w["l"])(e)&&(this._model.removeMany(e),this.renderView.requestRender())}async load(e){Object(w["k"])(e)||(Array.isArray(e)||(e=[e]),await Object(S["b"])(e.filter(e=>Object(w["k"])(e.glTexture)).map(e=>this.schedule(()=>this._model.has(e)?e.load(this.renderView.renderingContext,()=>this.renderView.textureRepository.textureTechnique):null))))}loadSynchronous(e){return e.load(this.renderView.renderingContext,()=>this.renderView.textureRepository.textureTechnique)}forEachOfType(e,t){this._model.forEachOfType(e,t)}handleEvent(e,t){this.destroyed||(this._model.dirtySet[e](t),this.renderView.requestRender())}get running(){return this._model.dirtySet.dirty}runTask(e){this._frameTask.processQueue(e),e.done||this._commit()}_commit(){const e=this._model.dirtySet;aT.DebugSettings.logDirtySet&&console.log("Dirty set: "+e.formatDebugInfo()),e.commit(this._changeSet),aT.DebugSettings.logDirtySet&&(console.log("RGs add: "+this._changeSet.adds.map(e=>e.id)),console.log("RGs remove: "+this._changeSet.removes.map(e=>e.id))),this._layerSyncSet.clear(),this.renderView.modify(this._changeSet),this.renderView.requestRender()}schedule(e,t){return this._frameTask.schedule(e,t)}syncLayer(e){this._layerSyncSet.add(e),this.renderView.requestRender()}processSyncLayers(){const e=this._model.dirtySet;this._layers.forAll(t=>{(this._layerSyncSet.has(t.id)||1===t.updatePolicy)&&(e.commitLayer(t.id,this._changeSet),this._layerSyncSet.delete(t.id))});for(const t of this._layerSyncSet)e.commitLayer(t,this._changeSet);this._layerSyncSet.clear(),this.renderView.modify(this._changeSet)}getObject(e){return this._model.getObject(e)}get layers(){return this._layers}_addLayer(e){this._layers.some(t=>t===e)||this._layers.push(e)}_removeLayer(e){this._commit(),null!=this._layers.removeUnordered(e)&&(this._model.dirtySet.getResidentRenderGeometries(e.id,this._changeSet.removes),this.renderView.modify(this._changeSet))}addRenderPlugin(e,t,i){const r=this.renderView.renderPlugins.add(e,t,i),n=()=>{zb(t)&&this.sceneIntersectionHelper.addIntersectionHandler(t)};if(Object(S["o"])(r))return r.then(n);n()}removeRenderPlugin(e){zb(e)&&this.sceneIntersectionHelper.removeIntersectionHandler(e),this.renderView.renderPlugins.remove(e)}get performanceInfo(){return{renderView:this.renderView.performanceInfo,model:this._model.getStats()}}get test(){const e=this;return{getCount:t=>e._model.test.content.filter(e=>e.type===t).length,model:e._model}}};sT.DebugSettings={endFrameContentValidation:!1,logDirtySet:!1},Object(h["a"])([Object(M["b"])({constructOnly:!0})],sT.prototype,"resourceController",void 0),Object(h["a"])([Object(M["b"])({constructOnly:!0})],sT.prototype,"options",void 0),Object(h["a"])([Object(M["b"])({constructOnly:!0})],sT.prototype,"state",void 0),Object(h["a"])([Object(M["b"])({constructOnly:!0})],sT.prototype,"sceneIntersectionHelper",void 0),Object(h["a"])([Object(M["b"])({readOnly:!0})],sT.prototype,"viewingMode",null),Object(h["a"])([Object(M["b"])({constructOnly:!0})],sT.prototype,"container",void 0),Object(h["a"])([Object(M["b"])({constructOnly:!0})],sT.prototype,"renderSR",void 0),Object(h["a"])([Object(M["b"])({constructOnly:!0})],sT.prototype,"_handles",void 0),Object(h["a"])([Object(M["b"])({readOnly:!0})],sT.prototype,"updating",null),Object(h["a"])([Object(M["b"])({constructOnly:!0})],sT.prototype,"_model",void 0),Object(h["a"])([Object(xO["c"])(),Object(M["b"])()],sT.prototype,"renderView",void 0),sT=aT=Object(h["a"])([Object(D["a"])("esri.views.3d.webgl-engine.Stage")],sT);var oT=i("5c33");async function cT(e,t){if("2d"===e.type)return e.hitTest(t);const i=await e.hitTest(t),r=i.results[0],n=i.results.findIndex(e=>e.distance!==r.distance);return-1!==n&&(i.results=i.results.slice(0,n)),i}var lT=i("5e70"),dT=i("412f"),hT=i("c4da"),uT=i("ca85");let pT=class extends uT["a"]{constructor(e){super(e),this.components=["attribution","zoom","navigation-toggle","compass"]}};Object(h["a"])([Object(M["b"])()],pT.prototype,"components",void 0),pT=Object(h["a"])([Object(D["a"])("esri.views.ui.3d.DefaultUI3D")],pT);const fT=pT,bT=j["a"].getLogger("esri.views.SceneView");let mT=class extends(Object(q["a"])(Object(H["a"])(Object(ae["a"])(se["a"])))){constructor(e){super(e),this._userClippingArea=null,this._clippingArea=null,this._initialDefaultSpatialReference=null,this._defaults={},this._externallySet={environment:!1},this._createGraphicsViewController=null,this._resolveWhenReady=[],this.propertiesPool=new pf["a"]({slicePlane:k["a"]},this),this._resourceController=ym(this),this._defaultToMapOptions={include:new Set},this._defaultHitTestOptions={exclude:new Set},this.deconflictor=new ju({view:this}),this.labeler=new vp({view:this,deconflictor:this.deconflictor.labels}),this.sharedSymbolResources=null,this.basemapTerrain=null,this.elevationProvider=null,this.camera=null,this.canvas=null,this.center=null,this.constraints=new ke,this.environmentManager=new pn,this.extent=null,this.floors=new m["a"],this.windowDevicePixelRatio=1,this.fullOpacity=1,this.graphicsView=null,this.analysisViewManager=new ve({view:this}),this.groundView=null,this.navigating=!1,this.map=null,this.screenSizePerspectiveEnabled=!0,this.state=new bf,this.scale=null,this.spatialReference=null,this.alphaCompositingEnabled=!1,this.supersampleScreenshotsEnabled=!0,this.type="3d",this.ui=new fT,this._numUpdating=0,this._lastUpdateTime=0,this.updatingProgress=.5,this.viewpoint=null,this.zoom=null,this.highlightOptions=new $b,Object(P["a"])(),e&&e.environment||(this._defaults.environment=new Rt,this.environment=this._defaults.environment);const t=e=>{Object(w["l"])(e)&&4===e.type||(this.updatingChanged(),this.map&&this.map.allLayers.forEach(async e=>{try{await e.when()}catch{}this.updatingChanged()}))};this.handles.add([Object(C["b"])(this,"map.allLayers","after-changes",t,t,t,!0),this.allLayerViews.on("after-changes",e=>this._updateUpdatingMonitors(e)),this.watch("map",e=>{e&&e.load&&e.load().catch(()=>{})})]),this.inputManager=new Dh({view:this});const i=()=>{const e=window.devicePixelRatio;e!==this.windowDevicePixelRatio&&(this.windowDevicePixelRatio=e,this.notifyChange("pixelRatio"))};this.stateManager=new jb({view:this,updateDevicePixelRatio:i})}initialize(){this.groundView=new ne({view:this}),this._updateUpdatingMonitors();const e=()=>this._updateDefaultToMapOptions();this.handles.add(Object(C["b"])(this,"map.allLayers","after-changes",e,e,e)),this.updatingHandles.add(this.qualitySettings,"memoryLimit",e=>{this.resourceController&&(this.resourceController.memoryController.maxMemory=e)},2),this.updatingHandles.add(this.qualitySettings,"additionalCacheMemory",e=>{this.resourceController&&(this.resourceController.memoryController.additionalCacheMemory=e)},2),this.updatingHandles.add(this.qualitySettings,"frameRate",e=>Object(T["c"])(e>0?1e3/Math.ceil(e):0),2),this.updatingHandles.add(Lh["a"],"SCENEVIEW_LOCKING_LOG",e=>this.defaultsFromMap.logDebugInformation=e,2),this.updatingHandles.add(this,"map.ground",e,3),this.updatingHandles.add(this,"map.ground.opacity",()=>this._updateDefaultHitTestOptions(),3),this.handles.add(this.watch("spatialReference",()=>this.notifyChange("clippingArea"),!0))}destroy(){this.destroyed||(this.invalidate(),this.activeTool=null,this.layerViewManager.clear(),this._exitSurface(),this._disposeGraphicsView(),this.sharedSymbolResources=Object(w["e"])(this.sharedSymbolResources),this.labeler.destroy(),this._set("labeler",null),this.deconflictor.destroy(),this._set("deconflictor",null),this._resourceController=Object(w["e"])(this._resourceController),this.stateManager.destroy(),this._set("stateManager",null),this.inputManager.destroy(),this._set("inputManager",null),this.propertiesPool.destroy(),this.handles.remove("updatingMonitors"),this.environmentManager.destroy(),this._set("environmentManager",null),this.groundView=Object(w["e"])(this.groundView))}get renderSpatialReference(){return this.renderCoordsHelper&&this.renderCoordsHelper.spatialReference}get basemapSpatialReference(){return this.basemapTerrain&&this.basemapTerrain.spatialReference}installContentCameraReset(e={sticky:!1}){return this.stateManager.installContentCameraReset(e)}get clippingArea(){if("global"===this.viewingMode)return null;let e=this._userClippingArea||this.get("map.clippingArea");return!this._userClippingArea&&!this.get("map.clippingEnabled")||Object(w["k"])(e)?(this._clippingArea=null,null):e instanceof il["a"]?this.spatialReference&&(e=yT(e,this.spatialReference),Object(w["k"])(e))?(bT.error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea):(e=e.clone(),Object(w["k"])(e.intersection(this.groundAndLayersExtent))&&(e.xmin=e.xmax,e.ymin=e.ymax),e.zmin=void 0,e.zmax=void 0,e.equals(this._clippingArea)||(this._clippingArea=e),this._clippingArea):(bT.error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea)}set clippingArea(e){this.ready&&"global"===this.viewingMode&&Object(w["l"])(e)?bT.error("#clippingArea=","Clipping area is only supported in local viewingMode"):this._userClippingArea=e}get renderDataExtent(){if(1===this.state.viewingMode)return null;const e=this.renderSpatialReference,t=this.dataExtent;return Object(w["k"])(t)||Object(w["k"])(e)||t.spatialReference.equals(e)?t:yT(t,e)}get dataExtent(){let e=this.groundAndLayersExtent;const t=this.spatialReference||c["a"].WGS84,i=yT(this.clippingArea,t);Object(w["l"])(i)&&(e=Object(w["l"])(e)?e.intersection(i):i);const r=this._get("dataExtent");return Object(w["l"])(e)&&e.equals(r)?r:e}get groundAndLayersExtent(){const e=this.spatialReference||c["a"].WGS84;let t;const i=i=>{const r=yT(i,e);Object(w["k"])(r)||(Object(w["l"])(t)?t.union(r):t=r.clone())},r=this.basemapTerrain;if(null!=r&&r.spatialReference){const e=r.groundExtent;i(new il["a"]({xmin:e[0],ymin:e[1],zmin:0,xmax:e[2],ymax:e[3],zmax:0,spatialReference:r.spatialReference}))}if(this.map){const e=e=>{!Object(w["l"])(e.fullExtent)||"graphics"===e.type&&e.internal||i(e.fullExtent)};this.map.allLayers.forEach(t=>e(t))}if(Object(w["k"])(t))return null;t.hasZ?(t.zmin=Math.min(0,t.zmin),t.zmax=Math.max(0,t.zmax)):(t.zmin=0,t.zmax=0);const n=this._get("groundAndLayersExtent");return t.equals(n)?n:t}set environment(e){e!==this._defaults.environment&&(this._externallySet.environment=!0),this._set("environment",e)}castEnvironment(e){return e?e instanceof Rt?e:e instanceof Pt?null!=this.environment?this.environment.cloneWithWebsceneEnvironment(e):Rt.fromWebsceneEnvironment(e):Object(I["m"])(Rt,e):new Rt}get pixelRatio(){return Math.min(this.windowDevicePixelRatio,this.maximumPixelRatio)}set pixelRatio(e){Object(w["l"])(e)?this._override("pixelRatio",e):this._clearOverride("pixelRatio")}get maximumPixelRatio(){let e=1/0;const{maximumPixelRatio:t,maximumRenderResolution:i}=this.qualitySettings;if(null!=t&&(e=Math.min(e,t)),null!=i){const t=i/Math.max(this.width,this.height);e=Math.min(e,t)}return e}set maximumPixelRatio(e){Object(w["l"])(e)?this._override("maximumPixelRatio",e):this._clearOverride("maximumPixelRatio")}get initialExtentRequired(){return this.stateManager&&!this.stateManager.hasInitialView}get _defaultsFromMapSettings(){return{required:{tileInfo:!1,heightModelInfo:!0,extent:!1}}}get interacting(){return this.navigating||Object(w["l"])(this.activeTool)}get stationary(){return!this.animation&&!this.resizing&&(Object(w["k"])(this.state)||this.state.stationary)}set qualityProfile(e){qb.isValidProfile(e)&&(qb.apply(e,this.qualitySettings),this._set("qualityProfile",e))}get qualityProfile(){return this._get("qualityProfile")||qb.getDefaultProfile()}set slicePlane(e){if(Object(w["l"])(this._stage)&&this._stage.renderView.setRenderParameters({slicePlane:e}),Object(w["k"])(e))return void this._set("slicePlane",null);const t=this.propertiesPool.get("slicePlane");Object(k["b"])(e,t),this._set("slicePlane",t)}get typeSpecificPreconditionsReady(){return!!this.viewingMode}get resolution(){return null!=this.spatialReference?Object(B["a"])(this.scale,this.spatialReference):0}get heightModelInfo(){const e=this.getDefaultHeightModelInfo();return null!=e?z["a"].deriveUnitFromSR(e,this.spatialReference):null}get updating(){var e,t,i;if(this.destroyed)return!1;let r=0,n=this.layerViewManager.updating,a=n?this.layerViewManager.updatingRemaining:0;this.allLayerViews.forEach(e=>{if(e.isFulfilled()){if(e.updating){if(n=!0,e.suspended||Object(xm["j"])(e))return;++a,r+=e.updatingProgress}}else++a});for(const s of[this.graphicsView,this.basemapView,this._resourceController,this._stage,this.featureTiles,this.pointsOfInterest,this.environmentManager,this.overlay,this.featureTreeDebugger,this.toolViewManager,this.analysisViewManager])if(Object(w["l"])(s)&&s.updating){const e=.1;a+=e,r+=.5*e}for(const s of[this.deconflictor,this.labeler,this.basemapTerrain])Object(w["l"])(s)&&s.updating&&(++a,r+=s.updatingProgress);if(n=!!(n||a>0||this.updatingHandles.updating||!this.ready||!this.stationary||this._createGraphicsViewController||null!=(e=this.inputManager)&&e.hasPendingInputs||null!=(t=this.map)&&null!=(i=t.allLayers)&&i.some(e=>!e.isFulfilled())),n?(this._numUpdating=Math.max(a,this._numUpdating),r+=this._numUpdating-a):this._numUpdating=0,this._numUpdating>0?r/=this._numUpdating:r=n?0:1,this._get("updatingProgress")!==r){const e=this._resourceController.scheduler.now;if(r<1){const t=Math.min((e-this._lastUpdateTime)/2e3,1);r=this.updatingProgress*(1-t)+r*t}this._set("updatingProgress",r),this._lastUpdateTime=n&&r<1?e:0}return n}get viewingMode(){var e;const t=this._predeterminedViewingMode;if(Object(w["l"])(t))return Object(ce["a"])(t);const i=this.spatialReference;return Object(w["l"])(null==(e=this.defaultsFromMap)?void 0:e.viewingMode)&&i&&i.equals(this.defaultsFromMap.spatialReference)?Object(ce["a"])(this.defaultsFromMap.viewingMode):!i||Object(Il["a"])(i,1)?"global":"local"}set viewingMode(e){this.ready?bT.error("#viewingMode","viewingMode cannot be set once view is ready"):e?this._override("viewingMode",e):void 0===e&&this._clearOverride("viewingMode")}get resourceController(){return this._resourceController}get performanceInfo(){return new wm(this)}forceAnimationTime(e){this._stage.renderView.forcedAnimationTime=this.basemapTerrain.overlayManager.forcedAnimationTime=e}on(e,t,i,r){const n=this.viewEvents.on(e,t,i,r);return n||super.on(e,t)}hasEventListener(e){return super.hasEventListener(e)||this.viewEvents.hasHandler(e)}toMap(e,t){if(!this.ready)return bT.error("#toMap()","Scene view cannot be used before it is ready"),null;const i=t?this.externalToInternalIntersectOptions(t):this._defaultToMapOptions,r=Object(w["l"])(i.graphics)&&(Object(w["l"])(i.graphics.include)||Object(w["l"])(i.graphics.exclude)),n=Object(dT["d"])(e)?Object(dT["c"])(this,e):e,a=Object(A["j"])(n);i.enableDraped=i.include&&!i.include.has(og["b"])||i.exclude&&i.exclude.has(og["b"]);const s=this.sceneIntersectionHelper,o=Object(Xn["b"])(this.state.viewingMode);if(o.options.selectionMode=!0,o.options.store=r?2:0,s.intersectIntersectorScreen(a,o,i),r){for(const e of o.results.all){const t=Object(oT["a"])(e,this);if(Object(w["k"])(t))return this._intersectResultToMapPoint(e);if(this._testGraphicUidFilter(i.graphics,t))return this._intersectResultToMapPoint(e)}return null}return this._intersectResultToMapPoint(o.results.min)}toScreen(e){if(!this.ready)return bT.error("#toScreen()","Scene view cannot be used before it is ready"),null;const t=Object(w["v"])(null==e.z&&Object(K["b"])(this.elevationProvider,e),0);return Object(L["t"])(e,OT,this.renderSpatialReference,t),this.state.camera.projectToScreen(OT,_T),Object(A["f"])(_T[0],_T[1])}pixelSizeAt(e){return this.ready?e?(Object(L["t"])(e,OT,this.renderSpatialReference),this.state.camera.computeScreenPixelSizeAt(OT)):0:(bT.error("#pixelSizeAt()","Scene view cannot be used before it is ready"),null)}overlayPixelSizeInMapUnits(e){const t=this.basemapTerrain.overlayManager;return t?t.overlayPixelSizeInMapUnits(e):1}hitTest(e,t){if(!this.ready)return bT.error("#hitTest()","Scene view cannot be used before it is ready"),null;const i=Object(dT["d"])(e)?Object(dT["c"])(this,e):e,r=Object(A["g"])(i.x,i.y),n=t?this.externalToInternalIntersectOptions(t):this._defaultHitTestOptions;n.requiresGroundFeedback=!0,n.enableDraped=!0;const a=Object(Xn["b"])(this.state.viewingMode);a.options.selectionMode=!0,a.options.store=2,this.sceneIntersectionHelper.intersectIntersectorScreen(r,a,n);const s=this._intersectResultsToHits(a.results.all,n.graphics),o=a.results.ground,c=Object(oT["b"])(o,this),l=Object(w["l"])(c)&&"type"in c&&"integrated-mesh"===c.type?c:null,d={screenPoint:i,results:s,ground:{mapPoint:this._intersectResultToMapPoint(o),distance:Object(Rb["c"])(o)?o.distanceInRenderSpace:0,layer:l}};return Lh["a"].SCENEVIEW_HITTEST_RETURN_INTERSECTOR&&(d.intersector=a),Promise.resolve(d)}popupHitTest(e){return cT(this,e).then(({results:t,ground:i})=>{let r=null;return!(0===t.length||Math.abs(Object(w["v"])(t[0].distance,0)-i.distance)<1e-5)||i.layer&&"integrated-mesh"===i.layer.type||(r=i.mapPoint),{results:t,screenPoint:e,mapPoint:r}})}goTo(e,t){return this.updatingHandles.addPromise(this.stateManager.goTo(e,t))}async whenAnalysisView(e){if(Object(w["k"])(e.parent))throw new v["a"]("view:no-analysisview-for-analysis","The analysis has not been added to an AnalysisLayer or SceneView.analyses",{analysis:e});return"analysis"===e.parent.type?(await this.whenLayerView(e.parent)).whenAnalysisView(e):this.analysisViewManager.whenAnalysisView(e)}whenLayerView(e){return super.whenLayerView(e)}takeScreenshot(e){return this.whenReady().then(()=>{const t=Object(eT["g"])(e,this);for(const e of this.map.allLayers.items)"voxel"===e.type&&(t.renderScreenshotTwice=!0);return t.pixelRatio/=this.pixelRatio,this._stage.renderView.takeScreenshot(Object(eT["f"])(t,this.supersampleScreenshotsEnabled,this.padding))})}addUpdatingPromise(e){return this.updatingHandles.addPromise(e)}importLayerView(e){return pe.importLayerView(e)}hasLayerViewModule(e){return pe.hasLayerViewModule(e)}forceDOMReadyCycle(){this.forceReadyCycle()}getDefaultSpatialReference(){var e,t,i,r;return this.map&&"initialViewProperties"in this.map&&(null==(e=this.map)||null==(t=e.initialViewProperties)?void 0:t.spatialReference)||(null==(i=this.defaultsFromMap)?void 0:i.spatialReference)||(null==(r=this.defaultsFromMap)?void 0:r.ready)&&this._initialDefaultSpatialReference||null}async validate(){let e=Object(hT["a"])();if(Object(_["a"])("safari")&&Object(_["a"])("safari")<9&&(e=new v["a"]("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:Object(_["a"])("safari")})),Object(w["l"])(e))throw bT.warn("#validate()",e.message),e}get _predeterminedViewingMode(){var e,t;const i=this._isOverridden("viewingMode")?this._get("viewingMode"):null!=(e=this.map&&"initialViewProperties"in this.map?null==(t=this.map.initialViewProperties)?void 0:t.viewingMode:null)?e:null;return Object(w["l"])(i)?Object(ce["b"])(i):null}getSpatialReferenceSupport({spatialReference:e,layer:t}){const i=this._predeterminedViewingMode;if(Object(w["l"])(i))return this._validateSpatialReferenceForViewingMode(e,t,i)?{constraints:this._makeSpatialReferenceConstraints(e,t,i)}:null;const r=this._validateSpatialReferenceForViewingMode(e,t,2),n=this._validateSpatialReferenceForViewingMode(e,t,1);return r||n?r&&n?{constraints:this._makeSpatialReferenceConstraints(e,t,null)}:r?{constraints:this._makeSpatialReferenceConstraints(e,t,2)}:{constraints:this._makeSpatialReferenceConstraints(e,t,1)}:null}_validateSpatialReferenceForViewingMode(e,t,i){return!!Object(Il["a"])(e,i)&&(!!Object(w["k"])(t)||(!Object(G["c"])(t)||!Object(w["k"])(Object(xm["d"])(t,e,i)))&&("voxel"!==t.type||2===i))}_makeSpatialReferenceConstraints(e,t,i){return t&&!Object(G["c"])(t)&&"voxel"!==t.type&&(e.isWebMercator||e.isWGS84)?[{spatialReference:e,viewingMode:i},{spatialReference:e.isWebMercator?c["a"].WGS84:c["a"].WebMercator,viewingMode:i}]:[{spatialReference:e,viewingMode:i}]}_validateSpatialReference(e){const t=Object(w["l"])(this.getSpatialReferenceSupport({spatialReference:e})),i=this._predeterminedViewingMode;return t||(Object(w["l"])(i)?bT.warnOnce(`Spatial reference defined on view not supported in ${Object(ce["a"])(i)} viewing mode.`):e.isGeographic&&bT.warnOnce("Spatial reference is geographic but not supported.")),t}whenReady(){return new Promise(e=>{this.ready?e(this):this._resolveWhenReady.push(e)})}computeMapPointFromVec3d(e,t){let i=this.spatialReference||c["a"].WGS84;return Object(L["y"])(e,this.renderSpatialReference,e,i)||(i=c["a"].WGS84,Object(L["y"])(e,this.renderSpatialReference,e,i)),t?(t.x=e[0],t.y=e[1],t.z=e[2],t.spatialReference=i):t=new Br["a"](e,i),t}trackGraphicState(e){if(!e.graphic)return bT.error("trackGraphicState","GraphicState.graphic must not be null or undefined to start tracking"),null;const t=this.getViewForGraphic(e.graphic);let i=null,r=!1;const n=t=>{!r&&Object(w["l"])(t)&&"graphics3d"in t&&t.graphics3d&&t.graphics3d.graphicsCore&&(i=t.graphics3d.graphicsCore.trackGraphicState(e))};return Object(w["l"])(t)?n(t):this.whenViewForGraphic(e.graphic,{waitForLayer:!0}).then(e=>n(e),()=>{}).catch(()=>{}),{remove:()=>{r=!0,Object(w["l"])(i)&&(i.remove(),i=null)}}}highlight(e){if(Array.isArray(e))return Object(O["b"])(e.map(e=>this.highlight(e)));if(m["a"].isCollection(e))return Object(O["b"])(e.toArray().map(e=>this.highlight(e)));const t=this.getViewForGraphic(e);return t&&"highlight"in t?t.highlight(e):Object(O["c"])()}maskOccludee(e){if(!e)return bT.error("maskOccludee","GraphicState.graphic must not be null or undefined to mask an occludee"),null;const t=this.getViewForGraphic(e);let i=null,r=!1;const n=t=>{!r&&Object(w["l"])(t)&&"graphics3d"in t&&Object(lT["c"])(t)&&(i=t.maskOccludee(e))};return Object(w["l"])(t)?n(t):this.whenViewForGraphic(e,{waitForLayer:!0}).then(e=>n(e),()=>{}).catch(()=>{}),{remove:()=>{r=!0,Object(w["l"])(i)&&(i.remove(),i=null)}}}getViewForGraphic(e){return e.layer===this.graphics?this.graphicsView:e.layer?this.allLayerViews.find(t=>t.layer===e.layer):null}graphicChanged(e){Object(w["l"])(this.graphicsView)&&this.graphicsView.graphicChanged(e)}async whenViewForGraphic(e,t){if(e.layer===this)return await Object(C["k"])(this,"graphicsView"),this.graphicsView;if(!e.layer||!this.map)throw new v["a"]("no-view-for-graphic");return t&&t.waitForLayer&&!this.map.allLayers.includes(e.layer)?new Promise((t,i)=>{const r=this.map.allLayers.on("change",n=>{-1!==n.added.indexOf(e.layer)&&(r.remove(),this.whenLayerView(e.layer).then(t,i))})}):this.whenLayerView(e.layer)}externalToInternalIntersectOptions(e){const t=this._externalToInternalRenderItems(e.include,0),i=this._externalToInternalRenderItems(e.exclude,1);return{include:t.layerUids,exclude:i.layerUids,graphics:{include:t.graphicUids,exclude:i.graphicUids}}}_intersectResultToMapPoint(e,t){return e.getIntersectionPoint(OT)?(t=this.computeMapPointFromVec3d(OT,t),2===e.intersector&&this.basemapTerrain&&(t.z=Object(w["v"])(Object(K["b"])(this.basemapTerrain,t),0)),t):null}_intersectResultsToHits(e,t){const i=new Array;let r=null;for(let n=0;n<e.length;n++){const a=e[n],s=Object(oT["b"])(a,this);if(Object(w["l"])(s)&&(s===this.map.ground||"type"in s&&"integrated-mesh"===s.type))break;const o=Object(oT["a"])(a,this);if(!Object(w["l"])(o))continue;if(Object(w["k"])(r)&&n!==e.length-1&&(r=new Set),Object(w["l"])(r)){const e=this._getGraphicFilterUid(o);if(r.has(e))continue;r.add(e)}if(!this._testGraphicUidFilter(t,o))continue;const c=this._intersectResultToMapPoint(a),l=a.distanceInRenderSpace;i.push({graphic:o,mapPoint:c,distance:l})}return i}_getGraphicFilterUid(e){if(e.layer&&"objectIdField"in e.layer){const t=e.attributes[e.layer.objectIdField];if(t)return`o-${e.layer.id}-${t}`}return"u-"+e.uid}_testGraphicUidFilter(e,t){const i=this._getGraphicFilterUid(t);return Object(w["k"])(e)||(Object(w["k"])(e.include)||e.include.has(i))&&(Object(w["k"])(e.exclude)||!e.exclude.has(i))}_externalToInternalRenderItems(e,t,i={layerUids:null,graphicUids:null}){if(!e)return i;if(e instanceof p["a"])vT(i,this._getGraphicFilterUid(e)),0===t&&(Object(w["l"])(this.graphicsView)&&e.layer===this?gT(i,this.graphicsView.graphics3d.layer.id):e.layer&&gT(i,e.layer.uid));else if(Object(x["c"])(e))for(const r of e)r===this.graphics&&Object(w["l"])(this.graphicsView)?gT(i,this.graphicsView.graphics3d.layer.id):r instanceof f["a"]?r===this.map.ground&&gT(i,og["b"]):this._externalToInternalRenderItems(r,t,i);else gT(i,e.uid);return i}_initBasemapTerrain(){this._set("basemapTerrain",new hO({view:this})),this._set("elevationProvider",new Ub({view:this})),this.elevationProvider.register("ground",this.basemapTerrain)}_exitBasemapTerrain(){this.basemapTerrain&&(this.elevationProvider.unregister(this.basemapTerrain),this.elevationProvider.destroy(),this._set("elevationProvider",null),this.basemapTerrain.destroy(),this._set("basemapTerrain",null))}_initGlobe(){this._initCoordinateSystem(),this.state.createInitialCamera(),this._initBasemapTerrain(),this._set("pointsOfInterest",new pg({view:this})),this._set("featureTiles",new hf({renderCoordsHelper:this.renderCoordsHelper,cameraOnSurface:this.pointsOfInterest.contentCameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,scheduler:this._resourceController.scheduler,terrain:this.basemapTerrain}));const e=()=>{const e=this.basemapTerrain&&this.basemapTerrain.extent;if(this.clippingArea||e)if(e&&this.basemapTerrain.spatialReference){const e=Object(w["l"])(this.basemapTerrain.extent)?Object(L["m"])(Object(V["B"])(this.basemapTerrain.extent,this.basemapTerrain.spatialReference),this.spatialReference):null;Object(w["l"])(this.clippingArea)?this.featureTiles.filterExtent=this.clippingArea.intersection(e):this.featureTiles.filterExtent=e}else this.featureTiles.filterExtent=this.clippingArea;else this.featureTiles.filterExtent=null};this.handles.add([this.updatingHandles.add(Lh["a"],"FEATURE_TILE_TREE_SHOW_TILES",e=>{e&&this.featureTiles&&!this.featureTreeDebugger?this.updatingHandles.addPromise(i.e("chunk-17816536").then(i.bind(null,"8e36"))).then(({FeatureTileTree3DDebugger:e})=>{!this.featureTreeDebugger&&Lh["a"].FEATURE_TILE_TREE_SHOW_TILES&&(this.featureTreeDebugger=new e({view:this}))}):e||!this.featureTreeDebugger||Lh["a"].FEATURE_TILE_TREE_SHOW_TILES||(this.featureTreeDebugger.destroy(),this.featureTreeDebugger=null)},3),this.updatingHandles.add(this,"clippingArea",e,3),this.updatingHandles.add(this,"basemapTerrain.extent",e,3)],"feature-tiles"),this.stateManager.init()}_exitGlobe(){this.state&&(this.stateManager.deinit(),this.handles.remove("render-coords-helper"),this.handles.remove("feature-tiles"),this.featureTiles.destroy(),this._set("featureTiles",null),this.pointsOfInterest.destroy(),this._set("pointsOfInterest",null),this._exitBasemapTerrain(),this.state.exit(),this._exitCoordinateSystem())}_initCoordinateSystem(){if(this.spatialReference){const e=this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(e)||this._set("mapCoordsHelper",new Yb(this.map,e));const t=this.state.isGlobal,i=Object(U["k"])(t,e);i!==this.renderSpatialReference&&(this._set("renderCoordsHelper",am["a"].create(this.state.viewingMode,i)),t||this.handles.add(this.watch("basemapTerrain.extent",e=>{const t=this.renderCoordsHelper.spatialReference;0===e[0]&&0===e[1]&&0===e[2]&&0===e[3]||!Object(L["n"])(e,this.basemapTerrain.spatialReference,xT,t)||(this.renderCoordsHelper.extent=xT)},!0),"render-coords-helper"),this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(Xn["a"]/this.renderCoordsHelper.unitInMeters))}else this._set("mapCoordsHelper",null),this._set("renderCoordsHelper",null)}_exitCoordinateSystem(){this.mapCoordsHelper&&(this.handles.remove("render-coords-helper"),this._set("renderCoordsHelper",null),this._set("mapCoordsHelper",null))}updatingChanged(){this.notifyChange("updating")}_updateUpdatingMonitors(e=null){Object(w["l"])(e)&&4===e.type||(this.handles.remove("updatingMonitors"),this.allLayerViews.forEach(e=>{e.destroyed||(this.handles.add([e.watch(["updating","updatingProgress"],()=>this.updatingChanged(),!0)],"updatingMonitors"),e.when(()=>this.updatingChanged(),()=>this.updatingChanged()))}),this.updatingChanged())}_renderScreenshotOverlay(e,t){if(!this.overlay||!this.overlay.hasVisibleItems)return t;const i=e.getContext("2d");return i.putImageData(t,0,0),this.overlay.renderCanvas(e),i.getImageData(0,0,t.width,t.height)}_initStage(){const e={deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions,alpha:this.alphaCompositingEnabled,canvas:this.renderCanvas,screenshot:{renderOverlay:(e,t)=>this._renderScreenshotOverlay(e,t)}},t=new Eb(this.state.viewingMode,e=>this._stage.layers.forAll(e),this);this._set("sceneIntersectionHelper",t);const i=Object(g["a"])(this.surface),{resourceController:r,state:n,renderSpatialReference:a}=this;this._stage=new sT({options:e,container:i,resourceController:r,state:n,sceneIntersectionHelper:t,renderSR:a}),this._lostWebGLContextHandle=Object(y["c"])(this._stage.renderView.canvas,"webglcontextlost",()=>this.fatalError=new v["a"]("webgl-context-lost")),this.handles.add([this.updatingHandles.add(this.qualitySettings,"antialiasingEnabled",()=>{this._stage.renderView.setRenderParameters({antialiasingEnabled:this.qualitySettings.antialiasingEnabled})},2),this.updatingHandles.add(this.qualitySettings,"highQualityTransparency",()=>{this._stage.renderView.setRenderParameters({highQualityTransparency:this.qualitySettings.highQualityTransparency})},2),Object(C["a"])(this,"magnifier",e=>this._stage.renderView.magnifier=e,!0)],"stage");const s=()=>{this._stage.renderView.setRenderParameters({defaultHighlightOptions:$b.toEngineOptions(this.highlightOptions)})};for(const o of["highlightOptions","highlightOptions.color","highlightOptions.haloColor","highlightOptions.haloOpacity","highlightOptions.fillOpacity","highlightOptions.shadowOpacity","highlightOptions.shadowColor","highlightOptions.shadowDifference"])this.handles.add(this.updatingHandles.add(this,o,s),"stage");s(),this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(Xn["a"]/this.renderCoordsHelper.unitInMeters),this._set("canvas",this._stage.renderView.canvas)}_exitStage(){this._set("sceneIntersectionHelper",null),this._stage.destroy(),this._stage=null,this._lostWebGLContextHandle.remove(),this._lostWebGLContextHandle=null,this.handles.remove("stage"),this._set("canvas",null)}_initSurface(e){this._exitSurface(),this.state.init(e,this.spatialReference),this._initStage(),this._initGlobe(),this.sharedSymbolResources=new Am({view:this,viewingMode:e,resourceController:this._resourceController,pointsOfInterest:this.pointsOfInterest,viewState:this.state,objectResourceCache:new Cp})}_exitSurface(){this.sharedSymbolResources&&(this.sharedSymbolResources.objectResourceCache.destroy(),this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null,this._exitGlobe(),this._exitStage())}_createGraphicsViewIfNeeded(){if(this.graphicsView||this._createGraphicsViewController)return;if(0===this.graphics.length)return;this.handles.remove("graphics-view"),this._createGraphicsViewController=new AbortController;const e=()=>{this._createGraphicsViewController=null,this.updatingChanged()};this._createGraphicsViewAsync(this._createGraphicsViewController.signal).then(e,e),this.updatingChanged()}async _createGraphicsViewAsync(e){const t=(await Promise.all([i.e("chunk-66a552f7"),i.e("chunk-1d31f51e")]).then(i.bind(null,"3c0a"))).default;Object(S["w"])(e),await Object(C["m"])(this.basemapTerrain,"ready",e),this._set("graphicsView",new t({view:this}))}_disposeGraphicsView(){this._createGraphicsViewController&&(this._createGraphicsViewController.abort(),this._createGraphicsViewController=null),this.handles.remove("graphics-view"),Object(w["l"])(this.graphicsView)&&(this.handles.remove(this.graphicsView.graphics3d.layer.id),this.graphicsView.destroy(),this._set("graphicsView",null))}_startup(){const e=Object(ce["b"])(this.viewingMode);if(1===e&&(this._clippingArea=null),this._initSurface(e),this._set("ready",!0),this.handles.add(Object(C["b"])(this,"graphics","after-changes",()=>this._createGraphicsViewIfNeeded()),"graphics-view"),this._createGraphicsViewIfNeeded(),!this._externallySet.environment){const e=this.get("map.initialViewProperties.environment");e&&(this.environment=e)}this.labeler.setup(),this.environmentManager.connectView(this),this.inputManager.connect();const t=this._resolveWhenReady;this._resolveWhenReady=[],t.forEach(e=>e(this))}_teardown(){this._initialDefaultSpatialReference=null,this.inputManager.disconnect(),this.environmentManager.disconnectView(),this.labeler.dispose(),this._disposeGraphicsView(),this.handles.remove("graphics-view"),this._exitSurface(),this._set("ready",!1)}_updateDefaultToMapOptions(){if(this._defaultToMapOptions.include.clear(),this.map){this.map.ground&&this._defaultToMapOptions.include.add(og["b"]);for(const e of this.map.allLayers.items)"integrated-mesh"===e.type&&this._defaultToMapOptions.include.add(e.uid)}}_updateDefaultHitTestOptions(){if(this._defaultHitTestOptions.exclude.clear(),this.map){this.map.ground&&this.map.ground.opacity<1&&this._defaultHitTestOptions.exclude.add(og["b"]);for(const e of this.map.allLayers.items)"integrated-mesh"===e.type&&e.opacity<1&&this._defaultToMapOptions.exclude.add(e.uid)}}getVoxelWasmPerSceneView(){return N["a"].getInstance().getVoxelWasmPerSceneView(this)}};function gT(e,t){e.layerUids||(e.layerUids=new Set),e.layerUids.add(t)}function vT(e,t){e.graphicUids||(e.graphicUids=new Set),e.graphicUids.add(t)}function yT(e,t){return Object(w["l"])(e)&&Object(L["b"])(e.spatialReference,t)?Object(L["m"])(e,t):null}Object(h["a"])([Object(M["b"])()],mT.prototype,"_userClippingArea",void 0),Object(h["a"])([Object(M["b"])()],mT.prototype,"_resourceController",void 0),Object(h["a"])([Object(M["b"])()],mT.prototype,"_stage",void 0),Object(h["a"])([Object(M["b"])({readOnly:!0})],mT.prototype,"deconflictor",void 0),Object(h["a"])([Object(M["b"])({readOnly:!0})],mT.prototype,"labeler",void 0),Object(h["a"])([Object(M["b"])({type:oe["a"],readOnly:!0,aliasOf:"state.animation"})],mT.prototype,"animation",void 0),Object(h["a"])([Object(M["b"])({readOnly:!0})],mT.prototype,"basemapTerrain",void 0),Object(h["a"])([Object(M["b"])({readOnly:!0})],mT.prototype,"elevationProvider",void 0),Object(h["a"])([Object(M["b"])({type:u["a"],aliasOf:"stateManager.camera"})],mT.prototype,"camera",void 0),Object(h["a"])([Object(M["b"])({type:u["a"],aliasOf:"stateManager.contentCamera"})],mT.prototype,"contentCamera",void 0),Object(h["a"])([Object(M["b"])({readOnly:!0})],mT.prototype,"canvas",void 0),Object(h["a"])([Object(M["b"])({type:Br["a"],aliasOf:"stateManager.center"})],mT.prototype,"center",void 0),Object(h["a"])([Object(M["b"])({type:il["a"]})],mT.prototype,"clippingArea",null),Object(h["a"])([Object(M["b"])({type:ke})],mT.prototype,"constraints",void 0),Object(h["a"])([Object(M["b"])({type:il["a"],readOnly:!0})],mT.prototype,"renderDataExtent",null),Object(h["a"])([Object(M["b"])({type:il["a"],readOnly:!0})],mT.prototype,"dataExtent",null),Object(h["a"])([Object(M["b"])({type:il["a"],readOnly:!0})],mT.prototype,"groundAndLayersExtent",null),Object(h["a"])([Object(M["b"])({value:null,type:Rt})],mT.prototype,"environment",null),Object(h["a"])([Object(E["a"])("environment")],mT.prototype,"castEnvironment",null),Object(h["a"])([Object(M["b"])({readOnly:!0})],mT.prototype,"environmentManager",void 0),Object(h["a"])([Object(M["b"])({type:il["a"],aliasOf:"stateManager.extent"})],mT.prototype,"extent",void 0),Object(h["a"])([Object(M["b"])()],mT.prototype,"floors",void 0),Object(h["a"])([Object(M["b"])({readOnly:!0,aliasOf:"stateManager.screenCenter"})],mT.prototype,"screenCenter",void 0),Object(h["a"])([Object(M["b"])({type:Number})],mT.prototype,"pixelRatio",null),Object(h["a"])([Object(M["b"])({type:Number,dependsOn:["qualitySettings.maximumPixelRatio","qualitySettings.maximumRenderResolution","size"]})],mT.prototype,"maximumPixelRatio",null),Object(h["a"])([Object(M["b"])({aliasOf:"stateManager.frustum"})],mT.prototype,"frustum",void 0),Object(h["a"])([Object(M["b"])({type:Number,readOnly:!0})],mT.prototype,"fullOpacity",void 0),Object(h["a"])([Object(M["b"])({readOnly:!0})],mT.prototype,"graphicsView",void 0),Object(h["a"])([Object(M["b"])({readOnly:!0})],mT.prototype,"analysisViewManager",void 0),Object(h["a"])([Object(M["b"])()],mT.prototype,"groundView",void 0),Object(h["a"])([Object(M["b"])({type:Boolean})],mT.prototype,"initialExtentRequired",null),Object(h["a"])([Object(M["b"])()],mT.prototype,"_defaultsFromMapSettings",null),Object(h["a"])([Object(M["b"])({type:Boolean,readOnly:!0})],mT.prototype,"interacting",null),Object(h["a"])([Object(M["b"])()],mT.prototype,"stationary",null),Object(h["a"])([Object(M["b"])({aliasOf:"state.navigating"})],mT.prototype,"navigating",void 0),Object(h["a"])([Object(M["b"])()],mT.prototype,"map",void 0),Object(h["a"])([Object(M["b"])({readOnly:!0})],mT.prototype,"mapCoordsHelper",void 0),Object(h["a"])([Object(M["b"])({aliasOf:"stateManager.padding"})],mT.prototype,"padding",void 0),Object(h["a"])([Object(M["b"])({type:pg,readOnly:!0})],mT.prototype,"pointsOfInterest",void 0),Object(h["a"])([Object(M["b"])({type:hf,readOnly:!0})],mT.prototype,"featureTiles",void 0),Object(h["a"])([Object(M["b"])()],mT.prototype,"featureTreeDebugger",void 0),Object(h["a"])([Object(M["b"])({type:Boolean})],mT.prototype,"screenSizePerspectiveEnabled",void 0),Object(h["a"])([Object(M["b"])({constructOnly:!0})],mT.prototype,"deactivatedWebGLExtensions",void 0),Object(h["a"])([Object(M["b"])({constructOnly:!0})],mT.prototype,"debugWebGLExtensions",void 0),Object(h["a"])([Object(M["b"])({constructOnly:!0})],mT.prototype,"renderCanvas",void 0),Object(h["a"])([Object(M["b"])({constructOnly:!0})],mT.prototype,"state",void 0),Object(h["a"])([Object(M["b"])({readOnly:!0})],mT.prototype,"inputManager",void 0),Object(h["a"])([Object(M["b"])({readOnly:!0})],mT.prototype,"stateManager",void 0),Object(h["a"])([Object(M["b"])({type:["low","medium","high"]})],mT.prototype,"qualityProfile",null),Object(h["a"])([Object(M["b"])({type:nm,get(){let e=this._get("qualitySettings");return e||(e=new nm,qb.apply(this.qualityProfile,e)),e}})],mT.prototype,"qualitySettings",void 0),Object(h["a"])([Object(M["b"])()],mT.prototype,"slicePlane",null),Object(h["a"])([Object(M["b"])({readOnly:!0})],mT.prototype,"typeSpecificPreconditionsReady",null),Object(h["a"])([Object(M["b"])({readOnly:!0})],mT.prototype,"renderCoordsHelper",void 0),Object(h["a"])([Object(M["b"])({readOnly:!0})],mT.prototype,"sceneIntersectionHelper",void 0),Object(h["a"])([Object(M["b"])({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],mT.prototype,"resolution",null),Object(h["a"])([Object(M["b"])({type:Number,aliasOf:"stateManager.scale"})],mT.prototype,"scale",void 0),Object(h["a"])([Object(M["b"])()],mT.prototype,"heightModelInfo",null),Object(h["a"])([Object(M["b"])()],mT.prototype,"spatialReference",void 0),Object(h["a"])([Object(M["b"])({type:Boolean,constructOnly:!0})],mT.prototype,"alphaCompositingEnabled",void 0),Object(h["a"])([Object(M["b"])({type:Boolean})],mT.prototype,"supersampleScreenshotsEnabled",void 0),Object(h["a"])([Object(M["b"])({readOnly:!0})],mT.prototype,"type",void 0),Object(h["a"])([Object(M["b"])({type:fT})],mT.prototype,"ui",void 0),Object(h["a"])([Object(M["b"])({type:Boolean,readOnly:!0,dependsOn:["graphicsView.updating","basemapView.updating","basemapTerrain.updating","layerViewManager.updating","layerViewManager.updatingRemaining","_resourceController.updating","_stage.updating","featureTiles.updating","pointsOfInterest.updating","environmentManager.updating","overlay.updating","updatingHandles.updating","featureTreeDebugger.updating","labeler.updating","deconflictor.updating","ready","stationary","inputManager.hasPendingInputs","toolViewManager.updating","analysisViewManager.updating"]})],mT.prototype,"updating",null),Object(h["a"])([Object(M["b"])({type:Number,readOnly:!0,dependsOn:["updating"]})],mT.prototype,"updatingProgress",void 0),Object(h["a"])([Object(M["b"])({type:["global","local"]})],mT.prototype,"viewingMode",null),Object(h["a"])([Object(M["b"])({type:b["a"],aliasOf:"stateManager.viewpoint"})],mT.prototype,"viewpoint",void 0),Object(h["a"])([Object(M["b"])({type:Number,aliasOf:"stateManager.zoom"})],mT.prototype,"zoom",void 0),Object(h["a"])([Object(M["b"])({type:$b})],mT.prototype,"highlightOptions",void 0),mT=Object(h["a"])([Object(D["a"])("esri.views.SceneView")],mT);const OT=Object(F["f"])(),_T=Object(A["g"])(),xT=Object(V["m"])(),jT=mT;var wT=i("f6ad"),ST=i("ce0b"),TT=(i("e1bb"),i("ff57")),CT=i("955e"),PT={name:"Symbol3D",components:{},data:function(){return{}},mounted:function(){this.init(),this.initTreeLayer(),this.initPolygonLayer(),this.initBind(),this.initDraw()},methods:{init:function(){var e=new d["a"]({basemap:"topo",ground:"world-elevation"}),t=new jT({container:this.$refs["dom"],map:e,center:[113.54766657989391,22.76579858397575],camera:{position:{x:12639861.409218187,y:2602892.6764444276,z:526.4768209708855,spatialReference:{wkid:102100}},tilt:55,fov:56,heading:14},environment:{lighting:{directShadowsEnabled:!0,ambientOcclusionEnabled:!0}}}),i=new wT["a"]({view:t});t.ui.add(i,{position:"bottom-left"}),this.map=e,window._view=this.view=t},initTreeLayer:function(){var e=this.getPoleData(),t=new TT["a"]({symbol:{type:"point-3d",symbolLayers:[{type:"object",resource:{href:"".concat("/study-arcgis/","/static/gltf/Light_On_Post_-_Light_on.glb")},material:{color:"red"},width:3,height:20,depth:3}]},label:"tree",visualVariables:[{type:"color",field:"storage",stops:[{value:0,color:"#f7fcb9"},{value:1e4,color:"#31a354"}],legendOptions:{title:"storage"}}]}),i=new l["default"]({title:"",id:"treeLayer",source:[],fields:[{name:"ObjectID",alias:"ObjectID",type:"oid"},{name:"title",alias:"title",type:"string"},{name:"height",alias:"height",type:"integer"},{name:"storage",alias:"storage",type:"integer"},{name:"lngLat",type:"string"}],outFields:["*"],objectIdField:"ObjectID",renderer:t,spatialReference:{wkid:4326},geometryType:"point",popupTemplate:{title:"{title}",content:[{type:"fields",fieldInfos:[{fieldName:"height",label:"",visible:!1},{fieldName:"lngLat",label:""}]}]}});this.map.add(i),i.applyEdits({addFeatures:e}).then((function(e){console.log("addFeatures:".concat(e.addFeatureResults.length))}))},getPoleData:function(){var e=[[113.54792137639583,22.76428599456751],[113.54765412242253,22.7645254364563],[113.54735692251681,22.764795140355677],[113.54702860471272,22.76506775836771],[113.54679495179647,22.765300693788106],[113.54646512296225,22.76559071514216],[113.54617641385929,22.765827763813054],[113.54593925816756,22.76606520027423],[113.54827733113964,22.764491562772694],[113.54796603753947,22.76473897646235],[113.54763653901325,22.765032958471586],[113.54732237877924,22.765279382463525],[113.54707593274021,22.76552142913973],[113.54678867579418,22.76580299973701],[113.54648139141185,22.76606877290851],[113.54620133835031,22.766407902370602]],t=[];return e.forEach((function(e){var i=new p["a"]({geometry:{type:"point",longitude:e[0],latitude:e[1],spatialReference:{wkid:102100}},attributes:{storage:1e3+parseInt(5e3*Math.random()),height:50,id:(new Date).getTime(),lngLat:e}});t.push(i)})),t},initPolygonLayer:function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){var i,r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return i=new TT["a"]({symbol:{type:"polygon-3d",symbolLayers:[{type:"extrude",size:100,material:{color:"#fff"},edges:{type:"solid",color:[50,50,50,.5]}}]},visualVariables:[{type:"size",field:"height"}]}),r=new l["default"]({title:"",id:"polygonLayer",source:[],fields:[{name:"ObjectID",alias:"ObjectID",type:"oid"},{name:"height",type:"integer"},{name:"name",type:"string"}],outFields:["*"],objectIdField:"ObjectID",renderer:i,spatialReference:{wkid:4326},geometryType:"mesh",popupTemplate:{title:"{name}",content:[{type:"fields",fieldInfos:[{fieldName:"height",label:"",visible:!1}]}]}}),e.map.add(r),t.next=5,e.getPolygonData();case 5:n=t.sent,r.applyEdits({addFeatures:n}).then((function(e){console.log("addFeatures:".concat(e.addFeatureResults.length))})).catch((function(e){}));case 7:case"end":return t.stop()}}),t)})))()},getPolygonData:function(){return new Promise((function(e){o.a.get("".concat("/study-arcgis/","/static/nsBuildingData.json")).then((function(t){var i=t.data.data,r=[];i.forEach((function(e){var t=e.coordinates,i=e.features,n=new p["a"]({geometry:{type:"polygon",rings:t,spatialReference:{wkid:102100}},attributes:{name:i.name,height:i.height||50+parseInt(100*Math.random())}});r.push(n)})),e(r)}))}))},initBind:function(){this.view.on("click",(function(e){var t=e.mapPoint,i=t.longitude,r=t.latitude;console.log("[".concat([i,r],"]"))}))},initDraw:function(){var e=new ST["a"]({id:"canvas",title:""});this.map.add(e);var t=new CT["a"]({layer:e,view:this.view,creationMode:"update"});this.view.ui.add(t,"top-right"),t.on("update",(function(e){if(e.graphics[0].geometry){var t=e.graphics[0].geometry,i="";switch(t.type){case"point":i="x:".concat(t.x,", y:").concat(t.y);break;case"polyline":i=JSON.stringify(t.paths);break;case"polygon":i=JSON.stringify(t.rings);break}console.log(i)}})),this.sketch=t}}},AT=PT,MT=i("2877"),RT=Object(MT["a"])(AT,r,n,!1,null,"a45d3850",null);t["default"]=RT.exports},"7cb4":function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var r=i("dfaf"),n=i("5211"),a=i("3886");function s(e,t){e.include(r["a"],t),e.fragment.code.add(a["a"]`
  struct TextureLookupParameter {
    vec2 uv;
    ${t.supportsTextureAtlas?"vec2 size;":""}
  } vtc;
  `),1===t.attributeTextureCoordinates&&e.fragment.code.add(a["a"]`vec4 textureLookup(sampler2D tex, TextureLookupParameter params) {
return texture2D(tex, params.uv);
}`),2===t.attributeTextureCoordinates&&(e.include(n["a"]),e.fragment.code.add(a["a"]`vec4 textureLookup(sampler2D tex, TextureLookupParameter params) {
return textureAtlasLookup(tex, params.size, params.uv, vuvRegion);
}`))}},"7cfb":function(e,t,i){"use strict";function r(e,t,i){const r=e.typedBuffer,n=e.typedBufferStride,a=t.typedBuffer,s=t.typedBufferStride,o=i?i.count:t.count;let c=(i&&i.dstIndex?i.dstIndex:0)*n,l=(i&&i.srcIndex?i.srcIndex:0)*s;for(let d=0;d<o;++d)r[c]=a[l],c+=n,l+=s}function n(e,t){const i=e.count;t||(t=new e.TypedArrayConstructor(i));for(let r=0;r<i;r++)t[r]=e.get(r);return t}i.d(t,"a",(function(){return n}));Object.freeze({__proto__:null,copy:r,makeDense:n})},"7d11":function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var r=i("c332"),n=i("bc40"),a=i("3886");function s(e,t){0===t.normalType||1===t.normalType?(e.include(r["a"],t),e.varyings.add("vNormalWorld","vec3"),e.varyings.add("vNormalView","vec3"),e.vertex.uniforms.add("uTransformNormal_GlobalFromModel","mat3"),e.vertex.uniforms.add("uTransformNormal_ViewFromGlobal","mat3"),e.vertex.code.add(a["a"]`void forwardNormal() {
vNormalWorld = uTransformNormal_GlobalFromModel * normalModel();
vNormalView = uTransformNormal_ViewFromGlobal * vNormalWorld;
}`)):2===t.normalType?(e.include(n["a"],t),e.varyings.add("vNormalWorld","vec3"),e.vertex.code.add(a["a"]`
    void forwardNormal() {
      vNormalWorld = ${1===t.viewingMode?a["a"]`normalize(vPositionWorldCameraRelative);`:a["a"]`vec3(0.0, 0.0, 1.0);`}
    }
    `)):e.vertex.code.add(a["a"]`void forwardNormal() {}`)}!function(e){function t(e,t){e.setUniformMatrix4fv("viewNormal",t)}e.bindUniforms=t}(s||(s={}))},"7e0c":function(e,t,i){"use strict";i.d(t,"a",(function(){return g})),i.d(t,"b",(function(){return v}));var r=i("880d"),n=i("e431"),a=i("0b2d"),s=i("2ebb"),o=i("0c9d");class c{updateSettings(e){this.settings=e,this.edgeHashFunction=e.reducedPrecision?p:u}write(e,t,i){const r=this.edgeHashFunction(i);O.seed=r;const n=O.getIntRange(0,255),a=O.getIntRange(0,this.settings.variants-1),s=.7,o=O.getFloat(),c=255*(.5*m(-(1-Math.min(o/s,1))+Math.max(0,o-s)/(1-s),1.2)+.5);e.position0.setVec(t,i.position0),e.position1.setVec(t,i.position1),e.componentIndex.set(t,i.componentIndex),e.variantOffset.set(t,n),e.variantStroke.set(t,a),e.variantExtension.set(t,c)}trim(e,t){return e.slice(0,t)}}const l=new Float32Array(6),d=new Uint32Array(l.buffer),h=new Uint32Array(1);function u(e){const t=l;t[0]=e.position0[0],t[1]=e.position0[1],t[2]=e.position0[2],t[3]=e.position1[0],t[4]=e.position1[1],t[5]=e.position1[2],h[0]=5381;for(let i=0;i<d.length;i++)h[0]=31*h[0]+d[i];return h[0]}function p(e){const t=l;t[0]=b(e.position0[0]),t[1]=b(e.position0[1]),t[2]=b(e.position0[2]),t[3]=b(e.position1[0]),t[4]=b(e.position1[1]),t[5]=b(e.position1[2]),h[0]=5381;for(let i=0;i<d.length;i++)h[0]=31*h[0]+d[i];return h[0]}const f=1e4;function b(e){return Math.round(e*f)/f}function m(e,t){const i=e<0?-1:1;return Math.abs(e)**t*i}class g{constructor(){this.commonWriter=new c}updateSettings(e){this.commonWriter.updateSettings(e)}allocate(e){return o["c"].createBuffer(e)}write(e,t,i){this.commonWriter.write(e,t,i),Object(n["i"])(y,i.faceNormal0,i.faceNormal1),Object(n["u"])(y,y),e.normal.setVec(t,y)}trim(e,t){return this.commonWriter.trim(e,t)}}g.Layout=o["c"],g.glLayout=Object(s["a"])(o["c"],1);class v{constructor(){this.commonWriter=new c}updateSettings(e){this.commonWriter.updateSettings(e)}allocate(e){return o["d"].createBuffer(e)}write(e,t,i){this.commonWriter.write(e,t,i),e.normalA.setVec(t,i.faceNormal0),e.normalB.setVec(t,i.faceNormal1)}trim(e,t){return this.commonWriter.trim(e,t)}}v.Layout=o["d"],v.glLayout=Object(s["a"])(o["d"],1);const y=Object(a["f"])(),O=new r["a"]},"7e21":function(e,t,i){"use strict";i.d(t,"a",(function(){return p}));var r=i("d272"),n=i("4db9"),a=i("c332"),s=i("dfaf"),o=i("7d11"),c=i("c2d1"),l=i("6a07"),d=i("be24"),h=i("ebd5"),u=i("3886");function p(e,t){const i=e.vertex.code,p=e.fragment.code;1!==t.output&&3!==t.output||(e.include(n["a"],{linearDepth:!0}),e.include(s["a"],t),e.include(d["a"],t),e.include(c["a"],t),e.include(r["a"],t),e.vertex.uniforms.add("cameraNearFar","vec2"),e.varyings.add("depth","float"),t.hasColorTexture&&e.fragment.uniforms.add("tex","sampler2D"),i.add(u["a"]`void main(void) {
vpos = calculateVPos();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPositionWithDepth(proj, view, vpos, cameraNearFar, depth);
forwardTextureCoordinates();
}`),e.include(h["a"],t),p.add(u["a"]`
      void main(void) {
        discardBySlice(vpos);
        ${t.hasColorTexture?u["a"]`
        vec4 texColor = texture2D(tex, vuv0);
        discardOrAdjustAlpha(texColor);`:""}
        outputDepth(depth);
      }
    `)),2===t.output&&(e.include(n["a"],{linearDepth:!1}),e.include(a["a"],t),e.include(o["a"],t),e.include(s["a"],t),e.include(d["a"],t),t.hasColorTexture&&e.fragment.uniforms.add("tex","sampler2D"),e.vertex.uniforms.add("viewNormal","mat4"),e.varyings.add("vPositionView","vec3"),i.add(u["a"]`
      void main(void) {
        vpos = calculateVPos();
        vpos = subtractOrigin(vpos);
        ${0===t.normalType?u["a"]`
        vNormalWorld = dpNormalView(vvLocalNormal(normalModel()));`:""}
        vpos = addVerticalOffset(vpos, localOrigin);
        gl_Position = transformPosition(proj, view, vpos);
        forwardTextureCoordinates();
      }
    `),e.include(r["a"],t),e.include(h["a"],t),p.add(u["a"]`
      void main() {
        discardBySlice(vpos);
        ${t.hasColorTexture?u["a"]`
        vec4 texColor = texture2D(tex, vuv0);
        discardOrAdjustAlpha(texColor);`:""}

        ${3===t.normalType?u["a"]`
            vec3 normal = screenDerivativeNormal(vPositionView);`:u["a"]`
            vec3 normal = normalize(vNormalWorld);
            if (gl_FrontFacing == false) normal = -normal;`}
        gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
      }
    `)),4===t.output&&(e.include(n["a"],{linearDepth:!1}),e.include(s["a"],t),e.include(d["a"],t),t.hasColorTexture&&e.fragment.uniforms.add("tex","sampler2D"),i.add(u["a"]`void main(void) {
vpos = calculateVPos();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPosition(proj, view, vpos);
forwardTextureCoordinates();
}`),e.include(r["a"],t),e.include(h["a"],t),e.include(l["a"]),p.add(u["a"]`
      void main() {
        discardBySlice(vpos);
        ${t.hasColorTexture?u["a"]`
        vec4 texColor = texture2D(tex, vuv0);
        discardOrAdjustAlpha(texColor);`:""}
        outputHighlight();
      }
    `))}},"7e2d":function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var r=i("c6ac");function n(e,t,i){const r=e.typedBuffer,n=e.typedBufferStride,a=t.typedBuffer,s=t.typedBufferStride,o=i?i.count:t.count;let c=(i&&i.dstIndex?i.dstIndex:0)*n,l=(i&&i.srcIndex?i.srcIndex:0)*s;for(let d=0;d<o;++d){for(let e=0;e<9;++e)r[c+e]=a[l+e];c+=n,l+=s}}Object.freeze({__proto__:null,copy:n});function a(e,t,i){const r=e.typedBuffer,n=e.typedBufferStride,a=t.typedBuffer,s=t.typedBufferStride,o=i?i.count:t.count;let c=(i&&i.dstIndex?i.dstIndex:0)*n,l=(i&&i.srcIndex?i.srcIndex:0)*s;for(let d=0;d<o;++d){for(let e=0;e<16;++e)r[c+e]=a[l+e];c+=n,l+=s}}Object.freeze({__proto__:null,copy:a});i("7cfb"),i("dc56"),i("4c96"),i("1c20");function s(e,t){return new e(new ArrayBuffer(t*e.ElementCount*Object(r["a"])(e.ElementType)))}},"7e6b":function(e,t,i){"use strict";i.d(t,"a",(function(){return l}));var r=i("a4ee"),n=i("6a0e"),a=i("59b2"),s=(i("b50f"),i("c120"),i("cea0"),i("d386")),o=i("a9ab");let c=class extends n["a"]{constructor(e){super(e),this.geometries=null,this.outSpatialReference=null,this.transformation=null,this.transformForward=null}toJSON(){const e=this.geometries.map((function(e){return e.toJSON()})),t=this.geometries[0],i={};return i.outSR=this.outSpatialReference.wkid||JSON.stringify(this.outSpatialReference.toJSON()),i.inSR=t.spatialReference.wkid||JSON.stringify(t.spatialReference.toJSON()),i.geometries=JSON.stringify({geometryType:Object(o["c"])(t),geometries:e}),this.transformation&&(i.transformation=this.transformation.wkid||JSON.stringify(this.transformation)),null!=this.transformForward&&(i.transformForward=this.transformForward),i}};Object(r["a"])([Object(a["b"])()],c.prototype,"geometries",void 0),Object(r["a"])([Object(a["b"])({json:{read:{source:"outSR"}}})],c.prototype,"outSpatialReference",void 0),Object(r["a"])([Object(a["b"])()],c.prototype,"transformation",void 0),Object(r["a"])([Object(a["b"])()],c.prototype,"transformForward",void 0),c=Object(r["a"])([Object(s["a"])("esri.rest.support.ProjectParameters")],c);const l=c},"7f60":function(e,t,i){"use strict";i.d(t,"a",(function(){return b})),i.d(t,"b",(function(){return m}));var r=i("9ef0"),n=(i("c120"),i("e92d")),a=i("b2b2"),s=i("0b2d"),o=i("0fc4"),c=i("2e0f"),l=i("0eb9"),d=i("e9d6"),h=i("ba58"),u=i("5e82"),p=i("a803");const f=n["a"].getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");class b extends u["a"]{constructor(e,t,i,r){super(i.schedule),this._context=i,this._elevationInfoOverride=null,this.complexity=null,this.logger=f,this._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0},this.symbol=e,this.symbolLayer=t,this._renderPriority=r.renderPriority,this._renderPriorityStep=r.renderPriorityStep,this._elevationContext=new l["a"],this.complexity=this.computeComplexity(),this._updateDrivenProperties(r.ignoreDrivers),this._updateElevationContext()}getCachedSize(){return null}get extentPadding(){return 0}get needsDrivenTransparentPass(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque}_logGeometryCreationWarnings(e,t,i,r){const n=e.projectionSuccess,a="polygons"in e?e.polygons:null,s=r+" geometry failed to be created";let o=null;n?!t.length||1===t.length&&!t[0].length?o=`${s} (no ${i} were defined)`:Array.isArray(t)&&Array.isArray(t[0])?a&&0===a.length&&"rings"===i&&t.length>0&&t[0].length>2&&(o=s+" (filled rings should use clockwise winding - try reversing the order of vertices)"):o=`${s} (${i} should be defined as a 2D array)`:o=s+" (failed to project geometry to view spatial reference)",o&&f.warnOncePerTick(o)}_validateGeometry(e,t=null,i=null){if(Object(a["l"])(t)&&!t.includes(e.type))return this.logger.warn("unsupported geometry type for "+i+" symbol: "+e.type),!1;if("point"===e.type){const t=e;if(!isFinite(t.x)||!isFinite(t.y))return f.warn("point coordinate is not a valid number, graphic skipped"),!1}return!0}_defaultElevationInfoNoZ(){return g}_defaultElevationInfoZ(){return v}_updateElevationContext(){Object(a["l"])(this._elevationInfoOverride)?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()}getDefaultElevationInfo(e){return e.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()}getGeometryElevationMode(e,t=this.getDefaultElevationInfo(e)){return this._elevationContext.mode||t.mode}setElevationInfoOverride(e){this._elevationInfoOverride=e,this._updateElevationContext()}setGraphicElevationContext(e,t){const i=Object(a["u"])(e.geometry),r=this.getDefaultElevationInfo(i);t.unit=null!=this._elevationContext.unit?this._elevationContext.unit:r.unit,t.mode=this.getGeometryElevationMode(i,r),t.offsetMeters=Object(a["v"])(this._elevationContext.meterUnitOffset,Object(a["v"])(r.offset,0));const n=!this._elevationOptions.supportsOnTheGround&&"on-the-ground"===t.mode;n&&(t.mode="relative-to-ground",t.offsetMeters=0);const s=n?d["h"]:this._elevationContext.featureExpressionInfoContext;return t.updateFeatureExpressionInfoContext(s,e,this._context.layer),t}prepareSymbolLayerPatch(e){}updateGeometry(e,t){return!1}onRemoveGraphic(e){}_updateDrivenProperties(e){const t={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};if(e)return void(this._drivenProperties=t);const i=this._context.renderer;i&&"visualVariables"in i&&i.visualVariables&&i.visualVariables.forEach(e=>{switch(e.type){case"color":if(t.color=!0,e.stops)for(let i=0;i<e.stops.length;i++){const r=e.stops[i].color;r&&(t.opacity=!0,r.a<1&&(t.opacityAlwaysOpaque=!1))}break;case"opacity":t.opacity=!0,t.opacityAlwaysOpaque=!1;break;case"size":t.size=!0}}),this._drivenProperties=t}_getLayerOpacity(){if(this._context.layerView&&"fullOpacity"in this._context.layerView)return this._context.layerView.fullOpacity;const e=this._context.layer.opacity;return null==e?1:e}_getCombinedOpacity(e,t=y){let i=1;return this.draped||(i*=this._getLayerOpacity()),this._drivenProperties.opacity||(Object(a["l"])(e)?i*=e.a:t.hasIntrinsicColor||(i=0)),i}_getCombinedOpacityAndColor(e,t=y){const i=this._getCombinedOpacity(e,t);if(this._drivenProperties.color)return Object(h["g"])(null,i);const n=Object(a["l"])(e)?r["a"].toUnitRGB(e):s["a"];return Object(h["g"])(n,i)}_getVertexOpacityAndColor(e,t=null){const i=this._drivenProperties.color?e.color:null,r=this._drivenProperties.opacity?e.opacity:null,n=Object(h["g"])(i,r);return Object(a["l"])(t)&&(n[0]*=t,n[1]*=t,n[2]*=t,n[3]*=t),n}isFastUpdatesEnabled(){return this._fastUpdates&&this._fastUpdates.enabled}computeComplexity(){return Object(p["c"])(this.symbol,this.symbolLayer)}globalPropertyChanged(e,t,i){switch(e){case"opacity":return this.layerOpacityChanged(t,i);case"elevationInfo":{const e=this._elevationContext.mode;return this._updateElevationContext(),this.layerElevationInfoChanged(t,i,e)!==c["b"].RECREATE}case"slicePlaneEnabled":return this.slicePlaneEnabledChanged(t,i);case"physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case"pixelRatio":return this.pixelRatioChanged();default:return!1}}updateGraphics3DGraphicElevationInfo(e,t,i){let r=c["b"].UPDATE;return e.forEach(e=>{const n=t(e);if(Object(a["l"])(n)){const t=e.graphic;this.setGraphicElevationContext(t,n.elevationContext),n.needsElevationUpdates=i(n.elevationContext.mode)}else r=c["b"].RECREATE}),r}applyRendererDiff(e,t){return 0}getFastUpdateAttrValues(e){if(!this._fastUpdates.enabled)return null;const t=this._fastUpdates.visualVariables,i=t.size?m(t.size.field,e):0,r=t.color?m(t.color.field,e):0,n=t.opacity?m(t.opacity.field,e):0;return Object(o["g"])(i,r,n,0)}get draped(){return this._draped}ensureDrapedStatus(e){return null==this._draped?(this._draped=e,!0):(e!==this.draped&&f.warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary."),!1)}}function m(e,t){const i=null!=e?t.attributes[e]:0;return null!=i&&isFinite(i)?i:0}const g={mode:"on-the-ground",offset:0,unit:"meters"},v={mode:"absolute-height",offset:0,unit:"meters"},y={hasIntrinsicColor:!1}},8190:function(e,t,i){"use strict";i.d(t,"a",(function(){return u})),i.d(t,"b",(function(){return O})),i.d(t,"c",(function(){return U})),i.d(t,"d",(function(){return q})),i.d(t,"e",(function(){return z})),i.d(t,"f",(function(){return m})),i.d(t,"g",(function(){return g})),i.d(t,"h",(function(){return v})),i.d(t,"i",(function(){return y})),i.d(t,"j",(function(){return P})),i.d(t,"k",(function(){return E})),i.d(t,"l",(function(){return w})),i.d(t,"m",(function(){return p})),i.d(t,"n",(function(){return _})),i.d(t,"o",(function(){return B})),i.d(t,"p",(function(){return H})),i.d(t,"q",(function(){return L})),i.d(t,"r",(function(){return A})),i.d(t,"s",(function(){return D})),i.d(t,"t",(function(){return S})),i.d(t,"u",(function(){return f})),i.d(t,"v",(function(){return x})),i.d(t,"w",(function(){return N})),i.d(t,"x",(function(){return W})),i.d(t,"y",(function(){return V})),i.d(t,"z",(function(){return M})),i.d(t,"A",(function(){return I})),i.d(t,"B",(function(){return T})),i.d(t,"C",(function(){return b})),i.d(t,"D",(function(){return j})),i.d(t,"E",(function(){return G})),i.d(t,"F",(function(){return $})),i.d(t,"G",(function(){return k})),i.d(t,"H",(function(){return R})),i.d(t,"I",(function(){return F})),i.d(t,"J",(function(){return C}));class r{constructor(e,t,i=0,r,n){this.TypedArrayConstructor=e,this.elementCount=9;const a=this.TypedArrayConstructor;void 0===r&&(r=9*a.BYTES_PER_ELEMENT);const s=0===t.byteLength?0:i;this.typedBuffer=null==n?new a(t,s):new a(t,s,(n-i)/a.BYTES_PER_ELEMENT),this.typedBufferStride=r/a.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,t,i=this.count-t){const r=this.typedBuffer.byteOffset+t*this.stride;return new e(this.buffer,r,this.stride,r+i*this.stride)}getMat(e,t){let i=e*this.typedBufferStride;for(let r=0;r<9;r++)t[r]=this.typedBuffer[i++];return t}setMat(e,t){let i=e*this.typedBufferStride;for(let r=0;r<9;r++)this.typedBuffer[i++]=t[r]}get(e,t){return this.typedBuffer[e*this.typedBufferStride+t]}set(e,t,i){this.typedBuffer[e*this.typedBufferStride+t]=i}copyFrom(e,t,i){const r=this.typedBuffer,n=t.typedBuffer;let a=e*this.typedBufferStride,s=i*t.typedBufferStride;for(let o=0;o<9;++o)r[a++]=n[s++]}get buffer(){return this.typedBuffer.buffer}}r.ElementCount=9;class n{constructor(e,t,i=0,r,n){this.TypedArrayConstructor=e,this.elementCount=16;const a=this.TypedArrayConstructor;void 0===r&&(r=16*a.BYTES_PER_ELEMENT);const s=0===t.byteLength?0:i;this.typedBuffer=null==n?new a(t,s):new a(t,s,(n-i)/a.BYTES_PER_ELEMENT),this.typedBufferStride=r/a.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,t,i=this.count-t){const r=this.typedBuffer.byteOffset+t*this.stride;return new e(this.buffer,r,this.stride,r+i*this.stride)}getMat(e,t){let i=e*this.typedBufferStride;for(let r=0;r<16;r++)t[r]=this.typedBuffer[i++];return t}setMat(e,t){let i=e*this.typedBufferStride;for(let r=0;r<16;r++)this.typedBuffer[i++]=t[r]}get(e,t){return this.typedBuffer[e*this.typedBufferStride+t]}set(e,t,i){this.typedBuffer[e*this.typedBufferStride+t]=i}copyFrom(e,t,i){const r=this.typedBuffer,n=t.typedBuffer;let a=e*this.typedBufferStride,s=i*t.typedBufferStride;for(let o=0;o<16;++o)r[a++]=n[s++]}get buffer(){return this.typedBuffer.buffer}}n.ElementCount=16;class a{constructor(e,t,i=0,r,n){this.TypedArrayConstructor=e,this.elementCount=1;const a=this.TypedArrayConstructor;void 0===r&&(r=a.BYTES_PER_ELEMENT);const s=0===t.byteLength?0:i;this.typedBuffer=null==n?new a(t,s):new a(t,s,(n-i)/a.BYTES_PER_ELEMENT),this.typedBufferStride=r/a.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,t,i=this.count-t){const r=this.typedBuffer.byteOffset+t*this.stride;return new e(this.buffer,r,this.stride,r+i*this.stride)}get(e){return this.typedBuffer[e*this.typedBufferStride]}set(e,t){this.typedBuffer[e*this.typedBufferStride]=t}get buffer(){return this.typedBuffer.buffer}}a.ElementCount=1;var s=i("3349");class o{constructor(e,t,i=0,r,n){this.TypedArrayConstructor=e,this.elementCount=2;const a=this.TypedArrayConstructor;void 0===r&&(r=2*a.BYTES_PER_ELEMENT);const s=0===t.byteLength?0:i;this.typedBuffer=null==n?new a(t,s):new a(t,s,(n-i)/a.BYTES_PER_ELEMENT),this.typedBufferStride=r/a.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,t,i=this.count-t){const r=this.typedBuffer.byteOffset+t*this.stride;return new e(this.buffer,r,this.stride,r+i*this.stride)}getVec(e,t){return e*=this.typedBufferStride,Object(s["s"])(t,this.typedBuffer[e],this.typedBuffer[e+1])}setVec(e,t){e*=this.typedBufferStride,this.typedBuffer[e++]=t[0],this.typedBuffer[e]=t[1]}get(e,t){return this.typedBuffer[e*this.typedBufferStride+t]}set(e,t,i){this.typedBuffer[e*this.typedBufferStride+t]=i}setValues(e,t,i){e*=this.typedBufferStride,this.typedBuffer[e++]=t,this.typedBuffer[e]=i}copyFrom(e,t,i){const r=this.typedBuffer,n=t.typedBuffer;let a=e*this.typedBufferStride,s=i*t.typedBufferStride;r[a++]=n[s++],r[a]=n[s]}get buffer(){return this.typedBuffer.buffer}}o.ElementCount=2;var c=i("e431");class l{constructor(e,t,i=0,r,n){this.TypedArrayConstructor=e,this.elementCount=3;const a=this.TypedArrayConstructor;void 0===r&&(r=3*a.BYTES_PER_ELEMENT);const s=0===t.byteLength?0:i;this.typedBuffer=null==n?new a(t,s):new a(t,s,(n-i)/a.BYTES_PER_ELEMENT),this.typedBufferStride=r/a.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,t,i=this.count-t){const r=this.typedBuffer.byteOffset+t*this.stride;return new e(this.buffer,r,this.stride,r+i*this.stride)}getVec(e,t){return e*=this.typedBufferStride,Object(c["z"])(t,this.typedBuffer[e],this.typedBuffer[e+1],this.typedBuffer[e+2])}setVec(e,t){e*=this.typedBufferStride,this.typedBuffer[e++]=t[0],this.typedBuffer[e++]=t[1],this.typedBuffer[e]=t[2]}get(e,t){return this.typedBuffer[e*this.typedBufferStride+t]}set(e,t,i){this.typedBuffer[e*this.typedBufferStride+t]=i}setValues(e,t,i,r){e*=this.typedBufferStride,this.typedBuffer[e++]=t,this.typedBuffer[e++]=i,this.typedBuffer[e]=r}copyFrom(e,t,i){const r=this.typedBuffer,n=t.typedBuffer;let a=e*this.typedBufferStride,s=i*t.typedBufferStride;r[a++]=n[s++],r[a++]=n[s++],r[a]=n[s]}get buffer(){return this.typedBuffer.buffer}}l.ElementCount=3;var d=i("7577");class h{constructor(e,t,i=0,r,n){this.TypedArrayConstructor=e,this.elementCount=4;const a=this.TypedArrayConstructor;void 0===r&&(r=4*a.BYTES_PER_ELEMENT);const s=0===t.byteLength?0:i;this.typedBuffer=null==n?new a(t,s):new a(t,s,(n-i)/a.BYTES_PER_ELEMENT),this.typedBufferStride=r/a.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,t,i=this.count-t){const r=this.typedBuffer.byteOffset+t*this.stride;return new e(this.buffer,r,this.stride,r+i*this.stride)}getVec(e,t){return e*=this.typedBufferStride,Object(d["l"])(t,this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e])}setVec(e,t){e*=this.typedBufferStride,this.typedBuffer[e++]=t[0],this.typedBuffer[e++]=t[1],this.typedBuffer[e++]=t[2],this.typedBuffer[e]=t[3]}get(e,t){return this.typedBuffer[e*this.typedBufferStride+t]}set(e,t,i){this.typedBuffer[e*this.typedBufferStride+t]=i}setValues(e,t,i,r,n){e*=this.typedBufferStride,this.typedBuffer[e++]=t,this.typedBuffer[e++]=i,this.typedBuffer[e++]=r,this.typedBuffer[e]=n}copyFrom(e,t,i){const r=this.typedBuffer,n=t.typedBuffer;let a=e*this.typedBufferStride,s=i*t.typedBufferStride;r[a++]=n[s++],r[a++]=n[s++],r[a++]=n[s++],r[a]=n[s]}get buffer(){return this.typedBuffer.buffer}}h.ElementCount=4;class u extends a{constructor(e,t=0,i,r){super(Float32Array,e,t,i,r),this.elementType="f32"}static fromTypedArray(e,t){return new u(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}u.ElementType="f32";class p extends o{constructor(e,t=0,i,r){super(Float32Array,e,t,i,r),this.elementType="f32"}slice(e,t){return this.sliceBuffer(p,e,t)}static fromTypedArray(e,t){return new p(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}p.ElementType="f32";class f extends l{constructor(e,t=0,i,r){super(Float32Array,e,t,i,r),this.elementType="f32"}slice(e,t){return this.sliceBuffer(f,e,t)}static fromTypedArray(e,t){return new f(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}f.ElementType="f32";class b extends h{constructor(e,t=0,i,r){super(Float32Array,e,t,i,r),this.elementType="f32"}slice(e,t){return this.sliceBuffer(b,e,t)}static fromTypedArray(e,t){return new b(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}b.ElementType="f32";class m extends r{constructor(e,t=0,i,r){super(Float32Array,e,t,i,r),this.elementType="f32"}slice(e,t){return this.sliceBuffer(m,e,t)}static fromTypedArray(e,t){return new m(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}m.ElementType="f32";class g extends r{constructor(e,t=0,i,r){super(Float64Array,e,t,i,r),this.elementType="f64"}slice(e,t){return this.sliceBuffer(g,e,t)}static fromTypedArray(e,t){return new g(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}g.ElementType="f64";class v extends n{constructor(e,t=0,i,r){super(Float32Array,e,t,i,r),this.elementType="f32"}slice(e,t){return this.sliceBuffer(v,e,t)}static fromTypedArray(e,t){return new v(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}v.ElementType="f32";class y extends n{constructor(e,t=0,i,r){super(Float64Array,e,t,i,r),this.elementType="f64"}slice(e,t){return this.sliceBuffer(y,e,t)}static fromTypedArray(e,t){return new y(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}y.ElementType="f64";class O extends a{constructor(e,t=0,i,r){super(Float64Array,e,t,i,r),this.elementType="f64"}slice(e,t){return this.sliceBuffer(O,e,t)}static fromTypedArray(e,t){return new O(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}O.ElementType="f64";class _ extends o{constructor(e,t=0,i,r){super(Float64Array,e,t,i,r),this.elementType="f64"}slice(e,t){return this.sliceBuffer(_,e,t)}static fromTypedArray(e,t){return new _(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}_.ElementType="f64";class x extends l{constructor(e,t=0,i,r){super(Float64Array,e,t,i,r),this.elementType="f64"}slice(e,t){return this.sliceBuffer(x,e,t)}static fromTypedArray(e,t){return new x(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}x.ElementType="f64";class j extends h{constructor(e,t=0,i,r){super(Float64Array,e,t,i,r),this.elementType="f64"}slice(e,t){return this.sliceBuffer(j,e,t)}static fromTypedArray(e,t){return new j(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}j.ElementType="f64";class w extends a{constructor(e,t=0,i,r){super(Uint8Array,e,t,i,r),this.elementType="u8"}slice(e,t){return this.sliceBuffer(w,e,t)}static fromTypedArray(e,t){return new w(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}w.ElementType="u8";class S extends o{constructor(e,t=0,i,r){super(Uint8Array,e,t,i,r),this.elementType="u8"}slice(e,t){return this.sliceBuffer(S,e,t)}static fromTypedArray(e,t){return new S(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}S.ElementType="u8";class T extends l{constructor(e,t=0,i,r){super(Uint8Array,e,t,i,r),this.elementType="u8"}slice(e,t){return this.sliceBuffer(T,e,t)}static fromTypedArray(e,t){return new T(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}T.ElementType="u8";class C extends h{constructor(e,t=0,i,r){super(Uint8Array,e,t,i,r),this.elementType="u8"}slice(e,t){return this.sliceBuffer(C,e,t)}static fromTypedArray(e,t){return new C(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}C.ElementType="u8";class P extends a{constructor(e,t=0,i,r){super(Uint16Array,e,t,i,r),this.elementType="u16"}slice(e,t){return this.sliceBuffer(P,e,t)}static fromTypedArray(e,t){return new P(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}P.ElementType="u16";class A extends o{constructor(e,t=0,i,r){super(Uint16Array,e,t,i,r),this.elementType="u16"}slice(e,t){return this.sliceBuffer(A,e,t)}static fromTypedArray(e,t){return new A(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}A.ElementType="u16";class M extends l{constructor(e,t=0,i,r){super(Uint16Array,e,t,i,r),this.elementType="u16"}slice(e,t){return this.sliceBuffer(M,e,t)}static fromTypedArray(e,t){return new M(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}M.ElementType="u16";class R extends h{constructor(e,t=0,i,r){super(Uint16Array,e,t,i,r),this.elementType="u16"}slice(e,t){return this.sliceBuffer(R,e,t)}static fromTypedArray(e,t){return new R(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}R.ElementType="u16";class E extends a{constructor(e,t=0,i,r){super(Uint32Array,e,t,i,r),this.elementType="u32"}slice(e,t){return this.sliceBuffer(E,e,t)}static fromTypedArray(e,t){return new E(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}E.ElementType="u32";class D extends o{constructor(e,t=0,i,r){super(Uint32Array,e,t,i,r),this.elementType="u32"}slice(e,t){return this.sliceBuffer(D,e,t)}static fromTypedArray(e,t){return new D(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}D.ElementType="u32";class I extends l{constructor(e,t=0,i,r){super(Uint32Array,e,t,i,r),this.elementType="u32"}slice(e,t){return this.sliceBuffer(I,e,t)}static fromTypedArray(e,t){return new I(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}I.ElementType="u32";class F extends h{constructor(e,t=0,i,r){super(Uint32Array,e,t,i,r),this.elementType="u32"}slice(e,t){return this.sliceBuffer(F,e,t)}static fromTypedArray(e,t){return new F(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}F.ElementType="u32";class z extends a{constructor(e,t=0,i,r){super(Int8Array,e,t,i,r),this.elementType="i8"}slice(e,t){return this.sliceBuffer(z,e,t)}static fromTypedArray(e,t){return new z(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}z.ElementType="i8";class L extends o{constructor(e,t=0,i,r){super(Int8Array,e,t,i,r),this.elementType="i8"}slice(e,t){return this.sliceBuffer(L,e,t)}static fromTypedArray(e,t){return new L(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}L.ElementType="i8";class V extends l{constructor(e,t=0,i,r){super(Int8Array,e,t,i,r),this.elementType="i8"}slice(e,t){return this.sliceBuffer(V,e,t)}static fromTypedArray(e,t){return new V(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}V.ElementType="i8";class k extends h{constructor(e,t=0,i,r){super(Int8Array,e,t,i,r),this.elementType="i8"}slice(e,t){return this.sliceBuffer(k,e,t)}static fromTypedArray(e,t){return new k(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}k.ElementType="i8";class U extends a{constructor(e,t=0,i,r){super(Int16Array,e,t,i,r),this.elementType="i16"}slice(e,t){return this.sliceBuffer(U,e,t)}static fromTypedArray(e,t){return new U(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}U.ElementType="i16";class B extends o{constructor(e,t=0,i,r){super(Int16Array,e,t,i,r),this.elementType="i16"}slice(e,t){return this.sliceBuffer(B,e,t)}static fromTypedArray(e,t){return new B(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}B.ElementType="i16";class N extends l{constructor(e,t=0,i,r){super(Int16Array,e,t,i,r),this.elementType="i16"}slice(e,t){return this.sliceBuffer(N,e,t)}static fromTypedArray(e,t){return new N(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}N.ElementType="i16";class G extends h{constructor(e,t=0,i,r){super(Int16Array,e,t,i,r),this.elementType="i16"}slice(e,t){return this.sliceBuffer(G,e,t)}static fromTypedArray(e,t){return new G(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}G.ElementType="i16";class q extends a{constructor(e,t=0,i,r){super(Int32Array,e,t,i,r),this.elementType="i32"}slice(e,t){return this.sliceBuffer(q,e,t)}static fromTypedArray(e,t){return new q(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}q.ElementType="i32";class H extends o{constructor(e,t=0,i,r){super(Int32Array,e,t,i,r),this.elementType="i32"}slice(e,t){return this.sliceBuffer(H,e,t)}static fromTypedArray(e,t){return new H(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}H.ElementType="i32";class W extends l{constructor(e,t=0,i,r){super(Int32Array,e,t,i,r),this.elementType="i32"}slice(e,t){return this.sliceBuffer(W,e,t)}static fromTypedArray(e,t){return new W(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}W.ElementType="i32";class $ extends h{constructor(e,t=0,i,r){super(Int32Array,e,t,i,r),this.elementType="i32"}slice(e,t){return this.sliceBuffer($,e,t)}static fromTypedArray(e,t){return new $(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}$.ElementType="i32"},"83fa":function(e,t,i){"use strict";i.d(t,"a",(function(){return u}));var r,n=i("a4ee"),a=i("9ef0"),s=i("b2b2"),o=i("59b2"),c=(i("b50f"),i("c120"),i("cea0"),i("d386")),l=i("dee7"),d=i("88da");let h=r=class extends l["a"]{constructor(e){super(e),this.emissiveColor=null,this.emissiveTexture=null,this.occlusionTexture=null,this.metallic=1,this.roughness=1,this.metallicRoughnessTexture=null}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(e,t){const i=Object(s["l"])(e)?e.get(this):null;if(i)return i;const n=new r(this.clonePropertiesWithDeduplication(t));return Object(s["l"])(e)&&e.set(this,n),n}clonePropertiesWithDeduplication(e){return{...super.clonePropertiesWithDeduplication(e),emissiveColor:Object(s["l"])(this.emissiveColor)?this.emissiveColor.clone():null,emissiveTexture:Object(s["l"])(this.emissiveTexture)?this.emissiveTexture.cloneWithDeduplication(e):null,occlusionTexture:Object(s["l"])(this.occlusionTexture)?this.occlusionTexture.cloneWithDeduplication(e):null,metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:Object(s["l"])(this.metallicRoughnessTexture)?this.metallicRoughnessTexture.cloneWithDeduplication(e):null}}};Object(n["a"])([Object(o["b"])({type:a["a"],json:{write:!0}})],h.prototype,"emissiveColor",void 0),Object(n["a"])([Object(o["b"])({type:d["a"],json:{write:!0}})],h.prototype,"emissiveTexture",void 0),Object(n["a"])([Object(o["b"])({type:d["a"],json:{write:!0}})],h.prototype,"occlusionTexture",void 0),Object(n["a"])([Object(o["b"])({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],h.prototype,"metallic",void 0),Object(n["a"])([Object(o["b"])({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],h.prototype,"roughness",void 0),Object(n["a"])([Object(o["b"])({type:d["a"],json:{write:!0}})],h.prototype,"metallicRoughnessTexture",void 0),h=r=Object(n["a"])([Object(c["a"])("esri.geometry.support.MeshMaterialMetallicRoughness")],h);const u=h},"84f4":function(e,t,i){"use strict";function r(e){return"point"===e.type}i.d(t,"a",(function(){return r}))},"851f":function(e,t,i){"use strict";i.d(t,"a",(function(){return p})),i.d(t,"b",(function(){return f}));i("e06a"),i("c120");var r=i("e92d"),n=i("b2b2"),a=i("8048"),s=i("9180"),o=i("2172"),c=i("9786"),l=i("4ae5");const d=r["a"].getLogger("esri.layers.support.ElevationSampler");class h{queryElevation(e){return f(e.clone(),this)}on(){return O}projectIfRequired(e,t){return b(e,t)}}class u extends h{constructor(e,t,i){super(),this.tile=e,this.noDataValue=i,this.extent=Object(s["B"])(e.tile.extent,t.spatialReference);const r=Object(a["f"])(t.spatialReference),n=t.lodAt(e.tile.level).resolution*r;this.demResolution={min:n,max:n}}get spatialReference(){return this.extent.spatialReference}contains(e){const t=this.projectIfRequired(e,this.spatialReference);return Object(o["e"])(this.extent,t)}elevationAt(e){const t=this.projectIfRequired(e,this.spatialReference);if(Object(n["k"])(t))return null;if(!this.contains(e)){const t=this.extent,i=`${t.xmin}, ${t.ymin}, ${t.xmax}, ${t.ymax}`;return d.warn("#elevationAt()",`Point used to sample elevation (${e.x}, ${e.y}) is outside of the sampler extent (${i})`),this.noDataValue}return this.tile.sample(t.x,t.y)}}class p extends h{constructor(e,t,i){let r;super(),"number"==typeof t?(this.noDataValue=t,r=null):(r=t,this.noDataValue=i),this.samplers=r?e.map(e=>new u(e,r,this.noDataValue)):e;const n=this.samplers[0];if(n){this.extent=n.extent.clone();const{min:e,max:t}=n.demResolution;this.demResolution={min:e,max:t};for(let i=1;i<this.samplers.length;i++){const e=this.samplers[i];this.extent.union(e.extent),this.demResolution.min=Math.min(this.demResolution.min,e.demResolution.min),this.demResolution.max=Math.max(this.demResolution.max,e.demResolution.max)}}else this.extent=Object(s["B"])(Object(s["m"])(),r.spatialReference),this.demResolution={min:0,max:0}}get spatialReference(){return this.extent.spatialReference}elevationAt(e){const t=this.projectIfRequired(e,this.spatialReference);if(!t)return null;for(const i of this.samplers)if(i.contains(t))return i.elevationAt(t);return d.warn("#elevationAt()",`Point used to sample elevation (${e.x}, ${e.y}) is outside of the sampler`),this.noDataValue}}function f(e,t){const i=b(e,t.spatialReference);if(!i)return null;switch(e.type){case"point":m(e,i,t);break;case"polyline":g(e,i,t);break;case"multipoint":v(e,i,t)}return e}function b(e,t){if(Object(n["k"])(e))return null;const i=e.spatialReference;if(i.equals(t))return e;const r=Object(c["d"])(e,t);return r||d.error(`Cannot project geometry spatial reference (wkid:${i.wkid}) to elevation sampler spatial reference (wkid:${t.wkid})`),r}function m(e,t,i){e.z=Object(n["v"])(i.elevationAt(t),0)}function g(e,t,i){y.spatialReference=t.spatialReference;const r=e.hasM&&!e.hasZ;for(let a=0;a<e.paths.length;a++){const s=e.paths[a],o=t.paths[a];for(let e=0;e<s.length;e++){const t=s[e],a=o[e];y.x=a[0],y.y=a[1],r&&(t[3]=t[2]),t[2]=Object(n["v"])(i.elevationAt(y),0)}}e.hasZ=!0}function v(e,t,i){y.spatialReference=t.spatialReference;const r=e.hasM&&!e.hasZ;for(let a=0;a<e.points.length;a++){const s=e.points[a],o=t.points[a];y.x=o[0],y.y=o[1],r&&(s[3]=s[2]),s[2]=Object(n["v"])(i.elevationAt(y),0)}e.hasZ=!0}const y=new l["a"],O={remove(){}}},8675:function(e,t,i){"use strict";i.d(t,"a",(function(){return c})),i.d(t,"b",(function(){return o})),i.d(t,"c",(function(){return a})),i.d(t,"d",(function(){return s}));var r=i("fc00"),n=i("5957");const a=Object(r["a"])().vec3f("position"),s=Object(r["a"])().vec3f("position").vec2f("uv0"),o=Object(r["a"])().vec3f("position").vec4u8("color");class c{constructor(e){this.vertexBufferLayout=e}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return e.indices.get("position").length}write(e,t,i,r){Object(n["c"])(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,i,r)}}},"86ba":function(e,t,i){"use strict";i.d(t,"a",(function(){return k}));var r=i("e92d"),n=i("38a4"),a=i("b2b2"),s=i("a915"),o=i("3349"),c=i("e431"),l=i("0b2d"),d=i("bd7e"),h=i("7289"),u=i("fc00"),p=i("1038"),f=i("d7f7"),b=i("b061"),m=i("35b3"),g=i("1153"),v=i("b4c8"),y=i("b623"),O=i("9a68"),_=i("a4ee"),x=i("d272"),j=i("6a07"),w=i("c6d7"),S=i("be24"),T=i("8e97"),C=i("c3a4"),P=i("ca98"),A=i("da35"),M=i("7438"),R=i("c829"),E=i("87b7"),D=i("189c");const I=new Map([["position",0],["subdivisionFactor",1],["uv0",2],["auxpos1",3],["auxpos2",4],["size",6],["sizeFeatureAttribute",6],["color",5],["colorFeatureAttribute",5],["opacityFeatureAttribute",7]]);class F extends P["a"]{constructor(e,t,i){super(e,t,i),this.stippleTextureRepository=e.stippleTextureRepository}get stippleEnabled(){return this.configuration.stippleEnabled&&4!==this.configuration.output}initializeProgram(e){const t=F.shader.get(),i=this.configuration,r=t.build({OITEnabled:0===i.transparencyPassType,output:i.output,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,draped:i.draped,stippleEnabled:this.stippleEnabled,stippleOffColorEnabled:i.stippleOffColorEnabled,stippleRequiresClamp:!0,stippleScaleWithLineWidth:i.stippleScaleWithLineWidth,stipplePreferContinuous:i.stipplePreferContinuous,roundCaps:i.roundCaps,roundJoins:i.roundJoins,vvColor:i.vvColor,vvSize:i.vvSize,vvInstancingEnabled:!0,vvOpacity:i.vvOpacity,falloffEnabled:i.falloffEnabled,innerColorEnabled:i.innerColorEnabled,multipassTerrainEnabled:i.multipassTerrainEnabled,cullAboveGround:i.cullAboveGround});return new R["a"](e.rctx,r,I)}dispose(){super.dispose(),this.stippleTextureRepository.release(this.stipplePattern),this.stipplePattern=null,this.stippleTextureBind=null}bindPass(e,t){if(Object(T["c"])(this.program,t.camera.projectionMatrix),4===this.configuration.output&&Object(j["b"])(this.program,t),t.multipassTerrainEnabled&&(this.program.setUniform2fv("inverseViewport",t.inverseViewport),Object(w["a"])(this.program,t)),this.program.setUniform1f("intrinsicWidth",e.width),this.program.setUniform4fv("intrinsicColor",e.color),this.program.setUniform1f("miterLimit","miter"!==e.join?0:e.miterLimit),this.program.setUniform2fv("cameraNearFar",t.camera.nearFar),this.program.setUniform1f("pixelRatio",t.camera.pixelRatio),this.program.setUniform2f("screenSize",t.camera.fullViewport[2],t.camera.fullViewport[3]),Object(S["d"])(this.program,e),this.stipplePattern!==e.stipplePattern){const t=e.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,t),this.stipplePattern=t}if(this.stippleEnabled){const{pixelSize:i,sdfNormalizer:r,pixels:n}=Object(a["l"])(this.stippleTextureBind)?this.stippleTextureBind(this.program):{pixelSize:1,sdfNormalizer:1,pixels:1};if(this.program.setUniform1f("stipplePatternSDFNormalizer",r),this.program.setUniform1f("stipplePatternTextureSize",n),this.program.setUniform1f("stipplePatternPixelSize",i),this.program.setUniform1f("stipplePatternPixelSizeInv",1/i),this.configuration.draped?this.program.setUniform1f("worldToScreenRatio",1/t.screenToPCSRatio):this.program.setUniform1f("worldToScreenPerDistanceRatio",1/t.camera.perScreenPixelRatio),this.configuration.stippleOffColorEnabled){const t=Object(a["u"])(e.stippleOffColor);this.program.setUniform4f("stippleOffColor",t[0],t[1],t[2],t.length>3?t[3]:1)}}this.configuration.falloffEnabled&&this.program.setUniform1f("falloff",e.falloff),this.configuration.innerColorEnabled&&(this.program.setUniform4fv("innerColor",Object(a["v"])(e.innerColor,e.color)),this.program.setUniform1f("innerWidth",e.innerWidth*t.camera.pixelRatio))}bindDraw(e){Object(T["d"])(this.program,e),this.stippleEnabled&&!this.configuration.draped&&Object(T["a"])(this.program,e.origin,e.camera.viewInverseTransposeMatrix),Object(x["c"])(this.program,this.configuration,e),this.program.rebindTextures()}makePipelineState(e,t){const i=this.configuration,r=3===e,n=2===e;return Object(D["g"])({blending:0===i.output||7===i.output?r?M["g"]:Object(M["a"])(e):null,depthTest:{func:Object(M["b"])(e)},depthWrite:r?!i.transparent&&i.writeDepth&&D["e"]:Object(M["c"])(e),colorWrite:D["d"],stencilWrite:i.sceneHasOcludees?E["j"]:null,stencilTest:i.sceneHasOcludees?t?E["f"]:E["e"]:null,polygonOffset:r||n?i.polygonOffset&&z:M["d"]})}initializePipeline(){const e=this.configuration,t=e.polygonOffset&&z;return e.occluder&&(this._occluderPipelineTransparent=Object(D["g"])({blending:M["g"],polygonOffset:t,depthTest:E["a"],depthWrite:null,colorWrite:D["d"],stencilWrite:null,stencilTest:E["h"]}),this._occluderPipelineOpaque=Object(D["g"])({blending:M["g"],polygonOffset:t,depthTest:E["a"],depthWrite:null,colorWrite:D["d"],stencilWrite:E["i"],stencilTest:E["g"]}),this._occluderPipelineMaskWrite=Object(D["g"])({blending:null,polygonOffset:t,depthTest:E["b"],depthWrite:null,colorWrite:null,stencilWrite:E["j"],stencilTest:E["f"]})),this._occludeePipelineState=this.makePipelineState(this.configuration.transparencyPassType,!0),this.makePipelineState(this.configuration.transparencyPassType,!1)}get primitiveType(){return 5}getPipelineState(e,t){return t?this._occludeePipelineState:this.configuration.occluder?10===e?this._occluderPipelineTransparent:9===e?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipelineState(e,t)}}F.shader=new C["a"](O["b"],()=>i.e("chunk-2d213386").then(i.bind(null,"ac6d")));const z={factor:0,units:-4};class L extends A["a"]{constructor(){super(...arguments),this.output=0,this.occluder=!1,this.slicePlaneEnabled=!1,this.transparent=!1,this.polygonOffset=!1,this.writeDepth=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stippleScaleWithLineWidth=!1,this.stipplePreferContinuous=!0,this.roundCaps=!1,this.roundJoins=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.falloffEnabled=!1,this.innerColorEnabled=!1,this.sceneHasOcludees=!1,this.transparencyPassType=3,this.multipassTerrainEnabled=!1,this.cullAboveGround=!1}}Object(_["a"])([Object(A["b"])({count:8})],L.prototype,"output",void 0),Object(_["a"])([Object(A["b"])()],L.prototype,"occluder",void 0),Object(_["a"])([Object(A["b"])()],L.prototype,"slicePlaneEnabled",void 0),Object(_["a"])([Object(A["b"])()],L.prototype,"transparent",void 0),Object(_["a"])([Object(A["b"])()],L.prototype,"polygonOffset",void 0),Object(_["a"])([Object(A["b"])()],L.prototype,"writeDepth",void 0),Object(_["a"])([Object(A["b"])()],L.prototype,"draped",void 0),Object(_["a"])([Object(A["b"])()],L.prototype,"stippleEnabled",void 0),Object(_["a"])([Object(A["b"])()],L.prototype,"stippleOffColorEnabled",void 0),Object(_["a"])([Object(A["b"])()],L.prototype,"stippleScaleWithLineWidth",void 0),Object(_["a"])([Object(A["b"])()],L.prototype,"stipplePreferContinuous",void 0),Object(_["a"])([Object(A["b"])()],L.prototype,"roundCaps",void 0),Object(_["a"])([Object(A["b"])()],L.prototype,"roundJoins",void 0),Object(_["a"])([Object(A["b"])()],L.prototype,"vvSize",void 0),Object(_["a"])([Object(A["b"])()],L.prototype,"vvColor",void 0),Object(_["a"])([Object(A["b"])()],L.prototype,"vvOpacity",void 0),Object(_["a"])([Object(A["b"])()],L.prototype,"falloffEnabled",void 0),Object(_["a"])([Object(A["b"])()],L.prototype,"innerColorEnabled",void 0),Object(_["a"])([Object(A["b"])()],L.prototype,"sceneHasOcludees",void 0),Object(_["a"])([Object(A["b"])({count:4})],L.prototype,"transparencyPassType",void 0),Object(_["a"])([Object(A["b"])()],L.prototype,"multipassTerrainEnabled",void 0),Object(_["a"])([Object(A["b"])()],L.prototype,"cullAboveGround",void 0);const V=r["a"].getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial");class k extends m["a"]{constructor(e){super(e,B),this._vertexAttributeLocations=I,this.techniqueConfig=new L,this.layout=this.createLayout()}isClosed(e,t){return H(this.parameters,e,t)}dispose(){}getPassParameters(){return this.parameters}getTechniqueConfig(e,t){this.techniqueConfig.output=e,this.techniqueConfig.draped=20===t.slot;const i=Object(a["l"])(this.parameters.stipplePattern);return this.techniqueConfig.stippleEnabled=i,this.techniqueConfig.stippleOffColorEnabled=i&&Object(a["l"])(this.parameters.stippleOffColor),this.techniqueConfig.stippleScaleWithLineWidth=i&&this.parameters.stippleScaleWithLineWidth,this.techniqueConfig.stipplePreferContinuous=i&&this.parameters.stipplePreferContinuous,this.techniqueConfig.slicePlaneEnabled=this.parameters.slicePlaneEnabled,this.techniqueConfig.sceneHasOcludees=this.parameters.sceneHasOcludees,this.techniqueConfig.roundJoins="round"===this.parameters.join,this.techniqueConfig.roundCaps=2===this.parameters.cap,this.techniqueConfig.transparent=this.parameters.transparent,this.techniqueConfig.polygonOffset=this.parameters.polygonOffset,this.techniqueConfig.writeDepth=this.parameters.writeDepth,this.techniqueConfig.vvColor=this.parameters.vvColorEnabled,this.techniqueConfig.vvOpacity=this.parameters.vvOpacityEnabled,this.techniqueConfig.vvSize=this.parameters.vvSizeEnabled,this.techniqueConfig.innerColorEnabled=this.parameters.innerWidth>0&&Object(a["l"])(this.parameters.innerColor),this.techniqueConfig.falloffEnabled=this.parameters.falloff>0,this.techniqueConfig.occluder=8===this.parameters.renderOccluded,this.techniqueConfig.transparencyPassType=t.transparencyPassType,this.techniqueConfig.multipassTerrainEnabled=t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=t.cullAboveGround,this.techniqueConfig}intersect(e,t,i,r,n,s,o,c,l){Object(a["l"])(l)?this.intersectDrapedLineGeometry(e,r,l,s,o):this.intersectLineGeometry(e,t,i,r,o)}intersectDrapedLineGeometry(e,t,i,r,a){if(!t.options.selectionMode)return;const s=e.vertexAttributes.get("position").data,o=e.vertexAttributes.get("size");let c=this.parameters.width;if(this.parameters.vvSizeEnabled){const t=e.vertexAttributes.get("sizeFeatureAttribute").data[0];c*=Object(n["f"])(this.parameters.vvSizeOffset[0]+t*this.parameters.vvSizeFactor[0],this.parameters.vvSizeMinSize[0],this.parameters.vvSizeMaxSize[0])}else o&&(c*=o.data[0]);const l=r[0],d=r[1],h=(c/2+4)*e.screenToWorldRatio;let u=Number.MAX_VALUE,p=0;for(let f=0;f<s.length-5;f+=3){const e=s[f],t=s[f+1],i=l-e,r=d-t,a=s[f+3]-e,o=s[f+4]-t,c=Object(n["f"])((a*i+o*r)/(a*a+o*o),0,1),h=a*c-i,b=o*c-r,m=h*h+b*b;m<u&&(u=m,p=f/3)}u<h*h&&a(i.dist,i.normal,p,!1)}intersectLineGeometry(e,t,i,r,a){if(!r.options.selectionMode||Object(y["d"])(t))return;if(!Object(g["g"])(i))return void V.error("intersection assumes a translation-only matrix");const s=e.vertexAttributes,l=s.get("position").data;let u=this.parameters.width;if(this.parameters.vvSizeEnabled){const e=s.get("sizeFeatureAttribute").data[0];u*=Object(n["f"])(this.parameters.vvSizeOffset[0]+e*this.parameters.vvSizeFactor[0],this.parameters.vvSizeMinSize[0],this.parameters.vvSizeMaxSize[0])}else s.has("size")&&(u*=s.get("size").data[0]);const p=r.camera,f=X;Object(o["c"])(f,r.point);const b=u*p.pixelRatio/2+4*p.pixelRatio;Object(c["z"])(se[0],f[0]-b,f[1]+b,0),Object(c["z"])(se[1],f[0]+b,f[1]+b,0),Object(c["z"])(se[2],f[0]+b,f[1]-b,0),Object(c["z"])(se[3],f[0]-b,f[1]-b,0);for(let n=0;n<4;n++)if(!p.unprojectFromRenderScreen(se[n],oe[n]))return;Object(h["g"])(p.eye,oe[0],oe[1],ce),Object(h["g"])(p.eye,oe[1],oe[2],le),Object(h["g"])(p.eye,oe[2],oe[3],de),Object(h["g"])(p.eye,oe[3],oe[0],he);let m=Number.MAX_VALUE,v=0;const O=q(this.parameters,s,e.indices)?l.length-2:l.length-5;for(let n=0;n<O;n+=3){W[0]=l[n]+i[12],W[1]=l[n+1]+i[13],W[2]=l[n+2]+i[14];const e=(n+3)%l.length;if($[0]=l[e]+i[12],$[1]=l[e+1]+i[13],$[2]=l[e+2]+i[14],Object(h["v"])(ce,W)<0&&Object(h["v"])(ce,$)<0||Object(h["v"])(le,W)<0&&Object(h["v"])(le,$)<0||Object(h["v"])(de,W)<0&&Object(h["v"])(de,$)<0||Object(h["v"])(he,W)<0&&Object(h["v"])(he,$)<0)continue;if(p.projectToRenderScreen(W,Y),p.projectToRenderScreen($,K),Y[2]<0&&K[2]>0){Object(c["m"])(Z,W,$);const e=p.frustum,t=-Object(h["v"])(e[4],W)/Object(c["k"])(Z,Object(h["r"])(e[4]));Object(c["h"])(Z,Z,t),Object(c["i"])(W,W,Z),p.projectToRenderScreen(W,Y)}else if(Y[2]>0&&K[2]<0){Object(c["m"])(Z,$,W);const e=p.frustum,t=-Object(h["v"])(e[4],$)/Object(c["k"])(Z,Object(h["r"])(e[4]));Object(c["h"])(Z,Z,t),Object(c["i"])($,$,Z),p.projectToRenderScreen($,K)}else if(Y[2]<0&&K[2]<0)continue;Y[2]=0,K[2]=0;const t=Object(d["e"])(Object(d["f"])(Y,K,te),f);t<m&&(m=t,Object(c["n"])(J,W),Object(c["n"])(ee,$),v=n/3)}const _=r.rayBegin,x=r.rayEnd;if(m<b*b){let e=Number.MAX_VALUE;if(Object(d["a"])(Object(d["f"])(J,ee,te),Object(d["f"])(_,x,ie),Q)){Object(c["m"])(Q,Q,_);const t=Object(c["s"])(Q);Object(c["h"])(Q,Q,1/t),e=t/Object(c["p"])(_,x)}a(e,Q,v,!1)}}computeAttachmentOrigin(e,t){const i=e.vertexAttributes;if(!i)return null;const r=e.indices,n=i.get("position");return Object(p["a"])(n,r?r.get("position"):null,r&&q(this.parameters,i,r),t)}createLayout(){const e=Object(u["a"])().vec3f("position").f32("subdivisionFactor").vec2f("uv0").vec3f("auxpos1").vec3f("auxpos2");return this.parameters.vvSizeEnabled?e.f32("sizeFeatureAttribute"):e.f32("size"),this.parameters.vvColorEnabled?e.f32("colorFeatureAttribute"):e.vec4f("color"),this.parameters.vvOpacityEnabled&&e.f32("opacityFeatureAttribute"),e}createBufferWriter(){return new N(this.layout,this.parameters)}requiresSlot(e,t){if(20===e)return!0;if(8===this.parameters.renderOccluded)return 2===e||9===e||10===e;const i=Object(b["b"])(t);return 0===i||7===i?e===(this.parameters.writeDepth?4:7):2===e}createGLMaterial(e){return 0===e.output||7===e.output||4===e.output||1===e.output?new U(e):null}validateParameters(e){"miter"!==e.join&&(e.miterLimit=0),this.requiresTransparent(e)&&(e.transparent=!0)}requiresTransparent(e){return!!((e.color&&e.color[3])<1||e.innerWidth>0&&this.colorRequiresTransparent(e.innerColor)||e.stipplePattern&&this.colorRequiresTransparent(e.stippleOffColor)||e.falloff>0)}colorRequiresTransparent(e){return Object(a["l"])(e)&&e[3]<1&&e[3]>0}}class U extends f["a"]{updateParameters(e){return this.ensureTechnique(F,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.sceneHasOcludees&&this._material.setParameters({sceneHasOcludees:e.hasOccludees})}beginSlot(e){return 0!==this._output&&7!==this._output||this._updateOccludeeState(e),this.updateParameters(e)}bind(e,t){t.bindPass(this._material.getPassParameters(),e)}}const B={width:0,color:[1,1,1,1],join:"miter",cap:0,miterLimit:5,writeDepth:!0,polygonOffset:!1,stipplePattern:null,stippleOffColor:null,stippleScaleWithLineWidth:!1,stipplePreferContinuous:!0,slicePlaneEnabled:!1,vvFastUpdate:!1,transparent:!1,isClosed:!1,falloff:0,innerWidth:0,innerColor:null,sceneHasOcludees:!1,...m["b"],...v["a"].Default};class N{constructor(e,t){this.parameters=t,this.numJoinSubdivisions=0,this.vertexBufferLayout=e;const i=t.stipplePattern?1:0;switch(this.parameters.join){case"miter":case"bevel":this.numJoinSubdivisions=i;break;case"round":this.numJoinSubdivisions=O["a"]+i}}isClosed(e){return q(this.parameters,e.vertexAttributes,e.indices)}numCapSubdivisions(e){if(this.isClosed(e))return 0;switch(this.parameters.cap){case 1:case 2:return 1;default:return 0}}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){const t=2*this.numCapSubdivisions(e)+2,i=e.indices.get("position").length/2+1,r=this.isClosed(e);let n=r?2:2*t;const a=r?0:1,s=r?i:i-1;if(e.vertexAttributes.has("subdivisions")){const t=e.vertexAttributes.get("subdivisions").data;for(let e=a;e<s;++e)n+=4+2*t[e]}else n+=(s-a)*(2*this.numJoinSubdivisions+4);return n+=2,n}write(e,t,i,r){var n;const a=re,s=ne,o=ae,l=t.vertexAttributes.get("position").data,d=t.indices&&t.indices.get("position"),h=null==(n=t.vertexAttributes.get("distanceToStart"))?void 0:n.data,u=this.numCapSubdivisions(t);d&&d.length!==2*(l.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");let p=null;t.vertexAttributes.has("subdivisions")&&(p=t.vertexAttributes.get("subdivisions").data);let f=1,b=0;this.parameters.vvSizeEnabled?b=t.vertexAttributes.get("sizeFeatureAttribute").data[0]:t.vertexAttributes.has("size")&&(f=t.vertexAttributes.get("size").data[0]);let m=[1,1,1,1],g=0;this.parameters.vvColorEnabled?g=t.vertexAttributes.get("colorFeatureAttribute").data[0]:t.vertexAttributes.has("color")&&(m=t.vertexAttributes.get("color").data);let v=0;this.parameters.vvOpacityEnabled&&(v=t.vertexAttributes.get("opacityFeatureAttribute").data[0]);const y=l.length/3,O=e.transformation,_=new Float32Array(i.buffer),x=this.vertexBufferLayout.stride/4;let j=r*x;const w=j;let S=0;const T=(e,t,i,r,n,a,s)=>{if(_[j++]=t[0],_[j++]=t[1],_[j++]=t[2],_[j++]=r,_[j++]=s,_[j++]=n,_[j++]=e[0],_[j++]=e[1],_[j++]=e[2],_[j++]=i[0],_[j++]=i[1],_[j++]=i[2],this.parameters.vvSizeEnabled?_[j++]=b:_[j++]=f,this.parameters.vvColorEnabled)_[j++]=g;else{const e=Math.min(4*a,m.length-4);_[j++]=m[e+0],_[j++]=m[e+1],_[j++]=m[e+2],_[j++]=m[e+3]}this.parameters.vvOpacityEnabled&&(_[j++]=v)};j+=x,Object(c["z"])(s,l[0],l[1],l[2]),O&&Object(c["t"])(s,s,O);const C=this.isClosed(t);if(C){const e=l.length-3;Object(c["z"])(a,l[e],l[e+1],l[e+2]),O&&Object(c["t"])(a,a,O)}else{Object(c["n"])(a,s),Object(c["z"])(o,l[3],l[4],l[5]),O&&Object(c["t"])(o,o,O);for(let e=0;e<u;++e){const t=1-e/u;T(a,s,o,t,-4,0,S),T(a,s,o,t,4,0,S)}T(a,s,o,0,-4,0,S),T(a,s,o,0,4,0,S),Object(c["n"])(a,s),Object(c["n"])(s,o)}const P=C?0:1,A=C?y:y-1,M=h?(e,t,i)=>S=h[i]:(e,t,i)=>S+=Object(c["p"])(e,t);for(let R=P;R<A;R++){const e=(R+1)%y*3;Object(c["z"])(o,l[e+0],l[e+1],l[e+2]),O&&Object(c["t"])(o,o,O),M(a,s,R),T(a,s,o,0,-1,R,S),T(a,s,o,0,1,R,S);const t=p?p[R]:this.numJoinSubdivisions;for(let i=0;i<t;++i){const e=(i+1)/(t+1);T(a,s,o,e,-1,R,S),T(a,s,o,e,1,R,S)}T(a,s,o,1,-2,R,S),T(a,s,o,1,2,R,S),Object(c["n"])(a,s),Object(c["n"])(s,o)}if(C)Object(c["z"])(o,l[3],l[4],l[5]),O&&Object(c["t"])(o,o,O),S=M(a,s,A),T(a,s,o,0,-1,P,S),T(a,s,o,0,1,P,S);else{S=M(a,s,A),T(a,s,o,0,-5,A,S),T(a,s,o,0,5,A,S);for(let e=0;e<u;++e){const t=(e+1)/u;T(a,s,o,t,-5,A,S),T(a,s,o,t,5,A,S)}}G(_,w+x,_,w,x),j=G(_,j-x,_,j,x)}}function G(e,t,i,r,n){for(let a=0;a<n;a++)i[r++]=e[t++];return r}function q(e,t,i){return H(e,t.get("position").data,i?i.get("position"):null)}function H(e,t,i){return!!e.isClosed&&(i?i.length>2:t.length>6)}const W=Object(l["f"])(),$=Object(l["f"])(),Z=Object(l["f"])(),Q=Object(l["f"])(),X=Object(l["f"])(),Y=Object(s["e"])(),K=Object(s["e"])(),J=Object(l["f"])(),ee=Object(l["f"])(),te=Object(d["d"])(),ie=Object(d["d"])(),re=Object(l["f"])(),ne=Object(l["f"])(),ae=Object(l["f"])(),se=[Object(s["e"])(),Object(s["e"])(),Object(s["e"])(),Object(s["e"])()],oe=[Object(l["f"])(),Object(l["f"])(),Object(l["f"])(),Object(l["f"])()],ce=Object(h["d"])(),le=Object(h["d"])(),de=Object(h["d"])(),he=Object(h["d"])()},"87b7":function(e,t,i){"use strict";i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return r})),i.d(t,"c",(function(){return o})),i.d(t,"d",(function(){return c})),i.d(t,"e",(function(){return l})),i.d(t,"f",(function(){return d})),i.d(t,"g",(function(){return h})),i.d(t,"h",(function(){return u})),i.d(t,"i",(function(){return s})),i.d(t,"j",(function(){return a}));const r={func:513},n={func:519},a={mask:255},s={mask:0},o=e=>({function:{func:517,ref:e,mask:e},operation:{fail:7680,zFail:7680,zPass:7680}}),c=e=>({function:{func:519,ref:e,mask:e},operation:{fail:7680,zFail:7680,zPass:7681}}),l={function:{func:519,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:0}},d={function:{func:519,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:7681}},h={function:{func:514,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:7680}},u={function:{func:517,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:7680}}},"88da":function(e,t,i){"use strict";i.d(t,"a",(function(){return m}));var r,n=i("a4ee"),a=(i("c120"),i("6a0e")),s=i("59b2"),o=(i("b50f"),i("cea0")),c=i("afcf"),l=i("d386"),d=i("09db"),h=i("fcf2"),u=i("4dc1");const p=new WeakMap;let f=0,b=r=class extends a["a"]{constructor(e){super(e),this.wrap="repeat"}get url(){return this._get("url")||null}set url(e){this._set("url",e),e&&this._set("data",null)}get data(){return this._get("data")||null}set data(e){this._set("data",e),e&&this._set("url",null)}writeData(e,t,i,r){if(e instanceof HTMLImageElement){const n={type:"image-element",src:Object(h["e"])(e.src,r),crossOrigin:e.crossOrigin};t[i]=n}else if(e instanceof HTMLCanvasElement){const r=e.getContext("2d").getImageData(0,0,e.width,e.height),n={type:"canvas-element",imageData:this.encodeImageData(r)};t[i]=n}else if(e instanceof HTMLVideoElement){const n={type:"video-element",src:Object(h["e"])(e.src,r),autoplay:e.autoplay,loop:e.loop,muted:e.muted,crossOrigin:e.crossOrigin,preload:e.preload};t[i]=n}else{const r={type:"image-data",imageData:this.encodeImageData(e)};t[i]=r}}readData(e){switch(e.type){case"image-element":{const t=new Image;return t.src=e.src,t.crossOrigin=e.crossOrigin,t}case"canvas-element":{const t=this.decodeImageData(e.imageData),i=document.createElement("canvas");return i.width=t.width,i.height=t.height,i.getContext("2d").putImageData(t,0,0),i}case"image-data":return this.decodeImageData(e.imageData);case"video-element":{const t=document.createElement("video");return t.src=e.src,t.crossOrigin=e.crossOrigin,t.autoplay=e.autoplay,t.loop=e.loop,t.muted=e.muted,t.preload=e.preload,t}default:return}}get transparent(){const e=this.data,t=this.url;if(e instanceof HTMLCanvasElement)return this.imageDataContainsTransparent(e.getContext("2d").getImageData(0,0,e.width,e.height));if(e instanceof ImageData)return this.imageDataContainsTransparent(e);if(t){const e=t.substr(t.length-4,4).toLowerCase(),i=t.substr(0,15).toLocaleLowerCase();if(".png"===e||"data:image/png;"===i)return!0}return!1}set transparent(e){null!=e?this._override("transparent",e):this._clearOverride("transparent")}get contentHash(){const e="string"==typeof this.wrap?this.wrap:"object"==typeof this.wrap?`${this.wrap.horizontal}/${this.wrap.vertical}`:"",t=(t="")=>`d:${t},t:${this.transparent},w:${e}`;return null!=this.url?t(this.url):null!=this.data?this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement?t(this.data.src):(p.has(this.data)||p.set(this.data,++f),t(p.get(this.data))):t()}clone(){const e={url:this.url,data:this.data,wrap:this.cloneWrap()};return new r(e)}cloneWithDeduplication(e){const t=e.get(this);if(t)return t;const i=this.clone();return e.set(this,i),i}cloneWrap(){return"string"==typeof this.wrap?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}}encodeImageData(e){let t="";for(let i=0;i<e.data.length;i++)t+=String.fromCharCode(e.data[i]);return{data:btoa(t),width:e.width,height:e.height}}decodeImageData(e){const t=atob(e.data),i=new Uint8ClampedArray(t.length);for(let r=0;r<t.length;r++)i[r]=t.charCodeAt(r);return Object(u["h"])(i,e.width,e.height)}imageDataContainsTransparent(e){for(let t=3;t<e.data.length;t+=4)if(255!==e.data[t])return!0;return!1}static from(e){return"string"==typeof e?new r({url:e}):e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageData||e instanceof HTMLVideoElement?new r({data:e}):Object(o["d"])(r,e)}};Object(n["a"])([Object(s["b"])({type:String,json:{write:h["f"]}})],b.prototype,"url",null),Object(n["a"])([Object(s["b"])({json:{write:{overridePolicy(){return{enabled:!this.url}}}}}),Object(s["b"])()],b.prototype,"data",null),Object(n["a"])([Object(d["a"])("data")],b.prototype,"writeData",null),Object(n["a"])([Object(c["a"])("data")],b.prototype,"readData",null),Object(n["a"])([Object(s["b"])({type:Boolean,json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],b.prototype,"transparent",null),Object(n["a"])([Object(s["b"])({json:{write:!0}})],b.prototype,"wrap",void 0),Object(n["a"])([Object(s["b"])({readOnly:!0})],b.prototype,"contentHash",null),b=r=Object(n["a"])([Object(l["a"])("esri.geometry.support.MeshTexture")],b);const m=b},"89bf":function(e,t,i){"use strict";i.d(t,"a",(function(){return b})),i.d(t,"b",(function(){return T})),i.d(t,"c",(function(){return j})),i.d(t,"d",(function(){return _})),i.d(t,"e",(function(){return S}));var r=i("b2b2"),n=i("1c92"),a=i("dae5"),s=i("d791"),o=i("afe1"),c=i("04f0"),l=i("b139"),d=i("e431"),h=i("47f8"),u=i("0b2d"),p=i("0fc4"),f=i("f895");class b{constructor(){this._transform=Object(o["d"])(),this._transformInverse=new m({value:this._transform},s["c"],o["d"]),this._transformInverseTranspose=new m(this._transformInverse,s["u"],o["d"]),this._transformTranspose=new m({value:this._transform},s["u"],o["d"]),this._transformInverseRotation=new m({value:this._transform},n["l"],a["b"])}invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(e){Object(s["d"])(this._transform,e)}multiplyTransform(e){Object(s["n"])(this._transform,this._transform,e)}set(e){Object(s["d"])(this._transform,e),this.invalidateLazyTransforms()}setAndInvalidateLazyTransforms(e,t){this.setTransformMatrix(e),this.multiplyTransform(t),this.invalidateLazyTransforms()}}class m{constructor(e,t,i){this.original=e,this.update=t,this.dirty=!0,this.transform=i()}invalidate(){this.dirty=!0}get value(){return this.dirty&&(this.update(this.transform,this.original.value),this.dirty=!1),this.transform}}class g{constructor(e=0){this.offset=e,this.tmpVertex=Object(u["f"])()}applyToVertex(e,t,i){const r=e+this.localOrigin[0],n=t+this.localOrigin[1],a=i+this.localOrigin[2],s=this.offset/Math.sqrt(r*r+n*n+a*a);return this.tmpVertex[0]=e+r*s,this.tmpVertex[1]=t+n*s,this.tmpVertex[2]=i+a*s,this.tmpVertex}applyToAabb(e){const t=e[0]+this.localOrigin[0],i=e[1]+this.localOrigin[1],r=e[2]+this.localOrigin[2],n=e[3]+this.localOrigin[0],a=e[4]+this.localOrigin[1],s=e[5]+this.localOrigin[2],o=this.offset/Math.sqrt(t*t+i*i+r*r);e[0]+=t*o,e[1]+=i*o,e[2]+=r*o;const c=this.offset/Math.sqrt(n*n+a*a+s*s);return e[3]+=n*c,e[4]+=a*c,e[5]+=s*c,e}}class v{constructor(e=0){this.offset=e,this.componentLocalOriginLength=0,this.tmpVertex=Object(u["f"])(),this.mbs=Object(p["e"])(),this.obb={center:Object(u["f"])(),halfSize:Object(h["c"])(),quaternion:null}}set localOrigin(e){this.componentLocalOriginLength=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])}applyToVertex(e,t,i){const r=e,n=t,a=i+this.componentLocalOriginLength,s=this.offset/Math.sqrt(r*r+n*n+a*a);return this.tmpVertex[0]=e+r*s,this.tmpVertex[1]=t+n*s,this.tmpVertex[2]=i+a*s,this.tmpVertex}applyToAabb(e){const t=e[0],i=e[1],r=e[2]+this.componentLocalOriginLength,n=e[3],a=e[4],s=e[5]+this.componentLocalOriginLength,o=this.offset/Math.sqrt(t*t+i*i+r*r);e[0]+=t*o,e[1]+=i*o,e[2]+=r*o;const c=this.offset/Math.sqrt(n*n+a*a+s*s);return e[3]+=n*c,e[4]+=a*c,e[5]+=s*c,e}applyToMbs(e){const t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),i=this.offset/t;return this.mbs[0]=e[0]+e[0]*i,this.mbs[1]=e[1]+e[1]*i,this.mbs[2]=e[2]+e[2]*i,this.mbs[3]=e[3]+e[3]*this.offset/t,this.mbs}applyToObb(e){const t=e.center,i=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);this.obb.center[0]=t[0]+t[0]*i,this.obb.center[1]=t[1]+t[1]*i,this.obb.center[2]=t[2]+t[2]*i,Object(d["x"])(this.obb.halfSize,e.halfSize,e.quaternion),Object(d["i"])(this.obb.halfSize,this.obb.halfSize,e.center);const r=this.offset/Math.sqrt(this.obb.halfSize[0]*this.obb.halfSize[0]+this.obb.halfSize[1]*this.obb.halfSize[1]+this.obb.halfSize[2]*this.obb.halfSize[2]);return this.obb.halfSize[0]+=this.obb.halfSize[0]*r,this.obb.halfSize[1]+=this.obb.halfSize[1]*r,this.obb.halfSize[2]+=this.obb.halfSize[2]*r,Object(d["m"])(this.obb.halfSize,this.obb.halfSize,e.center),Object(c["b"])(C,e.quaternion),Object(d["x"])(this.obb.halfSize,this.obb.halfSize,C),this.obb.halfSize[0]*=this.obb.halfSize[0]<0?-1:1,this.obb.halfSize[1]*=this.obb.halfSize[1]<0?-1:1,this.obb.halfSize[2]*=this.obb.halfSize[2]<0?-1:1,this.obb.quaternion=e.quaternion,this.obb}}class y{constructor(e=0){this.offset=e,this.sphere=Object(f["c"])(),this.tmpVertex=Object(u["f"])()}applyToVertex(e,t,i){const r=this.objectTransform.transform;let n=r[0]*e+r[4]*t+r[8]*i+r[12],a=r[1]*e+r[5]*t+r[9]*i+r[13],s=r[2]*e+r[6]*t+r[10]*i+r[14];const o=this.offset/Math.sqrt(n*n+a*a+s*s);n+=n*o,a+=a*o,s+=s*o;const c=this.objectTransform.inverse;return this.tmpVertex[0]=c[0]*n+c[4]*a+c[8]*s+c[12],this.tmpVertex[1]=c[1]*n+c[5]*a+c[9]*s+c[13],this.tmpVertex[2]=c[2]*n+c[6]*a+c[10]*s+c[14],this.tmpVertex}applyToMinMax(e,t){const i=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*i,e[1]+=e[1]*i,e[2]+=e[2]*i;const r=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]+=t[0]*r,t[1]+=t[1]*r,t[2]+=t[2]*r}applyToAabb(e){const t=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*t,e[1]+=e[1]*t,e[2]+=e[2]*t;const i=this.offset/Math.sqrt(e[3]*e[3]+e[4]*e[4]+e[5]*e[5]);return e[3]+=e[3]*i,e[4]+=e[4]*i,e[5]+=e[5]*i,e}applyToBoundingSphere(e){const t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),i=this.offset/t;return this.sphere[0]=e[0]+e[0]*i,this.sphere[1]=e[1]+e[1]*i,this.sphere[2]=e[2]+e[2]*i,this.sphere[3]=e[3]+e[3]*this.offset/t,this.sphere}}const O=new y;function _(e){return Object(r["l"])(e)?(O.offset=e,O):null}const x=new v;function j(e){return Object(r["l"])(e)?(x.offset=e,x):null}const w=new g;function S(e){return Object(r["l"])(e)?(w.offset=e,w):null}const T="terrain",C=Object(l["b"])()},"89cb":function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var r=i("ce50"),n=i("e92d"),a=i("008c");function s(e,t,i,r,a){const s=e.referencesGeometry()&&a?c(t,r,a):t,o=e.repurposeFeature(s);try{return e.evaluate({...i,$feature:o})}catch(l){return n["a"].getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",l),null}}const o=new Map;function c(e,t,i){const{transform:r,hasZ:n,hasM:a}=i;o.has(t)||o.set(t,l(t));const s=o.get(t)(e.geometry,r,n,a);return{...e,geometry:s}}function l(e){const t={};switch(e){case"esriGeometryPoint":return(e,i,r,n)=>Object(a["e"])(i,t,e,r,n);case"esriGeometryPolygon":return(e,i,r,n)=>Object(a["f"])(i,t,e,r,n);case"esriGeometryPolyline":return(e,i,r,n)=>Object(a["g"])(i,t,e,r,n);case"esriGeometryMultipoint":return(e,i,r,n)=>Object(a["d"])(i,t,e,r,n);default:return n["a"].getLogger("esri.views.2d.support.arcadeOnDemand").error(new r["a"]("mapview-arcade","Unable to handle geometryType: "+e)),e=>e}}},"8b9d":function(e,t,i){"use strict";i.d(t,"a",(function(){return Z})),i.d(t,"b",(function(){return E})),i.d(t,"c",(function(){return D})),i.d(t,"d",(function(){return Q})),i.d(t,"e",(function(){return U})),i.d(t,"f",(function(){return z})),i.d(t,"g",(function(){return N})),i.d(t,"h",(function(){return F})),i.d(t,"i",(function(){return H})),i.d(t,"j",(function(){return B})),i.d(t,"k",(function(){return q})),i.d(t,"l",(function(){return L})),i.d(t,"m",(function(){return I})),i.d(t,"n",(function(){return V})),i.d(t,"o",(function(){return G})),i.d(t,"p",(function(){return W})),i.d(t,"q",(function(){return X})),i.d(t,"r",(function(){return $})),i.d(t,"s",(function(){return P}));var r=i("b2b2"),n=i("3af9"),a=i("ce50"),s=i("e431"),o=i("0b2d"),c=i("8188"),l=i("9180"),d=i("2ec5"),h=i("ee83");const u=Object(o["f"])(),p=Object(o["f"])(),f=Object(o["f"])(),b=Object(o["f"])();function m(e,t,i=0){const n=e.extent;if(Object(r["k"])(n))return!1;if(0===i)return Object(l["h"])(n,t);const a=Math.min(n[2]-n[0],n[3]-n[1]);return Object(l["j"])(n,t,i*a)}function g(e,t,i,r){Object(s["n"])(u,i),u[r]=t[r];const n=Object(s["m"])(u,u,t),a=Object(s["m"])(p,e,t),o=Object(s["k"])(a,n),c=Object(s["k"])(n,n);let l;l=o<=0?t:c<=o?i:Object(s["i"])(u,t,Object(s["h"])(n,n,o/c));const d=Object(s["m"])(u,e,l);return Math.PI/2-Math.atan(d[2]/Math.sqrt(d[0]*d[0]+d[1]*d[1]))}function v(e,t,i){const n=e.extent;if(Object(r["k"])(n))return 0;f[0]=n[0],f[1]=n[1],f[2]=i,b[0]=n[2],b[1]=n[3],b[2]=i;let a=1/0,s=1/0;return t[0]<f[0]?a=g(t,f,b,0):t[0]>b[0]&&(a=g(t,b,f,0)),t[1]<f[1]?s=g(t,f,b,1):t[1]>b[1]&&(s=g(t,b,f,1)),Math.min(a,s)}function y(e,t,i){if(e.spatialReference.isGeographic&&!Object(c["a"])(e.spatialReference))return new a["a"]("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");const n=h["a"].checkUnsupported(e);if(Object(r["l"])(n))return n;const s=O(e,i);return s||(t&&!e.spatialReference.equals(t)?new a["a"]("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene"):null)}function O(e,t){const i=e.lods,r=i[0].resolution*2**i[0].level,n=[r*e.size[0],r*e.size[1]],s=[e.origin.x,e.origin.y],o=Object(l["t"])(t),c=Object(l["m"])();h["a"].computeRowColExtent(o,n,s,c);const u=(c[2]-c[0])*(c[3]-c[1]);if(u>d["g"]){const t=i[0].scale*2**i[0].level;let n=Math.max((o[3]-o[1])/e.size[1],(o[2]-o[0])/e.size[0])*t/r;const s=Math.floor(Math.log(n)/Math.log(10));return n=Math.ceil(n/10**s)*10**s,new a["a"]("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(t).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+n.toLocaleString()+".",{level0Scale:t,suggestedLevel0Scale:n,requiredNumRootTiles:u,allowedNumRootTiles:d["g"]})}return null}const _=Object.freeze({__proto__:null,isInsideExtent:m,tiltToExtentEdge:v,checkIfTileInfoSupportedForViewSR:y});var x=i("7f83");function j(){return!0}function w(){return 0}function S(e,t){const i=e.lods.length-1,r=e.spatialReference,n=Object(c["a"])(r)||Object(x["i"])(r)||Object(x["j"])(r);if(r.isWebMercator){if(!h["a"].makeWebMercatorAuxiliarySphere(i).compatibleWith(e))return new a["a"]("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else{if(!n)return new a["a"]("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(!h["a"].makeGCSWithTileSize(e.spatialReference,e.size[0],i).compatibleWith(e))return e.spatialReference.isWGS84?new a["a"]("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new a["a"]("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}if(t&&!e.spatialReference.equals(t))return new a["a"]("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene")}const T=Object.freeze({__proto__:null,isInsideExtent:j,tiltToExtentEdge:w,checkIfTileInfoSupportedForViewSR:S}),C={1:T,2:_};function P(e,t){e||console.warn("Terrain: "+t)}const A=1.2,M=80/180*Math.PI,R=110/180*Math.PI;function E(e,t,i){const n=C[e.viewingMode];let a;if(n.isInsideExtent(e,t))a=Object(r["v"])(e.getElevation(t[0],t[1],t[1],e.spatialReference),0);else{if(!n.isInsideExtent(e,t,A))return 0;const i=e.getTileWithElevation(t[0],t[1],t[1],e.spatialReference);a=.5*((Object(r["l"])(i)?i.elevationBounds[0]:e.elevationBounds.min)+(Object(r["l"])(i)?i.elevationBounds[1]:e.elevationBounds.max));const s=n.tiltToExtentEdge(e,t,a);if(s>M&&s<R)return 0}const s=t[2]-a;return Math.abs(s)<i?0:s<0?-1:1}function D(e){return z(e)?{fullExtent:e.fullExtent,minScale:e.layer.minScale,maxScale:e.layer.maxScale,tilemapCache:null}:e.layer}function I(e){return"vector-tile"===(null==e?void 0:e.type)}function F(e){return"imagery-tile"===(null==e?void 0:e.type)||"wcs"===(null==e?void 0:e.type)}function z(e){return"imagery-tile-3d"===(null==e?void 0:e.type)}function L(e){return"tile-3d"===(null==e?void 0:e.type)}function V(e){return"vector-tile-3d"===(null==e?void 0:e.type)}function k(e){return"wmts-3d"===(null==e?void 0:e.type)}function U(e){return"elevation-3d"===(null==e?void 0:e.type)}function B(e){return e&&(L(e)||z(e)||U(e)||V(e)||k(e))}function N(e){var t;const i=null==e||null==(t=e.sourceLayerInfo)?void 0:t.data;return Object(r["l"])(i)&&"type"in i&&"raster-tile"===i.type}function G(e){var t;const i=null==e||null==(t=e.sourceLayerInfo)?void 0:t.data;return Object(r["l"])(i)&&"type"in i&&"vector-tile"===i.type}function q(e){var t;const i=null==e||null==(t=e.sourceLayerInfo)?void 0:t.data;return Object(r["l"])(i)&&"type"in i&&"tile-texture"===i.type}function H(e){var t;const i=null==e||null==(t=e.sourceLayerInfo)?void 0:t.data;return i instanceof HTMLImageElement||i instanceof n["a"]||i instanceof HTMLCanvasElement||i instanceof ImageData}function W(e){return Object(r["l"])(e)&&"release"in e&&e.release(),null}function $(e){return e.fetchTile&&!1!==e.hasOverriddenFetchTile}function Z(e,t,i,r){return C[r].checkIfTileInfoSupportedForViewSR(e,i,t)}function Q(e,t,i){let n=null,a=null;if("wmts"===e.type){const r=e.activeLayer;if(r){const e=r.tileMatrixSet;if(e)n=e.tileInfo,a=e.fullExtent;else{const e=r.tileMatrixSets;if(e){const r=e.find(e=>null==Z(e.tileInfo,e.fullExtent,t,i));if(r)return{tileInfo:r.tileInfo,fullExtent:r.fullExtent}}}}}else a=F(e)?e.getCompatibleFullExtent(t):e.fullExtent,n=I(e)&&!X.force512VTL?e.compatibleTileInfo256:F(e)?e.getCompatibleTileInfo(t,a,2===i):e.tileInfo;return Object(r["l"])(n)&&Object(r["l"])(a)&&null==Z(n,a,t,i)?{tileInfo:n,fullExtent:a}:null}const X={force512VTL:!1}},"8c4b":function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("38a4");function n(e,t,i){var n;const l=e.byteLength/(4*t),d=new Uint32Array(e,0,l*t);let h=new Uint32Array(l);const u=null!=(n=null==i?void 0:i.minReduction)?n:0,p=(null==i?void 0:i.originalIndices)||null,f=p?p.length:0,b=(null==i?void 0:i.componentOffsets)||null;let m=0;if(b)for(let r=0;r<b.length-1;r++){const e=b[r+1]-b[r];e>m&&(m=e)}else m=l;const g=Math.floor(1.1*m)+1;(null==c||c.length<2*g)&&(c=new Uint32Array(Object(r["n"])(2*g)));for(let r=0;r<2*g;r++)c[r]=0;let v=0;const y=!!b&&!!p,O=y?f:l,_=y?new Uint32Array(f):null,x=1.96;let j=0!==u?Math.ceil(4*x*x/(u*u)*u*(1-u)):O,w=1,S=b?b[1]:O;for(let r=0;r<O;r++){if(r===j){const e=1-v/r;if(e+x*Math.sqrt(e*(1-e)/r)<u)return null;j*=2}if(r===S){for(let e=0;e<2*g;e++)c[e]=0;if(p)for(let e=b[w-1];e<b[w];e++)_[e]=h[p[e]];S=b[++w]}const e=y?p[r]:r,i=e*t,n=o(d,i,t);let s=n%g,l=v;for(;0!==c[2*s+1];){if(c[2*s]===n){const e=c[2*s+1]-1;if(a(d,i,e*t,t)){l=h[e];break}}s++,s>=g&&(s-=g)}l===v&&(c[2*s]=n,c[2*s+1]=e+1,v++),h[e]=l}if(0!==u&&1-v/l<u)return null;if(y){for(let e=b[w-1];e<_.length;e++)_[e]=h[p[e]];h=_}const T=new Uint32Array(t*v);v=0;for(let r=0;r<O;r++)h[r]===v&&(s(d,(y?p[r]:r)*t,T,v*t,t),v++);if(p&&!y){const e=new Uint32Array(f);for(let t=0;t<e.length;t++)e[t]=h[p[t]];h=e}return{buffer:T.buffer,indices:h,uniqueCount:v}}function a(e,t,i,r){for(let n=0;n<r;n++)if(e[t+n]!==e[i+n])return!1;return!0}function s(e,t,i,r,n){for(let a=0;a<n;a++)i[r+a]=e[t+a]}function o(e,t,i){let r=0;for(let n=0;n<i;n++)r=e[t+n]+r|0,r=r+(r<<11)+(r>>>2)|0;return r>>>0}let c=null},"8e6f":function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var r=i("b33e"),n=i("55f0");class a extends r["a"]{constructor(e,t,i){super(e,t,i)}value(e){const t=super.value(e);return Math.exp(t)}valueDelta(e,t){const i=super.value(e),r=super.value(e+t)-i;return Math.exp(r)}}class s extends n["a"]{constructor(e=2.5,t=.01,i=.95,r=12){super(e,t,i,r)}add(e,t){super.add(Math.log(e),t)}createMomentum(e,t,i){return new a(e,t,i)}}},"8e97":function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return o})),i.d(t,"c",(function(){return s})),i.d(t,"d",(function(){return l})),i.d(t,"e",(function(){return c})),i.d(t,"f",(function(){return d}));var r=i("d791"),n=i("970c");function a(e,t,i){e.setUniform3f("camPos",i[3]-t[0],i[7]-t[1],i[11]-t[2])}function s(e,t){e.setUniformMatrix4fv("proj",t)}function o(e,t){e.setUniform2fv("nearFar",t)}function c(e,t,i){Object(r["b"])(h,i,t),e.setUniform3fv("localOrigin",t),e.setUniformMatrix4fv("view",h)}function l(e,t){c(e,t.origin,t.camera.viewMatrix)}function d(e,t){e.setUniform4fv("viewport",t.camera.fullViewport)}const h=Object(n["a"])()},9250:function(e,t,i){"use strict";i.d(t,"a",(function(){return b})),i.d(t,"b",(function(){return g})),i.d(t,"c",(function(){return O}));var r=i("b2b2"),n=i("d791"),a=i("afe1"),s=i("e431"),o=i("0b2d"),c=i("7577"),l=i("0fc4"),d=i("d18f");class h{constructor(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.store=2}}var u=i("a978"),p=i("89bf"),f=i("b623");const b=1e-5;class m{constructor(e){this.options=new h,this._results=new v,this.transform=new p["a"],this.tolerance=b,this.verticalOffset=null,this._ray=Object(d["c"])(),this._rayEnd=Object(o["f"])(),this._rayBeginTransformed=Object(o["f"])(),this._rayEndTransformed=Object(o["f"])(),this.viewingMode=null==e?1:e}get results(){return this._results}get ray(){return this._ray}get rayBegin(){return this._ray.origin}get rayEnd(){return this._rayEnd}reset(e,t,i){this.resetWithRay(Object(d["f"])(e,t,this._ray),i)}resetWithRay(e,t){this.camera=t,e!==this._ray&&Object(d["b"])(e,this._ray),0!==this.options.verticalOffset?2===this.viewingMode?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,Object(s["i"])(this._rayEnd,this._ray.origin,this._ray.direction),this._results.init(this._ray)}intersect(e=null,t,i,n,a){this.point=t,this.filterPredicate=n,this.tolerance=null==i?b:i;const s=Object(p["d"])(this.verticalOffset);if(Object(r["l"])(e)&&e.length>0){const t=a?e=>{a(e)&&this.intersectObject(e)}:e=>{this.intersectObject(e)};for(const i of e){const e=i.getSpatialQueryAccelerator&&i.getSpatialQueryAccelerator();Object(r["l"])(e)?(Object(r["l"])(s)?e.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,t,s):e.forEachAlongRay(this._ray.origin,this._ray.direction,t),this.options.selectionMode&&this.options.hud&&e.forEachDegenerateObject(t)):i.objects.forAll(e=>t(e))}}this.sortResults()}intersectObject(e){const t=e.geometryRecords;if(!t)return;const i=e.transformation,n=Object(p["d"])(this.verticalOffset);for(const o of t){const{geometry:t,material:c,instanceParameters:l}=o;if(Object(f["d"])(l))continue;const d=t.id;this.transform.setAndInvalidateLazyTransforms(i,o.getShaderTransformation()),Object(s["t"])(this._rayBeginTransformed,this.rayBegin,this.transform.inverse),Object(s["t"])(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const h=this.transform.transform;Object(r["l"])(n)&&(n.objectTransform=this.transform),c.intersect(t,l,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,(t,i,n,s,o,c)=>{if(t>=0){if(Object(r["l"])(this.filterPredicate)&&!this.filterPredicate(this._ray.origin,this._rayEnd,t))return;if(s){if(null==this._results.hud.dist||t<this._results.hud.dist){const r={object:e,geometryId:d,triangleNr:n,center:c};this._results.hud.set(1,r,t,i,a["a"],o)}return}const l=r=>r.set(0,{object:e,geometryId:d,triangleNr:n},t,i,h,o);if((null==this._results.min.drapedLayerOrder||o>=this._results.min.drapedLayerOrder)&&(null==this._results.min.dist||t<this._results.min.dist)&&l(this._results.min),0!==this.options.store&&(null==this._results.max.drapedLayerOrder||o<this._results.max.drapedLayerOrder)&&(null==this._results.max.dist||t>this._results.max.dist)&&l(this._results.max),2===this.options.store){const r=O(this._ray);r.set(0,{object:e,geometryId:d,triangleNr:n},t,i,h),this._results.all.push(r)}}},o.shaderTransformation)}}sortResults(){this._results.all.sort((e,t)=>e.dist!==t.dist?Object(r["v"])(e.dist,0)-Object(r["v"])(t.dist,0):e.drapedLayerOrder!==t.drapedLayerOrder?Object(r["v"])(e.drapedLayerOrder,Number.MAX_VALUE)-Object(r["v"])(t.drapedLayerOrder,Number.MAX_VALUE):Object(r["v"])(t.drapedLayerGraphicOrder,Number.MIN_VALUE)-Object(r["v"])(e.drapedLayerGraphicOrder,Number.MIN_VALUE))}}function g(e){return new m(e)}class v{constructor(){this._min=new y(Object(d["c"])()),this._max=new y(Object(d["c"])()),this._hud=new y(Object(d["c"])()),this._ground=new y(Object(d["c"])())}get min(){return this._min}get max(){return this._max}get hud(){return this._hud}get ground(){return this._ground}init(e){this._min.init(e),this._max.init(e),this._hud.init(e),this._ground.init(e),this.all=[]}}class y{constructor(e){this.intersector=0,this.normal=Object(o["f"])(),this.transformation=Object(a["d"])(),this._ray=Object(d["c"])(),this.init(e)}get ray(){return this._ray}get distanceInRenderSpace(){return Object(r["l"])(this.dist)?(Object(s["h"])(_,this.ray.direction,this.dist),Object(s["s"])(_)):null}getIntersectionPoint(e){return!!Object(u["c"])(this)&&(Object(s["h"])(_,this.ray.direction,this.dist),Object(s["i"])(e,this.ray.origin,_),!0)}getTransformedNormal(e){return Object(s["n"])(x,this.normal),x[3]=0,Object(c["m"])(x,x,this.transformation),Object(s["n"])(e,x),Object(s["u"])(e,e)}init(e){this.dist=null,this.target=null,this.drapedLayerOrder=null,this.drapedLayerGraphicOrder=null,this.intersector=0,Object(d["b"])(e,this._ray)}set(e,t,i,c,l,d,h){this.intersector=e,this.dist=i,Object(s["n"])(this.normal,Object(r["v"])(c,o["b"])),Object(n["d"])(this.transformation,Object(r["v"])(l,a["a"])),this.target=t,this.drapedLayerOrder=d,this.drapedLayerGraphicOrder=h}copy(e){Object(d["b"])(e.ray,this._ray),this.intersector=e.intersector,this.dist=e.dist,this.target=e.target,this.drapedLayerOrder=e.drapedLayerOrder,this.drapedLayerGraphicOrder=e.drapedLayerGraphicOrder,Object(s["n"])(this.normal,e.normal),Object(n["d"])(this.transformation,e.transformation)}}function O(e){return new y(e)}const _=Object(o["f"])(),x=Object(l["e"])()},"92a1":function(e,t,i){"use strict";i.d(t,"a",(function(){return f}));var r=i("b2b2"),n=i("8048"),a=i("d791"),s=i("e431"),o=i("8188"),c=i("5996"),l=i("36cf"),d=i("7289"),h=i("7361"),u=i("84f4"),p=i("ce27");class f{constructor(e,t,i,r){this.viewingMode=e,this.spatialReference=t,this.unitInMeters=i,this.coordinateSystem=r,this._coordinateSystem=Object(l["d"])(r)}set extent(e){e&&Object(l["n"])(this.coordinateSystem,e,this.coordinateSystem)}getAltitude(e){return Object(l["a"])(this.coordinateSystem,e)}setAltitude(e,t,i=e){return Object(l["l"])(this.coordinateSystem,i,t,e)}setAltitudeOfTransformation(e,t){Object(l["m"])(this.coordinateSystem,t,e,t)}worldUpAtPosition(e,t){return Object(l["j"])(this.coordinateSystem,e,t)}worldBasisAtPosition(e,t,i){return Object(l["b"])(this.coordinateSystem,e,t,i)}basisMatrixAtPosition(e,t){const i=this.worldBasisAtPosition(e,0,h["d"].get()),r=this.worldBasisAtPosition(e,1,h["d"].get()),n=this.worldBasisAtPosition(e,2,h["d"].get());return Object(a["t"])(t,i[0],i[1],i[2],0,r[0],r[1],r[2],0,n[0],n[1],n[2],0,0,0,0,1),t}intersectManifoldClosestSilhouette(e,t,i){return Object(l["g"])(this.coordinateSystem,t,this._coordinateSystem),Object(l["i"])(this._coordinateSystem,e,i),i}intersectManifold(e,t,i){Object(l["g"])(this.coordinateSystem,t,this._coordinateSystem);const r=h["d"].get();return Object(l["h"])(this._coordinateSystem,e,r)?Object(s["n"])(i,r):null}intersectInfiniteManifold(e,t,i){if(1===this.viewingMode)return this.intersectManifold(e,t,i);Object(l["g"])(this.coordinateSystem,t,this._coordinateSystem);const r=this._coordinateSystem.value,n=h["d"].get();return Object(d["n"])(r.plane,e,n)?Object(s["n"])(i,n):null}toRenderCoords(e,t,i){return Object(u["a"])(e)?Object(o["t"])(e,t,this.spatialReference):Object(o["y"])(e,t,i,this.spatialReference)}fromRenderCoords(e,t,i=null){return Object(u["a"])(t)?(Object(r["l"])(i)&&(t.spatialReference=i),Object(o["w"])(e,this.spatialReference,t)):t instanceof c["a"]?Object(o["x"])(e,this.spatialReference,t):Object(o["y"])(e,this.spatialReference,t,i)?t:null}static create(e,t){switch(e){case 2:return new f(2,t,Object(n["f"])(t),Object(l["f"])());case 1:return new f(1,t,1,Object(l["e"])(t))}}static renderUnitScaleFactor(e,t){return b(e)/b(t)}}function b(e){if(Object(p["a"])(e,1))return 1;const t=Object(l["k"])(!1,e);return Object(n["f"])(t)}},"94a6":function(e,t,i){"use strict";i.r(t),i.d(t,"fetch",(function(){return C})),i.d(t,"gltfToEngineResources",(function(){return A})),i.d(t,"parseUrl",(function(){return P}));var r=i("49b8"),n=i("b2b2"),a=i("1c92"),s=i("dae5"),o=i("d791"),c=i("afe1"),l=i("e431"),d=i("0b2d"),h=i("4261"),u=i("8190"),p=i("668b"),f=i("e4c1"),b=i("7e2d"),m=i("2b60"),g=i("3c3b"),v=i("087c"),y=i("22f5"),O=i("0278"),_=i("1e2c"),x=i("dbad"),j=i("0613"),w=i("dc56"),S=i("1c20"),T=i("4c96");async function C(e,t){const i=P(Object(r["a"])(e));if("wosr"===i.fileType){const e=await(t.cache?t.cache.loadWOSR(i.url,t):Object(y["a"])(i.url,t)),r=Object(y["b"])(e,t);return{lods:[r],referenceBoundingBox:r.boundingBox,isEsriSymbolResource:!1,isWosr:!0,remove:e.remove}}const a=await(t.cache?t.cache.loadGLTF(i.url,t,t.usePBR):Object(g["a"])(new m["a"](t.streamDataRequester),i.url,t,t.usePBR)),s=Object(n["j"])(a.model.meta,"ESRI_proxyEllipsoid");a.meta.isEsriSymbolResource&&Object(n["l"])(s)&&-1!==a.meta.uri.indexOf("/RealisticTrees/")&&E(a,s);const o=a.meta.isEsriSymbolResource?{usePBR:t.usePBR,isSchematic:!1,treeRendering:a.customMeta.esriTreeRendering,mrrFactors:[0,1,.2]}:{usePBR:t.usePBR,isSchematic:!1,mrrFactors:[0,1,.5]},c={...t.materialParamsMixin,treeRendering:a.customMeta.esriTreeRendering};if(null!=i.specifiedLodIndex){const e=A(a,o,c,i.specifiedLodIndex);let t=e[0].boundingBox;return 0!==i.specifiedLodIndex&&(t=A(a,o,c,0)[0].boundingBox),{lods:e,referenceBoundingBox:t,isEsriSymbolResource:a.meta.isEsriSymbolResource,isWosr:!1,remove:a.remove}}const l=A(a,o,c);return{lods:l,referenceBoundingBox:l[0].boundingBox,isEsriSymbolResource:a.meta.isEsriSymbolResource,isWosr:!1,remove:a.remove}}function P(e){const t=e.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return t?{fileType:"gltf",url:t[1],specifiedLodIndex:null!=t[4]?Number(t[4]):null}:e.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:e,specifiedLodIndex:null}:{fileType:"unknown",url:e,specifiedLodIndex:null}}function A(e,t,i,r){const o=e.model,c=Object(s["b"])(),l=new Array,d=new Map,m=new Map;return o.lods.forEach((e,s)=>{if(void 0!==r&&s!==r)return;const g={name:e.name,stageResources:{textures:new Array,materials:new Array,geometries:new Array},lodThreshold:Object(n["l"])(e.lodThreshold)?e.lodThreshold:null,pivotOffset:[0,0,0],numberOfVertices:0,boundingBox:Object(h["k"])()};l.push(g),e.parts.forEach(e=>{const r=e.material+(e.attributes.normal?"_normal":"")+(e.attributes.color?"_color":"")+(e.attributes.texCoord0?"_texCoord0":"")+(e.attributes.tangent?"_tangent":""),s=o.materials.get(e.material),l=Object(n["l"])(e.attributes.texCoord0),v=Object(n["l"])(e.attributes.normal),y=M(s.alphaMode);if(!d.has(r)){if(l){if(Object(n["l"])(s.textureColor)&&!m.has(s.textureColor)){const e=o.textures.get(s.textureColor),t={...e.parameters,preMultiplyAlpha:1!==y};m.set(s.textureColor,new _["a"](e.data,t))}if(Object(n["l"])(s.textureNormal)&&!m.has(s.textureNormal)){const e=o.textures.get(s.textureNormal);m.set(s.textureNormal,new _["a"](e.data,e.parameters))}if(Object(n["l"])(s.textureOcclusion)&&!m.has(s.textureOcclusion)){const e=o.textures.get(s.textureOcclusion);m.set(s.textureOcclusion,new _["a"](e.data,e.parameters))}if(Object(n["l"])(s.textureEmissive)&&!m.has(s.textureEmissive)){const e=o.textures.get(s.textureEmissive);m.set(s.textureEmissive,new _["a"](e.data,e.parameters))}if(Object(n["l"])(s.textureMetallicRoughness)&&!m.has(s.textureMetallicRoughness)){const e=o.textures.get(s.textureMetallicRoughness);m.set(s.textureMetallicRoughness,new _["a"](e.data,e.parameters))}}const a=s.color[0]**(1/j["a"]),c=s.color[1]**(1/j["a"]),h=s.color[2]**(1/j["a"]),u=s.emissiveFactor[0]**(1/j["a"]),p=s.emissiveFactor[1]**(1/j["a"]),f=s.emissiveFactor[2]**(1/j["a"]),b=Object(n["l"])(s.textureColor)&&l?m.get(s.textureColor):null;d.set(r,new x["a"]({...t,transparent:0===y,textureAlphaMode:y,textureAlphaCutoff:s.alphaCutoff,diffuse:[a,c,h],ambient:[a,c,h],opacity:s.opacity,doubleSided:s.doubleSided,doubleSidedType:"winding-order",cullFace:s.doubleSided?0:2,vertexColors:!!e.attributes.color,vertexTangents:!!e.attributes.tangent,normals:v?"default":"screenDerivative",castShadows:!0,receiveSSAO:!0,textureId:Object(n["l"])(b)?b.id:void 0,colorMixMode:s.colorMixMode,normalTextureId:Object(n["l"])(s.textureNormal)&&l?m.get(s.textureNormal).id:void 0,textureAlphaPremultiplied:Object(n["l"])(b)&&!!b.params.preMultiplyAlpha,occlusionTextureId:Object(n["l"])(s.textureOcclusion)&&l?m.get(s.textureOcclusion).id:void 0,emissiveTextureId:Object(n["l"])(s.textureEmissive)&&l?m.get(s.textureEmissive).id:void 0,metallicRoughnessTextureId:Object(n["l"])(s.textureMetallicRoughness)&&l?m.get(s.textureMetallicRoughness).id:void 0,emissiveFactor:[u,p,f],mrrFactors:[s.metallicFactor,s.roughnessFactor,t.mrrFactors[2]],isSchematic:!1,...i}))}const C=R(e.indices||e.attributes.position.count,e.primitiveType),P=e.attributes.position.count,A=Object(b["a"])(u["u"],P);Object(p["e"])(A,e.attributes.position,e.transform);const E=[["position",{data:A.typedBuffer,size:A.elementCount,exclusive:!0}]],D=[["position",C]];if(Object(n["l"])(e.attributes.normal)){const t=Object(b["a"])(u["u"],P);Object(a["a"])(c,e.transform),Object(p["a"])(t,e.attributes.normal,c),E.push(["normal",{data:t.typedBuffer,size:t.elementCount,exclusive:!0}]),D.push(["normal",C])}if(Object(n["l"])(e.attributes.tangent)){const t=Object(b["a"])(u["C"],P);Object(a["a"])(c,e.transform),Object(f["c"])(t,e.attributes.tangent,c),E.push(["tangent",{data:t.typedBuffer,size:t.elementCount,exclusive:!0}]),D.push(["tangent",C])}if(Object(n["l"])(e.attributes.texCoord0)){const t=Object(b["a"])(u["m"],P);Object(w["b"])(t,e.attributes.texCoord0),E.push(["uv0",{data:t.typedBuffer,size:t.elementCount,exclusive:!0}]),D.push(["uv0",C])}if(Object(n["l"])(e.attributes.color)){const t=Object(b["a"])(u["J"],P);if(4===e.attributes.color.elementCount)e.attributes.color instanceof u["C"]?Object(f["b"])(t,e.attributes.color,255):e.attributes.color instanceof u["J"]?Object(S["a"])(t,e.attributes.color):e.attributes.color instanceof u["H"]&&Object(f["b"])(t,e.attributes.color,1/256);else{Object(S["b"])(t,255,255,255,255);const i=new u["B"](t.buffer,0,4);e.attributes.color instanceof u["u"]?Object(p["d"])(i,e.attributes.color,255):e.attributes.color instanceof u["B"]?Object(T["a"])(i,e.attributes.color):e.attributes.color instanceof u["z"]&&Object(p["d"])(i,e.attributes.color,1/256)}E.push(["color",{data:t.typedBuffer,size:t.elementCount,exclusive:!0}]),D.push(["color",C])}const I=new O["a"](E,D);g.stageResources.geometries.push(I),g.stageResources.materials.push(d.get(r)),l&&(Object(n["l"])(s.textureColor)&&g.stageResources.textures.push(m.get(s.textureColor)),Object(n["l"])(s.textureNormal)&&g.stageResources.textures.push(m.get(s.textureNormal)),Object(n["l"])(s.textureOcclusion)&&g.stageResources.textures.push(m.get(s.textureOcclusion)),Object(n["l"])(s.textureEmissive)&&g.stageResources.textures.push(m.get(s.textureEmissive)),Object(n["l"])(s.textureMetallicRoughness)&&g.stageResources.textures.push(m.get(s.textureMetallicRoughness))),g.numberOfVertices+=P;const F=I.boundingInfo;Object(n["l"])(F)&&(Object(h["r"])(g.boundingBox,F.getBBMin()),Object(h["r"])(g.boundingBox,F.getBBMax()))})}),l}function M(e){switch(e){case"BLEND":return 0;case"MASK":return 2;case"OPAQUE":case null:case void 0:return 1}}function R(e,t){switch(t){case 4:return Object(v["c"])(e);case 5:return Object(v["b"])(e);case 6:return Object(v["a"])(e)}}function E(e,t){for(let i=0;i<e.model.lods.length;++i){const r=e.model.lods[i];e.customMeta.esriTreeRendering=!0;for(const a of r.parts){const r=a.attributes.normal;if(Object(n["k"])(r))return;const s=a.attributes.position,h=s.count,p=Object(d["f"])(),f=Object(d["f"])(),m=Object(d["f"])(),g=Object(b["a"])(u["J"],h),v=Object(b["a"])(u["u"],h),y=Object(o["c"])(Object(c["d"])(),a.transform);for(let n=0;n<h;n++){s.getVec(n,f),r.getVec(n,p),Object(l["t"])(f,f,a.transform),Object(l["m"])(m,f,t.center),Object(l["e"])(m,m,t.radius);const o=m[2],c=Object(l["s"])(m),d=Math.min(.45+.55*c*c,1);Object(l["e"])(m,m,t.radius),Object(l["t"])(m,m,y),Object(l["u"])(m,m),i+1!==e.model.lods.length&&e.model.lods.length>1&&Object(l["l"])(m,m,p,o>-1?.2:Math.min(-4*o-3.8,1)),v.setVec(n,m),g.set(n,0,255*d),g.set(n,1,255*d),g.set(n,2,255*d),g.set(n,3,255)}a.attributes.normal=v,a.attributes.color=g}}}},9617:function(e,t,i){"use strict";i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return a}));var r=i("d047"),n=i("3886");function a(e){e.include(r["a"]),e.uniforms.add("geometryDepthTexture","sampler2D"),e.uniforms.add("cameraNearFar","vec2"),e.code.add(n["a"]`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos, cameraNearFar);
return (elementDepth < (geometryDepth - 1.0));
}`)}function s(e,t){t.multipassGeometryEnabled&&t.geometryLinearDepthTexture&&e.bindTexture(t.geometryLinearDepthTexture,"geometryDepthTexture")}},9651:function(e,t,i){"use strict";i.d(t,"a",(function(){return S}));var r,n=i("a4ee"),a=i("2eab"),s=i("fc29"),o=i("ce50"),c=i("9096"),l=i("e92d"),d=i("c24e"),h=i("8a44"),u=i("f4cc"),p=i("5815"),f=i("e041"),b=i("3795"),m=i("59b2"),g=i("b50f"),v=(i("c120"),i("1a3e")),y=i("d386"),O=i("7ffa");class _{constructor(){this.location={left:0,top:0,width:0,height:0},this._allAvailability="unknown",this.byteSize=40}getAvailability(e,t){if("unknown"!==this._allAvailability)return this._allAvailability;const i=(e-this.location.top)*this.location.width+(t-this.location.left),r=i%8,n=i>>3,a=this._tileAvailabilityBitSet;return n<0||n>a.length?"unknown":a[n]&1<<r?"available":"unavailable"}_updateFromData(e){const t=this.location.width,i=this.location.height;let r=!0,n=!0;const a=Math.ceil(t*i/8),s=new Uint8Array(a);let o=0;for(let c=0;c<e.length;c++){const t=c%8;e[c]?(n=!1,s[o]|=1<<t):r=!1,7===t&&++o}n?this._allAvailability="unavailable":r?this._allAvailability="available":(this._allAvailability="unknown",this._tileAvailabilityBitSet=s,this.byteSize+=s.length)}static fromDefinition(e,t){const i=e.service.request||a["default"],{row:r,col:n,width:s,height:c}=e,l={query:{f:"json"}};return t=t?{...l,...t}:l,i(j(e),t).then(e=>e.data).catch(e=>{if(e&&e.details&&422===e.details.httpStatus)return{location:{top:r,left:n,width:s,height:c},valid:!0,data:Object(g["c"])(s*c,0)};throw e}).then(e=>{if(e.location&&(e.location.top!==r||e.location.left!==n||e.location.width!==s||e.location.height!==c))throw new o["a"]("tilemap:location-mismatch","Tilemap response for different location than requested",{response:e,definition:{top:r,left:n,width:s,height:c}});return _.fromJSON(e)})}static fromJSON(e){_.validateJSON(e);const t=new _;return t.location=Object.freeze(Object(O["a"])(e.location)),t._updateFromData(e.data),Object.freeze(t)}static validateJSON(e){if(!e||!e.location)throw new o["a"]("tilemap:missing-location","Location missing from tilemap response");if(!1===e.valid)throw new o["a"]("tilemap:invalid","Tilemap response was marked as invalid");if(!e.data)throw new o["a"]("tilemap:missing-data","Data missing from tilemap response");if(!Array.isArray(e.data))throw new o["a"]("tilemap:data-mismatch","Data must be an array of numbers");if(e.data.length!==e.location.width*e.location.height)throw new o["a"]("tilemap:data-mismatch","Number of data items does not match width/height of tilemap")}}function x(e){return`${e.level}/${e.row}/${e.col}/${e.width}/${e.height}`}function j(e){let t;if("vector-tile"===e.service.type)t=`${e.service.url}/tilemap/${e.level}/${e.row}/${e.col}/${e.width}/${e.height}`;else{const i=e.service.tileServers;t=`${i&&i.length?i[e.row%i.length]:e.service.url}/tilemap/${e.level}/${e.row}/${e.col}/${e.width}/${e.height}`}const i=e.service.query;return i&&(t=`${t}?${i}`),t}const w=l["a"].getLogger("esri.layers.support.TilemapCache");let S=r=class extends(Object(c["b"])(s["a"])){constructor(e){super(e),this._pendingTilemapRequests={},this._availableLevels={},this.levels=5,this.cacheByteSize=2097152,this.request=a["default"],this._prefetchingEnabled=!0}initialize(){this._tilemapCache=new d["a"](this.cacheByteSize),this.handles.add([this.watch(["layer.parsedUrl","layer.tileServers?","layer.apiKey?","layer.customParameters?"],()=>this._initializeTilemapDefinition()),Object(b["a"])(this,"layer.tileInfo.lods",e=>this._initializeAvailableLevels(e),!0)]),this._initializeTilemapDefinition()}castLevels(e){return e<=2?(w.error("Minimum levels for Tilemap is 3, but got ",e),3):e}get size(){return 1<<this.levels}fetchTilemap(e,t,i,r){if(!this._availableLevels[e])return Promise.reject(new o["a"]("tilemap-cache:level-unavailable",`Level ${e} is unavailable in the service`));const n=this._tmpTilemapDefinition,a=this._tilemapFromCache(e,t,i,n);if(a)return Promise.resolve(a);const s=r&&r.signal;return r={...r,signal:null},new Promise((e,t)=>{Object(u["r"])(s,()=>t(Object(u["e"])()));const i=x(n);let a=this._pendingTilemapRequests[i];if(!a){a=_.fromDefinition(n,r).then(e=>(this._tilemapCache.put(i,e,e.byteSize),e));const e=()=>delete this._pendingTilemapRequests[i];this._pendingTilemapRequests[i]=a,a.then(e,e)}a.then(e,t)})}getAvailability(e,t,i){if(!this._availableLevels[e])return"unavailable";const r=this._tilemapFromCache(e,t,i,this._tmpTilemapDefinition);return r?r.getAvailability(t,i):"unknown"}fetchAvailability(e,t,i,r){return this._availableLevels[e]?this.fetchTilemap(e,t,i,r).catch(e=>e).then(r=>{if(r instanceof _){const n=r.getAvailability(t,i);return"unavailable"===n?Promise.reject(new o["a"]("tile-map:tile-unavailable","Tile is not available",{level:e,row:t,col:i})):n}if(Object(u["m"])(r))throw r;return"unknown"}):Promise.reject(new o["a"]("tilemap-cache:level-unavailable",`Level ${e} is unavailable in the service`))}fetchAvailabilityUpsample(e,t,i,r,n){r.level=e,r.row=t,r.col=i;const a=this.layer.tileInfo;a.updateTileInfo(r);const s=this.fetchAvailability(e,t,i,n).catch(e=>{if(Object(u["m"])(e))throw e;if(a.upsampleTile(r))return this.fetchAvailabilityUpsample(r.level,r.row,r.col,r);throw e});return this._fetchAvailabilityUpsamplePrefetch(r.id,e,t,i,n,s),s}async _fetchAvailabilityUpsamplePrefetch(e,t,i,n,a,s){if(!this._prefetchingEnabled)return;const o="prefetch-"+e;if(this.handles.has(o))return;const c=new AbortController;s.then(()=>c.abort(),()=>c.abort());let l=!1;const d={remove(){l||(l=!0,c.abort())}};if(this.handles.add(d,o),await Object(p["d"])(10,c.signal).catch(()=>{}),l||(l=!0,this.handles.remove(o)),Object(u["n"])(c))return;const h={id:e,level:t,row:i,col:n},f={...a,signal:c.signal},b=this.layer.tileInfo;for(let u=0;r._prefetches.length<r._maxPrefetch&&b.upsampleTile(h);++u){const e=this.fetchAvailability(h.level,h.row,h.col,f);r._prefetches.push(e);const t=()=>{r._prefetches.removeUnordered(e)};e.then(t,t)}}_initializeTilemapDefinition(){var e;if(!this.layer.parsedUrl)return;const{parsedUrl:t,apiKey:i,customParameters:r}=this.layer;this._tilemapCache.clear(),this._tmpTilemapDefinition={service:{url:t.path,query:Object(f["E"])({...t.query,...r,token:null!=i?i:null==(e=t.query)?void 0:e.token}),tileServers:this.layer.tileServers,request:this.request,type:this.layer.type},width:this.size,height:this.size,level:0,row:0,col:0}}_tilemapFromCache(e,t,i,r){r.level=e,r.row=t-t%this.size,r.col=i-i%this.size;const n=x(r);return this._tilemapCache.get(n)}_initializeAvailableLevels(e){this._availableLevels={},e&&e.forEach(e=>this._availableLevels[e.level]=!0)}get test(){const e=this;return{get prefetchingEnabled(){return e._prefetchingEnabled},set prefetchingEnabled(t){e._prefetchingEnabled=t},hasTilemap:(t,i,r)=>!!e._tilemapFromCache(t,i,r,e._tmpTilemapDefinition)}}};S._maxPrefetch=4,S._prefetches=new h["a"]({initialSize:r._maxPrefetch}),Object(n["a"])([Object(m["b"])({constructOnly:!0,type:Number})],S.prototype,"levels",void 0),Object(n["a"])([Object(v["a"])("levels")],S.prototype,"castLevels",null),Object(n["a"])([Object(m["b"])({readOnly:!0,type:Number})],S.prototype,"size",null),Object(n["a"])([Object(m["b"])({constructOnly:!0,type:Number})],S.prototype,"cacheByteSize",void 0),Object(n["a"])([Object(m["b"])({constructOnly:!0})],S.prototype,"layer",void 0),Object(n["a"])([Object(m["b"])({constructOnly:!0})],S.prototype,"request",void 0),S=r=Object(n["a"])([Object(y["a"])("esri.layers.support.TilemapCache")],S)},9714:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i("7b7d"),n=i("0646");class a{constructor(e,t){this.owner=t,this.properties={},this.afterDispatchHandle=null;for(const i in e){const t=e[i],n=new r["a"](t,null,null,2,2);this.properties[i]={pool:n,acquired:[]}}this.afterDispatchHandle=Object(n["a"])(()=>this.release())}destroy(){this.afterDispatchHandle&&(this.afterDispatchHandle.remove(),this.afterDispatchHandle=null);for(const e in this.properties){const t=this.properties[e];for(const e of t.acquired)Object(n["b"])(e)||t.pool.release(e);t.pool.destroy(),t.pool=null,t.acquired=null}this.properties=null,this.owner=null}get(e){const t=this.owner._get(e),i=this.properties[e];let r=i.pool.acquire();for(i.acquired.push(r);r===t;)i.acquired.push(r),r=i.pool.acquire();return r}release(){for(const e in this.properties){const t=this.properties[e];let i=0;for(const e of t.acquired)Object(n["b"])(e)?t.acquired[i++]=e:t.pool.release(e);t.acquired.length=i}}}},9812:function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var r,n,a,s={exports:{}};r=s,n=function(){function e(e,i,n){n=n||2;var a,s,o,l,d,h,u,p=i&&i.length,f=p?i[0]*n:e.length,b=t(e,0,f,n,!0),m=[];if(!b||b.next===b.prev)return m;if(p&&(b=c(e,i,b,n)),e.length>80*n){a=o=e[0],s=l=e[1];for(var g=n;g<f;g+=n)(d=e[g])<a&&(a=d),(h=e[g+1])<s&&(s=h),d>o&&(o=d),h>l&&(l=h);u=0!==(u=Math.max(o-a,l-s))?1/u:0}return r(b,m,n,a,s,u),m}function t(e,t,i,r,n){var a,s;if(n===E(e,t,i,r)>0)for(a=t;a<i;a+=r)s=A(a,e[a],e[a+1],s);else for(a=i-r;a>=t;a-=r)s=A(a,e[a],e[a+1],s);if(s&&_(s,s.next)){var o=s.next;M(s),s=o}return s}function i(e,t){if(!e)return e;t||(t=e);var i,r=e;do{if(i=!1,r.steiner||!_(r,r.next)&&0!==O(r.prev,r,r.next))r=r.next;else{var n=r.prev;if(M(r),(r=t=n)===r.next)break;i=!0}}while(i||r!==t);return t}function r(e,t,c,l,d,h,u){if(e){!u&&h&&f(e,l,d,h);for(var p,b,m=e;e.prev!==e.next;)if(p=e.prev,b=e.next,h?a(e,l,d,h):n(e))t.push(p.i/c),t.push(e.i/c),t.push(b.i/c),M(e),e=b.next,m=b.next;else if((e=b)===m){u?1===u?r(e=s(i(e),t,c),t,c,l,d,h,2):2===u&&o(e,t,c,l,d,h):r(i(e),t,c,l,d,h,1);break}}}function n(e){var t=e.prev,i=e,r=e.next;if(O(t,i,r)>=0)return!1;for(var n=e.next.next;n!==e.prev;){if(v(t.x,t.y,i.x,i.y,r.x,r.y,n.x,n.y)&&O(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function a(e,t,i,r){var n=e.prev,a=e,s=e.next;if(O(n,a,s)>=0)return!1;for(var o=n.x<a.x?n.x<s.x?n.x:s.x:a.x<s.x?a.x:s.x,c=n.y<a.y?n.y<s.y?n.y:s.y:a.y<s.y?a.y:s.y,l=n.x>a.x?n.x>s.x?n.x:s.x:a.x>s.x?a.x:s.x,d=n.y>a.y?n.y>s.y?n.y:s.y:a.y>s.y?a.y:s.y,h=m(o,c,t,i,r),u=m(l,d,t,i,r),p=e.prevZ,f=e.nextZ;p&&p.z>=h&&f&&f.z<=u;){if(p!==e.prev&&p!==e.next&&v(n.x,n.y,a.x,a.y,s.x,s.y,p.x,p.y)&&O(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,f!==e.prev&&f!==e.next&&v(n.x,n.y,a.x,a.y,s.x,s.y,f.x,f.y)&&O(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;p&&p.z>=h;){if(p!==e.prev&&p!==e.next&&v(n.x,n.y,a.x,a.y,s.x,s.y,p.x,p.y)&&O(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;f&&f.z<=u;){if(f!==e.prev&&f!==e.next&&v(n.x,n.y,a.x,a.y,s.x,s.y,f.x,f.y)&&O(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function s(e,t,r){var n=e;do{var a=n.prev,s=n.next.next;!_(a,s)&&x(a,n,n.next,s)&&T(a,s)&&T(s,a)&&(t.push(a.i/r),t.push(n.i/r),t.push(s.i/r),M(n),M(n.next),n=e=s),n=n.next}while(n!==e);return i(n)}function o(e,t,n,a,s,o){var c=e;do{for(var l=c.next.next;l!==c.prev;){if(c.i!==l.i&&y(c,l)){var d=P(c,l);return c=i(c,c.next),d=i(d,d.next),r(c,t,n,a,s,o),void r(d,t,n,a,s,o)}l=l.next}c=c.next}while(c!==e)}function c(e,r,n,a){var s,o,c,d=[];for(s=0,o=r.length;s<o;s++)(c=t(e,r[s]*a,s<o-1?r[s+1]*a:e.length,a,!1))===c.next&&(c.steiner=!0),d.push(g(c));for(d.sort(l),s=0;s<d.length;s++)n=i(n=h(d[s],n),n.next);return n}function l(e,t){return e.x-t.x}function d(e){if(e.next.prev===e)return e;let t=e;for(;;){const i=t.next;if(i.prev===t||i===t||i===e)break;t=i}return t}function h(e,t){var r=u(e,t);if(!r)return t;var n=P(r,e),a=i(r,r.next);let s=d(n);return i(s,s.next),a=d(a),d(t===r?a:t)}function u(e,t){var i,r=t,n=e.x,a=e.y,s=-1/0;do{if(a<=r.y&&a>=r.next.y&&r.next.y!==r.y){var o=r.x+(a-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(o<=n&&o>s){if(s=o,o===n){if(a===r.y)return r;if(a===r.next.y)return r.next}i=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!i)return null;if(n===s)return i;var c,l=i,d=i.x,h=i.y,u=1/0;r=i;do{n>=r.x&&r.x>=d&&n!==r.x&&v(a<h?n:s,a,d,h,a<h?s:n,a,r.x,r.y)&&(c=Math.abs(a-r.y)/(n-r.x),T(r,e)&&(c<u||c===u&&(r.x>i.x||r.x===i.x&&p(i,r)))&&(i=r,u=c)),r=r.next}while(r!==l);return i}function p(e,t){return O(e.prev,e,t.prev)<0&&O(t.next,e,e.next)<0}function f(e,t,i,r){var n=e;do{if(null===n.z&&(n.z=m(n.x,n.y,t,i,r)),n.prev.next!==n||n.next.prev!==n)return n.prev.next=n,n.next.prev=n,f(e,t,i,r);n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==e);n.prevZ.nextZ=null,n.prevZ=null,b(n)}function b(e){var t,i,r,n,a,s,o,c,l=1;do{for(i=e,e=null,a=null,s=0;i;){for(s++,r=i,o=0,t=0;t<l&&(o++,r=r.nextZ);t++);for(c=l;o>0||c>0&&r;)0!==o&&(0===c||!r||i.z<=r.z)?(n=i,i=i.nextZ,o--):(n=r,r=r.nextZ,c--),a?a.nextZ=n:e=n,n.prevZ=a,a=n;i=r}a.nextZ=null,l*=2}while(s>1);return e}function m(e,t,i,r,n){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*n)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*n)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function g(e){var t=e,i=e;do{(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next}while(t!==e);return i}function v(e,t,i,r,n,a,s,o){return(n-s)*(t-o)-(e-s)*(a-o)>=0&&(e-s)*(r-o)-(i-s)*(t-o)>=0&&(i-s)*(a-o)-(n-s)*(r-o)>=0}function y(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!S(e,t)&&(T(e,t)&&T(t,e)&&C(e,t)&&(O(e.prev,e,t.prev)||O(e,t.prev,t))||_(e,t)&&O(e.prev,e,e.next)>0&&O(t.prev,t,t.next)>0)}function O(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function _(e,t){return e.x===t.x&&e.y===t.y}function x(e,t,i,r){var n=w(O(e,t,i)),a=w(O(e,t,r)),s=w(O(i,r,e)),o=w(O(i,r,t));return n!==a&&s!==o||!(0!==n||!j(e,i,t))||!(0!==a||!j(e,r,t))||!(0!==s||!j(i,e,r))||!(0!==o||!j(i,t,r))}function j(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function w(e){return e>0?1:e<0?-1:0}function S(e,t){var i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&x(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}function T(e,t){return O(e.prev,e,e.next)<0?O(e,t,e.next)>=0&&O(e,e.prev,t)>=0:O(e,t,e.prev)<0||O(e,e.next,t)<0}function C(e,t){var i=e,r=!1,n=(e.x+t.x)/2,a=(e.y+t.y)/2;do{i.y>a!=i.next.y>a&&i.next.y!==i.y&&n<(i.next.x-i.x)*(a-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next}while(i!==e);return r}function P(e,t){var i=new R(e.i,e.x,e.y),r=new R(t.i,t.x,t.y),n=e.next,a=t.prev;return e.next=t,t.prev=e,i.next=n,n.prev=i,r.next=i,i.prev=r,a.next=r,r.prev=a,r}function A(e,t,i,r){var n=new R(e,t,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function M(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function R(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function E(e,t,i,r){for(var n=0,a=t,s=i-r;a<i;a+=r)n+=(e[s]-e[a])*(e[a+1]+e[s+1]),s=a;return n}return e.deviation=function(e,t,i,r){var n=t&&t.length,a=n?t[0]*i:e.length,s=Math.abs(E(e,0,a,i));if(n)for(var o=0,c=t.length;o<c;o++){var l=t[o]*i,d=o<c-1?t[o+1]*i:e.length;s-=Math.abs(E(e,l,d,i))}var h=0;for(o=0;o<r.length;o+=3){var u=r[o]*i,p=r[o+1]*i,f=r[o+2]*i;h+=Math.abs((e[u]-e[f])*(e[p+1]-e[u+1])-(e[u]-e[p])*(e[f+1]-e[u+1]))}return 0===s&&0===h?0:Math.abs((h-s)/s)},e.flatten=function(e){for(var t=e[0][0].length,i={vertices:[],holes:[],dimensions:t},r=0,n=0;n<e.length;n++){for(var a=0;a<e[n].length;a++)for(var s=0;s<t;s++)i.vertices.push(e[n][a][s]);n>0&&(r+=e[n-1].length,i.holes.push(r))}return i},e},void 0!==(a=n())&&(r.exports=a);const o=s.exports},9990:function(e,t,i){"use strict";i.d(t,"a",(function(){return l})),i.d(t,"b",(function(){return h})),i.d(t,"c",(function(){return c})),i.d(t,"d",(function(){return d}));var r=i("b2b2"),n=i("a915"),a=i("3349"),s=i("e431"),o=i("7361");function c(e,t,i){return l(e,e.screenToRender(t,Object(n["b"])(o["d"].get())),i)}function l(e,t,i){const c=Object(n["b"])(Object(a["c"])(o["d"].get(),t));if(c[2]=0,!e.unprojectFromRenderScreen(c,i.origin))return null;const l=Object(n["b"])(Object(a["c"])(o["d"].get(),t));l[2]=1;const d=e.unprojectFromRenderScreen(l,o["d"].get());return Object(r["k"])(d)?null:(Object(s["m"])(i.direction,d,i.origin),i)}function d(e,t,i){return h(e,e.screenToRender(t,Object(n["b"])(o["d"].get())),i)}function h(e,t,i){Object(s["n"])(i.origin,e.eye);const n=Object(s["z"])(o["d"].get(),t[0],t[1],1),a=e.unprojectFromRenderScreen(n,o["d"].get());return Object(r["k"])(a)?null:(Object(s["m"])(i.direction,a,i.origin),i)}},"99af":function(e,t,i){"use strict";var r=i("23e7"),n=i("d039"),a=i("e8b5"),s=i("861d"),o=i("7b0b"),c=i("50c4"),l=i("8418"),d=i("65f0"),h=i("1dde"),u=i("b622"),p=i("2d00"),f=u("isConcatSpreadable"),b=9007199254740991,m="Maximum allowed index exceeded",g=p>=51||!n((function(){var e=[];return e[f]=!1,e.concat()[0]!==e})),v=h("concat"),y=function(e){if(!s(e))return!1;var t=e[f];return void 0!==t?!!t:a(e)},O=!g||!v;r({target:"Array",proto:!0,forced:O},{concat:function(e){var t,i,r,n,a,s=o(this),h=d(s,0),u=0;for(t=-1,r=arguments.length;t<r;t++)if(a=-1===t?s:arguments[t],y(a)){if(n=c(a.length),u+n>b)throw TypeError(m);for(i=0;i<n;i++,u++)i in a&&l(h,u,a[i])}else{if(u>=b)throw TypeError(m);l(h,u++,a)}return h.length=u,h}})},"9a68":function(e,t,i){"use strict";i.d(t,"a",(function(){return f})),i.d(t,"b",(function(){return m})),i.d(t,"c",(function(){return b}));var r=i("d272"),n=i("e6aa"),a=i("c2d1"),s=i("d047"),o=i("6750"),c=i("c6d7"),l=i("c51b"),d=i("ebd5"),h=i("4377"),u=i("3886"),p=i("690a");const f=1;function b(e){const t=new p["a"],i=e.stippleEnabled&&e.roundCaps,b=e.falloffEnabled||i,m=e.innerColorEnabled,g=e.stippleEnabled&&e.stippleScaleWithLineWidth||e.roundCaps,v=e.stippleEnabled&&e.stippleScaleWithLineWidth;return t.extensions.add("GL_OES_standard_derivatives"),t.include(l["a"]),t.include(n["a"],e),t.include(o["a"],{...e,stippleRequiresStretchMeasure:i}),1===e.output&&t.include(a["a"],e),t.vertex.uniforms.add("proj","mat4").add("view","mat4").add("cameraNearFar","vec2").add("pixelRatio","float").add("miterLimit","float").add("screenSize","vec2"),t.attributes.add("position","vec3"),t.attributes.add("subdivisionFactor","float"),t.attributes.add("uv0","vec2"),t.attributes.add("auxpos1","vec3"),t.attributes.add("auxpos2","vec3"),t.varyings.add("vColor","vec4"),t.varyings.add("vpos","vec3"),t.varyings.add("linearDepth","float"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),g&&t.varyings.add("vLineWidth","float"),v&&t.varyings.add("vLineSizeInv","float"),m&&t.varyings.add("vLineDistance","float"),b&&t.varyings.add("vLineDistanceNorm","float"),e.falloffEnabled&&t.fragment.uniforms.add("falloff","float"),e.innerColorEnabled&&(t.fragment.uniforms.add("innerColor","vec4"),t.fragment.uniforms.add("innerWidth","float")),e.roundCaps&&t.varyings.add("vCapPosition","vec2"),i&&t.varyings.add("vStipplePatternStretch","float"),t.vertex.code.add(u["a"]`#define PERPENDICULAR(v) vec2(v.y, -v.x);
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}
vec2 rotate(vec2 v, float a) {
float s = sin(a);
float c = cos(a);
mat2 m = mat2(c, -s, s, c);
return m * v;
}`),t.vertex.code.add(u["a"]`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= screenSize / posNdc.w;
return posNdc;
}`),t.vertex.code.add(u["a"]`
    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {
      float vnp = cameraNearFar[0] * 0.99;

      //current pos behind ncp --> we need to clip
      if(pos.z > -cameraNearFar[0]) {
        if (!isStartVertex) {
          //previous in front of ncp
          if(prev.z < -cameraNearFar[0]) {
            pos = mix(prev, pos, interp(vnp, prev, pos));
            next = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
        //next in front of ncp
        if(isStartVertex) {
          if(next.z < -cameraNearFar[0]) {
            pos = mix(pos, next, interp(vnp, pos, next));
            prev = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
      } else {
        //current position visible
        //previous behind ncp
        if (prev.z > -cameraNearFar[0]) {
          prev = mix(pos, prev, interp(vnp, pos, prev));
        }
        //next behind ncp
        if (next.z > -cameraNearFar[0]) {
          next = mix(next, pos, interp(vnp, next, pos));
        }
      }

      ${e.multipassTerrainEnabled?"depth = pos.z;":""}
      linearDepth = (-pos.z - cameraNearFar[0]) / (cameraNearFar[1] - cameraNearFar[0]);

      pos = projectAndScale(pos);
      next = projectAndScale(next);
      prev = projectAndScale(prev);
    }
`),t.vertex.code.add(u["a"]`
  void main(void) {
    // unpack values from uv0.y
    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;

    float coverage = 1.0;
    vpos = position;

    // Check for special value of uv0.y which is used by the Renderer when graphics
    // are removed before the VBO is recompacted. If this is the case, then we just
    // project outside of clip space.
    if (uv0.y == 0.0) {
      // Project out of clip space
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
    }
    else {
      bool isJoin = abs(uv0.y) < 3.0;

      float lineSize = getSize();
      float lineWidth = lineSize * pixelRatio;

      ${g?u["a"]`vLineWidth = lineWidth;`:""}
      ${v?u["a"]`vLineSizeInv = 1.0 / lineSize;`:""}

      // convert sub-pixel coverage to alpha
      if (lineWidth < 1.0) {
        coverage = lineWidth;
        lineWidth = 1.0;
      }else{
        // Ribbon lines cannot properly render non-integer sizes. Round width to integer size if
        // larger than one for better quality. Note that we do render < 1 pixels more or less correctly
        // so we only really care to round anything larger than 1.
        lineWidth = floor(lineWidth + 0.5);
      }

      vec4 pos  = view * vec4(position.xyz, 1.0);
      vec4 prev = view * vec4(auxpos1.xyz, 1.0);
      vec4 next = view * vec4(auxpos2.xyz, 1.0);

      clipAndTransform(pos, prev, next, isStartVertex);

      vec2 left = (pos.xy - prev.xy);
      vec2 right = (next.xy - pos.xy);

      float leftLen = length(left);
      float rightLen = length(right);
  `),e.stippleEnabled&&t.vertex.code.add(u["a"]`float isEndVertex = float(!isStartVertex);
vec4 segmentInfo = mix(vec4(pos.xy, right), vec4(prev.xy, left), isEndVertex);
vec2 segmentOrigin = segmentInfo.xy;
vec2 segment = segmentInfo.zw;`),t.vertex.code.add(u["a"]`left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);
vec2 capDisplacementDir = vec2(0, 0);
vec2 joinDisplacementDir = vec2(0, 0);
float displacementLen = lineWidth;
if (isJoin) {
bool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;
joinDisplacementDir = normalize(left + right);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
if (leftLen > 0.001 && rightLen > 0.001) {
float nDotSeg = dot(joinDisplacementDir, left);
displacementLen /= length(nDotSeg * left - joinDisplacementDir);
if (!isOutside) {
displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
}
}
if (isOutside && (displacementLen > miterLimit * lineWidth)) {`),e.roundJoins?t.vertex.code.add(u["a"]`
        vec2 startDir;
        vec2 endDir;

        if (leftLen < 0.001) {
          startDir = right;
        }
        else{
          startDir = left;
        }
        startDir = normalize(startDir);
        startDir = PERPENDICULAR(startDir);

        if (rightLen < 0.001) {
          endDir = left;
        }
        else{
          endDir = right;
        }
        endDir = normalize(endDir);
        endDir = PERPENDICULAR(endDir);

        float factor = ${e.stippleEnabled?u["a"]`min(1.0, subdivisionFactor * ${u["a"].float((f+2)/(f+1))})`:u["a"]`subdivisionFactor`};

        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);
      `):t.vertex.code.add(u["a"]`if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;
}
joinDisplacementDir = normalize(joinDisplacementDir);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);`),t.vertex.code.add(u["a"]`displacementLen = lineWidth;
}
} else {
if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = isStartVertex ? right : left;
}
joinDisplacementDir = normalize(joinDisplacementDir);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
displacementLen = lineWidth;
capDisplacementDir = isStartVertex ? -right : left;
capDisplacementDir *= subdivisionFactor;
}`),t.vertex.code.add(u["a"]`
    // Displacement (in pixels) caused by join/or cap
    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;

    ${b||m?u["a"]`float lineDistNorm = sign(uv0.y) * pos.w;`:""}

    ${m?u["a"]`vLineDistance = lineWidth * lineDistNorm;`:""}
    ${b?u["a"]`vLineDistanceNorm = lineDistNorm;`:""}

    ${e.roundCaps?u["a"]`vCapPosition = isJoin ? vec2(0.0) : dpos;`:""}

    pos.xy += dpos;
  `),e.stippleEnabled&&(e.draped||t.vertex.code.add(u["a"]`vec3 segmentCenter = mix((auxpos2 + position) * 0.5, (position + auxpos1) * 0.5, isEndVertex);
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),t.vertex.code.add(u["a"]`float segmentLengthScreenDouble = length(segment);
float segmentLengthScreen = segmentLengthScreenDouble * 0.5;
float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);
float segmentLengthRender = length(mix(auxpos2 - position, position - auxpos1, isEndVertex));`),e.draped?t.vertex.code.add(u["a"]`float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;
float startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);`):t.vertex.code.add(u["a"]`float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),t.vertex.code.add(u["a"]`
      float patternLength = ${e.stippleScaleWithLineWidth?"lineSize * ":""} stipplePatternPixelSize;

      // Compute the coordinates at both start and end of the line segment, because we need both to clamp to in the fragment shader
      // The 0.5 factor on the screen length is to correct for pixel ratio (it is calculated at double resolution)
      ${i?u["a"]`
            vec3 stippleSegmentInfo = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);
            vStippleDistanceLimits = stippleSegmentInfo.xy;
            vStipplePatternStretch = stippleSegmentInfo.z;`:u["a"]`
            vStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);`}

      vStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);

      // Adjust the coordinate to the displaced position (the pattern is shortened/overextended on the in/outside of joins)
      if (segmentLengthScreenDouble >= 0.001) {
        // Project the actual vertex position onto the line segment. Note that the resulting factor is within [0..1] at the
        // original vertex positions, and slightly outside of that range at the displaced positions
        vec2 stippleDisplacement = pos.xy - segmentOrigin;
        float stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);

        // Apply this offset to the actual vertex coordinate (can be screen or pseudo-screen space)
        vStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);
      }

      // Cancel out perspective correct interpolation because we want this length the really represent the screen distance
      vStippleDistanceLimits *= pos.w;
      vStippleDistance *= pos.w;
    `)),t.vertex.code.add(u["a"]`pos.xy = pos.xy / screenSize * pos.w;
vColor = getColor();
vColor.a *= coverage;
gl_Position = pos;
}
}`),e.multipassTerrainEnabled&&(t.fragment.include(s["a"]),t.include(c["b"],e)),t.include(r["a"],e),t.fragment.uniforms.add("intrinsicColor","vec4"),t.fragment.include(h["a"]),t.fragment.code.add(u["a"]`
  void main() {
    discardBySlice(vpos);
    ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
  `),e.roundCaps&&t.fragment.code.add(u["a"]`
    float fragmentRadius = length(vCapPosition);
    float fragmentSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
    float capCoverage = clamp(0.5 - fragmentSDF, 0.0, 1.0);
    if (capCoverage < ${u["a"].float(d["c"])}) {
      discard;
    }
  `),i?t.fragment.code.add(u["a"]`
      vec2 stipplePosition = vec2(
        max(1.0 - getStippleSDF() * 2.0 * vStipplePatternStretch, 0.0),
        vLineDistanceNorm * gl_FragCoord.w
      );
      float stippleRadius = length(stipplePosition * vLineWidth);
      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);
      float stippleAlpha = step(${u["a"].float(d["c"])}, stippleCoverage);
    `):t.fragment.code.add(u["a"]`float stippleAlpha = getStippleAlpha();`),t.fragment.code.add(u["a"]`discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);
vec4 color = intrinsicColor * vColor;`),t.fragment.uniforms.add("pixelRatio","float"),e.innerColorEnabled&&t.fragment.code.add(u["a"]`float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;
float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);`),t.fragment.code.add(u["a"]`vec4 finalColor = blendStipple(color, stippleAlpha);`),e.falloffEnabled&&t.fragment.code.add(u["a"]`finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);`),t.fragment.code.add(u["a"]`
    if (finalColor.a < ${u["a"].float(d["c"])}) {
      discard;
    }

    ${7===e.output?u["a"]`gl_FragColor = vec4(finalColor.a);`:""}
    ${0===e.output?u["a"]`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${0===e.output&&e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
    ${4===e.output?u["a"]`gl_FragColor = vec4(1.0);`:""}
    ${1===e.output?u["a"]`outputDepth(linearDepth);`:""}
  }
  `),t}const m=Object.freeze({__proto__:null,NUM_ROUND_JOIN_SUBDIVISIONS:f,build:b})},"9ac8":function(e,t,i){"use strict";i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return a}));i("c120");var r=i("caf7");function n(e){switch(e){case"sphere":case"cube":case"diamond":case"cylinder":case"cone":case"inverted-cone":case"tetrahedron":return!0}return!1}function a(e,t){const i=(e,i,n=!1)=>({levels:e.map(e=>{const a=i(e.tesselation);return n&&r["a"].cgToGIS(a),{components:[{geometry:a,material:t}],faceCount:a.indexCount/3,minScreenSpaceRadius:e.minScreenSpaceRadius}})});switch(e){case"sphere":return i([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],e=>r["a"].createPolySphereGeometry(.5,e,!0));case"cube":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>r["a"].createBoxGeometry(1));case"cone":return i(s,e=>r["a"].createConeGeometry(1,.5,e,!1),!0);case"inverted-cone":return i(s,e=>r["a"].createConeGeometry(1,.5,e,!0),!0);case"cylinder":return i(s,e=>r["a"].createCylinderGeometry(1,.5,e,[0,0,1],[0,0,.5]));case"tetrahedron":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>r["a"].createTetrahedronGeometry(1),!0);case"diamond":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>r["a"].createDiamondGeometry(1),!0);default:return}}const s=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}]},"9cc4":function(e,t,i){"use strict";function r(e,t,i){for(let r=0;r<i;++r)t[2*r]=e[r],t[2*r+1]=e[r]-t[2*r]}function n(e,t,i,n){for(let o=0;o<n;++o)a[0]=e[o],r(a,s,1),t[o]=s[0],i[o]=s[1]}i.d(t,"a",(function(){return r})),i.d(t,"b",(function(){return n}));const a=new Float64Array(1),s=new Float32Array(2)},"9def":function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("fdc9");function n(e){const t=new Map,i=e=>{let i=t.get(e);return i||(i=new r["b"],t.set(e,i)),i};return e.adds.forAll(e=>{a(e)&&i(e.material).adds.push(e)}),e.removes.forAll(e=>{a(e)&&i(e.material).removes.push(e)}),e.updates.forAll(e=>{a(e.renderGeometry)&&i(e.renderGeometry.material).updates.push(e)}),t}function a(e){return e.data.indexCount>=1}},a03d:function(e,t,i){"use strict";i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return a})),i.d(t,"c",(function(){return l})),i.d(t,"d",(function(){return h})),i.d(t,"e",(function(){return o})),i.d(t,"f",(function(){return u})),i.d(t,"g",(function(){return c})),i.d(t,"h",(function(){return d})),i.d(t,"i",(function(){return p}));var r=i("b2b2"),n=i("8a44");class a{constructor(){this._queue=new n["a"],this._last=null,this.remove=()=>{}}get done(){return 0===this._queue.length&&(!this._last||this._last.isLeaf)}resetOne(e){this._queue.clear(),this._queue.push(e),this._last=null}reset(e=null){this._queue.clear(),Object(r["l"])(e)&&this._queue.pushArray(e),this._last=null}skipSubtree(){this._last=null}next(){return this._last&&!this._last.isLeaf&&this._queue.pushArray(this._last.children),this._last=this._queue.pop(),this._last}}class s{constructor(){this.q=new n["a"]}get done(){return 0===this.q.length}reset(e){if(this.q.clear(),!Object(r["k"])(e)){this.q.pushArray(e);for(let e=0;e<this.q.length;++e){const t=this.q.data[e];t.isLeaf||this.q.pushArray(t.children)}}}next(){return this.q.pop()}}function o(e,t,i){if(Object(r["k"])(t)||Object(r["k"])(t.fullExtent))return!1;const n=t.fullExtent,a=e.extent;if(i){if(a[0]<n.xmin||a[1]<n.ymin||a[2]>n.xmax||a[3]>n.ymax)return!1}else if(n.xmin>a[2]||n.ymin>a[3]||n.xmax<a[0]||n.ymax<a[1])return!1;const s=e.surface.tilingScheme.levels[e.level].scale;return!(t.minScale>0&&s>1.00000001*t.minScale)&&!(t.maxScale>0&&s<.99999999*t.maxScale)}function c(e,t){t.sort((t,i)=>l(t,i,e))}function l(e,t,i){const r=e.screenDepth,n=t.screenDepth;return r<n?-i:r>n?i:0}function d(e,t){const i=new Map;e.forAll(e=>i.set(e,e.distanceToSquared(t))),e.sort((e,t)=>i.get(e)-i.get(t))}function h(e,t,i){let r=1,n=0,a=0;for(;e!==t;)if(r*=.5,n*=.5,a*=.5,1&e.lij[2]&&(n+=.5),0==(1&e.lij[1])&&(a+=.5),null==(e=e.parent))throw new Error("tile was not a descendant of upsampleTile");i.init(t,n,a,r)}function u(e){for(let t=0;t<e.length;t++){const i=e[t],r=i.parent;if(r)for(let e=0;e<4;e++){const t=r.children[e];if(t&&t!==i&&t.loadable)return!0}}return!1}function p(e,t){if(!e||!t||e[0]===t[0])return!1;const i=e[0]<t[0],r=i?e:t,n=i?t:e,a=1<<n[0]-r[0];return Math.floor(n[1]/a)===r[1]&&Math.floor(n[2]/a)===r[2]}},a1b1:function(e,t,i){"use strict";i.d(t,"a",(function(){return c})),i.d(t,"b",(function(){return l})),i.d(t,"c",(function(){return s})),i.d(t,"d",(function(){return o}));var r=i("38a4"),n=i("e431"),a=i("0b2d");function s(e,t,i){const r=Object(n["k"])(e,t)/Object(n["k"])(e,e);return Object(n["h"])(i,e,r)}function o(e,t){return Object(n["k"])(e,t)/Object(n["s"])(e)}function c(e,t){const i=Object(n["k"])(e,t)/(Object(n["s"])(e)*Object(n["s"])(t));return-Object(r["b"])(i)}function l(e,t,i){Object(n["u"])(d,e),Object(n["u"])(h,t);const a=Object(n["k"])(d,h),s=Object(r["b"])(a),o=Object(n["j"])(d,d,h);return Object(n["k"])(o,i)<0?2*Math.PI-s:s}const d=Object(a["f"])(),h=Object(a["f"])()},a1ff:function(e,t,i){"use strict";i.d(t,"a",(function(){return l}));var r=i("38a4"),n=i("b2b2"),a=i("1956"),s=i("d17d"),o=i("c514");const c=4;class l{constructor(e,t,i=null){this._context=e,this.type="texture",this._glName=null,this._descriptor=void 0,this._samplingModeDirty=!1,this._wrapModeDirty=!1,e.instanceCounter.increment(s["c"].Texture,this),this._descriptor={target:3553,samplingMode:9729,wrapMode:10497,flipped:!1,hasMipmap:!1,isOpaque:!1,unpackAlignment:4,preMultiplyAlpha:!1,...t},34067===this._descriptor.target?this.setDataCubeMap(i):this.setData(i)}get glName(){return this._glName}get descriptor(){return this._descriptor}get isDirty(){return this._samplingModeDirty||this._wrapModeDirty}dispose(){this._context.gl&&this._glName&&(this._context.unbindTextureAllUnits(this),this._context.gl.deleteTexture(this._glName),this._glName=null,this._context.instanceCounter.decrement(s["c"].Texture,this))}release(){this.dispose()}resize(e,t){const i=this._descriptor;i.width===e&&i.height===t||(i.width=e,i.height=t,34067===this._descriptor.target?this.setDataCubeMap(null):this.setData(null))}setDataCubeMap(e=null){for(let t=34069;t<=34074;t++)this.setData(e,t)}setData(e,t=3553){if(!this._context||!this._context.gl)return;const i=this._context.gl;this._glName||(this._glName=i.createTexture()),void 0===e&&(e=null),null===e&&(this._descriptor.width=this._descriptor.width||c,this._descriptor.height=this._descriptor.height||c);const r=this._context.bindTexture(this,l.TEXTURE_UNIT_FOR_UPDATES),s=this._descriptor;l._validateTexture(this._context,s),i.pixelStorei(i.UNPACK_ALIGNMENT,s.unpackAlignment),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,s.flipped?1:0),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s.preMultiplyAlpha?1:0);const o=s.pixelFormat;let h=s.internalFormat?s.internalFormat:this._deriveInternalFormat(o,s.dataType);if(e instanceof ImageData||e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement){let r=e.width,n=e.height;e instanceof HTMLVideoElement&&(r=e.videoWidth,n=e.videoHeight),s.width&&s.height,i.texImage2D(t,0,h,o,s.dataType,e),Object(a["a"])(i),s.hasMipmap&&this.generateMipmap(),void 0===s.width&&(s.width=r),void 0===s.height&&(s.height=n)}else{null!=s.width&&null!=s.height||console.error("Width and height must be specified!"),i.DEPTH24_STENCIL8&&h===i.DEPTH_STENCIL&&(h=i.DEPTH24_STENCIL8);let r=s.width,c=s.height;if(d(e)){const n=Math.round(Math.log(Math.max(r,c))/Math.LN2)+1;s.hasMipmap=s.hasMipmap&&n===e.levels.length;for(let a=0;;++a){const n=e.levels[Math.min(a,e.levels.length-1)];if(i.compressedTexImage2D(t,a,h,r,c,0,n),1===r&&1===c||!s.hasMipmap)break;r=Math.max(1,r>>1),c=Math.max(1,c>>1)}}else if(Object(n["l"])(e))i.texImage2D(t,0,h,r,c,0,o,s.dataType,e),Object(a["a"])(i),s.hasMipmap&&this.generateMipmap();else for(let e=0;i.texImage2D(t,e,h,r,c,0,o,s.dataType,null),Object(a["a"])(i),(1!==r||1!==c)&&s.hasMipmap;++e)r=Math.max(1,r>>1),c=Math.max(1,c>>1)}l._applySamplingMode(i,this._descriptor),l._applyWrapMode(i,this._descriptor),l._applyAnisotropicFilteringParameters(this._context,this._descriptor),Object(a["a"])(i),this._context.bindTexture(r,l.TEXTURE_UNIT_FOR_UPDATES)}updateData(e,t,i,r,n,a,s=3553){a||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const o=this._context.gl,c=this._descriptor,d=this._context.bindTexture(this,l.TEXTURE_UNIT_FOR_UPDATES);(t<0||i<0||r>c.width||n>c.height||t+r>c.width||i+n>c.height)&&console.error("An attempt to update out of bounds of the texture!"),o.pixelStorei(o.UNPACK_ALIGNMENT,c.unpackAlignment),o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,c.flipped?1:0),o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,c.preMultiplyAlpha?1:0),a instanceof ImageData||a instanceof HTMLImageElement||a instanceof HTMLCanvasElement||a instanceof HTMLVideoElement?o.texSubImage2D(s,e,t,i,c.pixelFormat,c.dataType,a):o.texSubImage2D(s,e,t,i,r,n,c.pixelFormat,c.dataType,a),this._context.bindTexture(d,l.TEXTURE_UNIT_FOR_UPDATES)}generateMipmap(){const e=this._descriptor;e.hasMipmap||(e.hasMipmap=!0,this._samplingModeDirty=!0,l._validateTexture(this._context,e)),9729===e.samplingMode?(this._samplingModeDirty=!0,e.samplingMode=9985):9728===e.samplingMode&&(this._samplingModeDirty=!0,e.samplingMode=9984);const t=this._context.bindTexture(this,l.TEXTURE_UNIT_FOR_UPDATES);this._context.gl.generateMipmap(e.target),this._context.bindTexture(t,l.TEXTURE_UNIT_FOR_UPDATES)}setSamplingMode(e){e!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=e,this._samplingModeDirty=!0)}setWrapMode(e){e!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=e,l._validateTexture(this._context,this._descriptor),this._wrapModeDirty=!0)}applyChanges(){const e=this._context.gl,t=this._descriptor;this._samplingModeDirty&&(l._applySamplingMode(e,t),this._samplingModeDirty=!1),this._wrapModeDirty&&(l._applyWrapMode(e,t),this._wrapModeDirty=!1)}_deriveInternalFormat(e,t){if("webgl"===this._context.webglVersion)return e;if(5126===t)switch(e){case 6408:return 34836;case 6407:return 34837;default:throw new Error("Unable to derive format")}return e}static _validateTexture(e,t){(t.width<0||t.height<0)&&console.error("Negative dimension parameters are not allowed!");const i=Object(r["k"])(t.width)&&Object(r["k"])(t.height);Object(o["a"])(e.gl)||i||("number"==typeof t.wrapMode?33071!==t.wrapMode&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"):33071===t.wrapMode.s&&33071===t.wrapMode.t||console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),t.hasMipmap&&console.error("Mipmapping requires power-of-two textures!"))}static _applySamplingMode(e,t){let i=t.samplingMode,r=t.samplingMode;9985===i||9987===i?(i=9729,t.hasMipmap||(r=9729)):9984!==i&&9986!==i||(i=9728,t.hasMipmap||(r=9728)),e.texParameteri(t.target,e.TEXTURE_MAG_FILTER,i),e.texParameteri(t.target,e.TEXTURE_MIN_FILTER,r)}static _applyWrapMode(e,t){"number"==typeof t.wrapMode?(e.texParameteri(t.target,e.TEXTURE_WRAP_S,t.wrapMode),e.texParameteri(t.target,e.TEXTURE_WRAP_T,t.wrapMode)):(e.texParameteri(t.target,e.TEXTURE_WRAP_S,t.wrapMode.s),e.texParameteri(t.target,e.TEXTURE_WRAP_T,t.wrapMode.t))}static _applyAnisotropicFilteringParameters(e,t){var i;const r=e.capabilities.textureFilterAnisotropic;r&&e.gl.texParameterf(t.target,r.TEXTURE_MAX_ANISOTROPY,null!=(i=t.maxAnisotropy)?i:1)}}function d(e){return Object(n["l"])(e)&&"type"in e&&"compressed"===e.type}l.TEXTURE_UNIT_FOR_UPDATES=0},a37d:function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var r=i("9ef0"),n=i("b2b2"),a=i("a915"),s=i("0fc4");class o{constructor(e){this.definition=e,this.key=JSON.stringify(e),this.haloSize=Math.round(e.halo.size),this.fillStyle=this.colorToRGBA(e.color),this.haloStyle=this.colorToRGB(e.halo.color)}colorToRGB(e){return`rgb(${e.slice(0,3).map(e=>Math.floor(255*e)).toString()})`}colorToRGBA(e){return`rgba(${e.slice(0,3).map(e=>Math.floor(255*e)).toString()},${e[3]})`}static fromSymbol(e,t=1){const i=Object(n["j"])(e,"material","color"),c=Object(n["l"])(i)?r["a"].toUnitRGBA(i):s["b"],l=e.halo,d=null!=e.size?Object(a["h"])(e.size):12,h={family:e.font&&e.font.family?e.font.family:"sans-serif",weight:e.font&&e.font.weight?e.font.weight:"normal",style:e.font&&e.font.style?e.font.style:"normal"},u=Object(n["l"])(l)&&Object(n["l"])(l.color)&&l.size>0?{size:Object(a["h"])(l.size),color:r["a"].toUnitRGBA(l.color)}:{size:0,color:s["b"]};return new o({size:d,color:c,font:h,halo:u,pixelRatio:t})}}},a571:function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return n}));var r=i("a9ab");function n(e){return{geometryType:Object(r["c"])(e[0]),geometries:e.map(e=>e.toJSON())}}function a(e,t,i){const n=Object(r["b"])(t);return e.map(e=>{const t=n.fromJSON(e);return t.spatialReference=i,t})}},a5b5:function(e,t,i){"use strict";i.d(t,"a",(function(){return r})),i.d(t,"b",(function(){return u})),i.d(t,"c",(function(){return d}));var r,n=i("d272"),a=i("7c1d"),s=i("d0cb"),o=i("9617"),c=i("3886"),l=i("690a");function d(e){const t=new l["a"];return t.include(a["a"]),t.include(s["a"],e),t.include(n["a"],e),t.attributes.add("uv0","vec2"),t.vertex.uniforms.add("lineSize","float").add("pixelToNDC","vec2").add("borderSize","float").add("screenOffset","vec2"),t.varyings.add("coverageSampling","vec4"),t.varyings.add("lineSizes","vec2"),e.multipassGeometryEnabled&&t.varyings.add("depth","float"),t.vertex.code.add(c["a"]`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 endPoint = projectPositionHUD(projectAux);

      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }
    ${e.occlusionTestEnabled?c["a"]`
      if (!testVisibilityHUD(endPoint)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }`:""}

    ${e.screenSizePerspectiveEnabled?c["a"]`
      vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
      vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);
        `:c["a"]`
      vec2 screenOffsetScaled = screenOffset;
        `}
      // Add view dependent polygon offset to get exact same original starting point. This is mostly
      // used to get the correct depth value
      vec3 posView = (view * vec4(position, 1.0)).xyz;
      ${e.multipassGeometryEnabled?"depth = posView.z;":""}

      applyHUDViewDependentPolygonOffset(auxpos1.w, projectAux.absCosAngle, posView);
      vec4 startPoint = proj * vec4(posView, 1.0);
      // Apply screen offset to both start and end point
      vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;
      startPoint.xy += screenOffsetNorm * startPoint.w;
      endPoint.xy += screenOffsetNorm * endPoint.w;
      // Align start and end to pixel origin
      vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);
      vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);
    ${e.depthHudEnabled?e.depthHudAlignStartEnabled?c["a"]`endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);`:c["a"]`startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);`:""}
      vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);
      // The direction of the line in screen space
      vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);
    ${e.screenSizePerspectiveEnabled?c["a"]`
      float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);
      float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);
        `:c["a"]`
      float lineSizeScaled = lineSize;
      float borderSizeScaled = borderSize;
        `}
      float halfPixelSize = lineSizeScaled * 0.5;
      // Calculate a pixel offset from the edge of the pixel, s.t. we keep the line aligned
      // to pixels if it has a full pixel size. Since pixel aligned biases to the bottom-left,
      // we bias the size to the right (for odd sizes) to balance out the bias. Grow sub-pixel
      // sizes towards the left or right s.t. there is a smooth transition (e.g. from 2 to 3 px).
      float halfWholePixelSize = floor(lineSizeScaled) * 0.5;
      float halfPixelSizeInt = floor(halfWholePixelSize);

      // Sub-pixel offset if we need to grow sub-pixels to the left
      float subpixelOffset = -fract(lineSizeScaled) * float(halfWholePixelSize > 0.0);

      // Pixel offset aligning to whole pixels and adding subpixel offset if needed
      float pixelOffset = -halfPixelSizeInt + subpixelOffset;

      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size
      float padding = 1.0 + borderSizeScaled;
      vec2 ndcOffset = (pixelOffset - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;

      // Offset x/y from the center of the line in screen space
      projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;

      // Compute a coverage varying which we can use in the fragment shader to determine
      // how much a pixel is actually covered by the line (i.e. to anti alias the line).
      // This works by computing two coordinates that can be linearly interpolated and then
      // subtracted to find out how far away from the line edge we are.
      float edgeDirection = (uv0.x * 2.0 - 1.0);

      float halfBorderSize = 0.5 * borderSizeScaled;
      float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;
      float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);

      float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);

      coverageSampling = vec4(
        // Edge coordinate
        outerEdgeCoverageSampler,

        // Border edge coordinate
        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,

        // Line offset
        halfPixelSize - 0.5,

        // Border offset
        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)
      );

      lineSizes = vec2(lineSizeScaled, borderSizeScaled);

      gl_Position = projectedPosition;
    }
  `),t.fragment.uniforms.add("color","vec4"),t.fragment.uniforms.add("borderColor","vec4"),e.multipassGeometryEnabled&&(t.fragment.include(o["b"],e),t.fragment.uniforms.add("inverseViewport","vec2")),t.fragment.code.add(c["a"]`
    void main() {
      ${e.multipassGeometryEnabled?"if( geometryDepthTest(gl_FragCoord.xy * inverseViewport, depth) ){ discard; }":""}

      // Mix between line and border coverage offsets depending on whether we need
      // a border (based on the sidedness).
      vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);

      // Mix between border and line color based on the line coverage (conceptually the line
      // blends on top of the border background).
      //
      // Anti-alias by blending final result using the full (including optional border) coverage
      // and the color alpha
      float borderAlpha = color.a * borderColor.a * coverage.y;
      float colorAlpha = color.a * coverage.x;

      float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);

    ${e.depthHudEnabled?c["a"]`
      if (finalAlpha < 0.01) {
        discard;
      }
      `:c["a"]`
      // Compute the finalRgb, but keep it pre-multiplied (for unpre-multiplied you
      // need to divide by finalAlpha). We avoid the division here by setting the
      // appropriate blending function in the material.
      vec3 finalRgb = mix(borderColor.rgb * borderAlpha, color.rgb, colorAlpha);
      gl_FragColor = vec4(finalRgb, finalAlpha);
      `}
  }
  `),t}function h(e,t,i){3===i.length?e.setUniform4f(t,i[0],i[1],i[2],1):e.setUniform4fv(t,i)}!function(e){function t(e,t,i){h(e,"color",t.color),e.setUniform1f("pixelRatio",i),e.setUniform2f("screenOffset",t.screenOffset[0]*i,t.screenOffset[1]*i),null!==t.borderColor?(h(e,"borderColor",t.borderColor),e.setUniform1f("borderSize",i)):(e.setUniform4f("borderColor",0,0,0,0),e.setUniform1f("borderSize",0))}e.bindUniforms=t}(r||(r={}));const u=Object.freeze({__proto__:null,build:d,get LineCallout(){return r}})},a6c9:function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return c})),i.d(t,"c",(function(){return o})),i.d(t,"d",(function(){return s})),i.d(t,"e",(function(){return d})),i.d(t,"f",(function(){return n})),i.d(t,"g",(function(){return l}));i("c120");var r=i("661c");function n(e,t,i){switch(e){case"circle":default:return a(t,i);case"square":return s(t,i);case"cross":return c(t,i);case"x":return l(t,i);case"kite":return o(t,i);case"triangle":return d(t,i)}}function a(e,t){const i=e,n=new Uint8Array(4*i*i),a=i/2-.5,s=t/2;for(let o=0;o<i;o++)for(let t=0;t<i;t++){const c=t+i*o,l=t-a,d=o-a;let h=Math.sqrt(l*l+d*d)-s;h=h/e+.5,Object(r["a"])(h,n,4*c)}return n}function s(e,t){return h(e,t,!1)}function o(e,t){return h(e,t,!0)}function c(e,t){return u(e,t,!1)}function l(e,t){return u(e,t,!0)}function d(e,t){const i=new Uint8Array(4*e*e),n=1,a=-.5,s=Math.sqrt(n*n+a*a),o=(e-t)/2;for(let c=0;c<e;c++)for(let l=0;l<e;l++){const d=c*e+l,h=(l-o)/t,u=(c-o+.75)/t,p=-(n*h+a*u)/s,f=(n*(h-1)+a*-u)/s,b=-u,m=Math.max(p,f,b);Object(r["a"])(m*t/e+.5,i,4*d)}return i}function h(e,t,i){i&&(t/=Math.SQRT2);const n=new Uint8Array(4*e*e);for(let a=0;a<e;a++)for(let s=0;s<e;s++){let o=s-.5*e+.25,c=.5*e-a-.75;const l=a*e+s;if(i){const e=(o+c)/Math.SQRT2;c=(c-o)/Math.SQRT2,o=e}let d=Math.max(Math.abs(o),Math.abs(c))-.5*t;d=d/e+.5,Object(r["a"])(d,n,4*l)}return n}function u(e,t,i){i&&(t*=Math.SQRT2);const n=.5*t,a=new Uint8Array(4*e*e);for(let s=0;s<e;s++)for(let t=0;t<e;t++){let o=t-.5*e,c=.5*e-s-1;const l=s*e+t;if(i){const e=(o+c)/Math.SQRT2;c=(c-o)/Math.SQRT2,o=e}let d;o=Math.abs(o),c=Math.abs(c),d=o>c?o>n?Math.sqrt((o-n)*(o-n)+c*c):c:c>n?Math.sqrt(o*o+(c-n)*(c-n)):o,d=d/e+.5,Object(r["a"])(d,a,4*l)}return a}},a7d7:function(e,t,i){"use strict";i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return o})),i.d(t,"c",(function(){return c}));var r=i("47f8"),n=i("7cb4"),a=i("3886");const s=Object(r["d"])(0,.6,.2);function o(e,t){const i=e.fragment,r=t.hasMetalnessAndRoughnessTexture||t.hasEmissionTexture||t.hasOcclusionTexture;1===t.pbrMode&&r&&e.include(n["a"],t),2!==t.pbrMode?(0===t.pbrMode&&i.code.add(a["a"]`float getBakedOcclusion() { return 1.0; }`),1===t.pbrMode&&(i.uniforms.add("emissionFactor","vec3"),i.uniforms.add("mrrFactors","vec3"),i.code.add(a["a"]`vec3 mrr;
vec3 emission;
float occlusion;`),t.hasMetalnessAndRoughnessTexture&&(i.uniforms.add("texMetallicRoughness","sampler2D"),t.supportsTextureAtlas&&i.uniforms.add("texMetallicRoughnessSize","vec2"),i.code.add(a["a"]`void applyMetallnessAndRoughness(TextureLookupParameter params) {
vec3 metallicRoughness = textureLookup(texMetallicRoughness, params).rgb;
mrr[0] *= metallicRoughness.b;
mrr[1] *= metallicRoughness.g;
}`)),t.hasEmissionTexture&&(i.uniforms.add("texEmission","sampler2D"),t.supportsTextureAtlas&&i.uniforms.add("texEmissionSize","vec2"),i.code.add(a["a"]`void applyEmission(TextureLookupParameter params) {
emission *= textureLookup(texEmission, params).rgb;
}`)),t.hasOcclusionTexture?(i.uniforms.add("texOcclusion","sampler2D"),t.supportsTextureAtlas&&i.uniforms.add("texOcclusionSize","vec2"),i.code.add(a["a"]`void applyOcclusion(TextureLookupParameter params) {
occlusion *= textureLookup(texOcclusion, params).r;
}
float getBakedOcclusion() {
return occlusion;
}`)):i.code.add(a["a"]`float getBakedOcclusion() { return 1.0; }`),i.code.add(a["a"]`
    void applyPBRFactors() {
      mrr = mrrFactors;
      emission = emissionFactor;
      occlusion = 1.0;
      ${r?"vtc.uv = vuv0;":""}
      ${t.hasMetalnessAndRoughnessTexture?t.supportsTextureAtlas?"vtc.size = texMetallicRoughnessSize; applyMetallnessAndRoughness(vtc);":"applyMetallnessAndRoughness(vtc);":""}
      ${t.hasEmissionTexture?t.supportsTextureAtlas?"vtc.size = texEmissionSize; applyEmission(vtc);":"applyEmission(vtc);":""}
      ${t.hasOcclusionTexture?t.supportsTextureAtlas?"vtc.size = texOcclusionSize; applyOcclusion(vtc);":"applyOcclusion(vtc);":""}
    }
  `))):i.code.add(a["a"]`const vec3 mrr = vec3(0.0, 0.6, 0.2);
const vec3 emission = vec3(0.0);
float occlusion = 1.0;
void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`)}function c(e,t,i=!1){i||(e.setUniform3fv("mrrFactors",t.mrrFactors),e.setUniform3fv("emissionFactor",t.emissiveFactor))}},a803:function(e,t,i){"use strict";i.d(t,"a",(function(){return u})),i.d(t,"b",(function(){return d})),i.d(t,"c",(function(){return f})),i.d(t,"d",(function(){return b})),i.d(t,"e",(function(){return l})),i.d(t,"f",(function(){return h}));var r=i("6c97"),n=i("b2b2"),a=i("8c11"),s=i("9ac8"),o=i("ec13"),c=i("f33e");const l={primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:{bytesPerFeature:0,bytesPerCoordinate:0,bytesPerFeatureLabel:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}}};function d(e){return"web-style"===e.type?l:h(e.symbolLayers.toArray().map(t=>f(e,t)))}function h(e){let t=0,i=0,r=0,a=!1,s=0;const o={bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}};for(const c of e)Object(n["k"])(c)||(t+=c.primitivesPerFeature,i+=c.primitivesPerCoordinate,r+=c.drawCallsPerFeature,o.bytesPerFeature+=c.memory.bytesPerFeature,o.bytesPerFeatureLabel+=c.memory.bytesPerFeatureLabel,o.bytesPerCoordinate+=c.memory.bytesPerCoordinate,o.draped.bytesPerFeature+=c.memory.bytesPerFeature,o.draped.bytesPerFeatureLabel+=c.memory.bytesPerFeatureLabel,o.draped.bytesPerCoordinate+=c.memory.bytesPerCoordinate,a=a||c.estimated,++s);return{primitivesPerFeature:t,primitivesPerCoordinate:i,drawCallsPerFeature:r,estimated:a,memory:o,numComplexities:s}}function u(e){const t=h(e);return t.numComplexities>0&&(t.primitivesPerFeature/=t.numComplexities,t.primitivesPerCoordinate/=t.numComplexities,t.drawCallsPerFeature/=t.numComplexities,t.memory.bytesPerFeature/=t.numComplexities,t.memory.bytesPerFeatureLabel/=t.numComplexities,t.memory.bytesPerCoordinate/=t.numComplexities,t.memory.draped.bytesPerFeature/=t.numComplexities,t.memory.draped.bytesPerFeatureLabel/=t.numComplexities,t.memory.draped.bytesPerCoordinate/=t.numComplexities),t}const p={};function f(e,t){const i=b(e,t),s=Object(o["d"])(t)?2:0;switch(t.type){case"extrude":return{primitivesPerFeature:-4,primitivesPerCoordinate:4,drawCallsPerFeature:s,estimated:!1,memory:i};case"fill":return"mesh-3d"===e.type?{primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:s,estimated:!1,memory:i}:Object(n["l"])(t.outline)&&t.outline.size>0?{primitivesPerFeature:-4,primitivesPerCoordinate:3,drawCallsPerFeature:0,estimated:!1,memory:i}:{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:i};case"water":return{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:i};case"line":return{primitivesPerFeature:-2,primitivesPerCoordinate:2,drawCallsPerFeature:0,estimated:!1,memory:i};case"object":return t.resource&&t.resource.href?{primitivesPerFeature:16,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:i}:{...m(t.resource&&t.resource.primitive||a["b"]),memory:i};case"path":{const e=3,n=3,a=10;let s=0,o=0;switch(t.profile){case"circle":s=a;break;case"quad":s=4;break;default:return void Object(r["a"])(t.profile)}switch(t.join){case"round":o=e;break;case"miter":case"bevel":o=1;break;default:return void Object(r["a"])(t.join)}const c=2*s,l=s*o*2;let d=-2*l-c;switch(t.cap){case"none":break;case"butt":case"square":d+=2*(s-1);break;case"round":d+=2*(s*(n-1)*2+s);break;default:return}return{primitivesPerFeature:d,primitivesPerCoordinate:l+c,drawCallsPerFeature:0,estimated:!1,memory:i}}case"text":case"icon":return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:i};default:return}}function b(e,t){const i="point-3d"===e.type;switch(t.type){case"extrude":return t.edges&&t.edges.size>0?g.EXTRUDE_EDGES:g.EXTRUDE;case"fill":return Object(n["l"])(t.outline)&&t.outline.size>0?g.FILL_OUTLINE:g.FILL;case"water":return g.FILL;case"line":return"round"===t.join?g.LINE_ROUND:g.LINE_MITER;case"path":switch(t.join){case"round":switch(t.profile){case"circle":return g.PATH_ROUND_CIRCLE;case"quad":return g.PATH_ROUND_QUAD;default:return void Object(r["a"])(t.profile)}case"miter":case"bevel":switch(t.profile){case"circle":return g.PATH_MITER_CIRCLE;case"quad":return g.PATH_MITER_QUAD;default:return void Object(r["a"])(t.profile)}default:return void Object(r["a"])(t.join)}case"object":return i?g.OBJECT_POINT:g.OBJECT_POLYGON;case"icon":case"text":return i?g.ICON_POINT:g.ICON_POLYGON;default:return}}function m(e){let t=p[e];if(t)return t;const i=Object(s["b"])(e,null);return t={primitivesPerFeature:Object(c["b"])(i.levels[0]).reduce((e,t)=>e+t.indices.get("position").length/3,0),primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1},p[e]=t,t}const g={ICON_POINT:{bytesPerFeature:7127.413186968842,bytesPerFeatureLabel:4826.302896296296,bytesPerCoordinate:0,draped:{bytesPerFeature:3929.4396628895197,bytesPerFeatureLabel:3550.1332222222227,bytesPerCoordinate:0}},ICON_POLYGON:{bytesPerFeature:9329.452613976147,bytesPerFeatureLabel:3675.3372604938268,bytesPerCoordinate:60.177252982212096,draped:{bytesPerFeature:6190.247450139383,bytesPerFeatureLabel:3744.074358024691,bytesPerCoordinate:59.488211068026104}},OBJECT_POINT:{bytesPerFeature:2350.5884192634558,bytesPerFeatureLabel:4446.651003703703,bytesPerCoordinate:0,draped:{bytesPerFeature:2350.5884192634558,bytesPerFeatureLabel:4446.651003703703,bytesPerCoordinate:0}},OBJECT_POLYGON:{bytesPerFeature:4583.807620302299,bytesPerFeatureLabel:3665.342685185186,bytesPerCoordinate:60.11621818101506,draped:{bytesPerFeature:4583.807620302299,bytesPerFeatureLabel:3665.342685185186,bytesPerCoordinate:60.11621818101506}},LINE_MITER:{bytesPerFeature:7321.028181375921,bytesPerFeatureLabel:4048.0226716049388,bytesPerCoordinate:186.55621386363578,draped:{bytesPerFeature:4246.856619435009,bytesPerFeatureLabel:3852.3737679012347,bytesPerCoordinate:163.47884002621583}},LINE_ROUND:{bytesPerFeature:7482.205842738954,bytesPerFeatureLabel:4045.886987654321,bytesPerCoordinate:191.5452524171851,draped:{bytesPerFeature:4473.481387957992,bytesPerFeatureLabel:3842.1112395061728,bytesPerCoordinate:167.27703460226945}},PATH_MITER_CIRCLE:{bytesPerFeature:9010.489006415351,bytesPerFeatureLabel:4230.9109,bytesPerCoordinate:4618.2594178027275,draped:{bytesPerFeature:9010.489006415351,bytesPerFeatureLabel:4230.9109,bytesPerCoordinate:4618.2594178027275}},PATH_ROUND_CIRCLE:{bytesPerFeature:4104.727250200398,bytesPerFeatureLabel:4251.8525,bytesPerCoordinate:8019.043777064957,draped:{bytesPerFeature:4104.727250200398,bytesPerFeatureLabel:4251.8525,bytesPerCoordinate:8019.043777064957}},PATH_MITER_QUAD:{bytesPerFeature:9416.372942261387,bytesPerFeatureLabel:4241.2757,bytesPerCoordinate:3176.7222742582203,draped:{bytesPerFeature:9416.372942261387,bytesPerFeatureLabel:4241.2757,bytesPerCoordinate:3176.7222742582203}},PATH_ROUND_QUAD:{bytesPerFeature:6614.431545308682,bytesPerFeatureLabel:4206.7461,bytesPerCoordinate:5141.817789093826,draped:{bytesPerFeature:6614.431545308682,bytesPerFeatureLabel:4206.7461,bytesPerCoordinate:5141.817789093826}},FILL:{bytesPerFeature:9478.244183633637,bytesPerFeatureLabel:3713.816824691358,bytesPerCoordinate:95.9343604185578,draped:{bytesPerFeature:6287.911108168086,bytesPerFeatureLabel:3790.785032098766,bytesPerCoordinate:83.08783220478168}},FILL_OUTLINE:{bytesPerFeature:13085.871870349445,bytesPerFeatureLabel:3392.613241975309,bytesPerCoordinate:118.63968023169875,draped:{bytesPerFeature:8437.199992480122,bytesPerFeatureLabel:3973.5431172839503,bytesPerCoordinate:106.33556817014312}},EXTRUDE:{bytesPerFeature:19459.53727140414,bytesPerFeatureLabel:3743.7045209876546,bytesPerCoordinate:372.6819978900477,draped:{bytesPerFeature:19459.53727140414,bytesPerFeatureLabel:3743.7045209876546,bytesPerCoordinate:372.6819978900477}},EXTRUDE_EDGES:{bytesPerFeature:22266.888534913724,bytesPerFeatureLabel:3064.3193358024696,bytesPerCoordinate:374.3725221561312,draped:{bytesPerFeature:22266.888534913724,bytesPerFeatureLabel:3064.3193358024696,bytesPerCoordinate:374.3725221561312}}}},a978:function(e,t,i){"use strict";i.d(t,"a",(function(){return d})),i.d(t,"b",(function(){return l})),i.d(t,"c",(function(){return o})),i.d(t,"d",(function(){return c}));var r=i("b2b2"),n=i("e431"),a=i("0b2d"),s=i("0d9f");function o(e){return Object(r["l"])(e)&&Object(r["l"])(e.dist)}function c(e){return(t,i,r)=>(Object(n["l"])(h,t,i,r),!Object(s["f"])(e,h))}function l(e){return o(e)&&0===e.intersector&&!!e.target}function d(e){return o(e)&&1===e.intersector&&!!e.target&&Object(r["l"])(e.target.center)}const h=Object(a["f"])()},aab5:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("3886");function n(e,t){const i=e.fragment;i.code.add(r["a"]`struct ShadingNormalParameters {
vec3 normalView;
vec3 viewDirection;
} shadingParams;`),1===t.doubleSidedMode?i.code.add(r["a"]`vec3 shadingNormal(ShadingNormalParameters params) {
return dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);
}`):2===t.doubleSidedMode?i.code.add(r["a"]`vec3 shadingNormal(ShadingNormalParameters params) {
return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);
}`):i.code.add(r["a"]`vec3 shadingNormal(ShadingNormalParameters params) {
return normalize(params.normalView);
}`)}},ab68:function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return n}));var r=i("dff3");const n={type:r["a"],json:{origins:{service:{read:{source:["tileInfo","minScale","maxScale","minLOD","maxLOD"],reader:a}}}}};function a(e,t,i,n){if(!e)return null;const{minScale:a,maxScale:s,minLOD:o,maxLOD:c}=t;if(null!=o&&null!=c)return n&&n.ignoreMinMaxLOD?r["a"].fromJSON(e):r["a"].fromJSON({...e,lods:e.lods.filter(({level:e})=>null!=e&&e>=o&&e<=c)});if(0!==a&&0!==s){const t=e=>Math.round(1e4*e)/1e4,i=a?t(a):1/0,n=s?t(s):-1/0;return r["a"].fromJSON({...e,lods:e.lods.filter(e=>{const r=t(e.scale);return r<=i&&r>=n})})}return r["a"].fromJSON(e)}},ac91:function(e,t,i){"use strict";i.d(t,"a",(function(){return d}));var r=i("2eab"),n=i("cea0"),a=i("a9ab"),s=i("bb72"),o=i("a571"),c=i("7e6b");const l=Object(n["m"])(c["a"]);async function d(e,t,i){t=l(t);const n=Object(s["c"])(e),c={...n.query,f:"json",...t.toJSON()},d=t.outSpatialReference,h=Object(a["c"])(t.geometries[0]),u=Object(s["a"])(c,i);return Object(r["default"])(n.path+"/project",u).then(({data:{geometries:e}})=>Object(o["a"])(e,h,d))}},adf1:function(e,t,i){"use strict";i.d(t,"a",(function(){return f}));var r=i("b2b2"),n=i("f2e0"),a=i("afe1"),s=i("e431"),o=i("0b2d"),c=i("8188"),l=i("0278"),d=i("7abc"),h=i("5a22"),u=i("748f"),p=i("86ba");class f{constructor(e,t=125e4){this._originSR=e,this._gridSize=t,this._origins=new Map,this._objects=new Map,this._rootOriginId="root/"+Object(n["b"])()}getOrigin(e){const t=this._origins.get(this._rootOriginId);if(null==t){if(Object(r["l"])(b))return this._origins.set(this._rootOriginId,Object(d["a"])(b[0],b[1],b[2],this._rootOriginId)),this.getOrigin(e);const t=Object(d["a"])(e[0]+Math.random()-.5,e[1]+Math.random()-.5,e[2]+Math.random()-.5,this._rootOriginId);return this._origins.set(this._rootOriginId,t),t}const i=this._gridSize,n=Math.round(e[0]/i),a=Math.round(e[1]/i),o=Math.round(e[2]/i),c=`${n}/${a}/${o}`;let l=this._origins.get(c);const h=.5*i;if(Object(s["m"])(m,e,t.vec3),m[0]=Math.abs(m[0]),m[1]=Math.abs(m[1]),m[2]=Math.abs(m[2]),m[0]<h&&m[1]<h&&m[2]<h){if(l){const t=Math.max(...m);if(Object(s["m"])(m,e,l.vec3),m[0]=Math.abs(m[0]),m[1]=Math.abs(m[1]),m[2]=Math.abs(m[2]),Math.max(...m)<t)return l}return t}return l||(l=Object(d["a"])(n*i,a*i,o*i,c),this._origins.set(c,l)),l}_drawOriginBox(e,t=[1,1,0,1]){const i=window.view,r=i._stage,n=t.toString();if(!this._objects.has(n)){this._material=new p["a"]({width:2,color:t}),r.add(this._material);const e=new u["a"]({isPickable:!1}),i=new h["a"]({castShadow:!1});r.add(i),e.add(i),r.add(e),this._objects.set(n,i)}const s=this._objects.get(n),o=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],d=o.length,f=new Array(3*d),b=new Uint16Array(2*(d-1)),m=.5*this._gridSize;for(let a=0;a<d;a++)f[3*a+0]=e[0]+(1&o[a]?m:-m),f[3*a+1]=e[1]+(2&o[a]?m:-m),f[3*a+2]=e[2]+(4&o[a]?m:-m),a>0&&(b[2*a+0]=a-1,b[2*a+1]=a);Object(c["p"])(f,this._originSR,0,f,i.renderSpatialReference,0,d);const g=new l["a"]([["position",{size:3,data:f,exclusive:!0}]],[["position",b]],2);r.add(g),s.addGeometry(g,this._material,a["a"])}}let b=null;const m=Object(o["f"])()},aeb3:function(e,t,i){"use strict";i.d(t,"a",(function(){return y})),i.d(t,"b",(function(){return g}));var r=i("d272"),n=i("4db9"),a=i("6d5b"),s=i("c2d1"),o=i("6a07"),c=i("d047"),l=i("c6d7"),d=i("ebd5"),h=i("4377"),u=i("3886"),p=i("690a");const f=.70710678118,b=f,m=.08715574274;function g(e){const t=new p["a"];e.draped||t.extensions.add("GL_OES_standard_derivatives");const i=1===e.output;t.include(n["a"],{linearDepth:i}),t.include(a["a"],e),t.vertex.uniforms.add("proj","mat4"),t.vertex.uniforms.add("view","mat4"),i&&(t.include(s["a"],e),t.vertex.uniforms.add("cameraNearFar","vec2"),t.varyings.add("linearDepth","float")),e.draped?t.vertex.uniforms.add("worldToScreenRatio","float"):(t.vertex.uniforms.add("worldToScreenPerDistanceRatio","float"),t.vertex.uniforms.add("camPos","vec3"),t.attributes.add("boundingRect","mat3")),t.attributes.add("position","vec3"),t.attributes.add("uvMapSpace","vec4"),t.varyings.add("vpos","vec3"),t.varyings.add("vuv","vec2"),e.multipassTerrainEnabled&&t.varyings.add("depth","float");const g=3===e.style||4===e.style||5===e.style;return g&&t.vertex.code.add(u["a"]`
      const mat2 rotate45 = mat2(${u["a"].float(f)}, ${u["a"].float(-b)},
                                 ${u["a"].float(b)}, ${u["a"].float(f)});
    `),e.draped||(t.vertex.code.add(u["a"]`vec3 projectPointToLineSegment(vec3 center, vec3 halfVector, vec3 point) {
float projectedLength = dot(halfVector, point - center) / dot(halfVector, halfVector);
return center + halfVector * clamp(projectedLength, -1.0, 1.0);
}`),t.vertex.code.add(u["a"]`vec3 intersectRayPlane(vec3 rayDir, vec3 rayOrigin, vec3 planeNormal, vec3 planePoint) {
float d = dot(planeNormal, planePoint);
float t = (d - dot(planeNormal, rayOrigin)) / dot(planeNormal, rayDir);
return rayOrigin + t * rayDir;
}`),t.vertex.code.add(u["a"]`
      float boundingRectDistanceToCamera() {
        vec3 center = vec3(boundingRect[0][0], boundingRect[0][1], boundingRect[0][2]);
        vec3 halfU = vec3(boundingRect[1][0], boundingRect[1][1], boundingRect[1][2]);
        vec3 halfV = vec3(boundingRect[2][0], boundingRect[2][1], boundingRect[2][2]);
        vec3 n = normalize(cross(halfU, halfV));

        vec3 viewDir = - vec3(view[0][2], view[1][2], view[2][2]);

        float viewAngle = dot(viewDir, n);
        float minViewAngle = ${u["a"].float(m)};

        if (abs(viewAngle) < minViewAngle) {
          // view direction is (almost) parallel to plane -> clamp it to min angle
          float normalComponent = sign(viewAngle) * minViewAngle - viewAngle;
          viewDir = normalize(viewDir + normalComponent * n);
        }

        // intersect view direction with infinite plane that contains bounding rect
        vec3 planeProjected = intersectRayPlane(viewDir, camPos, n, center);

        // clip to bounds by projecting to u and v line segments individually
        vec3 uProjected = projectPointToLineSegment(center, halfU, planeProjected);
        vec3 vProjected = projectPointToLineSegment(center, halfV, planeProjected);

        // use to calculate the closest point to camera on bounding rect
        vec3 closestPoint = uProjected + vProjected - center;

        return length(closestPoint - camPos);
      }
    `)),t.vertex.code.add(u["a"]`
    vec2 scaledUV() {
      vec2 uv = uvMapSpace.xy ${g?" * rotate45":""};
      vec2 uvCellOrigin = uvMapSpace.zw ${g?" * rotate45":""};

      ${e.draped?"":u["a"]`
            float distanceToCamera = boundingRectDistanceToCamera();
            float worldToScreenRatio = worldToScreenPerDistanceRatio / distanceToCamera;
          `}

      // Logarithmically discretize ratio to avoid jittering
      float step = 0.1;
      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);

      vec2 uvOffset = mod(uvCellOrigin * discreteWorldToScreenRatio, ${u["a"].float(e.patternSpacing)});
      return uvOffset + (uv * discreteWorldToScreenRatio);
    }
  `),t.vertex.code.add(u["a"]`
    void main(void) {
      vuv = scaledUV();
      vpos = position;
      ${e.multipassTerrainEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}
      forwardNormalizedVertexColor();
      gl_Position = ${i?u["a"]`transformPositionWithDepth(proj, view, vpos, cameraNearFar, linearDepth);`:u["a"]`transformPosition(proj, view, vpos);`}
    }
  `),t.include(r["a"],e),t.fragment.include(h["a"]),t.fragment.uniforms.add("matColor","vec4"),e.draped&&t.fragment.uniforms.add("texelSize","float"),4===e.output&&t.include(o["a"]),e.multipassTerrainEnabled&&(t.fragment.include(c["a"]),t.include(l["b"],e)),4!==e.output&&(t.fragment.code.add(u["a"]`
      const float lineWidth = ${u["a"].float(e.lineWidth)};
      const float spacing = ${u["a"].float(e.patternSpacing)};
      const float spacingINV = ${u["a"].float(1/e.patternSpacing)};

      float coverage(float p, float txlSize) {
        p = mod(p, spacing);

        float halfTxlSize = txlSize / 2.0;

        float start = p - halfTxlSize;
        float end = p + halfTxlSize;

        float coverage = (ceil(end * spacingINV) - floor(start * spacingINV)) * lineWidth;
        coverage -= min(lineWidth, mod(start, spacing));
        coverage -= max(lineWidth - mod(end, spacing), 0.0);

        return coverage / txlSize;
      }
    `),e.draped||t.fragment.code.add(u["a"]`const int maxSamples = 5;
float sample(float p) {
vec2 dxdy = abs(vec2(dFdx(p), dFdy(p)));
float fwidth = dxdy.x + dxdy.y;
ivec2 samples = 1 + ivec2(clamp(dxdy, 0.0, float(maxSamples - 1)));
vec2 invSamples = 1.0 / vec2(samples);
float accumulator = 0.0;
for (int j = 0; j < maxSamples; j++) {
if(j >= samples.y) {
break;
}
for (int i = 0; i < maxSamples; i++) {
if(i >= samples.x) {
break;
}
vec2 step = vec2(i,j) * invSamples - 0.5;
accumulator += coverage(p + step.x * dxdy.x + step.y * dxdy.y, fwidth);
}
}
accumulator /= float(samples.x * samples.y);
return accumulator;
}`)),t.fragment.code.add(u["a"]`
    void main() {
      discardBySlice(vpos);
      ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
      vec4 color = ${e.attributeColor?"vColor * matColor;":"matColor;"}
      color = highlightSlice(color, vpos);

      ${4!==e.output?u["a"]`color.a *= ${v(e)};`:""}

      if (color.a < ${u["a"].float(d["c"])}) {
        discard;
      }

      ${7===e.output?u["a"]`gl_FragColor = vec4(color.a);`:""}

      ${0===e.output?u["a"]`gl_FragColor = color; ${e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
      ${4===e.output?u["a"]`outputHighlight();`:""}
      ${1===e.output?u["a"]`outputDepth(linearDepth);`:""};
    }
  `),t}function v(e){function t(t){return e.draped?u["a"]`coverage(vuv.${t}, texelSize)`:u["a"]`sample(vuv.${t})`}switch(e.style){case 3:case 0:return t("y");case 4:case 1:return t("x");case 5:case 2:return u["a"]`
        1.0 - (1.0 - ${t("x")}) * (1.0 - ${t("y")})
      `;default:return"0.0"}}const y=Object.freeze({__proto__:null,build:g})},af20:function(e,t,i){"use strict";i.d(t,"a",(function(){return O})),i.d(t,"b",(function(){return y}));var r=i("bd75"),n=i("d272"),a=i("4db9"),s=i("b49d"),o=i("c2d1"),c=i("6a07"),l=i("d047"),d=i("7088"),h=i("ea4b"),u=i("c6d7"),p=i("aab5"),f=i("040b"),b=i("d017"),m=i("4377"),g=i("3886"),v=i("690a");function y(e){const t=new v["a"];return t.vertex.uniforms.add("proj","mat4").add("view","mat4").add("camPos","vec3").add("localOrigin","vec3"),t.varyings.add("vpos","vec3"),t.include(s["a"],e),0!==e.output&&7!==e.output||(t.include(a["a"],{linearDepth:!1}),e.receiveShadows&&t.include(b["a"],e),t.include(r["a"],e),t.varyings.add("vnormal","vec3"),t.varyings.add("vcolor","vec4"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),t.vertex.code.add(g["a"]`
      void main() {
        vpos = calculateVPos();
        vnormal = normalize(localNormal());

        ${e.multipassTerrainEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}
        gl_Position = transformPosition(proj, view, vpos);

        ${0===e.output?"forwardLinearDepth();":""}

        vcolor = getColor();
      }
    `)),e.multipassTerrainEnabled&&(t.fragment.include(l["a"]),t.include(u["b"],e)),7===e.output&&(t.include(n["a"],e),t.fragment.uniforms.add("camPos","vec3"),t.fragment.uniforms.add("localOrigin","vec3"),t.fragment.uniforms.add("opacity","float"),t.fragment.code.add(g["a"]`
      void main() {
        discardBySlice(vpos);
        ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
        float combinedOpacity = vcolor.a * opacity;
        gl_FragColor = vec4(combinedOpacity);
      }
    `)),0===e.output&&(t.include(n["a"],e),t.include(h["a"],e),t.include(d["a"],e),e.receiveShadows&&t.include(b["a"],e),t.include(p["a"],e),t.fragment.uniforms.add("camPos","vec3").add("localOrigin","vec3").add("ambient","vec3").add("diffuse","vec3").add("specular","vec3").add("opacity","float"),t.fragment.include(m["a"]),t.fragment.code.add(g["a"]`
      void main() {
        discardBySlice(vpos);
        ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}

        shadingParams.viewDirection = normalize(vpos - camPos);
        shadingParams.normalView = vnormal;
        vec3 normal = shadingNormal(shadingParams);
        float ssao = evaluateAmbientOcclusionInverse();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${e.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":1===e.viewingMode?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
        vec3 albedo = vcolor.rgb * max(ambient, diffuse); // combine the old material parameters into a single one
        float combinedOpacity = vcolor.a * opacity;
        albedo += 0.25 * specular; // don't completely ignore specular for now

        vec3 shadedColor = evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight);
        gl_FragColor = vec4(shadedColor, combinedOpacity);
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
        ${e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `)),1!==e.output&&3!==e.output||(t.include(a["a"],{linearDepth:!0}),t.vertex.uniforms.add("nearFar","vec2"),t.varyings.add("depth","float"),t.vertex.code.add(g["a"]`void main() {
vpos = calculateVPos();
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
}`),t.include(n["a"],e),t.include(o["a"],e),t.fragment.uniforms.add("timeElapsed","float"),t.fragment.code.add(g["a"]`void main() {
discardBySlice(vpos);
outputDepth(depth);
}`)),2===e.output&&(t.include(a["a"],{linearDepth:!1}),t.include(f["a"],e),t.vertex.uniforms.add("viewNormal","mat4"),t.varyings.add("vnormal","vec3"),t.vertex.code.add(g["a"]`void main(void) {
vpos = calculateVPos();
vnormal = normalize((viewNormal * vec4(localNormal(), 1.0)).xyz);
gl_Position = transformPosition(proj, view, vpos);
}`),t.include(n["a"],e),t.fragment.uniforms.add("waterColor","vec4"),t.fragment.code.add(g["a"]`void main() {
discardBySlice(vpos);
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) normal = -normal;
gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
}`)),4===e.output&&(t.include(a["a"],{linearDepth:!1}),t.include(f["a"],e),t.vertex.uniforms.add("viewNormal","mat4"),t.varyings.add("vnormal","vec3"),t.vertex.code.add(g["a"]`void main(void) {
vpos = calculateVPos();
gl_Position = transformPosition(proj, view, vpos);
}`),t.include(n["a"],e),t.include(c["a"]),t.fragment.code.add(g["a"]`void main() {
discardBySlice(vpos);
outputHighlight();
}`)),t}const O=Object.freeze({__proto__:null,build:y})},afe1:function(e,t,i){"use strict";function r(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function n(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]}function a(e,t,i,r,n,a,s,o,c,l,d,h,u,p,f,b){return[e,t,i,r,n,a,s,o,c,l,d,h,u,p,f,b]}function s(e,t){return new Float64Array(e,t,16)}i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return s})),i.d(t,"c",(function(){return n})),i.d(t,"d",(function(){return r})),i.d(t,"e",(function(){return a}));const o=r();Object.freeze({__proto__:null,create:r,clone:n,fromValues:a,createView:s,IDENTITY:o})},aff7:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i("c51b"),n=i("3886");function a(e){e.fragment.uniforms.add("anchorPosition","vec3").add("anchorPositionCrossFade","vec3").add("fadeInOutFactor","float").add("cloudsHeight","float").add("rotationMatrixClouds","mat4").add("rotationMatrixCloudsCrossFade","mat4").add("radiusCurvatureCorrectionFactor","float").add("radius","float").add("cameraPosition","vec3").add("totalFadeInOut","float").add("crossFade","int").add("crossFadeAnchorFactor","float").add("cloudVariables","vec2"),e.include(r["a"]),e.fragment.code.add(n["a"]`vec3 intersectWithCloudLayer(vec3 dir, vec3 camPos, vec3 spherePos, float radiusReduction)
{
vec3 dirAnchor = normalize(spherePos);
vec3 sphereOriginOffset = dirAnchor * radiusReduction;
float radiusClouds = radius + cloudsHeight - radiusReduction;
float B = 2.0 * dot(camPos - sphereOriginOffset, dir);
float C = dot(camPos - sphereOriginOffset, camPos - sphereOriginOffset) - radiusClouds * radiusClouds;
float det = B * B - 4.0 * C;
float pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));
vec3 intersectionPont = camPos + dir * pointIntDist;
intersectionPont =  intersectionPont - spherePos;
return intersectionPont;
}`),e.fragment.code.add(n["a"]`vec3 correctForPlanetCurvature(vec3 dir)
{
dir.z = dir.z*(1.-radiusCurvatureCorrectionFactor) + radiusCurvatureCorrectionFactor;
return dir;
}`),e.fragment.code.add(n["a"]`vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec)
{
return (rotMat * vec4(inVec, 0.0)).xyz;
}`),e.fragment.code.add(n["a"]`const float SUNSET_TRANSITION_FACTOR = 0.3;
const vec3 RIM_COLOR = vec3(0.28, 0.175, 0.035);
const float RIM_SCATTERING_FACTOR = 140.0;
const float BACKLIGHT_FACTOR = 0.2;
const float BACKLIGHT_SCATTERING_FACTOR = 10.0;
const float BACKLIGHT_TRANSITION_FACTOR = 0.3;
const float GAMMA_SRGB = 2.1;
const float INV_GAMMA_SRGB = 0.4761904;
vec3 calculateCloudColor(vec3 worldSpaceRay, vec4 clouds)
{
float upDotLight = dot(normalize(cameraPosition), normalize(lightingMainDirection));
float dirDotLight = max(dot(normalize(-worldSpaceRay), normalize(lightingMainDirection)), 0.0);
float sunsetTransition = clamp(pow(max(upDotLight, 0.0), SUNSET_TRANSITION_FACTOR), 0.0, 1.0);
vec3 ambientLight = calculateAmbientIrradiance(normalize(cameraPosition),  0.0);
vec3 mainLight = evaluateMainLighting(normalize(cameraPosition),  0.0);
vec3 combinedLight = clamp((lightingMainIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));
vec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA_SRGB)), vec3(INV_GAMMA_SRGB));
float scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);
float rimLightIntensity = 0.5 + 0.5 *pow(max(upDotLight, 0.0), 0.35);
vec3 directSunScattering = RIM_COLOR * rimLightIntensity * pow(dirDotLight, RIM_SCATTERING_FACTOR) * scatteringMod;
float additionalLight = BACKLIGHT_FACTOR * pow(dirDotLight, BACKLIGHT_SCATTERING_FACTOR) * (1. - pow(sunsetTransition, BACKLIGHT_TRANSITION_FACTOR)) ;
return vec3(baseCloudColor * (1. + additionalLight) + directSunScattering);
}`),e.fragment.code.add(n["a"]`vec4 getCloudData(vec3 rayDir)
{
vec4 cloudData = textureCube(cubeMap, rayDir);
float mu = dot(rayDir, vec3(0, 0, 1));
return mix(vec4(vec3(clamp(1.0 - cloudVariables.y, 0.6, 1.0)), 0.0), cloudData, smoothstep(-0.01, mix(0.0, 0.075, cloudVariables.x), abs(mu)));
}`),e.fragment.code.add(n["a"]`vec4 renderCloud(vec3 worldRay)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition, 0.0);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected);
float totalTransmittance = clamp(cloudData.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudData.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(calculateCloudColor(normalize(-worldRay), cloudData), totalTransmittance);
}`),e.fragment.code.add(n["a"]`vec4 renderCloudCrossFade(vec3 worldRay)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition, 0.0);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected);
vec4 cloudColor = vec4(calculateCloudColor(normalize(-worldRay), cloudData), cloudData.a);
intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPositionCrossFade, 0.0);
worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixCloudsCrossFade, normalize(intersectionPoint));
worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
cloudData = getCloudData(worldRayRotatedCorrected);
vec4 cloudColorCrossFade = vec4(calculateCloudColor(normalize(-worldRay), cloudData), cloudData.a);
cloudColor = mix(cloudColor, cloudColorCrossFade, crossFadeAnchorFactor);
float totalTransmittance = clamp(cloudColor.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudColor.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(cloudColor.rgb, totalTransmittance);
}`)}},affb:function(e,t,i){"use strict";i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return a}));var r=i("3886"),n=i("690a");function a(){const e=new n["a"];return e.attributes.add("position","vec2"),e.attributes.add("uv0","vec2"),e.vertex.uniforms.add("scale","float"),e.vertex.uniforms.add("offset","vec2"),e.varyings.add("uv","vec2"),e.vertex.code.add(r["a"]`void main(void) {
gl_Position = vec4(position, 0.0, 1.0);
uv = uv0 * scale + offset;
}`),e.fragment.uniforms.add("tex","sampler2D"),e.fragment.uniforms.add("opacity","float"),e.fragment.code.add(r["a"]`void main() {
vec4 color = texture2D(tex, uv);
gl_FragColor = vec4(color.xyz, 1.0) * color.a * opacity;
}`),e}const s=Object.freeze({__proto__:null,build:a})},b061:function(e,t,i){"use strict";i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return a}));var r=i("b2b2");class n{constructor(e,t){this._material=e,this._repository=t,this._map=new Map}destroy(){this._map.forEach((e,t)=>{Object(r["l"])(e)&&this._repository.release(this._material,a(t))})}load(e,t){this._map.has(t)||this._map.set(t,this._repository.acquire(this._material,a(t)));const i=this._map.get(t);if(Object(r["l"])(i)){if(2===i.ensureResources(e))return i;this._repository.requestRender()}return null}}function a(e){switch(e){default:case 0:return 0;case 1:return 7;case 4:case 7:case 6:return 3;case 3:return 2;case 2:return 1;case 5:return 4}}},b09a:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("3886");function n(e){e.attributes.add("position","vec3"),e.vertex.code.add(r["a"]`vec3 positionModel() { return position; }`)}},b0ab:function(e,t,i){"use strict";i.d(t,"a",(function(){return P})),i.d(t,"b",(function(){return C}));var r=i("bd75"),n=i("17ca"),a=i("d272"),s=i("4db9"),o=i("d539"),c=i("c332"),l=i("b09a"),d=i("6cb2"),h=i("dfaf"),u=i("6d5b"),p=i("17b0"),f=i("7e21"),b=i("d047"),m=i("7088"),g=i("ea4b"),v=i("c6d7"),y=i("5d5f"),O=i("a7d7"),_=i("d017"),x=i("be24"),j=i("ebd5"),w=i("3626"),S=i("3886"),T=i("690a");function C(e){const t=new T["a"],i=t.vertex.code,C=t.fragment.code;return t.vertex.uniforms.add("proj","mat4").add("view","mat4").add("camPos","vec3").add("localOrigin","vec3"),t.include(l["a"]),t.varyings.add("vpos","vec3"),t.include(x["a"],e),t.include(o["a"],e),t.include(p["a"],e),0!==e.output&&7!==e.output||(t.include(c["a"],e),t.include(s["a"],{linearDepth:!1}),e.offsetBackfaces&&t.include(n["a"]),e.instancedColor&&t.attributes.add("instanceColor","vec4"),t.varyings.add("vNormalWorld","vec3"),t.varyings.add("localvpos","vec3"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),t.include(h["a"],e),t.include(r["a"],e),t.include(d["a"],e),t.include(u["a"],e),t.vertex.uniforms.add("externalColor","vec4"),t.varyings.add("vcolorExt","vec4"),i.add(S["a"]`
        void main(void) {
          forwardNormalizedVertexColor();
          vcolorExt = externalColor;
          ${e.instancedColor?"vcolorExt *= instanceColor;":""}
          vcolorExt *= vvColor();
          vcolorExt *= getSymbolColor();
          forwardColorMixMode();

          if (vcolorExt.a < ${S["a"].float(j["c"])}) {
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          }
          else {
            vpos = calculateVPos();
            localvpos = vpos - view[3].xyz;
            vpos = subtractOrigin(vpos);
            vNormalWorld = dpNormal(vvLocalNormal(normalModel()));
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            ${e.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, camPos);":""}
          }
          ${e.multipassTerrainEnabled?S["a"]`depth = (view * vec4(vpos, 1.0)).z;`:""}
          forwardLinearDepth();
          forwardTextureCoordinates();
        }
      `)),7===e.output&&(t.include(a["a"],e),t.include(j["a"],e),e.multipassTerrainEnabled&&(t.fragment.include(b["a"]),t.include(v["b"],e)),t.fragment.uniforms.add("camPos","vec3").add("localOrigin","vec3").add("opacity","float").add("layerOpacity","float"),t.fragment.uniforms.add("view","mat4"),e.hasColorTexture&&t.fragment.uniforms.add("tex","sampler2D"),t.fragment.include(w["a"]),C.add(S["a"]`
      void main() {
        discardBySlice(vpos);
        ${e.multipassTerrainEnabled?S["a"]`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${e.hasColorTexture?S["a"]`
        vec4 texColor = texture2D(tex, vuv0);
        ${e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
        discardOrAdjustAlpha(texColor);`:S["a"]`vec4 texColor = vec4(1.0);`}
        ${e.attributeColor?S["a"]`
        float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:S["a"]`
        float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));
        `}

        gl_FragColor = vec4(opacity_);
      }
    `)),0===e.output&&(t.include(a["a"],e),t.include(g["a"],e),t.include(m["a"],e),t.include(j["a"],e),e.receiveShadows&&t.include(_["a"],e),e.multipassTerrainEnabled&&(t.fragment.include(b["a"]),t.include(v["b"],e)),t.fragment.uniforms.add("camPos","vec3").add("localOrigin","vec3").add("ambient","vec3").add("diffuse","vec3").add("opacity","float").add("layerOpacity","float"),t.fragment.uniforms.add("view","mat4"),e.hasColorTexture&&t.fragment.uniforms.add("tex","sampler2D"),t.include(O["b"],e),t.include(y["a"],e),t.fragment.include(w["a"]),C.add(S["a"]`
      void main() {
        discardBySlice(vpos);
        ${e.multipassTerrainEnabled?S["a"]`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${e.hasColorTexture?S["a"]`
        vec4 texColor = texture2D(tex, vuv0);
        ${e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
        discardOrAdjustAlpha(texColor);`:S["a"]`vec4 texColor = vec4(1.0);`}
        vec3 viewDirection = normalize(vpos - camPos);
        ${1===e.pbrMode?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${e.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":1===e.viewingMode?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${e.attributeColor?S["a"]`
        vec3 albedo_ = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
        float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:S["a"]`
        vec3 albedo_ = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
        float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));
        `}
        ${S["a"]`
        vec3 shadedNormal = normalize(vNormalWorld);
        albedo_ *= 1.2;
        vec3 viewForward = vec3(view[0][2], view[1][2], view[2][2]);
        float alignmentLightView = clamp(dot(viewForward, -lightingMainDirection), 0.0, 1.0);
        float transmittance = 1.0 - clamp(dot(viewForward, shadedNormal), 0.0, 1.0);
        float treeRadialFalloff = vColor.r;
        float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);
        additionalLight += backLightFactor * lightingMainIntensity;`}
        ${1===e.pbrMode||2===e.pbrMode?1===e.viewingMode?S["a"]`vec3 normalGround = normalize(vpos + localOrigin);`:S["a"]`vec3 normalGround = vec3(0.0, 0.0, 1.0);`:S["a"]``}
        ${1===e.pbrMode||2===e.pbrMode?S["a"]`
            float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * lightingMainIntensity[2];
            vec3 shadedColor = evaluateSceneLightingPBR(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:"vec3 shadedColor = evaluateSceneLighting(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight);"}
        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `)),t.include(f["a"],e),t}const P=Object.freeze({__proto__:null,build:C})},b139:function(e,t,i){"use strict";function r(){return[0,0,0,1]}function n(e){return[e[0],e[1],e[2],e[3]]}function a(e,t,i,r){return[e,t,i,r]}function s(e,t){return new Float64Array(e,t,4)}i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return r})),i.d(t,"c",(function(){return n})),i.d(t,"d",(function(){return s}));const o=r();Object.freeze({__proto__:null,create:r,clone:n,fromValues:a,createView:s,IDENTITY:o})},b165:function(e,t,i){"use strict";i.d(t,"a",(function(){return h})),i.d(t,"b",(function(){return d}));var r=i("2906"),n=i("dea3"),a=i("aff7"),s=i("4377"),o=i("501b"),c=i("3886"),l=i("690a");function d(){const e=new l["a"];return e.attributes.add("position","vec2"),e.varyings.add("worldRay","vec3"),e.vertex.uniforms.add("inverseProjectionMatrix","mat4"),e.vertex.uniforms.add("inverseViewMatrix","mat4"),e.vertex.code.add(c["a"]`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1.0, 1.0)).xyz;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0.0)).xyz;
gl_Position = vec4(position, 1.0, 1.0);
}`),e.fragment.uniforms.add("lightingMainDirection","vec3").add("cubeMap","samplerCube"),e.fragment.include(s["a"]),e.fragment.include(o["a"]),e.include(n["a"]),e.include(r["a"],{pbrMode:0,lightingSphericalHarmonicsOrder:2}),e.include(a["a"]),e.fragment.code.add(c["a"]`void main() {
vec4 cloudsColor = crossFade == 0 ? renderCloud(normalize(worldRay)) : renderCloudCrossFade(normalize(worldRay));
gl_FragColor = vec4((1.0 - totalFadeInOut) * cloudsColor.rgb, cloudsColor.a);
}`),e}const h=Object.freeze({__proto__:null,build:d})},b33e:function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));class r{constructor(e,t,i){this._initialVelocity=e,this._stopVelocity=t,this._friction=i,this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}get duration(){return this._duration}isFinished(e){return e>this.duration}get friction(){return this._friction}value(e){return this.valueFromInitialVelocity(this._initialVelocity,e)}valueDelta(e,t){const i=this.value(e);return this.value(e+t)-i}valueFromInitialVelocity(e,t){t=Math.min(t,this.duration);const i=1-this.friction;return e*(i**t-1)/Math.log(i)}}},b3a9:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i("3886"),n=i("ee2c");function a(e,t){const i=e.vertex;switch(e.include(n["a"],t),e.attributes.add("sideness","vec2"),2===t.mode?i.code.add(r["a"]`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
float type;
};`):i.code.add(r["a"]`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
};`),t.mode){case 2:i.code.add(r["a"]`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float fType = component.type;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
if (fType <= 0.0) {
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
}
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels, fType);
}`);break;case 1:i.code.add(r["a"]`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case 0:i.code.add(r["a"]`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`)}}},b418:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var r=i("6d5b"),n=i("3626"),a=i("3886");function s(e,t){e.include(r["a"],t),e.fragment.include(n["a"]);const i=e.fragment;i.uniforms.add("uBaseColor","vec4"),i.uniforms.add("uObjectOpacity","float"),t.attributeColor?i.code.add(a["a"]`vec3 _baseColor() {
return uBaseColor.rgb * vColor.rgb;
}
float _baseOpacity() {
return uBaseColor.a * vColor.a;
}`):i.code.add(a["a"]`vec3 _baseColor() {
return uBaseColor.rgb;
}
float _baseOpacity() {
return uBaseColor.a;
}`),i.code.add(a["a"]`vec4 computeMaterialColor(vec4 textureColor, vec4 externalColor, int externalColorMixMode) {
vec3 baseColor = _baseColor();
float baseOpacity = _baseOpacity();
vec3 color = mixExternalColor(
baseColor,
textureColor.rgb,
externalColor.rgb,
externalColorMixMode
);
float opacity = uObjectOpacity * mixExternalOpacity(
baseOpacity,
textureColor.a,
externalColor.a,
externalColorMixMode
);
return vec4(color, opacity);
}`)}},b485:function(e,t,i){"use strict";i.d(t,"a",(function(){return d}));var r=i("a4ee"),n=(i("e06a"),i("59b2")),a=(i("b50f"),i("c120"),i("cea0"),i("afcf")),s=i("d386"),o=i("ab68"),c=i("9651"),l=i("5996");const d=e=>{let t=class extends e{constructor(){super(...arguments),this.copyright=null,this.minScale=0,this.maxScale=0,this.spatialReference=null,this.tileInfo=null,this.tilemapCache=null}readMinScale(e,t){return null!=t.minLOD&&null!=t.maxLOD?e:0}readMaxScale(e,t){return null!=t.minLOD&&null!=t.maxLOD?e:0}get supportsBlankTile(){return this.version>=10.2}readTilemapCache(e,t){return t.capabilities&&t.capabilities.indexOf("Tilemap")>-1?new c["a"]({layer:this}):null}};return Object(r["a"])([Object(n["b"])({json:{read:{source:"copyrightText"}}})],t.prototype,"copyright",void 0),Object(r["a"])([Object(n["b"])()],t.prototype,"minScale",void 0),Object(r["a"])([Object(a["a"])("service","minScale")],t.prototype,"readMinScale",null),Object(r["a"])([Object(n["b"])()],t.prototype,"maxScale",void 0),Object(r["a"])([Object(a["a"])("service","maxScale")],t.prototype,"readMaxScale",null),Object(r["a"])([Object(n["b"])({type:l["a"]})],t.prototype,"spatialReference",void 0),Object(r["a"])([Object(n["b"])({readOnly:!0})],t.prototype,"supportsBlankTile",null),Object(r["a"])([Object(n["b"])(o["b"])],t.prototype,"tileInfo",void 0),Object(r["a"])([Object(n["b"])()],t.prototype,"tilemapCache",void 0),Object(r["a"])([Object(a["a"])("service","tilemapCache",["capabilities"])],t.prototype,"readTilemapCache",null),Object(r["a"])([Object(n["b"])()],t.prototype,"version",void 0),t=Object(r["a"])([Object(s["a"])("esri.layers.mixins.ArcGISCachedService")],t),t}},b49d:function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return s}));var r=i("b09a"),n=i("3886");function a(e,t){e.attributes.add("featureValue","vec4"),e.vertex.code.add(n["a"]`bool isCapVertex() {
return featureValue.w == 1.0;
}`),e.vertex.uniforms.add("size","vec3"),t.vvSize?(e.vertex.uniforms.add("vvSizeMinSize","vec3"),e.vertex.uniforms.add("vvSizeMaxSize","vec3"),e.vertex.uniforms.add("vvSizeOffset","vec3"),e.vertex.uniforms.add("vvSizeFactor","vec3"),e.vertex.code.add(n["a"]`vec2 getSize() {
return size.xy*clamp(vvSizeOffset + featureValue.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;
}`)):e.vertex.code.add(n["a"]`vec2 getSize(){
return size.xy;
}`),t.vvOpacity?(e.vertex.constants.add("vvOpacityNumber","int",8),e.vertex.code.add(n["a"]`uniform float vvOpacityValues[vvOpacityNumber];
uniform float vvOpacityOpacities[vvOpacityNumber];
vec4 applyOpacity(vec4 color) {
float value = featureValue.z;
if (value <= vvOpacityValues[0]) {
return vec4( color.xyz, vvOpacityOpacities[0]);
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));
}
}
return vec4( color.xyz, vvOpacityOpacities[vvOpacityNumber - 1]);
}`)):e.vertex.code.add(n["a"]`vec4 applyOpacity(vec4 color){
return color;
}`),t.vvColor?(e.vertex.constants.add("vvColorNumber","int",8),e.vertex.code.add(n["a"]`uniform float vvColorValues[vvColorNumber];
uniform vec4 vvColorColors[vvColorNumber];
vec4 getColor() {
float value = featureValue.y;
if (value <= vvColorValues[0]) {
return applyOpacity(vvColorColors[0]);
}
for (int i = 1; i < vvColorNumber; ++i) {
if (vvColorValues[i] >= value) {
float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
return applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));
}
}
return applyOpacity(vvColorColors[vvColorNumber - 1]);
}`)):e.vertex.code.add(n["a"]`vec4 getColor(){
return applyOpacity(vec4(1, 1, 1, 1));
}`),e.include(r["a"]),e.attributes.add("profileRight","vec4"),e.attributes.add("profileUp","vec4"),e.attributes.add("profileVertexAndNormal","vec4"),e.vertex.code.add(n["a"]`vec3 calculateVPos() {
vec2 size = getSize();
vec3 origin = position;
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileVertex = profileVertexAndNormal.xy * size;
vec2 profileNormal = profileVertexAndNormal.zw;
float positionOffsetAlongProfilePlaneNormal = 0.0;
float normalOffsetAlongProfilePlaneNormal = 0.0;`),e.vertex.code.add(n["a"]`if(!isCapVertex()) {
vec2 rotationRight = vec2(profileRight.w, profileUp.w);
float maxDistance = length(rotationRight);`),e.vertex.code.add(n["a"]`rotationRight = maxDistance > 0.0 ? normalize(rotationRight) : vec2(0, 0);
float rx = dot(profileVertex, rotationRight);
if (abs(rx) > maxDistance) {
vec2 rotationUp = vec2(-rotationRight.y, rotationRight.x);
float ry = dot(profileVertex, rotationUp);
profileVertex = rotationRight * maxDistance * sign(rx) + rotationUp * ry;
}
}else{
positionOffsetAlongProfilePlaneNormal = profileRight.w * size[0];
normalOffsetAlongProfilePlaneNormal = profileUp.w;
}
vec3 offset = right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;
return origin + offset;
}`),e.vertex.code.add(n["a"]`vec3 localNormal() {
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileNormal = profileVertexAndNormal.zw;
vec3 normal = right * profileNormal.x + up * profileNormal.y;
if(isCapVertex()) {
normal += forward * profileUp.w;
}
return normal;
}`)}function s(e,t){t.vvSizeEnabled&&(e.setUniform3fv("vvSizeMinSize",t.vvSizeMinSize),e.setUniform3fv("vvSizeMaxSize",t.vvSizeMaxSize),e.setUniform3fv("vvSizeOffset",t.vvSizeOffset),e.setUniform3fv("vvSizeFactor",t.vvSizeFactor)),t.vvColorEnabled&&(e.setUniform1fv("vvColorValues",t.vvColorValues),e.setUniform4fv("vvColorColors",t.vvColorColors)),t.vvOpacityEnabled&&(e.setUniform1fv("vvOpacityValues",t.vvOpacityValues),e.setUniform1fv("vvOpacityOpacities",t.vvOpacityOpacities))}},b4c2:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("3886");function n(e){e.vertex.code.add(r["a"]`vec3 applySkirts(inout vec2 uv, vec3 vpos, vec3 vnormal, float skirtScale) {
float skirtLength = 0.0;
if (uv.x >= 2.0) {
skirtLength = uv.y * skirtScale;
vec2 x = vec2(uv.x) - vec2(3.5, 4.5);
uv = clamp(vec2(1.5) - abs(x), vec2(0.0), vec2(1.0));
}
return vpos - vnormal * skirtLength;
}`)}},b4c8:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var r,n=i("dae5"),a=i("47f8");!function(e){e.Default={vvSizeEnabled:!1,vvSizeMinSize:Object(a["d"])(1,1,1),vvSizeMaxSize:Object(a["d"])(100,100,100),vvSizeOffset:Object(a["d"])(0,0,0),vvSizeFactor:Object(a["d"])(1,1,1),vvSizeValue:Object(a["d"])(1,1,1),vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],vvOpacityEnabled:!1,vvOpacityValues:[0,0,0,0,0,0,0,0],vvOpacityOpacities:[1,1,1,1,1,1,1,1],vvSymbolAnchor:[0,0,0],vvSymbolRotationMatrix:Object(n["b"])()}}(r||(r={}));const s=r},b616:function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var r=i("8a44"),n=i("e431"),a=i("0b2d"),s=i("1153");class o{constructor(e,t,i,r){this.primitiveIndices=e,this._numIndexPerPrimitive=t,this.indices=i,this.position=r,this.center=Object(a["f"])(),Object(s["a"])(e.length>=1),Object(s["a"])(i.length%this._numIndexPerPrimitive==0),Object(s["a"])(i.length>=e.length*this._numIndexPerPrimitive),Object(s["a"])(3===r.size||4===r.size);const{data:o,size:l}=r,d=e.length;let h=l*i[this._numIndexPerPrimitive*e[0]];c.clear(),c.push(h),this.bbMin=Object(a["h"])(o[h],o[h+1],o[h+2]),this.bbMax=Object(a["d"])(this.bbMin);for(let n=0;n<d;++n){const t=this._numIndexPerPrimitive*e[n];for(let e=0;e<this._numIndexPerPrimitive;++e){h=l*i[t+e],c.push(h);let r=o[h];this.bbMin[0]=Math.min(r,this.bbMin[0]),this.bbMax[0]=Math.max(r,this.bbMax[0]),r=o[h+1],this.bbMin[1]=Math.min(r,this.bbMin[1]),this.bbMax[1]=Math.max(r,this.bbMax[1]),r=o[h+2],this.bbMin[2]=Math.min(r,this.bbMin[2]),this.bbMax[2]=Math.max(r,this.bbMax[2])}}Object(n["l"])(this.center,this.bbMin,this.bbMax,.5),this.radius=.5*Math.max(Math.max(this.bbMax[0]-this.bbMin[0],this.bbMax[1]-this.bbMin[1]),this.bbMax[2]-this.bbMin[2]);let u=this.radius*this.radius;for(let n=0;n<c.length;++n){h=c.getItemAt(n);const e=o[h]-this.center[0],t=o[h+1]-this.center[1],i=o[h+2]-this.center[2],r=e*e+t*t+i*i;if(r<=u)continue;const a=Math.sqrt(r),s=.5*(a-this.radius);this.radius=this.radius+s,u=this.radius*this.radius;const l=s/a;this.center[0]+=e*l,this.center[1]+=t*l,this.center[2]+=i*l}c.clear()}getCenter(){return this.center}getBSRadius(){return this.radius}getBBMin(){return this.bbMin}getBBMax(){return this.bbMax}getChildren(){if(this._children)return this._children;if(Object(n["o"])(this.bbMin,this.bbMax)>1){const e=Object(n["l"])(Object(a["f"])(),this.bbMin,this.bbMax,.5),t=this.primitiveIndices.length,i=new Uint8Array(t),r=new Array(8);for(let n=0;n<8;++n)r[n]=0;const{data:s,size:c}=this.position;for(let n=0;n<t;++n){let t=0;const a=this._numIndexPerPrimitive*this.primitiveIndices[n];let o=c*this.indices[a],l=s[o],d=s[o+1],h=s[o+2];for(let e=1;e<this._numIndexPerPrimitive;++e){o=c*this.indices[a+e];const t=s[o],i=s[o+1],r=s[o+2];t<l&&(l=t),i<d&&(d=i),r<h&&(h=r)}l<e[0]&&(t|=1),d<e[1]&&(t|=2),h<e[2]&&(t|=4),i[n]=t,++r[t]}let l=0;for(let n=0;n<8;++n)r[n]>0&&++l;if(l<2)return;const d=new Array(8);for(let n=0;n<8;++n)d[n]=r[n]>0?new Uint32Array(r[n]):void 0;for(let n=0;n<8;++n)r[n]=0;for(let n=0;n<t;++n){const e=i[n];d[e][r[e]++]=this.primitiveIndices[n]}this._children=new Array(8);for(let n=0;n<8;++n)void 0!==d[n]&&(this._children[n]=new o(d[n],this._numIndexPerPrimitive,this.indices,this.position))}return this._children}static prune(){c.prune()}}const c=new r["a"]({deallocator:null})},b623:function(e,t,i){"use strict";i.d(t,"a",(function(){return c})),i.d(t,"b",(function(){return h})),i.d(t,"c",(function(){return u})),i.d(t,"d",(function(){return d})),i.d(t,"e",(function(){return l}));var r=i("b2b2"),n=i("d791"),a=i("afe1"),s=i("1153"),o=i("9cc4");function c(e,t){return Object(r["k"])(e)&&(e=[]),e.push(t),e}function l(e,t){if(Object(r["k"])(e))return null;const i=e.filter(e=>e!==t);return 0===i.length?null:i}function d(e){return!!Object(r["l"])(e)&&!e.visible}function h(e,t,i){const a=e.origin.vec3;Object(s["l"])(b,-a[0],-a[1],-a[2]),Object(r["l"])(e.transformation)?Object(n["n"])(t,b,e.transformation):Object(n["d"])(t,b),i&&(Object(n["c"])(i,t),Object(n["u"])(i,i))}function u(e,t,i,r,n){p[0]=e.get(t,0),p[1]=e.get(t,1),p[2]=e.get(t,2),Object(o["a"])(p,f,3),i.set(n,0,f[0]),r.set(n,0,f[1]),i.set(n,1,f[2]),r.set(n,1,f[3]),i.set(n,2,f[4]),r.set(n,2,f[5])}const p=new Float64Array(3),f=new Float32Array(6),b=Object(a["d"])()},b855:function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return s}));var r=i("02f1"),n=i("35b3");const a={waveStrength:.06,waveTextureRepeat:32,waveDirection:Object(r["f"])(1,0),waveVelocity:.05,flowStrength:.015,flowOffset:-.5,animationSpeed:.35,color:[0,0,0,0],transparent:!0,writeDepth:!0,slicePlaneEnabled:!1,isDraped:!1,receiveShadows:!0,ssrEnabled:!1,...n["b"]},s={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},"rippled-small":{waveStrength:.02,perturbationStrength:.09,textureRepeat:32,waveVelocity:.07},"slight-small":{waveStrength:.05,perturbationStrength:.07,textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,perturbationStrength:.015,textureRepeat:8,waveVelocity:.12},"moderate-medium":{waveStrength:.09,perturbationStrength:.03,textureRepeat:4,waveVelocity:.12},"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,waveVelocity:.15}}},ba58:function(e,t,i){"use strict";i.d(t,"a",(function(){return g})),i.d(t,"b",(function(){return M})),i.d(t,"c",(function(){return T})),i.d(t,"d",(function(){return R})),i.d(t,"e",(function(){return x})),i.d(t,"f",(function(){return A})),i.d(t,"g",(function(){return w})),i.d(t,"h",(function(){return E})),i.d(t,"i",(function(){return S})),i.d(t,"j",(function(){return j})),i.d(t,"k",(function(){return P}));var r=i("b2b2"),n=i("d791"),a=i("afe1"),s=i("02f1"),o=i("0b2d"),c=i("7577"),l=i("0fc4"),d=i("8188"),h=i("4261"),u=i("9180"),p=i("57e5"),f=i("32ed"),b=i("1a54"),m=i("d3cf");function g(e,t){if("point"===e.type)return _(e,t,!1);if(Object(m["d"])(e))switch(e.type){case"extent":return _(e.center,t,!1);case"polygon":return _(e.centroid,t,!1);case"polyline":return _(v(e),t,!0);case"mesh":return _(e.origin,t,!1)}else switch(e.type){case"extent":return _(y(e),t,!0);case"polygon":return _(O(e),t,!0);case"polyline":return _(v(e),t,!0)}}function v(e){const t=e.paths[0];if(!t||0===t.length)return null;const i=Object(f["f"])(t,Object(f["e"])(t)/2);return Object(b["j"])(i[0],i[1],i[2],e.spatialReference)}function y(e){const t=isFinite(e.zmin);return Object(b["j"])(.5*(e.xmax+e.xmin),.5*(e.ymax+e.ymin),t?.5*(e.zmax+e.zmin):void 0,e.spatialReference)}function O(e){const t=e.rings[0];if(!t||0===t.length)return null;const i=Object(p["b"])(e.rings,e.hasZ);return Object(b["j"])(i[0],i[1],i[2],e.spatialReference)}function _(e,t,i){const r=i?e:Object(m["a"])(e);return t&&e?Object(d["s"])(e,r,t)?r:null:r}function x(e,t,i,r=0){if(e){t||(t=Object(u["m"])());const n=e;let a=.5*n.width*(i-1),s=.5*n.height*(i-1);return n.width<1e-7*n.height?a+=s/20:n.height<1e-7*n.width&&(s+=a/20),Object(c["l"])(t,n.xmin-a-r,n.ymin-s-r,n.xmax+a+r,n.ymax+s+r),t}return null}function j(e,t){for(let i=0;i<e.geometries.length;++i){const r=e.geometries[i].getMutableAttribute("auxpos1");r&&r.data[3]!==t&&(r.data[3]=t,e.geometryVertexAttrsUpdated(e.geometryRecords[i]))}}function w(e,t){const i=Object(l["d"])(l["a"]);return Object(r["l"])(e)&&(i[0]=e[0],i[1]=e[1],i[2]=e[2]),Object(r["l"])(t)?i[3]=t:Object(r["l"])(e)&&e.length>3&&(i[3]=e[3]),i}function S(e,t,i,n,a,s=[0,0,0,0]){for(let o=0;o<3;++o)Object(r["l"])(e)&&null!=e[o]?s[o]=e[o]:Object(r["l"])(i)&&null!=i[o]?s[o]=i[o]:s[o]=a[o];return Object(r["l"])(t)?s[3]=t:Object(r["l"])(n)?s[3]=n:s[3]=a[3],s}function T(e=o["a"],t,i,n=1){const a=new Array(3);if(Object(r["k"])(t)||Object(r["k"])(i))a[0]=1,a[1]=1,a[2]=1;else{let r,n=0;for(let s=2;s>=0;s--){const o=e[s];let c;const l=null!=o,d=0===s&&!r&&!l,h=i[s];"symbol-value"===o||d?c=0!==h?t[s]/h:1:l&&"proportional"!==o&&isFinite(o)&&(c=0!==h?o/h:1),null!=c&&(a[s]=c,r=c,n=Math.max(n,Math.abs(c)))}for(let e=2;e>=0;e--)null==a[e]?a[e]=r:0===a[e]&&(a[e]=.001*n)}for(let r=2;r>=0;r--)a[r]/=n;return Object(o["g"])(a)}function C(e){return null!=e.isPrimitive}function P(e){return C(e)&&(e=[e.width,e.depth,e.height]),A(e)?null:"Symbol sizes may not be negative values"}function A(e){if(Array.isArray(e)){for(const t of e)if(!A(t))return!1;return!0}return null==e||e>=0}function M(e,t,i,r=Object(a["d"])()){const s=e||0,o=t||0,c=i||0;return 0!==s&&Object(n["s"])(r,r,-s/180*Math.PI),0!==o&&Object(n["e"])(r,r,o/180*Math.PI),0!==c&&Object(n["k"])(r,r,c/180*Math.PI),r}function R(e,t){return null!=t.minDemResolution?t.minDemResolution:Object(h["y"])(e)?t.minDemResolutionForPoints:.01*Object(h["z"])(e)}const E={"bottom-left":Object(s["f"])(0,0),bottom:Object(s["f"])(.5,0),"bottom-right":Object(s["f"])(1,0),left:Object(s["f"])(0,.5),center:Object(s["f"])(.5,.5),right:Object(s["f"])(1,.5),"top-left":Object(s["f"])(0,1),top:Object(s["f"])(.5,1),"top-right":Object(s["f"])(1,1)}},bc05:function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return s})),i.d(t,"c",(function(){return n})),i.d(t,"d",(function(){return o}));i("b2b2");var r=i("cba1");function n(e,t,i,r,n,a){const s=i-n;if(s>=0)return(t>>s)+(r-(a<<s))*(e>>s);const o=-s;return t-(a-(r<<o))*(e>>o)<<o}class a{constructor(e,t,i){this._rows=Math.ceil(t/i),this._columns=Math.ceil(e/i),this._cellSize=i,this.cells=new Array(this._rows);for(let r=0;r<this._rows;r++){this.cells[r]=new Array(this._columns);for(let e=0;e<this._columns;e++)this.cells[r][e]=[]}}getCell(e,t){const i=Math.min(Math.max(Math.floor(t/this._cellSize),0),this._rows-1),r=Math.min(Math.max(Math.floor(e/this._cellSize),0),this._columns-1);return this.cells[i]&&this.cells[i][r]||null}getCellSpan(e,t,i,r){return[Math.min(Math.max(Math.floor(e/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(t/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(i/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(r/this._cellSize),0),this.rows-1)]}get cellSize(){return this._cellSize}get columns(){return this._columns}get rows(){return this._rows}}function s(e,t,i,n,a,s){const o=t[n++];for(let c=0;c<o;c++){const o=new r["a"](s);o.xTile=t[n++],o.yTile=t[n++],o.hash=t[n++],o.priority=t[n++];const c=t[n++];for(let e=0;e<c;e++){const e=t[n++],r=t[n++],a=t[n++],s=t[n++],c=!!t[n++],l=t[n++],d=i[n++],h=i[n++],u=t[n++],p=t[n++];o.colliders.push({xTile:e,yTile:r,dxPixels:a,dyPixels:s,hard:c,partIndex:l,width:u,height:p,minLod:d,maxLod:h})}const l=e[n++];for(let t=0;t<l;t++)o.textVertexRanges.push([e[n++],e[n++]]);const d=e[n++];for(let t=0;t<d;t++)o.iconVertexRanges.push([e[n++],e[n++]]);a.push(o)}return n}function o(e,t,i){for(const[r,n]of e.symbols)c(e,t,i,n,r)}function c(e,t,i,r,n){const a=e.layerData.get(n);if(3===a.type){for(const t of r){const r=t.unique;let n;if(t.selectedForRendering){const t=r.parts[0],a=t.startOpacity,s=t.targetOpacity;e.allSymbolsFadingOut=e.allSymbolsFadingOut&&0===s;const o=i?Math.floor(127*a)|s<<7:s?255:0;n=o<<24|o<<16|o<<8|o}else n=0;for(const[e,i]of t.iconVertexRanges)for(let t=e;t<e+i;t+=4)a.iconOpacity[t/4]=n;if(t.selectedForRendering){const t=r.parts[1],a=t.startOpacity,s=t.targetOpacity;e.allSymbolsFadingOut=e.allSymbolsFadingOut&&0===s;const o=i?Math.floor(127*a)|s<<7:s?255:0;n=o<<24|o<<16|o<<8|o}else n=0;for(const[e,i]of t.textVertexRanges)for(let t=e;t<e+i;t+=4)a.textOpacity[t/4]=n}a.lastOpacityUpdate=t,a.opacityChanged=!0}}},bc40:function(e,t,i){"use strict";i.d(t,"a",(function(){return l}));var r=i("dae5"),n=i("afe1"),a=i("0b2d"),s=i("b09a"),o=i("6a21"),c=i("3886");function l(e,t){e.include(s["a"]),e.vertex.include(o["a"],t),e.varyings.add("vPositionWorldCameraRelative","vec3"),e.varyings.add("vPosition_view","vec3"),e.vertex.uniforms.add("uTransform_WorldFromModel_RS","mat3"),e.vertex.uniforms.add("uTransform_WorldFromModel_TH","vec3"),e.vertex.uniforms.add("uTransform_WorldFromModel_TL","vec3"),e.vertex.uniforms.add("uTransform_WorldFromView_TH","vec3"),e.vertex.uniforms.add("uTransform_WorldFromView_TL","vec3"),e.vertex.uniforms.add("uTransform_ViewFromCameraRelative_RS","mat3"),e.vertex.uniforms.add("uTransform_ProjFromView","mat4"),e.vertex.code.add(c["a"]`vec3 positionWorldCameraRelative() {
vec3 rotatedModelPosition = uTransform_WorldFromModel_RS * positionModel();
vec3 transform_CameraRelativeFromModel = dpAdd(
uTransform_WorldFromModel_TL,
uTransform_WorldFromModel_TH,
-uTransform_WorldFromView_TL,
-uTransform_WorldFromView_TH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}
vec3 position_view() {
return uTransform_ViewFromCameraRelative_RS * positionWorldCameraRelative();
}
void forwardPosition() {
vPositionWorldCameraRelative = positionWorldCameraRelative();
vPosition_view = position_view();
gl_Position = uTransform_ProjFromView * vec4(vPosition_view, 1.0);
}
vec3 positionWorld() {
return uTransform_WorldFromView_TL + vPositionWorldCameraRelative;
}`),e.fragment.uniforms.add("uTransform_WorldFromView_TL","vec3"),e.fragment.code.add(c["a"]`vec3 positionWorld() {
return uTransform_WorldFromView_TL + vPositionWorldCameraRelative;
}`)}!function(e){class t{constructor(){this.worldFromModel_RS=Object(r["b"])(),this.worldFromModel_TH=Object(a["f"])(),this.worldFromModel_TL=Object(a["f"])()}}e.ModelTransform=t;class i{constructor(){this.worldFromView_TH=Object(a["f"])(),this.worldFromView_TL=Object(a["f"])(),this.viewFromCameraRelative_RS=Object(r["b"])(),this.projFromView=Object(n["d"])()}}function s(e,t){e.setUniformMatrix3fv("uTransform_WorldFromModel_RS",t.worldFromModel_RS),e.setUniform3fv("uTransform_WorldFromModel_TH",t.worldFromModel_TH),e.setUniform3fv("uTransform_WorldFromModel_TL",t.worldFromModel_TL)}function o(e,t){e.setUniform3fv("uTransform_WorldFromView_TH",t.worldFromView_TH),e.setUniform3fv("uTransform_WorldFromView_TL",t.worldFromView_TL),e.setUniformMatrix4fv("uTransform_ProjFromView",t.projFromView),e.setUniformMatrix3fv("uTransform_ViewFromCameraRelative_RS",t.viewFromCameraRelative_RS)}e.ViewProjectionTransform=i,e.bindModelTransform=s,e.bindViewProjTransform=o}(l||(l={}))},bd75:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("3886");function n(e,t){0===t.output&&t.receiveShadows?(e.varyings.add("linearDepth","float"),e.vertex.code.add(r["a"]`void forwardLinearDepth() { linearDepth = gl_Position.w; }`)):1===t.output||3===t.output?(e.varyings.add("linearDepth","float"),e.vertex.uniforms.add("cameraNearFar","vec2"),e.vertex.code.add(r["a"]`void forwardLinearDepth() {
linearDepth = (-position_view().z - cameraNearFar[0]) / (cameraNearFar[1] - cameraNearFar[0]);
}`)):e.vertex.code.add(r["a"]`void forwardLinearDepth() {}`)}},bd7e:function(e,t,i){"use strict";i.d(t,"a",(function(){return g})),i.d(t,"b",(function(){return m})),i.d(t,"c",(function(){return d})),i.d(t,"d",(function(){return c})),i.d(t,"e",(function(){return p})),i.d(t,"f",(function(){return u})),i.d(t,"g",(function(){return h})),i.d(t,"h",(function(){return f})),i.d(t,"i",(function(){return b}));var r=i("38a4"),n=i("2119"),a=i("e431"),s=i("0b2d"),o=i("7361");function c(e){return e?{origin:Object(s["d"])(e.origin),vector:Object(s["d"])(e.vector)}:{origin:Object(s["f"])(),vector:Object(s["f"])()}}function l(e,t){const i=O.get();return i.origin=e,i.vector=t,i}function d(e,t=c()){return h(e.origin,e.vector,t)}function h(e,t,i=c()){return Object(a["n"])(i.origin,e),Object(a["n"])(i.vector,t),i}function u(e,t,i=c()){return Object(a["n"])(i.origin,e),Object(a["m"])(i.vector,t,e),i}function p(e,t){const i=Object(a["m"])(o["d"].get(),t,e.origin),n=Object(a["k"])(e.vector,i),s=Object(a["k"])(e.vector,e.vector),c=Object(r["f"])(n/s,0,1),l=Object(a["m"])(o["d"].get(),Object(a["h"])(o["d"].get(),e.vector,c),i);return Object(a["k"])(l,l)}function f(e,t,i){return Object(a["i"])(i,e.origin,Object(a["h"])(i,e.vector,t))}function b(e,t,i,n,s){const{vector:c,origin:l}=e,d=Object(a["m"])(o["d"].get(),t,l),h=Object(a["k"])(c,d)/Object(a["w"])(c);return Object(a["h"])(s,c,Object(r["f"])(h,i,n)),Object(a["i"])(s,s,e.origin)}function m(e,t){if(v(e,l(t.origin,t.direction),!1,y)){const{tA:t,pB:i,distance2:r}=y;if(t>=0&&t<=1)return r;if(t<0)return Object(a["o"])(e.origin,i);if(t>1)return Object(a["o"])(Object(a["i"])(o["d"].get(),e.origin,e.vector),i)}return null}function g(e,t,i){return!!v(e,t,!0,y)&&(Object(a["n"])(i,y.pA),!0)}function v(e,t,i,n){const s=1e-6,c=e.origin,l=Object(a["i"])(o["d"].get(),c,e.vector),d=t.origin,h=Object(a["i"])(o["d"].get(),d,t.vector),u=o["d"].get(),p=o["d"].get();if(u[0]=c[0]-d[0],u[1]=c[1]-d[1],u[2]=c[2]-d[2],p[0]=h[0]-d[0],p[1]=h[1]-d[1],p[2]=h[2]-d[2],Math.abs(p[0])<s&&Math.abs(p[1])<s&&Math.abs(p[2])<s)return!1;const f=o["d"].get();if(f[0]=l[0]-c[0],f[1]=l[1]-c[1],f[2]=l[2]-c[2],Math.abs(f[0])<s&&Math.abs(f[1])<s&&Math.abs(f[2])<s)return!1;const b=u[0]*p[0]+u[1]*p[1]+u[2]*p[2],m=p[0]*f[0]+p[1]*f[1]+p[2]*f[2],g=u[0]*f[0]+u[1]*f[1]+u[2]*f[2],v=p[0]*p[0]+p[1]*p[1]+p[2]*p[2],y=(f[0]*f[0]+f[1]*f[1]+f[2]*f[2])*v-m*m;if(Math.abs(y)<s)return!1;let O=(b*m-g*v)/y,_=(b+m*O)/v;i&&(O=Object(r["f"])(O,0,1),_=Object(r["f"])(_,0,1));const x=o["d"].get(),j=o["d"].get();return x[0]=c[0]+O*f[0],x[1]=c[1]+O*f[1],x[2]=c[2]+O*f[2],j[0]=d[0]+_*p[0],j[1]=d[1]+_*p[1],j[2]=d[2]+_*p[2],n.tA=O,n.tB=_,n.pA=x,n.pB=j,n.distance2=Object(a["o"])(x,j),!0}const y={tA:0,tB:0,pA:Object(s["f"])(),pB:Object(s["f"])(),distance2:0},O=new n["a"](()=>({origin:null,vector:null}))},bdba:function(e,t,i){"use strict";i.d(t,"a",(function(){return p}));var r=i("2eab"),n=i("e92d"),a=i("b2b2"),s=i("f4cc"),o=i("477c"),c=i("b2cd");function l(e){return new Promise(t=>i.e("chunk-2d0c7903").then(i.bind(null,"50c5")).then(e=>e.v).then(({default:i})=>{const r=i({locateFile:d,preinitializedWebGLContext:e,onRuntimeInitialized:()=>t(r)})})).catch(e=>Promise.reject(e))}function d(e){return Object(c["b"])("esri/libs/vxl/"+e)}const h=n["a"].getLogger("esri.layers.VoxelWasmPerScene");class u{constructor(e){this._halfIntTexturesAvailable=!1,this._havePreparedWithAllLayers=!1,this._renderPluginContext=null,this._vxl=null,this._pluginIsActive=!1,this._moreToLoad=!1,this._viewportWidth=-1,this._viewportHeight=-1,this._newLayers=[],this._layers=new Map,this._renderPass=0,this._renderSlot=22,this._rctx=null,this._renderTargetToRestore=null,this._lastFrameWasStationary=!1,this._wasmMemBlockSizes=[512,1024,2048,4096,8192,16384,32768,65536],this._wasmMemBlocks=new Map,this._dbgFlags=new Set,this._view=e,this.initialize()}get canRender(){return!!this._vxl&&"local"===this._view.viewingMode}dbg(e,t){this._dbgFlags.has(e)&&(4===e?h.error(t):h.warn(t))}removeRenderPlugin(){this._pluginIsActive&&this._view._stage&&(this.dbg(1,"--removeRenderPlugin--"),this._view._stage.removeRenderPlugin(this)),this._pluginIsActive=!1}initialize(){this.dbg(1,"--initialize--");for(const e of this._wasmMemBlockSizes)this._wasmMemBlocks.set(e,0);this._readyWatchHandle=Object(o["b"])(()=>this._view.ready,e=>{e&&"local"===this._view.viewingMode?(this.dbg(1,"view ready status changed to ready on a local view, calling addRenderPlugin"),this._view._stage.addRenderPlugin([this._renderSlot],this),this._pluginIsActive=!0):(this.dbg(1,"view ready status changed, not ready or not a local view!"),this.removeRenderPlugin())},{initial:!0}),this._qualityWatchHandle=Object(o["b"])(()=>{var e;return null==(e=this._view)?void 0:e.qualityProfile},e=>{this.dbg(3,"qualityProfile changed to "+e),this._vxl&&this._vxl.set_quality(this.toWasmQuality(e))},{initial:!0}),this._timeExtentWatchHandle=Object(o["b"])(()=>{var e;return null==(e=this._view)?void 0:e.timeExtent},()=>{if(this._vxl){var e;const t=this._getTimeArgs(null==(e=this._view)?void 0:e.timeExtent);this.dbg(3,"sceneView timeExtent changed to useTime="+t.useTime+" st="+t.startTime+" et="+t.endTime),this._vxl.set_scene_time_extent(t.startTime,t.endTime,t.useTime),this._renderPluginContext.requestRender()}},{initial:!0}),this._stationaryWatchHandle=Object(o["b"])(()=>{var e;return null==(e=this._view)?void 0:e.stationary},e=>{this._vxl&&e&&!this._lastFrameWasStationary&&this._renderPluginContext.requestRender()})}initializeRenderContext(e){this.dbg(1,"--initializeRenderContext--");const t=e.renderContext.rctx;"webgl2"===t.webglVersion?(this._renderPluginContext=e,this._rctx=e.renderContext.rctx,this._halfIntTexturesAvailable=!!this._rctx.capabilities.textureNorm16,this.initializeWasm(t.gl)):this.dbg(4,"WebGL 1 context only!")}uninitializeRenderContext(){this._renderPluginContext=null,this._rctx=null,this.dbg(1,"--uninitializeRenderContext--")}restoreFramebuffer(){if(!this._renderTargetToRestore)return;const e=this._renderTargetToRestore.fbo;if(!this._rctx)return void this.dbg(4,"no context in restoreFramebuffer!");this._rctx.bindFramebuffer(e,!0);const t=this._renderTargetToRestore.viewport;this._rctx.setViewport(t.x,t.y,t.width,t.height)}bindPreviousDepthToSlot(e,t){const i=!!this._rctx,r=!!this._renderTargetToRestore;if(!i||!r)return 0;const n=this._renderTargetToRestore.fbo.depthStencilTexture;return n?(0===t?this._rctx.bindTexture(null,e,!0):this._rctx.bindTexture(n,e,!0),1):(this.dbg(4,"no depth/stencil texture exists!"),0)}setBlendState(e,t,i,r){this._rctx?(this._rctx.setBlendingEnabled(1===e),this._rctx.setBlendFunction(t,i),this._rctx.setBlendEquation(r)):this.dbg(4,"setBlendState callback has no rendering context!")}setFrontFace(e){this._rctx?this._rctx.setFrontFace(e):this.dbg(4,"setFrontFace callback has no rendering context!")}setDepthStencilStateFunction(e,t,i){this._rctx?(this._rctx.setDepthFunction(i),this._rctx.setDepthTestEnabled(1===e),this._rctx.setDepthWriteEnabled(1===t),this._rctx.setStencilTestEnabled(!1),this._rctx.setStencilFunction(519,0,255),this._rctx.setStencilOpSeparate(1028,7680,7682,7680),this._rctx.setStencilOpSeparate(1029,7680,7683,7680)):this.dbg(4,"setDepthStencilStateFunction callback has no rendering context!")}setRasterizerState(e){if(this._rctx)switch(e){case 1:this._rctx.setFaceCullingEnabled(!1);break;case 3:this._rctx.setCullFace(1029),this._rctx.setFaceCullingEnabled(!0);break;case 2:this._rctx.setCullFace(1028),this._rctx.setFaceCullingEnabled(!0)}else this.dbg(4,"setRasterizerState callback has no rendering context!")}setViewport(e,t,i,r){this._rctx?this._rctx.setViewport(e,t,i,r):this.dbg(4,"setViewport callback has no rendering context!")}_syncRequestsResponses(){this._layers.forEach((e,t)=>{const i=[];e.responses.forEach((e,r)=>{i.push(r),this.dbg(2,"responding for requestID:"+r+" size:"+e.size),this._vxl.respond(t,r,e)});const n=e.responses;for(const r of i)n.delete(r);const a=this._vxl.get_new_requests(t),o=e.abortController.signal;for(const c in a){e.outstandingRequestCount+=1,1===e.outstandingRequestCount&&e.layerView.updatingFlagChanged();const t=a[c],i={responseType:"array-buffer",signal:o};this.dbg(2,"making requestID:"+c+" url:"+t.url),Object(r["default"])(t.url,i).then(i=>{e.outstandingRequestCount-=1,0===e.outstandingRequestCount&&e.layerView.updatingFlagChanged(),this.dbg(2,"have response for requestID:"+c);let r=0;if(i.data.byteLength>0){r=this._vxl._malloc(i.data.byteLength);const e=new Uint8Array(this._vxl.HEAPU8.buffer,r,i.data.byteLength),t=new Uint8Array(i.data);for(let r=0;r<i.data.byteLength;++r)e[r]=t[r]}n.set(+c,{type:t.type,ptr:r,size:i.data.byteLength,success:!0})}).catch(i=>{e.outstandingRequestCount-=1,0===e.outstandingRequestCount&&e.layerView.updatingFlagChanged(),Object(s["m"])(i)||(this.dbg(4,`requestID:${c} failed, error=${i.toString()}`),n.set(+c,{type:t.type,ptr:0,size:0,success:!1}))})}})}updateWasmCamera(e){this._vxl.set_projection_matrix.apply(this._vxl,e.projectionMatrix),this._vxl.set_view_matrix.apply(this._vxl,e.viewMatrix),this._vxl.set_near_far(e.near,e.far)}isUpdating(e){return!(this._vxl||!this._vxlPromise)||!!this._layers.has(e)&&this._layers.get(e).outstandingRequestCount>0}setEnabled(e,t){this._layers.forEach((i,r)=>{i.layerView===e&&(this._vxl.set_enabled(r,t),this._renderPluginContext.requestRender())})}setSlices(e,t){const i={mask:2,slices:{planes:t,currentEditPlane:-1}};return this._doMaskedUIUpdate(e,i,!0)}setDynamicSections(e,t){const i={mask:4,dynamicSections:{planes:t,currentEditPlane:-1}};return this._doMaskedUIUpdate(e,i,!0)}setStaticSections(e,t){const i={mask:1,staticSections:t};return this._doMaskedUIUpdate(e,i,!0)}setCurrentVariable(e,t){const i={mask:1024,currentVariable:t};return this._doMaskedUIUpdate(e,i,!0)}setRenderMode(e,t){const i={mask:8192,renderMode:t};return this._doMaskedUIUpdate(e,i,!0)}_doMaskedUIUpdate(e,t,i){if(!this._vxl)return!1;let r=!1;return this._layers.forEach((i,n)=>{if(i.layerView===e){const e={str:JSON.stringify(t),byteCount:0,ptr:0,isReusable:!1};this._AllocateBlock(e)&&(r=1===this._vxl.handle_masked_ui_update(n,e.ptr,e.byteCount),e.isReusable||this._vxl._free(e.ptr))}}),r&&i&&this._renderPluginContext.requestRender(),r}addVoxelLayer(e){if(!this._vxl){const t={layerView:e,resolveCallback:null,rejectCallback:null},i=new Promise((e,i)=>{t.resolveCallback=e,t.rejectCallback=i});return this._newLayers.push(t),i}const t=this._addVoxelLayer(e);return t<0?Promise.reject(-1):Promise.resolve(t)}removeVoxelLayer(e){if(!this._vxl){const t=this._newLayers.findIndex(t=>e===t.layerView);t>=0&&(this._newLayers[t].resolveCallback(-1),this._newLayers.splice(t,1));const i=this._newLayers.length;return 0===i&&(this.dbg(1," no voxel layers left after removing a layer, removing RenderPlugin and destroying"),this.destroy()),i}let t=-1;this._layers.forEach((i,r)=>{i.layerView===e&&(t=r,i.abortController.abort(),this._vxl.remove_layer(t))}),t>=0&&this._layers.delete(t);const i=this._layers.size;return 0===i&&(this.dbg(1," no voxel layers left after removing a layer, removing RenderPlugin and destroying"),this.destroy()),i}_getBlockSize(e){for(const t of this._wasmMemBlockSizes)if(e<t)return t;return-1}_AllocateBlock(e){e.byteCount=this._vxl.lengthBytesUTF8(e.str)+1;const t=this._getBlockSize(e.byteCount);return t<0?(e.isReusable=!1,e.ptr=this._vxl._malloc(e.byteCount)):(e.isReusable=!0,e.ptr=this._wasmMemBlocks.get(t),0===e.ptr&&(e.ptr=this._vxl._malloc(t),this._wasmMemBlocks.set(t,e.ptr))),0!==e.ptr&&(this._vxl.stringToUTF8(e.str,e.ptr,e.byteCount),!0)}_getTimeArgs(e){let t=-Number.MAX_VALUE,i=Number.MAX_VALUE,r=!1;return Object(a["l"])(e)&&(e.isAllTime?r=!0:(Object(a["l"])(e.start)&&(r=!0,t=e.start.getTime()/1e3),Object(a["l"])(e.end)&&(r=!0,i=e.end.getTime()/1e3))),{startTime:t,endTime:i,useTime:r}}_addVoxelLayer(e){var t;const i=e.layer;let r=-1;const n=i.getConfiguration();if(n.length<1)return-1;const a={str:n,byteCount:0,ptr:0,isReusable:!1};if(!this._AllocateBlock(a))return-1;const s=this._getTimeArgs(null==(t=this._view)?void 0:t.timeExtent),o=this._view.spatialReference.isWGS84&&i.spatialReference.isWGS84?111319.49079327357:1;if(r=this._vxl.add_layer(i.serviceRoot,a.ptr,a.byteCount,o,o,s.startTime,s.endTime,s.useTime,this.toWasmQuality(this._view.qualityProfile)),a.isReusable||this._vxl._free(a.ptr),r>=0){const t=new AbortController;if(this._layers.set(r,{layerView:e,responses:new Map,outstandingRequestCount:0,abortController:t}),!this._halfIntTexturesAvailable){const t=[];let i="";for(const r of e.layer.variables)"Int16"!==r.renderingFormat.type&&"UInt16"!==r.renderingFormat.type||(t.push(r.name),r.id===e.layer.style.currentVariableId&&(i=r.name));""!==i&&h.error("#addVoxelLayer_error()",e.layer,`The voxel layer '${e.layer.title}' cannot render the current variable '${i}' in this browser`),t.length>0&&h.warn("#addVoxelLayer_warning()",e.layer,`The voxel layer '${e.layer.title}' cannot render the variables '${t.toString()}' in this browser`)}return r}return-1}prepareRender(e){if(!this._vxl)return;const t=e.viewForward,i=e.eye;this._vxl.update_camera_pos_and_direction(i[0],i[1],i[2],t[0],t[1],t[2]);const r=this._vxl.cull();this.dbg(2,"missingResourceCount="+r),this._moreToLoad=r>0,this._havePreparedWithAllLayers=0===this._newLayers.length}render(e){if(!this._vxl||e.pass!==this._renderPass||e.slot!==this._renderSlot)return!1;for(const i of this._newLayers){const e=this._addVoxelLayer(i.layerView);-1===e?i.rejectCallback(-1):i.resolveCallback(e)}if(this._newLayers=[],0===this._layers.size)return this.dbg(4,"No voxel layers but RenderPlugin instance is being asked to render!"),!1;this._renderTargetToRestore={fbo:this._rctx.getBoundFramebufferObject(),viewport:this._rctx.getViewport()},this._syncRequestsResponses(),this._lastFrameWasStationary=this._view.stationary,this._vxl.begin_color_frame(!this._view.stationary||this._moreToLoad,e.scenelightingData.lightingMainDirection[0],e.scenelightingData.lightingMainDirection[1],e.scenelightingData.lightingMainDirection[2]);const t=this._renderTargetToRestore.viewport;return t.width===this._viewportWidth&&t.height===this._viewportHeight||(this._viewportWidth=t.width,this._viewportHeight=t.height,this._vxl.set_viewport(t.width,t.height)),0===t.x&&0===t.y||this.dbg(4,"Unsupported viewport parameters detected!"),this.updateWasmCamera(e.camera),this._vxl.draw(),this._renderTargetToRestore.fbo=null,e.rctx.externalTextureUnitUpdate(this._vxl.get_texture_units_bound_in_frame(),this._vxl.get_active_texture_unit()),e.rctx.externalVertexArrayObjectUpdate(),e.rctx.externalVertexBufferUpdate(),this._rctx.externalProgramUpdate(),(this._moreToLoad||!this._havePreparedWithAllLayers&&this._layers.size>0)&&this._renderPluginContext.requestRender(),!0}destroy(){this.dbg(1,"--destroy--"),this.removeRenderPlugin(),this._readyWatchHandle=Object(a["t"])(this._readyWatchHandle),this._qualityWatchHandle=Object(a["t"])(this._qualityWatchHandle),this._timeExtentWatchHandle=Object(a["t"])(this._timeExtentWatchHandle),this._stationaryWatchHandle=Object(a["t"])(this._stationaryWatchHandle),this._vxl&&(this._layers.forEach(e=>{e.abortController.abort()}),this._wasmMemBlocks.forEach(e=>{0!==e&&this._vxl._free(e)}),this._vxl.uninitialize_voxel_wasm(),this._vxl=null)}initializeWasm(e){return this._vxl?Promise.resolve():(this._vxlPromise||(this._vxlPromise=l(e).then(e=>{var t;if(this._vxl=e,this._vxlPromise=null,this._newLayers.length<=0)return this.dbg(1," no voxel layers left after WASM downloaded, removing RenderPlugin and destroying"),void this.destroy();const i=this._getTimeArgs(null==(t=this._view)?void 0:t.timeExtent),r=this._vxl.addFunction(this.restoreFramebuffer.bind(this),"v"),n=this._vxl.addFunction(this.setBlendState.bind(this),"viiii"),a=this._vxl.addFunction(this.setFrontFace.bind(this),"vi"),s=this._vxl.addFunction(this.setRasterizerState.bind(this),"vi"),o=this._vxl.addFunction(this.setDepthStencilStateFunction.bind(this),"viii"),c=this._vxl.addFunction(this.setViewport.bind(this),"viiii"),l=this._vxl.addFunction(this.bindPreviousDepthToSlot.bind(this),"iii");this._vxl.initialize_voxel_wasm(r,n,a,s,o,c,l,i.startTime,i.endTime,i.useTime),this._renderPluginContext&&this._renderPluginContext.requestRender()}).catch(()=>{for(const e of this._newLayers)e.rejectCallback(-2);this.dbg(4," WASM failed to download, removing RenderPlugin and destroying"),this.destroy()})),this._vxlPromise)}pickDepth(e,t,i){if(!this._vxl||!this._rctx||0===this._layers.size)return null;const r=i.viewport[3]-t;if(e<0||e>i.viewport[2]||t<0||t>i.viewport[3])return this.dbg(4,`pickDepth: outOfRange, screenXY=[${e}, ${r}], vp=[${i.viewport.toString()}]`),null;this._renderTargetToRestore={fbo:this._rctx.getBoundFramebufferObject(),viewport:this._rctx.getViewport()};const n=i.viewForward,a=i.eye;this._vxl.update_camera_pos_and_direction(a[0],a[1],a[2],n[0],n[1],n[2]),this.updateWasmCamera(i),this._vxl.begin_frame();const s=this._vxl.pick_depth(e,r);return this._renderTargetToRestore.fbo=null,this._rctx.externalTextureUnitUpdate(this._vxl.get_texture_units_bound_in_frame(),this._vxl.get_active_texture_unit()),this._rctx.externalVertexArrayObjectUpdate(),this._rctx.externalVertexBufferUpdate(),this._rctx.externalProgramUpdate(),s.success?s.distanceToCamera:null}toWasmQuality(e){switch(e){case"low":return 0;case"medium":return 1;case"high":return 2}}}class p{constructor(){this.view2WASM=new Map}static getInstance(){return p.instance||(p.instance=new p),p.instance}getVoxelWasmPerSceneView(e){return this.view2WASM.has(e)?this.view2WASM.get(e):null}isUpdating(e,t){return!!this.view2WASM.has(e)&&this.view2WASM.get(e).isUpdating(t)}addLayer(e,t){return this.view2WASM.has(e)||this.view2WASM.set(e,new u(e)),this.view2WASM.get(e).addVoxelLayer(t)}removeLayer(e,t){this.view2WASM.has(e)&&this.view2WASM.get(e).removeVoxelLayer(t)<1&&this.view2WASM.delete(e)}setLayerEnabled(e,t,i){this.view2WASM.has(e)&&this.view2WASM.get(e).setEnabled(t,i)}setLayerSlices(e,t){let i=!1;return this.view2WASM.forEach((r,n)=>{n.allLayerViews.filter(e=>"voxel-3d"===e.type).forEach(n=>{n.layer===e&&(i=r.setSlices(n,t))})}),i}setLayerDynamicSections(e,t){let i=!1;return this.view2WASM.forEach((r,n)=>{n.allLayerViews.filter(e=>"voxel-3d"===e.type).forEach(n=>{n.layer===e&&(i=r.setDynamicSections(n,t))})}),i}setLayerCurrentVariable(e,t){let i=!1;return this.view2WASM.forEach((r,n)=>{n.allLayerViews.filter(e=>"voxel-3d"===e.type).forEach(n=>{n.layer===e&&(i=r.setCurrentVariable(n,t))})}),i}setLayerRenderMode(e,t){let i=!1;return this.view2WASM.forEach((r,n)=>{n.allLayerViews.filter(e=>"voxel-3d"===e.type).forEach(n=>{n.layer===e&&(i=r.setRenderMode(n,t))})}),i}setLayerStaticSections(e,t){let i=!1;return this.view2WASM.forEach((r,n)=>{n.allLayerViews.filter(e=>"voxel-3d"===e.type).forEach(n=>{n.layer===e&&(i=r.setStaticSections(n,t))})}),i}}},be24:function(e,t,i){"use strict";i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return a})),i.d(t,"c",(function(){return o})),i.d(t,"d",(function(){return s}));var r=i("3886");function n(e,t){t.vvInstancingEnabled&&(t.vvSize||t.vvColor)&&e.attributes.add("instanceFeatureAttribute","vec4"),t.vvSize?(e.vertex.uniforms.add("vvSizeMinSize","vec3"),e.vertex.uniforms.add("vvSizeMaxSize","vec3"),e.vertex.uniforms.add("vvSizeOffset","vec3"),e.vertex.uniforms.add("vvSizeFactor","vec3"),e.vertex.uniforms.add("vvSymbolRotationMatrix","mat3"),e.vertex.uniforms.add("vvSymbolAnchor","vec3"),e.vertex.code.add(r["a"]`vec3 vvScale(vec4 _featureAttribute) {
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),e.vertex.code.add(r["a"]`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);
        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);
      }

      ${t.vvInstancingEnabled?r["a"]`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):e.vertex.code.add(r["a"]`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`),t.vvColor?(e.vertex.constants.add("vvColorNumber","int",8),e.vertex.code.add(r["a"]`
      uniform float vvColorValues[vvColorNumber];
      uniform vec4 vvColorColors[vvColorNumber];

      vec4 vvGetColor(vec4 featureAttribute, float values[vvColorNumber], vec4 colors[vvColorNumber]) {
        float value = featureAttribute.y;
        if (value <= values[0]) {
          return colors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (values[i] >= value) {
            float f = (value - values[i-1]) / (values[i] - values[i-1]);
            return mix(colors[i-1], colors[i], f);
          }
        }
        return colors[vvColorNumber - 1];
      }

      ${t.vvInstancingEnabled?r["a"]`
      vec4 vvColor() {
        return vvGetColor(instanceFeatureAttribute, vvColorValues, vvColorColors);
      }`:""}
    `)):e.vertex.code.add(r["a"]`vec4 vvColor() { return vec4(1.0); }`)}function a(e,t){t.vvSizeEnabled&&(e.setUniform3fv("vvSizeMinSize",t.vvSizeMinSize),e.setUniform3fv("vvSizeMaxSize",t.vvSizeMaxSize),e.setUniform3fv("vvSizeOffset",t.vvSizeOffset),e.setUniform3fv("vvSizeFactor",t.vvSizeFactor)),t.vvColorEnabled&&(e.setUniform1fv("vvColorValues",t.vvColorValues),e.setUniform4fv("vvColorColors",t.vvColorColors))}function s(e,t){a(e,t),t.vvOpacityEnabled&&(e.setUniform1fv("vvOpacityValues",t.vvOpacityValues),e.setUniform1fv("vvOpacityOpacities",t.vvOpacityOpacities))}function o(e,t){a(e,t),t.vvSizeEnabled&&(e.setUniform3fv("vvSymbolAnchor",t.vvSymbolAnchor),e.setUniformMatrix3fv("vvSymbolRotationMatrix",t.vvSymbolRotationMatrix))}},bea9:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("f2e0");class n{constructor(e){this.channel=e,this.id=Object(r["b"])()}}},beba:function(e,t,i){"use strict";i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return n})),i.d(t,"c",(function(){return a})),i.d(t,"d",(function(){return l})),i.d(t,"e",(function(){return c})),i.d(t,"f",(function(){return o})),i.d(t,"g",(function(){return h})),i.d(t,"h",(function(){return d})),i.d(t,"i",(function(){return u})),i.d(t,"j",(function(){return f})),i.d(t,"k",(function(){return p}));i("d267");var r=i("a1ff");function n(e,t,i="nearest",n=!1){var a;const s=!(n&&"u8"===t.pixelType),o=s?5126:5121,c=null==t.pixels||0===t.pixels.length?null:s?t.getAsRGBAFloat():t.getAsRGBA(),l=null==(a=e.capabilities.textureFloat)?void 0:a.textureFloatLinear,d={width:t.width,height:t.height,target:3553,pixelFormat:6408,internalFormat:"webgl2"===e.webglVersion&&s?34836:6408,samplingMode:!l||"bilinear"!==i&&"cubic"!==i?9728:9729,dataType:o,wrapMode:33071,flipped:!1};return new r["a"](e,d,c)}function a(e,t){const i=4*t.size[0],n=t.size[1],a={width:i,height:n,target:3553,pixelFormat:6408,internalFormat:"webgl2"===e.webglVersion?34836:6408,dataType:5126,samplingMode:9728,wrapMode:33071,flipped:!1},s=new Float32Array(i*n*4);let o=0;for(let r=0;r<t.coefficients.length;r++)s[o++]=t.coefficients[r],r%3==2&&(s[o++]=1);return new r["a"](e,a,s)}function s(e,t){const i={width:t.length/4,height:1,target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,flipped:!1};return new r["a"](e,i,t)}function o(e,t,i,r=1,n=!0,a=!1){return{u_flipY:n,u_isFloatTexture:a,u_applyTransform:!!e,u_opacity:r,u_transformSpacing:e?e.spacing:null,u_transformGridSize:e?e.size:null,u_targetImageSize:t,u_srcImageSize:i}}function c(e,t){return{u_colormapOffset:t||0,u_colormapMaxIndex:e?e.length/4-1:null}}function l(e,t){return{u_scale:e,u_offset:t}}function d(e){return{u_bandCount:e.bandCount,u_minOutput:e.outMin,u_maxOutput:e.outMax,u_minCutOff:e.minCutOff,u_maxCutOff:e.maxCutOff,u_factor:e.factor,u_useGamma:e.useGamma,u_gamma:e.gamma,u_gammaCorrection:e.gammaCorrection}}function h(e){return{u_hillshadeType:e.hillshadeType,u_sinZcosAs:e.sinZcosAs,u_sinZsinAs:e.sinZsinAs,u_cosZs:e.cosZs,u_weights:e.weights,u_factor:e.factor,u_minValue:e.minValue,u_maxValue:e.maxValue}}function u(e,t){const i=e.gl,r=t.glName,n=i.getProgramParameter(r,i.ACTIVE_UNIFORMS),a=new Map;let s;for(let o=0;o<n;o++)s=i.getActiveUniform(r,o),s&&a.set(s.name,{location:i.getUniformLocation(r,s.name),info:s});return a}function p(e,t,i){Object.keys(i).forEach(r=>{const n=t.get(r)||t.get(r+"[0]");n&&b(e,r,i[r],n)})}function f(e,t,i,r){i.length===r.length&&(r.some(e=>null==e)||i.some(e=>null==e)||i.forEach((i,n)=>{t.setUniform1i(i,n),e.bindTexture(r[n],n)}))}function b(e,t,i,r){if(null===r||null==i)return!1;const{info:n}=r;switch(n.type){case 5126:n.size>1?e.setUniform1fv(t,i):e.setUniform1f(t,i);break;case 35664:e.setUniform2fv(t,i);break;case 35665:e.setUniform3fv(t,i);break;case 35666:e.setUniform4fv(t,i);break;case 35675:e.setUniformMatrix3fv(t,i);break;case 35676:e.setUniformMatrix4fv(t,i);break;case 5124:n.size>1?e.setUniform1iv(t,i):e.setUniform1i(t,i);break;case 35670:e.setUniform1i(t,i?1:0);break;case 35667:case 35671:e.setUniform2iv(t,i);break;case 35668:case 35672:e.setUniform3iv(t,i);break;case 35669:case 35673:e.setUniform4iv(t,i);break;default:return!1}return!0}},c15d:function(e,t,i){"use strict";i.d(t,"a",(function(){return g})),i.d(t,"b",(function(){return v})),i.d(t,"c",(function(){return u})),i.d(t,"d",(function(){return p})),i.d(t,"e",(function(){return h}));var r=i("b2b2"),n=i("b2cd");function a(){if(Object(r["k"])(s)){const e=e=>Object(n["b"])("esri/libs/basisu/"+e);s=i.e("chunk-5ba1e7e0").then(i.bind(null,"a58f")).then(e=>e.b).then(({default:t})=>t({locateFile:e}).then(e=>(e.initializeBasis(),delete e.then,e)))}return s}let s;var o=i("a1ff"),c=i("8539");let l=null,d=null;async function h(){return Object(r["k"])(d)&&(d=a(),l=await d),d}function u(e,t){if(Object(r["k"])(l))return e.byteLength;const i=new l.BasisFile(new Uint8Array(e)),n=b(i)?f(i.getNumLevels(0),i.getHasAlpha(),i.getImageWidth(0,0),i.getImageHeight(0,0),t):0;return i.close(),i.delete(),n}function p(e,t){if(Object(r["k"])(l))return e.byteLength;const i=new l.KTX2File(new Uint8Array(e)),n=m(i)?f(i.getLevels(),i.getHasAlpha(),i.getWidth(),i.getHeight(),t):0;return i.close(),i.delete(),n}function f(e,t,i,r,n){const a=Object(c["b"])(t?37496:37492),s=n&&e>1?(4**e-1)/(3*4**(e-1)):1;return Math.ceil(i*r*a*s)}function b(e){return e.getNumImages()>=1&&!e.isUASTC()}function m(e){return e.getFaces()>=1&&e.isETC1S()}async function g(e,t,i){Object(r["k"])(l)&&(l=await h());const n=new l.BasisFile(new Uint8Array(i));if(!b(n))return null;n.startTranscoding();const a=y(e,t,n.getNumLevels(0),n.getHasAlpha(),n.getImageWidth(0,0),n.getImageHeight(0,0),(e,t)=>n.getImageTranscodedSizeInBytes(0,e,t),(e,t,i)=>n.transcodeImage(i,0,e,t,0,0));return n.close(),n.delete(),a}async function v(e,t,i){Object(r["k"])(l)&&(l=await h());const n=new l.KTX2File(new Uint8Array(i));if(!m(n))return null;n.startTranscoding();const a=y(e,t,n.getLevels(),n.getHasAlpha(),n.getWidth(),n.getHeight(),(e,t)=>n.getImageTranscodedSizeInBytes(e,0,0,t),(e,t,i)=>n.transcodeImage(i,e,0,0,t,0,-1,-1));return n.close(),n.delete(),a}function y(e,t,i,r,n,a,s,c){const{compressedTextureETC:l,compressedTextureS3TC:d}=e.capabilities,[h,u]=l?r?[1,37496]:[0,37492]:d?r?[3,33779]:[2,33776]:[13,6408],p=t.hasMipmap?i:Math.min(1,i),f=[];for(let o=0;o<p;o++)f.push(new Uint8Array(s(o,h))),c(o,h,f[o]);const b=f.length>1,m=b?9987:9729,g={...t,samplingMode:m,hasMipmap:b,internalFormat:u,width:n,height:a};return new o["a"](e,g,{type:"compressed",levels:f})}},c1c0:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var r=i("661c"),n=i("b2b2"),a=(i("7ce4"),i("d267"),i("c120"),i("1956"),i("d17d"),i("9f8b"),i("a1ff"));i("0fa6");class s{constructor(e){this._rctx=e,this.cache=new Map}dispose(){this.cache.forEach(e=>e.texture=Object(n["f"])(e.texture)),this.cache.clear()}acquire(e){if(Object(n["k"])(e))return null;const t=this.patternId(e),i=this.cache.get(t);if(i)return i.refCount++,i.bind;const r=e.pixelRatio,{encodedData:s,sdfNormalizer:c,pixels:l,paddedPixels:d}=o(e.pattern,r),h=l/r,u={refCount:1,texture:null,bind:e=>(Object(n["k"])(u.texture)&&(u.texture=new a["a"](this._rctx,{width:d,height:1,internalFormat:6408,pixelFormat:6408,dataType:5121,wrapMode:33071},s)),e.bindTexture(u.texture,"stipplePatternTexture"),{pixelSize:h,sdfNormalizer:c,pixels:l})};return this.cache.set(t,u),u.bind}release(e){if(Object(n["k"])(e))return;const t=this.patternId(e),i=this.cache.get(t);i&&(i.refCount--,0===i.refCount&&(Object(n["l"])(i.texture)&&i.texture.dispose(),this.cache.delete(t)))}swap(e,t){const i=this.acquire(t);return this.release(e),i}patternId(e){return`${e.pattern.join(",")}-r${e.pixelRatio}`}}function o(e,t){const i=e.map(e=>Math.round(e*t)),n=1/t,a=Math.floor(i.reduce((e,t)=>e+t)),s=i.reduce((e,t)=>Math.max(e,t)),o=(Math.floor(.5*(s-1))+.5)*n,c=[];let l=1;for(const r of i){for(let e=0;e<r;e++){const t=l*(Math.min(e,r-1-e)+.5)*n/o*.5+.5;c.push(t)}l=-l}const d=Math.round(i[0]/2),h=[...c.slice(d),...c.slice(0,d)],u=a+2,p=new Uint8Array(4*u);let f=4;for(const b of h)Object(r["a"])(b,p,f),f+=4;return p.copyWithin(0,f-4,f),p.copyWithin(f,4,8),{encodedData:p,sdfNormalizer:o,paddedPixels:u,pixels:a}}},c2d1:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i("501b"),n=i("3886");function a(e,t){e.fragment.include(r["a"]),3===t.output?(e.extensions.add("GL_OES_standard_derivatives"),e.fragment.code.add(n["a"]`float _calculateFragDepth(const in float depth) {
const float SLOPE_SCALE = 2.0;
const float BIAS = 2.0 * .000015259;
float m = max(abs(dFdx(depth)), abs(dFdy(depth)));
float result = depth + SLOPE_SCALE * m + BIAS;
return clamp(result, .0, .999999);
}
void outputDepth(float _linearDepth) {
gl_FragColor = float2rgba(_calculateFragDepth(_linearDepth));
}`)):1===t.output&&e.fragment.code.add(n["a"]`void outputDepth(float _linearDepth) {
gl_FragColor = float2rgba(_linearDepth);
}`)}},c332:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i("3886");function n(e){const t=r["a"]`vec3 decodeNormal(vec2 f) {
float z = 1.0 - abs(f.x) - abs(f.y);
return vec3(f + sign(f) * min(z, 0.0), z);
}`;e.fragment.code.add(t),e.vertex.code.add(t)}function a(e,t){0===t.normalType&&(e.attributes.add("normal","vec3"),e.vertex.code.add(r["a"]`vec3 normalModel() {
return normal;
}`)),1===t.normalType&&(e.include(n),e.attributes.add("normalCompressed","vec2"),e.vertex.code.add(r["a"]`vec3 normalModel() {
return decodeNormal(normalCompressed);
}`)),3===t.normalType&&(e.extensions.add("GL_OES_standard_derivatives"),e.fragment.code.add(r["a"]`vec3 screenDerivativeNormal(vec3 positionView) {
return normalize(cross(dFdx(positionView), dFdy(positionView)));
}`))}},c332f:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("3886");function n(e,t){const i=e.vertex;t.silhouette?(i.code.add(r["a"]`bool isSilhouetteEdge(vec3 viewDir, vec3 normalA, vec3 normalB) {
float faceAVisible = dot(viewDir, normalA);
float faceBVisible = dot(viewDir, normalB);
return faceAVisible * faceBVisible < 0.0;
}`),t.legacy?i.code.add(r["a"]`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 viewNormalA = _modelToViewNormal(normalA);
vec3 viewNormalB = _modelToViewNormal(normalB);
vec3 viewDir = -viewPos;
if (isSilhouetteEdge(viewDir, viewNormalA, viewNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`):i.code.add(r["a"]`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 worldNormalA = _modelToWorldNormal(normalA);
vec3 worldNormalB = _modelToWorldNormal(normalB);
vec3 viewDir = -worldPos;
if (isSilhouetteEdge(viewDir, worldNormalA, worldNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`)):i.code.add(r["a"]`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
return false;
}`)}},c3a3:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("3886");function n(e,t){const i=e.fragment;i.constants.add("coverageTestThreshold","float",.01),t.antialiasing?i.code.add(r["a"]`#define discardByCoverage(radius, coverage) { if (coverage < coverageTestThreshold) discard; }`):i.code.add(r["a"]`#define discardByCoverage(radius, coverage) { float coverageLimit = radius <= 0.5 ? coverageTestThreshold : 0.75; if (coverage < coverageLimit) discard; }`)}},c3a4:function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));class r{constructor(e,t){this._module=e,this._loadModule=t}get(){return this._module}async reload(){return this._module=await this._loadModule(),this._module}}},c514:function(e,t,i){"use strict";function r(e){return window.WebGL2RenderingContext&&e instanceof window.WebGL2RenderingContext}i.d(t,"a",(function(){return r}))},c51b:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("3886");function n(e){e.vertex.code.add(r["a"]`const float PI = 3.141592653589793;`),e.fragment.code.add(r["a"]`const float PI = 3.141592653589793;
const float LIGHT_NORMALIZATION = 1.0 / PI;
const float INV_PI = 0.3183098861837907;
const float HALF_PI = 1.570796326794897;`)}},c6ac:function(e,t,i){"use strict";i.d(t,"a",(function(){return r})),i.d(t,"b",(function(){return a})),i.d(t,"c",(function(){return n})),i.d(t,"d",(function(){return s}));i("c120");function r(e){switch(e){case"u8":case"i8":return 1;case"u16":case"i16":return 2;case"u32":case"i32":case"f32":return 4;case"f64":return 8;default:return}}function n(e){switch(e){case"u8":case"u16":case"u32":return!1;case"i8":case"i16":case"i32":case"f32":case"f64":return!0;default:return}}function a(e){switch(e){case"u8":case"u16":case"u32":case"i8":case"i16":case"i32":return!0;case"f32":case"f64":return!1;default:return}}function s(e){switch(e){case"u8":return 255;case"u16":return 65535;case"u32":return 4294967295;case"i8":return 127;case"i16":return 32767;case"i32":return 2147483647;case"f32":return 3402823e32;case"f64":return 179769e303;default:return}}},c6d7:function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return n}));var r=i("3886");function n(e,t){e.fragment.uniforms.add("terrainDepthTexture","sampler2D"),e.fragment.uniforms.add("cameraNearFar","vec2"),e.fragment.uniforms.add("inverseViewport","vec2"),e.fragment.code.add(r["a"]`
    // Compare the linearized depths of fragment and terrain. Discard fragments on the wrong side of the terrain.
    void terrainDepthTest(vec4 fragCoord, float fragmentDepth){

      float terrainDepth = linearDepthFromTexture(terrainDepthTexture, fragCoord.xy * inverseViewport, cameraNearFar);
      if(fragmentDepth ${t.cullAboveGround?">":"<="} terrainDepth){
        discard;
      }
    }
  `)}function a(e,t){t.multipassTerrainEnabled&&t.terrainLinearDepthTexture&&e.bindTexture(t.terrainLinearDepthTexture,"terrainDepthTexture")}},c829:function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var r=i("b2b2"),n=i("8a44"),a=i("1956"),s=i("8e37");class o extends s["a"]{constructor(e,t,i){super(e,t.generateSource("vertex"),t.generateSource("fragment"),i),this._textures=new Map,this._freeTextureUnits=new n["a"]({deallocator:null}),this._fragmentUniforms=Object(a["b"])()?t.fragmentUniforms.entries:null}stop(){this._textures.clear(),this._freeTextureUnits.clear()}bindTexture(e,t){if(Object(r["k"])(e)||null==e.glName){const e=this._textures.get(t);return e&&(this._context.bindTexture(null,e.unit),this._freeTextureUnit(e),this._textures.delete(t)),null}let i=this._textures.get(t);return null==i?(i=this._allocTextureUnit(e),this._textures.set(t,i)):i.texture=e,this._context.useProgram(this),this.setUniform1i(t,i.unit),this._context.bindTexture(e,i.unit),i.unit}rebindTextures(){this._context.useProgram(this),this._textures.forEach((e,t)=>{this._context.bindTexture(e.texture,e.unit),this.setUniform1i(t,e.unit)}),Object(r["l"])(this._fragmentUniforms)&&this._fragmentUniforms.forEach(e=>{if(("sampler2D"===e.type||"samplerCube"===e.type)&&!this._textures.has(e.name))throw new Error(`Texture sampler ${e.name} has no bound texture`)})}_allocTextureUnit(e){return{texture:e,unit:0===this._freeTextureUnits.length?this._textures.size:this._freeTextureUnits.pop()}}_freeTextureUnit(e){this._freeTextureUnits.push(e.unit)}}},ca67:function(e,t,i){"use strict";i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return a}));var r=i("3886"),n=i("690a");function a(){const e=new n["a"];return e.attributes.add("position","vec3"),e.vertex.code.add(r["a"]`void main(void) {
gl_Position = vec4(position, 1.0);
}`),e.fragment.uniforms.add("tileRows","float").add("tileSize","float"),e.fragment.code.add("\n    #define NUM_CELLS 2.0\n    #define PERLIN_WORLEY 0\n    #define WORLEY 1\n\n    float remap(float x, float low1, float high1, float low2, float high2) {\n      return low2 + (x - low1) * (high2 - low2) / (high1 - low1);\n    }\n\n    float saturate(float x) {\n      return clamp(x, 0.0, 1.0);\n    }\n\n    vec4 taylorInvSqrt(vec4 r) {\n      return 1.79284291400159 - 0.85373472095314 * r;\n    }\n\n    vec4 mod289(vec4 x) {\n      return x - floor( x * (1.0 / 289.0)) * 289.0;\n    }\n\n    vec4 permute(vec4 x) {\n      return mod289(((x * 34.0) + 1.0) * x);\n    }\n\n    vec4 fade(vec4 t) {\n      return (t * t * t) * (t * (t * vec4(6) - vec4(15)) + vec4(10));\n    }\n\n    float glmPerlin(vec4 Position, vec4 rep) {\n      vec4 Pi0 = mod(floor(Position), rep);\n      vec4 Pi1 = mod(Pi0 + float(1), rep);\n      vec4 Pf0 = fract(Position);\n      vec4 Pf1 = Pf0 - float(1);\n      vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\n      vec4 iy = vec4(Pi0.y, Pi0.y, Pi1.y, Pi1.y);\n      vec4 iz0 = vec4(Pi0.z);\n      vec4 iz1 = vec4(Pi1.z);\n      vec4 iw0 = vec4(Pi0.w);\n      vec4 iw1 = vec4(Pi1.w);\n\n      vec4 ixy = permute(permute(ix) + iy);\n      vec4 ixy0 = permute(ixy + iz0);\n      vec4 ixy1 = permute(ixy + iz1);\n      vec4 ixy00 = permute(ixy0 + iw0);\n      vec4 ixy01 = permute(ixy0 + iw1);\n      vec4 ixy10 = permute(ixy1 + iw0);\n      vec4 ixy11 = permute(ixy1 + iw1);\n\n      vec4 gx00 = ixy00 / float(7);\n      vec4 gy00 = floor(gx00) / float(7);\n      vec4 gz00 = floor(gy00) / float(6);\n      gx00 = fract(gx00) - float(0.5);\n      gy00 = fract(gy00) - float(0.5);\n      gz00 = fract(gz00) - float(0.5);\n      vec4 gw00 = vec4(0.75) - abs(gx00) - abs(gy00) - abs(gz00);\n      vec4 sw00 = step(gw00, vec4(0));\n      gx00 -= sw00 * (step(float(0), gx00) - float(0.5));\n      gy00 -= sw00 * (step(float(0), gy00) - float(0.5));\n\n      vec4 gx01 = ixy01 / float(7);\n      vec4 gy01 = floor(gx01) / float(7);\n      vec4 gz01 = floor(gy01) / float(6);\n      gx01 = fract(gx01) - float(0.5);\n      gy01 = fract(gy01) - float(0.5);\n      gz01 = fract(gz01) - float(0.5);\n      vec4 gw01 = vec4(0.75) - abs(gx01) - abs(gy01) - abs(gz01);\n      vec4 sw01 = step(gw01, vec4(0.0));\n      gx01 -= sw01 * (step(float(0), gx01) - float(0.5));\n      gy01 -= sw01 * (step(float(0), gy01) - float(0.5));\n\n      vec4 gx10 = ixy10 / float(7);\n      vec4 gy10 = floor(gx10) / float(7);\n      vec4 gz10 = floor(gy10) / float(6);\n      gx10 = fract(gx10) - float(0.5);\n      gy10 = fract(gy10) - float(0.5);\n      gz10 = fract(gz10) - float(0.5);\n      vec4 gw10 = vec4(0.75) - abs(gx10) - abs(gy10) - abs(gz10);\n      vec4 sw10 = step(gw10, vec4(0.0));\n      gx10 -= sw10 * (step(float(0), gx10) - float(0.5));\n      gy10 -= sw10 * (step(float(0), gy10) - float(0.5));\n\n      vec4 gx11 = ixy11 / float(7);\n      vec4 gy11 = floor(gx11) / float(7);\n      vec4 gz11 = floor(gy11) / float(6);\n      gx11 = fract(gx11) - float(0.5);\n      gy11 = fract(gy11) - float(0.5);\n      gz11 = fract(gz11) - float(0.5);\n      vec4 gw11 = vec4(0.75) - abs(gx11) - abs(gy11) - abs(gz11);\n      vec4 sw11 = step(gw11, vec4(float(0)));\n      gx11 -= sw11 * (step(float(0), gx11) - float(0.5));\n      gy11 -= sw11 * (step(float(0), gy11) - float(0.5));\n\n      vec4 g0000 = vec4(gx00.x, gy00.x, gz00.x, gw00.x);\n      vec4 g1000 = vec4(gx00.y, gy00.y, gz00.y, gw00.y);\n      vec4 g0100 = vec4(gx00.z, gy00.z, gz00.z, gw00.z);\n      vec4 g1100 = vec4(gx00.w, gy00.w, gz00.w, gw00.w);\n      vec4 g0010 = vec4(gx10.x, gy10.x, gz10.x, gw10.x);\n      vec4 g1010 = vec4(gx10.y, gy10.y, gz10.y, gw10.y);\n      vec4 g0110 = vec4(gx10.z, gy10.z, gz10.z, gw10.z);\n      vec4 g1110 = vec4(gx10.w, gy10.w, gz10.w, gw10.w);\n      vec4 g0001 = vec4(gx01.x, gy01.x, gz01.x, gw01.x);\n      vec4 g1001 = vec4(gx01.y, gy01.y, gz01.y, gw01.y);\n      vec4 g0101 = vec4(gx01.z, gy01.z, gz01.z, gw01.z);\n      vec4 g1101 = vec4(gx01.w, gy01.w, gz01.w, gw01.w);\n      vec4 g0011 = vec4(gx11.x, gy11.x, gz11.x, gw11.x);\n      vec4 g1011 = vec4(gx11.y, gy11.y, gz11.y, gw11.y);\n      vec4 g0111 = vec4(gx11.z, gy11.z, gz11.z, gw11.z);\n      vec4 g1111 = vec4(gx11.w, gy11.w, gz11.w, gw11.w);\n\n      vec4 norm00 = taylorInvSqrt(vec4(dot(g0000, g0000), dot(g0100, g0100), dot(g1000, g1000), dot(g1100, g1100)));\n      g0000 *= norm00.x;\n      g0100 *= norm00.y;\n      g1000 *= norm00.z;\n      g1100 *= norm00.w;\n\n      vec4 norm01 = taylorInvSqrt(vec4(dot(g0001, g0001), dot(g0101, g0101), dot(g1001, g1001), dot(g1101, g1101)));\n      g0001 *= norm01.x;\n      g0101 *= norm01.y;\n      g1001 *= norm01.z;\n      g1101 *= norm01.w;\n\n      vec4 norm10 = taylorInvSqrt(vec4(dot(g0010, g0010), dot(g0110, g0110), dot(g1010, g1010), dot(g1110, g1110)));\n      g0010 *= norm10.x;\n      g0110 *= norm10.y;\n      g1010 *= norm10.z;\n      g1110 *= norm10.w;\n\n      vec4 norm11 = taylorInvSqrt(vec4(dot(g0011, g0011), dot(g0111, g0111), dot(g1011, g1011), dot(g1111, g1111)));\n      g0011 *= norm11.x;\n      g0111 *= norm11.y;\n      g1011 *= norm11.z;\n      g1111 *= norm11.w;\n\n      float n0000 = dot(g0000, Pf0);\n      float n1000 = dot(g1000, vec4(Pf1.x, Pf0.y, Pf0.z, Pf0.w));\n      float n0100 = dot(g0100, vec4(Pf0.x, Pf1.y, Pf0.z, Pf0.w));\n      float n1100 = dot(g1100, vec4(Pf1.x, Pf1.y, Pf0.z, Pf0.w));\n      float n0010 = dot(g0010, vec4(Pf0.x, Pf0.y, Pf1.z, Pf0.w));\n      float n1010 = dot(g1010, vec4(Pf1.x, Pf0.y, Pf1.z, Pf0.w));\n      float n0110 = dot(g0110, vec4(Pf0.x, Pf1.y, Pf1.z, Pf0.w));\n      float n1110 = dot(g1110, vec4(Pf1.x, Pf1.y, Pf1.z, Pf0.w));\n      float n0001 = dot(g0001, vec4(Pf0.x, Pf0.y, Pf0.z, Pf1.w));\n      float n1001 = dot(g1001, vec4(Pf1.x, Pf0.y, Pf0.z, Pf1.w));\n      float n0101 = dot(g0101, vec4(Pf0.x, Pf1.y, Pf0.z, Pf1.w));\n      float n1101 = dot(g1101, vec4(Pf1.x, Pf1.y, Pf0.z, Pf1.w));\n      float n0011 = dot(g0011, vec4(Pf0.x, Pf0.y, Pf1.z, Pf1.w));\n      float n1011 = dot(g1011, vec4(Pf1.x, Pf0.y, Pf1.z, Pf1.w));\n      float n0111 = dot(g0111, vec4(Pf0.x, Pf1.y, Pf1.z, Pf1.w));\n      float n1111 = dot(g1111, Pf1);\n\n      vec4 fade_xyzw = fade(Pf0);\n      vec4 n_0w = mix(vec4(n0000, n1000, n0100, n1100), vec4(n0001, n1001, n0101, n1101), fade_xyzw.w);\n      vec4 n_1w = mix(vec4(n0010, n1010, n0110, n1110), vec4(n0011, n1011, n0111, n1111), fade_xyzw.w);\n      vec4 n_zw = mix(n_0w, n_1w, fade_xyzw.z);\n      vec2 n_yzw = mix(vec2(n_zw.x, n_zw.y), vec2(n_zw.z, n_zw.w), fade_xyzw.y);\n      float n_xyzw = mix(n_yzw.x, n_yzw.y, fade_xyzw.x);\n      return float(2.2) * n_xyzw;\n    }\n\n    float getPerlinNoise(vec3 pos, float frequency) {\n      const float octaveFrequencyFactor = 2.0;\n\n      float sum = 0.0;\n      float weightSum = 0.0;\n      float weight = 1.0;\n\n      for (int oct = 0; oct < 3; oct++) {\n        vec3 p = pos * frequency;\n        float val = 0.5 + 0.5 * glmPerlin(vec4(p, 0.0), vec4(frequency));\n        sum += val * weight;\n        weightSum += weight;\n        weight *= 0.5;\n        frequency *= octaveFrequencyFactor;\n      }\n\n      float noise = (sum / weightSum);\n      noise = saturate(noise);\n      return noise;\n    }\n\n    float hash(float p) {\n      p = fract(p * 0.1031);\n      p *= p + 33.33;\n      p *= p + p;\n      return fract(p);;\n    }\n\n    float noise(vec3 x) {\n      vec3 p = floor(x);\n      vec3 f = fract(x);\n\n      f = f * f * (3.0 - 2.0 * f);\n      float n = p.x + p.y * 57.0 + 113.0 * p.z;\n\n      return mix(\n      mix(\n        mix(hash(n + 0.0), hash(n + 1.0), f.x),\n        mix(hash(n + 57.0), hash(n + 58.0), f.x),\n        f.y),\n      mix(\n        mix(hash(n + 113.0), hash(n + 114.0), f.x),\n        mix(hash(n + 170.0), hash(n + 171.0), f.x),\n        f.y),\n      f.z);\n    }\n\n    float worley(vec3 pos, float numCells) {\n      vec3 p = pos * numCells;\n      float d = 1.0e10;\n\n      for (int x = -1; x <= 1; x++) {\n        for (int y = -1; y <= 1; y++) {\n          for (int z = -1; z <= 1; z++) {\n            vec3 tp = floor(p) + vec3(x, y, z);\n            tp = p - tp - noise(mod(tp, numCells));\n            d = min(d, dot(tp, tp));\n          }\n        }\n      }\n\n      return 1.0 - clamp(d, 0.0, 1.0);\n    }\n\n    vec3 get3Dfrom2D(vec2 uv, float tileRows) {\n      vec2 tile = floor(uv);\n      float z = floor(tileRows * tile.y + tile.x);\n      return vec3(fract(uv), z);\n    }\n\n    float getTextureForPoint(vec3 p, int type) {\n      if (type == PERLIN_WORLEY) {\n\n        const float frequency = 8.0;\n        float perlinNoise = getPerlinNoise(p, frequency);\n\n        float worley0 = worley(p, NUM_CELLS * 2.0);\n        float worley1 = worley(p, NUM_CELLS * 8.0);\n        float worley2 = worley(p, NUM_CELLS * 14.0);\n\n        float worleyFBM = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;\n        return remap(perlinNoise, 0.0, 1.0, worleyFBM, 1.0);\n      }\n\n      float worley0 = worley(p, NUM_CELLS);\n      float worley1 = worley(p, NUM_CELLS * 2.0);\n      float worley2 = worley(p, NUM_CELLS * 4.0);\n      float worley3 = worley(p, NUM_CELLS * 8.0);\n\n      float FBM0 = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;\n      float FBM1 = worley1 * 0.625 + worley2 * 0.25 + worley3 * 0.125;\n      float FBM2 = worley2 * 0.75 + worley3 * 0.25;\n\n      return FBM0 * 0.625 + FBM1 * 0.25 + FBM2 * 0.125;\n    }\n  "),e.fragment.code.add("\n    void main() {\n      const float padWidth = 1.0;\n      float paddedSize = tileSize + 2.0 * padWidth;\n      float tileCount = tileRows * tileRows;\n      vec2 tile = floor((gl_FragCoord.xy - 0.5) / paddedSize);\n\n      bool padCell = false;\n      if (mod(gl_FragCoord.x, paddedSize) == 0.5 || mod(gl_FragCoord.x, paddedSize) == paddedSize - 0.5) {\n        padCell = true;\n      }\n\n      if (mod(gl_FragCoord.y, paddedSize) == 0.5 || mod(gl_FragCoord.y, paddedSize) == paddedSize - 0.5) {\n        padCell = true;\n      }\n\n      bool startPadX = false;\n      bool startPadY = false;\n      bool endPadX = false;\n      bool endPadY = false;\n\n      if (gl_FragCoord.x == tile.x * paddedSize + 0.5) {\n        startPadX = true;\n      }\n\n      if (gl_FragCoord.y == tile.y * paddedSize + 0.5) {\n        startPadY = true;\n      }\n\n      if (gl_FragCoord.x == (tile.x + 1.0) * paddedSize - 0.5) {\n        endPadX = true;\n      }\n\n      if (gl_FragCoord.y == (tile.y + 1.0) * paddedSize - 0.5) {\n        endPadY = true;\n      }\n\n      vec2 padding = vec2(2.0 * padWidth) * tile;\n      vec2 uv;\n\n      if (padCell) {\n        vec2 pixel = gl_FragCoord.xy - padWidth - padding;\n\n        if (startPadX) {\n          pixel.x += tileSize;\t\n        }\n\n        if (startPadY) {\n          pixel.y += tileSize;\t\n        }\n\n        if (endPadX) {\n          pixel.x -= tileSize;\t\n        }\n\n        if (endPadY) {\n          pixel.y -= tileSize;\t\n        }\n\n        uv = vec2(pixel.xy / tileSize);\n      } else {\n        vec2 pixel = gl_FragCoord.xy - padWidth - padding;\n        uv = vec2(pixel.xy / tileSize);\n      }\n\n      vec3 p_ = get3Dfrom2D(uv, tileRows);\n      vec3 p = p_;\n      p.z /= (tileRows * tileRows);\n\n      float worleyPerlinNoise = getTextureForPoint(p, PERLIN_WORLEY);\n      float worleyNoise = getTextureForPoint(p, WORLEY);\n\n      gl_FragColor.r = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));\n\n      p_ = mod(p_ + 1.0, tileRows * tileRows);\n      p = p_;\n      p.z /= (tileRows * tileRows);\n\n      worleyPerlinNoise = getTextureForPoint(p, PERLIN_WORLEY);\n      worleyNoise = getTextureForPoint(p, WORLEY);\n\n      gl_FragColor.g = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));\n\n    \tgl_FragColor.ba = vec2(0, 1);\n    }\n  "),e}const s=Object.freeze({__proto__:null,build:a})},ca98:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("b2b2");class n{constructor(e,t,i=(()=>this.dispose())){this.release=i,t&&(this._config=t.snapshot()),this._program=this.initializeProgram(e),this._pipeline=this.initializePipeline(e)}dispose(){this._program=Object(r["f"])(this._program),this._pipeline=this._config=null}reload(e){Object(r["f"])(this._program),this._program=this.initializeProgram(e)}get program(){return this._program}get key(){return this._config.key}get configuration(){return this._config}bindPass(e,t){}bindMaterial(e,t){}bindDraw(e){}bindPipelineState(e,t=null,i){e.setPipelineState(this.getPipelineState(t,i))}ensureAttributeLocations(e){this.program.assertCompatibleVertexAttributeLocations(e)}get primitiveType(){return 4}getPipelineState(e,t){return this._pipeline}}},caf1:function(e,t,i){"use strict";i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return a}));var r=i("38a4"),n=i("b2b2");function a(e){switch(e){case"multiply":default:return 1;case"ignore":return 2;case"replace":return 3;case"tint":return 4}}function s(e,t,i){if(Object(n["k"])(e)||2===t)return i[0]=255,i[1]=255,i[2]=255,void(i[3]=255);const a=Object(r["f"])(Math.round(e[3]*c),0,c),s=0===a||4===t?0:3===t?l:d;i[0]=Object(r["f"])(Math.round(e[0]*o),0,o),i[1]=Object(r["f"])(Math.round(e[1]*o),0,o),i[2]=Object(r["f"])(Math.round(e[2]*o),0,o),i[3]=a+s}const o=255,c=85,l=c,d=2*c},caf7:function(e,t,i){"use strict";i.d(t,"a",(function(){return y}));var r,n=i("e431"),a=i("47f8"),s=i("0b2d"),o=i("7289"),c=i("d18f");!function(e){function t(e,t){const i=e[t],r=e[t+1],n=e[t+2];return Math.sqrt(i*i+r*r+n*n)}function i(e,t){const i=e[t],r=e[t+1],n=e[t+2],a=1/Math.sqrt(i*i+r*r+n*n);e[t]*=a,e[t+1]*=a,e[t+2]*=a}function r(e,t,i){e[t]*=i,e[t+1]*=i,e[t+2]*=i}function n(e,t,i,r,n,a=t){(n=n||e)[a]=e[t]+i[r],n[a+1]=e[t+1]+i[r+1],n[a+2]=e[t+2]+i[r+2]}function a(e,t,i,r,n,a=t){(n=n||e)[a]=e[t]-i[r],n[a+1]=e[t+1]-i[r+1],n[a+2]=e[t+2]-i[r+2]}e.length=t,e.normalize=i,e.scale=r,e.add=n,e.subtract=a}(r||(r={}));var l=i("0278"),d=i("1038"),h=i("1153");const u=r;var p,f,b,m;!function(e){const t=.5,i=[[-t,-t,t],[t,-t,t],[t,t,t],[-t,t,t],[-t,-t,-t],[t,-t,-t],[t,t,-t],[-t,t,-t]],r=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],n=[0,0,1,0,1,1,0,1],a=new Uint16Array([0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5]),s=new Uint16Array(36);for(let l=0;l<6;l++)for(let e=0;e<6;e++)s[6*l+e]=l;const o=new Uint16Array(36);for(let l=0;l<6;l++)o[6*l+0]=0,o[6*l+1]=1,o[6*l+2]=2,o[6*l+3]=2,o[6*l+4]=3,o[6*l+5]=0;function c(e){Array.isArray(e)||(e=[e,e,e]);const t=new Array(24);for(let r=0;r<8;r++)t[3*r]=i[r][0]*e[0],t[3*r+1]=i[r][1]*e[1],t[3*r+2]=i[r][2]*e[2];return new l["a"]([["position",{size:3,data:t,exclusive:!0}],["normal",{size:3,data:r}],["uv0",{size:2,data:n}]],[["position",a],["normal",s],["uv0",o]])}e.createGeometry=c}(p||(p={})),function(e){const t=.5,i=[[-t,0,-t],[t,0,-t],[t,0,t],[-t,0,t],[0,-t,0],[0,t,0]],r=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],n=new Uint16Array([5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0]),a=new Uint16Array([0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7]);function s(e){Array.isArray(e)||(e=[e,e,e]);const t=new Array(18);for(let r=0;r<6;r++)t[3*r]=i[r][0]*e[0],t[3*r+1]=i[r][1]*e[1],t[3*r+2]=i[r][2]*e[2];return new l["a"]([["position",{size:3,data:t,exclusive:!0}],["normal",{size:3,data:r}]],[["position",n],["normal",a]])}e.createGeometry=s}(f||(f={})),function(e){const t=.5,i=0,r=Object(a["d"])(-t,i,-t),s=Object(a["d"])(t,i,-t),o=Object(a["d"])(0,i,t),c=Object(a["d"])(0,i+t,0),d=Object(a["c"])(),h=Object(a["c"])(),u=Object(a["c"])(),p=Object(a["c"])(),f=Object(a["c"])();Object(n["m"])(d,r,c),Object(n["m"])(h,r,s),Object(n["j"])(u,d,h),Object(n["u"])(u,u),Object(n["m"])(d,s,c),Object(n["m"])(h,s,o),Object(n["j"])(p,d,h),Object(n["u"])(p,p),Object(n["m"])(d,o,c),Object(n["m"])(h,o,r),Object(n["j"])(f,d,h),Object(n["u"])(f,f);const b=[r,s,o,c],m=[0,-1,0,u[0],u[1],u[2],p[0],p[1],p[2],f[0],f[1],f[2]],g=[0,1,2,3,1,0,3,2,1,3,0,2],v=[0,0,0,1,1,1,2,2,2,3,3,3];function y(e){Array.isArray(e)||(e=[e,e,e]);const t=new Array(12);for(let i=0;i<4;i++)t[3*i]=b[i][0]*e[0],t[3*i+1]=b[i][1]*e[1],t[3*i+2]=b[i][2]*e[2];return new l["a"]([["position",{size:3,data:t,exclusive:!0}],["normal",{size:3,data:m}]],[["position",new Uint16Array(g)],["normal",new Uint16Array(v)]])}e.createGeometry=y}(b||(b={})),function(e){function t(e,t,i,r={uv:!0}){const n=-Math.PI,a=2*Math.PI,s=-Math.PI/2,o=Math.PI,c=Math.max(3,Math.floor(t)),d=Math.max(2,Math.floor(i)),h=(c+1)*(d+1),u=new Float32Array(3*h),p=new Float32Array(3*h),f=new Float32Array(2*h),b=[];let m=0;for(let l=0;l<=d;l++){const t=[],i=l/d,r=s+i*o,h=Math.cos(r);for(let s=0;s<=c;s++){const o=s/c,l=n+o*a,d=Math.cos(l)*h,b=Math.sin(r),g=-Math.sin(l)*h;u[3*m]=d*e,u[3*m+1]=b*e,u[3*m+2]=g*e,p[3*m]=d,p[3*m+1]=b,p[3*m+2]=g,f[2*m]=o,f[2*m+1]=i,t.push(m),++m}b.push(t)}const g=new Uint32Array(2*c*(d-1)*3);m=0;for(let l=0;l<d;l++)for(let e=0;e<c;e++){const t=b[l][e],i=b[l][e+1],r=b[l+1][e+1],n=b[l+1][e];0===l?(g[m++]=t,g[m++]=r,g[m++]=n):l===d-1?(g[m++]=t,g[m++]=i,g[m++]=r):(g[m++]=t,g[m++]=i,g[m++]=r,g[m++]=r,g[m++]=n,g[m++]=t)}const v=[["position",g],["normal",g]],y=[["position",{size:3,data:u,exclusive:!0}],["normal",{size:3,data:p,exclusive:!0}]];return r.uv&&(y.push(["uv0",{size:2,data:f,exclusive:!0}]),v.push(["uv0",g])),r.offset&&(v[0][0]="offset",y[0][0]="offset",v.push(["position",new Uint32Array(g.length)]),y.push(["position",{size:3,data:Float64Array.from(r.offset),exclusive:!0}])),new l["a"](y,v)}function i(e,t,i){const r=e;let n,a;if(i)n=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],a=new Uint32Array([0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1]);else{const e=r*(1+Math.sqrt(5))/2;n=[-r,e,0,r,e,0,-r,-e,0,r,-e,0,0,-r,e,0,r,e,0,-r,-e,0,r,-e,e,0,-r,e,0,r,-e,0,-r,-e,0,r],a=new Uint32Array([0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1])}for(let l=0;l<n.length;l+=3)u.scale(n,l,e/u.length(n,l));let s={};function o(t,i){t>i&&([t,i]=[i,t]);const r=t.toString()+"."+i.toString();if(s[r])return s[r];let a=n.length;return n.length+=3,u.add(n,3*t,n,3*i,n,a),u.scale(n,a,e/u.length(n,a)),a/=3,s[r]=a,a}for(let l=0;l<t;l++){const e=a.length,t=new Uint32Array(4*e);for(let i=0;i<e;i+=3){const e=a[i],r=a[i+1],n=a[i+2],s=o(e,r),c=o(r,n),l=o(n,e),d=4*i;t[d]=e,t[d+1]=s,t[d+2]=l,t[d+3]=r,t[d+4]=c,t[d+5]=s,t[d+6]=n,t[d+7]=l,t[d+8]=c,t[d+9]=s,t[d+10]=c,t[d+11]=l}a=t,s={}}const c=new Float32Array(n);for(let l=0;l<c.length;l+=3)u.normalize(c,l);const d=[["position",a],["normal",a]],h=[["position",{size:3,data:new Float32Array(n),exclusive:!0}],["normal",{size:3,data:c,exclusive:!0}]];return new l["a"](h,d)}function r(e,t,i,r,n,a,s){const o=t?[t[0],t[1],t[2]]:[0,0,0],c=e?[e[0],e[1],e[2]]:[0,0,1];a=a||[0,0];const d=i?[255*i[0],255*i[1],255*i[2],i.length>3?255*i[3]:255]:[255,255,255,255],h=null!=r&&2===r.length?r:[1,1],u=[["position",{size:3,data:o,exclusive:!0}],["normal",{size:3,data:c,exclusive:!0}],["uv0",{size:a.length,data:a}],["color",{size:4,data:d,exclusive:!0}],["size",{size:2,data:h}]];if(null!=n){const e=new Float32Array([n[0],n[1],n[2],n[3]]);u.push(["auxpos1",{size:4,data:e}])}if(null!=s){const e=new Float32Array([s[0],s[1],s[2],s[3]]);u.push(["auxpos2",{size:4,data:e}])}return new l["a"](u,null,1)}function m(e,t,i,r,n,a,s,o){if(null!=e){const{data:t}=o.getMutableAttribute("normal");t[0]=e[0],t[1]=e[1],t[2]=e[2]}if(null!=t){const{data:e}=o.getMutableAttribute("position");e[0]=t[0],e[1]=t[1],e[2]=t[2]}if(null!=i){const{data:e}=o.getMutableAttribute("color");e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3]}if(null!=r){const{data:e}=o.getMutableAttribute("size");e[0]=r[0],e[1]=r[1]}if(null!=n){const{data:e}=o.getMutableAttribute("auxpos1");e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3]}if(null!=a){const{data:e}=o.getMutableAttribute("uv0");e[0]=a[0],e[1]=a[1]}if(null!=s){const{data:e}=o.getMutableAttribute("auxpos2");e[0]=s[0],e[1]=s[1],e[2]=s[2],e[3]=s[3]}}function y(e,t){const i=new Float32Array(3*e.length),r=new Float32Array(t?3*e.length:3),n=new Uint32Array(e.length),a=new Uint32Array(e.length);for(let s=0;s<e.length;s++)i[3*s]=e[s][0],i[3*s+1]=e[s][1],i[3*s+2]=e[s][2],t&&(r[3*s]=t[s][0],r[3*s+1]=t[s][1],r[3*s+2]=t[s][2]),n[s]=s,a[s]=0;return t||(r[0]=0,r[1]=1,r[2]=0),new l["a"]([["position",{size:3,data:i,exclusive:!0}],["normal",{size:3,data:r,exclusive:!0}],["uv0",{size:2,data:[0,0],exclusive:!0}]],[["position",n],["normal",t?n:a],["uv0",a]],1)}function O(){const e=[0,0,0,0,0,100,100,0,0],t=new Uint16Array([0,1,2]),i=[0,1,0],r=new Uint16Array([0,0,0]),n=[0,0],a=new Uint16Array([0,0,0]);return new l["a"]([["position",{size:3,data:e,exclusive:!0}],["normal",{size:3,data:i,exclusive:!0}],["uv0",{size:2,data:n,exclusive:!0}]],[["position",t],["normal",r],["uv0",a]])}e.createBoxGeometry=p.createGeometry,e.createDiamondGeometry=f.createGeometry,e.createTetrahedronGeometry=b.createGeometry,e.createSphereGeometry=t,e.createPolySphereGeometry=i,e.createPointGeometry=r,e.updatePointGeometry=m,e.createPointArrayGeometry=y,e.createTriangleGeometry=O;const _=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function x(e=_){const t=new Array(12);for(let a=0;a<4;a++)for(let i=0;i<3;i++)t[3*a+i]=e[a][i];const i=new Uint32Array([0,1,2,2,3,0]),r=[0,0,1],n=new Uint32Array([0,0,0,0,0,0]);return new l["a"]([["position",{size:3,data:t,exclusive:!0}],["normal",{size:3,data:r,exclusive:!0}],["uv0",{size:2,data:[0,0,1,0,1,1,0,1],exclusive:!0}],["color",{size:4,data:[255,255,255,255],exclusive:!0}]],[["position",i],["normal",n],["uv0",i],["color",n]])}function j(e,t,i,r,n=!0,s=!0){let o=0;const c=t,d=e;let h=Object(a["d"])(0,o,0),u=Object(a["d"])(0,o+d,0),p=Object(a["d"])(0,-1,0),f=Object(a["d"])(0,1,0);r&&(o=d,u=Object(a["d"])(0,0,0),h=Object(a["d"])(0,o,0),p=Object(a["d"])(0,1,0),f=Object(a["d"])(0,-1,0));const b=[u,h],m=[p,f],g=i+2,v=Math.sqrt(d*d+c*c);if(r)for(let l=i-1;l>=0;l--){const e=l*(2*Math.PI/i),t=Object(a["d"])(Math.cos(e)*c,o,Math.sin(e)*c);b.push(t);const r=Object(a["d"])(d*Math.cos(e)/v,-c/v,d*Math.sin(e)/v);m.push(r)}else for(let l=0;l<i;l++){const e=l*(2*Math.PI/i),t=Object(a["d"])(Math.cos(e)*c,o,Math.sin(e)*c);b.push(t);const r=Object(a["d"])(d*Math.cos(e)/v,c/v,d*Math.sin(e)/v);m.push(r)}const y=new Uint32Array(2*(i+2)*3),O=new Uint32Array(2*(i+2)*3);let _=0,x=0;if(n){for(let e=3;e<b.length;e++)y[_++]=1,y[_++]=e-1,y[_++]=e,O[x++]=0,O[x++]=0,O[x++]=0;y[_++]=b.length-1,y[_++]=2,y[_++]=1,O[x++]=0,O[x++]=0,O[x++]=0}if(s){for(let e=3;e<b.length;e++)y[_++]=e,y[_++]=e-1,y[_++]=0,O[x++]=e,O[x++]=e-1,O[x++]=1;y[_++]=0,y[_++]=2,y[_++]=b.length-1,O[x++]=1,O[x++]=2,O[x++]=m.length-1}const j=new Float32Array(3*g);for(let a=0;a<g;a++)j[3*a]=b[a][0],j[3*a+1]=b[a][1],j[3*a+2]=b[a][2];const w=new Float32Array(3*g);for(let a=0;a<g;a++)w[3*a]=m[a][0],w[3*a+1]=m[a][1],w[3*a+2]=m[a][2];return new l["a"]([["position",{size:3,data:j,exclusive:!0}],["normal",{size:3,data:w,exclusive:!0}]],[["position",y],["normal",O]])}function w(e,t,i,r,s,o){const c=r?Object(a["a"])(r):Object(a["d"])(1,0,0),d=s?Object(a["a"])(s):Object(a["d"])(0,0,0);o=null==o||o;const h=Object(a["c"])();Object(n["u"])(h,c);const u=Object(a["c"])();Object(n["h"])(u,h,Math.abs(e));const p=Object(a["c"])();Object(n["h"])(p,u,-.5),Object(n["i"])(p,p,d);const f=Object(a["d"])(0,1,0);Math.abs(1-Object(n["k"])(h,f))<.2&&Object(n["z"])(f,0,0,1);const b=Object(a["c"])();Object(n["j"])(b,h,f),Object(n["u"])(b,b),Object(n["j"])(f,b,h);const m=2*i+(o?2:0),g=i+(o?2:0),v=new Float32Array(3*m),y=new Float32Array(3*g),O=new Float32Array(2*m),_=new Uint32Array(3*i*(o?4:2)),x=new Uint32Array(3*i*(o?4:2));o&&(v[3*(m-2)+0]=p[0],v[3*(m-2)+1]=p[1],v[3*(m-2)+2]=p[2],O[2*(m-2)]=0,O[2*(m-2)+1]=0,v[3*(m-1)+0]=v[3*(m-2)+0]+u[0],v[3*(m-1)+1]=v[3*(m-2)+1]+u[1],v[3*(m-1)+2]=v[3*(m-2)+2]+u[2],O[2*(m-1)]=1,O[2*(m-1)+1]=1,y[3*(g-2)+0]=-h[0],y[3*(g-2)+1]=-h[1],y[3*(g-2)+2]=-h[2],y[3*(g-1)+0]=h[0],y[3*(g-1)+1]=h[1],y[3*(g-1)+2]=h[2]);const j=function(e,t,i){_[e]=t,x[e]=i};let w=0;const S=Object(a["c"])(),T=Object(a["c"])();for(let a=0;a<i;a++){const e=a*(2*Math.PI/i);Object(n["h"])(S,f,Math.sin(e)),Object(n["h"])(T,b,Math.cos(e)),Object(n["i"])(S,S,T),y[3*a+0]=S[0],y[3*a+1]=S[1],y[3*a+2]=S[2],Object(n["h"])(S,S,t),Object(n["i"])(S,S,p),v[3*a+0]=S[0],v[3*a+1]=S[1],v[3*a+2]=S[2],O[2*a+0]=a/i,O[2*a+1]=0,v[3*(a+i)+0]=v[3*a+0]+u[0],v[3*(a+i)+1]=v[3*a+1]+u[1],v[3*(a+i)+2]=v[3*a+2]+u[2],O[2*(a+i)+0]=a/i,O[2*a+1]=1;const r=(a+1)%i;j(w++,a,a),j(w++,a+i,a),j(w++,r,r),j(w++,r,r),j(w++,a+i,a),j(w++,r+i,r)}if(o){for(let e=0;e<i;e++){const t=(e+1)%i;j(w++,m-2,g-2),j(w++,e,g-2),j(w++,t,g-2)}for(let e=0;e<i;e++){const t=(e+1)%i;j(w++,e+i,g-1),j(w++,m-1,g-1),j(w++,t+i,g-1)}}return new l["a"]([["position",{size:3,data:v,exclusive:!0}],["normal",{size:3,data:y,exclusive:!0}],["uv0",{size:2,data:O,exclusive:!0}]],[["position",_],["normal",x],["uv0",_]])}function S(t,i,r,n,a){r=r||10,n=null==n||n,Object(h["a"])(t.length>1);const s=[[0,0,0]],o=[],c=[];for(let e=0;e<r;e++){o.push([0,-e-1,-(e+1)%r-1]);const t=e/r*2*Math.PI;c.push([Math.cos(t)*i,Math.sin(t)*i])}return e.createPathExtrusionGeometry(c,t,s,o,n,a)}function T(e,t,i,r,d,h=Object(a["d"])(0,0,0)){const u=e.length,p=new Float32Array(t.length*u*3+(6*i.length||0)),f=new Float32Array(t.length*u*3+(i?6:0)),b=(t.length-1)*u*6+3*r.length*2,m=new Uint32Array(b),v=new Uint32Array(b);let y=0,O=0,_=0,x=0;const j=Object(a["c"])(),w=Object(a["c"])(),S=Object(a["c"])(),T=Object(a["c"])(),C=Object(a["c"])(),P=Object(a["c"])(),A=Object(a["c"])(),M=Object(s["f"])(),R=Object(a["c"])(),D=Object(a["c"])(),I=Object(a["c"])(),F=Object(a["c"])(),z=Object(a["c"])(),L=Object(o["d"])();Object(n["z"])(R,0,1,0),Object(n["m"])(w,t[1],t[0]),Object(n["u"])(w,w),d?(Object(n["i"])(M,t[0],h),Object(n["u"])(S,M)):Object(n["z"])(S,0,0,1),E(w,S,R,R,C,S,g),Object(n["n"])(T,S),Object(n["n"])(F,C);for(let a=0;a<i.length;a++)Object(n["h"])(P,C,i[a][0]),Object(n["h"])(M,S,i[a][2]),Object(n["i"])(P,P,M),Object(n["i"])(P,P,t[0]),p[y++]=P[0],p[y++]=P[1],p[y++]=P[2];f[O++]=-w[0],f[O++]=-w[1],f[O++]=-w[2];for(let n=0;n<r.length;n++)m[_++]=r[n][0]>0?r[n][0]:-r[n][0]-1+i.length,m[_++]=r[n][1]>0?r[n][1]:-r[n][1]-1+i.length,m[_++]=r[n][2]>0?r[n][2]:-r[n][2]-1+i.length,v[x++]=0,v[x++]=0,v[x++]=0;let V=i.length;const k=i.length-1;for(let a=0;a<t.length;a++){let i=!1;a>0&&(Object(n["n"])(j,w),a<t.length-1?(Object(n["m"])(w,t[a+1],t[a]),Object(n["u"])(w,w)):i=!0,Object(n["i"])(D,j,w),Object(n["u"])(D,D),Object(n["i"])(I,t[a-1],T),Object(o["h"])(t[a],D,L),Object(o["n"])(L,Object(c["h"])(I,j),M)?(Object(n["m"])(M,M,t[a]),Object(n["u"])(S,M),Object(n["j"])(C,D,S),Object(n["u"])(C,C)):E(D,T,F,R,C,S,g),Object(n["n"])(T,S),Object(n["n"])(F,C)),d&&(Object(n["i"])(M,t[a],h),Object(n["u"])(z,M));for(let r=0;r<u;r++)if(Object(n["h"])(P,C,e[r][0]),Object(n["h"])(M,S,e[r][1]),Object(n["i"])(P,P,M),Object(n["u"])(A,P),f[O++]=A[0],f[O++]=A[1],f[O++]=A[2],Object(n["i"])(P,P,t[a]),p[y++]=P[0],p[y++]=P[1],p[y++]=P[2],!i){const e=(r+1)%u;m[_++]=V+r,m[_++]=V+u+r,m[_++]=V+e,m[_++]=V+e,m[_++]=V+u+r,m[_++]=V+u+e;for(let t=0;t<6;t++)v[x++]=m[_-6+t]-k}V+=u}const U=t[t.length-1];for(let a=0;a<i.length;a++)Object(n["h"])(P,C,i[a][0]),Object(n["h"])(M,S,i[a][1]),Object(n["i"])(P,P,M),Object(n["i"])(P,P,U),p[y++]=P[0],p[y++]=P[1],p[y++]=P[2];const B=O/3;f[O++]=w[0],f[O++]=w[1],f[O++]=w[2];const N=V-u;for(let n=0;n<r.length;n++)m[_++]=r[n][0]>=0?V+r[n][0]:-r[n][0]-1+N,m[_++]=r[n][2]>=0?V+r[n][2]:-r[n][2]-1+N,m[_++]=r[n][1]>=0?V+r[n][1]:-r[n][1]-1+N,v[x++]=B,v[x++]=B,v[x++]=B;return new l["a"]([["position",{size:3,data:p,exclusive:!0}],["normal",{size:3,data:f,exclusive:!0}]],[["position",m],["normal",v]])}function C(e,t,i){Object(h["a"])(e.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),Object(h["a"])(3===e[0].length,"createPolylineGeometry(): malformed vertex"),Object(h["a"])(null==t||t.length===e.length,"createPolylineGeometry: need same number of points and normals"),Object(h["a"])(null==t||3===t[0].length,"createPolylineGeometry(): malformed normal");const r=new Float64Array(3*e.length),n=new Uint32Array(2*(e.length-1));let a=0,s=0;for(let l=0;l<e.length;l++){for(let t=0;t<3;t++)r[a++]=e[l][t];l>0&&(n[s++]=l-1,n[s++]=l)}const o=[],c=[];if(o.push(["position",n]),c.push(["position",{size:3,data:r,exclusive:!0}]),t){const i=new Float32Array(3*t.length);let r=0;for(let n=0;n<e.length;n++)for(let e=0;e<3;e++)i[r++]=t[n][e];o.push(["normal",n]),c.push(["normal",{size:3,data:i,exclusive:!0}])}return i&&(c.push(["color",{size:4,data:i}]),o.push(["color",Object(d["d"])(i.length/4)])),new l["a"](c,o,2)}function P(e,t,i,r,n=0){const a=new Array(18),s=[[-t,n,r/2],[i,n,r/2],[0,e+n,r/2],[-t,n,-r/2],[i,n,-r/2],[0,e+n,-r/2]],o=new Uint16Array([0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5]);for(let c=0;c<6;c++)a[3*c]=s[c][0],a[3*c+1]=s[c][1],a[3*c+2]=s[c][2];return new l["a"]([["position",{size:3,data:a,exclusive:!0}]],[["position",o]])}function A(e,t){const i=e.getMutableAttribute("position").data;for(let r=0;r<i.length;r+=3){const e=i[r],a=i[r+1],s=i[r+2];Object(n["z"])(v,e,a,s),Object(n["t"])(v,v,t),i[r]=v[0],i[r+1]=v[1],i[r+2]=v[2]}}function M(e,t=e){const i=e.vertexAttributes,r=i.get("position").data,n=i.get("normal").data;if(n){const e=t.getMutableAttribute("normal").data;for(let t=0;t<n.length;t+=3){const i=n[t+1];e[t+1]=-n[t+2],e[t+2]=i}}if(r){const e=t.getMutableAttribute("position").data;for(let t=0;t<r.length;t+=3){const i=r[t+1];e[t+1]=-r[t+2],e[t+2]=i}}return t}function R(e,t,i,r,a){return!(Math.abs(Object(n["k"])(t,e))>a)&&(Object(n["j"])(i,e,t),Object(n["u"])(i,i),Object(n["j"])(r,i,e),Object(n["u"])(r,r),!0)}function E(e,t,i,r,n,a,s){return R(e,t,n,a,s)||R(e,i,n,a,s)||R(e,r,n,a,s)}e.createSquareGeometry=x,e.createConeGeometry=j,e.createCylinderGeometry=w,e.createTubeGeometry=S,e.createPathExtrusionGeometry=T,e.createPolylineGeometry=C,e.createExtrudedTriangle=P,e.transformInPlace=A,e.cgToGIS=M,e.makeOrthoBasisDirUp=R,e.makeOrthoBasisDirUpFallback=E}(m||(m={}));const g=.99619469809,v=Object(a["c"])(),y=m},cba1:function(e,t,i){"use strict";i.d(t,"a",(function(){return r})),i.d(t,"b",(function(){return n}));class r{constructor(e){this.xTile=0,this.yTile=0,this.hash=0,this.priority=1,this.colliders=[],this.textVertexRanges=[],this.iconVertexRanges=[],this.tile=e}}class n{constructor(){this.tileSymbols=[],this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}],this.show=!1}}},ccac:function(e,t,i){"use strict";i.r(t),i.d(t,"createLabelFunction",(function(){return p})),i.d(t,"formatField",(function(){return f}));var r=i("ce50"),n=i("e92d"),a=i("4653"),s=i("21e2"),o=i("c1da"),c=i("7b39"),l=i("82fa");const d=n["a"].getLogger("esri.layers.support.labelFormatUtils"),h={type:"simple",evaluate:()=>null},u={getAttribute:(e,t)=>e.field(t)};async function p(e,t,n){if(!e||!e.symbol)return h;const a=e.where,s=Object(c["b"])(e),o=a?await i.e("chunk-2d0d03a7").then(i.bind(null,"66a2")):null;let p;if("arcade"===s.type){const e=await Object(l["c"])(s.expression,n,t);p={type:"arcade",evaluate(t){try{const i=e.evaluate({$feature:"attributes"in t?e.repurposeFeature(t):e.repurposeAdapter(t)});if(null!=i)return i.toString()}catch(n){d.error(new r["a"]("bad-arcade-expression","Encountered an error when evaluating label expression for feature",{feature:t,expression:s}))}return null},needsHydrationToEvaluate:()=>null==Object(c["e"])(s.expression)}}else p={type:"simple",evaluate:e=>s.expression.replace(/{[^}]*}/g,i=>{const r=i.slice(1,-1),n=t.get(r);if(!n)return i;let a=null;return"attributes"in e?e&&e.attributes&&(a=e.attributes[n.name]):a=e.field(n.name),null==a?"":f(a,n)})};if(a){let e;try{e=o.WhereClause.create(a,t)}catch(b){return h}const i=p.evaluate;p.evaluate=t=>{const r="attributes"in t?void 0:u;return e.testFeature(t,r)?i(t):null}}return p}function f(e,t){if(null==e)return"";const i=t.domain;if(i)if("codedValue"===i.type||"coded-value"===i.type){const t=e;for(const e of i.codedValues)if(e.code===t)return e.name}else if("range"===i.type){const t=+e,r="range"in i?i.range[0]:i.minValue,n="range"in i?i.range[1]:i.maxValue;if(r<=t&&t<=n)return i.name}let r=e;return"date"===t.type||"esriFieldTypeDate"===t.type?r=Object(a["b"])(r,Object(a["a"])("short-date")):Object(o["q"])(t)&&(r=Object(s["b"])(+r)),r||""}},cd26:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var r=i("dea3"),n=i("e550"),a=i("3886");function s(e,t){e.extensions.add("GL_OES_standard_derivatives"),3!==t.pbrMode&&4!==t.pbrMode||e.include(n["a"],t),e.vertex.uniforms.add("overlayTexOffset","vec4"),e.vertex.uniforms.add("overlayTexScale","vec4"),e.varyings.add("vtcOverlay","vec4"),e.vertex.code.add(a["a"]`void setOverlayVTC(in vec2 uv) {
vtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;
}`),e.fragment.uniforms.add("ovColorTex","sampler2D"),e.fragment.uniforms.add("overlayOpacity","float"),e.fragment.code.add(a["a"]`bool isValid(vec2 uv, vec2 dxdy) {
return (uv.x >= 0.0 + dxdy.x) && (uv.x <= 1.0 - dxdy.x) && (uv.y >= 0.0 + dxdy.y) && (uv.y <= 1.0 - dxdy.y);
}
vec4 getOverlayColor(sampler2D ov0Tex, vec4 texCoords) {
vec4 color0 = texture2D(ov0Tex, vec2(texCoords.x * 0.5, texCoords.y));
vec4 color1 = texture2D(ov0Tex, vec2(texCoords.z * 0.5 + 0.5, texCoords.w));
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`),e.fragment.code.add(a["a"]`vec4 getCombinedOverlayColor() {
return overlayOpacity * getOverlayColor(ovColorTex, vtcOverlay);
}`),3!==t.pbrMode&&4!==t.pbrMode||(e.include(r["a"]),e.fragment.code.add(a["a"]`vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,
float shadow, vec3 localUp, mat3 tbn, vec3 position) {
vec3 n = normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));
vec3 v = vposEyeDir;
vec3 final = getSeaColor(n, v, lightingMainDirection, colorInput.rgb, lightingMainIntensity, localUp, 1.0 - shadow, maskInput.w, position);
return vec4(final, colorInput.w);
}`))}},ce27:function(e,t,i){"use strict";function r(e,t){return null!=e&&(null==t||(2===t?!e.isGeographic||e.isWGS84||4490===e.wkid:e.isWebMercator||e.isWGS84||4490===e.wkid||104971===e.wkid||104905===e.wkid||104903===e.wkid))}i.d(t,"a",(function(){return r}))},ce99:function(e,t,i){"use strict";i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return a}));var r=i("3886"),n=i("690a");function a(e){const t=new n["a"],i=t.vertex.code,a=t.fragment.code;return t.attributes.add("position","vec2"),2===e.highlightStage&&(i.add(r["a"]`void main() {
gl_Position = vec4(vec2(1.0) - position * 2.0, 0.0, 1.0);
}`),t.fragment.uniforms.add("tex","sampler2D"),t.fragment.uniforms.add("invFramebufferDim","vec2"),a.add(r["a"]`void main() {
vec2 coord = gl_FragCoord.xy * invFramebufferDim;
vec4 value = texture2D(tex, coord);
float mx = floor(max(value.g, value.b));
gl_FragColor = vec4(ceil(value.r), mx, mx, 1.0);
}`)),0===e.highlightStage&&(t.attributes.add("uv0","vec2"),e.gridOptimization?(t.vertex.uniforms.add("coverageTex","sampler2D"),t.fragment.uniforms.add("blurSize","vec2"),t.varyings.add("blurCoordinate","vec3")):(t.vertex.uniforms.add("blurSize","vec2"),t.varyings.add("blurCoordinates[5]","vec2")),i.add(r["a"]`
    void main() {
      gl_Position = vec4(position, 0.0, 1.0);
      ${e.gridOptimization?r["a"]`
      vec4 cov = texture2D(coverageTex, uv0);
      if (cov.r == 0.0) {
        gl_Position = vec4(0.0);
      }
      blurCoordinate = vec3(gl_Position.xy * 0.5 + vec2(0.5), max(cov.g, cov.b));
      `:r["a"]`
      vec2 uv = position.xy * 0.5 + vec2(0.5);
      blurCoordinates[0] = uv;
      blurCoordinates[1] = uv + blurSize * 1.407333;
      blurCoordinates[2] = uv - blurSize * 1.407333;
      blurCoordinates[3] = uv + blurSize * 3.294215;
      blurCoordinates[4] = uv - blurSize * 3.294215;
          `}
    }`),t.fragment.uniforms.add("tex","sampler2D"),a.add(r["a"]`
    void main() {
      ${e.gridOptimization?r["a"]`
          vec2 uv = blurCoordinate.xy;
          vec4 center = texture2D(tex, uv);

          // do not blur if no pixel or all pixels in neighborhood are set
          if (blurCoordinate.z == 1.0) {
            gl_FragColor = center;
          } else {
            vec4 sum = vec4(0.0);
            sum += center * 0.204164;
            sum += texture2D(tex, uv + blurSize * 1.407333) * 0.304005;
            sum += texture2D(tex, uv - blurSize * 1.407333) * 0.304005;
            sum += texture2D(tex, uv + blurSize * 3.294215) * 0.093913;
            sum += texture2D(tex, uv - blurSize * 3.294215) * 0.093913;
            gl_FragColor = sum;
          }`:r["a"]`
          vec4 sum = vec4(0.0);
          sum += texture2D(tex, blurCoordinates[0]) * 0.204164;
          sum += texture2D(tex, blurCoordinates[1]) * 0.304005;
          sum += texture2D(tex, blurCoordinates[2]) * 0.304005;
          sum += texture2D(tex, blurCoordinates[3]) * 0.093913;
          sum += texture2D(tex, blurCoordinates[4]) * 0.093913;
          gl_FragColor = sum;`}
    }`)),1===e.highlightStage&&(t.varyings.add("uv","vec2"),e.gridOptimization&&(t.attributes.add("uv0","vec2"),t.vertex.uniforms.add("coverageTex","sampler2D")),i.add(r["a"]`
      void main() {
        ${e.gridOptimization?r["a"]`
            vec4 cov = texture2D(coverageTex, uv0);
            // if no highlight pixel set in this block, hide block
            if (cov.r == 0.0) {
              gl_Position = vec4(0.0);
              return;
            }`:""}
        gl_Position = vec4(position, 0.0, 1.0);
        uv = position.xy * 0.5 + vec2(0.5);
      }`),t.fragment.uniforms.add("tex","sampler2D"),t.fragment.uniforms.add("origin","sampler2D"),t.fragment.uniforms.add("color","vec4"),t.fragment.uniforms.add("haloColor","vec4"),t.fragment.uniforms.add("outlineSize","float"),t.fragment.uniforms.add("blurSize","float"),t.fragment.uniforms.add("opacities","vec4"),a.add(r["a"]`void main() {
vec4 blurredHighlightValue = texture2D(tex, uv);
float highlightIntensity = blurredHighlightValue.a;
if (highlightIntensity == 0.0) {
discard;
}
vec4 origin_color = texture2D(origin, uv);
float outlineIntensity;
float fillIntensity;
if (blurredHighlightValue.g > blurredHighlightValue.b) {
outlineIntensity = haloColor.w * opacities[1];
fillIntensity = color.w * opacities[3];
}
else {
outlineIntensity = haloColor.w * opacities[0];
fillIntensity = color.w * opacities[2];
}
float inner = 1.0 - outlineSize / 9.0;
float outer = 1.0 - (outlineSize + blurSize) / 9.0;
float outlineFactor = smoothstep(outer, inner, highlightIntensity);
float fillFactor = any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;
float intensity = outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;
gl_FragColor = vec4(mix(haloColor.rgb, color.rgb, fillFactor), intensity);
}`)),t}const s=Object.freeze({__proto__:null,build:a})},cee3:function(e,t,i){"use strict";i.d(t,"a",(function(){return Oe})),i.d(t,"b",(function(){return xe})),i.d(t,"c",(function(){return we})),i.d(t,"d",(function(){return Ee})),i.d(t,"e",(function(){return _e})),i.d(t,"f",(function(){return Me})),i.d(t,"g",(function(){return Se})),i.d(t,"h",(function(){return Ae})),i.d(t,"i",(function(){return Pe})),i.d(t,"j",(function(){return Ce})),i.d(t,"k",(function(){return Re})),i.d(t,"l",(function(){return De})),i.d(t,"m",(function(){return je})),i.d(t,"n",(function(){return Te}));var r=i("1c92"),n=i("dae5"),a=i("04f0"),s=i("e764"),o=i("b139"),c=i("e431"),l=i("47f8"),d=i("0b2d"),h=(i("7577"),i("0fc4")),u=i("4261"),p=i("7289");const f=1e-6,b=[0,0,0],m=[0,0,0];function g(e,t){const{data:i,size:r}=e,n=i.length/r;if(n<=0)return;const a=new re(e);se(b,a.minProj,a.maxProj),ce(b,b,.5),oe(m,a.maxProj,a.minProj);const s=ae(m),o=new ne;o.quality=s,n<14&&(e={data:new Float64Array(a.buffer,112,42),size:3});const c=[0,0,0],l=[0,0,0],d=[0,0,0],h=[0,0,0],u=[0,0,0],p=[0,0,0],f=[0,0,0];switch(v(a,e,f,c,l,d,h,u,p,o)){case 1:return void G(b,m,t);case 2:return void X(e,h,t)}C(e,f,c,l,d,h,u,p,o),Y(e,o.b0,o.b1,o.b2,$,Z);const g=[0,0,0];oe(g,Z,$),o.quality=ae(g),o.quality<s?te(o.b0,o.b1,o.b2,$,Z,g,t):G(b,m,t)}function v(e,t,i,r,n,a,s,o,c,l){return P(e,r,n),pe(r,n)<f?1:(oe(s,r,n),he(s,s),M(t,r,s,a)<f?2:(oe(o,n,a),he(o,o),oe(c,a,r),he(c,c),de(i,o,s),he(i,i),k(t,i,s,o,c,l),0))}const y=[0,0,0],O=[0,0,0],_=[0,0,0],x=[0,0,0],j=[0,0,0],w=[0,0,0],S=[0,0,0],T=[0,0,0];function C(e,t,i,r,n,a,s,o,c){E(e,t,i,y,O),void 0!==y[0]&&(oe(_,y,i),he(_,_),oe(x,y,r),he(x,x),oe(j,y,n),he(j,j),de(w,x,a),he(w,w),de(S,j,s),he(S,S),de(T,_,o),he(T,T),k(e,w,a,x,_,c),k(e,S,s,j,x,c),k(e,T,o,_,j,c)),void 0!==O[0]&&(oe(_,O,i),he(_,_),oe(x,O,r),he(x,x),oe(j,O,n),he(j,j),de(w,x,a),he(w,w),de(S,j,s),he(S,S),de(T,_,o),he(T,T),k(e,w,a,x,_,c),k(e,S,s,j,x,c),k(e,T,o,_,j,c))}function P(e,t,i){let r=pe(e.maxVert[0],e.minVert[0]),n=0;for(let a=1;a<7;++a){const t=pe(e.maxVert[a],e.minVert[a]);t>r&&(r=t,n=a)}le(t,e.minVert[n]),le(i,e.maxVert[n])}const A=[0,0,0];function M(e,t,i,r){const{data:n,size:a}=e;let s=Number.NEGATIVE_INFINITY,o=0;for(let c=0;c<n.length;c+=a){A[0]=n[c]-t[0],A[1]=n[c+1]-t[1],A[2]=n[c+2]-t[2];const e=i[0]*A[0]+i[1]*A[1]+i[2]*A[2],r=i[0]*i[0]+i[1]*i[1]+i[2]*i[2],a=A[0]*A[0]+A[1]*A[1]+A[2]*A[2]-e*e/r;a>s&&(s=a,o=c)}return le(r,n,o),s}const R=[0,0];function E(e,t,i,r,n){N(e,t,R,n,r);const a=fe(i,t);R[1]-f<=a&&(r[0]=void 0),R[0]+f>=a&&(n[0]=void 0)}const D=[0,0,0],I=[0,0,0],F=[0,0,0],z=[0,0,0],L=[0,0,0],V=[0,0,0];function k(e,t,i,r,n,a){if(ue(t)<f)return;de(D,i,t),de(I,r,t),de(F,n,t),B(e,t,R),L[1]=R[0],z[1]=R[1],V[1]=z[1]-L[1];const s=[i,r,n],o=[D,I,F];for(let c=0;c<3;++c){B(e,s[c],R),L[0]=R[0],z[0]=R[1],B(e,o[c],R),L[2]=R[0],z[2]=R[1],V[0]=z[0]-L[0],V[2]=z[2]-L[2];const i=ae(V);i<a.quality&&(le(a.b0,s[c]),le(a.b1,t),le(a.b2,o[c]),a.quality=i)}}const U=[0,0,0];function B(e,t,i){const{data:r,size:n}=e;i[0]=Number.POSITIVE_INFINITY,i[1]=Number.NEGATIVE_INFINITY;for(let a=0;a<r.length;a+=n){const e=r[a]*t[0]+r[a+1]*t[1]+r[a+2]*t[2];i[0]=Math.min(i[0],e),i[1]=Math.max(i[1],e)}}function N(e,t,i,r,n){const{data:a,size:s}=e;le(r,a),le(n,r),i[0]=fe(U,t),i[1]=i[0];for(let o=s;o<a.length;o+=s){const e=a[o]*t[0]+a[o+1]*t[1]+a[o+2]*t[2];e<i[0]&&(i[0]=e,le(r,a,o)),e>i[1]&&(i[1]=e,le(n,a,o))}}function G(e,t,i){le(i.center,e),ce(i.halfSize,t,.5),i.quaternion[0]=0,i.quaternion[1]=0,i.quaternion[2]=0,i.quaternion[3]=1}const q=[0,0,0],H=[0,0,0],W=[0,0,0],$=[0,0,0],Z=[0,0,0],Q=[0,0,0];function X(e,t,i){le(q,t),Math.abs(t[0])>Math.abs(t[1])&&Math.abs(t[0])>Math.abs(t[2])?q[0]=0:Math.abs(t[1])>Math.abs(t[2])?q[1]=0:q[2]=0,ue(q)<f&&(q[0]=q[1]=q[2]=1),de(H,t,q),he(H,H),de(W,t,H),he(W,W),Y(e,t,H,W,$,Z),oe(Q,Z,$),te(t,H,W,$,Z,Q,i)}function Y(e,t,i,r,n,a){B(e,t,R),n[0]=R[0],a[0]=R[1],B(e,i,R),n[1]=R[0],a[1]=R[1],B(e,r,R),n[2]=R[0],a[2]=R[1]}const K=[0,0,0],J=[1,0,0,0,1,0,0,0,1],ee=[0,0,0];function te(e,t,i,r,n,a,s){J[0]=e[0],J[1]=e[1],J[2]=e[2],J[3]=t[0],J[4]=t[1],J[5]=t[2],J[6]=i[0],J[7]=i[1],J[8]=i[2],be(s.quaternion,J),se(ee,r,n),ce(ee,ee,.5),ce(s.center,e,ee[0]),ce(K,t,ee[1]),se(s.center,s.center,K),ce(K,i,ee[2]),se(s.center,s.center,K),ce(s.halfSize,a,.5)}const ie=7;class re{constructor(e){this.minVert=new Array(ie),this.maxVert=new Array(ie);const t=64*ie;this.buffer=new ArrayBuffer(t);let i=0;this.minProj=new Float64Array(this.buffer,i,ie),i+=8*ie,this.maxProj=new Float64Array(this.buffer,i,ie),i+=8*ie;for(let o=0;o<ie;++o)this.minVert[o]=new Float64Array(this.buffer,i,3),i+=24;for(let o=0;o<ie;++o)this.maxVert[o]=new Float64Array(this.buffer,i,3),i+=24;for(let o=0;o<ie;++o)this.minProj[o]=Number.POSITIVE_INFINITY,this.maxProj[o]=Number.NEGATIVE_INFINITY;const r=new Array(ie),n=new Array(ie),{data:a,size:s}=e;for(let o=0;o<a.length;o+=s){let e=a[o];e<this.minProj[0]&&(this.minProj[0]=e,r[0]=o),e>this.maxProj[0]&&(this.maxProj[0]=e,n[0]=o),e=a[o+1],e<this.minProj[1]&&(this.minProj[1]=e,r[1]=o),e>this.maxProj[1]&&(this.maxProj[1]=e,n[1]=o),e=a[o+2],e<this.minProj[2]&&(this.minProj[2]=e,r[2]=o),e>this.maxProj[2]&&(this.maxProj[2]=e,n[2]=o),e=a[o]+a[o+1]+a[o+2],e<this.minProj[3]&&(this.minProj[3]=e,r[3]=o),e>this.maxProj[3]&&(this.maxProj[3]=e,n[3]=o),e=a[o]+a[o+1]-a[o+2],e<this.minProj[4]&&(this.minProj[4]=e,r[4]=o),e>this.maxProj[4]&&(this.maxProj[4]=e,n[4]=o),e=a[o]-a[o+1]+a[o+2],e<this.minProj[5]&&(this.minProj[5]=e,r[5]=o),e>this.maxProj[5]&&(this.maxProj[5]=e,n[5]=o),e=a[o]-a[o+1]-a[o+2],e<this.minProj[6]&&(this.minProj[6]=e,r[6]=o),e>this.maxProj[6]&&(this.maxProj[6]=e,n[6]=o)}for(let o=0;o<ie;++o){let e=r[o];le(this.minVert[o],a,e),e=n[o],le(this.maxVert[o],a,e)}}}class ne{constructor(){this.b0=[1,0,0],this.b1=[0,1,0],this.b2=[0,0,1],this.quality=0}}function ae(e){return e[0]*e[1]+e[0]*e[2]+e[1]*e[2]}function se(e,t,i){e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2]}function oe(e,t,i){e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2]}function ce(e,t,i){e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i}function le(e,t,i=0){e[0]=t[i+0],e[1]=t[i+1],e[2]=t[i+2]}function de(e,t,i){const r=t[0],n=t[1],a=t[2],s=i[0],o=i[1],c=i[2];e[0]=n*c-a*o,e[1]=a*s-r*c,e[2]=r*o-n*s}function he(e,t){const i=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];if(i>0){const r=1/Math.sqrt(i);e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r}}function ue(e){return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]}function pe(e,t){const i=t[0]-e[0],r=t[1]-e[1],n=t[2]-e[2];return i*i+r*r+n*n}function fe(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function be(e,t){const i=t[0]+t[4]+t[8];if(i>0){let r=Math.sqrt(i+1);e[3]=.5*r,r=.5/r,e[0]=(t[5]-t[7])*r,e[1]=(t[6]-t[2])*r,e[2]=(t[1]-t[3])*r}else{let i=0;t[4]>t[0]&&(i=1),t[8]>t[3*i+i]&&(i=2);const r=(i+1)%3,n=(i+2)%3;let a=Math.sqrt(t[3*i+i]-t[3*r+r]-t[3*n+n]+1);e[i]=.5*a,a=.5/a,e[3]=(t[3*r+n]-t[3*n+r])*a,e[r]=(t[3*r+i]+t[3*i+r])*a,e[n]=(t[3*n+i]+t[3*i+n])*a}}const me=Object(o["b"])(),ge=Object(d["f"])(),ve=Object(d["f"])(),ye=(Object(h["e"])(),Object(n["b"])());class Oe{constructor(e){const t=56,i=0,r=24,n=36,a=e*t;this.buffer=new ArrayBuffer(a),this.obbs=new Array(e);for(let o=0;o<e;o++)this.obbs[o]={center:Object(d["e"])(this.buffer,t*o+i),halfSize:Object(l["b"])(this.buffer,t*o+r),quaternion:Object(s["a"])(this.buffer,t*o+n)}}}function _e(e=[0,0,0],t=[-1,-1,-1],i=[0,0,0,1]){return{center:Object(d["d"])(e),halfSize:Object(l["a"])(t),quaternion:Object(s["c"])(i)}}function xe(e){return _e(e.center,e.halfSize,e.quaternion)}function je(e,t){Object(c["n"])(t.center,e.center),Object(c["n"])(t.halfSize,e.halfSize),Object(a["a"])(t.quaternion,e.quaternion)}function we(e,t){return t=t||_e(),g(e,t),t}function Se(e,t){const i=Object(p["v"])(t,e.center),r=Re(e,Object(p["r"])(t));return i>r?1:i<-r?-1:0}function Te(e,t){t||(t=Object(u["h"])());const i=Object(r["h"])(ye,e.quaternion),n=e.halfSize[0]*Math.abs(i[0])+e.halfSize[1]*Math.abs(i[3])+e.halfSize[2]*Math.abs(i[6]),a=e.halfSize[0]*Math.abs(i[1])+e.halfSize[1]*Math.abs(i[4])+e.halfSize[2]*Math.abs(i[7]),s=e.halfSize[0]*Math.abs(i[2])+e.halfSize[1]*Math.abs(i[5])+e.halfSize[2]*Math.abs(i[8]);return t[0]=e.center[0]-n,t[1]=e.center[1]-a,t[2]=e.center[2]-s,t[3]=e.center[0]+n,t[4]=e.center[1]+a,t[5]=e.center[2]+s,t}function Ce(e,t){return Object(p["v"])(t,e.center)-Re(e,Object(p["r"])(t))}function Pe(e,t){return Object(p["v"])(t,e.center)+Re(e,Object(p["r"])(t))}function Ae(e,t){return Se(e,t[0])<=0&&Se(e,t[1])<=0&&Se(e,t[2])<=0&&Se(e,t[3])<=0&&Se(e,t[4])<=0&&Se(e,t[5])<=0}function Me(e,t,i,r=0){Object(a["b"])(me,e.quaternion),Object(c["m"])(ge,t,e.center);const n=Object(c["x"])(ge,ge,me),s=Object(c["x"])(ve,i,me);let o=-1/0,l=1/0;for(let a=0;a<3;a++)if(Math.abs(s[a])>1e-6){const t=(r+e.halfSize[a]-n[a])/s[a],i=(-r-e.halfSize[a]-n[a])/s[a];o=Math.max(o,Math.min(t,i)),l=Math.min(l,Math.max(t,i))}else if(n[a]>e.halfSize[a]+r||n[a]<-e.halfSize[a]-r)return!1;return o<=l}(()=>{const e=new Int8Array(162);let t=0;const i=i=>{for(let r=0;r<i.length;r++)e[t+r]=i[r];t+=6};i([6,2,3,1,5,4]),i([0,2,3,1,5,4]),i([0,2,3,7,5,4]),i([0,1,3,2,6,4]),i([0,1,3,2,0,0]),i([0,1,5,7,3,2]),i([0,1,3,7,6,4]),i([0,1,3,7,6,2]),i([0,1,5,7,6,2]),i([0,1,5,4,6,2]),i([0,1,5,4,0,0]),i([0,1,3,7,5,4]),i([0,2,6,4,0,0]),i([0,0,0,0,0,0]),i([1,3,7,5,0,0]),i([2,3,7,6,4,0]),i([2,3,7,6,0,0]),i([2,3,1,5,7,6]),i([0,1,5,7,6,2]),i([0,1,5,7,6,4]),i([0,1,3,7,6,4]),i([4,5,7,6,2,0]),i([4,5,7,6,0,0]),i([4,5,1,3,7,6]),i([0,2,3,7,5,4]),i([6,2,3,7,5,4]),i([6,2,3,1,5,4])})();function Re(e,t){Object(a["b"])(me,e.quaternion),Object(c["x"])(ge,t,me);const i=e.halfSize;return Math.abs(ge[0]*i[0])+Math.abs(ge[1]*i[1])+Math.abs(ge[2]*i[2])}function Ee(e,t){for(let i=0;i<8;++i){const r=t[i];r[0]=1&i?-e.halfSize[0]:e.halfSize[0],r[1]=2&i?-e.halfSize[1]:e.halfSize[1],r[2]=4&i?-e.halfSize[2]:e.halfSize[2],Object(c["x"])(r,r,e.quaternion),Object(c["i"])(r,r,e.center)}}function De(e){return Object(c["B"])(e.halfSize)}},d017:function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return s})),i.d(t,"c",(function(){return c})),i.d(t,"d",(function(){return o}));var r=i("501b"),n=i("3886");function a(e){e.fragment.include(r["a"]),e.fragment.uniforms.add("uShadowMapTex","sampler2D"),e.fragment.uniforms.add("uShadowMapNum","int"),e.fragment.uniforms.add("uShadowMapDistance","vec4"),e.fragment.uniforms.add("uShadowMapMatrix","mat4",4),e.fragment.uniforms.add("uDepthHalfPixelSz","float"),e.fragment.code.add(n["a"]`int chooseCascade(float _linearDepth, out mat4 mat) {
vec4 distance = uShadowMapDistance;
float depth = _linearDepth;
int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;
mat = i == 0 ? uShadowMapMatrix[0] : i == 1 ? uShadowMapMatrix[1] : i == 2 ? uShadowMapMatrix[2] : uShadowMapMatrix[3];
return i;
}
vec3 lightSpacePosition(vec3 _vpos, mat4 mat) {
vec4 lv = mat * vec4(_vpos, 1.0);
lv.xy /= lv.w;
return 0.5 * lv.xyz + vec3(0.5);
}
vec2 cascadeCoordinates(int i, vec3 lvpos) {
return vec2(float(i - 2 * (i / 2)) * 0.5, float(i / 2) * 0.5) + 0.5 * lvpos.xy;
}
float readShadowMapDepth(vec2 uv, sampler2D _depthTex) {
return rgba2float(texture2D(_depthTex, uv));
}
float posIsInShadow(vec2 uv, vec3 lvpos, sampler2D _depthTex) {
return readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;
}
float filterShadow(vec2 uv, vec3 lvpos, float halfPixelSize, sampler2D _depthTex) {
float texSize = 0.5 / halfPixelSize;
vec2 st = fract((vec2(halfPixelSize) + uv) * texSize);
float s00 = posIsInShadow(uv + vec2(-halfPixelSize, -halfPixelSize), lvpos, _depthTex);
float s10 = posIsInShadow(uv + vec2(halfPixelSize, -halfPixelSize), lvpos, _depthTex);
float s11 = posIsInShadow(uv + vec2(halfPixelSize, halfPixelSize), lvpos, _depthTex);
float s01 = posIsInShadow(uv + vec2(-halfPixelSize, halfPixelSize), lvpos, _depthTex);
return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);
}
float readShadowMap(const in vec3 _vpos, float _linearDepth) {
mat4 mat;
int i = chooseCascade(_linearDepth, mat);
if (i >= uShadowMapNum) { return 0.0; }
vec3 lvpos = lightSpacePosition(_vpos, mat);
if (lvpos.z >= 1.0) { return 0.0; }
if (lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }
vec2 uv = cascadeCoordinates(i, lvpos);
return filterShadow(uv, lvpos, uDepthHalfPixelSz, uShadowMapTex);
}`)}function s(e,t){t.shadowMappingEnabled&&(t.shadowMap.bind(e),t.shadowMap.bindView(e,t.origin))}function o(e,t,i){t.shadowMappingEnabled&&t.shadowMap.bindView(e,i)}function c(e,t){t.shadowMappingEnabled&&t.shadowMap.bindView(e,t.origin)}},d047:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i("501b"),n=i("3886");function a(e){e.include(r["a"]),e.code.add(n["a"]`float linearDepthFromFloat(float depth, vec2 nearFar) {
return -(depth * (nearFar[1] - nearFar[0]) + nearFar[0]);
}
float linearDepthFromTexture(sampler2D depthTex, vec2 uv, vec2 nearFar) {
return linearDepthFromFloat(rgba2float(texture2D(depthTex, uv)), nearFar);
}`)}},d0cb:function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return s}));var r=i("2f98"),n=i("3886");function a(e,t){const i=e;i.include(r["a"]),i.attributes.add("position","vec3"),i.attributes.add("normal","vec3"),i.attributes.add("auxpos1","vec4"),i.vertex.uniforms.add("proj","mat4"),i.vertex.uniforms.add("view","mat4"),i.vertex.uniforms.add("viewNormal","mat4"),i.vertex.uniforms.add("viewport","vec4"),i.vertex.uniforms.add("camPos","vec3"),i.vertex.uniforms.add("polygonOffset","float"),i.vertex.uniforms.add("cameraGroundRelative","float"),i.vertex.uniforms.add("pixelRatio","float"),i.vertex.uniforms.add("perDistancePixelRatio","float"),i.vertex.uniforms.add("uRenderTransparentlyOccludedHUD","float"),t.verticalOffsetEnabled&&i.vertex.uniforms.add("verticalOffset","vec4"),t.screenSizePerspectiveEnabled&&i.vertex.uniforms.add("screenSizePerspectiveAlignment","vec4"),i.vertex.uniforms.add("hudVisibilityTexture","sampler2D"),i.vertex.constants.add("smallOffsetAngle","float",.984807753012208),i.vertex.code.add(n["a"]`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`),i.vertex.code.add(n["a"]`float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
float pointGroundSign = sign(pointGroundDistance);
if (pointGroundSign == 0.0) {
pointGroundSign = cameraGroundRelative;
}
float groundRelative = cameraGroundRelative * pointGroundSign;
if (polygonOffset > .0) {
float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
float factor = (1.0 - tanAlpha / viewport[2]);
if (groundRelative > 0.0) {
posView *= factor;
}
else {
posView /= factor;
}
}
return groundRelative;
}`),t.isDraped||i.vertex.code.add(n["a"]`void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
float distanceToCamera = length(posView);
float pixelOffset = distanceToCamera * perDistancePixelRatio * 0.5;
vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;
vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
posModel += modelOffset;
posView += viewOffset;
}`),i.vertex.code.add(n["a"]`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      // centerOffset is in view space and is used to implement world size offsetting
      // of labels with respect to objects. It also pulls the label towards the viewer
      // so that the label is visible in front of the object.
      vec3 centerOffset = auxpos1.xyz;

      // The pointGroundDistance is the distance of the geometry to the ground and is
      // negative if the point is below the ground, or positive if the point is above
      // ground.
      float pointGroundDistance = auxpos1.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${t.isDraped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(camPos - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${t.screenSizePerspectiveEnabled&&(t.verticalOffsetEnabled||1===t.screenCenterOffsetUnitsEnabled)?"vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":""}

      ${t.verticalOffsetEnabled?t.screenSizePerspectiveEnabled?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":""}

      ${t.verticalOffsetEnabled?n["a"]`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${1!==t.screenCenterOffsetUnitsEnabled?n["a"]`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `:""}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${1===t.screenCenterOffsetUnitsEnabled?t.screenSizePerspectiveEnabled?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":""}

      ${1===t.screenCenterOffsetUnitsEnabled?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `),i.vertex.code.add(n["a"]`bool testVisibilityHUD(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (uRenderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * uRenderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)}function s(e,t){e.setUniform1f("uRenderTransparentlyOccludedHUD",0===t.renderTransparentlyOccludedHUD?1:1===t.renderTransparentlyOccludedHUD?0:.75)}},d17d:function(e,t,i){"use strict";i.d(t,"a",(function(){return r})),i.d(t,"b",(function(){return a})),i.d(t,"c",(function(){return n}));const r=33984;var n;!function(e){e[e.Texture=0]="Texture",e[e.Buffer=1]="Buffer",e[e.VAO=2]="VAO",e[e.VertexShader=3]="VertexShader",e[e.FragmentShader=4]="FragmentShader",e[e.Program=5]="Program",e[e.Framebuffer=6]="Framebuffer",e[e.Renderbuffer=7]="Renderbuffer",e[e.COUNT=8]="COUNT"}(n||(n={}));const a=33306},d18f:function(e,t,i){"use strict";i.d(t,"a",(function(){return b})),i.d(t,"b",(function(){return h})),i.d(t,"c",(function(){return c})),i.d(t,"d",(function(){return f})),i.d(t,"e",(function(){return l})),i.d(t,"f",(function(){return u})),i.d(t,"g",(function(){return p})),i.d(t,"h",(function(){return d}));var r=i("b50f"),n=i("2119"),a=i("e431"),s=i("0b2d"),o=i("7361");function c(e){return e?{origin:Object(s["d"])(e.origin),direction:Object(s["d"])(e.direction)}:{origin:Object(s["f"])(),direction:Object(s["f"])()}}function l(e,t){return Object(r["e"])(e.origin,t.origin)&&Object(r["e"])(e.direction,t.direction)}function d(e,t){const i=g.get();return i.origin=e,i.direction=t,i}function h(e,t=c()){return p(e.origin,e.direction,t)}function u(e,t,i=c()){return Object(a["n"])(i.origin,e),Object(a["m"])(i.direction,t,e),i}function p(e,t,i=c()){return Object(a["n"])(i.origin,e),Object(a["n"])(i.direction,t),i}function f(e,t){const i=Object(a["j"])(o["d"].get(),Object(a["u"])(o["d"].get(),e.direction),Object(a["m"])(o["d"].get(),t,e.origin));return Object(a["k"])(i,i)}function b(e,t,i){const r=Object(a["k"])(e.direction,Object(a["m"])(i,t,e.origin));return Object(a["i"])(i,e.origin,Object(a["h"])(i,e.direction,r)),i}function m(){return{origin:null,direction:null}}const g=new n["a"](m)},d1ac:function(e,t,i){"use strict";i.d(t,"a",(function(){return h})),i.d(t,"b",(function(){return u})),i.d(t,"c",(function(){return c})),i.d(t,"d",(function(){return d}));var r=i("9ef0"),n=i("b2b2"),a=i("d297");function s(e,t){if(!e||e.symbol)return null;const i=t&&t.renderer;return e&&Object(n["l"])(i)&&i.getObservationRenderer?i.getObservationRenderer(e):i}function o(e,t){if(Object(n["l"])(e.symbol))return e.symbol;const i=s(e,t);return Object(n["l"])(i)&&"dot-density"!==i.type?i.getSymbol(e,t):null}function c(e,t){const i=s(e,t),r=o(e,t);if(Object(n["k"])(r))return null;const c={renderer:i,symbol:r};if(Object(n["k"])(i)||!("visualVariables"in i)||!i.visualVariables)return c;const l=Object(a["getVisualVariableValues"])(i,e,t),d=["proportional","proportional","proportional"];for(const{variable:n,value:a}of l)switch(n.type){case"color":c.color=a.toRgba();break;case"size":if("outline"===n.target)c.outlineSize=a;else{const e=n.axis,t=n.useSymbolValue?"symbol-value":a;switch(e){case"width":d[0]=t;break;case"depth":d[1]=t;break;case"height":d[2]=t;break;case"width-and-depth":d[0]=d[1]=t;break;default:d[0]=d[1]=d[2]=t}}break;case"opacity":c.opacity=a;break;case"rotation":switch(n.axis){case"tilt":c.tilt=a;break;case"roll":c.roll=a;break;default:c.heading=a}}return"proportional"===d[0]&&"proportional"===d[1]&&"proportional"===d[2]||(c.size=d),c}async function l(e,t){if(Object(n["l"])(e.symbol))return e.symbol;const i=s(e,t);return Object(n["l"])(i)&&i.getSymbolAsync(e,{...t,abortOptions:{signal:t.signal}})}async function d(e,t){const i=s(e,t),n=await l(e,t);if(!n)return null;const o={renderer:i,symbol:n};if(!i||!("visualVariables"in i)||!i.visualVariables)return o;const c=Object(a["getVisualVariableValues"])(i,e,t),d=["proportional","proportional","proportional"];for(const{variable:a,value:s}of c)if("color"===a.type)o.color=r["a"].toUnitRGBA(s);else if("size"===a.type)if("outline"===a.target)o.outlineSize=s;else{const e=a.axis,t=a.useSymbolValue?"symbol-value":s;"width"===e?d[0]=t:"depth"===e?d[1]=t:"height"===e?d[2]=t:d[0]=d[1]="width-and-depth"===e?t:d[2]=t}else"opacity"===a.type?o.opacity=s:"rotation"===a.type&&"tilt"===a.axis?o.tilt=s:"rotation"===a.type&&"roll"===a.axis?o.roll=s:"rotation"===a.type&&(o.heading=s);return(isFinite(d[0])||isFinite(d[1])||isFinite(d[2]))&&(o.size=d),o}function h(e,t=0){const i=e[t];return"number"==typeof i&&isFinite(i)?i:null}function u(e){for(let t=0;t<3;t++){const i=e[t];if("number"==typeof i)return isFinite(i)?i:0}return 0}},d272:function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return l})),i.d(t,"c",(function(){return c}));var r=i("b2b2"),n=i("e431"),a=i("0b2d"),s=i("3886");function o(e,t){if(t.slicePlaneEnabled){e.extensions.add("GL_OES_standard_derivatives"),t.sliceEnabledForVertexPrograms&&(e.vertex.uniforms.add("slicePlaneOrigin","vec3"),e.vertex.uniforms.add("slicePlaneBasis1","vec3"),e.vertex.uniforms.add("slicePlaneBasis2","vec3")),e.fragment.uniforms.add("slicePlaneOrigin","vec3"),e.fragment.uniforms.add("slicePlaneBasis1","vec3"),e.fragment.uniforms.add("slicePlaneBasis2","vec3");const i=s["a"]`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
#define rejectBySlice(_pos_) sliceByPlane(_pos_)
#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }`,r=s["a"]`vec4 applySliceHighlight(vec4 color, vec3 pos) {
SliceFactors factors = calculateSliceFactors(pos);
if (sliceByFactors(factors)) {
return color;
}
const float HIGHLIGHT_WIDTH = 1.0;
const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);
factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);
factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);
factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);
factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);
factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);
float highlightFactor = (1.0 - step(0.5, factors.front))
* (1.0 - step(0.5, factors.side0))
* (1.0 - step(0.5, factors.side1))
* (1.0 - step(0.5, factors.side2))
* (1.0 - step(0.5, factors.side3));
return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);
}`,n=t.sliceHighlightDisabled?s["a"]`#define highlightSlice(_color_, _pos_) (_color_)`:s["a"]`
        ${r}
        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))
      `;t.sliceEnabledForVertexPrograms&&e.vertex.code.add(i),e.fragment.code.add(i),e.fragment.code.add(n)}else{const i=s["a"]`#define rejectBySlice(_pos_) false
#define discardBySlice(_pos_) {}
#define highlightSlice(_color_, _pos_) (_color_)`;t.sliceEnabledForVertexPrograms&&e.vertex.code.add(i),e.fragment.code.add(i)}}function c(e,t,i){l(e,t,i.slicePlane,i.origin)}function l(e,t,i,s){t.slicePlaneEnabled&&(Object(r["l"])(i)?(s?(Object(n["m"])(d,i.origin,s),e.setUniform3fv("slicePlaneOrigin",d)):e.setUniform3fv("slicePlaneOrigin",i.origin),e.setUniform3fv("slicePlaneBasis1",i.basis1),e.setUniform3fv("slicePlaneBasis2",i.basis2)):(e.setUniform3fv("slicePlaneBasis1",a["c"]),e.setUniform3fv("slicePlaneBasis2",a["c"]),e.setUniform3fv("slicePlaneOrigin",a["c"])))}const d=Object(a["f"])()},d359:function(e,t,i){"use strict";i.d(t,"a",(function(){return m})),i.d(t,"b",(function(){return f})),i.d(t,"c",(function(){return u})),i.d(t,"d",(function(){return p})),i.d(t,"e",(function(){return b})),i.d(t,"f",(function(){return y})),i.d(t,"g",(function(){return x})),i.d(t,"h",(function(){return O})),i.d(t,"i",(function(){return _})),i.d(t,"j",(function(){return v})),i.d(t,"k",(function(){return g})),i.d(t,"l",(function(){return w}));var r=i("2119"),n=i("d791"),a=i("e431"),s=i("0b2d"),o=i("7577"),c=i("0fc4"),l=i("4f8b"),d=i("7289"),h=i("7361");function u(e){return e?[Object(d["d"])(e[0]),Object(d["d"])(e[1]),Object(d["d"])(e[2]),Object(d["d"])(e[3]),Object(d["d"])(e[4]),Object(d["d"])(e[5])]:[Object(d["d"])(),Object(d["d"])(),Object(d["d"])(),Object(d["d"])(),Object(d["d"])(),Object(d["d"])()]}function p(){return[Object(s["f"])(),Object(s["f"])(),Object(s["f"])(),Object(s["f"])(),Object(s["f"])(),Object(s["f"])(),Object(s["f"])(),Object(s["f"])()]}function f(e,t=u()){for(let i=0;i<6;i++)Object(d["c"])(e[i],t[i])}function b(e,t,i,r=C){const s=Object(n["n"])(h["a"].get(),t,e);Object(n["c"])(s,s);for(let n=0;n<8;++n){const e=Object(o["m"])(h["e"].get(),S[n],s);Object(a["z"])(r[n],e[0]/e[3],e[1]/e[3],e[2]/e[3])}m(i,r)}function m(e,t){Object(d["g"])(t[4],t[0],t[3],e[0]),Object(d["g"])(t[1],t[5],t[6],e[1]),Object(d["g"])(t[4],t[5],t[1],e[2]),Object(d["g"])(t[3],t[2],t[6],e[3]),Object(d["g"])(t[0],t[1],t[2],e[4]),Object(d["g"])(t[5],t[4],t[7],e[5])}function g(e,t){for(let i=0;i<6;i++){const r=e[i];if(r[0]*t[0]+r[1]*t[1]+r[2]*t[2]+r[3]>=t[3])return!1}return!0}function v(e,t){return j(e,Object(l["c"])(t,T.get()))}function y(e,t){for(let i=0;i<6;i++){const r=e[i];if(!Object(d["b"])(r,t))return!1}return!0}function O(e,t,i){return j(e,Object(l["b"])(t,i,T.get()))}function _(e,t){for(let i=0;i<6;i++)if(Object(d["v"])(e[i],t)>0)return!1;return!0}function x(e,t){for(let i=0;i<6;i++)if(Object(d["o"])(e[i],t))return!1;return!0}function j(e,t){for(let i=0;i<6;i++)if(!Object(d["a"])(e[i],t))return!1;return!0}const w={bottom:[5,1,0,4],near:[0,1,2,3],far:[5,4,7,6],right:[1,5,6,2],left:[4,0,3,7],top:[7,3,2,6]},S=[Object(c["g"])(-1,-1,-1,1),Object(c["g"])(1,-1,-1,1),Object(c["g"])(1,1,-1,1),Object(c["g"])(-1,1,-1,1),Object(c["g"])(-1,-1,1,1),Object(c["g"])(1,-1,1,1),Object(c["g"])(1,1,1,1),Object(c["g"])(-1,1,1,1)],T=new r["a"](l["a"]),C=p()},d36e:function(e,t,i){"use strict";i.d(t,"a",(function(){return S}));var r=i("d7f7"),n=i("b061"),a=i("35b3"),s=i("7438"),o=i("8675"),c=i("7c51"),l=i("a4ee"),d=i("d272"),h=i("6a07"),u=i("c6d7"),p=i("8e97"),f=i("c3a4"),b=i("ca98"),m=i("da35"),g=i("fa1e"),v=i("c829"),y=i("87b7"),O=i("1962"),_=i("189c");class x extends b["a"]{initializeProgram(e){const t=x.shader.get(),i=this.configuration,r=t.build({output:i.output,OITEnabled:0===i.transparencyPassType,attributeColor:i.vertexColors,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,multipassTerrainEnabled:i.multipassTerrainEnabled,cullAboveGround:i.cullAboveGround});return new v["a"](e.rctx,r,g["a"])}bindPass(e,t){Object(p["c"])(this.program,t.camera.projectionMatrix),this.program.setUniform4fv("eColor",e.color),4===this.configuration.output&&Object(h["b"])(this.program,t),(1===this.configuration.output||t.multipassTerrainEnabled)&&this.program.setUniform2fv("cameraNearFar",t.camera.nearFar),t.multipassTerrainEnabled&&(this.program.setUniform2fv("inverseViewport",t.inverseViewport),Object(u["a"])(this.program,t))}bindDraw(e){Object(p["d"])(this.program,e),this.program.rebindTextures(),Object(d["c"])(this.program,this.configuration,e)}createPipeline(e,t){const i=this.configuration,r=3===e,n=2===e;return Object(_["g"])({blending:0!==i.output&&7!==i.output||!i.transparent?null:r?s["g"]:Object(s["a"])(e),culling:Object(_["c"])(i.cullFace),depthTest:{func:Object(s["b"])(e)},depthWrite:r||n?i.writeDepth&&_["e"]:null,colorWrite:_["d"],stencilWrite:i.sceneHasOcludees?y["j"]:null,stencilTest:i.sceneHasOcludees?t?y["f"]:y["e"]:null,polygonOffset:r||n?i.polygonOffset&&j:Object(s["h"])(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this.createPipeline(this.configuration.transparencyPassType,!0),this.createPipeline(this.configuration.transparencyPassType,!1)}getPipelineState(e,t){return t?this._occludeePipelineState:super.getPipelineState(e,t)}}x.shader=new f["a"](O["a"],()=>i.e("chunk-2d0de726").then(i.bind(null,"864f")));const j={factor:1,units:1};class w extends m["a"]{constructor(){super(...arguments),this.output=0,this.cullFace=0,this.slicePlaneEnabled=!1,this.vertexColors=!1,this.transparent=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.sceneHasOcludees=!1,this.transparencyPassType=3,this.multipassTerrainEnabled=!1,this.cullAboveGround=!1}}Object(l["a"])([Object(m["b"])({count:8})],w.prototype,"output",void 0),Object(l["a"])([Object(m["b"])({count:3})],w.prototype,"cullFace",void 0),Object(l["a"])([Object(m["b"])()],w.prototype,"slicePlaneEnabled",void 0),Object(l["a"])([Object(m["b"])()],w.prototype,"vertexColors",void 0),Object(l["a"])([Object(m["b"])()],w.prototype,"transparent",void 0),Object(l["a"])([Object(m["b"])()],w.prototype,"polygonOffset",void 0),Object(l["a"])([Object(m["b"])()],w.prototype,"enableOffset",void 0),Object(l["a"])([Object(m["b"])()],w.prototype,"writeDepth",void 0),Object(l["a"])([Object(m["b"])()],w.prototype,"sceneHasOcludees",void 0),Object(l["a"])([Object(m["b"])({count:4})],w.prototype,"transparencyPassType",void 0),Object(l["a"])([Object(m["b"])()],w.prototype,"multipassTerrainEnabled",void 0),Object(l["a"])([Object(m["b"])()],w.prototype,"cullAboveGround",void 0);class S extends a["a"]{constructor(e){super(e,C),this.supportsEdges=!0,this.techniqueConfig=new w}getTechniqueConfig(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.cullFace=this.parameters.cullFace,this.techniqueConfig.vertexColors=this.parameters.vertexColors,this.techniqueConfig.slicePlaneEnabled=this.parameters.slicePlaneEnabled,this.techniqueConfig.transparent=this.parameters.transparent,this.techniqueConfig.polygonOffset=this.parameters.polygonOffset,this.techniqueConfig.writeDepth=this.parameters.writeDepth,this.techniqueConfig.sceneHasOcludees=this.parameters.sceneHasOcludees,this.techniqueConfig.transparencyPassType=t.transparencyPassType,this.techniqueConfig.enableOffset=t.camera.relativeElevation<s["e"],this.techniqueConfig.multipassTerrainEnabled=t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=t.cullAboveGround,this.techniqueConfig}getPassParameters(){return this.parameters}intersect(e,t,i,r,n,a,s){Object(c["i"])(e,t,r,n,a,void 0,s)}requiresSlot(e,t){return 20===e||(4===Object(n["b"])(t)?2===e:e===(this.parameters.transparent?this.parameters.writeDepth?4:7:2))}createGLMaterial(e){return 0===e.output||7===e.output||4===e.output||1===e.output&&this.parameters.writeLinearDepth?new T(e):null}createBufferWriter(){return new o["a"](o["b"])}}class T extends r["a"]{updateParameters(e){return this.ensureTechnique(x,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.sceneHasOcludees&&this._material.setParameters({sceneHasOcludees:e.hasOccludees})}beginSlot(e){return 0!==this._output&&7!==this._output||this._updateOccludeeState(e),this.updateParameters(e)}bind(e,t){t.bindPass(this._material.getPassParameters(),e)}}const C={color:[1,1,1,1],transparent:!1,writeDepth:!0,writeLinearDepth:!1,vertexColors:!1,polygonOffset:!1,slicePlaneEnabled:!1,cullFace:0,sceneHasOcludees:!1,...a["b"]}},d378:function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var r=i("b2b2"),n=i("78ba");class a extends n["a"]{constructor(e=null){super("LercWorker","_decode",e,{strategy:"dedicated"}),this.schedule=e,this.ref=0}decode(e,t,i){return e&&0!==e.byteLength?this.invoke({buffer:e,options:t},i):Promise.resolve(null)}getTransferList(e){return[e.buffer]}release(){--this.ref<=0&&(s.forEach((e,t)=>{e===this&&s.delete(t)}),this.destroy())}}const s=new Map;function o(e=null){let t=s.get(Object(r["u"])(e));return t||(Object(r["l"])(e)?(t=new a(t=>e.schedule(t)),s.set(e,t)):(t=new a,s.set(null,t))),++t.ref,t}},d3cf:function(e,t,i){"use strict";i.d(t,"a",(function(){return y})),i.d(t,"b",(function(){return p})),i.d(t,"c",(function(){return u})),i.d(t,"d",(function(){return l}));var r=i("8d60"),n=(i("c120"),i("7ffa")),a=i("b2b2"),s=i("a21b"),o=i("a9ab"),c=i("1a54");function l(e){return"declaredClass"in e}function d(e){return"declaredClass"in e}function h(e){return"declaredClass"in e}function u(e,t){if(!e)return null;if(h(e))return e;const i=new r["a"]({layer:t,sourceLayer:t});return i.visible=e.visible,i.symbol=Object(n["a"])(e.symbol),i.attributes=Object(n["a"])(e.attributes),i.geometry=p(e.geometry),i}function p(e){return Object(a["k"])(e)?null:l(e)?e:Object(o["a"])(f(e))}function f(e){const t=e.spatialReference.toJSON();switch(e.type){case"point":{const{x:i,y:r,z:n,m:a}=e;return{x:i,y:r,z:n,m:a,spatialReference:t}}case"polygon":{const{rings:i,hasZ:r,hasM:n}=e;return{rings:b(i),hasZ:r,hasM:n,spatialReference:t}}case"polyline":{const{paths:i,hasZ:r,hasM:n}=e;return{paths:b(i),hasZ:r,hasM:n,spatialReference:t}}case"extent":{const{xmin:i,xmax:r,ymin:n,ymax:a,zmin:s,zmax:o,mmin:c,mmax:l,hasZ:d,hasM:h}=e;return{xmin:i,xmax:r,ymin:n,ymax:a,zmin:s,zmax:o,mmin:c,mmax:l,hasZ:d,hasM:h,spatialReference:t}}case"multipoint":{const{points:i,hasZ:r,hasM:n}=e;return{points:v(i)?m(i):i,hasZ:r,hasM:n,spatialReference:t}}default:return}}function b(e){return g(e)?e.map(e=>m(e)):e}function m(e){return e.map(e=>Object(s["n"])(e))}function g(e){for(const t of e)if(0!==t.length)return v(t);return!1}function v(e){return e.length&&(Object(s["d"])(e[0])||Object(s["e"])(e[0]))}function y(e,t){if(!e)return null;let i;if(d(e)){if(null==t)return e.clone();if(d(t))return t.copy(e)}return null!=t?(i=t,i.x=e.x,i.y=e.y,i.spatialReference=e.spatialReference,e.hasZ?(i.z=e.z,i.hasZ=e.hasZ):(i.z=null,i.hasZ=!1),e.hasM?(i.m=e.m,i.hasM=!0):(i.m=null,i.hasM=!1)):(i=Object(c["j"])(e.x,e.y,e.z,e.spatialReference),e.hasM&&(i.m=e.m,i.hasM=!0)),i}},d408:function(e,t,i){"use strict";i.d(t,"a",(function(){return m})),i.d(t,"b",(function(){return g})),i.d(t,"c",(function(){return y})),i.d(t,"d",(function(){return I}));i("c120");var r=i("38a4"),n=i("b2b2"),a=i("a21b"),s=i("3349"),o=i("e431"),c=i("0b2d"),l=i("8188"),d=i("f694"),h=i("1666"),u=i("ed70"),p=i("2e0f"),f=i("7585"),b=i("0278");function m(e){const t=[],i=[];O(e,i,t);const r=i[0][1].data,n=t[0][1].length,a=new Uint16Array(n);return _(e,i,t),x(e,i,t,a),w(e,i,t,a),j(e,i,t,a),S(e,i,t,a),T(e,i,t,a),C(e,i,t,r),P(e,i,t,r),new b["a"](i,t,2)}function g(e,t,i,r){const n="polygon"===e.type?1:0,a="polygon"===e.type?e.rings:e.paths,{position:s,outlines:o}=Object(h["a"])(a,e.hasZ,n),c=new Float64Array(s.length),l=Object(p["d"])(s,e.spatialReference,0,c,0,s,0,s.length/3,t,i,r),d=null!=l;return{lines:d?v(o,s,c):[],projectionSuccess:d,sampledElevation:l}}function v(e,t,i){const r=new Array;for(const{index:n,count:a}of e){if(a<=1)continue;const e=3*n,s=e+3*a;r.push({position:t.subarray(e,s),mapPosition:i?i.subarray(e,s):void 0})}return r}function y(e,t){const i="polygon"===e.type?1:0,r="polygon"===e.type?e.rings:e.paths,{position:n,outlines:a}=Object(h["a"])(r,!1,i),s=Object(l["p"])(n,e.spatialReference,0,n,t,0,n.length/3);for(let o=2;o<n.length;o+=3)n[o]=f["a"];return{lines:s?v(a,n):[],projectionSuccess:s}}function O(e,t,i){const{attributeData:{position:r},removeDuplicateStartEnd:n}=e,s=M(r)&&1===n,o=r.length/3-(s?1:0),c=new Uint32Array(2*(o-1)),l=s?Object(a["m"])(r,0,r.length-3):r;let d=0;for(let a=0;a<o-1;a++)c[d++]=a,c[d++]=a+1;t.push(["position",{size:3,data:l,exclusive:s}]),i.push(["position",c])}function _(e,t,i){const r=e.attributeData.mapPosition;Object(n["k"])(r)||(i.push(["mapPos",i[0][1]]),t.push(["mapPos",{size:3,data:r}]))}function x(e,t,i,r){if(Object(n["l"])(e.attributeData.colorFeature))return;const a=e.attributeData.color;t.push(["color",{size:4,data:Object(n["v"])(a,u["c"])}]),i.push(["color",r])}function j(e,t,i,r){const a=e.attributeData.colorFeature;Object(n["k"])(a)||(t.push(["colorFeatureAttribute",{size:1,data:new Float32Array([a])}]),i.push(["color",r]))}function w(e,t,i,r){if(Object(n["l"])(e.attributeData.sizeFeature))return;const a=e.attributeData.size;t.push(["size",{size:1,data:[Object(n["v"])(a,1)]}]),i.push(["size",r])}function S(e,t,i,r){const a=e.attributeData.sizeFeature;Object(n["k"])(a)||(t.push(["sizeFeatureAttribute",{size:1,data:new Float32Array([a])}]),i.push(["sizeFeatureAttribute",r]))}function T(e,t,i,r){const a=e.attributeData.opacityFeature;Object(n["k"])(a)||(t.push(["opacityFeatureAttribute",{size:1,data:new Float32Array([a])}]),i.push(["opacityFeatureAttribute",r]))}function C(e,t,i,a){if("round"!==e.join)return;const s=a.length/3,c=new Float32Array(s),l=R,d=E;Object(o["z"])(l,0,0,0);const h=Object(n["v"])(e.uniformSize,1);for(let n=-1;n<s;++n){const e=n<0?s+n:n,t=(n+1)%s;if(Object(o["z"])(d,a[3*t+0]-a[3*e+0],a[3*t+1]-a[3*e+1],a[3*t+2]-a[3*e+2]),Object(o["u"])(d,d),n>=0){const e=(Math.PI-Object(r["b"])(Object(o["k"])(l,d)))*D*1*A(h);c[n]=Math.max(Math.floor(e),0)}Object(o["h"])(l,d,-1)}t.push(["subdivisions",{size:1,data:c}]),i.push(["subdivisions",i[0][1]])}function P(e,t,i,r){if(Object(n["k"])(e.overlayInfo)||1!==e.overlayInfo.renderCoordsHelper.viewingMode||!e.overlayInfo.spatialReference.isGeographic)return;const a=new Float64Array(r.length),c=Object(d["e"])(e.overlayInfo.spatialReference);for(let n=0;n<a.length;n+=3)Object(l["l"])(r,n,a,n,c);const h=r.length/3,u=new Float32Array(h+1);let p=R,f=E,b=0,m=0;Object(o["z"])(p,a[m++],a[m++],a[m++]),u[0]=0;for(let n=1;n<h+1;++n)n===h&&(m=0),Object(o["z"])(f,a[m++],a[m++],a[m++]),b+=Object(s["d"])(p,f),u[n]=b,[p,f]=[f,p];t.push(["distanceToStart",{size:1,data:u}]),i.push(["distanceToStart",i[0][1]])}function A(e){return 1.863798+-2.0062872/(1+e/18.2313)**.8856294}function M(e){const t=e.length;return e[0]===e[t-3]&&e[1]===e[t-2]&&e[2]===e[t-1]}const R=Object(c["f"])(),E=Object(c["f"])(),D=4/Math.PI;function I(e){switch(e){case"butt":return 0;case"square":return 1;case"round":return 2;default:return null}}},d409:function(e,t,i){"use strict";i.d(t,"a",(function(){return v}));var r=i("a4ee"),n=i("2c4f"),a=i("4d10"),s=i("ce50"),o=i("e92d"),c=i("59b2"),l=(i("b50f"),i("c120"),i("4c37")),d=(i("cea0"),i("d386")),h=i("92ef"),u=i("e9d0"),p=i("2258");const f=o["a"].getLogger("esri.layers.TileLayer");function b(e,t){const i=[],r={};return e?(e.forEach(e=>{const n=new u["a"];if(n.read(e,t),r[n.id]=n,null!=e.parentLayerId&&-1!==e.parentLayerId){const t=r[e.parentLayerId];t.sublayers||(t.sublayers=[]),t.sublayers.unshift(n)}else i.unshift(n)}),i):i}const m=n["a"].ofType(u["a"]);function g(e,t){e&&e.forEach(e=>{t(e),e.sublayers&&e.sublayers.length&&g(e.sublayers,t)})}const v=e=>{let t=class extends e{constructor(...e){super(...e),this.allSublayers=new a["a"]({getCollections:()=>[this.sublayers],getChildrenFunction:e=>e.sublayers}),this.sublayersSourceJSON={2:{},3:{},4:{},5:{}},this.handles.add(this.watch("sublayers",(e,t)=>this._handleSublayersChange(e,t),!0))}readSublayers(e,t){if(!t||!e)return;const{sublayersSourceJSON:i}=this,r=Object(h["d"])(t.origin);if(r<2)return;if(i[r]={context:t,visibleLayers:e.visibleLayers||i[r].visibleLayers,layers:e.layers||i[r].layers},r>2)return;this._set("serviceSublayers",this.createSublayersForOrigin("service").sublayers);const{sublayers:n,origin:a}=this.createSublayersForOrigin("web-document"),s=Object(l["a"])(this);s.setDefaultOrigin(a),this._set("sublayers",new m(n)),s.setDefaultOrigin("user")}findSublayerById(e){return this.allSublayers.find(t=>t.id===e)}createServiceSublayers(){return this.createSublayersForOrigin("service").sublayers}createSublayersForOrigin(e){const t=Object(h["d"])("web-document"===e?"web-map":e);let i=2,r=this.sublayersSourceJSON[2].layers,n=this.sublayersSourceJSON[2].context,a=null;const s=[3,4,5].filter(e=>e<=t);for(const h of s){const e=this.sublayersSourceJSON[h];Object(p["b"])(e.layers)&&(i=h,r=e.layers,n=e.context,e.visibleLayers&&(a={visibleLayers:e.visibleLayers,context:e.context}))}const o=[3,4,5].filter(e=>e>i&&e<=t);let c=null;for(const h of o){const{layers:e,visibleLayers:t,context:i}=this.sublayersSourceJSON[h];e&&(c={layers:e,context:i}),t&&(a={visibleLayers:t,context:i})}const l=b(r,n),d=new Map,u=new Set;if(c)for(const h of c.layers)d.set(h.id,h);if(a)for(const h of a.visibleLayers)u.add(h);return g(l,e=>{c&&e.read(d.get(e.id),c.context),a&&e.read({defaultVisibility:u.has(e.id)},a.context)}),{origin:Object(h["b"])(i),sublayers:new m({items:l})}}read(e,t){super.read(e,t),this.readSublayers(e,t)}_handleSublayersChange(e,t){t&&(t.forEach(e=>{e.parent=null,e.layer=null}),this.handles.remove("sublayers-owner")),e&&(e.forEach(e=>{e.parent=this,e.layer=this}),this.handles.add([e.on("after-add",({item:e})=>{e.parent=this,e.layer=this}),e.on("after-remove",({item:e})=>{e.parent=null,e.layer=null})],"sublayers-owner"),"tile"===this.type&&this.handles.add(e.on("before-changes",e=>{f.error(new s["a"]("tilelayer:sublayers-non-modifiable","ISublayer can't be added, moved, or removed from the layer's sublayers",{layer:this})),e.preventDefault()}),"sublayers-owner"))}};return Object(r["a"])([Object(c["b"])({readOnly:!0})],t.prototype,"allSublayers",void 0),Object(r["a"])([Object(c["b"])({readOnly:!0,type:n["a"].ofType(u["a"])})],t.prototype,"serviceSublayers",void 0),Object(r["a"])([Object(c["b"])({value:null,type:m,json:{read:!1,write:{allowNull:!0,ignoreOrigin:!0}}})],t.prototype,"sublayers",void 0),Object(r["a"])([Object(c["b"])({readOnly:!0})],t.prototype,"sublayersSourceJSON",void 0),t=Object(r["a"])([Object(d["a"])("esri.layers.mixins.SublayersOwner")],t),t}},d4de:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var r=i("b2b2"),n=i("beba");const a={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,stretchType:"none",type:"stretch"};class s{constructor(e,t,i=null,r=null){this.type="raster-tile",this._memoryUsed=null,this._source=null,this._symbolizerParameters=null,this._bandIds=null,this._interpolation=null,this._dirty=!1,this._transformGrid=null,this.isRendereredSource=!1,this.symbolizerRenderer=null,this.rawPixelData=null,this.lij=null,this.scale=1,this.offset=[0,0],this.opacity=1,this.lij=e,this.source=t,this.width=i||t.width,this.height=r||t.height}get source(){return this._source}set source(e){this._source=e,this._rasterTexture&&(this._rasterTexture.dispose(),this._rasterTexture=null,this._memoryUsed=null)}get symbolizerParameters(){return this.isRendereredSource?{...a,maxCutOff:[1,1,1],factor:[1,1,1]}:this._symbolizerParameters||a}set symbolizerParameters(e){this._symbolizerParameters=e}get bandIds(){return this._bandIds}set bandIds(e){Object(r["l"])(e)&&e.length>0?this._bandIds&&e.every((e,t)=>!!this._bandIds[t]&&e===this._bandIds[t])||(this._bandIds=e,this._dirty=!0):this._bandIds=null}get interpolation(){return this._interpolation||"nearest"}set interpolation(e){if(this._interpolation=e,this._rasterTexture){const t=this._getRasterTextureInterpolation(e);this._rasterTexture.setSamplingMode("bilinear"===t?9729:9728)}}get transformGrid(){return this._transformGrid}set transformGrid(e){this._transformGrid=e,this._transformGridTexture&&(this._transformGridTexture.dispose(),this._transformGridTexture=null,this._memoryUsed=null)}bind(e){return!!(this.source&&this.source.pixels&&this.source.pixels.length>0)&&(this._rasterTexture&&!this._dirty||this._updateRasterTexture(e,this.bandIds),this._rasterTexture&&(this._updateColormapTexture(e),this.transformGrid&&!this._transformGridTexture&&(this._transformGridTexture=Object(n["c"])(e,this.transformGrid))),!0)}getUniforms(){const e=Object(n["d"])(this.scale,this.offset),{symbolizerParameters:t,transformGrid:i,width:r,height:a,opacity:s}=this;return{basic:e,common:Object(n["f"])(i,[r,a],[this.source.width,this.source.height],s),colormap:t.colormap?Object(n["e"])(t.colormap,t.colormapOffset):null,stretch:"stretch"===this.symbolizerParameters.type?Object(n["h"])(this.symbolizerParameters):null,hillshade:"hillshade"===this.symbolizerParameters.type?Object(n["g"])(this.symbolizerParameters):null}}getTextures(){const e=new Array,t=[];return this._rasterTexture&&(t.push(this._rasterTexture),e.push("u_image"),this._transformGridTexture&&(t.push(this._transformGridTexture),e.push("u_transformGrid")),this._colormapTexture&&(t.push(this._colormapTexture),e.push("u_colormap"))),{names:e,textures:t}}get memoryUsage(){if(Object(r["k"])(this._memoryUsed)){const e=this.getTextures();if(null==e)return 0;this._memoryUsed=e.textures.map(e=>e.descriptor.width*e.descriptor.height*4).reduce((e,t)=>e+t,0)}return this._memoryUsed}release(){return this._rasterTexture=Object(r["f"])(this._rasterTexture),this._transformGridTexture=Object(r["f"])(this._transformGridTexture),this._colormapTexture=Object(r["f"])(this._colormapTexture),this.source=null,this.transformGrid=null,this.rawPixelData=null,!0}_updateRasterTexture(e,t){const i=this.source?this.source.extractBands(t):null;if(!(i&&i.pixels&&i.pixels.length>0))return void(this._rasterTexture&&(this._rasterTexture.dispose(),this._rasterTexture=null));const a=Object(r["k"])(t)&&Object(r["k"])(this.bandIds)||Object(r["l"])(t)&&Object(r["l"])(this.bandIds)&&t.join("")===this.bandIds.join("");if(this._rasterTexture){if(a)return;this._rasterTexture.dispose(),this._rasterTexture=null}const s=this._getRasterTextureInterpolation(this.interpolation);this._rasterTexture=Object(n["b"])(e,i,s,this.isRendereredSource||this.hasStretchTypeNone())}hasStretchTypeNone(){return"stretchType"in this.symbolizerParameters&&"none"===this.symbolizerParameters.stretchType&&!this.symbolizerParameters.useGamma&&"u8"===this.source.pixelType}_getRasterTextureInterpolation(e){return"lut"===this.symbolizerParameters.type||"nearest"===e||"majority"===e?"nearest":"bilinear"}_updateColormapTexture(e){const t=this._colormap,i=this.symbolizerParameters.colormap;return i?t?i.length!==t.length||i.some((e,i)=>e!==t[i])?(this._colormapTexture&&(this._colormapTexture.dispose(),this._colormapTexture=null),this._colormapTexture=Object(n["a"])(e,i),void(this._colormap=i)):void 0:(this._colormapTexture=Object(n["a"])(e,i),void(this._colormap=i)):(this._colormapTexture&&(this._colormapTexture.dispose(),this._colormapTexture=null),void(this._colormap=null))}}},d539:function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var r=i("0b2d"),n=i("6a21"),a=i("3886"),s=i("9cc4");function o(e,t){t.instanced&&t.instancedDoublePrecision&&(e.attributes.add("modelOriginHi","vec3"),e.attributes.add("modelOriginLo","vec3"),e.attributes.add("model","mat3"),e.attributes.add("modelNormal","mat3")),t.instancedDoublePrecision&&(e.vertex.include(n["a"],t),e.vertex.uniforms.add("viewOriginHi","vec3"),e.vertex.uniforms.add("viewOriginLo","vec3"));const i=[a["a"]`
    vec3 calculateVPos() {
      ${t.instancedDoublePrecision?"return model * localPosition().xyz;":"return localPosition().xyz;"}
    }
    `,a["a"]`
    vec3 subtractOrigin(vec3 _pos) {
      ${t.instancedDoublePrecision?a["a"]`
          vec3 originDelta = dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);
          return _pos - originDelta;`:"return vpos;"}
    }
    `,a["a"]`
    vec3 dpNormal(vec4 _normal) {
      ${t.instancedDoublePrecision?"return normalize(modelNormal * _normal.xyz);":"return normalize(_normal.xyz);"}
    }
    `,a["a"]`
    vec3 dpNormalView(vec4 _normal) {
      ${t.instancedDoublePrecision?"return normalize((viewNormal * vec4(modelNormal * _normal.xyz, 1.0)).xyz);":"return normalize((viewNormal * _normal).xyz);"}
    }
    `,t.vertexTangents?a["a"]`
    vec4 dpTransformVertexTangent(vec4 _tangent) {
      ${t.instancedDoublePrecision?"return vec4(modelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"}

    }
    `:a["a"]``];e.vertex.code.add(i[0]),e.vertex.code.add(i[1]),e.vertex.code.add(i[2]),2===t.output&&e.vertex.code.add(i[3]),e.vertex.code.add(i[4])}!function(e){class t{}function i(e,t){Object(s["b"])(t,c,l,3),e.setUniform3fv("viewOriginHi",c),e.setUniform3fv("viewOriginLo",l)}e.Uniforms=t,e.bindCustomOrigin=i}(o||(o={}));const c=Object(r["f"])(),l=Object(r["f"])()},d56e:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i("3886"),n=i("1956");function a(e,t){const i=r["a"]`
  /*
  *  ${t.name}
  *  ${0===t.output?"RenderOutput: Color":1===t.output?"RenderOutput: Depth":3===t.output?"RenderOutput: Shadow":2===t.output?"RenderOutput: Normal":4===t.output?"RenderOutput: Highlight":""}
  */
  `;Object(n["c"])()&&(e.fragment.code.add(i),e.vertex.code.add(i))}},d5f7:function(e,t,i){"use strict";i.d(t,"a",(function(){return u})),i.d(t,"b",(function(){return p})),i.d(t,"c",(function(){return h})),i.d(t,"d",(function(){return c})),i.d(t,"e",(function(){return l}));var r=i("fa1e"),n=i("7c33"),a=i("7ce4"),s=i("a1ff"),o=i("0fa6");function c(e,t=n["a"],i=r["a"],s=-1,c=1){let l=null;return l=t===n["b"]?new Float32Array([s,s,0,0,c,s,1,0,s,c,0,1,c,c,1,1]):new Float32Array([s,s,c,s,s,c,c,c]),new o["a"](e,i,{geometry:t},{geometry:a["a"].createVertex(e,35044,l)})}function l(e,t=n["a"],i=r["a"]){const s=new Float32Array([-1,-1,3,-1,-1,3]);return new o["a"](e,i,{geometry:t},{geometry:a["a"].createVertex(e,35044,s)})}const d=4;function h(e,t=d){return new s["a"](e,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:t,height:t})}function u(e,t,i=d){const r=new Uint8Array(i*i*4);for(let n=0;n<r.length;n+=4)r[n+0]=255*t[0],r[n+1]=255*t[1],r[n+2]=255*t[2],r[n+3]=255*t[3];return new s["a"](e,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:i,height:i},r)}function p(e){return new s["a"](e,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1},new Uint8Array([255,255,255,255]))}},d6e5:function(e,t,i){"use strict";i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return a}));var r=i("171c");class n{constructor(e){this.rctx=e,this.camera=null,this.lastFrameCamera=new r["a"],this.pass=0,this.slot=2,this.highlightDepthTexture=null,this.renderOccludedMask=s,this.hasOccludees=!1}resetRenderOccludedMask(){this.renderOccludedMask=s}get isHighlightPass(){return 5===this.pass}}class a extends n{constructor(e,t,i,r,n,a){super(e),this.offscreenRenderingHelper=t,this.scenelightingData=i,this.shadowMap=r,this.ssaoHelper=n,this.sliceHelper=a}}const s=13},d7f7:function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));class r{constructor(e){this._material=e.material,this._techniqueRep=e.techniqueRep,this._output=e.output}dispose(){this._techniqueRep.release(this._technique)}get technique(){return this._technique}ensureTechnique(e,t,i=this._output){return this._technique=this._techniqueRep.releaseAndAcquire(e,this._material.getTechniqueConfig(i,t),this._technique),this._technique}ensureResources(e){return 2}}},d981:function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return n}));var r=i("3886");function n(e){e.fragment.code.add(r["a"]`float normals2FoamIntensity(vec3 n, float waveStrength){
float normalizationFactor =  max(0.015, waveStrength);
return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
}`)}function a(e){e.fragment.code.add(r["a"]`vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
}`)}},da1c:function(e,t,i){"use strict";i.d(t,"a",(function(){return u})),i.d(t,"b",(function(){return l})),i.d(t,"c",(function(){return a})),i.d(t,"d",(function(){return n})),i.d(t,"e",(function(){return h})),i.d(t,"f",(function(){return p}));var r=i("38a4");function n(e,t){return new f(e,b,t)}function a(e,t){const{curvatureDependent:i,scaleStart:r,scaleFallOffRange:n}=b;return new f(e,{curvatureDependent:{min:{curvature:i.min.curvature,tiltAngle:i.min.tiltAngle,scaleFallOffFactor:m.curvatureDependent.min.scaleFallOffFactor},max:{curvature:i.max.curvature,tiltAngle:i.max.tiltAngle,scaleFallOffFactor:m.curvatureDependent.max.scaleFallOffFactor}},scaleStart:r,scaleFallOffRange:n,minPixelSize:m.minPixelSize},t)}function s(e){return Math.abs(e*e*e)}function o(e,t,i){const r=i.parameters,n=i.paddingPixelsOverride;return v.scale=Math.min(r.divisor/(t-r.offset),1),v.factor=s(e),v.minPixelSize=r.minPixelSize,v.paddingPixels=n,v}function c(e,t){return 0===e?t.minPixelSize:t.minPixelSize*(1+2*t.paddingPixels/e)}function l(e,t){return Math.max(Object(r["l"])(e*t.scale,e,t.factor),c(e,t))}function d(e,t,i){const r=o(e,t,i);return r.minPixelSize=0,r.paddingPixels=0,l(1,r)}function h(e,t,i,r){r.scale=d(e,t,i),r.factor=0,r.minPixelSize=i.parameters.minPixelSize,r.paddingPixels=i.paddingPixelsOverride}function u(e,t,i=[0,0]){const r=Math.min(Math.max(t.scale,c(e[1],t)/e[1]),1);return i[0]=e[0]*r,i[1]=e[1]*r,i}function p(e,t,i,r){return l(e,o(t,i,r))}class f{constructor(e,t,i,r=g(),n){this.viewingMode=e,this.description=t,this.ellipsoidRadius=i,this.parameters=r,this._paddingPixelsOverride=n,2===this.viewingMode?(this.coverageCompensation=this.surfaceCoverageCompensationLocal,this.calculateCurvatureDependentParameters=this.calculateCurvatureDependentParametersLocal):(this.coverageCompensation=this.surfaceCoverageCompensationGlobal,this.calculateCurvatureDependentParameters=this.calculateCurvatureDependentParametersGlobal)}get paddingPixelsOverride(){return this._paddingPixelsOverride||this.parameters.paddingPixels}update(e){return(!this.parameters||this.parameters.camera.fovY!==e.fovY||this.parameters.camera.distance!==e.distance)&&(this.calculateParameters(e,this.ellipsoidRadius,this.parameters),!0)}overridePadding(e){return e!==this.paddingPixelsOverride?new f(this.viewingMode,this.description,this.ellipsoidRadius,this.parameters,e):this}calculateParameters(e,t,i){const{scaleStart:r,scaleFallOffRange:n,minPixelSize:a}=this.description,{fovY:s,distance:o}=e,c=this.calculateCurvatureDependentParameters(e,t),l=this.coverageCompensation(e,t,c),{tiltAngle:d,scaleFallOffFactor:h}=c,u=Math.sin(d)*o,p=.5*Math.PI-d-s*(.5-r*l),f=u/Math.cos(p),b=p+s*n*l,m=(f-h*(u/Math.cos(b)))/(1-h);return i.camera.fovY=e.fovY,i.camera.distance=e.distance,i.offset=m,i.divisor=f-m,i.minPixelSize=a,i}calculateCurvatureDependentParametersLocal(e,t,i=y){return i.tiltAngle=this.description.curvatureDependent.min.tiltAngle,i.scaleFallOffFactor=this.description.curvatureDependent.min.scaleFallOffFactor,i}calculateCurvatureDependentParametersGlobal(e,t,i=y){const n=this.description.curvatureDependent,a=1+e.distance/t,s=Math.sqrt(a*a-1),[o,c]=[n.min.curvature,n.max.curvature],l=Object(r["f"])((s-o)/(c-o),0,1),[d,h]=[n.min,n.max];return i.tiltAngle=Object(r["l"])(d.tiltAngle,h.tiltAngle,l),i.scaleFallOffFactor=Object(r["l"])(d.scaleFallOffFactor,h.scaleFallOffFactor,l),i}surfaceCoverageCompensationLocal(e,t,i){return(e.fovY-i.tiltAngle)/e.fovY}surfaceCoverageCompensationGlobal(e,t,i){const r=t*t,n=i.tiltAngle+.5*Math.PI,{fovY:a,distance:s}=e,o=s*s+r-2*Math.cos(n)*s*t,c=Math.sqrt(o),l=Math.sqrt(o-r);return(Math.acos(l/c)-Math.asin(t/(c/Math.sin(n)))+.5*a)/a}}const b={curvatureDependent:{min:{curvature:Object(r["h"])(10),tiltAngle:Object(r["h"])(12),scaleFallOffFactor:.5},max:{curvature:Object(r["h"])(70),tiltAngle:Object(r["h"])(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},m={curvatureDependent:{min:{scaleFallOffFactor:.7},max:{scaleFallOffFactor:.95}},minPixelSize:14};function g(){return{camera:{distance:0,fovY:0},divisor:0,offset:0,minPixelSize:0,paddingPixels:0}}const v={scale:0,factor:0,minPixelSize:0,paddingPixels:0},y={tiltAngle:0,scaleFallOffFactor:0}},da35:function(e,t,i){"use strict";i.d(t,"a",(function(){return r})),i.d(t,"b",(function(){return n}));class r{constructor(){this._key="",this._keyDirty=!1,this._parameterBits=this._parameterBits?this._parameterBits.map(()=>0):[],this._parameterNames||(this._parameterNames=[])}get key(){return this._keyDirty&&(this._keyDirty=!1,this._key=String.fromCharCode.apply(String,this._parameterBits)),this._key}snapshot(){const e=this._parameterNames,t={key:this.key};for(const i of e)t[i]=this[i];return t}}function n(e={}){return(t,i)=>{var r,n;t._parameterNames=null!=(r=t._parameterNames)?r:[],t._parameterNames.push(i);const a=t._parameterNames.length-1,s=e.count||2,o=Math.ceil(Math.log2(s)),c=null!=(n=t._parameterBits)?n:[0];let l=0;for(;c[l]+o>16;)l++,l>=c.length&&c.push(0);t._parameterBits=c;const d=c[l],h=(1<<o)-1<<d;c[l]+=o,Object.defineProperty(t,i,{get(){return this[a]},set(e){if(this[a]!==e&&(this[a]=e,this._keyDirty=!0,this._parameterBits[l]=this._parameterBits[l]&~h|+e<<d&h,"number"!=typeof e&&"boolean"!=typeof e))throw"Configuration value for "+i+" must be boolean or number, got "+typeof e}})}}},dae5:function(e,t,i){"use strict";function r(){return[1,0,0,0,1,0,0,0,1]}function n(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]}function a(e,t,i,r,n,a,s,o,c){return[e,t,i,r,n,a,s,o,c]}function s(e,t){return new Float64Array(e,t,9)}i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return r}));Object.freeze({__proto__:null,create:r,clone:n,fromValues:a,createView:s})},db21:function(e,t,i){"use strict";i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return a})),i.d(t,"c",(function(){return r})),i.d(t,"d",(function(){return s}));const r=!0,n=32,a=1.5,s=200},dbad:function(e,t,i){"use strict";i.d(t,"a",(function(){return V})),i.d(t,"b",(function(){return G}));var r=i("dae5"),n=i("e431"),a=i("0b2d"),s=i("fc00"),o=i("ebd5"),c=i("68af"),l=i("35b3"),d=i("7438"),h=i("89bf"),u=i("5957"),p=i("7c51"),f=i("a4ee"),b=i("d272"),m=i("d539"),g=i("17b0"),v=i("6a07"),y=i("c6d7"),O=i("a7d7"),_=i("d017"),x=i("be24"),j=i("6a21"),w=i("8e97"),S=i("c3a4"),T=i("ca98"),C=i("da35"),P=i("fa1e"),A=i("c829"),M=i("87b7"),R=i("0310"),E=i("189c");class D extends T["a"]{initializeProgram(e){const t=D.shader.get(),i=this.configuration,r=t.build({OITEnabled:0===i.transparencyPassType,output:i.output,viewingMode:e.viewingMode,receiveShadows:i.receiveShadows,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:i.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1,symbolColor:i.symbolColors,vvSize:i.vvSize,vvColor:i.vvColor,vvInstancingEnabled:!0,instanced:i.instanced,instancedColor:i.instancedColor,instancedDoublePrecision:i.instancedDoublePrecision,pbrMode:i.usePBR?i.isSchematic?2:1:0,hasMetalnessAndRoughnessTexture:i.hasMetalnessAndRoughnessTexture,hasEmissionTexture:i.hasEmissionTexture,hasOcclusionTexture:i.hasOcclusionTexture,hasNormalTexture:i.hasNormalTexture,hasColorTexture:i.hasColorTexture,receiveAmbientOcclusion:i.receiveAmbientOcclusion,useCustomDTRExponentForWater:!1,normalType:i.normalsTypeDerivate?3:0,doubleSidedMode:i.doubleSidedMode,vertexTangents:i.vertexTangents,attributeTextureCoordinates:i.hasMetalnessAndRoughnessTexture||i.hasEmissionTexture||i.hasOcclusionTexture||i.hasNormalTexture||i.hasColorTexture?1:0,textureAlphaPremultiplied:i.textureAlphaPremultiplied,attributeColor:i.vertexColors,screenSizePerspectiveEnabled:i.screenSizePerspective,verticalOffsetEnabled:i.verticalOffset,offsetBackfaces:i.offsetBackfaces,doublePrecisionRequiresObfuscation:Object(j["b"])(e.rctx),alphaDiscardMode:i.alphaDiscardMode,supportsTextureAtlas:!1,multipassTerrainEnabled:i.multipassTerrainEnabled,cullAboveGround:i.cullAboveGround});return new A["a"](e.rctx,r,P["a"])}bindPass(e,t){var i,r;Object(w["c"])(this.program,t.camera.projectionMatrix);const n=this.configuration.output;(1===this.configuration.output||t.multipassTerrainEnabled||3===n)&&this.program.setUniform2fv("cameraNearFar",t.camera.nearFar),t.multipassTerrainEnabled&&(this.program.setUniform2fv("inverseViewport",t.inverseViewport),Object(y["a"])(this.program,t)),7===n&&(this.program.setUniform1f("opacity",e.opacity),this.program.setUniform1f("layerOpacity",e.layerOpacity),this.program.setUniform4fv("externalColor",e.externalColor),this.program.setUniform1i("colorMixMode",p["b"][e.colorMixMode])),0===n?(t.lighting.setUniforms(this.program,!1),this.program.setUniform3fv("ambient",e.ambient),this.program.setUniform3fv("diffuse",e.diffuse),this.program.setUniform4fv("externalColor",e.externalColor),this.program.setUniform1i("colorMixMode",p["b"][e.colorMixMode]),this.program.setUniform1f("opacity",e.opacity),this.program.setUniform1f("layerOpacity",e.layerOpacity),this.configuration.usePBR&&Object(O["c"])(this.program,e,this.configuration.isSchematic)):4===n&&Object(v["b"])(this.program,t),Object(x["c"])(this.program,e),Object(g["b"])(this.program,e,t),Object(p["a"])(e.screenSizePerspective,this.program,"screenSizePerspectiveAlignment"),2!==e.textureAlphaMode&&3!==e.textureAlphaMode||this.program.setUniform1f("textureAlphaCutoff",e.textureAlphaCutoff),null==(i=t.shadowMap)||i.bind(this.program),null==(r=t.ssaoHelper)||r.bind(this.program,t.camera)}bindDraw(e){const t=this.configuration.instancedDoublePrecision?Object(a["h"])(e.camera.viewInverseTransposeMatrix[3],e.camera.viewInverseTransposeMatrix[7],e.camera.viewInverseTransposeMatrix[11]):e.origin;Object(w["e"])(this.program,t,e.camera.viewMatrix),this.program.rebindTextures(),(0===this.configuration.output||7===this.configuration.output||1===this.configuration.output&&this.configuration.screenSizePerspective||2===this.configuration.output&&this.configuration.screenSizePerspective||4===this.configuration.output&&this.configuration.screenSizePerspective)&&Object(w["a"])(this.program,t,e.camera.viewInverseTransposeMatrix),2===this.configuration.output&&this.program.setUniformMatrix4fv("viewNormal",e.camera.viewInverseTransposeMatrix),this.configuration.instancedDoublePrecision&&m["a"].bindCustomOrigin(this.program,t),Object(b["b"])(this.program,this.configuration,e.slicePlane,t),0===this.configuration.output&&Object(_["d"])(this.program,e,t)}setPipeline(e,t){const i=this.configuration,r=3===e,n=2===e;return Object(E["g"])({blending:0!==i.output&&7!==i.output||!i.transparent?null:r?d["g"]:Object(d["a"])(e),culling:I(i)&&Object(E["c"])(i.cullFace),depthTest:{func:Object(d["b"])(e)},depthWrite:r||n?i.writeDepth&&E["e"]:null,colorWrite:E["d"],stencilWrite:i.sceneHasOcludees?M["j"]:null,stencilTest:i.sceneHasOcludees?t?M["f"]:M["e"]:null,polygonOffset:r||n?null:Object(d["h"])(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this.setPipeline(this.configuration.transparencyPassType,!0),this.setPipeline(this.configuration.transparencyPassType,!1)}getPipelineState(e,t){return t?this._occludeePipelineState:super.getPipelineState(e,t)}}function I(e){return e.cullFace?0!==e.cullFace:!e.slicePlaneEnabled&&!e.transparent&&!e.doubleSidedMode}D.shader=new S["a"](R["a"],()=>i.e("chunk-2d0cb6c5").then(i.bind(null,"4a35")));class F extends C["a"]{constructor(){super(...arguments),this.output=0,this.alphaDiscardMode=1,this.doubleSidedMode=0,this.isSchematic=!1,this.vertexColors=!1,this.offsetBackfaces=!1,this.symbolColors=!1,this.vvSize=!1,this.vvColor=!1,this.verticalOffset=!1,this.receiveShadows=!1,this.slicePlaneEnabled=!1,this.sliceHighlightDisabled=!1,this.receiveAmbientOcclusion=!1,this.screenSizePerspective=!1,this.textureAlphaPremultiplied=!1,this.hasColorTexture=!1,this.usePBR=!1,this.hasMetalnessAndRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.instanced=!1,this.instancedColor=!1,this.instancedDoublePrecision=!1,this.vertexTangents=!1,this.normalsTypeDerivate=!1,this.writeDepth=!0,this.sceneHasOcludees=!1,this.transparent=!1,this.enableOffset=!0,this.cullFace=0,this.transparencyPassType=3,this.multipassTerrainEnabled=!1,this.cullAboveGround=!1}}Object(f["a"])([Object(C["b"])({count:8})],F.prototype,"output",void 0),Object(f["a"])([Object(C["b"])({count:4})],F.prototype,"alphaDiscardMode",void 0),Object(f["a"])([Object(C["b"])({count:3})],F.prototype,"doubleSidedMode",void 0),Object(f["a"])([Object(C["b"])()],F.prototype,"isSchematic",void 0),Object(f["a"])([Object(C["b"])()],F.prototype,"vertexColors",void 0),Object(f["a"])([Object(C["b"])()],F.prototype,"offsetBackfaces",void 0),Object(f["a"])([Object(C["b"])()],F.prototype,"symbolColors",void 0),Object(f["a"])([Object(C["b"])()],F.prototype,"vvSize",void 0),Object(f["a"])([Object(C["b"])()],F.prototype,"vvColor",void 0),Object(f["a"])([Object(C["b"])()],F.prototype,"verticalOffset",void 0),Object(f["a"])([Object(C["b"])()],F.prototype,"receiveShadows",void 0),Object(f["a"])([Object(C["b"])()],F.prototype,"slicePlaneEnabled",void 0),Object(f["a"])([Object(C["b"])()],F.prototype,"sliceHighlightDisabled",void 0),Object(f["a"])([Object(C["b"])()],F.prototype,"receiveAmbientOcclusion",void 0),Object(f["a"])([Object(C["b"])()],F.prototype,"screenSizePerspective",void 0),Object(f["a"])([Object(C["b"])()],F.prototype,"textureAlphaPremultiplied",void 0),Object(f["a"])([Object(C["b"])()],F.prototype,"hasColorTexture",void 0),Object(f["a"])([Object(C["b"])()],F.prototype,"usePBR",void 0),Object(f["a"])([Object(C["b"])()],F.prototype,"hasMetalnessAndRoughnessTexture",void 0),Object(f["a"])([Object(C["b"])()],F.prototype,"hasEmissionTexture",void 0),Object(f["a"])([Object(C["b"])()],F.prototype,"hasOcclusionTexture",void 0),Object(f["a"])([Object(C["b"])()],F.prototype,"hasNormalTexture",void 0),Object(f["a"])([Object(C["b"])()],F.prototype,"instanced",void 0),Object(f["a"])([Object(C["b"])()],F.prototype,"instancedColor",void 0),Object(f["a"])([Object(C["b"])()],F.prototype,"instancedDoublePrecision",void 0),Object(f["a"])([Object(C["b"])()],F.prototype,"vertexTangents",void 0),Object(f["a"])([Object(C["b"])()],F.prototype,"normalsTypeDerivate",void 0),Object(f["a"])([Object(C["b"])()],F.prototype,"writeDepth",void 0),Object(f["a"])([Object(C["b"])()],F.prototype,"sceneHasOcludees",void 0),Object(f["a"])([Object(C["b"])()],F.prototype,"transparent",void 0),Object(f["a"])([Object(C["b"])()],F.prototype,"enableOffset",void 0),Object(f["a"])([Object(C["b"])({count:3})],F.prototype,"cullFace",void 0),Object(f["a"])([Object(C["b"])({count:4})],F.prototype,"transparencyPassType",void 0),Object(f["a"])([Object(C["b"])()],F.prototype,"multipassTerrainEnabled",void 0),Object(f["a"])([Object(C["b"])()],F.prototype,"cullAboveGround",void 0);var z=i("b0ab");class L extends D{initializeProgram(e){const t=L.shader.get(),i=this.configuration,r=t.build({OITEnabled:0===i.transparencyPassType,output:i.output,viewingMode:e.viewingMode,receiveShadows:i.receiveShadows,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:i.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1,symbolColor:i.symbolColors,vvSize:i.vvSize,vvColor:i.vvColor,vvInstancingEnabled:!0,instanced:i.instanced,instancedColor:i.instancedColor,instancedDoublePrecision:i.instancedDoublePrecision,pbrMode:i.usePBR?1:0,hasMetalnessAndRoughnessTexture:!1,hasEmissionTexture:!1,hasOcclusionTexture:!1,hasNormalTexture:!1,hasColorTexture:i.hasColorTexture,receiveAmbientOcclusion:i.receiveAmbientOcclusion,useCustomDTRExponentForWater:!1,normalType:0,doubleSidedMode:2,vertexTangents:!1,attributeTextureCoordinates:i.hasColorTexture?1:0,textureAlphaPremultiplied:i.textureAlphaPremultiplied,attributeColor:i.vertexColors,screenSizePerspectiveEnabled:i.screenSizePerspective,verticalOffsetEnabled:i.verticalOffset,offsetBackfaces:i.offsetBackfaces,doublePrecisionRequiresObfuscation:Object(j["b"])(e.rctx),alphaDiscardMode:i.alphaDiscardMode,supportsTextureAtlas:!1,multipassTerrainEnabled:i.multipassTerrainEnabled,cullAboveGround:i.cullAboveGround});return new A["a"](e.rctx,r,P["a"])}}L.shader=new S["a"](z["a"],()=>i.e("chunk-2d0ab897").then(i.bind(null,"1662")));class V extends l["a"]{constructor(e){super(e,U),this.supportsEdges=!0,this.techniqueConfig=new F,this.vertexBufferLayout=N(this.parameters),this.instanceBufferLayout=e.instanced?G(this.parameters):null}isVisibleInPass(e){return 4!==e&&6!==e&&7!==e||this.parameters.castShadows}isVisible(){const e=this.parameters;if(!super.isVisible()||0===e.layerOpacity)return!1;const t=e.instanced,i=e.vertexColors,r=e.symbolColors,n=!!t&&t.indexOf("color")>-1,a=e.vvColorEnabled,s="replace"===e.colorMixMode,o=e.opacity>0,c=e.externalColor&&e.externalColor[3]>0;return i&&(n||a||r)?!!s||o:i?s?c:o:n||a||r?!!s||o:s?c:o}getTechniqueConfig(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.hasNormalTexture=!!this.parameters.normalTextureId,this.techniqueConfig.hasColorTexture=!!this.parameters.textureId,this.techniqueConfig.vertexTangents=this.parameters.vertexTangents,this.techniqueConfig.instanced=!!this.parameters.instanced,this.techniqueConfig.instancedDoublePrecision=this.parameters.instancedDoublePrecision,this.techniqueConfig.vvSize=this.parameters.vvSizeEnabled,this.techniqueConfig.verticalOffset=null!==this.parameters.verticalOffset,this.techniqueConfig.screenSizePerspective=null!==this.parameters.screenSizePerspective,this.techniqueConfig.slicePlaneEnabled=this.parameters.slicePlaneEnabled,this.techniqueConfig.sliceHighlightDisabled=this.parameters.sliceHighlightDisabled,this.techniqueConfig.alphaDiscardMode=this.parameters.textureAlphaMode,this.techniqueConfig.normalsTypeDerivate="screenDerivative"===this.parameters.normals,this.techniqueConfig.transparent=this.parameters.transparent,this.techniqueConfig.writeDepth=this.parameters.writeDepth,this.techniqueConfig.sceneHasOcludees=this.parameters.sceneHasOcludees,this.techniqueConfig.cullFace=this.parameters.slicePlaneEnabled?0:this.parameters.cullFace,this.techniqueConfig.multipassTerrainEnabled=t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=t.cullAboveGround,0!==e&&7!==e||(this.techniqueConfig.vertexColors=this.parameters.vertexColors,this.techniqueConfig.symbolColors=this.parameters.symbolColors,this.parameters.treeRendering?this.techniqueConfig.doubleSidedMode=2:this.techniqueConfig.doubleSidedMode=this.parameters.doubleSided&&"normal"===this.parameters.doubleSidedType?1:this.parameters.doubleSided&&"winding-order"===this.parameters.doubleSidedType?2:0,this.techniqueConfig.instancedColor=!!this.parameters.instanced&&this.parameters.instanced.indexOf("color")>-1,this.techniqueConfig.receiveShadows=this.parameters.receiveShadows&&this.parameters.shadowMappingEnabled,this.techniqueConfig.receiveAmbientOcclusion=!!t.ssaoEnabled&&this.parameters.receiveSSAO,this.techniqueConfig.vvColor=this.parameters.vvColorEnabled,this.techniqueConfig.textureAlphaPremultiplied=!!this.parameters.textureAlphaPremultiplied,this.techniqueConfig.usePBR=this.parameters.usePBR,this.techniqueConfig.hasMetalnessAndRoughnessTexture=!!this.parameters.metallicRoughnessTextureId,this.techniqueConfig.hasEmissionTexture=!!this.parameters.emissiveTextureId,this.techniqueConfig.hasOcclusionTexture=!!this.parameters.occlusionTextureId,this.techniqueConfig.offsetBackfaces=!(!this.parameters.transparent||!this.parameters.offsetTransparentBackfaces),this.techniqueConfig.isSchematic=this.parameters.usePBR&&this.parameters.isSchematic,this.techniqueConfig.transparencyPassType=t.transparencyPassType,this.techniqueConfig.enableOffset=t.camera.relativeElevation<d["e"]),this.techniqueConfig}intersect(e,t,i,r,a,s,o){if(null!==this.parameters.verticalOffset){const e=r.camera;Object(n["z"])(Q,i[12],i[13],i[14]);let t=null;switch(r.viewingMode){case 1:t=Object(n["u"])($,Q);break;case 2:t=Object(n["n"])($,W)}let o=0;if(null!==this.parameters.verticalOffset){const i=Object(n["m"])(X,Q,e.eye),r=Object(n["s"])(i),a=Object(n["h"])(i,i,1/r);let s=null;this.parameters.screenSizePerspective&&(s=Object(n["k"])(t,a)),o+=Object(p["l"])(e,r,this.parameters.verticalOffset,s,this.parameters.screenSizePerspective)}Object(n["h"])(t,t,o),Object(n["A"])(Z,t,r.transform.inverseRotation),a=Object(n["m"])(q,a,Z),s=Object(n["m"])(H,s,Z)}Object(p["i"])(e,t,r,a,s,Object(h["d"])(r.verticalOffset),o)}requiresSlot(e){return e===(this.parameters.transparent?this.parameters.writeDepth?4:7:2)||20===e}createGLMaterial(e){return 0===e.output||7===e.output||1===e.output||2===e.output||3===e.output||4===e.output?new k(e):null}createBufferWriter(){return new B(this.vertexBufferLayout,this.instanceBufferLayout)}}class k extends c["a"]{constructor(e){super({...e,...e.material.parameters})}updateParameters(e){const t=this._material.parameters;return this.updateTexture(t.textureId),this.ensureTechnique(t.treeRendering?L:D,e)}_updateShadowState(e){e.shadowMappingEnabled!==this._material.parameters.shadowMappingEnabled&&this._material.setParameters({shadowMappingEnabled:e.shadowMappingEnabled})}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.sceneHasOcludees&&this._material.setParameters({sceneHasOcludees:e.hasOccludees})}beginSlot(e){return 0!==this._output&&7!==this._output||(this._updateShadowState(e),this._updateOccludeeState(e)),this.updateParameters(e)}bind(e,t){t.bindPass(this._material.parameters,e),this.bindTextures(t.program)}}const U={textureId:void 0,initTextureTransparent:!1,isSchematic:!1,usePBR:!1,normalTextureId:void 0,vertexTangents:!1,occlusionTextureId:void 0,emissiveTextureId:void 0,metallicRoughnessTextureId:void 0,emissiveFactor:[0,0,0],mrrFactors:[0,1,.5],ambient:[.2,.2,.2],diffuse:[.8,.8,.8],externalColor:[1,1,1,1],colorMixMode:"multiply",opacity:1,layerOpacity:1,vertexColors:!1,symbolColors:!1,doubleSided:!1,doubleSidedType:"normal",cullFace:2,instanced:void 0,instancedDoublePrecision:!1,normals:"default",receiveSSAO:!0,receiveShadows:!0,castShadows:!0,shadowMappingEnabled:!1,verticalOffset:null,screenSizePerspective:null,slicePlaneEnabled:!1,sliceHighlightDisabled:!1,offsetTransparentBackfaces:!1,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvSizeValue:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],vvSymbolAnchor:[0,0,0],vvSymbolRotationMatrix:Object(r["b"])(),transparent:!1,writeDepth:!0,textureAlphaMode:0,textureAlphaCutoff:o["b"],textureAlphaPremultiplied:!1,sceneHasOcludees:!1,...l["b"]};class B{constructor(e,t){this.vertexBufferLayout=e,this.instanceBufferLayout=t}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return e.indices.get("position").length}write(e,t,i,r){Object(u["c"])(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,i,r)}}function N(e){const t=e.textureId||e.normalTextureId||e.metallicRoughnessTextureId||e.emissiveTextureId||e.occlusionTextureId,i=Object(s["a"])().vec3f("position").vec3f("normal");return e.vertexTangents&&i.vec4f("tangent"),t&&i.vec2f("uv0"),e.vertexColors&&i.vec4u8("color"),e.symbolColors&&i.vec4u8("symbolColor"),i}function G(e){let t=Object(s["a"])();return t=e.instancedDoublePrecision?t.vec3f("modelOriginHi").vec3f("modelOriginLo").mat3f("model").mat3f("modelNormal"):t.mat4f("model").mat4f("modelNormal"),e.instanced&&e.instanced.indexOf("color")>-1&&(t=t.vec4f("instanceColor")),e.instanced&&e.instanced.indexOf("featureAttribute")>-1&&(t=t.vec4f("instanceFeatureAttribute")),t}const q=Object(a["f"])(),H=Object(a["f"])(),W=Object(a["h"])(0,0,1),$=Object(a["f"])(),Z=Object(a["f"])(),Q=Object(a["f"])(),X=Object(a["f"])()},dc56:function(e,t,i){"use strict";i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return a}));var r=i("c6ac");function n(e,t,i){const r=e.typedBuffer,n=e.typedBufferStride,a=t.typedBuffer,s=t.typedBufferStride,o=i?i.count:t.count;let c=(i&&i.dstIndex?i.dstIndex:0)*n,l=(i&&i.srcIndex?i.srcIndex:0)*s;for(let d=0;d<o;++d)r[c]=a[l],r[c+1]=a[l+1],c+=n,l+=s}function a(e,t,i){const a=e.typedBuffer,s=e.typedBufferStride,o=t.typedBuffer,c=t.typedBufferStride,l=i?i.count:t.count;let d=(i&&i.dstIndex?i.dstIndex:0)*s,h=(i&&i.srcIndex?i.srcIndex:0)*c;if(Object(r["b"])(t.elementType)){const e=Object(r["d"])(t.elementType);if(Object(r["c"])(t.elementType))for(let t=0;t<l;++t)a[d]=Math.max(o[h]/e,-1),a[d+1]=Math.max(o[h+1]/e,-1),d+=s,h+=c;else for(let t=0;t<l;++t)a[d]=o[h]/e,a[d+1]=o[h+1]/e,d+=s,h+=c}else n(e,t,i);return e}function s(e,t,i,r){var n,a;const s=e.typedBuffer,o=e.typedBufferStride,c=null!=(n=null==r?void 0:r.count)?n:e.count;let l=(null!=(a=null==r?void 0:r.dstIndex)?a:0)*o;for(let d=0;d<c;++d)s[l]=t,s[l+1]=i,l+=o}Object.freeze({__proto__:null,copy:n,normalizeIntegerBuffer:a,fill:s})},de47:function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var r=i("501b"),n=i("3886"),a=i("ee2c"),s=i("b3a9");function o(e,t){const i=e.vertex;e.include(s["a"],t);const o=e.fragment;switch(a["a"].usesSketchLogic(t)&&(i.uniforms.add("uStrokesTextureScale","vec2"),i.uniforms.add("uStrokesLog2Resolution","float"),i.uniforms.add("uStrokeVariants","float"),e.varyings.add("vStrokeUV","vec2"),o.uniforms.add("uStrokesTexture","sampler2D"),o.uniforms.add("uStrokesNormalizationScale","float"),i.code.add(n["a"]`void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {
vec2 sidenessNorm = unpackedAttributes.sidenessNorm;
float lineIndex = clamp(ceil(log2(lineLength)), 0.0, uStrokesLog2Resolution);
vStrokeUV = vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * uStrokeVariants + variantStroke + 0.5) * uStrokesTextureScale;
vStrokeUV.x += variantOffset;
}`),e.fragment.include(r["a"]),o.code.add(n["a"]`float calculateLineOffsetSketch() {
float offsetNorm = rgba2float(texture2D(uStrokesTexture, vStrokeUV));
return (offsetNorm - 0.5) * uStrokesNormalizationScale;
}
float calculateLinePressureSketch() {
return rgba2float(texture2D(uStrokesTexture, vStrokeUV + vec2(0.0, 0.5)));
}`)),t.mode){case 0:i.code.add(n["a"]`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes) {}`),o.code.add(n["a"]`float calculateLineOffset() {
return 0.0;
}
float calculateLinePressure() {
return 1.0;
}`);break;case 1:i.code.add(n["a"]`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}`),o.code.add(n["a"]`float calculateLineOffset() {
return calculateLineOffsetSketch();
}
float calculateLinePressure() {
return calculateLinePressureSketch();
}`);break;case 2:e.varyings.add("vType","float"),i.code.add(n["a"]`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
vType = unpackedAttributes.type;
if (unpackedAttributes.type <= 0.0) {
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}
}`),o.code.add(n["a"]`float calculateLineOffset() {
if (vType <= 0.0) {
return calculateLineOffsetSketch();
}
else {
return 0.0;
}
}
float calculateLinePressure() {
if (vType <= 0.0) {
return calculateLinePressureSketch();
}
else {
return 1.0;
}
}`)}}},de58:function(e,t,i){"use strict";i.d(t,"a",(function(){return c})),i.d(t,"b",(function(){return o}));var r=i("02f1"),n=i("e431"),a=i("0b2d"),s=i("7289");function o(e,t,i,r){return u(e,t,i,d(r,t,i,!0))}function c(e,t,i,r){const a=Object(n["k"])(i,Object(n["m"])(e,r,t));return Object(n["i"])(e,t,Object(n["h"])(e,i,a))}const l={dir:Object(a["f"])(),len:0,clip:Object(r["b"])()};function d(e,t,i,r){const a=l;return e?(i&&r&&(a.len=Object(n["p"])(t,i)),Object(n["n"])(a.dir,e)):r?(a.len=Object(n["p"])(t,i),Object(n["m"])(a.dir,i,t),Object(n["h"])(a.dir,a.dir,1/a.len)):(Object(n["m"])(a.dir,i,t),Object(n["u"])(a.dir,a.dir)),a}function h(e,t,i){const r=Object(n["k"])(Object(s["r"])(e),i.dir),a=-Object(s["v"])(e,t);if(a<0&&r>=0)return!1;if(r>-1e-6&&r<1e-6)return a>0;if((a<0||r<0)&&!(a<0&&r<0))return!0;const o=a/r;return r>0?o<i.clip[1]&&(i.clip[1]=o):o>i.clip[0]&&(i.clip[0]=o),i.clip[0]<=i.clip[1]}function u(e,t,i,r){r.clip[0]=0,r.clip[1]=i?r.len:Number.MAX_VALUE;for(let n=0;n<e.length;n++)if(!h(e[n],t,r))return!1;return!0}},dea3:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("3886");function n(e){const t=e.fragment;t.uniforms.add("lightingMainDirection","vec3"),t.uniforms.add("lightingMainIntensity","vec3"),t.uniforms.add("lightingFixedFactor","float"),t.code.add(r["a"]`vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {
float dotVal = clamp(dot(normal_global, lightingMainDirection), 0.0, 1.0);
dotVal = mix(dotVal, 1.0, lightingFixedFactor);
return lightingMainIntensity * ((1.0 - shadowing) * dotVal);
}`)}},deae:function(e,t,i){"use strict";i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return r}));const r={value:.5,readOnly:!0},n={readOnly:!0,value:.5,get(){return this.updating?this.updatingProgressValue:1}}},dee7:function(e,t,i){"use strict";i.d(t,"a",(function(){return u}));var r,n=i("a4ee"),a=i("9ef0"),s=i("6a0e"),o=i("b2b2"),c=i("59b2"),l=(i("b50f"),i("c120"),i("cea0"),i("d386")),d=i("88da");let h=r=class extends s["a"]{constructor(e){super(e),this.color=null,this.colorTexture=null,this.normalTexture=null,this.alphaMode="auto",this.alphaCutoff=.5,this.doubleSided=!0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(e,t){const i=Object(o["l"])(e)?e.get(this):null;if(i)return i;const n=new r(this.clonePropertiesWithDeduplication(t));return Object(o["l"])(e)&&e.set(this,n),n}clonePropertiesWithDeduplication(e){return{color:Object(o["l"])(this.color)?this.color.clone():null,colorTexture:Object(o["l"])(this.colorTexture)?this.colorTexture.cloneWithDeduplication(e):null,normalTexture:Object(o["l"])(this.normalTexture)?this.normalTexture.cloneWithDeduplication(e):null,alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided}}};Object(n["a"])([Object(c["b"])({type:a["a"],json:{write:!0}})],h.prototype,"color",void 0),Object(n["a"])([Object(c["b"])({type:d["a"],json:{write:!0}})],h.prototype,"colorTexture",void 0),Object(n["a"])([Object(c["b"])({type:d["a"],json:{write:!0}})],h.prototype,"normalTexture",void 0),Object(n["a"])([Object(c["b"])({nonNullable:!0,json:{write:!0}})],h.prototype,"alphaMode",void 0),Object(n["a"])([Object(c["b"])({nonNullable:!0,json:{write:!0}})],h.prototype,"alphaCutoff",void 0),Object(n["a"])([Object(c["b"])({nonNullable:!0,json:{write:!0}})],h.prototype,"doubleSided",void 0),h=r=Object(n["a"])([Object(l["a"])("esri.geometry.support.MeshMaterial")],h);const u=h},df77:function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return c}));var r=i("d047"),n=i("3886");function a(e){e.fragment.uniforms.add("lastFrameColorMap","sampler2D"),e.fragment.uniforms.add("reprojectionMat","mat4"),e.fragment.uniforms.add("rpProjectionMat","mat4"),e.fragment.code.add(n["a"]`vec2 reprojectionCoordinate(vec3 projectionCoordinate)
{
vec4 zw = rpProjectionMat * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
vec4 reprojectedCoord = reprojectionMat * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
reprojectedCoord.xy /= reprojectedCoord.w;
return reprojectedCoord.xy * 0.5 + 0.5;
}`)}function s(e,t){e.bindTexture(t.lastFrameColorTexture,"lastFrameColorMap"),e.setUniformMatrix4fv("reprojectionMat",t.reprojectionMatrix),e.setUniformMatrix4fv("rpProjectionMat",t.camera.projectionMatrix)}function o(e,t){e.fragment.uniforms.add("nearFar","vec2"),e.fragment.uniforms.add("depthMapView","sampler2D"),e.fragment.uniforms.add("ssrViewMat","mat4"),e.fragment.uniforms.add("invResolutionHeight","float"),e.fragment.include(r["a"]),e.include(a),e.fragment.code.add(n["a"]`
  const int maxSteps = ${t.highStepCount?"150;":"75;"}

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(rpProjectionMat, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(rpProjectionMat, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(rpProjectionMat, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMapView, P, nearFar); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
          return vec3(P, depth);
      }

      // continue with ray marching
      P += dP;
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
    }
    return vec3(P, 0.0);
  }
  `)}function c(e,t){t.ssrEnabled&&(e.bindTexture(t.linearDepthTexture,"depthMapView"),e.setUniform2fv("nearFar",t.camera.nearFar),e.setUniformMatrix4fv("ssrViewMat",t.camera.viewMatrix),e.setUniform1f("invResolutionHeight",1/t.camera.height),s(e,t))}},dfaf:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("3886");function n(e,t){1===t.attributeTextureCoordinates&&(e.attributes.add("uv0","vec2"),e.varyings.add("vuv0","vec2"),e.vertex.code.add(r["a"]`void forwardTextureCoordinates() {
vuv0 = uv0;
}`)),2===t.attributeTextureCoordinates&&(e.attributes.add("uv0","vec2"),e.varyings.add("vuv0","vec2"),e.attributes.add("uvRegion","vec4"),e.varyings.add("vuvRegion","vec4"),e.vertex.code.add(r["a"]`void forwardTextureCoordinates() {
vuv0 = uv0;
vuvRegion = uvRegion;
}`)),0===t.attributeTextureCoordinates&&e.vertex.code.add(r["a"]`void forwardTextureCoordinates() {}`)}},e2e8:function(e,t,i){"use strict";i.r(t),i.d(t,"getGeometryServiceURL",(function(){return c})),i.d(t,"projectGeometry",(function(){return l}));var r=i("1325"),n=i("ce50"),a=i("0224"),s=i("ac91"),o=i("7e6b");async function c(e=null,t){var i,s;if(r["a"].geometryServiceUrl)return r["a"].geometryServiceUrl;if(!e)throw new n["a"]("internal:geometry-service-url-not-configured");let o;o="portal"in e?e.portal||a["a"].getDefault():e,await o.load({signal:t});const c=null==(i=o.helperServices)||null==(s=i.geometry)?void 0:s.url;if(!c)throw new n["a"]("internal:geometry-service-url-not-configured");return c}async function l(e,t,i=null,r){const a=await c(i,r),l=new o["a"];l.geometries=[e],l.outSpatialReference=t;const d=await Object(s["a"])(a,l,{signal:r});if(d&&Array.isArray(d)&&1===d.length)return d[0];throw new n["a"]("internal:geometry-service-projection-failed")}},e384:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var r=i("b2b2"),n=i("5e82"),a=i("a803");class s extends n["a"]{constructor(e,t,i){super(t),this.symbol=e,this.convert=i,this.graphics3DSymbol=null,this.referenced=0}getSymbolLayerSize(e){return Object(r["l"])(this.graphics3DSymbol)?this.graphics3DSymbol.getSymbolLayerSize(e):null}get symbolLayers(){return Object(r["l"])(this.graphics3DSymbol)?this.graphics3DSymbol.symbolLayers:[]}get extentPadding(){return Object(r["l"])(this.graphics3DSymbol)?this.graphics3DSymbol.extentPadding:0}async doLoad(e){const t=await this.symbol.fetchSymbol({signal:e});t.id=this.symbol.id,this.graphics3DSymbol=this.convert(t),await this.graphics3DSymbol.load()}createGraphics3DGraphic(e){return Object(r["l"])(this.graphics3DSymbol)?this.graphics3DSymbol.createGraphics3DGraphic(e,this):null}get complexity(){return Object(r["l"])(this.graphics3DSymbol)?this.graphics3DSymbol.complexity:a["e"]}globalPropertyChanged(e,t){return!!Object(r["l"])(this.graphics3DSymbol)&&this.graphics3DSymbol.globalPropertyChanged(e,t)}applyRendererDiff(e,t){return Object(r["l"])(this.graphics3DSymbol)?this.graphics3DSymbol.applyRendererDiff(e,t):0}prepareSymbolPatch(e){Object(r["l"])(this.graphics3DSymbol)&&this.graphics3DSymbol.prepareSymbolPatch(e)}updateGeometry(e,t){return!!Object(r["l"])(this.graphics3DSymbol)&&this.graphics3DSymbol.updateGeometry(e,t)}onRemoveGraphic(){}getFastUpdateStatus(){return Object(r["l"])(this.graphics3DSymbol)?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}}destroy(){Object(r["l"])(this.graphics3DSymbol)&&this.graphics3DSymbol.destroy(),this.graphics3DSymbol=void 0,super.destroy()}get destroyed(){return void 0===this.graphics3DSymbol}}},e4b1:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var r=i("1c92"),n=i("7c4b"),a=i("ae54");class s extends n["a"]{constructor(e,t,i,r,n,s=r,o=n){super(),this.triangleCountReportedInDebug=0,this.triangleCount=0,this.texture=null,this.key=new a["a"](e),this.x=t,this.y=i,this.width=r,this.height=n,this.rangeX=s,this.rangeY=o}destroy(){this.texture&&(this.texture.dispose(),this.texture=null)}setTransform(e,t){const i=t/(e.resolution*e.pixelRatio),n=this.transforms.tileMat3,[a,s]=e.toScreenNoRotation([0,0],[this.x,this.y]),o=this.width/this.rangeX*i,c=this.height/this.rangeY*i;Object(r["n"])(n,o,0,0,0,c,0,a,s,1),Object(r["k"])(this.transforms.dvs,e.displayViewMat3,n)}}},e4c1:function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return s})),i.d(t,"c",(function(){return a}));var r=i("6415");function n(e,t,i){if(e.count!==t.count)return void r["a"].error("source and destination buffers need to have the same number of elements");const n=e.count,a=i[0],s=i[1],o=i[2],c=i[3],l=i[4],d=i[5],h=i[6],u=i[7],p=i[8],f=i[9],b=i[10],m=i[11],g=i[12],v=i[13],y=i[14],O=i[15],_=e.typedBuffer,x=e.typedBufferStride,j=t.typedBuffer,w=t.typedBufferStride;for(let r=0;r<n;r++){const e=r*x,t=r*w,i=j[t],n=j[t+1],S=j[t+2],T=j[t+3];_[e]=a*i+l*n+p*S+g*T,_[e+1]=s*i+d*n+f*S+v*T,_[e+2]=o*i+h*n+b*S+y*T,_[e+3]=c*i+u*n+m*S+O*T}}function a(e,t,i){if(e.count!==t.count)return void r["a"].error("source and destination buffers need to have the same number of elements");const n=e.count,a=i[0],s=i[1],o=i[2],c=i[3],l=i[4],d=i[5],h=i[6],u=i[7],p=i[8],f=e.typedBuffer,b=e.typedBufferStride,m=t.typedBuffer,g=t.typedBufferStride;for(let r=0;r<n;r++){const e=r*b,t=r*g,i=m[t],n=m[t+1],v=m[t+2],y=m[t+3];f[e]=a*i+c*n+h*v,f[e+1]=s*i+l*n+u*v,f[e+2]=o*i+d*n+p*v,f[e+3]=y}}function s(e,t,i){const r=Math.min(e.count,t.count),n=e.typedBuffer,a=e.typedBufferStride,s=t.typedBuffer,o=t.typedBufferStride;for(let c=0;c<r;c++){const e=c*a,t=c*o;n[e]=i*s[t],n[e+1]=i*s[t+1],n[e+2]=i*s[t+2],n[e+3]=i*s[t+3]}}function o(e,t,i){const r=Math.min(e.count,t.count),n=e.typedBuffer,a=e.typedBufferStride,s=t.typedBuffer,o=t.typedBufferStride;for(let c=0;c<r;c++){const e=c*a,t=c*o;n[e]=s[t]>>i,n[e+1]=s[t+1]>>i,n[e+2]=s[t+2]>>i,n[e+3]=s[t+3]>>i}}Object.freeze({__proto__:null,transformMat4:n,transformMat3:a,scale:s,shiftRight:o})},e508:function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return s}));var r=i("2aad"),n=i("3886"),a=i("690a");function s(e){const t=new a["a"];return t.include(r["a"]),t.fragment.uniforms.add("tex","sampler2D"),0===e.function&&(e.hasOpacityFactor?(t.fragment.uniforms.add("opacity","float"),t.fragment.code.add(n["a"]`void main() {
gl_FragColor = texture2D(tex, uv) * opacity;
}`)):t.fragment.code.add(n["a"]`void main() {
gl_FragColor = texture2D(tex, uv);
}`)),3===e.function&&(t.fragment.uniforms.add("overlayIdx","int"),e.hasOpacityFactor&&t.fragment.uniforms.add("opacity","float"),t.fragment.code.add(n["a"]`
      void main() {
        vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5+ 0.5, uv.y);
        gl_FragColor = texture2D(tex, overlayUV) ${e.hasOpacityFactor?"* opacity":""};
      }`)),1===e.function&&t.fragment.code.add(n["a"]`void main() {
gl_FragColor = vec4(1.0 - texture2D(tex, uv).a);
}`),2===e.function&&(t.fragment.uniforms.add("colorTexture","sampler2D"),t.fragment.uniforms.add("alphaTexture","sampler2D"),t.fragment.uniforms.add("frontFaceTexture","sampler2D"),t.fragment.code.add(n["a"]`void main() {
vec4 srcColor = texture2D(colorTexture, uv);
float srcAlpha = texture2D(alphaTexture, uv).r;
vec4 frontFace = texture2D(frontFaceTexture, uv);
if(srcColor.a <= 1e-5){
discard;
}
gl_FragColor = vec4(mix(srcColor.rgb/srcColor.a, frontFace.rgb, frontFace.a), 1.0 - srcAlpha);
}`)),t}const o=Object.freeze({__proto__:null,build:s})},e550:function(e,t,i){"use strict";i.d(t,"a",(function(){return c}));var r=i("d981"),n=i("f159"),a=i("5d5f"),s=i("df77"),o=i("3886");function c(e,t){e.include(a["a"],t),e.include(n["a"]),e.include(r["a"]),t.ssrEnabled&&e.include(s["a"],t),e.fragment.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",3e5).add("ssrHeightFadeEnd","float",5e5).add("waterDiffusion","float",.775).add("waterSeeColorMod","float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]),e.fragment.code.add(o["a"]`PBRShadingWater shadingInfo;
vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
return mix(zenit, horizon, exponent);
}`),e.fragment.code.add(o["a"]`vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 positionView) {
float reflectionHit = 0.;
vec3 seaWaterColor = linearizeGamma(color);
vec3 h = normalize(l + v);
shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);
shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
float upDotV = max(dot(localUp,v), 0.0);
vec3 skyHorizon = linearizeGamma(skyColor);
vec3 skyZenit = linearizeGamma(skyZenitColor);
vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );
float upDotL = max(dot(localUp,l),0.0);
float daytimeMod = 0.1 + upDotL * 0.9;
skyColor *= daytimeMod;
float shadowModifier = clamp(shadow, 0.8, 1.0);
vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
vec3 reflSky = fresnelModifier * skyColor * shadowModifier;
vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;
vec3 specular = vec3(0.0);
if(upDotV > 0.0 && upDotL > 0.0) {
vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);
vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;
specular = shadingInfo.NdotL * incidentLight * specularSun;
}
vec3 foam = vec3(0.0);
if(upDotV > 0.0) {
foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
}`),t.ssrEnabled?e.fragment.code.add(o["a"]`vec4 viewPosition = vec4(positionView.xyz, 1.0);
vec3 viewDir = normalize(viewPosition.xyz);
vec4 viewNormalVectorCoordinate = ssrViewMat *vec4(n, 0.0);
vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
vec4 viewUp = ssrViewMat *vec4(localUp, 0.0);
float correctionViewingFactor = pow(max(dot(-viewDir, viewUp.xyz), 0.0), correctionViewingPowerFactor);
vec3 viewNormalCorrected = mix(viewUp.xyz, viewNormal, correctionViewingFactor);
vec3 reflected = normalize(reflect(viewDir, viewNormalCorrected));
vec3 hitCoordinate = screenSpaceIntersection( normalize(reflected), viewPosition.xyz, viewDir, viewUp.xyz);
vec3 reflectedColor = vec3(0.0);
if (hitCoordinate.z > 0.0)
{
vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);
vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -positionView.z);
reflectionHit = waterDiffusion * clamp(1.0 - (1.3*dCoords.y), 0.0, 1.0) * heightMod;
reflectedColor = linearizeGamma(texture2D(lastFrameColorMap, reprojectedCoordinate).xyz)* reflectionHit * fresnelModifier.y * ssrIntensity;
}
float seeColorMod =  mix(waterSeeColorMod, waterSeeColorMod*0.5, reflectionHit);
return tonemapACES((1. - reflectionHit) * reflSky + reflectedColor + reflSea * seeColorMod + specular + foam);
}`):e.fragment.code.add(o["a"]`return tonemapACES(reflSky + reflSea * waterSeeColorMod + specular + foam);
}`)}},e66f:function(e,t,i){"use strict";i.d(t,"a",(function(){return A})),i.d(t,"b",(function(){return C})),i.d(t,"c",(function(){return P}));var r=i("2255"),n=i("7304"),a=i("21ed"),s=i("bd75"),o=i("d272"),c=i("dfaf"),l=i("6d5b"),d=i("7d11"),h=i("bc40"),u=i("c2d1"),p=i("6a07"),f=i("d047"),b=i("b418"),m=i("0d7a"),g=i("6316"),v=i("ea4b"),y=i("c6d7"),O=i("a7d7"),_=i("73d4"),x=i("d017"),j=i("cd26"),w=i("ebd5"),S=i("3886"),T=i("690a");const C=new Map([["position",0],["normal",1],["normalCompressed",1],["color",2],["uv0",3],["uvRegion",4],["componentIndex",5]]);function P(e){const t=new T["a"];t.include(h["a"],e),t.include(d["a"],e),t.include(l["a"],e),t.include(c["a"],e),t.include(s["a"],e),t.include(n["a"],e),t.include(w["a"],e),t.include(o["a"],e),t.include(_["a"],e),t.include(a["a"],e),t.fragment.uniforms.add("view","mat4"),1!==e.pbrMode&&2!==e.pbrMode||(t.include(O["b"],e),e.hasNormalTexture&&t.include(m["a"],e)),3===e.output&&1===e.componentData?t.vertex.code.add(S["a"]`#define discardShadows(castShadows) { if(!castShadows) { gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`):t.vertex.code.add(S["a"]`#define discardShadows(castShadows) {}`);const i=e.overlayEnabled&&0===e.output&&4===e.pbrMode;return e.overlayEnabled&&(t.include(j["a"],e),1===e.viewingMode?t.vertex.code.add(S["a"]`
      const float invEllipsoidRadius = ${S["a"].float(1/(1===e.ellipsoidMode?r["a"].radius:2===e.ellipsoidMode?r["b"].radius:r["c"].radius))};
      vec2 projectOverlay(vec3 pos) {
        return pos.xy / (1.0 + invEllipsoidRadius * pos.z);
      }
      `):t.vertex.code.add(S["a"]`vec2 projectOverlay(vec3 pos) { return pos.xy; }`)),i&&(t.varyings.add("tbnTangent","vec3"),t.varyings.add("tbnBiTangent","vec3"),t.varyings.add("groundNormal","vec3"),t.varyings.add("positionView","vec3")),t.vertex.code.add(S["a"]`
    void main() {
      bool castShadows;
      vec4 externalColor = forwardExternalColor(castShadows);
      discardShadows(castShadows);

      vertexDiscardByOpacity(externalColor.a);

      if (externalColor.a < ${S["a"].float(w["c"])}) {
        // Discard this vertex
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }
      forwardPosition();
      forwardNormal();
      ${i?S["a"]`
        positionView = position_view();
        ${1===e.viewingMode?S["a"]`
        groundNormal = normalize(positionWorld());
        tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), groundNormal));
        tbnBiTangent = normalize(cross(groundNormal, tbnTangent));`:S["a"]`
        groundNormal = vec3(0.0, 0.0, 1.0);
        tbnTangent = vec3(1.0, 0.0, 0.0);
        tbnBiTangent = normalize(cross(groundNormal, tbnTangent));`}
        `:""}

      ${e.overlayEnabled?S["a"]`setOverlayVTC(projectOverlay(position));`:""}
      forwardTextureCoordinates();
      forwardVertexColor();
      forwardLinearDepth(); // depends on forwardPosition()
    }
  `),7===e.output&&(t.fragment.include(f["a"]),e.multipassTerrainEnabled&&t.include(y["b"],e),t.include(b["a"],e),t.fragment.code.add(S["a"]`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${e.multipassTerrainEnabled?S["a"]`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${e.overlayEnabled?S["a"]`
        vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
        vec4 overlayColor = overlayOpacity * overlayColorOpaque;
        materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        gl_FragColor = vec4(materialColor.a);
      }
    `)),0===e.output&&(t.fragment.include(f["a"]),e.multipassTerrainEnabled&&t.include(y["b"],e),t.include(b["a"],e),t.include(g["a"],e),t.include(v["a"],e),i&&t.fragment.uniforms.add("ovNormalTex","sampler2D"),e.receiveShadows?(t.include(x["a"],e),t.fragment.code.add(S["a"]`float evaluateShadow() {
return readShadowMap(vPositionWorldCameraRelative, linearDepth);
}`)):t.fragment.code.add(S["a"]`float evaluateShadow() { return 0.0; }`),t.fragment.code.add(S["a"]`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${e.multipassTerrainEnabled?S["a"]`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${e.overlayEnabled?S["a"]`
        vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
        vec4 overlayColor = overlayOpacity * overlayColorOpaque;
        materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}
    `),1===e.pbrMode||2===e.pbrMode?(t.fragment.code.add(S["a"]`
        ${1===e.pbrMode?S["a"]`
        applyPBRFactors();
        if (int(externalColorMixMode) == 3) {
          mrr = vec3(0.0, 0.6, 0.2);
        }`:""}
        vec3 normalVertex = shadingNormalWorld();
        float additionalIrradiance = 0.02 * lightingMainIntensity[2];
      `),e.hasNormalTexture?t.fragment.code.add(S["a"]`mat3 tangentSpace = computeTangentSpace(normalVertex, vPositionWorldCameraRelative, vuv0);
vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`):t.fragment.code.add(S["a"]`vec3 shadingNormal = normalVertex;`),t.fragment.code.add(S["a"]`${1===e.viewingMode?S["a"]`vec3 normalGround = normalize(positionWorld());`:S["a"]`vec3 normalGround = vec3(0.0, 0.0, 1.0);`}
      `),t.fragment.code.add(S["a"]`vec3 viewDir = normalize(vPositionWorldCameraRelative);
float ssao = 1.0 - occlusion * (1.0 - evaluateAmbientOcclusion());
vec3 additionalLight = evaluateAdditionalLighting(ssao, positionWorld());
vec4 shadedColor = vec4(evaluateSceneLightingPBR(shadingNormal, materialColor.rgb, evaluateShadow(), ssao, additionalLight, viewDir, normalGround, mrr, emission, additionalIrradiance), materialColor.a);`)):(e.receiveShadows?t.fragment.code.add(S["a"]`float shadow = evaluateShadow();`):1===e.viewingMode?t.fragment.code.add(S["a"]`float additionalAmbientScale = additionalDirectedAmbientLight(positionWorld());
float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);`):t.fragment.code.add(S["a"]`float shadow = 0.0;`),t.fragment.code.add(S["a"]`
      float ambientOcclusion = evaluateAmbientOcclusion();
      // At global scale we create some additional ambient light based on the main light to simulate global illumination
      vec3 additionalLight = evaluateAdditionalLighting(ambientOcclusion, positionWorld());
      vec4 shadedColor = vec4(evaluateSceneLighting(shadingNormalWorld(), materialColor.rgb, shadow, ambientOcclusion, additionalLight), materialColor.a);
      ${i?S["a"]`
          vec4 overlayWaterMask = getOverlayColor(ovNormalTex, vtcOverlay);
          float waterNormalLength = length(overlayWaterMask);
          if (waterNormalLength > 0.95) {
            mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, groundNormal);
            vec4 waterOverlayColor = vec4(overlayColorOpaque.xyz, overlayColor.w);
            vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vPositionWorldCameraRelative), shadow, groundNormal, tbnMatrix, positionView);
            vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
            // un-gamma the ground color to mix in linear space
            shadedColor = mix(shadedColor, waterColorNonLinear, waterColorLinear.w);
          }`:""}
      `)),t.fragment.code.add(S["a"]`
        gl_FragColor = highlightSlice(shadedColor, vPositionWorldCameraRelative);
        ${e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `)),1!==e.output&&3!==e.output||(t.include(u["a"],e),t.fragment.code.add(S["a"]`void main() {
discardBySlice(vPositionWorldCameraRelative);
vec4 textureColor = readBaseColorTexture();
discardOrAdjustAlpha(textureColor);
outputDepth(linearDepth);
}`)),2===e.output&&(t.include(g["a"],e),t.fragment.code.add(S["a"]`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        // note: the alpha component needs to be 1.0 in order for this material
        // to influence ambient occlusion, see the ssao fragment shader
        float alpha = ${2===e.normalType?"0.0":"1.0"};
        gl_FragColor = vec4(vec3(.5) + .5 * shadingNormal_view(), alpha);
      }
    `)),4===e.output&&(t.include(p["a"]),t.fragment.code.add(S["a"]`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${e.overlayEnabled?S["a"]`
        vec4 overlayColor = getCombinedOverlayColor();

        if (overlayColor.a == 0.0) {
          gl_FragColor = vec4(0.0);
          return;
        }`:""}

        outputHighlight();
      }
    `)),t}const A=Object.freeze({__proto__:null,attributeLocations:C,build:P})},e6aa:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("3886");function n(e,t){e.vertex.uniforms.add("intrinsicWidth","float"),t.vvSize?(e.attributes.add("sizeFeatureAttribute","float"),e.vertex.uniforms.add("vvSizeMinSize","vec3"),e.vertex.uniforms.add("vvSizeMaxSize","vec3"),e.vertex.uniforms.add("vvSizeOffset","vec3"),e.vertex.uniforms.add("vvSizeFactor","vec3"),e.vertex.code.add(r["a"]`float getSize() {
return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;
}`)):(e.attributes.add("size","float"),e.vertex.code.add(r["a"]`float getSize(){
return intrinsicWidth * size;
}`)),t.vvOpacity?(e.attributes.add("opacityFeatureAttribute","float"),e.vertex.constants.add("vvOpacityNumber","int",8),e.vertex.code.add(r["a"]`uniform float vvOpacityValues[vvOpacityNumber];
uniform float vvOpacityOpacities[vvOpacityNumber];
float interpolateOpacity( float value ){
if (value <= vvOpacityValues[0]) {
return vvOpacityOpacities[0];
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
}
}
return vvOpacityOpacities[vvOpacityNumber - 1];
}
vec4 applyOpacity( vec4 color ){
return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));
}`)):e.vertex.code.add(r["a"]`vec4 applyOpacity( vec4 color ){
return color;
}`),t.vvColor?(e.attributes.add("colorFeatureAttribute","float"),e.vertex.constants.add("vvColorNumber","int",8),e.vertex.code.add(r["a"]`uniform float vvColorValues[vvColorNumber];
uniform vec4 vvColorColors[vvColorNumber];
vec4 interpolateColor( float value ) {
if (value <= vvColorValues[0]) {
return vvColorColors[0];
}
for (int i = 1; i < vvColorNumber; ++i) {
if (vvColorValues[i] >= value) {
float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
return mix(vvColorColors[i-1], vvColorColors[i], f);
}
}
return vvColorColors[vvColorNumber - 1];
}
vec4 getColor(){
return applyOpacity(interpolateColor(colorFeatureAttribute));
}`)):(e.attributes.add("color","vec4"),e.vertex.code.add(r["a"]`vec4 getColor(){
return applyOpacity(color);
}`))}},e6bc:function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));class r{constructor(e,t,i){this.graphic=e,this.renderingInfo=t,this.layer=i}}},e764:function(e,t,i){"use strict";function r(){const e=new Float32Array(4);return e[3]=1,e}function n(e){const t=new Float32Array(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function a(e,t,i,r){const n=new Float32Array(4);return n[0]=e,n[1]=t,n[2]=i,n[3]=r,n}function s(e,t){return new Float32Array(e,t,4)}i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return r})),i.d(t,"c",(function(){return n}));Object.freeze({__proto__:null,create:r,clone:n,fromValues:a,createView:s})},e9d0:function(e,t,i){"use strict";i.d(t,"a",(function(){return $}));var r,n=i("a4ee"),a=(i("e06a"),i("4856")),s=(i("b423"),i("261a"),i("b48d"),i("478c"),i("667b"),i("ff57"),i("da00"),i("f976"),i("5cdb")),o=i("2eab"),c=i("1fd7"),l=i("2c4f"),d=i("ce50"),h=i("9096"),u=i("a5d8"),p=i("7ffa"),f=i("6d5f"),b=i("e92d"),m=i("b2b2"),g=i("e694"),v=i("e041"),y=i("59b2"),O=i("4c37"),_=i("1a3e"),x=i("afcf"),j=i("d386"),w=i("09db"),S=i("cea0"),T=i("92ef"),C=i("a2b1"),P=i("a1f3"),A=i("80b7"),M=i("c246"),R=i("00c5"),E=i("624c"),D=i("5a61"),I=i("69dd"),F=i("f51b"),z=i("f353"),L=i("3af1");function V(e){return e&&"esriSMS"===e.type}function k(e,t,i){var r;const n=this.originIdOf(t)>=Object(T["d"])(i.origin);return{ignoreOrigin:!0,allowNull:n,enabled:!!i&&"map-image"===(null==(r=i.layer)?void 0:r.type)&&(i.writeSublayerStructure||n)}}function U(e,t,i){var r;return{enabled:!!i&&"tile"===(null==(r=i.layer)?void 0:r.type)&&this._isOverridden(t)}}function B(e,t,i){return{ignoreOrigin:!0,enabled:i&&i.writeSublayerStructure||!1}}function N(e,t,i){return{ignoreOrigin:!0,enabled:!!i&&(i.writeSublayerStructure||this.originIdOf(t)>=Object(T["d"])(i.origin))}}const G=b["a"].getLogger("esri.layers.support.Sublayer");let q=0;const H=new Set;H.add("layer"),H.add("parent"),H.add("loaded"),H.add("loadStatus"),H.add("loadError"),H.add("loadWarnings");let W=r=class extends(Object(h["b"])(Object(g["a"])(Object(u["a"])(f["a"])))){constructor(e){super(e),this.capabilities=void 0,this.fields=null,this.fullExtent=null,this.globalIdField=null,this.legendEnabled=!0,this.objectIdField=null,this.popupEnabled=!0,this.popupTemplate=null,this.sourceJSON=null,this.title=null,this.typeIdField=null,this.types=null}async load(e){return this.addResolvingPromise((async()=>{var t;if(!this.layer&&!this.url)throw new d["a"]("sublayer:missing-layer","Sublayer can't be loaded without being part of a layer",{sublayer:this});let i=null;if(!this.layer||this.originIdOf("url")>2||"data-layer"===(null==(t=this.source)?void 0:t.type))i=(await Object(o["default"])(this.url,{responseType:"json",query:{f:"json"},...e})).data;else{var r;let t=this.id;"map-layer"===(null==(r=this.source)?void 0:r.type)&&(t=this.source.mapLayerId),i=await this.layer.fetchSublayerInfo(t,e)}i&&(this.sourceJSON=i,this.read({layerDefinition:i},{origin:"service"}))})()),this}readCapabilities(e,t){const i=(e=(t=t.layerDefinition||t).capabilities||e)?e.toLowerCase().split(",").map(e=>e.trim()):[];return{exportMap:{supportsModification:!!t.canModifyLayer},operations:{supportsQuery:-1!==i.indexOf("query")}}}set definitionExpression(e){this._setAndNotifyLayer("definitionExpression",e)}get fieldsIndex(){return new A["a"](this.fields||[])}set floorInfo(e){this._setAndNotifyLayer("floorInfo",e)}readGlobalIdFieldFromService(e,t){if((t=t.layerDefinition||t).globalIdField)return t.globalIdField;if(t.fields)for(const i of t.fields)if("esriFieldTypeGlobalID"===i.type)return i.name}get id(){const e=this._get("id");return null==e?q++:e}set id(e){this._get("id")!==e&&(!1!==this.get("layer.capabilities.exportMap.supportsDynamicLayers")?this._set("id",e):this._logLockedError("id","capability not available 'layer.capabilities.exportMap.supportsDynamicLayers'"))}set labelingInfo(e){this._setAndNotifyLayer("labelingInfo",e)}writeLabelingInfo(e,t,i,r){e&&e.length&&(t.layerDefinition={drawingInfo:{labelingInfo:e.map(e=>e.write({},r))}})}set labelsVisible(e){this._setAndNotifyLayer("labelsVisible",e)}set layer(e){this._set("layer",e),this.sublayers&&this.sublayers.forEach(t=>t.layer=e)}set listMode(e){this._set("listMode",e)}set minScale(e){this._setAndNotifyLayer("minScale",e)}readMinScale(e,t){return t.minScale||t.layerDefinition&&t.layerDefinition.minScale||0}set maxScale(e){this._setAndNotifyLayer("maxScale",e)}readMaxScale(e,t){return t.maxScale||t.layerDefinition&&t.layerDefinition.maxScale||0}readObjectIdFieldFromService(e,t){if((t=t.layerDefinition||t).objectIdField)return t.objectIdField;if(t.fields)for(const i of t.fields)if("esriFieldTypeOID"===i.type)return i.name}set opacity(e){this._setAndNotifyLayer("opacity",e)}readOpacity(e,t){const i=t.layerDefinition;return 1-.01*(null!=i.transparency?i.transparency:i.drawingInfo.transparency)}writeOpacity(e,t,i,r){t.layerDefinition={drawingInfo:{transparency:100-100*e}}}writeParent(e,t){this.parent&&this.parent!==this.layer?t.parentLayerId=Object(S["e"])(this.parent.id):t.parentLayerId=-1}get defaultPopupTemplate(){return this.createPopupTemplate()}set renderer(e){if(e)for(const t of e.getSymbols())if(Object(c["c"])(t)){G.warn("Sublayer renderer should use 2D symbols");break}this._setAndNotifyLayer("renderer",e)}get source(){return this._get("source")||new D["a"]({mapLayerId:this.id})}set source(e){this._setAndNotifyLayer("source",e)}set sublayers(e){this._handleSublayersChange(e,this._get("sublayers")),this._set("sublayers",e)}castSublayers(e){return Object(S["m"])(l["a"].ofType(r),e)}writeSublayers(e,t,i){this.get("sublayers.length")&&(t[i]=this.sublayers.map(e=>e.id).toArray().reverse())}readTypeIdField(e,t){let i=(t=t.layerDefinition||t).typeIdField;if(i&&t.fields){i=i.toLowerCase();const e=t.fields.find(e=>e.name.toLowerCase()===i);e&&(i=e.name)}return null}get url(){var e,t;const i=null!=(e=null==(t=this.layer)?void 0:t.parsedUrl)?e:this._lastParsedUrl,r=this.source;if(!i)return null;if(this._lastParsedUrl=i,"map-layer"===(null==r?void 0:r.type))return`${i.path}/${r.mapLayerId}`;const n={layer:JSON.stringify({source:this.source})};return`${i.path}/dynamicLayer?${Object(v["E"])(n)}`}set url(e){e?this._override("url",e):this._clearOverride("url")}set visible(e){this._setAndNotifyLayer("visible",e)}writeVisible(e,t,i,r){t[i]=this.getAtOrigin("defaultVisibility","service")||e}clone(){const{store:e}=Object(O["a"])(this),t=new r;return Object(O["a"])(t).store=e.clone(H),this.commitProperty("url"),t._lastParsedUrl=this._lastParsedUrl,t}createPopupTemplate(e){return Object(F["a"])(this,e)}createQuery(){return new I["a"]({returnGeometry:!0,where:this.definitionExpression||"1=1"})}async createFeatureLayer(){var e,t;if(this.hasOwnProperty("sublayers"))return null;const r=null==(e=this.layer)?void 0:e.parsedUrl,n=new(0,(await Promise.resolve().then(i.bind(null,"5bd5"))).default)({url:r.path});return r&&this.source&&("map-layer"===this.source.type?n.layerId=this.source.mapLayerId:n.dynamicDataSource=this.source),null!=this.layer.refreshInterval&&(n.refreshInterval=this.layer.refreshInterval),this.definitionExpression&&(n.definitionExpression=this.definitionExpression),this.floorInfo&&(n.floorInfo=Object(p["a"])(this.floorInfo)),this.originIdOf("labelingInfo")>2&&(n.labelingInfo=Object(p["a"])(this.labelingInfo)),this.originIdOf("labelsVisible")>0&&(n.labelsVisible=this.labelsVisible),this.originIdOf("legendEnabled")>0&&(n.legendEnabled=this.legendEnabled),this.originIdOf("visible")>0&&(n.visible=this.visible),this.originIdOf("minScale")>0&&(n.minScale=this.minScale),this.originIdOf("maxScale")>0&&(n.maxScale=this.maxScale),this.originIdOf("opacity")>0&&(n.opacity=this.opacity),this.originIdOf("popupTemplate")>0&&(n.popupTemplate=Object(p["a"])(this.popupTemplate)),this.originIdOf("renderer")>2&&(n.renderer=Object(p["a"])(this.renderer)),"data-layer"===(null==(t=this.source)?void 0:t.type)&&(n.dynamicDataSource=this.source.clone()),this.originIdOf("title")>0&&(n.title=this.title),"map-image"===this.layer.type&&this.layer.originIdOf("customParameters")>0&&(n.customParameters=this.layer.customParameters),"tile"===this.layer.type&&this.layer.originIdOf("customParameters")>0&&(n.customParameters=this.layer.customParameters),n}getField(e){return this.fieldsIndex.get(e)}getFeatureType(e){const{typeIdField:t,types:i}=this;if(!t||!e)return null;const r=e.attributes?e.attributes[t]:void 0;if(null==r)return null;let n=null;return i.some(e=>{const{id:t}=e;return null!=t&&(t.toString()===r.toString()&&(n=e),!!n)}),n}getFieldDomain(e,t){const i=t&&t.feature,r=this.getFeatureType(i);if(r){const t=r.domains&&r.domains[e];if(t&&"inherited"!==t.type)return t}return this._getLayerDomain(e)}async queryFeatures(e=this.createQuery(),t){var r,n,a,s;if(await this.load(),!this.get("capabilities.operations.supportsQuery"))throw new d["a"]("Sublayer.queryFeatures","this layer doesn't support queries.");const[{executeQuery:o},{default:c}]=await Promise.all([Promise.resolve().then(i.bind(null,"e9fc")),Promise.resolve().then(i.bind(null,"2edc"))]),l=await o(this.url,I["a"].from(e),null!=(r=null==(n=this.layer)?void 0:n.spatialReference)?r:null,{...t,query:{...null==(a=this.layer)?void 0:a.customParameters,token:null==(s=this.layer)?void 0:s.apiKey}}),h=c.fromJSON(l.data);if(null!=h&&h.features)for(const i of h.features)i.sourceLayer=this;return h}toExportImageJSON(e){var t;const i={id:this.id,source:(null==(t=this.source)?void 0:t.toJSON())||{mapLayerId:this.id,type:"mapLayer"}};if(this.definitionExpression){const t=Object(m["l"])(e)?Object(z["a"])(e,this):this.definitionExpression;i.definitionExpression=t}else Object(m["l"])(e)&&(i.definitionExpression=e);const r=["renderer","labelingInfo","opacity","labelsVisible"].reduce((e,t)=>(e[t]=this.originIdOf(t),e),{}),n=Object.keys(r).some(e=>r[e]>2);if(n){const e=i.drawingInfo={};r.renderer>2&&(e.renderer=this.renderer?this.renderer.toJSON():null),r.labelsVisible>2&&(e.showLabels=this.labelsVisible),this.labelsVisible&&r.labelingInfo>2&&(e.labelingInfo=this.labelingInfo?this.labelingInfo.map(e=>e.write({},{origin:"service",layer:this.layer})):null,e.showLabels=!0),r.opacity>2&&(e.transparency=100-100*this.opacity),this._assignDefaultSymbolColors(e.renderer)}return i}_assignDefaultSymbolColors(e){this._forEachSimpleMarkerSymbols(e,e=>{e.color||"esriSMSX"!==e.style&&"esriSMSCross"!==e.style||(e.outline&&e.outline.color?e.color=e.outline.color:e.color=[0,0,0,0])})}_forEachSimpleMarkerSymbols(e,t){if(e){const i="uniqueValueInfos"in e?e.uniqueValueInfos:"classBreakInfos"in e?e.classBreakInfos:[];for(const e of i)V(e.symbol)&&t(e.symbol);"symbol"in e&&V(e.symbol)&&t(e.symbol),"defaultSymbol"in e&&V(e.defaultSymbol)&&t(e.defaultSymbol)}}_setAndNotifyLayer(e,t){const i=this.layer,r=this._get(e);let n,a;switch(e){case"definitionExpression":case"floorInfo":n="supportsSublayerDefinitionExpression";case"minScale":case"maxScale":case"visible":n="supportsSublayerVisibility";break;case"labelingInfo":case"labelsVisible":case"opacity":case"renderer":case"source":n="supportsDynamicLayers",a="supportsModification"}const s=Object(O["a"])(this).getDefaultOrigin();if("service"!==s){if(n&&!1===this.get("layer.capabilities.exportMap."+n))return void this._logLockedError(e,`capability not available 'layer.capabilities.exportMap.${n}'`);if(a&&!1===this.get("capabilities.exportMap."+a))return void this._logLockedError(e,`capability not available 'capabilities.exportMap.${a}'`)}"source"!==e||"not-loaded"===this.loadStatus?(this._set(e,t),"service"!==s&&r!==t&&i&&i.emit&&i.emit("sublayer-update",{propertyName:e,target:this})):this._logLockedError(e,"'source' can't be changed after calling sublayer.load()")}_handleSublayersChange(e,t){t&&(t.forEach(e=>{e.parent=null,e.layer=null}),this.handles.removeAll()),e&&(e.forEach(e=>{e.parent=this,e.layer=this.layer}),this.handles.add([e.on("after-add",({item:e})=>{e.parent=this,e.layer=this.layer}),e.on("after-remove",({item:e})=>{e.parent=null,e.layer=null}),e.on("before-changes",e=>{const t=this.get("layer.capabilities.exportMap.supportsSublayersChanges");null==t||t||(G.error(new d["a"]("sublayer:sublayers-non-modifiable","Sublayer can't be added, moved, or removed from the layer's sublayers",{sublayer:this,layer:this.layer})),e.preventDefault())})]))}_logLockedError(e,t){G.error(new d["a"]("sublayer:locked",`Property '${e}' can't be changed on Sublayer from the layer '${this.layer.id}'`,{reason:t,sublayer:this,layer:this.layer}))}_getLayerDomain(e){const t=this.fieldsIndex.get(e);return t?t.domain:null}};W.test={isMapImageLayerOverridePolicy:e=>e===B||e===k,isTileImageLayerOverridePolicy:e=>e===U},Object(n["a"])([Object(y["b"])({readOnly:!0})],W.prototype,"capabilities",void 0),Object(n["a"])([Object(x["a"])("service","capabilities",["layerDefinition.canModifyLayer","layerDefinition.capabilities"])],W.prototype,"readCapabilities",null),Object(n["a"])([Object(y["b"])({type:String,value:null,json:{name:"layerDefinition.definitionExpression",write:{allowNull:!0,overridePolicy:k}}})],W.prototype,"definitionExpression",null),Object(n["a"])([Object(y["b"])({type:[P["a"]],json:{origins:{service:{read:{source:"layerDefinition.fields"}}}}})],W.prototype,"fields",void 0),Object(n["a"])([Object(y["b"])({readOnly:!0})],W.prototype,"fieldsIndex",null),Object(n["a"])([Object(y["b"])({type:R["a"],value:null,json:{name:"layerDefinition.floorInfo",read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo",overridePolicy:k},origins:{"web-scene":{read:!1,write:!1}}}})],W.prototype,"floorInfo",null),Object(n["a"])([Object(y["b"])({type:L["a"],json:{read:{source:"layerDefinition.extent"}}})],W.prototype,"fullExtent",void 0),Object(n["a"])([Object(y["b"])({type:String})],W.prototype,"globalIdField",void 0),Object(n["a"])([Object(x["a"])("service","globalIdField",["layerDefinition.globalIdField","layerDefinition.fields"])],W.prototype,"readGlobalIdFieldFromService",null),Object(n["a"])([Object(y["b"])({type:S["a"],json:{write:{ignoreOrigin:!0}}})],W.prototype,"id",null),Object(n["a"])([Object(y["b"])({value:null,type:[M["a"]],json:{read:{source:"layerDefinition.drawingInfo.labelingInfo"},write:{target:"layerDefinition.drawingInfo.labelingInfo",overridePolicy:B}}})],W.prototype,"labelingInfo",null),Object(n["a"])([Object(w["a"])("labelingInfo")],W.prototype,"writeLabelingInfo",null),Object(n["a"])([Object(y["b"])({type:Boolean,value:!0,json:{read:{source:"layerDefinition.drawingInfo.showLabels"},write:{target:"layerDefinition.drawingInfo.showLabels",overridePolicy:B}}})],W.prototype,"labelsVisible",null),Object(n["a"])([Object(y["b"])({value:null})],W.prototype,"layer",null),Object(n["a"])([Object(y["b"])({type:Boolean,value:!0,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend",overridePolicy:N}}})],W.prototype,"legendEnabled",void 0),Object(n["a"])([Object(y["b"])({type:["show","hide","hide-children"],value:"show",json:{read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],W.prototype,"listMode",null),Object(n["a"])([Object(y["b"])({type:Number,value:0,json:{write:{overridePolicy:B}}})],W.prototype,"minScale",null),Object(n["a"])([Object(x["a"])("minScale",["minScale","layerDefinition.minScale"])],W.prototype,"readMinScale",null),Object(n["a"])([Object(y["b"])({type:Number,value:0,json:{write:{overridePolicy:B}}})],W.prototype,"maxScale",null),Object(n["a"])([Object(x["a"])("maxScale",["maxScale","layerDefinition.maxScale"])],W.prototype,"readMaxScale",null),Object(n["a"])([Object(y["b"])({type:String})],W.prototype,"objectIdField",void 0),Object(n["a"])([Object(x["a"])("service","objectIdField",["layerDefinition.objectIdField","layerDefinition.fields"])],W.prototype,"readObjectIdFieldFromService",null),Object(n["a"])([Object(y["b"])({type:Number,value:1,json:{write:{target:"layerDefinition.drawingInfo.transparency",overridePolicy:B}}})],W.prototype,"opacity",null),Object(n["a"])([Object(x["a"])("opacity",["layerDefinition.drawingInfo.transparency","layerDefinition.transparency"])],W.prototype,"readOpacity",null),Object(n["a"])([Object(w["a"])("opacity")],W.prototype,"writeOpacity",null),Object(n["a"])([Object(y["b"])({json:{type:S["a"],write:{target:"parentLayerId",writerEnsuresNonNull:!0,overridePolicy:B}}})],W.prototype,"parent",void 0),Object(n["a"])([Object(w["a"])("parent")],W.prototype,"writeParent",null),Object(n["a"])([Object(y["b"])({type:Boolean,value:!0,json:{read:{source:"disablePopup",reader:(e,t)=>!t.disablePopup},write:{target:"disablePopup",overridePolicy:N,writer(e,t,i){t[i]=!e}}}})],W.prototype,"popupEnabled",void 0),Object(n["a"])([Object(y["b"])({type:a["a"],json:{read:{source:"popupInfo"},write:{target:"popupInfo",overridePolicy:N}}})],W.prototype,"popupTemplate",void 0),Object(n["a"])([Object(y["b"])({readOnly:!0})],W.prototype,"defaultPopupTemplate",null),Object(n["a"])([Object(y["b"])({types:s["a"],value:null,json:{name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:B},origins:{"web-scene":{types:s["b"],name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:B}}}}})],W.prototype,"renderer",null),Object(n["a"])([Object(y["b"])({types:{key:"type",base:null,typeMap:{"data-layer":E["a"],"map-layer":D["a"]}},cast(e){if(e){if("mapLayerId"in e)return Object(S["d"])(D["a"],e);if("dataSource"in e)return Object(S["d"])(E["a"],e)}return e},json:{name:"layerDefinition.source",write:{overridePolicy:B}}})],W.prototype,"source",null),Object(n["a"])([Object(y["b"])()],W.prototype,"sourceJSON",void 0),Object(n["a"])([Object(y["b"])({value:null,json:{type:[S["a"]],write:{target:"subLayerIds",allowNull:!0,overridePolicy:B}}})],W.prototype,"sublayers",null),Object(n["a"])([Object(_["a"])("sublayers")],W.prototype,"castSublayers",null),Object(n["a"])([Object(w["a"])("sublayers")],W.prototype,"writeSublayers",null),Object(n["a"])([Object(y["b"])({type:String,json:{name:"name",write:{overridePolicy:N}}})],W.prototype,"title",void 0),Object(n["a"])([Object(y["b"])({type:String})],W.prototype,"typeIdField",void 0),Object(n["a"])([Object(x["a"])("typeIdField",["layerDefinition.typeIdField"])],W.prototype,"readTypeIdField",null),Object(n["a"])([Object(y["b"])({type:[C["a"]],json:{origins:{service:{read:{source:"layerDefinition.types"}}}}})],W.prototype,"types",void 0),Object(n["a"])([Object(y["b"])({type:String,json:{read:{source:"layerUrl"},write:{target:"layerUrl",overridePolicy:U}}})],W.prototype,"url",null),Object(n["a"])([Object(y["b"])({type:Boolean,value:!0,json:{read:{source:"defaultVisibility"},write:{target:"defaultVisibility",overridePolicy:B}}})],W.prototype,"visible",null),Object(n["a"])([Object(w["a"])("visible")],W.prototype,"writeVisible",null),W=r=Object(n["a"])([Object(j["a"])("esri.layers.support.Sublayer")],W);const $=W},e9d6:function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return l})),i.d(t,"c",(function(){return c})),i.d(t,"d",(function(){return d})),i.d(t,"e",(function(){return u})),i.d(t,"f",(function(){return p})),i.d(t,"g",(function(){return h})),i.d(t,"h",(function(){return f}));var r=i("e92d"),n=i("d3cf"),a=i("82fa");const s=r["a"].getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function o(e){return{cachedResult:e.cachedResult,arcade:e.arcade?{func:e.arcade.func,context:e.arcade.modules.arcadeUtils.createExecContext(null,{sr:e.arcade.context.spatialReference}),modules:e.arcade.modules}:null}}function c(e){const t=e&&e.expression;if("string"==typeof t){const e=m(t);if(null!=e)return{cachedResult:e}}return null}async function l(e,t,i){const r=e&&e.expression;if("string"!=typeof r)return null;const n=m(r);if(null!=n)return{cachedResult:n};const s=await Object(a["e"])(),o=s.arcadeUtils,c=o.createSyntaxTree(r);return o.dependsOnView(c)?(null!=i&&i.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:o.createFunction(c),context:o.createExecContext(null,{sr:t}),modules:s}}}function d(e,t,i){return e.arcadeUtils.createFeature(t.attributes,t.geometry,i)}function h(e,t){if(null!=e&&!b(e)){if(!t||!e.arcade)return void s.errorOncePerTick("Arcade support required but not provided");const i=t;i._geometry&&(i._geometry=Object(n["b"])(i._geometry)),e.arcade.modules.arcadeUtils.updateExecContext(e.arcade.context,t)}}function u(e){if(null!=e){if(b(e))return e.cachedResult;const t=e.arcade;let i=e.arcade.modules.arcadeUtils.executeFunction(t.func,t.context);return"number"!=typeof i&&(e.cachedResult=0,i=0),i}return 0}function p(e,t=!1){let i=e&&e.featureExpressionInfo;const r=i&&i.expression;return t||"0"===r||(i=null),i}const f={cachedResult:0};function b(e){return null!=e.cachedResult}function m(e){return"0"===e?0:null}},ea44:function(e,t,i){"use strict";i.d(t,"a",(function(){return v})),i.d(t,"b",(function(){return g}));var r=i("bd75"),n=i("d272"),a=i("4db9"),s=i("6a07"),o=i("d047"),c=i("c6d7"),l=i("040b"),d=i("d017"),h=i("e550"),u=i("33e2"),p=i("ebd5"),f=i("4377"),b=i("3886"),m=i("690a");function g(e){const t=new m["a"];return t.include(a["a"],{linearDepth:!1}),t.attributes.add("position","vec3"),t.attributes.add("uv0","vec2"),t.vertex.uniforms.add("proj","mat4").add("view","mat4").add("localOrigin","vec3"),t.vertex.uniforms.add("waterColor","vec4"),0!==e.output&&7!==e.output||(t.include(l["a"],e),t.include(r["a"],e),t.varyings.add("vuv","vec2"),t.varyings.add("vpos","vec3"),t.varyings.add("vnormal","vec3"),t.varyings.add("vtbnMatrix","mat3"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),t.vertex.code.add(b["a"]`
      void main(void) {
        if (waterColor.a < ${b["a"].float(p["c"])}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vuv = uv0;
        vpos = position;

        vnormal = getLocalUp(vpos, localOrigin);
        vtbnMatrix = getTBNMatrix(vnormal);

        ${e.multipassTerrainEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}

        gl_Position = transformPosition(proj, view, vpos);
        ${0===e.output?"forwardLinearDepth();":""}
      }
    `)),e.multipassTerrainEnabled&&(t.fragment.include(o["a"]),t.include(c["b"],e)),7===e.output&&(t.include(n["a"],e),t.fragment.uniforms.add("waterColor","vec4"),t.fragment.code.add(b["a"]`
        void main() {
          discardBySlice(vpos);
          ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}

          gl_FragColor = vec4(waterColor.a);
        }
      `)),0===e.output&&(t.include(u["a"],e),t.include(n["a"],e),e.receiveShadows&&t.include(d["a"],e),t.include(h["a"],e),t.fragment.uniforms.add("waterColor","vec4").add("lightingMainDirection","vec3").add("lightingMainIntensity","vec3").add("camPos","vec3").add("timeElapsed","float").add("view","mat4"),t.fragment.include(f["a"]),t.fragment.code.add(b["a"]`
      void main() {
        discardBySlice(vpos);
        ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
        vec3 localUp = vnormal;
        // the created normal is in tangent space
        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);

        // we rotate the normal according to the tangent-bitangent-normal-Matrix
        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);
        vec3 v = -normalize(vpos - camPos);
        float shadow = ${e.receiveShadows?b["a"]`1.0 - readShadowMap(vpos, linearDepth)`:"1.0"};
        vec4 vPosView = view*vec4(vpos, 1.0);
        vec4 final = vec4(getSeaColor(n, v, lightingMainDirection, waterColor.rgb, lightingMainIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz), waterColor.w);

        // gamma correction
        gl_FragColor = delinearizeGamma(final);
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
        ${e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `)),2===e.output&&(t.include(l["a"],e),t.include(u["a"],e),t.include(n["a"],e),t.varyings.add("vpos","vec3"),t.varyings.add("vuv","vec2"),t.vertex.code.add(b["a"]`
        void main(void) {
          if (waterColor.a < ${b["a"].float(p["c"])}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vuv = uv0;
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
        }
    `),t.fragment.uniforms.add("timeElapsed","float"),t.fragment.code.add(b["a"]`void main() {
discardBySlice(vpos);
vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);
tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);
gl_FragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);
}`)),5===e.output&&(t.varyings.add("vpos","vec3"),t.vertex.code.add(b["a"]`
        void main(void) {
          if (waterColor.a < ${b["a"].float(p["c"])}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vpos = position;
          gl_Position = transformPosition(proj, view, vpos);
        }
    `),t.fragment.uniforms.add("waterColor","vec4"),t.fragment.code.add(b["a"]`void main() {
gl_FragColor = waterColor;
}`)),4===e.output&&(t.include(s["a"]),t.varyings.add("vpos","vec3"),t.vertex.code.add(b["a"]`
      void main(void) {
        if (waterColor.a < ${b["a"].float(p["c"])}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
      }
    `),t.include(n["a"],e),t.fragment.code.add(b["a"]`void main() {
discardBySlice(vpos);
outputHighlight();
}`)),t}const v=Object.freeze({__proto__:null,build:g})},ea4b:function(e,t,i){"use strict";i.d(t,"a",(function(){return d}));var r=i("2906"),n=i("7088"),a=i("dea3"),s=i("5d5f"),o=i("c51b"),c=i("d017"),l=i("3886");function d(e,t){const i=e.fragment;e.include(a["a"]),e.include(n["a"],t),0!==t.pbrMode&&e.include(s["a"],t),e.include(r["a"],t),t.receiveShadows&&e.include(c["a"],t),i.uniforms.add("lightingGlobalFactor","float"),i.uniforms.add("ambientBoostFactor","float"),e.include(o["a"]),i.code.add(l["a"]`
    const float GAMMA_SRGB = 2.1;
    const float INV_GAMMA_SRGB = 0.4761904;
    ${0===t.pbrMode?"":"const vec3 GROUND_REFLECTANCE = vec3(0.2);"}
  `),i.code.add(l["a"]`
    float additionalDirectedAmbientLight(vec3 vPosWorld) {
      float vndl = dot(${1===t.viewingMode?l["a"]`normalize(vPosWorld)`:l["a"]`vec3(0.0, 0.0, 1.0)`}, lightingMainDirection);
      return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
    }
  `),i.code.add(l["a"]`vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {
float additionalAmbientScale = additionalDirectedAmbientLight(vPosWorld);
return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * lightingMainIntensity;
}`),0===t.pbrMode||4===t.pbrMode?i.code.add(l["a"]`vec3 evaluateSceneLighting(vec3 normalWorld, vec3 albedo, float shadow, float ssao, vec3 additionalLight)
{
vec3 mainLighting = evaluateMainLighting(normalWorld, shadow);
vec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ssao);
vec3 albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
vec3 totalLight = mainLighting + ambientLighting + additionalLight;
totalLight = min(totalLight, vec3(PI));
vec3 outColor = vec3((albedoLinear / PI) * totalLight);
return pow(outColor, vec3(INV_GAMMA_SRGB));
}`):1!==t.pbrMode&&2!==t.pbrMode||(i.code.add(l["a"]`const float fillLightIntensity = 0.25;
const float horizonLightDiffusion = 0.4;
const float additionalAmbientIrradianceFactor = 0.02;
vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec3 _emission, float additionalAmbientIrradiance)
{
vec3 viewDirection = -viewDir;
vec3 mainLightDirection = lightingMainDirection;
vec3 h = normalize(viewDirection + mainLightDirection);
PBRShadingInfo inputs;
inputs.NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);
inputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);
inputs.NdotH = clamp(dot(normal, h), 0.0, 1.0);
inputs.VdotH = clamp(dot(viewDirection, h), 0.0, 1.0);
inputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);
vec3 reflectedView = normalize(reflect(viewDirection, normal));
inputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);
inputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
inputs.ssao = ssao;
inputs.metalness = mrr[0];
inputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);`),i.code.add(l["a"]`inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;
inputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0));
inputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);`),i.code.add(l["a"]`vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);
ambientDir = ambientDir != vec3(0.0)? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));
inputs.NdotAmbDir = abs(dot(normal, ambientDir));
vec3 mainLightIrradianceComponent = inputs.NdotL * (1.0 - shadow) * lightingMainIntensity;
vec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * lightingMainIntensity * fillLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;
inputs.skyIrradianceToSurface = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;
inputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;`),i.code.add(l["a"]`vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;
vec3 horizonRingH = normalize(viewDirection + horizonRingDir);
inputs.NdotH_Horizon = dot(normal, horizonRingH);
vec3 mainLightRadianceComponent = normalDistribution(inputs.NdotH, inputs.roughness) * lightingMainIntensity * (1.0 - shadow);
vec3 horizonLightRadianceComponent = normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * lightingMainIntensity * fillLightIntensity;
vec3 ambientLightRadianceComponent = calculateAmbientRadiance(ssao) + additionalLight;
inputs.skyRadianceToSurface = ambientLightRadianceComponent + mainLightRadianceComponent + horizonLightRadianceComponent;
inputs.groundRadianceToSurface = GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) + mainLightRadianceComponent;
inputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);`),i.code.add(l["a"]`
        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);
        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;
        vec3 emissionComponent = pow(_emission, vec3(GAMMA_SRGB));
        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;
        ${2===t.pbrMode?l["a"]`vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));`:l["a"]`vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));`}
        return outColor;
      }
    `))}},ebd5:function(e,t,i){"use strict";i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return n})),i.d(t,"c",(function(){return a}));var r=i("3886");const n=.1,a=.001;function s(e,t){const i=e.fragment;switch(t.alphaDiscardMode){case 0:i.code.add(r["a"]`
        #define discardOrAdjustAlpha(color) { if (color.a < ${r["a"].float(a)}) { discard; } }
      `);break;case 1:i.code.add(r["a"]`void discardOrAdjustAlpha(inout vec4 color) {
color.a = 1.0;
}`);break;case 2:i.uniforms.add("textureAlphaCutoff","float"),i.code.add(r["a"]`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }`);break;case 3:e.fragment.uniforms.add("textureAlphaCutoff","float"),e.fragment.code.add(r["a"]`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }`)}}},ec13:function(e,t,i){"use strict";i.d(t,"a",(function(){return h})),i.d(t,"b",(function(){return u})),i.d(t,"c",(function(){return p})),i.d(t,"d",(function(){return l}));var r=i("9ef0"),n=(i("c120"),i("b2b2")),a=i("a915"),s=i("0fc4");function o(e){return"fill"===e.type}function c(e){return"extrude"===e.type}function l(e){return e&&e.enabled&&(c(e)||o(e))&&Object(n["l"])(e.edges)}function d(e){return e&&e.enabled&&e.edges||null}function h(e,t){return u(d(e),t)}function u(e,t){if(Object(n["k"])(e))return null;const i=Object(n["l"])(e.color)?Object(s["f"])(r["a"].toUnitRGBA(e.color)):Object(s["g"])(0,0,0,0),o=Object(a["h"])(e.size),c=Object(a["h"])(e.extensionLength);switch(e.type){case"solid":return p({color:i,size:o,extensionLength:c,...t});case"sketch":return f({color:i,size:o,extensionLength:c,...t});default:return}}function p(e){return{...b,...e,type:"solid"}}function f(e){return{...m,...e,type:"sketch"}}const b={color:Object(s["g"])(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:2},m={color:Object(s["g"])(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:2}},ed70:function(e,t,i){"use strict";i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return a})),i.d(t,"c",(function(){return s}));var r=i("0fc4");const n=1.2,a=r["b"],s=r["a"]},ee2c:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i("6a21"),n=i("3886");function a(e,t){const i=e.vertex;i.uniforms.add("uDistanceFalloffFactor","float"),i.code.add(n["a"]`float distanceBasedPerspectiveFactor(float distance) {
return clamp(sqrt(uDistanceFalloffFactor / distance), 0.0, 1.0);
}`),i.uniforms.add("uComponentDataTex","sampler2D"),i.uniforms.add("uComponentDataTexInvDim","vec2"),e.attributes.add("componentIndex","float"),i.constants.add("componentColorFieldOffset","float",0),i.constants.add("componentOtherFieldOffset","float",1),i.constants.add("componentFieldCount","float",2),i.constants.add("lineWidthFractionFactor","float",8),i.constants.add("extensionLengthOffset","float",128),i.constants.add("componentTexWidth","float",4096),i.code.add(n["a"]`vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {
float fieldIndex = componentFieldCount * componentIndex + fieldOffset;
float rowIndex = floor(fieldIndex / componentTexWidth);
float colIndex = mod(fieldIndex, componentTexWidth);
vec2 linearIndex = vec2(
(colIndex + 0.5) / componentTexWidth,
(rowIndex + 0.5) * uComponentDataTexInvDim.y
);
return linearIndex;
}
struct ComponentData {
vec4 color;
float lineWidth;
float extensionLength;
float type;
};
ComponentData readComponentData() {
vec2 colorIndex = _componentTextureCoords(componentIndex, componentColorFieldOffset);
vec2 otherIndex = _componentTextureCoords(componentIndex, componentOtherFieldOffset);
vec4 colorValue = texture2D(uComponentDataTex, colorIndex);
vec4 otherValue = texture2D(uComponentDataTex, otherIndex);
return ComponentData(
vec4(colorValue.rgb, colorValue.a * otherValue.w),
otherValue.x * (255.0 / lineWidthFractionFactor),
otherValue.y * 255.0 - extensionLengthOffset,
-(otherValue.z * 255.0) + 0.5
);
}`),t.legacy?i.code.add(n["a"]`vec3 _modelToWorldNormal(vec3 normal) {
return (uModel * vec4(normal, 0.0)).xyz;
}
vec3 _modelToViewNormal(vec3 normal) {
return (uView * uModel * vec4(normal, 0.0)).xyz;
}`):(i.uniforms.add("uTransformNormal_GlobalFromModel ","mat3"),i.code.add(n["a"]`vec3 _modelToWorldNormal(vec3 normal) {
return uTransformNormal_GlobalFromModel * normal;
}`)),t.silhouette?(e.attributes.add("normalA","vec3"),e.attributes.add("normalB","vec3"),i.code.add(n["a"]`vec3 worldNormal() {
return _modelToWorldNormal(normalize(normalA + normalB));
}`)):(e.attributes.add("normal","vec3"),i.code.add(n["a"]`vec3 worldNormal() {
return _modelToWorldNormal(normal);
}`)),t.legacy?i.code.add(n["a"]`vec3 worldFromModelPosition(vec3 position) {
return (uModel * vec4(position, 1.0)).xyz;
}
vec3 viewFromModelPosition(vec3 position) {
return (uView * vec4(worldFromModelPosition(position), 1.0)).xyz;
}
vec4 projFromViewPosition(vec3 position) {
return uProj * vec4(position, 1.0);
}`):(e.vertex.include(r["a"],t),i.code.add(n["a"]`vec3 worldFromModelPosition(vec3 position) {
vec3 rotatedModelPosition = uTransform_WorldFromModel_RS * position;
vec3 transform_CameraRelativeFromModel = dpAdd(
uTransform_WorldFromModel_TL,
uTransform_WorldFromModel_TH,
-uTransform_WorldFromView_TL,
-uTransform_WorldFromView_TH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}
vec3 viewFromModelPosition(vec3 position) {
return uTransform_ViewFromCameraRelative_RS * worldFromModelPosition(position);
}
vec4 projFromViewPosition(vec3 position) {
return uTransform_ProjFromView * vec4(position, 1.0);
}`)),i.code.add(n["a"]`float calculateExtensionLength(float extensionLength, float lineLength) {
return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);
}`)}!function(e){function t(e){return 1===e.mode||2===e.mode}function i(e){return 0===e.mode||2===e.mode}e.usesSketchLogic=t,e.usesSolidLogic=i}(a||(a={}))},ee83:function(e,t,i){"use strict";i.d(t,"a",(function(){return b}));var r=i("ce50"),n=i("38a4"),a=i("b2b2"),s=i("8048"),o=i("3af1"),c=i("8188"),l=i("5996"),d=i("9180"),h=i("7f83"),u=i("9786"),p=i("dff3");const f=12;class b{constructor(e){const t=b.checkUnsupported(e);if(Object(a["l"])(t))throw t;const i=Object(a["u"])(e);this.spatialReference=i.spatialReference,this._isWebMercator=this.spatialReference.isWebMercator,this._isGCS=Object(c["a"])(this.spatialReference)||Object(h["i"])(this.spatialReference)||Object(h["j"])(this.spatialReference),this.origin=[i.origin.x,i.origin.y],this.pixelSize=i.size[0],this.dpi=i.dpi;const r=i.lods.reduce((function(e,t,i){return t.level<e.min&&(e.min=t.level,e.minIndex=i),e.max=Math.max(e.max,t.level),e}),{min:1/0,minIndex:0,max:-1/0}),n=i.lods[r.minIndex],s=2**n.level;let o=n.resolution*s,l=n.scale*s;this.levels=new Array(r.max+1);for(let a=0;a<this.levels.length;a++)this.levels[a]={resolution:o,scale:l,tileSize:[o*i.size[0],o*i.size[1]]},o/=2,l/=2}clone(){return new b(this.toTileInfo())}toTileInfo(){return new p["a"]({dpi:this.dpi,origin:{x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference},size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map((e,t)=>({level:t,scale:e.scale,resolution:e.resolution}))})}getExtent(e,t,i,r){const n=this.levels[e],a=n.tileSize[0],s=n.tileSize[1];r[0]=this.origin[0]+i*a,r[2]=r[0]+a,r[3]=this.origin[1]-t*s,r[1]=r[3]-s}convertExtentToRadians(e,t){this._isWebMercator?(t[0]=Object(u["f"])(e[0]),t[1]=Object(u["h"])(e[1]),t[2]=Object(u["f"])(e[2]),t[3]=Object(u["h"])(e[3])):this._isGCS&&(t[0]=Object(n["h"])(e[0]),t[1]=Object(n["h"])(e[1]),t[2]=Object(n["h"])(e[2]),t[3]=Object(n["h"])(e[3]))}getExtentGeometry(e,t,i,r=new o["a"]){return this.getExtent(e,t,i,m),r.spatialReference=this.spatialReference,r.xmin=m[0],r.ymin=m[1],r.xmax=m[2],r.ymax=m[3],r.zmin=void 0,r.zmax=void 0,r}ensureMaxLod(e){if(null==e)return!1;let t=!1;for(;this.levels.length<=e;){const e=this.levels[this.levels.length-1],i=e.resolution/2;this.levels.push({resolution:i,scale:e.scale/2,tileSize:[i*this.pixelSize,i*this.pixelSize]}),t=!0}return t}capMaxLod(e){this.levels.length>e+1&&(this.levels.length=e+1)}getMaxLod(){return this.levels.length-1}scaleAtLevel(e){return this.levels[0].scale/2**e}levelAtScale(e){const t=this.levels[0].scale;return e>=t?0:Math.log(t/e)*Math.LOG2E}resolutionAtLevel(e){return this.levels[0].resolution/2**e}compatibleWith(e){if(!(e instanceof b)){if(b.checkUnsupported(e))return!1;e=new b(e)}if(!e.spatialReference.equals(this.spatialReference))return!1;if(e.pixelSize!==this.pixelSize)return!1;const t=Math.min(this.levels.length,e.levels.length)-1,i=this.levels[t].resolution;let r=.5*i;return!(!Object(n["i"])(e.origin[0],this.origin[0],r)||!Object(n["i"])(e.origin[1],this.origin[1],r))&&(r=.5*i/2**t/this.pixelSize*f,Object(n["i"])(i,e.levels[t].resolution,r))}rootTilesInExtent(e,t=null,i=1/0){const r=new Array,n=this.levels[0].tileSize;if(Object(a["k"])(e)||0===n[0]||0===n[1])return r;b.computeRowColExtent(e,n,this.origin,m);let s=m[1],o=m[3],c=m[0],l=m[2];const d=l-c,h=o-s;if(d*h>i){const e=Math.floor(Math.sqrt(i));h>e&&(s=s+Math.floor(.5*h)-Math.floor(.5*e),o=s+e),d>e&&(c=c+Math.floor(.5*d)-Math.floor(.5*e),l=c+e)}for(let a=s;a<o;a++)for(let e=c;e<l;e++)r.push([0,a,e]);return Object(a["l"])(t)&&(t[0]=this.origin[0]+c*n[0],t[1]=this.origin[1]-o*n[1],t[2]=this.origin[0]+l*n[0],t[3]=this.origin[1]-s*n[1]),r}static computeRowColExtent(e,t,i,r){const n=.001*(e[2]-e[0]+(e[3]-e[1]));r[0]=Math.max(0,Math.floor((e[0]+n-i[0])/t[0])),r[2]=Math.max(0,Math.ceil((e[2]-n-i[0])/t[0])),r[1]=Math.max(0,Math.floor((i[1]-e[3]+n)/t[1])),r[3]=Math.max(0,Math.ceil((i[1]-e[1]-n)/t[1]))}static isPowerOfTwo(e){const t=e.lods,i=t[0].resolution*2**t[0].level;return!t.some((function(e){return!Object(n["j"])(e.resolution,i/2**e.level)}))}static hasGapInLevels(e){const t=e.lods.map((function(e){return e.level}));t.sort((function(e,t){return e-t}));for(let i=1;i<t.length;i++)if(t[i]!==t[0]+i)return!0;return!1}static tileSizeSupported(e){const t=e.size[1];return t===e.size[0]&&0==(t&t-1)&&t>=128&&t<=512}static hasOriginPerLODs(e){const t=e.origin;return e.lods.some(e=>null!=e.origin&&(e.origin[0]!==t.x||e.origin[1]!==t.y))}static checkUnsupported(e){return Object(a["k"])(e)?new r["a"]("tilingscheme:tile-info-missing","Tiling scheme must have tiling information"):e.lods.length<1?new r["a"]("tilingscheme:generic","Tiling scheme must have at least one level"):b.isPowerOfTwo(e)?b.hasGapInLevels(e)?new r["a"]("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):b.tileSizeSupported(e)?b.hasOriginPerLODs(e)?new r["a"]("tilingscheme:multiple-origin","Tiling scheme levels must not have their own origin"):null:new r["a"]("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new r["a"]("tilingscheme:power-of-two","Tiling scheme must be power of two")}static fromExtent(e,t){const i=e[2]-e[0],r=e[3]-e[1],n=Object(s["f"])(t),a=1.2*Math.max(i,r),o=256,c=96,l=.0254,d=new b(new p["a"]({size:[o,o],origin:{x:e[0]-.5*(a-i),y:e[3]+.5*(a-r)},lods:[{level:0,resolution:a/o,scale:1/(o/c*l/(a*n))}],spatialReference:t}));return d.ensureMaxLod(20),d}static makeWebMercatorAuxiliarySphere(e){const t=new b(b.WebMercatorAuxiliarySphereTileInfo);return t.ensureMaxLod(e),t}static makeGCSWithTileSize(e,t=256,i=16){const r=256/t,n=new b(new p["a"]({size:[t,t],origin:{x:-180,y:90,spatialReference:e},spatialReference:e,lods:[{level:0,resolution:.703125*r,scale:295497598.570834*r}]}));return n.ensureMaxLod(i),n}get test(){return{isWebMercator:this._isWebMercator,isGCS:this._isGCS}}}b.WebMercatorAuxiliarySphereTileInfo=new p["a"]({size:[256,256],origin:{x:-20037508.342787,y:20037508.342787,spatialReference:l["a"].WebMercator},spatialReference:l["a"].WebMercator,lods:[{level:0,resolution:156543.03392800014,scale:591657527.591555}]}),b.WebMercatorAuxiliarySphere=b.makeWebMercatorAuxiliarySphere(19);const m=Object(d["m"])()},f0b9:function(e,t,i){"use strict";function r(e){return 32+e.length}function n(){return 16}function a(e){if(!e)return 0;let t=32;for(const i in e)if(e.hasOwnProperty(i)){const a=e[i];switch(typeof a){case"string":t+=r(a);break;case"number":t+=n();break;case"boolean":t+=4}}return t}function s(e,t){return 32+e.length*t}i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return s})),i.d(t,"c",(function(){return n})),i.d(t,"d",(function(){return r}))},f0ba:function(e,t,i){"use strict";i.d(t,"a",(function(){return g}));var r,n=i("a4ee"),a=i("6a0e"),s=i("7ffa"),o=i("e92d"),c=i("59b2"),l=i("1a3e"),d=i("d386"),h=i("cea0"),u=i("dee7"),p=i("83fa"),f=i("f5e7");const b=o["a"].getLogger("esri.geometry.support.MeshComponent");let m=r=class extends a["a"]{constructor(e){super(e),this.faces=null,this.material=null,this.shading="source",this.trustSourceNormals=!1}static from(e){return Object(h["d"])(r,e)}castFaces(e){return Object(f["b"])(e,Uint32Array,[Uint16Array],{loggerTag:".faces=",stride:3},b)}castMaterial(e){return Object(h["d"])(e&&"object"==typeof e&&("metallic"in e||"roughness"in e||"metallicRoughnessTexture"in e)?p["a"]:u["a"],e)}clone(){return new r({faces:Object(s["a"])(this.faces),shading:this.shading,material:Object(s["a"])(this.material),trustSourceNormals:this.trustSourceNormals})}cloneWithDeduplication(e,t){const i={faces:Object(s["a"])(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(e,t):null,trustSourceNormals:this.trustSourceNormals};return new r(i)}};Object(n["a"])([Object(c["b"])({json:{write:!0}})],m.prototype,"faces",void 0),Object(n["a"])([Object(l["a"])("faces")],m.prototype,"castFaces",null),Object(n["a"])([Object(c["b"])({type:u["a"],json:{write:!0}})],m.prototype,"material",void 0),Object(n["a"])([Object(l["a"])("material")],m.prototype,"castMaterial",null),Object(n["a"])([Object(c["b"])({type:String,json:{write:!0}})],m.prototype,"shading",void 0),Object(n["a"])([Object(c["b"])({type:Boolean})],m.prototype,"trustSourceNormals",void 0),m=r=Object(n["a"])([Object(d["a"])("esri.geometry.support.MeshComponent")],m);const g=m},f159:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("3886");function n(e){e.fragment.code.add(r["a"]`const float GAMMA = 2.2;
const float INV_GAMMA = 0.4545454545;
vec4 delinearizeGamma(vec4 color) {
return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);
}
vec3 linearizeGamma(vec3 color) {
return pow(color, vec3(GAMMA));
}`)}},f33e:function(e,t,i){"use strict";i.d(t,"a",(function(){return c})),i.d(t,"b",(function(){return s})),i.d(t,"c",(function(){return o})),i.d(t,"d",(function(){return n})),i.d(t,"e",(function(){return a}));var r=i("b50f");function n(e){const t=[];return e.levels.forEach(e=>{e.components.forEach(e=>{t.push(e.material)})}),Object(r["o"])(t)}function a(e){const t=new Array;return e.levels.forEach(e=>{e.components.forEach(e=>{e.textures&&t.push(...e.textures)})}),Object(r["o"])(t)}function s(e){const t=[];return e.components.forEach(e=>{t.push(e.geometry)}),Object(r["o"])(t)}function o(e){const t=[];return e.levels.forEach(e=>{e.components.forEach(e=>{t.push(e.geometry)})}),Object(r["o"])(t)}function c(e){return s(e).reduce((e,t)=>e+t.indexCount/3,0)}},f5e7:function(e,t,i){"use strict";i.d(t,"a",(function(){return u})),i.d(t,"b",(function(){return f})),i.d(t,"c",(function(){return g}));var r,n=i("a4ee"),a=i("6a0e"),s=i("7ffa"),o=i("e92d"),c=i("59b2"),l=i("1a3e"),d=i("d386");const h=o["a"].getLogger("esri.geometry.support.MeshVertexAttributes");let u=r=class extends a["a"]{constructor(e){super(e),this.color=null,this.position=new Float64Array(0),this.uv=null,this.normal=null,this.tangent=null}castColor(e){return f(e,Uint8Array,[Uint8ClampedArray],{loggerTag:".color=",stride:4},h)}castPosition(e){return e&&e instanceof Float32Array&&h.warn(".position=","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array"),f(e,Float64Array,[Float32Array],{loggerTag:".position=",stride:3},h)}castUv(e){return f(e,Float32Array,[Float64Array],{loggerTag:".uv=",stride:2},h)}castNormal(e){return f(e,Float32Array,[Float64Array],{loggerTag:".normal=",stride:3},h)}castTangent(e){return f(e,Float32Array,[Float64Array],{loggerTag:".tangent=",stride:4},h)}clone(){const e={position:Object(s["a"])(this.position),uv:Object(s["a"])(this.uv),normal:Object(s["a"])(this.normal),tangent:Object(s["a"])(this.tangent),color:Object(s["a"])(this.color)};return new r(e)}clonePositional(){const e={position:Object(s["a"])(this.position),normal:Object(s["a"])(this.normal),tangent:Object(s["a"])(this.tangent),uv:this.uv,color:this.color};return new r(e)}};function p(e,t,i,r){const{loggerTag:n,stride:a}=t;return e.length%a!=0?(r.error(n,"Invalid array length, expected a multiple of "+a),new i([])):e}function f(e,t,i,r,n){if(!e)return e;if(e instanceof t)return p(e,r,t,n);for(const a of i)if(e instanceof a)return p(new t(e),r,t,n);if(Array.isArray(e))return p(new t(e),r,t,n);{const r=i.map(e=>`'${e.name}'`);return n.error(`Failed to set property, expected one of ${r}, but got ${e.constructor.name}`),new t([])}}function b(e,t,i){t[i]=m(e)}function m(e){const t=new Array(e.length);for(let i=0;i<e.length;i++)t[i]=e[i];return t}Object(n["a"])([Object(c["b"])({json:{write:b}})],u.prototype,"color",void 0),Object(n["a"])([Object(l["a"])("color")],u.prototype,"castColor",null),Object(n["a"])([Object(c["b"])({nonNullable:!0,json:{write:b}})],u.prototype,"position",void 0),Object(n["a"])([Object(l["a"])("position")],u.prototype,"castPosition",null),Object(n["a"])([Object(c["b"])({json:{write:b}})],u.prototype,"uv",void 0),Object(n["a"])([Object(l["a"])("uv")],u.prototype,"castUv",null),Object(n["a"])([Object(c["b"])({json:{write:b}})],u.prototype,"normal",void 0),Object(n["a"])([Object(l["a"])("normal")],u.prototype,"castNormal",null),Object(n["a"])([Object(c["b"])({json:{write:b}})],u.prototype,"tangent",void 0),Object(n["a"])([Object(l["a"])("tangent")],u.prototype,"castTangent",null),u=r=Object(n["a"])([Object(d["a"])("esri.geometry.support.MeshVertexAttributes")],u);const g=u},f6ac:function(e,t,i){"use strict";i.d(t,"a",(function(){return p})),i.d(t,"b",(function(){return l}));var r=i("2f00"),n=i("2eb0"),a=i("7697"),s=i("4377"),o=i("3886"),c=i("690a");function l(e){const t=new c["a"];return t.include(r["a"]),t.include(a["a"]),t.include(n["a"]),0===e.output?h(t,e):1===e.output?d(t):2===e.output&&u(t,e),t}function d(e){e.fragment.code.add(o["a"]`void main() {
vec2 pixelLocation = getPixelLocation(v_texcoord);
if (isOutside(pixelLocation)) {
gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
return;
}
vec4 currentPixel = getPixel(pixelLocation);
gl_FragColor = colormap(currentPixel, true);
}`)}function h(e,t){e.fragment.uniforms.add("u_bandCount","int"),e.fragment.uniforms.add("u_minCutOff","float",3),e.fragment.uniforms.add("u_maxCutOff","float",3),e.fragment.uniforms.add("u_factor","float",3),e.fragment.uniforms.add("u_minOutput","float"),e.fragment.uniforms.add("u_maxOutput","float"),e.fragment.uniforms.add("u_useGamma","bool"),e.fragment.uniforms.add("u_gamma","float",3),e.fragment.uniforms.add("u_gammaCorrection","float",3),e.fragment.code.add(o["a"]`float stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {
if (val >= maxCutOff) {
return maxOutput;
} else if (val <= minCutOff) {
return minOutput;
}
float stretchedVal;
if (useGamma) {
float tempf = 1.0;
float outRange = maxOutput - minOutput;
float relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);
if (gamma > 1.0) {
tempf -= pow(1.0 / outRange, relativeVal * gammaCorrection);
}
stretchedVal = (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;
} else {
stretchedVal = minOutput + (val - minCutOff) * factor;
}
return stretchedVal;
}`);const i=t.applyColormap?o["a"]`gl_FragColor = colormap(vec4(grayVal, grayVal, grayVal, currentPixel.a), !u_useGamma);`:o["a"]`gl_FragColor = vec4(grayVal, grayVal, grayVal, 1.0) * currentPixel.a * u_opacity;`;e.fragment.code.add(o["a"]`
      void main() {
        vec2 pixelLocation = getPixelLocation(v_texcoord);
        if (isOutside(pixelLocation)) {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
          return;
        }

        vec4 currentPixel = getPixel(pixelLocation);
        ${0===t.stretchType?o["a"]`
        gl_FragColor = vec4(currentPixel.rgb, 1.0) * currentPixel.a * u_opacity;`:o["a"]`
        if (currentPixel.a == 0.0) {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
          return;
        }
        if (u_bandCount == 1) {
          float grayVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          ${i}
        } else {
          float redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          float greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);
          float blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);
          gl_FragColor = vec4(redVal, greenVal, blueVal, 1.0) * currentPixel.a * u_opacity;
        }`}
      }`)}function u(e,t){e.fragment.uniforms.add("u_hillshadeType","int"),e.fragment.uniforms.add("u_sinZcosAs","float",6),e.fragment.uniforms.add("u_sinZsinAs","float",6),e.fragment.uniforms.add("u_cosZs","float",6),e.fragment.uniforms.add("u_weights","float",6),e.fragment.uniforms.add("u_factor","vec2"),e.fragment.uniforms.add("u_applyColormap","bool"),e.fragment.uniforms.add("u_minValue","float"),e.fragment.uniforms.add("u_maxValue","float"),e.fragment.uniforms.add("u_srcImageSize","vec2"),e.fragment.include(s["a"]),e.fragment.code.add(o["a"]`vec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {
val = clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);
vec4 rgb = colormap(vec4(val, val, val, 1.0), false);
vec3 hsv = rgb2hsv(rgb.xyz);
hsv.z = hillshade;
return vec4(hsv2rgb(hsv) * alpha, alpha);
}`),e.fragment.code.add(o["a"]`float getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){
if (a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0) {
return 0.0;
}  else {
return e;
}
}`);const i=t.applyColormap?o["a"]`gl_FragColor = overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha);`:o["a"]`hillshade *= alpha;
gl_FragColor = vec4(hillshade, hillshade, hillshade, alpha);`;e.fragment.code.add(o["a"]`
    void main() {
      vec2 pixelLocation = getPixelLocation(v_texcoord);
      if (isOutside(pixelLocation)) {
        gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        return;
      }

      vec4 currentPixel = getPixel(pixelLocation);
      if (currentPixel.a == 0.0) {
        gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        return;
      }

      //mirror edge pixels
      vec2 axy = vec2(-1.0, -1.0);
      vec2 bxy = vec2(0.0, -1.0);
      vec2 cxy = vec2(1.0, -1.0);
      vec2 dxy = vec2(-1.0, 0.0);
      vec2 fxy = vec2(1.0, 0.0);
      vec2 gxy = vec2(-1.0, 1.0);
      vec2 hxy = vec2(0.0, 1.0);
      vec2 ixy = vec2(1.0, 1.0);
      vec2 onePixel = 1.0 / u_srcImageSize;
      if (pixelLocation.s < onePixel.s) {
        axy[0] = 1.0;
        dxy[0] = 1.0;
        gxy[0] = 1.0;
      }
      if (pixelLocation.t < onePixel.t) {
        axy[1] = 1.0;
        bxy[1] = 1.0;
        cxy[1] = 1.0;
      }
      if (pixelLocation.s > 1.0 - onePixel.s) {
        cxy[0] = -1.0;
        fxy[0] = -1.0;
        ixy[0] = -1.0;
      }
      if (pixelLocation.t > 1.0 - onePixel.t) {
        gxy[1] = -1.0;
        hxy[1] = -1.0;
        ixy[1] = -1.0;
      }

      // calculate hillshade
      vec4 va = texture2D(u_image, pixelLocation + onePixel * axy);
      vec4 vb = texture2D(u_image, pixelLocation + onePixel * bxy);
      vec4 vc = texture2D(u_image, pixelLocation + onePixel * cxy);
      vec4 vd = texture2D(u_image, pixelLocation + onePixel * dxy);
      vec4 ve = texture2D(u_image, pixelLocation);
      vec4 vf = texture2D(u_image, pixelLocation + onePixel * fxy);
      vec4 vg = texture2D(u_image, pixelLocation + onePixel * gxy);
      vec4 vh = texture2D(u_image, pixelLocation + onePixel * hxy);
      vec4 vi = texture2D(u_image, pixelLocation + onePixel * ixy);

      // calculate the rate of z change along the x, y, and diagonal direction
      float dzx = (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_factor.s;
      float dzy = (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_factor.t;
      float dzd = sqrt(1.0 + dzx * dzx + dzy * dzy);
      float hillshade = 0.0;

      // traditional single light source
      if (u_hillshadeType == 0){
        float cosDelta = u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;
        float z = (u_cosZs[0] + cosDelta) / dzd;
        if (z < 0.0)  z = 0.0;
        hillshade = z;
      } else {
        // multi-directional with 6 light sources
        for (int k = 0; k < 6; k++) {
        float cosDelta = u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;
        float z = (u_cosZs[k] + cosDelta) / dzd;
        if (z < 0.0) z = 0.0;
        hillshade = hillshade + z * u_weights[k];
        if (k == 5) break;
        }
      }

      // set color
      float alpha = getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);
      alpha *= u_opacity;
      ${i}
    }
  `)}const p=Object.freeze({__proto__:null,build:l})},f895:function(e,t,i){"use strict";i.d(t,"a",(function(){return y})),i.d(t,"b",(function(){return m})),i.d(t,"c",(function(){return b})),i.d(t,"d",(function(){return D})),i.d(t,"e",(function(){return T})),i.d(t,"f",(function(){return j})),i.d(t,"g",(function(){return x})),i.d(t,"h",(function(){return M})),i.d(t,"i",(function(){return P})),i.d(t,"j",(function(){return O})),i.d(t,"k",(function(){return g})),i.d(t,"l",(function(){return _})),i.d(t,"m",(function(){return B})),i.d(t,"n",(function(){return v}));i("c120");var r=i("e92d"),n=i("38a4"),a=i("b2b2"),s=i("d791"),o=i("e431"),c=i("0b2d"),l=i("7577"),d=i("0fc4"),h=i("d18f"),u=i("a1b1"),p=i("7361");const f=r["a"].getLogger("esri.geometry.support.sphere");function b(){return Object(d["e"])()}function m(e,t=b()){return Object(l["c"])(t,e)}function g(e,t){return Object(d["g"])(e[0],e[1],e[2],t)}function v(e){return e}function y(e){e[0]=e[1]=e[2]=e[3]=0}function O(e){return e}function _(e){return Array.isArray(e)?e[3]:e}function x(e){return Array.isArray(e)?e:k}function j(e,t,i,r){return Object(d["g"])(e,t,i,r)}function w(e,t,i){return e!==i&&Object(o["n"])(i,e),i[3]=e[3]+t,i}function S(e,t,i){return f.error("sphere.setExtent is not yet supported"),e===i?i:m(e,i)}function T(e,t,i){if(Object(a["k"])(t))return!1;const{origin:r,direction:n}=t,s=C;s[0]=r[0]-e[0],s[1]=r[1]-e[1],s[2]=r[2]-e[2];const o=n[0]*n[0]+n[1]*n[1]+n[2]*n[2],c=2*(n[0]*s[0]+n[1]*s[1]+n[2]*s[2]),l=c*c-4*o*(s[0]*s[0]+s[1]*s[1]+s[2]*s[2]-e[3]*e[3]);if(l<0)return!1;const d=Math.sqrt(l);let h=(-c-d)/(2*o);const u=(-c+d)/(2*o);return(h<0||u<h&&u>0)&&(h=u),!(h<0)&&(i&&(i[0]=r[0]+n[0]*h,i[1]=r[1]+n[1]*h,i[2]=r[2]+n[2]*h),!0)}const C=Object(c["f"])();function P(e,t){return T(e,t,null)}function A(e,t,i){if(T(e,t,i))return i;const r=M(e,t,p["d"].get());return Object(o["i"])(i,t.origin,Object(o["h"])(p["d"].get(),t.direction,Object(o["p"])(t.origin,r)/Object(o["s"])(t.direction))),i}function M(e,t,i){const r=p["d"].get(),n=p["a"].get();Object(o["j"])(r,t.origin,t.direction);const a=_(e);Object(o["j"])(i,r,t.origin),Object(o["h"])(i,i,1/Object(o["s"])(i)*a);const c=I(e,t.origin),l=Object(u["a"])(t.origin,i);return Object(s["j"])(n),Object(s["f"])(n,n,l+c,r),Object(o["t"])(i,i,n),i}function R(e,t,i){return T(e,t,i)?i:(Object(h["a"])(t,x(e),i),E(e,i,i))}function E(e,t,i){const r=Object(o["m"])(p["d"].get(),t,x(e)),n=Object(o["h"])(p["d"].get(),r,e[3]/Object(o["s"])(r));return Object(o["i"])(i,n,x(e))}function D(e,t){const i=Object(o["m"])(p["d"].get(),t,x(e)),r=Object(o["w"])(i),n=e[3]*e[3];return Math.sqrt(Math.abs(r-n))}function I(e,t){const i=Object(o["m"])(p["d"].get(),t,x(e)),r=Object(o["s"])(i),a=_(e),s=a+Math.abs(a-r);return Object(n["b"])(a/s)}const F=Object(c["f"])();function z(e,t,i,r){const a=Object(o["m"])(F,t,x(e));switch(i){case 0:{const e=Object(n["e"])(a,F)[2];return Object(o["z"])(r,-Math.sin(e),Math.cos(e),0)}case 1:{const e=Object(n["e"])(a,F),t=e[1],i=e[2],s=Math.sin(t);return Object(o["z"])(r,-s*Math.cos(i),-s*Math.sin(i),Math.cos(t))}case 2:return Object(o["u"])(r,a);default:return}}function L(e,t){const i=Object(o["m"])(U,t,x(e));return Object(o["s"])(i)-e[3]}function V(e,t,i,r){const n=L(e,t),a=z(e,t,2,U),s=Object(o["h"])(U,a,i-n);return Object(o["i"])(r,t,s)}const k=Object(c["f"])(),U=Object(c["f"])(),B=Object.freeze({__proto__:null,create:b,copy:m,fromCenterAndRadius:g,wrap:v,clear:y,fromRadius:O,getRadius:_,getCenter:x,fromValues:j,elevate:w,setExtent:S,intersectRay:T,intersectsRay:P,intersectRayClosestSilhouette:A,closestPointOnSilhouette:M,closestPoint:R,projectPoint:E,distanceToSilhouette:D,angleToSilhouette:I,axisAt:z,altitudeAt:L,setAltitudeAt:V})},f9d0:function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));class r{constructor(){this._outer=new Map}clear(){this._outer.clear()}get empty(){return 0===this._outer.size}get(e,t){var i;return null==(i=this._outer.get(e))?void 0:i.get(t)}set(e,t,i){const r=this._outer.get(e);r?r.set(t,i):this._outer.set(e,new Map([[t,i]]))}delete(e,t){const i=this._outer.get(e);i&&(i.delete(t),0===i.size&&this._outer.delete(e))}forEach(e){this._outer.forEach((t,i)=>e(t,i))}}},fa1e:function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));const r=new Map([["position",0],["normal",1],["uv0",2],["color",3],["size",4],["tangent",4],["auxpos1",5],["symbolColor",5],["auxpos2",6],["featureAttribute",6],["instanceFeatureAttribute",6],["instanceColor",7],["model",8],["modelNormal",12],["modelOriginHi",11],["modelOriginLo",15]])},fc00:function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var r=i("8190"),n=i("c6ac");class a{constructor(e,t){this.layout=e,this.buffer="number"==typeof t?new ArrayBuffer(t*e.stride):t;for(const i of e.fieldNames){const t=e.fields.get(i);this[i]=new t.constructor(this.buffer,t.offset,this.stride)}}get stride(){return this.layout.stride}get count(){return this.buffer.byteLength/this.stride}get byteLength(){return this.buffer.byteLength}getField(e,t){const i=this[e];return i&&i.elementCount===t.ElementCount&&i.elementType===t.ElementType?i:null}slice(e,t){return new a(this.layout,this.buffer.slice(e*this.stride,t*this.stride))}copyFrom(e,t,i,r){const n=this.stride;if(n%4==0){const a=new Uint32Array(e.buffer,t*n,r*n/4);new Uint32Array(this.buffer,i*n,r*n/4).set(a)}else{const a=new Uint8Array(e.buffer,t*n,r*n);new Uint8Array(this.buffer,i*n,r*n).set(a)}}}class s{constructor(){this.stride=0,this.fields=new Map,this.fieldNames=[]}vec2f(e,t){return this.appendField(e,r["m"],t),this}vec2f64(e,t){return this.appendField(e,r["n"],t),this}vec3f(e,t){return this.appendField(e,r["u"],t),this}vec3f64(e,t){return this.appendField(e,r["v"],t),this}vec4f(e,t){return this.appendField(e,r["C"],t),this}vec4f64(e,t){return this.appendField(e,r["D"],t),this}mat3f(e,t){return this.appendField(e,r["f"],t),this}mat3f64(e,t){return this.appendField(e,r["g"],t),this}mat4f(e,t){return this.appendField(e,r["h"],t),this}mat4f64(e,t){return this.appendField(e,r["i"],t),this}vec4u8(e,t){return this.appendField(e,r["J"],t),this}f32(e,t){return this.appendField(e,r["a"],t),this}f64(e,t){return this.appendField(e,r["b"],t),this}u8(e,t){return this.appendField(e,r["l"],t),this}u16(e,t){return this.appendField(e,r["j"],t),this}i8(e,t){return this.appendField(e,r["e"],t),this}vec2i8(e,t){return this.appendField(e,r["q"],t),this}vec2i16(e,t){return this.appendField(e,r["o"],t),this}vec2u8(e,t){return this.appendField(e,r["t"],t),this}vec4u16(e,t){return this.appendField(e,r["H"],t),this}u32(e,t){return this.appendField(e,r["k"],t),this}appendField(e,t,i){const r=t.ElementCount*Object(n["a"])(t.ElementType),a=this.stride;this.fields.set(e,{size:r,constructor:t,offset:a,optional:i}),this.stride+=r,this.fieldNames.push(e)}alignTo(e){return this.stride=Math.floor((this.stride+e-1)/e)*e,this}hasField(e){return this.fieldNames.indexOf(e)>=0}createBuffer(e){return new a(this,e)}createView(e){return new a(this,e)}clone(){const e=new s;return e.stride=this.stride,e.fields=new Map,this.fields.forEach((t,i)=>e.fields.set(i,t)),e.fieldNames=this.fieldNames.slice(),e.BufferType=this.BufferType,e}}function o(){return new s}},fcb1:function(e,t,i){"use strict";i.d(t,"a",(function(){return l})),i.d(t,"b",(function(){return c}));var r=i("dfaf"),n=i("d047"),a=i("f159"),s=i("3886"),o=i("690a");function c(e){const t=new o["a"];return t.attributes.add("position","vec2"),t.include(r["a"],{attributeTextureCoordinates:1}),t.varyings.add("worldRay","vec3"),t.varyings.add("eyeDir","vec3"),t.vertex.uniforms.add("projectionInverse","mat4"),t.vertex.uniforms.add("viewInverse","mat4"),t.vertex.code.add(s["a"]`void main(void) {
vec3 posViewNear = (projectionInverse * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (viewInverse * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),t.fragment.uniforms.add("lightingMainDirection","vec3").add("radii","vec2").add("scaleHeight","float").add("cameraPosition","vec3").add("nearFar","vec2").add("heightParameters","vec4").add("innerFadeDistance","float").add("altitudeFade","float").add("depthTex","sampler2D").add("betaRayleigh","vec3").add("betaCombined","vec3").add("betaMie","float").add("hazeStrength","float"),t.include(a["a"]),e.haze&&t.fragment.include(n["a"]),t.fragment.code.add(s["a"]`vec2 sphereIntersect(vec3 start, vec3 dir, float radius, bool planet) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = planet ? heightParameters[1] - radius * radius : heightParameters[2];
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),t.fragment.code.add(s["a"]`float chapmanApproximation(float X, float h, float cosZenith) {
float c = sqrt(X + h);
float cExpH = c * exp(-h);
if (cosZenith >= 0.0) {
return cExpH / (c * cosZenith + 1.0);
} else {
float x0 = sqrt(1.0 - cosZenith * cosZenith) * (X + h);
float c0 = sqrt(x0);
return 2.0 * c0 * exp(X - x0) - cExpH / (1.0 - c * cosZenith);
}
}`),t.fragment.code.add(s["a"]`float getOpticalDepth(vec3 position, vec3 dir, float h) {
return scaleHeight * chapmanApproximation(radii[0] / scaleHeight, h, dot(normalize(position), dir));
}`),t.fragment.code.add(s["a"]`
    const int STEPS = 6;

    float getGlow(float dist, float radius, float intensity) {
      return pow(radius / max(dist, 1e-6), intensity);
    }

    vec3 getAtmosphereColour(vec3 cameraPos, vec3 rayDir, vec3 lightDir, float terrainDepth) {
      float reducedPlanetRadius = radii[0] - 20000.0;
      vec2 rayPlanetIntersect = sphereIntersect(cameraPos, rayDir, reducedPlanetRadius, true);
      vec2 rayAtmosphereIntersect = sphereIntersect(cameraPos, rayDir, radii[1], false);
      bool hitsAtmosphere = (rayAtmosphereIntersect.x <= rayAtmosphereIntersect.y) && rayAtmosphereIntersect.x > 0.0;
      bool insideAtmosphere = heightParameters[0] < radii[1];

      if (!(hitsAtmosphere || insideAtmosphere)) {
        return vec3(0);
      }

      bool hitsPlanet = (rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.x > 0.0;

      float start = insideAtmosphere ? 0.0 : rayAtmosphereIntersect.x;

      if (heightParameters[0] < reducedPlanetRadius) {
        // Long light rays from the night side of the planet lead to numerical instability
        // Do not render the atmosphere in such cases
        if (dot(rayDir, normalize(cameraPos)) < -0.025) {
          return vec3(0);
        }
        start = rayPlanetIntersect.y;
      }

      float end = hitsPlanet ? rayPlanetIntersect.x : rayAtmosphereIntersect.y;
      float maxEnd = end;

      ${e.haze?s["a"]`if (terrainDepth != -1.0) { end = terrainDepth; }`:""}

      vec3 samplePoint = cameraPos + rayDir * end;
      float multiplier = hitsPlanet ? -1.0 : 1.0;

      vec3 scattering = vec3(0);
      float scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
      float lastOpticalDepth = getOpticalDepth(samplePoint, rayDir, scaleFract);
      float stepSize = (end - start) / float(STEPS);
      for (int i = 0; i < STEPS; i++) {
        samplePoint -= stepSize * rayDir;
        scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
        float opticalDepth = multiplier * getOpticalDepth(samplePoint, rayDir * multiplier, scaleFract);

        if (i > 0) {
          scattering *= ${e.haze?s["a"]``:" mix(2.5, 1.0, clamp((length(cameraPos) - radii[0]) / 50e3, 0.0, 1.0)) * "} exp(-(mix(betaCombined, betaRayleigh, 0.5) + betaMie) * max(0.0, (opticalDepth - lastOpticalDepth)));
        }

        if (dot(normalize(samplePoint), lightDir) > -0.3) {

          float scale = exp(-scaleFract);
          float lightDepth = getOpticalDepth(samplePoint, lightDir, scaleFract);

          scattering += scale * exp(-(betaCombined + betaMie) * lightDepth);
          ${e.haze?"":s["a"]`scattering += scale * exp(-(0.25 * betaCombined ) * lightDepth);`}
        }

        lastOpticalDepth = opticalDepth;

      }

      float mu = dot(rayDir, lightDir);
      float mumu = 1.0 + mu * mu;

      float phaseRayleigh = 0.05968310365 * mumu;

      ${e.haze?s["a"]`return 3.0 * scattering * stepSize * phaseRayleigh * betaRayleigh;`:s["a"]`
            const float g = 0.8;
            const float gg = g * g;
            float phaseMie = end == maxEnd ? 0.11936620731 * ((1.0 - gg) * mumu) / (pow(1.0 + gg - 2.0 * mu * g, 1.5) * (2.0 + gg)) : 0.0;
            phaseMie += getGlow(1.0 - mu, 5e-5, 3.0) * smoothstep(0.01, 0.1, length(scattering));
            phaseMie = clamp(phaseMie, 0.0, 128.0);
            return 3.0 * scattering * stepSize * (phaseRayleigh * betaRayleigh + 0.025 * phaseMie * betaMie);`}
    }

    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    vec4 applyUndergroundAtmosphere(vec3 rayDir, vec3 lightDirection, vec4 fragColor) {
      vec2 rayPlanetIntersect = sphereIntersect(cameraPosition, rayDir, radii[0], true);
      if (!((rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.y > 0.0)) {
        return fragColor;
      }

      float lightAngle = dot(lightDirection, normalize(cameraPosition + rayDir * max(0.0, rayPlanetIntersect.x)));
      vec4 surfaceColor = vec4(vec3(max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)))), 1.0 - altitudeFade);
      float relDist = (rayPlanetIntersect.y - max(0.0, rayPlanetIntersect.x)) / innerFadeDistance;
      if (relDist > 1.0) {
        return surfaceColor;
      }

      return mix(gl_FragColor, surfaceColor, smoothstep(0.0, 1.0, relDist * relDist));
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;
      ${e.haze?s["a"]`
          vec4 depthSample = texture2D(depthTex, vuv0).rgba;
          if (depthSample != vec4(0)) {
            vec3 cameraSpaceRay = normalize(eyeDir);
            cameraSpaceRay /= cameraSpaceRay.z;
            cameraSpaceRay *= -linearDepthFromTexture(depthTex, vuv0, nearFar);
            terrainDepth = max(0.0, length(cameraSpaceRay));
          }`:s["a"]`
          float depthSample = texture2D(depthTex, vuv0).r;
          if (depthSample != 1.0) {
            gl_FragColor = vec4(0);
            return;
          }`}

      ${e.haze?s["a"]`
            vec3 col = vec3(0);
            float fadeOut = smoothstep(-10000.0, -15000.0, heightParameters[0] - radii[0]);
            if(depthSample != vec4(0)){
              col = (1.0 - fadeOut) * hazeStrength * getAtmosphereColour(cameraPosition, rayDir, lightingMainDirection, terrainDepth);
            }
            float alpha = 1.0 - fadeOut;`:s["a"]`
            vec3 col = getAtmosphereColour(cameraPosition, rayDir, lightingMainDirection, terrainDepth);;
            float alpha = smoothstep(0.0, mix(0.15, 0.01, heightParameters[3]), length(col));`}
      col = tonemapACES(col);
      gl_FragColor = delinearizeGamma(vec4(col, alpha));
      ${e.haze?"":s["a"]`
          if (depthSample == 1.0) {
            gl_FragColor = applyUndergroundAtmosphere(rayDir, lightingMainDirection, gl_FragColor);
          }`}
    }
  `),t}const l=Object.freeze({__proto__:null,build:c})},fdc9:function(e,t,i){"use strict";i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return s}));var r=i("8a44");class n{constructor(){this.adds=new r["a"],this.removes=new r["a"],this.updates=new r["a"]({allocator:e=>e||new a,deallocator:e=>(e.renderGeometry=null,e)})}clear(){this.adds.clear(),this.removes.clear(),this.updates.clear()}prune(){this.adds.prune(),this.removes.prune(),this.updates.prune()}}class a{}class s{constructor(){this.adds=new Array,this.removes=new Array,this.updates=new Array}}}}]);