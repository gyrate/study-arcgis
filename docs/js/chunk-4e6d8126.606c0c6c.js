(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4e6d8126"],{"002c":function(e,t,i){"use strict";i.d(t,"a",(function(){return y}));var n=i("b2b2"),r=i("38a4"),s=i("0b2d"),o=i("e431"),a=i("8188"),c=i("0fc4"),l=i("7577"),h=i("4261"),d=i("f091"),p=i("caf7"),u=i("2df1"),f=i("2e0f"),b=i("0eb9"),g=i("a6c9"),m=i("1e2c"),v=i("dd63");class y{constructor(e){this.view=null,this._geometry=null,this._size=3,this._color=Object(c["d"])(1,0,1,1),this._pixelSnappingEnabled=!0,this._primitive="square",this._outlineSize=1,this._outlineColor=Object(c["d"])(1,1,1,1),this._elevationInfo=null,this.resources=new v["a"]({view:e.view,createResources:e=>this.createResources(e),recreateGeometry:(e,t)=>(e.geometry=this.recreateGeometry(t,e.material),Object(n["k"])(e.geometry)?[e.geometry]:[])});let t=!0;for(const i in e)i in this?"attached"===i?t=e[i]:this[i]=e[i]:console.error("Cannot set unknown property",i);this.attached=t}destroy(){this.resources.destroy()}get visible(){return this.resources.visible}set visible(e){this.resources.visible=e}get attached(){return this.resources.attached}set attached(e){this.resources.attached=e}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.resources.recreateGeometry()}get size(){return this._size}set size(e){if(e!==this._size){const t=this.preferredTextureSize;this._size=e,t<this.preferredTextureSize?Object(n["k"])(this.resources)&&this.resources.recreate():this.updateSizeAttribute()}}get color(){return this._color}set color(e){Object(l["g"])(e,this._color)||(Object(l["c"])(this._color,e),this.updateMaterial())}get pixelSnappingEnabled(){return this._pixelSnappingEnabled}set pixelSnappingEnabled(e){this._pixelSnappingEnabled!==e&&(this._pixelSnappingEnabled=e,this.updateMaterial())}get primitive(){return this._primitive}set primitive(e){this._primitive!==e&&(this._primitive=e,Object(n["k"])(this.resources)&&this.resources.recreate())}get outlineSize(){return this._outlineSize}set outlineSize(e){e!==this._outlineSize&&(this._outlineSize=e,this.updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(e){Object(l["g"])(e,this._outlineColor)||(Object(l["c"])(this._outlineColor,e),this.updateMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.resources&&this.resources.recreateGeometry()}updateMaterial(){const e=this.resources.resources;Object(n["j"])(e)||e.material.setParameterValues(this.materialParameters(e.texture.id))}updateSizeAttribute(){const e=this.resources.resources,t=this.resources.object;if(Object(n["j"])(e)||Object(n["j"])(t))return;const i=e.geometry;if(Object(n["j"])(i))return;const r=i.getMutableAttribute("size").data,s=this.geometrySize;r[0]=s,r[1]=s,t.geometryVertexAttrsUpdated(0)}materialParameters(e){return{color:this._color,textureIsSignedDistanceField:!0,distanceFieldBoundingBox:O,occlusionTest:!1,outlineColor:this._outlineColor,outlineSize:this._outlineSize,textureId:e,polygonOffset:!1,shaderPolygonOffset:0,drawInSecondSlot:!0,depthEnabled:!1,pixelSnappingEnabled:this.pixelSnappingEnabled}}get geometrySize(){return this._size/_}recreateGeometry(e,t){const i=this.createRenderGeometry();return Object(n["k"])(i)&&e.addGeometry(i,t),i}createResources(e){const t=this.createTexture(),i=new u["a"](this.materialParameters(t.id)),r=this.recreateGeometry(e,i);return{material:i,texture:t,geometry:r,forEach(e){e(t),e(i),Object(n["k"])(this.geometry)&&e(this.geometry)}}}get preferredTextureSize(){return Object(r["d"])(Object(r["o"])(2*this.geometrySize),16,128)}createTexture(){const e=this.preferredTextureSize;return new m["a"](Object(g["f"])(this._primitive,e,e*_),{mipmap:!1,wrap:{s:33071,t:33071},width:e,height:e,components:4,noUnpackFlip:!0})}calculateMapBounds(e){if(Object(n["j"])(this.resources.resources)||Object(n["j"])(this.resources.resources.geometry))return!1;const t=this.resources.resources.geometry.vertexAttributes.get("position");return Object(a["y"])(t.data,this.view.renderCoordsHelper.spatialReference,j,this.view.spatialReference),Object(h["n"])(e,j),!0}createRenderGeometry(){const e=this.geometry;if(Object(n["j"])(e))return null;const{renderCoordsHelper:t,elevationProvider:i}=this.view,r=Object(f["e"])(e,i,b["a"].fromElevationInfo(this.elevationInfo),t),s=Object(o["x"])(d["d"].get(),e.x,e.y,r),c=d["d"].get();Object(a["y"])(s,e.spatialReference,c,t.spatialReference);const l=this.geometrySize;return p["a"].createPointGeometry(null,c,null,[l,l],[0,0,0,1])}}const _=.5,O=[_/2,_/2,1-_/2,1-_/2],j=Object(s["e"])()},"008c":function(e,t,i){"use strict";i.d(t,"a",(function(){return P})),i.d(t,"b",(function(){return x})),i.d(t,"c",(function(){return a})),i.d(t,"d",(function(){return C})),i.d(t,"e",(function(){return T})),i.d(t,"f",(function(){return E})),i.d(t,"g",(function(){return A}));var n=i("a9ab");const r=(e,t,i)=>[t,i],s=(e,t,i)=>[t,i,e[2]],o=(e,t,i)=>[t,i,e[2],e[3]];function a(e){return e?{originPosition:"upper-left"===e.originPosition?"upperLeft":"lower-left"===e.originPosition?"lowerLeft":e.originPosition,scale:e.tolerance?[e.tolerance,e.tolerance]:[1,1],translate:e.extent?[e.extent.xmin,e.extent.ymax]:[0,0]}:null}function c({scale:e,translate:t},i){return Math.round((i-t[0])/e[0])}function l({scale:e,translate:t},i){return Math.round((t[1]-i)/e[1])}function h(e,t,i){const n=[];let r,s,o,a;for(let h=0;h<i.length;h++){const d=i[h];h>0?(o=c(e,d[0]),a=l(e,d[1]),o===r&&a===s||(n.push(t(d,o-r,a-s)),r=o,s=a)):(r=c(e,d[0]),s=l(e,d[1]),n.push(t(d,r,s)))}return n.length>0?n:null}function d(e,t,i,n){return h(e,i?n?o:s:n?s:r,t)}function p(e,t,i,n){const a=[],c=i?n?o:s:n?s:r;for(let r=0;r<t.length;r++){const i=h(e,c,t[r]);i&&i.length>=3&&a.push(i)}return a.length?a:null}function u(e,t,i,n){const a=[],c=i?n?o:s:n?s:r;for(let r=0;r<t.length;r++){const i=h(e,c,t[r]);i&&i.length>=2&&a.push(i)}return a.length?a:null}function f({scale:e,translate:t},i){return i*e[0]+t[0]}function b({scale:e,translate:t},i){return t[1]-i*e[1]}function g(e,t,i){const n=new Array(i.length);if(!i.length)return n;const[r,s]=e.scale;let o=f(e,i[0][0]),a=b(e,i[0][1]);n[0]=t(i[0],o,a);for(let c=1;c<i.length;c++){const e=i[c];o+=e[0]*r,a-=e[1]*s,n[c]=t(e,o,a)}return n}function m(e,t,i){const n=new Array(i.length);for(let r=0;r<i.length;r++)n[r]=g(e,t,i[r]);return n}function v(e,t,i,n){return g(e,i?n?o:s:n?s:r,t)}function y(e,t,i,n){return m(e,i?n?o:s:n?s:r,t)}function _(e,t,i,n){return m(e,i?n?o:s:n?s:r,t)}function O(e,t,i,n,r){return t.xmin=c(e,i.xmin),t.ymin=l(e,i.ymin),t.xmax=c(e,i.xmax),t.ymax=l(e,i.ymax),t!==i&&(n&&(t.zmin=i.zmin,t.zmax=i.zmax),r&&(t.mmin=i.mmin,t.mmax=i.mmax)),t}function j(e,t,i,n,r){return t.points=d(e,i.points,n,r),t}function x(e,t,i,n,r){return t.x=c(e,i.x),t.y=l(e,i.y),t!==i&&(n&&(t.z=i.z),r&&(t.m=i.m)),t}function w(e,t,i,n,r){const s=p(e,i.rings,n,r);return s?(t.rings=s,t):null}function S(e,t,i,n,r){const s=u(e,i.paths,n,r);return s?(t.paths=s,t):null}function P(e,t){return e&&t?Object(n["f"])(t)?x(e,{},t,!1,!1):Object(n["h"])(t)?S(e,{},t,!1,!1):Object(n["g"])(t)?w(e,{},t,!1,!1):Object(n["e"])(t)?j(e,{},t,!1,!1):Object(n["d"])(t)?O(e,{},t,!1,!1):null:null}function C(e,t,i,n,r){return t.points=v(e,i.points,n,r),t}function T(e,t,i,n,r){return t.x=f(e,i.x),t.y=b(e,i.y),t!==i&&(n&&(t.z=i.z),r&&(t.m=i.m)),t}function E(e,t,i,n,r){return t.rings=_(e,i.rings,n,r),t}function A(e,t,i,n,r){return t.paths=y(e,i.paths,n,r),t}},"025c":function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return c}));var n=i("b2b2"),r=i("a915"),s=i("f408"),o=i("1a54");class a{constructor(e,t,i,n=null){this.elevationInfo=e,this.defaultZ=t,this.view=i,this.excludeGraphics=n}screenToMap(e){if(Object(n["k"])(this.defaultZ))return this.view.sceneIntersectionHelper.intersectElevationFromScreen(Object(r["g"])(e.x,e.y),this.elevationInfo,this.defaultZ,this.excludeGraphics);const t=this.view.sceneIntersectionHelper.intersectElevationFromScreen(Object(r["g"])(e.x,e.y),this.elevationInfo,0,this.excludeGraphics);return Object(n["k"])(t)&&(t.z=void 0),t}mapToScreen(e){const t=Object(o["k"])(e.x,e.y,Object(s["a"])(this.view,e,this.elevationInfo),e.spatialReference);return this.view.toScreen(t)}}class c{constructor(e,t,i=[]){this.view=e,this.elevationInfo=t,this.exclude=i}screenToMap(e){const t=this.view.toMap(e,{exclude:this.exclude});return Object(n["k"])(t)&&(t.z=Object(s["f"])(t,this.view,this.elevationInfo)),t}mapToScreen(e){let t=e;return Object(n["k"])(this.elevationInfo)&&(t=Object(o["k"])(e.x,e.y,Object(s["a"])(this.view,e,this.elevationInfo),e.spatialReference)),this.view.toScreen(t)}}},"057f":function(e,t,i){var n=i("fc6a"),r=i("241c").f,s={}.toString,o="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],a=function(e){try{return r(e)}catch(t){return o.slice()}};e.exports.f=function(e){return o&&"[object Window]"==s.call(e)?a(e):r(n(e))}},"06c5":function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));i("fb6a"),i("d3b7"),i("b0c0"),i("a630"),i("3ca3");var n=i("6b75");function r(e,t){if(e){if("string"===typeof e)return Object(n["a"])(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?Object(n["a"])(e,t):void 0}}},"0bde":function(e,t,i){"use strict";var n=i("b2b2"),r=i("ecd7"),s=i("8a44"),o=i("0b2d"),a=i("e431"),c=i("d0ac"),l=i("1153");class h{constructor(e,t){this._objectToBoundingSphere=e,this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._root=new d,this._objectCount=0,t&&(void 0!==t.maximumObjectsPerNode&&(this._maximumObjectsPerNode=t.maximumObjectsPerNode),void 0!==t.maximumDepth&&(this._maximumDepth=t.maximumDepth))}get bounds(){return this._root.bounds}get halfSize(){return this._root.halfSize}get root(){return this._root.node}get maximumObjectsPerNode(){return this._maximumObjectsPerNode}get maximumDepth(){return this._maximumDepth}get objectCount(){return this._objectCount}destroy(){this._degenerateObjects.clear(),d.clearPool(),w[0]=null,A.prune(),I.prune()}add(e,t=e.length){this._objectCount+=t,this._grow(e,t);const i=d.acquire();for(let n=0;n<t;n++){const t=e[n];this._isDegenerate(t)?this._degenerateObjects.add(t):(i.init(this._root),this._add(t,i))}d.release(i)}remove(e,t=null){this._objectCount-=e.length;const i=d.acquire();for(const r of e){const e=Object(n["k"])(t)?t:c["h"].copy(this._objectToBoundingSphere(r),M);_(e[3])?(i.init(this._root),this._remove(r,e,i)):this._degenerateObjects.delete(r)}d.release(i),this._shrink()}update(e,t){if(!_(t[3])&&this._isDegenerate(e))return;const i=S(e);this.remove(i,t),this.add(i)}forEachAlongRay(e,t,i){const n=c["g"].wrap(e,t);this._forEachNode(this._root,e=>{if(!this._intersectsNode(n,e))return!1;const t=e.node;return t.terminals.forAll(e=>{this._intersectsObject(n,e)&&i(e)}),null!==t.residents&&t.residents.forAll(e=>{this._intersectsObject(n,e)&&i(e)}),!0})}forEachAlongRayWithVerticalOffset(e,t,i,n){const r=c["g"].wrap(e,t);this._forEachNode(this._root,e=>{if(!this._intersectsNodeWithOffset(r,e,n))return!1;const t=e.node;return t.terminals.forAll(e=>{this._intersectsObjectWithOffset(r,e,n)&&i(e)}),null!==t.residents&&t.residents.forAll(e=>{this._intersectsObjectWithOffset(r,e,n)&&i(e)}),!0})}forEach(e){this._forEachNode(this._root,t=>{const i=t.node;return i.terminals.forAll(e),null!==i.residents&&i.residents.forAll(e),!0}),this._degenerateObjects.forEach(e)}forEachDegenerateObject(e){this._degenerateObjects.forEach(e)}findClosest(e,t,i,n,r){return this._findClosest(e,"front-to-back"===t?1:-1,i,n,r)}forEachInDepthRange(e,t,i,n,r,s,o,a){this._forEachInDepthRange(e,t,"front-to-back"===i?1:-1,n,r,s,o,a)}forEachNode(e){this._forEachNode(this._root,t=>e(t.node,t.bounds,t.halfSize))}_intersectsNode(e,t){return f(t.bounds,2*-t.halfSize,T),f(t.bounds,2*t.halfSize,E),Object(l["k"])(e.origin,e.direction,T,E)}_intersectsNodeWithOffset(e,t,i){return f(t.bounds,2*-t.halfSize,T),f(t.bounds,2*t.halfSize,E),i.applyToMinMax(T,E),Object(l["k"])(e.origin,e.direction,T,E)}_intersectsObject(e,t){const i=this._objectToBoundingSphere(t);return!(i[3]>0)||c["h"].intersectsRay(i,e)}_intersectsObjectWithOffset(e,t,i){const n=this._objectToBoundingSphere(t);return!(n[3]>0)||c["h"].intersectsRay(i.applyToBoundingSphere(n),e)}_forEachNode(e,t){let i=d.acquire().init(e);const n=[i];for(;0!==n.length;){if(i=n.pop(),t(i)&&!i.isLeaf())for(let e=0;e<i.node.children.length;e++)i.node.children[e]&&n.push(d.acquire().init(i).advance(e));d.release(i)}}_forEachNodeDepthOrdered(e,t,i,n=1){let r=d.acquire().init(e);const s=[r];for(m(i,n,R);0!==s.length;){if(r=s.pop(),t(r)&&!r.isLeaf())for(let e=7;e>=0;--e){const t=R[e];t>=r.node.children.length||r.node.children[t]&&s.push(d.acquire().init(r).advance(t))}d.release(r)}}_findClosest(e,t,i,n,r){let s=1/0,o=1/0,l=null;const h=v(e,t);let d=0;const p=r=>{if(++d,n&&!n(r))return;const a=this._objectToBoundingSphere(r);if(i&&b(a,i))return;const h=y(e,t,c["h"].getCenter(a)),p=h-a[3],u=h+a[3];p<s&&(s=p,o=u,l=r)};return this._forEachNodeDepthOrdered(this._root,n=>{if(null!=r&&d>=r)return!1;if(i&&b(n.bounds,i))return!1;if(Object(a["f"])(C,h,n.halfSize),Object(a["g"])(C,C,n.bounds),y(e,t,C)>o)return!1;const s=n.node;return s.terminals.forAll(e=>{p(e)}),null!==s.residents&&s.residents.forAll(e=>{p(e)}),!0},e,t),l}_forEachInDepthRange(e,t,i,n,r,s,o,l){let h=-1/0,d=1/0;const p={setRange:e=>{1===i?(h=Math.max(h,e.near),d=Math.min(d,e.far)):(h=Math.max(h,-e.far),d=Math.min(d,-e.near))}};p.setRange(n);const u=y(t,i,e),f=v(t,i),g=v(t,-1*i);let m=0;const _=e=>{if(++m,o&&!o(e))return;const n=this._objectToBoundingSphere(e),a=c["h"].getCenter(n),l=y(t,i,a)-u,f=l-n[3],g=l+n[3];f>d||g<h||s&&b(n,s)||r(e,p)};this._forEachNodeDepthOrdered(this._root,e=>{if(null!=l&&m>=l)return!1;if(s&&b(e.bounds,s))return!1;if(Object(a["f"])(C,f,e.halfSize),Object(a["g"])(C,C,e.bounds),y(t,i,C)-u>d)return!1;if(Object(a["f"])(C,g,e.halfSize),Object(a["g"])(C,C,e.bounds),y(t,i,C)-u<h)return!1;const n=e.node;return n.terminals.forAll(e=>{_(e)}),null!==n.residents&&n.residents.forAll(e=>{_(e)}),!0},t,i)}_remove(e,t,i){A.clear();const n=i.advanceTo(t,(e,t)=>{A.push(e.node),A.push(t)})?i.node.terminals:i.node.residents;if(n.removeUnordered(e),0===n.length)for(let r=A.length-2;r>=0;r-=2){const e=A.data[r],t=A.data[r+1];if(!this._purge(e,t))break}}_nodeIsEmpty(e){if(0!==e.terminals.length)return!1;if(null!==e.residents)return 0===e.residents.length;for(let t=0;t<e.children.length;t++)if(e.children[t])return!1;return!0}_purge(e,t){return t>=0&&(e.children[t]=null),!!this._nodeIsEmpty(e)&&(null===e.residents&&(e.residents=new s["a"]({shrink:!0})),!0)}_add(e,t){t.advanceTo(this._objectToBoundingSphere(e))?t.node.terminals.push(e):(t.node.residents.push(e),t.node.residents.length>this._maximumObjectsPerNode&&t.depth<this._maximumDepth&&this._split(t))}_split(e){const t=e.node.residents;e.node.residents=null;for(let i=0;i<t.length;i++){const n=d.acquire().init(e);this._add(t.getItemAt(i),n),d.release(n)}}_grow(e,t){if(0!==t&&(g(e,t,e=>this._objectToBoundingSphere(e),k),_(k[3])&&!this._fitsInsideTree(k)))if(this._nodeIsEmpty(this._root.node))c["h"].copy(k,this._root.bounds),this._root.halfSize=1.25*k[3];else{const e=this._rootBoundsForRootAsSubNode(k);this._placingRootViolatesMaxDepth(e)?this._rebuildTree(k,e):this._growRootAsSubNode(e),d.release(e)}}_rebuildTree(e,t){Object(a["l"])(V,t.bounds),V[3]=t.halfSize,g([e,V],2,e=>e,D);const i=d.acquire().init(this._root);this._root.initFrom(null,D,1.25*D[3]),this._forEachNode(i,e=>(this.add(e.node.terminals.data,e.node.terminals.length),null!==e.node.residents&&this.add(e.node.residents.data,e.node.residents.length),!0)),d.release(i)}_placingRootViolatesMaxDepth(e){const t=Math.log(e.halfSize/this._root.halfSize)*Math.LOG2E;let i=0;return this._forEachNode(this._root,e=>(i=Math.max(i,e.depth),i+t<=this._maximumDepth)),i+t>this._maximumDepth}_rootBoundsForRootAsSubNode(e){const t=e[3],i=e;let n=-1/0;const r=this._root.bounds,s=this._root.halfSize;for(let o=0;o<3;o++){const e=r[o]-s-(i[o]-t),a=i[o]+t-(r[o]+s),c=Math.max(0,Math.ceil(e/(2*s))),l=Math.max(0,Math.ceil(a/(2*s)))+1,h=2**Math.ceil(Math.log(c+l)*Math.LOG2E);n=Math.max(n,h),G[o].min=c,G[o].max=l}for(let o=0;o<3;o++){let e=G[o].min,t=G[o].max;const i=(n-(e+t))/2;e+=Math.ceil(i),t+=Math.floor(i);const a=r[o]-s-e*s*2;P[o]=a+(t+e)*s}return P[3]=n*s*x,d.acquire().initFrom(null,P,n*s,0)}_growRootAsSubNode(e){const t=this._root.node;Object(a["l"])(k,this._root.bounds),k[3]=this._root.halfSize,this._root.init(e),e.advanceTo(k,null,!0),e.node.children=t.children,e.node.residents=t.residents,e.node.terminals=t.terminals}_shrink(){for(;;){const e=this._findShrinkIndex();if(-1===e)break;this._root.advance(e),this._root.depth=0}}_findShrinkIndex(){if(0!==this._root.node.terminals.length||this._root.isLeaf())return-1;let e=null;const t=this._root.node.children;let i=0,n=0;for(;n<t.length&&null==e;)i=n++,e=t[i];for(;n<t.length;)if(t[n++])return-1;return i}_isDegenerate(e){return!_(this._objectToBoundingSphere(e)[3])}_fitsInsideTree(e){const t=this._root.bounds,i=this._root.halfSize;return e[3]<=i&&e[0]>=t[0]-i&&e[0]<=t[0]+i&&e[1]>=t[1]-i&&e[1]<=t[1]+i&&e[2]>=t[2]-i&&e[2]<=t[2]+i}}class d{constructor(){this.bounds=c["h"].create(),this.halfSize=0,this.initFrom(null,null,0,0)}init(e){return this.initFrom(e.node,e.bounds,e.halfSize,e.depth)}initFrom(e,t,i,r=this.depth){return this.node=Object(n["k"])(e)?e:d.createEmptyNode(),Object(n["k"])(t)&&c["h"].copy(t,this.bounds),this.halfSize=i,this.depth=r,this}advance(e){let t=this.node.children[e];t||(t=d.createEmptyNode(),this.node.children[e]=t),this.node=t,this.halfSize/=2,this.depth++;const i=O[e];return this.bounds[0]+=i[0]*this.halfSize,this.bounds[1]+=i[1]*this.halfSize,this.bounds[2]+=i[2]*this.halfSize,this.bounds[3]=this.halfSize*x,this}advanceTo(e,t,i=!1){for(;;){if(this.isTerminalFor(e))return t&&t(this,-1),!0;if(this.isLeaf()){if(!i)return t&&t(this,-1),!1;this.node.residents=null}const n=this._childIndex(e);t&&t(this,n),this.advance(n)}}isLeaf(){return null!=this.node.residents}isTerminalFor(e){return e[3]>this.halfSize/2}_childIndex(e){const t=this.bounds;return(t[0]<e[0]?1:0)+(t[1]<e[1]?2:0)+(t[2]<e[2]?4:0)}static createEmptyNode(){return{children:[null,null,null,null,null,null,null,null],terminals:new s["a"]({shrink:!0}),residents:new s["a"]({shrink:!0})}}static acquire(){return d._pool.acquire()}static release(e){d._pool.release(e)}static clearPool(){d._pool.prune()}}function p(e,t){e[0]=Math.min(e[0],t[0]-t[3]),e[1]=Math.min(e[1],t[1]-t[3]),e[2]=Math.min(e[2],t[2]-t[3])}function u(e,t){e[0]=Math.max(e[0],t[0]+t[3]),e[1]=Math.max(e[1],t[1]+t[3]),e[2]=Math.max(e[2],t[2]+t[3])}function f(e,t,i){i[0]=e[0]+t,i[1]=e[1]+t,i[2]=e[2]+t}function b(e,t){return!c["d"].intersectsSphere(t,e)}function g(e,t,i,n){if(1===t){const t=i(e[0]);c["h"].copy(t,n)}else{T[0]=1/0,T[1]=1/0,T[2]=1/0,E[0]=-1/0,E[1]=-1/0,E[2]=-1/0;for(let n=0;n<t;n++){const t=i(e[n]);_(t[3])&&(p(T,t),u(E,t))}Object(a["j"])(n,T,E,.5),n[3]=Math.max(E[0]-T[0],E[1]-T[1],E[2]-T[2])/2}}function m(e,t,i){if(!I.length)for(let n=0;n<8;++n)I.push({index:0,distance:0});for(let n=0;n<8;++n){const i=O[n];I.data[n].index=n,I.data[n].distance=y(e,t,i)}I.sort((e,t)=>e.distance-t.distance);for(let n=0;n<8;++n)i[n]=I.data[n].index}function v(e,t){let i=1/0,n=null;for(let r=0;r<8;++r){const s=y(e,t,j[r]);s<i&&(i=s,n=j[r])}return n}function y(e,t,i){return t*(e[0]*i[0]+e[1]*i[1]+e[2]*i[2])}function _(e){return!isNaN(e)&&e!==-1/0&&e!==1/0&&e>0}d._pool=new r["a"](d);const O=[Object(o["g"])(-1,-1,-1),Object(o["g"])(1,-1,-1),Object(o["g"])(-1,1,-1),Object(o["g"])(1,1,-1),Object(o["g"])(-1,-1,1),Object(o["g"])(1,-1,1),Object(o["g"])(-1,1,1),Object(o["g"])(1,1,1)],j=[Object(o["g"])(-1,-1,-1),Object(o["g"])(-1,-1,1),Object(o["g"])(-1,1,-1),Object(o["g"])(-1,1,1),Object(o["g"])(1,-1,-1),Object(o["g"])(1,-1,1),Object(o["g"])(1,1,-1),Object(o["g"])(1,1,1)],x=Math.sqrt(3),w=[null];function S(e){return w[0]=e,w}const P=c["h"].create(),C=Object(o["e"])(),T=Object(o["e"])(),E=Object(o["e"])(),A=new s["a"],M=c["h"].create(),k=c["h"].create(),V=c["h"].create(),D=c["h"].create(),G=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],I=new s["a"],R=[0,0,0,0,0,0,0,0];t["a"]=h},"0cb9":function(e,t,i){"use strict";i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return a})),i.d(t,"c",(function(){return o}));var n=i("b2b2"),r=i("1a54");class s{constructor(e,t=null,i=0){this.array=e,this.spatialReference=t,this.offset=i}}function o(e){return"array"in e}function a(e,t,i="ground"){if(Object(r["j"])(t))return e.getElevation(t.x,t.y,t.z||0,t.spatialReference,i);if(o(t)){let r=t.offset;return e.getElevation(t.array[r++],t.array[r++],t.array[r]||0,Object(n["u"])(t.spatialReference,e.spatialReference),i)}return e.getElevation(t[0],t[1],t[2]||0,e.spatialReference,i)}},"0d96":function(e,t,i){"use strict";i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return x})),i.d(t,"c",(function(){return y})),i.d(t,"d",(function(){return _}));var n,r=i("02f1"),s=i("0fc4"),o=i("3349"),a=i("3886"),c=i("690a"),l=i("4377"),h=i("7c1d"),d=i("d272"),p=i("2f98"),u=i("d0cb"),f=i("501b"),b=i("7079"),g=i("6a07"),m=i("be24"),v=i("ebd5");function y(e){const t=new c["a"],i=e.signedDistanceFieldEnabled;if(t.include(h["a"]),t.include(u["a"],e),t.include(d["a"],e),6===e.output)return t.include(b["b"],e),t;t.include(p["a"]),t.fragment.include(f["a"]),t.fragment.include(l["a"]),t.include(m["a"],e),t.varyings.add("vcolor","vec4"),t.varyings.add("vtc","vec2"),t.varyings.add("vsize","vec2"),e.binaryHighlightOcclusionEnabled&&t.varyings.add("voccluded","float"),t.vertex.uniforms.add("screenOffset","vec2").add("anchorPos","vec2").add("textureCoordinateScaleFactor","vec2").add("materialColor","vec4"),i&&t.vertex.uniforms.add("outlineColor","vec4"),e.screenSizePerspectiveEnabled&&t.vertex.uniforms.add("screenSizePerspective","vec4"),(e.debugDrawBorder||e.binaryHighlightOcclusionEnabled)&&t.varyings.add("debugBorderCoords","vec4"),t.attributes.add("uv0","vec2"),t.attributes.add("color","vec4"),t.attributes.add("size","vec2"),t.attributes.add("auxpos2","vec4"),t.vertex.code.add(a["a"]`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }
      vec2 inputSize;
      ${e.screenSizePerspectiveEnabled?a["a"]`
      inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
      vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
         `:a["a"]`
      inputSize = size;
      vec2 screenOffsetScaled = screenOffset;`}

      ${e.vvSize?"inputSize *= vvScale(auxpos2).xx;":""}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);

      ${e.occlusionTestEnabled||e.binaryHighlightOcclusionEnabled?"bool visible = testVisibilityHUD(posProj);":""}

      ${e.binaryHighlightOcclusionEnabled?"voccluded = visible ? 0.0 : 1.0;":""}
    `);const n=a["a"]`
      vec2 uv01 = floor(uv0);
      vec2 uv = uv0 - uv01;
      quadOffset.xy = ((uv01 - anchorPos) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;
  `,r=e.pixelSnappingEnabled?i?a["a"]`
  posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:a["a"]`
  posProj += quadOffset;
  if (inputSize.x == size.x) {
    posProj = alignToPixelOrigin(posProj, viewport.zw);
  }`:a["a"]`posProj += quadOffset;`;t.vertex.code.add(a["a"]`
      ${e.occlusionTestEnabled?"if (visible) {":""}
      ${n}
      ${e.vvColor?"vcolor = vvGetColor(auxpos2, vvColorValues, vvColorColors) * materialColor;":"vcolor = color / 255.0 * materialColor;"}

      bool alphaDiscard = vcolor.a < ${a["a"].float(v["c"])};
      ${i?`alphaDiscard = alphaDiscard && outlineColor.a < ${a["a"].float(v["c"])};`:""}
      if (alphaDiscard) {
        // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      } else {
        ${r}
        gl_Position = posProj;
      }

      vtc = uv * textureCoordinateScaleFactor;

      ${e.debugDrawBorder?"debugBorderCoords = vec4(uv01, 1.5 / combinedSize);":""}
      vsize = inputSize;
      ${e.occlusionTestEnabled?a["a"]`} else { vtc = vec2(0.0);
        ${e.debugDrawBorder?"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"}`:""}
    }
    `),t.fragment.uniforms.add("tex","sampler2D"),i&&(t.fragment.uniforms.add("outlineColor","vec4"),t.fragment.uniforms.add("outlineSize","float"));const s=e.debugDrawBorder?a["a"]`(isBorder > 0.0 ? 0.0 : ${a["a"].float(v["b"])})`:a["a"].float(v["b"]),o=a["a"]`
    ${e.debugDrawBorder?a["a"]`
      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`:""}

    ${i?a["a"]`
      vec4 fillPixelColor = vcolor;

      // Attempt to sample texel centers to avoid that thin cross outlines
      // disappear with large symbol sizes.
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041
      const float txSize = 128.0;
      const float texelSize = 1.0 / txSize;
      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture2D(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${s} ||
          fillPixelColor.a + outlinePixelColor.a < ${a["a"].float(v["c"])}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        gl_FragColor = vec4(compositeColor, compositeAlpha);
      } else {
        if (fillAlphaFactor < ${s}) {
          discard;
        }

        gl_FragColor = premultiplyAlpha(fillPixelColor);
      }

      // visualize SDF:
      // gl_FragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:a["a"]`
          vec4 texColor = texture2D(tex, vtc, -0.5);
          if (texColor.a < ${s}) {
            discard;
          }
          gl_FragColor = texColor * premultiplyAlpha(vcolor);
          `}

    ${e.debugDrawBorder?a["a"]`gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder);`:""}
  `;return 7===e.output&&t.fragment.code.add(a["a"]`
      void main() {
        ${o}
        gl_FragColor = vec4(gl_FragColor.a);
      }
      `),0===e.output&&t.fragment.code.add(a["a"]`
    void main() {
      ${o}
      ${e.FrontFacePass?"gl_FragColor.rgb /= gl_FragColor.a;":""}
    }
    `),4===e.output&&(t.include(g["a"]),t.fragment.code.add(a["a"]`
    void main() {
      ${o}
      ${e.binaryHighlightOcclusionEnabled?a["a"]`
          if (voccluded == 1.0) {
            gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);
          } else {
            gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);
          }`:"outputHighlight();"}
    }
    `)),t}function _(e,t=j){return e.textureIsSignedDistanceField?O(e.anchorPos,e.distanceFieldBoundingBox,t):Object(o["c"])(t,e.anchorPos),t}function O(e,t,i){i[0]=e[0]*(t[2]-t[0])+t[0],i[1]=e[1]*(t[3]-t[1])+t[1]}!function(e){function t(e,t,i){e.setUniform4fv("materialColor",t.color),t.textureIsSignedDistanceField&&(t.outlineColor[3]<=0||t.outlineSize<=0?(e.setUniform4fv("outlineColor",s["b"]),e.setUniform1f("outlineSize",0)):(e.setUniform4fv("outlineColor",t.outlineColor),e.setUniform1f("outlineSize",t.outlineSize))),e.setUniform2f("screenOffset",2*t.screenOffset[0]*i,2*t.screenOffset[1]*i),e.setUniform2fv("anchorPos",_(t))}e.bindUniforms=t}(n||(n={}));const j=Object(r["b"])();var x=Object.freeze({__proto__:null,build:y,get HUDMaterial(){return n},calculateAnchorPosForRendering:_})},"0eb9":function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var n=i("b2b2"),r=i("8076"),s=i("e9d6");class o{constructor(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(e){this._unit=e,this._metersPerElevationInfoUnit=Object(r["a"])(e)}reset(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}set offsetMeters(e){this._meterUnitOffset=e,this._renderUnitOffset=0}set offsetElevationInfoUnits(e){this._meterUnitOffset=e*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}addOffsetRenderUnits(e){this._renderUnitOffset+=e}geometryZWithOffset(e,t){const i=this.calculateOffsetRenderUnits(t);return null!=this.featureExpressionInfoContext?i:e+i}calculateOffsetRenderUnits(e){let t=this._meterUnitOffset;const i=this.featureExpressionInfoContext;return null!=i&&(t+=Object(s["e"])(i)*this._metersPerElevationInfoUnit),t/e.unitInMeters+this._renderUnitOffset}setFromElevationInfo(e){this.mode=e.mode,this.unit=Object(r["c"])(e.unit)?e.unit:"meters",this.offsetElevationInfoUnits=Object(n["u"])(e.offset,0)}updateFeatureExpressionInfoContext(e,t,i){if(Object(n["j"])(e))return void(this._featureExpressionInfoContext=null);const r=e&&e.arcade;r&&Object(n["k"])(t)&&Object(n["k"])(i)?(this._featureExpressionInfoContext=Object(s["a"])(e),Object(s["g"])(this._featureExpressionInfoContext,Object(s["d"])(r.modules,t,i))):this._featureExpressionInfoContext=e}static fromElevationInfo(e){const t=new o;return Object(n["k"])(e)&&t.setFromElevationInfo(e),t}}},"0f94":function(e,t,i){"use strict";i.d(t,"a",(function(){return u})),i.d(t,"b",(function(){return p})),i.d(t,"c",(function(){return f})),i.d(t,"d",(function(){return b})),i.d(t,"e",(function(){return a})),i.d(t,"f",(function(){return d})),i.d(t,"g",(function(){return l})),i.d(t,"h",(function(){return h}));var n=i("38a4"),r=i("02f1"),s=i("3349");function o(e,t){return e[0]*t[1]-e[1]*t[0]}function a(e,t,i){const n=(t[0]-e[0])*(i[1]-e[1])-(t[1]-e[1])*(i[0]-e[0]);return Math.abs(n)/Object(s["i"])(t,i)}function c(e,t,i){const n=Object(s["g"])(i,t)/Object(s["q"])(i);return Object(s["a"])(e,i,n)}function l(e,t,i,n,r=i){return Object(s["d"])(m,n,i),Object(s["d"])(y,t,r),c(_,y,m),Object(s["h"])(e,r,_)}function h(e,t,i,n){Object(s["d"])(m,n,i),Object(s["d"])(y,t,i);const r=Object(s["g"])(m,y)/Object(s["q"])(m);return r>0?Object(s["p"])(e,i,m,r):Object(s["c"])(e,i)}function d(e,t,i,n){Object(s["d"])(m,t,i);const r=n/Object(s["l"])(m);return Object(s["p"])(e,i,m,r)}function p(e,t){return l(y,t,e.start,e.end),Object(n["g"])(y[0],t[0])&&Object(n["g"])(y[1],t[1])?[Object(r["c"])(t)]:[]}function u(e,t,i){return d(y,i,e,t),Object(n["g"])(y[0],i[0])&&Object(n["g"])(y[1],i[1])?[Object(r["c"])(i)]:[]}function f(e,t){const i=e.start,n=e.end,r=t.start,a=t.end,c=Object(s["d"])(m,n,i),l=Object(s["d"])(v,a,r),h=o(c,l);if(Math.abs(h)<=g)return[];const d=Object(s["d"])(y,i,r),p=o(l,d)/h,u=o(c,d)/h;if(p>=0){if(u>=0||1===t.type)return[Object(s["p"])(_,i,c,p)]}else if(1===e.type&&(u>=0||1===t.type))return[Object(s["p"])(_,i,c,p)];return[]}function b(e,t,i){const n=[],r=Object(s["d"])(m,e.end,e.start),o=Object(s["d"])(v,e.start,t),a=Object(s["q"])(r),c=2*Object(s["g"])(r,o),l=c*c-4*a*(Object(s["q"])(o)-i*i);if(0===l){const t=-c/(2*a);(1===e.type||t>=0)&&n.push(Object(s["p"])(_,e.start,r,t))}else if(l>0){const t=Math.sqrt(l),i=(-c+t)/(2*a);(1===e.type||i>=0)&&n.push(Object(s["p"])(_,e.start,r,i));const o=(-c-t)/(2*a);(1===e.type||o>=0)&&n.push(Object(s["p"])(y,e.start,r,o))}return n}const g=1e-6,m=Object(r["b"])(),v=Object(r["b"])(),y=Object(r["b"])(),_=Object(r["b"])()},"0fa6":function(e,t,i){"use strict";var n=i("b2b2"),r=i("8539");class s{constructor(e,t,i,n,r){this._context=e,this._locations=t,this._layout=i,this._buffers=n,this._indexBuffer=r,this._glName=null,this._initialized=!1,e.instanceCounter.increment(2,this)}get glName(){return this._glName}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get size(){return Object.keys(this._buffers).reduce((e,t)=>e+this._buffers[t].size,this._indexBuffer?this._indexBuffer.size:0)}get layout(){return this._layout}get locations(){return this._locations}dispose(e=!0){if(!this._context)return;const t=this._context.capabilities.vao;if(t&&this._glName&&(t.deleteVertexArray(this._glName),this._glName=null),this._context.getBoundVAO()===this&&this._context.bindVAO(null),e){for(const e in this._buffers)this._buffers[e].dispose(),delete this._buffers[e];this._indexBuffer=Object(n["f"])(this._indexBuffer)}this._context.instanceCounter.decrement(2,this),this._context=null}initialize(){if(this._initialized)return;const e=this._context.capabilities.vao;if(e){const t=e.createVertexArray();e.bindVertexArray(t),this._bindLayout(),e.bindVertexArray(null),this._glName=t}this._initialized=!0}bind(){this.initialize();const e=this._context.capabilities.vao;e?e.bindVertexArray(this.glName):(this._context.bindVAO(null),this._bindLayout())}_bindLayout(){const e=this._buffers,t=!!this._context.capabilities.vao,i=this._layout,n=this._indexBuffer;e||console.error("Vertex buffer dictionary is empty!");const s=this._context.gl;for(const o in e){const t=e[o];t||console.error("Vertex buffer is uninitialized!");const n=i[o];n||console.error("Vertex element descriptor is empty!"),Object(r["a"])(this._context,this._locations,t,n)}n&&(t?s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,n.glName):this._context.bindBuffer(n))}unbind(){this.initialize();const e=this._context.capabilities.vao;e?e.bindVertexArray(null):this._unbindLayout()}_unbindLayout(){const e=this._buffers,t=this._layout;e||console.error("Vertex buffer dictionary is empty!");for(const i in e){const n=e[i];n||console.error("Vertex buffer is uninitialized!");const s=t[i];Object(r["e"])(this._context,this._locations,n,s)}this._indexBuffer&&this._context.unbindBuffer(this._indexBuffer.bufferType)}}t["a"]=s},1381:function(e,t,i){"use strict";i.d(t,"a",(function(){return m}));var n=i("c649"),r=i("4ae5"),s=i("521c"),o=(i("e06a"),i("4cac")),a=i("a915"),c=i("db52"),l=i("4dc9"),h=(i("1fd7"),i("8d60")),d=i("0b2d"),p=i("02f1"),u=i("3349"),f=i("7779"),b=i("c9fb"),g=i("65a7");class m extends g["a"]{visualizeIntersectionPoint(e,t){return this._visualizeSnappingIndicator({geometry:new r["a"]({x:e.intersectionPoint[0],y:e.intersectionPoint[1],spatialReference:t.coordinateHelper.spatialReference}),symbol:_,context:t})}visualizePoint(e,t){return this._visualizeSnappingIndicator({geometry:new r["a"]({x:e.point[0],y:e.point[1],spatialReference:t.coordinateHelper.spatialReference}),symbol:O,context:t})}visualizeLine(e,t){return this._visualizeSnappingIndicator({geometry:new s["a"]({paths:[[e.lineStart,e.lineEnd]],spatialReference:t.coordinateHelper.spatialReference}),symbol:j,context:t})}visualizeParallelSign(e,t){return this._visualizeSnappingIndicator({geometry:new s["a"]({paths:[[e.lineStart,e.lineEnd]],spatialReference:t.coordinateHelper.spatialReference}),symbol:x,context:t})}visualizeRightAngleQuad(e,t){return this._visualizeSnappingIndicator({geometry:new s["a"]({paths:[[e.previousVertex,e.centerVertex,e.nextVertex]],spatialReference:t.coordinateHelper.spatialReference}),symbol:C(e),context:t})}_visualizeSnappingIndicator(e){const{geometry:t,symbol:i,context:r}=e,s=new h["a"]({geometry:t,symbol:i});return r.view.graphics.add(s),Object(n["c"])(()=>{r.view.graphics.remove(s)})}}const v=f["a"].main.toArray(),y=[...f["a"].main.toRgb(),100],_=new l["a"]({outline:new c["a"]({width:1.5,color:v}),size:15,color:[0,0,0,0]}),O=new l["a"]({outline:{width:.5,color:[0,0,0,1]},size:10,color:v}),j=new o["a"]({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",enable:!0,capStyle:"Butt",joinStyle:"Round",miterLimit:10,width:Object(a["i"])(b["a"].lineHintWidthTarget),color:v}]}}}),x=new o["a"]({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,anchorPoint:{x:0,y:-1,z:0},anchorPointUnits:"Relative",size:5,markerPlacement:{type:"CIMMarkerPlacementOnLine",placePerPart:!0,angleToLine:!0,relativeTo:"LineMiddle"},frame:{xmin:-5,ymin:-1.5,xmax:5,ymax:1.5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[7,0],[-7,0],[-7,1.5],[7,1.5]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:v}]}}],scaleSymbolsProportionally:!0,respectFrame:!0},{type:"CIMVectorMarker",enable:!0,anchorPoint:{x:0,y:1,z:0},anchorPointUnits:"Relative",size:5,markerPlacement:{type:"CIMMarkerPlacementOnLine",placePerPart:!0,angleToLine:!0,relativeTo:"LineMiddle"},frame:{xmin:-5,ymin:-1.5,xmax:5,ymax:1.5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[7,0],[-7,0],[-7,-1.5],[7,-1.5]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:v}]}}],scaleSymbolsProportionally:!0,respectFrame:!0}]}}}),w=e=>new o["a"]({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,anchorPoint:{x:.5,y:.5,z:0},anchorPointUnits:"Relative",size:Object(a["i"])(b["a"].rightAngleHintSize),rotation:e,markerPlacement:{type:"CIMMarkerPlacementOnVertices",placePerPart:!0,angleToLine:!0,placeOnEndPoints:!1},frame:{xmin:-5,ymin:-5,xmax:5,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{paths:[[[5,-5],[-5,-5],[-5,5],[5,5],[5,-5]]]},symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",enable:!0,capStyle:"Butt",joinStyle:"Round",miterLimit:10,width:Object(a["i"])(b["a"].rightAngleHintOutlineSize),color:v},{type:"CIMSolidFill",enable:!0,color:y}]}}],scaleSymbolsProportionally:!0,respectFrame:!0}]}}}),S=w(45),P=w(225),C=(()=>{const e=Object(p["b"])(),t=Object(p["b"])(),i=Object(d["e"])();return n=>(Object(u["d"])(e,n.centerVertex,n.previousVertex),Object(u["d"])(t,n.nextVertex,n.previousVertex),Object(u["f"])(i,e,t),i[2]<0?S:P)})()},"157c":function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));var n=i("34f2");class r extends n["a"]{constructor(e,t,i,n){super(e),this.dx=t,this.dy=i,this.dz=n}move(e,t,i,n){this.helper.addDelta(e.pos,t,i,n)}apply(e){this.move(e,this.dx,this.dy,this.dz)}undo(e){this.move(e,-this.dx,-this.dy,-this.dz)}canAccumulate(e){return e instanceof r}accumulate(e,t){this.move(e,t.dx,t.dy,t.dz)}accumulateParams(e){this.dx+=e.dx,this.dy+=e.dy,this.dz+=e.dz}}},1962:function(e,t,i){"use strict";i.d(t,"a",(function(){return b})),i.d(t,"b",(function(){return f}));var n=i("3886"),r=i("4db9"),s=i("690a"),o=i("4377"),a=i("d272"),c=i("d047"),l=i("6a07"),h=i("ebd5"),d=i("c6d7"),p=i("c2d1"),u=i("6d5b");function f(e){const t=new s["a"],i=1===e.output;return t.include(r["a"],{linearDepth:i}),t.include(u["a"],e),t.vertex.uniforms.add("proj","mat4").add("view","mat4"),t.attributes.add("position","vec3"),t.varyings.add("vpos","vec3"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),i&&(t.include(p["a"],e),t.vertex.uniforms.add("cameraNearFar","vec2"),t.varyings.add("linearDepth","float")),t.vertex.code.add(n["a"]`
    void main(void) {
      vpos = position;
      forwardNormalizedVertexColor();
      ${e.multipassTerrainEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = ${i?n["a"]`transformPositionWithDepth(proj, view, vpos, cameraNearFar, linearDepth);`:n["a"]`transformPosition(proj, view, vpos);`}
    }
  `),t.include(a["a"],e),t.fragment.include(o["a"]),e.multipassTerrainEnabled&&(t.fragment.include(c["a"]),t.include(d["b"],e)),t.fragment.uniforms.add("eColor","vec4"),4===e.output&&t.include(l["a"]),t.fragment.code.add(n["a"]`
  void main() {
    discardBySlice(vpos);
    ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
    vec4 color = ${e.attributeColor?"vColor * eColor;":"eColor;"}

    if (color.a < ${n["a"].float(h["c"])}) {
      discard;
    }

    ${7===e.output?n["a"]`gl_FragColor = vec4(color.a);`:""}

    ${0===e.output?n["a"]`gl_FragColor = highlightSlice(color, vpos); ${e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
    ${4===e.output?n["a"]`outputHighlight();`:""};
    ${1===e.output?n["a"]`outputDepth(linearDepth);`:""};
  }
  `),t}var b=Object.freeze({__proto__:null,build:f})},"1a54":function(e,t,i){"use strict";i.d(t,"a",(function(){return u})),i.d(t,"b",(function(){return b})),i.d(t,"c",(function(){return S})),i.d(t,"d",(function(){return P})),i.d(t,"e",(function(){return j})),i.d(t,"f",(function(){return m})),i.d(t,"g",(function(){return C})),i.d(t,"h",(function(){return f})),i.d(t,"i",(function(){return w})),i.d(t,"j",(function(){return g})),i.d(t,"k",(function(){return _})),i.d(t,"l",(function(){return x}));i("c120");var n=i("a21b"),r=i("b2b2"),s=i("5996"),o=i("74e2"),a=i("f2e0"),c=i("9180"),l=i("a1f3"),h=i("f0b9"),d=i("4261"),p=i("008c");i("3563");class u{constructor(e,t,i){this.uid=e,this.geometry=t,this.attributes=i,this.visible=!0,this.objectId=null,this.centroid=null}}function f(e){return Object(r["k"])(e.geometry)}class b{constructor(){this.exceededTransferLimit=!1,this.features=[],this.fields=[],this.hasM=!1,this.hasZ=!1,this.geometryType=null,this.objectIdFieldName=null,this.globalIdFieldName=null,this.geometryProperties=null,this.geohashFieldName=null,this.spatialReference=null,this.transform=null}}function g(e){return"point"===e.type}function m(e){const t=o["a"].fromJSON(e.geometryType),i=s["a"].fromJSON(e.spatialReference),n=e.transform,r=e.features.map(r=>{const s=v(r,t,i,e.objectIdFieldName),o=s.geometry;if(o&&n)switch(o.type){case"point":s.geometry=Object(p["e"])(n,o,o,o.hasZ,o.hasM);break;case"multipoint":s.geometry=Object(p["d"])(n,o,o,o.hasZ,o.hasM);break;case"polygon":s.geometry=Object(p["f"])(n,o,o,o.hasZ,o.hasM);break;case"polyline":s.geometry=Object(p["g"])(n,o,o,o.hasZ,o.hasM)}return s});return{geometryType:t,features:r,spatialReference:i,fields:e.fields?e.fields.map(e=>l["a"].fromJSON(e)):null,objectIdFieldName:e.objectIdFieldName,globalIdFieldName:e.globalIdFieldName,geohashFieldName:e.geohashFieldName,geometryProperties:e.geometryProperties,hasZ:e.hasZ,hasM:e.hasM,exceededTransferLimit:e.exceededTransferLimit,transform:null}}function v(e,t,i,n){return{uid:Object(a["b"])(),objectId:n&&e.attributes?e.attributes[n]:null,attributes:e.attributes,geometry:y(e.geometry,t,i),visible:!0}}function y(e,t,i){if(!e)return null;switch(t){case"point":{const t=e;return{x:t.x,y:t.y,z:t.z,m:t.m,hasZ:null!=t.z,hasM:null!=t.m,type:"point",spatialReference:i}}case"polyline":{const t=e;return{paths:t.paths,hasZ:!!t.hasZ,hasM:!!t.hasM,type:"polyline",spatialReference:i}}case"polygon":{const t=e;return{rings:t.rings,hasZ:!!t.hasZ,hasM:!!t.hasM,type:"polygon",spatialReference:i}}case"multipoint":{const t=e;return{points:t.points,hasZ:!!t.hasZ,hasM:!!t.hasM,type:"multipoint",spatialReference:i}}}}function _(e,t,i,n){return{x:e,y:t,z:i,hasZ:null!=i,hasM:!1,spatialReference:n,type:"point"}}function O(e){if(Object(r["j"])(e))return 0;let t=32;switch(e.type){case"point":t+=42;break;case"polyline":case"polygon":{let i=0;const n=2+(e.hasZ?1:0)+(e.hasM?1:0),r="polyline"===e.type?e.paths:e.rings;for(const e of r)i+=e.length;t+=8*i*n+64,t+=128*i,t+=34,t+=32*(r.length+1);break}case"multipoint":{const i=2+(e.hasZ?1:0)+(e.hasM?1:0),n=e.points.length;t+=8*n*i+64,t+=128*n,t+=34,t+=32;break}case"extent":t+=98,e.hasM&&(t+=32),e.hasZ&&(t+=32);break;case"mesh":t+=Object(n["a"])(e.vertexAttributes.position),t+=Object(n["a"])(e.vertexAttributes.normal),t+=Object(n["a"])(e.vertexAttributes.uv),t+=Object(n["a"])(e.vertexAttributes.tangent)}return t}function j(e){let t=32;return t+=Object(h["a"])(e.attributes),t+=3,t+=8+O(e.geometry),t}function x(e){if(Object(r["j"])(e))return 0;switch(e.type){case"point":return 1;case"polyline":{let t=0;for(const i of e.paths)t+=i.length;return t}case"polygon":{let t=0;for(const i of e.rings)t+=i.length;return t}case"multipoint":return e.points.length;case"extent":return 2;case"mesh":{const t=e.vertexAttributes&&e.vertexAttributes.position;return t?t.length/3:0}default:return}}function w(e){if(!e)return!1;switch(e.type){case"extent":case"point":return!0;case"polyline":for(const t of e.paths)if(t.length>0)return!0;return!1;case"polygon":for(const t of e.rings)if(t.length>0)return!0;return!1;case"multipoint":return e.points.length>0;case"mesh":return e.vertexAttributes&&e.vertexAttributes.position&&e.vertexAttributes.position.length>0;default:return}}function S(e,t){switch(Object(d["k"])(t),"mesh"===e.type&&(e=e.extent),e.type){case"point":t[0]=t[3]=e.x,t[1]=t[4]=e.y,e.hasZ&&(t[2]=t[5]=e.z);break;case"polyline":for(let i=0;i<e.paths.length;i++)Object(d["o"])(t,e.paths[i],e.hasZ);break;case"polygon":for(let i=0;i<e.rings.length;i++)Object(d["o"])(t,e.rings[i],e.hasZ);break;case"multipoint":Object(d["o"])(t,e.points,e.hasZ);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[3]=e.xmax,t[4]=e.ymax,null!=e.zmin&&(t[2]=e.zmin),null!=e.zmax&&(t[5]=e.zmax)}}function P(e,t){switch(Object(c["n"])(t),"mesh"===e.type&&(e=e.extent),e.type){case"point":t[0]=t[2]=e.x,t[1]=t[3]=e.y;break;case"polyline":for(let i=0;i<e.paths.length;i++)Object(c["r"])(t,e.paths[i]);break;case"polygon":for(let i=0;i<e.rings.length;i++)Object(c["r"])(t,e.rings[i]);break;case"multipoint":Object(c["r"])(t,e.points);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[2]=e.xmax,t[3]=e.ymax}}function C(e,t){return null!=e.objectId?e.objectId:e.attributes&&t?e.attributes[t]:null}Object(d["h"])(),Object(c["l"])()},"1f1c":function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));class n{constructor(e){this.vertexHandle=null,this.excludeFeature=null,this.visualizer=null,this.geometry=e.geometry,this.elevationInfo=e.elevationInfo,this.pointer=e.pointer,this.vertexHandle=e.vertexHandle,this.excludeFeature=e.excludeFeature,this.visualizer=e.visualizer}get coordinateHelper(){return this.geometry.editGeometry.coordinateHelper}}},"240c":function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));i("c120");var n=i("b2b2"),r=i("b48e"),s=i("f408");function o(e){var t;if("graphics"!==(null==(t=e.layer)?void 0:t.type))return 1;const i=e.geometry;if(Object(n["j"])(i))return 2;switch(i.type){case"polygon":if(i instanceof r["a"])return 3;break;case"polyline":break;case"point":case"multipoint":case"extent":case"mesh":default:return 3}return"on-the-ground"!==Object(s["e"])(e)&&Object(s["g"])(e)?4:0}},"243f":function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));i("c120");var n=i("b2b2"),r=i("f408");function s(e){var t;if("graphics"!==(null==(t=e.layer)?void 0:t.type))return 1;if(Object(n["j"])(e.geometry))return 2;switch(e.geometry.type){case"polygon":case"point":case"polyline":break;case"multipoint":case"extent":case"mesh":default:return 3}return"on-the-ground"!==Object(r["e"])(e)&&Object(r["g"])(e)?4:0}},"27df":function(e,t,i){"use strict";i.d(t,"a",(function(){return u}));var n=i("ce6d"),r=i("6ae9"),s=i("b2b2");class o{constructor(e,t,i){this.editGeometry=e,this.component=t,this.pos=i,this.addedVertex=null,this.originalEdge=null,this.left=null,this.right=null}apply(){let e="redo";if(Object(s["j"])(this.addedVertex)&&(e="apply",this.addedVertex=new r["d"](this.component)),0===this.component.vertices.length)this.component.vertices.push(this.addedVertex),this.addedVertex.pos=this.pos,this.addedVertex.index=0;else{const e=Object(s["t"])(this.component.getLastVertex());let t=null;e.right&&(this.originalEdge=e.right,t=this.originalEdge.right,this.component.edges.splice(this.component.edges.indexOf(this.originalEdge),1)),this.component.vertices.push(this.addedVertex),this.addedVertex.pos=this.pos,Object(s["j"])(this.left)&&(this.left=new r["b"](this.component,e,this.addedVertex)),this.component.edges.push(this.left),e.right=this.left,Object(s["k"])(this.originalEdge)&&Object(s["k"])(t)&&(Object(s["j"])(this.right)&&(this.right=new r["b"](this.component,this.addedVertex,t)),this.component.edges.push(this.right),t.left=this.right),this.component.updateVertexIndex(this.addedVertex,e.index+1)}const t={addedVertices:[this.addedVertex],operation:e};this.editGeometry.emit("change",t)}undo(){if(Object(s["j"])(this.addedVertex))return null;this.component.vertices.splice(this.component.vertices.indexOf(this.addedVertex),1),Object(s["k"])(this.left)&&(this.component.edges.splice(this.component.edges.indexOf(this.left),1),this.left.left.right=null),Object(s["k"])(this.right)&&(this.component.edges.splice(this.component.edges.indexOf(this.right),1),this.right.right.left=null),Object(s["k"])(this.originalEdge)&&(this.component.edges.push(this.originalEdge),this.originalEdge.left.right=this.originalEdge,this.originalEdge.right.left=this.originalEdge),Object(s["k"])(this.left)?this.component.updateVertexIndex(this.left.left,this.left.left.index):this.component.updateVertexIndex(this.addedVertex,0);const e={removedVertices:[this.addedVertex],operation:"undo"};this.editGeometry.emit("change",e)}accumulate(e){return!1}}var a=i("34f2");class c{constructor(e,t,i=0){this.editGeometry=e,this.removedVertices=null,this._minNumberOfVertices=0,this.vertices=t,this._minNumberOfVertices=i}apply(){let e="redo";null==this.removedVertices?(this.removedVertices=[],this.vertices.forEach(e=>{const t=this._removeVertex(e);Object(s["k"])(t)&&this.removedVertices.push(t)}),e="apply"):this.removedVertices.forEach(e=>{this._redoRemoveVertex(e)});const t={removedVertices:this.vertices,operation:e};this.editGeometry.emit("change",t)}undo(){this.removedVertices.forEach(e=>{this._undoRemoveVertex(e)});const e={addedVertices:this.vertices,operation:"undo"};this.editGeometry.emit("change",e)}accumulate(e){return!1}_removeVertex(e){const t=e.component;if(t.vertices.length<=this._minNumberOfVertices)return null;const i={removedVertex:e,createdEdge:null},n=e.left,s=e.right;return t.vertices.splice(t.vertices.indexOf(e),1),n&&(t.edges.splice(t.edges.indexOf(n),1),n.left.right=null),s&&(t.edges.splice(t.edges.indexOf(s),1),s.right.left=null),0===e.index&&s&&this.vertices.length>0&&t.swapVertices(t.vertices.indexOf(s.right),0),n&&s&&(i.createdEdge=new r["b"](t,n.left,s.right),t.edges.push(i.createdEdge)),s&&t.updateVertexIndex(s.right,s.right.index-1),i}_redoRemoveVertex(e){console.warn("redo remove vertex not implemented yet")}_undoRemoveVertex(e){const t=e.removedVertex,i=e.removedVertex.component,n=t.left,r=t.right;e.createdEdge&&i.edges.splice(i.edges.indexOf(e.createdEdge),1),i.vertices.push(t),n&&(i.edges.push(n),n.left.right=n),r&&(i.edges.push(r),r.right.left=r),i.updateVertexIndex(t,t.index)}}class l{constructor(e,t,i){this.editGeometry=e,this.edge=t,this.t=i,this.createdVertex=null,this.left=null,this.right=null}apply(){let e="redo";const t=this.edge,i=t.component,n=t.component.data,o=t.left,a=t.right;i.edges.splice(i.edges.indexOf(t),1),Object(s["j"])(this.createdVertex)&&(e="apply",this.createdVertex=new r["d"](t.component)),i.vertices.push(this.createdVertex),this.createdVertex.pos=n.coordinateHelper.lerp(t.left.pos,t.right.pos,this.t,n.coordinateHelper.createNew()),Object(s["j"])(this.left)&&(this.left=new r["b"](i,o,this.createdVertex)),this.left.left.left?i.edges.push(this.left):i.edges.unshift(this.left),o.right=this.left,Object(s["j"])(this.right)&&(this.right=new r["b"](i,this.createdVertex,a)),i.edges.push(this.right),a.left=this.right,i.updateVertexIndex(this.createdVertex,o.index+1);const c={addedVertices:[this.createdVertex],operation:e};this.editGeometry.emit("change",c)}undo(){if(Object(s["j"])(this.createdVertex)||Object(s["j"])(this.left)||Object(s["j"])(this.right))return null;const e=this.edge,t=e.component,i=this.createdVertex.left,n=this.createdVertex.right,r=i.left,o=n.right;t.vertices.splice(t.vertices.indexOf(this.createdVertex),1),t.edges.splice(t.edges.indexOf(this.left),1),t.edges.splice(t.edges.indexOf(this.right),1),this.edge.left.left?t.edges.push(this.edge):t.edges.unshift(this.edge),r.right=e,o.left=e,t.updateVertexIndex(r,r.index);const a={removedVertices:[this.createdVertex],operation:"undo"};this.editGeometry.emit("change",a)}accumulate(e){return!1}}var h=i("157c"),d=i("e1e0"),p=i("fbd0");class u extends n["a"]{constructor(e,t){super(),this.editGeometry=e,this.type=t,this._geometry=null,this._dirty=!0,this._listener=this.editGeometry.on("change",e=>{e.addedVertices&&this.emit("vertex-add",{type:"vertex-add",vertices:e.addedVertices,operation:e.operation}),e.removedVertices&&this.emit("vertex-remove",{type:"vertex-remove",vertices:e.removedVertices,operation:e.operation}),e.updatedVertices&&this.emit("vertex-update",{type:"vertex-update",vertices:e.updatedVertices,operation:e.operation}),this._dirty=!0})}destroy(){this._listener.remove()}splitEdge(e,t){const i=new l(this.editGeometry,e,t);return this.editGeometry.apply(i),i}updateVertices(e,t,i=1){const n=new a["b"](this.editGeometry,e,t);return this.editGeometry.apply(n,i),n}moveVertices(e,t,i,n,r=1){return this.updateVertices(e,new h["a"](this.editGeometry.coordinateHelper,t,i,n),r)}scaleVertices(e,t,i,n,r,s=1,o=0){return this.updateVertices(e,new p["a"](this.editGeometry.coordinateHelper,t,i,n,r,o),s)}rotateVertices(e,t,i,n=1,r=0){return this.updateVertices(e,new d["a"](this.editGeometry.coordinateHelper,t,i,r),n)}removeVertices(e){let t=0;switch(this.type){case"point":t=1;break;case"polyline":t=2;break;case"polygon":t=3}const i=new c(this.editGeometry,e,t);return this.editGeometry.apply(i),i}appendVertex(e){if(0===this.editGeometry.components.length)return null;const t=new o(this.editGeometry,this.editGeometry.components[0],e);return this.editGeometry.apply(t),t}canRemoveVertex(){let e=0;switch(this.type){case"point":e=1;break;case"polyline":e=2;break;case"polygon":e=3}return this.editGeometry.components[0].vertices.length>e}undo(){return this.editGeometry.undo()}get canUndo(){return this.editGeometry.canUndo}redo(){return this.editGeometry.redo()}get canRedo(){return this.editGeometry.canRedo}get geometry(){if(this._dirty){switch(this.type){case"point":this._geometry=this.editGeometry.toPoint();break;case"polyline":this._geometry=this.editGeometry.toPolyline();break;case"polygon":this._geometry=this.editGeometry.toPolygon()}this._dirty=!1}return this._geometry}}},"2a07":function(e,t,i){},"2aad":function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));var n=i("3886");function r(e){e.attributes.add("position","vec2"),e.varyings.add("uv","vec2"),e.vertex.code.add(n["a"]`
    void main(void) {
      gl_Position = vec4(position, 0.0, 1.0);
      uv = position * 0.5 + vec2(0.5);
    }
  `)}},"2df1":function(e,t,i){"use strict";i.d(t,"a",(function(){return $}));var n=i("b2b2"),r=i("38a4"),s=i("a915"),o=i("0b2d"),a=i("e431"),c=i("d791"),l=i("9180"),h=i("dae5"),d=i("afe1"),p=i("02f1"),u=i("1c92"),f=i("3349"),b=i("fc00"),g=i("1153"),m=i("1038"),v=i("b623"),y=i("da1c");function _(e){return e instanceof Float32Array&&e.length>=16}function O(e){return Array.isArray(e)&&e.length>=16}function j(e){return _(e)||O(e)}var x=i("68af"),w=i("7c51"),S=i("35b3"),P=i("5957"),C=i("0d96"),T=i("a4ee"),E=i("c3a4"),A=i("ca98"),M=i("da35"),k=i("fa1e"),V=i("8e37"),D=i("189c"),G=i("8e97"),I=i("d272"),R=i("2f98"),z=i("d0cb"),L=i("9617"),H=i("7079"),U=i("6a07"),F=i("be24"),q=i("17b0"),N=i("7438");class B extends A["a"]{initializeProgram(e){const t=B.shader.get(),i=this.configuration,n=t.build({output:i.output,FrontFacePass:2===i.transparencyPassType,viewingMode:e.viewingMode,occlusionTestEnabled:i.occlusionTestEnabled,signedDistanceFieldEnabled:i.sdf,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!0,debugDrawBorder:i.debugDrawBorder,binaryHighlightOcclusionEnabled:i.binaryHighlightOcclusion,screenCenterOffsetUnitsEnabled:i.screenCenterOffsetUnitsEnabled,screenSizePerspectiveEnabled:i.screenSizePerspective,verticalOffsetEnabled:i.verticalOffset,pixelSnappingEnabled:i.pixelSnappingEnabled,vvSize:i.vvSize,vvColor:i.vvColor,vvInstancingEnabled:!1,isDraped:i.isDraped,multipassGeometryEnabled:i.multipassGeometryEnabled});return new V["a"](e.rctx,n.generateSource("vertex"),n.generateSource("fragment"),k["a"])}bindPass(e,t,i){G["a"].bindProjectionMatrix(this.program,i.camera.projectionMatrix),this.program.setUniform1f("cameraGroundRelative",i.camera.aboveGround?1:-1),this.program.setUniform1f("perDistancePixelRatio",Math.tan(i.camera.fovY/2)/(i.camera.fullViewport[2]/2)),this.program.setUniformMatrix4fv("viewNormal",i.camera.viewInverseTransposeMatrix),this.program.setUniform1f("polygonOffset",t.shaderPolygonOffset),q["a"].bindUniforms(this.program,t,i),R["a"].bindUniforms(this.program,t),this.program.setUniform1f("pixelRatio",i.camera.pixelRatio||1),G["a"].bindViewport(this.program,i),6===this.configuration.output?(H["a"].bindUniforms(this.program),this.program.setUniform2fv("cameraNearFar",i.camera.nearFar),this.program.setUniform2fv("inverseViewport",i.inverseViewport),Object(L["a"])(this.program,e,i)):(z["a"].bindUniforms(this.program,i),C["a"].bindUniforms(this.program,t,i.camera.pixelRatio||1),F["a"].bindUniforms(this.program,t),this.configuration.occlusionTestEnabled&&z["a"].bindVisibilityTexture(e,this.program,i)),4===this.configuration.output&&U["a"].bindOutputHighlight(e,this.program,i)}bindDraw(e){G["a"].bindView(this.program,e),G["a"].bindCamPosition(this.program,e.origin,e.camera.viewInverseTransposeMatrix),I["a"].bindUniformsWithOrigin(this.program,this.configuration,e)}setPipelineState(e){const t=this.configuration,i=3===e,n=2===e,r=515,s=this.configuration.polygonOffsetEnabled&&W,o=(i||n)&&4!==t.output?(t.depthEnabled||6===t.output)&&D["d"]:null;return Object(D["e"])({blending:0===t.output||7===t.output||4===t.output?i?Z:Object(N["a"])(e):null,depthTest:{func:r},depthWrite:o,colorWrite:D["c"],polygonOffset:s})}initializePipeline(){return this.setPipelineState(this.configuration.transparencyPassType)}get primitiveType(){return 6===this.configuration.output?0:4}}B.shader=new E["a"](C["b"],()=>i.e("chunk-2d0db7d8").then(i.bind(null,"6fa3")));const W={factor:0,units:-4},Z=Object(D["g"])(1,771);class K extends M["a"]{constructor(){super(...arguments),this.output=0,this.occlusionTestEnabled=!0,this.sdf=!1,this.vvSize=!1,this.vvColor=!1,this.verticalOffset=!1,this.screenSizePerspective=!1,this.screenCenterOffsetUnitsEnabled=0,this.debugDrawBorder=!0,this.binaryHighlightOcclusion=!0,this.slicePlaneEnabled=!1,this.polygonOffsetEnabled=!1,this.depthEnabled=!0,this.transparencyPassType=3,this.pixelSnappingEnabled=!0,this.isDraped=!1,this.multipassGeometryEnabled=!1}}Object(T["a"])([Object(M["b"])({count:8})],K.prototype,"output",void 0),Object(T["a"])([Object(M["b"])()],K.prototype,"occlusionTestEnabled",void 0),Object(T["a"])([Object(M["b"])()],K.prototype,"sdf",void 0),Object(T["a"])([Object(M["b"])()],K.prototype,"vvSize",void 0),Object(T["a"])([Object(M["b"])()],K.prototype,"vvColor",void 0),Object(T["a"])([Object(M["b"])()],K.prototype,"verticalOffset",void 0),Object(T["a"])([Object(M["b"])()],K.prototype,"screenSizePerspective",void 0),Object(T["a"])([Object(M["b"])({count:2})],K.prototype,"screenCenterOffsetUnitsEnabled",void 0),Object(T["a"])([Object(M["b"])()],K.prototype,"debugDrawBorder",void 0),Object(T["a"])([Object(M["b"])()],K.prototype,"binaryHighlightOcclusion",void 0),Object(T["a"])([Object(M["b"])()],K.prototype,"slicePlaneEnabled",void 0),Object(T["a"])([Object(M["b"])()],K.prototype,"polygonOffsetEnabled",void 0),Object(T["a"])([Object(M["b"])()],K.prototype,"depthEnabled",void 0),Object(T["a"])([Object(M["b"])({count:4})],K.prototype,"transparencyPassType",void 0),Object(T["a"])([Object(M["b"])()],K.prototype,"pixelSnappingEnabled",void 0),Object(T["a"])([Object(M["b"])()],K.prototype,"isDraped",void 0),Object(T["a"])([Object(M["b"])()],K.prototype,"multipassGeometryEnabled",void 0);class $ extends S["a"]{constructor(e){super(e,ye),this.techniqueConfig=new K}getTechniqueConfig(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.verticalOffset=!!this.params.verticalOffset,this.techniqueConfig.screenSizePerspective=!!this.params.screenSizePerspective,this.techniqueConfig.screenCenterOffsetUnitsEnabled="screen"===this.params.centerOffsetUnits?1:0,this.techniqueConfig.polygonOffsetEnabled=this.params.polygonOffset,this.techniqueConfig.isDraped=this.params.isDraped,this.techniqueConfig.occlusionTestEnabled=this.params.occlusionTest,this.techniqueConfig.pixelSnappingEnabled=this.params.pixelSnappingEnabled,this.techniqueConfig.sdf=this.params.textureIsSignedDistanceField,this.techniqueConfig.vvSize=!!this.params.vvSizeEnabled,this.techniqueConfig.vvColor=!!this.params.vvColorEnabled,0===e&&(this.techniqueConfig.debugDrawBorder=!!this.params.debugDrawBorder),4===e&&(this.techniqueConfig.binaryHighlightOcclusion=this.params.binaryHighlightOcclusion),this.techniqueConfig.depthEnabled=this.params.depthEnabled,this.techniqueConfig.transparencyPassType=t?t.transparencyPassType:3,this.techniqueConfig.multipassGeometryEnabled=!!t&&t.multipassGeometryEnabled,this.techniqueConfig}intersect(e,t,i,n,r,s,o,a,c){c?this.intersectDrapedHudGeometry(e,s,o,a):this.intersectHudGeometry(e,t,i,n,o,a)}intersectDrapedHudGeometry(e,t,i,r){const s=e.vertexAttributes.get("position"),o=e.vertexAttributes.get("size"),a=this.params,c=Object(C["d"])(a);let l=1,h=1;if(Object(n["k"])(r)){const e=r(fe);l=e[0],h=e[5]}l*=e.screenToWorldRatio,h*=e.screenToWorldRatio;const d=ge*e.screenToWorldRatio;for(let n=0;n<s.data.length/s.size;n++){const r=n*s.size,p=s.data[r],u=s.data[r+1],f=n*o.size;let b;me[0]=o.data[f]*l,me[1]=o.data[f+1]*h,a.textureIsSignedDistanceField&&(b=a.outlineSize*e.screenToWorldRatio/2),te(t,p,u,me,d,b,a,c)&&i()}}intersectHudGeometry(e,t,i,r,s,l){if(!r.options.selectionMode||!r.options.hud)return;if(Object(v["e"])(t))return;const h=this.params;let d=1,p=1;if(Object(u["f"])(le,i),Object(n["k"])(l)){const e=l(fe);d=e[0],p=e[5],ee(le)}const f=e.vertexAttributes.get("position"),b=e.vertexAttributes.get("size"),m=e.vertexAttributes.get("normal"),_=e.vertexAttributes.get("auxpos1");Object(g["a"])(f.size>=3);const O=r.point,j=r.camera,x=Object(C["d"])(h);d*=j.pixelRatio,p*=j.pixelRatio;const w="screen"===this.params.centerOffsetUnits;for(let n=0;n<f.data.length/f.size;n++){const e=n*f.size;Object(a["x"])(re,f.data[e],f.data[e+1],f.data[e+2]),Object(a["n"])(re,re,i);const t=n*b.size;me[0]=b.data[t]*d,me[1]=b.data[t+1]*p,Object(a["n"])(re,re,j.viewMatrix);const l=n*_.size;if(Object(a["x"])(pe,_.data[l+0],_.data[l+1],_.data[l+2]),!w&&(re[0]+=pe[0],re[1]+=pe[1],0!==pe[2])){const e=pe[2];Object(a["s"])(pe,re),Object(a["k"])(re,re,Object(a["f"])(pe,pe,e))}const u=n*m.size;if(Object(a["x"])(se,m.data[u],m.data[u+1],m.data[u+2]),this.normalAndViewAngle(se,le,j,ue),this.applyVerticalOffsetTransformationView(re,ue,j,ie),j.applyProjection(re,oe),oe[0]>-1){let e=Math.floor(oe[0])+this.params.screenOffset[0],t=Math.floor(oe[1])+this.params.screenOffset[1];w&&(e+=pe[0],0!==pe[1]&&(t+=Object(y["b"])(pe[1],ie.factorAlignment))),Object(y["a"])(me,ie.factor,me);const i=be*j.pixelRatio;let n;if(h.textureIsSignedDistanceField&&(n=h.outlineSize*j.pixelRatio/2),te(O,e,t,me,i,n,h,x)){const e=r.ray;if(Object(a["n"])(ce,re,Object(c["a"])(de,j.viewMatrix)),oe[0]=O[0],oe[1]=O[1],j.unprojectFromRenderScreen(oe,re)){const t=Object(o["e"])();Object(a["l"])(t,e.direction);const i=1/Object(a["q"])(t);Object(a["f"])(t,t,i),s(Object(a["p"])(e.origin,re)*i,t,-1,1,!0,ce)}}}}}computeAttachmentOrigin(e,t){const i=e.vertexAttributes;if(!i)return!1;const n=i.get("position"),r=e.indices.get("position");return Object(m["b"])(n,r,t)}createBufferWriter(){return new Oe(this)}normalAndViewAngle(e,t,i,n){return j(t)&&(t=Object(u["f"])(he,t)),Object(a["y"])(n.normal,e,t),Object(a["n"])(n.normal,n.normal,i.viewInverseTransposeMatrix),n.cosAngle=Object(a["i"])(ae,ve),n}updateScaleInfo(e,t,i){const n=this.params;n.screenSizePerspective?Object(y["e"])(i,t,n.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minPixelSize=0,e.factor.paddingPixels=0),n.screenSizePerspectiveAlignment?Object(y["e"])(i,t,n.screenSizePerspectiveAlignment,e.factorAlignment):(e.factorAlignment.factor=e.factor.factor,e.factorAlignment.scale=e.factor.scale,e.factorAlignment.minPixelSize=e.factor.minPixelSize,e.factorAlignment.paddingPixels=e.factor.paddingPixels)}applyShaderOffsetsView(e,t,i,n,r,s,o){const a=this.normalAndViewAngle(t,i,r,ue);return this.applyVerticalGroundOffsetView(e,a,r,o),this.applyVerticalOffsetTransformationView(o,a,r,s),this.applyPolygonOffsetView(o,a,n[3],r,o),this.applyCenterOffsetView(o,n,o),o}applyShaderOffsetsNDC(e,t,i,r,s){return this.applyCenterOffsetNDC(e,t,i,r),Object(n["k"])(s)&&Object(a["l"])(s,r),this.applyPolygonOffsetNDC(r,t,i,r),r}applyPolygonOffsetView(e,t,i,n,s){const o=n.aboveGround?1:-1;let c=Object(r["s"])(i);0===c&&(c=o);const l=o*c;if(this.params.shaderPolygonOffset<=0)return Object(a["l"])(s,e);const h=Object(r["d"])(Math.abs(t.cosAngle),.01,1),d=1-Math.sqrt(1-h*h)/h/n.viewport[2];return Object(a["f"])(s,e,l>0?d:1/d),s}applyVerticalGroundOffsetView(e,t,i,n){const r=Object(a["q"])(e),s=i.aboveGround?1:-1,o=.5*i.computeRenderPixelSizeAtDist(r),c=Object(a["f"])(re,t.normal,s*o);return Object(a["g"])(n,e,c),n}applyVerticalOffsetTransformationView(e,t,i,n){const r=this.params;if(!r.verticalOffset||!r.verticalOffset.screenLength){if(r.screenSizePerspective||r.screenSizePerspectiveAlignment){const i=Object(a["q"])(e);this.updateScaleInfo(n,i,t.cosAngle)}else n.factor.scale=1,n.factorAlignment.scale=1;return e}const s=Object(a["q"])(e),o=r.screenSizePerspectiveAlignment||r.screenSizePerspective,c=Object(w["l"])(i,s,r.verticalOffset,t.cosAngle,o);return this.updateScaleInfo(n,s,t.cosAngle),Object(a["f"])(t.normal,t.normal,c),Object(a["g"])(e,e,t.normal)}applyCenterOffsetView(e,t,i){const n="screen"!==this.params.centerOffsetUnits;return i!==e&&Object(a["l"])(i,e),n&&(i[0]+=t[0],i[1]+=t[1],t[2]&&(Object(a["s"])(se,i),Object(a["g"])(i,i,Object(a["f"])(se,se,t[2])))),i}applyCenterOffsetNDC(e,t,i,n){const r="screen"!==this.params.centerOffsetUnits;return n!==e&&Object(a["l"])(n,e),r||(n[0]+=t[0]/i.fullWidth*2,n[1]+=t[1]/i.fullHeight*2),n}applyPolygonOffsetNDC(e,t,i,n){const s=this.params.shaderPolygonOffset;if(e!==n&&Object(a["l"])(n,e),s){const e=i.aboveGround?1:-1,o=e*Object(r["s"])(t[3]);n[2]-=(o||e)*s}return n}getGLMaterial(e){return 0===e.output||7===e.output?new Y(e):4===e.output?new J(e):void 0}calculateRelativeScreenBounds(e,t,i=Object(l["l"])()){return Q(this.params,e,t,i),i[2]=i[0]+e[0],i[3]=i[1]+e[1],i}}class X extends x["a"]{constructor(e){super({...e,...e.material.params}),this.updateParameters()}beginSlot(e){return e===(this.material.params.drawInSecondSlot?19:18)}updateParameters(e){this.updateTexture(this.material.params.textureId),this.selectProgram(e)}selectProgram(e){this.technique=this.techniqueRep.acquireAndReleaseExisting(B,this.material.getTechniqueConfig(this.output,e),this.technique)}ensureParameters(e){this.updateParameters(e)}bind(e,t){e.bindProgram(this.technique.program),this.bindTexture(e,this.technique.program),this.bindTextureScale(e,this.technique.program),this.technique.bindPass(e,this.material.params,t)}}class Y extends X{constructor(e){super(e),this.isOcclusionSlot=!1}beginSlot(e){const t=this.material.params.drawInSecondSlot?19:18;return this.material.params.occlusionTest?(this.isOcclusionSlot=12===e,12===e||e===t):(this.isOcclusionSlot=!1,e===t)}getTechnique(){return this.isOcclusionSlot?this.occlusionTechnique:this.technique}selectProgram(e){this.technique=this.techniqueRep.acquireAndReleaseExisting(B,this.material.getTechniqueConfig(this.output,e),this.technique),this.occlusionTechnique=this.techniqueRep.acquireAndReleaseExisting(B,this.material.getTechniqueConfig(6,e),this.occlusionTechnique)}bind(e,t){const i=this.getTechnique();e.bindProgram(i.program),this.isOcclusionSlot||(this.bindTexture(e,i.program),this.bindTextureScale(e,i.program)),i.bindPass(e,this.material.params,t)}}class J extends X{constructor(e){super({...e,output:4})}}function Q(e,t,i,n=ne){return Object(f["c"])(n,e.anchorPos),n[0]*=-t[0],n[1]*=-t[1],n[0]+=e.screenOffset[0]*i,n[1]+=e.screenOffset[1]*i,n}function ee(e){const t=e[0],i=e[1],n=e[2],r=e[3],s=e[4],o=e[5],a=e[6],c=e[7],l=e[8],h=1/Math.sqrt(t*t+i*i+n*n),d=1/Math.sqrt(r*r+s*s+o*o),p=1/Math.sqrt(a*a+c*c+l*l);return e[0]=t*h,e[1]=i*h,e[2]=n*h,e[3]=r*d,e[4]=s*d,e[5]=o*d,e[6]=a*p,e[7]=c*p,e[8]=l*p,e}function te(e,t,i,n,r,s,o,a){let c=t-r-(a[0]>0?n[0]*a[0]:0),l=c+n[0]+2*r,h=i-r-(a[1]>0?n[1]*a[1]:0),d=h+n[1]+2*r;if(o.textureIsSignedDistanceField){const e=o.distanceFieldBoundingBox;c+=n[0]*e[0],h+=n[1]*e[1],l-=n[0]*(1-e[2]),d-=n[1]*(1-e[3]),c-=s,l+=s,h-=s,d+=s}return e[0]>c&&e[0]<l&&e[1]>h&&e[1]<d}const ie={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}},ne=Object(p["b"])(),re=Object(o["e"])(),se=Object(o["e"])(),oe=Object(s["e"])(),ae=Object(o["e"])(),ce=Object(o["e"])(),le=Object(h["a"])(),he=Object(h["a"])(),de=Object(d["b"])(),pe=Object(o["e"])(),ue={normal:ae,cosAngle:0},fe=Object(d["b"])(),be=1,ge=2,me=[0,0],ve=Object(o["g"])(0,0,1),ye={texCoordScale:[1,1],occlusionTest:!0,binaryHighlightOcclusion:!0,drawInSecondSlot:!1,color:[1,1,1,1],outlineColor:[1,1,1,1],outlineSize:0,textureIsSignedDistanceField:!1,distanceFieldBoundingBox:null,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],screenOffset:[0,0],verticalOffset:null,screenSizePerspective:null,screenSizePerspectiveAlignment:null,slicePlaneEnabled:!1,anchorPos:Object(p["f"])(.5,.5),shaderPolygonOffset:1e-5,polygonOffset:!1,textureId:null,centerOffsetUnits:"world",depthEnabled:!0,pixelSnappingEnabled:!0,debugDrawBorder:!1,isDraped:!1,...S["b"]},_e=Object(b["a"])().vec3f("position").vec3f("normal").vec2f("uv0").vec4u8("color").vec2f("size").vec4f("auxpos1").vec4f("auxpos2");class Oe{constructor(e){this.material=e,this.vertexBufferLayout=_e}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return 6*e.indices.get("position").length}write(e,t,i,n){Object(P["e"])(t.indices.get("position"),t.vertexAttributes.get("position").data,e.transformation,i.position,n,6),Object(P["d"])(t.indices.get("normal"),t.vertexAttributes.get("normal").data,e.invTranspTransformation,i.normal,n,6);{const e=t.vertexAttributes.get("uv0").data;let r,s,o,a;if(null==e||e.length<4){const e=this.material.params;r=0,s=0,o=e.texCoordScale[0],a=e.texCoordScale[1]}else r=e[0],s=e[1],o=e[2],a=e[3];o=Math.min(1.99999,o+1),a=Math.min(1.99999,a+1);const c=t.indices.get("position").length,l=i.uv0;let h=n;for(let t=0;t<c;++t)l.set(h,0,r),l.set(h,1,s),h+=1,l.set(h,0,o),l.set(h,1,s),h+=1,l.set(h,0,o),l.set(h,1,a),h+=1,l.set(h,0,o),l.set(h,1,a),h+=1,l.set(h,0,r),l.set(h,1,a),h+=1,l.set(h,0,r),l.set(h,1,s),h+=1}Object(P["b"])(t.indices.get("color"),t.vertexAttributes.get("color").data,4,i.color,n,6);{const e=t.indices.get("size"),r=t.vertexAttributes.get("size").data,s=e.length,o=i.size;let a=n;for(let t=0;t<s;++t){const i=r[2*e[t]],n=r[2*e[t]+1];for(let e=0;e<6;++e)o.set(a,0,i),o.set(a,1,n),a+=1}}t.indices.get("auxpos1")&&t.vertexAttributes.get("auxpos1")&&Object(P["a"])(t.indices.get("auxpos1"),t.vertexAttributes.get("auxpos1").data,i.auxpos1,n,6),t.indices.get("auxpos2")&&t.vertexAttributes.get("auxpos2")&&Object(P["a"])(t.indices.get("auxpos2"),t.vertexAttributes.get("auxpos2").data,i.auxpos2,n,6)}}},"2e0f":function(e,t,i){"use strict";i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return v})),i.d(t,"c",(function(){return u})),i.d(t,"d",(function(){return b})),i.d(t,"e",(function(){return f})),i.d(t,"f",(function(){return g})),i.d(t,"g",(function(){return m}));var n,r=i("6c97"),s=i("b2b2"),o=i("0b2d"),a=i("d791"),c=i("8188"),l=i("afe1"),h=i("1a54"),d=i("0cb9"),p=i("ba58");function u(e,t,i,n,r,s,o,a,l,h,d){const p=w[d.mode];let u,f,b=0;if(Object(c["q"])(e,t,i,n,l.spatialReference,r,a))return p.requiresAlignment(d)?(b=p.applyElevationAlignmentBuffer(n,r,s,o,a,l,h,d),u=s,f=o):(u=n,f=r),Object(c["q"])(u,l.spatialReference,f,s,h.spatialReference,o,a)?b:void 0}function f(e,t,i,n,o){const a=(Object(h["j"])(e)?e.z:Object(d["c"])(e)?e.array[e.offset+2]:e[2])||0;switch(i.mode){case"on-the-ground":{const i=Object(s["u"])(Object(d["b"])(t,e,"ground"),0);return o&&(o.verticalDistanceToGround=0,o.sampledElevation=i),i}case"relative-to-ground":{const r=Object(s["u"])(Object(d["b"])(t,e,"ground"),0),c=i.geometryZWithOffset(a,n);return o&&(o.verticalDistanceToGround=c,o.sampledElevation=r),c+r}case"relative-to-scene":{const r=Object(s["u"])(Object(d["b"])(t,e,"scene"),0),c=i.geometryZWithOffset(a,n);return o&&(o.verticalDistanceToGround=c,o.sampledElevation=r),c+r}case"absolute-height":{const r=i.geometryZWithOffset(a,n);if(o){const i=Object(s["u"])(Object(d["b"])(t,e,"ground"),0);o.verticalDistanceToGround=r-i,o.sampledElevation=i}return r}default:return Object(r["a"])(i.mode),0}}function b(e,t,i){return null==t||null==i?e.definedChanged:"on-the-ground"===t&&"on-the-ground"===i?e.staysOnTheGround:t===i||"on-the-ground"!==t&&"on-the-ground"!==i?n.UPDATE:e.onTheGroundChanged}function g(e){return"relative-to-ground"===e||"relative-to-scene"===e}function m(e){return"absolute-height"!==e}function v(e,t,i,n,r){const s=f(t,i,r,n,P);Object(p["j"])(e,P.verticalDistanceToGround);const o=P.sampledElevation,l=Object(a["c"])(S,e.transformation);return C[0]=t.x,C[1]=t.y,C[2]=s,Object(c["d"])(t.spatialReference,C,l,n.spatialReference)?e.transformation=l:console.warn("Could not locate symbol object properly, it might be misplaced"),o}function y(e,t,i,n,r,o){let a=0;const c=o.spatialReference;t*=3,n*=3;for(let l=0;l<r;++l){const r=e[t+0],l=e[t+1],h=e[t+2],d=Object(s["u"])(o.getElevation(r,l,h,c,"ground"),0);a+=d,i[n+0]=r,i[n+1]=l,i[n+2]=d,t+=3,n+=3}return a/r}function _(e,t,i,n,r,o,a,c){let l=0;const h=c.calculateOffsetRenderUnits(a),d=c.featureExpressionInfoContext,p=o.spatialReference;t*=3,n*=3;for(let u=0;u<r;++u){const r=e[t+0],a=e[t+1],c=e[t+2],u=Object(s["u"])(o.getElevation(r,a,c,p,"ground"),0);l+=u,i[n+0]=r,i[n+1]=a,i[n+2]=null==d?c+u+h:u+h,t+=3,n+=3}return l/r}function O(e,t,i,n,r,o,a,c){let l=0;const h=c.calculateOffsetRenderUnits(a),d=c.featureExpressionInfoContext,p=o.spatialReference;t*=3,n*=3;for(let u=0;u<r;++u){const r=e[t+0],a=e[t+1],c=e[t+2],u=Object(s["u"])(o.getElevation(r,a,c,p,"scene"),0);l+=u,i[n+0]=r,i[n+1]=a,i[n+2]=null==d?c+u+h:u+h,t+=3,n+=3}return l/r}function j(e){const t=e.meterUnitOffset,i=e.featureExpressionInfoContext;return 0!==t||null!=i}function x(e,t,i,n,r,s,o,a){const c=a.calculateOffsetRenderUnits(o),l=a.featureExpressionInfoContext;t*=3,n*=3;for(let h=0;h<r;++h){const r=e[t+0],s=e[t+1],o=e[t+2];i[n+0]=r,i[n+1]=s,i[n+2]=null==l?o+c:c,t+=3,n+=3}return 0}!function(e){e[e.NONE=0]="NONE",e[e.UPDATE=1]="UPDATE",e[e.RECREATE=2]="RECREATE"}(n||(n={}));const w={"absolute-height":{applyElevationAlignmentBuffer:x,requiresAlignment:j},"on-the-ground":{applyElevationAlignmentBuffer:y,requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:_,requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:O,requiresAlignment:()=>!0}},S=Object(l["b"])(),P={verticalDistanceToGround:0,sampledElevation:0},C=Object(o["e"])()},"2ebb":function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));const n={divisor:0};function r(e,t={}){t={...n,...t};const i=e.stride;return e.fieldNames.filter(t=>{const i=e.fields.get(t).optional;return!(i&&i.glPadding)}).map(n=>{const r=e.fields.get(n),o=r.constructor.ElementCount,a=s(r.constructor.ElementType),c=r.offset,l=!(!r.optional||!r.optional.glNormalized);return{name:n,stride:i,count:o,type:a,offset:c,normalized:l,divisor:t.divisor}})}function s(e){const t=o[e];if(t)return t;throw new Error("BufferType not supported in WebGL")}const o={u8:5121,u16:5123,u32:5125,i8:5120,i16:5122,i32:5124,f32:5126}},"34f2":function(e,t,i){"use strict";i.d(t,"a",(function(){return r})),i.d(t,"b",(function(){return n}));class n{constructor(e,t,i){this.editGeometry=e,this.vertices=t,this.operation=i,this.undone=!1}apply(){this.vertices.forEach(e=>this.operation.apply(e)),this.editGeometry.components.forEach(e=>e.unnormalizeVertexPositions());const e={updatedVertices:this.vertices,operation:this.undone?"redo":"apply"};this.editGeometry.emit("change",e)}undo(){this.vertices.forEach(e=>{this.operation.undo(e)});const e={updatedVertices:this.vertices,operation:"undo"};this.editGeometry.emit("change",e),this.undone=!0}canAccumulate(e){if(this.undone)return!1;if(e.vertices.length!==this.vertices.length)return!1;for(let t=0;t<e.vertices.length;++t)if(e.vertices[t]!==this.vertices[t])return!1;return this.operation.canAccumulate(e.operation)}accumulate(e){if(e instanceof n&&this.canAccumulate(e)){this.vertices.forEach(t=>this.operation.accumulate(t,e.operation)),this.operation.accumulateParams(e.operation),this.editGeometry.components.forEach(e=>e.unnormalizeVertexPositions());const t={updatedVertices:this.vertices,operation:"apply"};return this.editGeometry.emit("change",t),!0}return!1}}class r{constructor(e){this.helper=e}}},3510:function(e,t,i){"use strict";i.d(t,"a",(function(){return l}));var n=i("b2b2"),r=i("f4cc"),s=i("9305"),o=i("3563"),a=i("1f1c"),c=i("c20d");class l{constructor(){this.next=new c["a"]}createSnapDragEventPipelineStep({predicate:e=(()=>!0),cancel:t,snappingManager:i,snappingContext:l}){if(Object(n["j"])(i))return e=>e;let h=null,d=null;const p=()=>{h=Object(n["a"])(h),i.doneSnapping(),Object(n["k"])(d)&&d.frameTask.remove(),d=null};return t.next(e=>(p(),e)),this.next=new c["a"],t=>{if(!e(t))return t;if(h=Object(n["a"])(h),"start"===t.action){const e="3d"===i.view.type?i.view.resourceController.scheduler.registerTask(s["b"].SNAPPING,t=>Object(n["t"])(e).processQueue(t),()=>!1):s["a"];d={context:new a["a"]({geometry:l.geometry,elevationInfo:l.elevationInfo,pointer:l.pointer,vertexHandle:Object(n["k"])(t.info)?t.info.handle:null,excludeFeature:l.excludeFeature,visualizer:l.visualizer}),originalPos:Object(n["k"])(t.snapOrigin)?l.coordinateHelper.createDehydratedPoint(t.snapOrigin):t.mapStart,frameTask:e}}if(Object(n["k"])(d)){const e=d.context.coordinateHelper.createDehydratedPoint(d.context.coordinateHelper.fromArray([d.originalPos.x,d.originalPos.y,d.originalPos.z]));e.x+=t.mapEnd.x-t.mapStart.x,e.y+=t.mapEnd.y-t.mapStart.y;const n=t.mapStart.x-d.originalPos.x,s=t.mapStart.y-d.originalPos.y,a={...t,action:"udpate"},c=d.context,l=i.update(e,d.context);if(t.mapEnd.x=l.x+n,t.mapEnd.y=l.y+s,"end"!==t.action){const t=d.frameTask;h=Object(r["i"])(async r=>{const h=await t.schedule(()=>i.snap(e,c,r),r);if(h.valid){const e=await t.schedule(()=>h.apply(),r);Object(o["b"])(e,l)||(a.mapEnd.x=e.x+n,a.mapEnd.y=e.y+s,this.next.execute(a))}})}}return"end"===t.action&&p(),t}}}},3563:function(e,t,i){"use strict";i.d(t,"a",(function(){return f})),i.d(t,"b",(function(){return o}));i("c120");var n=i("b2b2");function r(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++){const n=e[i],r=t[i];if(n.length!==r.length)return!1;for(let e=0;e<n.length;e++)if(n[e]!==r[e])return!1}return!0}function s(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(!r(e[i],t[i]))return!1;return!0}function o(e,t){return!!d(e.spatialReference,t.spatialReference)&&e.x===t.x&&e.y===t.y&&e.z===t.z&&e.m===t.m}function a(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!d(e.spatialReference,t.spatialReference)&&s(e.paths,t.paths)}function c(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!d(e.spatialReference,t.spatialReference)&&s(e.rings,t.rings)}function l(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!d(e.spatialReference,t.spatialReference)&&r(e.points,t.points)}function h(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!d(e.spatialReference,t.spatialReference)&&e.xmin===t.xmin&&e.ymin===t.ymin&&e.zmin===t.zmin&&e.xmax===t.xmax&&e.ymax===t.ymax&&e.zmax===t.zmax}function d(e,t){return e===t||e&&t&&e.equals(t)}function p(e,t){if(e===t)return!0;if(Object(n["j"])(e)||Object(n["j"])(t))return!1;if(e.type!==t.type)return!1;switch(e.type){case"point":return o(e,t);case"extent":return h(e,t);case"polyline":return a(e,t);case"polygon":return c(e,t);case"multipoint":return l(e,t);case"mesh":return!1;default:return}}function u(e,t){if(e===t)return!0;if(!e||!t)return!1;const i=Object.keys(e),n=Object.keys(t);if(i.length!==n.length)return!1;for(const r of i)if(e[r]!==t[r])return!1;return!0}function f(e,t){return e===t||null!=e&&null!=t&&e.objectId===t.objectId&&!!p(e.geometry,t.geometry)&&!!u(e.attributes,t.attributes)}},3835:function(e,t,i){"use strict";function n(e){if(Array.isArray(e))return e}i.d(t,"a",(function(){return a}));i("a4d3"),i("e01a"),i("d3b7"),i("d28b"),i("3ca3"),i("ddb0");function r(e,t){var i=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=i){var n,r,s=[],o=!0,a=!1;try{for(i=i.call(e);!(o=(n=i.next()).done);o=!0)if(s.push(n.value),t&&s.length===t)break}catch(c){a=!0,r=c}finally{try{o||null==i["return"]||i["return"]()}finally{if(a)throw r}}return s}}var s=i("06c5");function o(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function a(e,t){return n(e)||r(e,t)||Object(s["a"])(e,t)||o()}},"40b6":function(e,t,i){"use strict";i.d(t,"a",(function(){return p})),i.d(t,"b",(function(){return d})),i.d(t,"c",(function(){return u})),i.d(t,"d",(function(){return h}));var n=i("ce50"),r=i("5996"),s=(i("4ae5"),i("1219"),i("521c"),i("e06a"),i("8048")),o=i("d636");function a(e){if(!e)return null;if(e.isGeographic&&e.wkid){const t=o["c"][e.wkid];if(t)return t}if(e.wkt){const t=o["a"].exec(e.wkt);if(!t||2!==t.length)return null;const i=t[1].split(",");if(!i||i.length<3)return null;const n=parseFloat(i[1]),r=parseFloat(i[2]);return isNaN(n)||isNaN(r)?null:{a:n,f:0===r?0:1/r}}return null}function c(e){return"b"in e&&"eSq"in e&&"radius"in e}function l(e){const t=a(e||r["a"].WGS84);if(c(t))return t;const i=t.a*(1-t.f);return Object.assign(t,{b:i,eSq:1-(i/t.a)**2,radius:(2*t.a+i)/3,densificationRatio:1e4/((2*t.a+i)/3)})}function h(e){return null!==a(e)}function d(e,t="meters"){const i=e,r=e;if(!i&&!r)throw new n["a"]("geodesic-lengths:invalid-geometries","the input geometries type is not supported");if(i?i.some(e=>!h(e.spatialReference)):r.some(e=>!h(e.spatialReference)))throw new n["a"]("geodesic-lengths:invalid-spatial-reference","the input geometries spatial reference is not supported");const o=[];for(let n=0;n<e.length;n++){const i=e[n],{spatialReference:r}=i,a="polyline"===i.type?i.paths:i.rings;let c=0;for(let e=0;e<a.length;e++){const t=a[e];let i=0;for(let e=1;e<t.length;e++){const n=t[e-1][0],s=t[e][0],o=t[e-1][1],a=t[e][1];if(o!==a||n!==s){const e={distance:null};u(e,[n,o],[s,a],r),i+=e.distance}}c+=i}c=Object(s["c"])(c,"meters",t),o.push(c)}return o}function p(e,t,i,n,r){const s=t[0],a=t[1],c=s*o["d"],h=a*o["d"],d=i*o["d"],{a:p,b:u,f:f}=l(r),b=Math.sin(d),g=Math.cos(d),m=(1-f)*Math.tan(h),v=1/Math.sqrt(1+m*m),y=m*v,_=Math.atan2(m,g),O=v*b,j=O*O,x=1-j,w=x*(p*p-u*u)/(u*u),S=1+w/16384*(4096+w*(w*(320-175*w)-768)),P=w/1024*(256+w*(w*(74-47*w)-128));let C,T,E,A,M=n/(u*S),k=2*Math.PI;for(;Math.abs(M-k)>1e-12;)E=Math.cos(2*_+M),C=Math.sin(M),T=Math.cos(M),A=P*C*(E+P/4*(T*(2*E*E-1)-P/6*E*(4*C*C-3)*(4*E*E-3))),k=M,M=n/(u*S)+A;const V=y*C-v*T*g,D=Math.atan2(y*T+v*C*g,(1-f)*Math.sqrt(j+V*V)),G=Math.atan2(C*b,v*T-y*C*g),I=f/16*x*(4+f*(4-3*x)),R=D/o["d"],z=(c+(G-(1-I)*f*O*(M+I*C*(E+I*T*(2*E*E-1)))))/o["d"];return e[0]=z,e[1]=R,e}function u(e,t,i,n){const r=t[0]*o["d"],s=t[1]*o["d"],a=i[0]*o["d"],c=i[1]*o["d"],{a:h,b:d,f:p,radius:u}=l(n),f=a-r,b=Math.atan((1-p)*Math.tan(s)),g=Math.atan((1-p)*Math.tan(c)),m=Math.sin(b),v=Math.cos(b),y=Math.sin(g),_=Math.cos(g);let O,j,x,w,S,P,C,T,E,A,M=1e3,k=f;do{if(C=Math.sin(k),T=Math.cos(k),x=Math.sqrt(_*C*(_*C)+(v*y-m*_*T)*(v*y-m*_*T)),0===x)return e.distance=0,e.azimuth=void 0,e.reverseAzimuth=void 0,e;S=m*y+v*_*T,P=Math.atan2(x,S),E=v*_*C/x,j=1-E*E,w=S-2*m*y/j,isNaN(w)&&(w=0),A=p/16*j*(4+p*(4-3*j)),O=k,k=f+(1-A)*p*E*(P+A*x*(w+A*S*(2*w*w-1)))}while(Math.abs(k-O)>1e-12&&--M>0);if(0===M){const t=u,i=Math.acos(Math.sin(s)*Math.sin(c)+Math.cos(s)*Math.cos(c)*Math.cos(a-r))*t,n=a-r,l=Math.sin(n)*Math.cos(c),h=Math.cos(s)*Math.sin(c)-Math.sin(s)*Math.cos(c)*Math.cos(n),d=Math.atan2(l,h);return e.azimuth=d/o["d"],e.distance=i,e.reverseAzimuth=void 0,e}const V=j*(h*h-d*d)/(d*d),D=V/1024*(256+V*(V*(74-47*V)-128)),G=d*(1+V/16384*(4096+V*(V*(320-175*V)-768)))*(P-D*x*(w+D/4*(S*(2*w*w-1)-D/6*w*(4*x*x-3)*(4*w*w-3)))),I=Math.atan2(_*Math.sin(k),v*y-m*_*Math.cos(k)),R=Math.atan2(v*Math.sin(k),v*y*Math.cos(k)-m*_);return e.azimuth=I/o["d"],e.distance=G,e.reverseAzimuth=R/o["d"],e}},4261:function(e,t,i){"use strict";i.d(t,"a",(function(){return H})),i.d(t,"b",(function(){return L})),i.d(t,"c",(function(){return U})),i.d(t,"d",(function(){return f})),i.d(t,"e",(function(){return y})),i.d(t,"f",(function(){return x})),i.d(t,"g",(function(){return j})),i.d(t,"h",(function(){return o})),i.d(t,"i",(function(){return g})),i.d(t,"j",(function(){return v})),i.d(t,"k",(function(){return k})),i.d(t,"l",(function(){return R})),i.d(t,"m",(function(){return c})),i.d(t,"n",(function(){return d})),i.d(t,"o",(function(){return u})),i.d(t,"p",(function(){return p})),i.d(t,"q",(function(){return l})),i.d(t,"r",(function(){return h})),i.d(t,"s",(function(){return D})),i.d(t,"t",(function(){return a})),i.d(t,"u",(function(){return T})),i.d(t,"v",(function(){return m})),i.d(t,"w",(function(){return w})),i.d(t,"x",(function(){return S})),i.d(t,"y",(function(){return I})),i.d(t,"z",(function(){return O})),i.d(t,"A",(function(){return P})),i.d(t,"B",(function(){return C})),i.d(t,"C",(function(){return M})),i.d(t,"D",(function(){return A})),i.d(t,"E",(function(){return E})),i.d(t,"F",(function(){return _})),i.d(t,"G",(function(){return V})),i.d(t,"H",(function(){return b})),i.d(t,"I",(function(){return z}));var n=i("b2b2"),r=(i("3af1"),i("9180"));function s(e){return e}function o(e=U){return s([e[0],e[1],e[2],e[3],e[4],e[5]])}function a(e,t,i,n,r,s,a=o()){return a[0]=e,a[1]=t,a[2]=i,a[3]=n,a[4]=r,a[5]=s,a}function c(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.min(e[2],t[2]),e[3]=Math.max(e[3],t[3]),e[4]=Math.max(e[4],t[4]),e[5]=Math.max(e[5],t[5])}function l(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[3]=Math.max(e[3],t[2]),e[4]=Math.max(e[4],t[3])}function h(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.min(e[2],t[2]),e[3]=Math.max(e[3],t[0]),e[4]=Math.max(e[4],t[1]),e[5]=Math.max(e[5],t[2])}function d(e,t,i=0,n=t.length/3){let r=e[0],s=e[1],o=e[2],a=e[3],c=e[4],l=e[5];for(let h=0;h<n;h++)r=Math.min(r,t[i+3*h]),s=Math.min(s,t[i+3*h+1]),o=Math.min(o,t[i+3*h+2]),a=Math.max(a,t[i+3*h]),c=Math.max(c,t[i+3*h+1]),l=Math.max(l,t[i+3*h+2]);e[0]=r,e[1]=s,e[2]=o,e[3]=a,e[4]=c,e[5]=l}function p(e,t,i,n){e[0]=Math.min(e[0],e[0]+t),e[3]=Math.max(e[3],e[3]+t),e[1]=Math.min(e[1],e[1]+i),e[4]=Math.max(e[4],e[4]+i),e[2]=Math.min(e[2],e[2]+n),e[5]=Math.max(e[5],e[5]+n)}function u(e,t,i){const n=t.length;let r=e[0],s=e[1],o=e[2],a=e[3],c=e[4],l=e[5];if(i)for(let h=0;h<n;h++){const e=t[h];r=Math.min(r,e[0]),s=Math.min(s,e[1]),o=Math.min(o,e[2]),a=Math.max(a,e[0]),c=Math.max(c,e[1]),l=Math.max(l,e[2])}else for(let h=0;h<n;h++){const e=t[h];r=Math.min(r,e[0]),s=Math.min(s,e[1]),a=Math.max(a,e[0]),c=Math.max(c,e[1])}e[0]=r,e[1]=s,e[2]=o,e[3]=a,e[4]=c,e[5]=l}function f(e){for(let t=0;t<6;t++)if(!isFinite(e[t]))return!1;return!0}function b(e){return e[0]>=e[3]?0:e[3]-e[0]}function g(e){return e[1]>=e[4]?0:e[4]-e[1]}function m(e){return e[2]>=e[5]?0:e[5]-e[2]}function v(e){const t=b(e),i=m(e),n=g(e);return Math.sqrt(t*t+i*i+n*n)}function y(e,t=[0,0,0]){return t[0]=e[0]+b(e)/2,t[1]=e[1]+g(e)/2,t[2]=e[2]+m(e)/2,t}function _(e,t=[0,0,0]){return t[0]=b(e),t[1]=g(e),t[2]=m(e),t}function O(e){return Math.max(b(e),m(e),g(e))}function j(e,t){return t[0]>=e[0]&&t[1]>=e[1]&&t[2]>=e[2]&&t[0]<=e[3]&&t[1]<=e[4]&&t[2]<=e[5]}function x(e,t){return t[0]>=e[0]&&t[1]>=e[1]&&t[2]>=e[2]&&t[3]<=e[3]&&t[4]<=e[4]&&t[5]<=e[5]}function w(e,t){return Math.max(t[0],e[0])<=Math.min(t[3],e[3])&&Math.max(t[1],e[1])<=Math.min(t[4],e[4])&&Math.max(t[2],e[2])<=Math.min(t[5],e[5])}function S(e,t){return!!Object(n["j"])(t)||w(e,t)}function P(e,t,i,n,r=e){return r[0]=e[0]+t,r[1]=e[1]+i,r[2]=e[2]+n,r[3]=e[3]+t,r[4]=e[4]+i,r[5]=e[5]+n,r}function C(e,t,i=e){const n=e[0]+b(e)/2,r=e[1]+g(e)/2,s=e[2]+m(e)/2;return i[0]=n+(e[0]-n)*t,i[1]=r+(e[1]-r)*t,i[2]=s+(e[2]-s)*t,i[3]=n+(e[3]-n)*t,i[4]=r+(e[4]-r)*t,i[5]=s+(e[5]-s)*t,i}function T(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function E(e,t,i=e){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i!==e&&(i[3]=e[3],i[4]=e[4],i[5]=e[5]),i}function A(e,t,i=e){return i[3]=t[0],i[4]=t[1],i[5]=t[2],i!==e&&(i[0]=e[0],i[1]=e[1],i[2]=e[2]),e}function M(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function k(e){return e?M(e,H):o(H)}function V(e,t){return t||(t=Object(r["l"])()),t[0]=e[0],t[1]=e[1],t[2]=e[3],t[3]=e[4],t}function D(e,t){return e[0]=t[0],e[1]=t[1],e[2]=Number.NEGATIVE_INFINITY,e[3]=t[2],e[4]=t[3],e[5]=Number.POSITIVE_INFINITY,e}function G(e){return 6===e.length}function I(e){return 0===b(e)&&0===g(e)&&0===m(e)}function R(e,t,i){if(Object(n["j"])(e)||Object(n["j"])(t))return e===t;if(!G(e)||!G(t))return!1;if(i){for(let n=0;n<e.length;n++)if(!i(e[n],t[n]))return!1}else for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function z(e,t,i,n,r,s){return a(e,t,i,n,r,s,F)}const L=s([-1/0,-1/0,-1/0,1/0,1/0,1/0]),H=s([1/0,1/0,1/0,-1/0,-1/0,-1/0]),U=s([0,0,0,0,0,0]),F=o()},"43e0":function(e,t,i){"use strict";i.d(t,"a",(function(){return u})),i.d(t,"b",(function(){return p})),i.d(t,"c",(function(){return f})),i.d(t,"d",(function(){return l})),i.d(t,"e",(function(){return d}));var n=i("02f1"),r=i("3349"),s=i("c9fb"),o=i("6706"),a=i("0f94");class c{constructor(e){this.coordinateHelper=e}}class l extends c{constructor(e,t){super(e),this.point=t}objectEqual(e){return e instanceof l&&Object(o["d"])(this.point,e.point)}check(e){return Object(r["j"])(e,this.point)<s["a"].pointThreshold}closestTo(){return this.coordinateHelper.clone(this.point)}intersect(e){const t=[];return e instanceof h?t.push(...Object(a["b"])({start:e.start,end:e.end,type:e instanceof p?1:0},this.point)):e instanceof f&&t.push(...Object(a["a"])(e.center,e.radius,this.point)),t.map(t=>new u(this.coordinateHelper,t,this,e))}}class h extends c{constructor(e,t,i){super(e),this.start=t,this.end=i}objectEqual(e){return e instanceof h&&Object(o["d"])(this.start,e.start)&&Object(o["d"])(this.end,e.end)}intersect(e){const t=[];return e instanceof l?t.push(...Object(a["b"])({start:this.start,end:this.end,type:this instanceof p?1:0},e.point)):e instanceof h?t.push(...Object(a["c"])({start:this.start,end:this.end,type:this instanceof p?1:0},{start:e.start,end:e.end,type:e instanceof p?1:0})):e instanceof f&&t.push(...Object(a["d"])({start:this.start,end:this.end,type:this instanceof p?1:0},e.center,e.radius)),t.map(t=>new u(this.coordinateHelper,t,this,e))}}class d extends h{constructor(e,t,i){super(e,t,i),this.dir=Object(n["b"])(),this.p=Object(n["b"])()}objectEqual(e){return e instanceof d&&super.objectEqual(e)}check(e){return Object(r["d"])(this.dir,this.end,this.start),Object(r["d"])(this.p,e,this.start),Object(r["g"])(this.dir,this.p)>=0&&Object(a["e"])(e,this.start,this.end)<s["a"].pointOnLineThreshold}closestTo(e){const t=this.coordinateHelper.clone(e);return Object(a["h"])(t,e,this.start,this.end),t}}class p extends h{constructor(e,t,i){super(e,t,i)}objectEqual(e){return e instanceof p&&super.objectEqual(e)}check(e){return Object(a["e"])(e,this.start,this.end)<s["a"].pointOnLineThreshold}closestTo(e){const t=this.coordinateHelper.clone(e);return Object(a["g"])(t,e,this.start,this.end),t}}class u extends c{constructor(e,t,i,n){super(e),this.intersection=t,this.first=i,this.second=n}objectEqual(e){return e instanceof u&&this.first.objectEqual(e.first)&&this.second.objectEqual(e.second)}check(){return!1}closestTo(e){const t=this.coordinateHelper.clone(e);return Object(r["c"])(t,this.intersection),t}intersect(){return[]}}class f extends c{constructor(e,t,i){super(e),this.center=t,this.radius=i}objectEqual(e){return e instanceof f&&this.center[0]===e.center[0]&&this.center[1]===e.center[1]&&this.radius===e.radius}check(){return!1}closestTo(e){const t=this.coordinateHelper.clone(e);return Object(a["f"])(t,e,this.center,this.radius),t}intersect(e){const t=[];return e instanceof h?t.push(...Object(a["d"])({start:e.start,end:e.end,type:e instanceof p?1:0},this.center,this.radius)):e instanceof l&&t.push(...Object(a["a"])(this.center,this.radius,e.point)),t.map(t=>new u(this.coordinateHelper,t,this,e))}}},"45a1":function(e,t,i){"use strict";i.d(t,"a",(function(){return m}));var n=i("b2b2"),r=i("0b2d"),s=i("e431"),o=i("af40"),a=i("d791"),c=i("afe1"),l=i("7577"),h=i("5ef2"),d=i("f091"),p=i("0278"),u=i("caf7"),f=i("86ba"),b=i("d36e"),g=i("5fae");class m extends g["a"]{constructor(e){super(e),this._handles=new o["a"],this._quadMaterial=null,this._outlineMaterial=null,this._maxSize=0,this._position=Object(r["e"])(),this._up=Object(r["e"])(),this._right=Object(r["e"])(),this._renderOccluded=4,this._color=Object(h["c"])(1,0,0,1),this._outlineColor=Object(h["c"])(0,0,0,1),this._outlineSize=0,this._size=32,this._outlineRenderOccluded=16,this.applyProps(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateQuadMaterial())}get color(){return this._color}set color(e){Object(l["c"])(this._color,e),this._updateQuadMaterial()}get outlineColor(){return this._outlineColor}set outlineColor(e){Object(l["c"])(this._outlineColor,e),this._updateOutlineMaterial()}get outlineSize(){return this._outlineSize}set outlineSize(e){const t=0===this._outlineSize!=(0===e);this._outlineSize=e,t?this.recreateGeometry():this._updateOutlineMaterial()}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this._updateTransform())}get outlineRenderOccluded(){return this._outlineRenderOccluded}set outlineRenderOccluded(e){this._outlineRenderOccluded=e,this._updateOutlineMaterial()}set geometry({previous:e,center:t,next:i}){this._maxSize=Math.min(Object(s["p"])(t,e),Object(s["p"])(t,i))/3,Object(s["s"])(this._up,Object(s["k"])(this._up,e,t)),Object(s["s"])(this._right,Object(s["k"])(this._right,i,t)),Object(s["l"])(this._position,t),this.recreateGeometry()}createExternalResources(){this._quadMaterial=new b["a"](this.quadMaterialParameters),this._outlineMaterial=new f["a"](this.outlineMaterialParameters),this._handles.add(this.view.state.watch("camera",()=>this._updateTransform()))}destroyExternalResources(){this._quadMaterial=null,this._outlineMaterial=null,this._handles.removeAll()}forEachExternalMaterial(e){e(this._quadMaterial),e(this._outlineMaterial)}createGeometries(e){this._createQuadGeometry(e),this._createOutlineGeometry(e),this._updateTransform(e)}_createQuadGeometry(e){const t=this._quadGeometryData(this._up,this._right);e.addGeometry(t,this._quadMaterial)}_createOutlineGeometry(e){if(0===this._outlineSize)return;const t=Object(s["g"])(d["d"].get(),this._up,this._right),i=u["a"].createPolylineGeometry([this._up,t,this._right]);e.addGeometry(i,this._outlineMaterial)}_updateTransform(e=this.object){const t=this.view.state.camera,i=this._size*t.computeScreenPixelSizeAt(this._position),r=Math.min(this._maxSize,i);Object(a["i"])(v),Object(a["t"])(v,v,this._position),Object(a["s"])(v,v,[r,r,r]),Object(n["k"])(e)&&(e.transformation=v)}_quadGeometryData(e,t){const i=Object(s["g"])(d["d"].get(),e,t);return new p["a"]([["position",{size:3,data:[0,0,0,...t,...e,...i],exclusive:!0}]],[["position",new Uint16Array([0,1,2,1,2,3])]])}get quadMaterialParameters(){return{color:this._color,transparent:!0,writeDepth:!1,polygonOffset:!0,renderOccluded:this._renderOccluded}}_updateQuadMaterial(){this._quadMaterial&&this._quadMaterial.setParameterValues(this.quadMaterialParameters)}get outlineMaterialParameters(){return{color:this._outlineColor,width:this._outlineSize,renderOccluded:this._outlineRenderOccluded}}_updateOutlineMaterial(){this._outlineMaterial&&this._outlineMaterial.setParameterValues(this.outlineMaterialParameters)}}const v=Object(c["b"])()},4772:function(e,t,i){"use strict";i.d(t,"a",(function(){return p}));var n=i("a4ee"),r=(i("c120"),i("e92d"),i("cea0"),i("59b2")),s=i("d386"),o=(i("e041"),i("8eed"),i("f402"),i("f4cc")),a=i("fc29"),c=i("4e5e"),l=i("b2b2"),h=i("2c4f");class d{constructor(){this._isToolEditable=!0,this._manipulators=new h["a"],this._nextManipulatorId=0,this._resourceContexts={manipulator3D:{}},this._attached=!1}set isToolEditable(e){this._isToolEditable=e}get length(){return this._manipulators.length}add(e,t=0){return this.addMany([e],t)[0]}addMany(e,t=0){return e.map(e=>{const i=this._nextManipulatorId++,n={id:i,manipulator:e,visibilityPredicate:t,attached:!1};return this._manipulators.add(n),this._attached&&this._updateManipulatorAttachment(n),i})}remove(e){if("number"==typeof e){const t=e;for(let e=0;e<this._manipulators.length;e++)if(this._manipulators.getItemAt(e).id===t){const t=this._manipulators.splice(e,1)[0];return this._detachManipulator(t),t.id}return null}const t=e;for(let i=0;i<this._manipulators.length;i++)if(this._manipulators.getItemAt(i).manipulator===t){const e=this._manipulators.splice(i,1)[0];return this._detachManipulator(e),e.id}return null}removeAll(){this._manipulators.forEach(e=>{this._detachManipulator(e)}),this._manipulators.removeAll()}attach(){this._manipulators.forEach(e=>{this._updateManipulatorAttachment(e)}),this._attached=!0}detach(){this._manipulators.forEach(e=>{this._detachManipulator(e)}),this._attached=!1}destroy(){this._manipulators.forEach(({manipulator:e})=>{e.destroy&&e.destroy()}),this._manipulators.destroy(),this._resourceContexts=null}on(e,t){return this._manipulators.on(e,e=>{t(e)})}forEach(e){for(const t of this._manipulators.items)e(t)}some(e){return this._manipulators.items.some(e)}toArray(){const e=[];return this.forEach(t=>e.push(t.manipulator)),e}intersect(e,t){let i=null,n=Number.MAX_VALUE;return this._manipulators.forEach(({id:r,manipulator:s,attached:o})=>{if(!o||!s.interactive)return;const a=s.intersectionDistance(e,t);Object(l["k"])(a)&&a<n&&(n=a,i={id:r,manipulator:s})}),i}findById(e){if(Object(l["j"])(e))return null;for(const t of this._manipulators.items)if(e===t.id)return t.manipulator;return null}_updateManipulatorAttachment(e){this._isManipulatorItemVisible(e)?this._attachManipulator(e):this._detachManipulator(e)}_attachManipulator(e){e.attached||(e.manipulator.attach&&e.manipulator.attach(this._resourceContexts),e.attached=!0)}_detachManipulator(e){if(!e.attached)return;const t=e.manipulator;t.grabbing=!1,t.dragging=!1,t.hovering=!1,t.selected=!1,t.detach&&t.detach(this._resourceContexts),e.attached=!1}_isManipulatorItemVisible(e){return 2===e.visibilityPredicate||(this._isToolEditable?0===e.visibilityPredicate:1===e.visibilityPredicate)}}let p=class extends a["a"]{constructor(e){super(e),this.attached=!1,this.created=!1,this.completed=!1,this.manipulators=new d,this.deferCreation=!1,this._editableFlags=new Array,this._creationResolver=Object(o["h"])()}get active(){return null!=this.view&&this.view.activeTool===this}get isSupported(){return!0}set visible(e){this._set("visible",e),e||Object(c["d"])(this,!1),this.attached&&(e?this._show():this._hide())}get editable(){return this.hasEditableFlag(0)}set editable(e){this.setEditableFlag(0,e)}attach(){!this.attached&&this.isSupported&&(this.manipulators.attach(),this.onAttach(),this.visible&&this.onShow(),this._set("attached",!0))}detach(){this.attached&&(this.onHide(),this.onDetach(),this.manipulators.detach(),this._set("attached",!1))}handleInputEvent(e){this.attached&&this.onInputEvent(e)}handleInputEventAfter(e){this.attached&&this.onInputEventAfter(e)}destroy(){this.manipulators.destroy(),this._set("view",null),this._set("created",!1),this._set("completed",!1)}setEditableFlag(e,t){this._editableFlags[e]=t,this.manipulators.isToolEditable=this._editableFlags.every(e=>null==e||e),this._updateManipulatorAttachment(),0===e&&this.notifyChange("editable"),this.onEditableChange()}hasEditableFlag(e){const t=this._editableFlags[e];return null==t||t}when(){return this._creationResolver.promise}rejectCreation(e){this._creationResolver.reject(e)}initialize(){this.deferCreation||this.complete()}onAttach(){}onDetach(){}onShow(){}onHide(){}onEditableChange(){}onInputEvent(e){}onInputEventAfter(e){}get internallyEditable(){return this.hasEditableFlag(0)&&this.hasEditableFlag(1)}create(){this.created||(this._set("created",!0),this._creationResolver.resolve(this))}complete(){this.create(),this._set("completed",!0)}_show(){this._updateManipulatorAttachment(),this.onShow()}_hide(){this._updateManipulatorAttachment(),this.onHide()}_updateManipulatorAttachment(){this.attached&&this.visible?this.manipulators.attach():this.manipulators.detach()}};Object(n["a"])([Object(r["b"])({constructOnly:!0})],p.prototype,"view",void 0),Object(n["a"])([Object(r["b"])({readOnly:!0})],p.prototype,"active",null),Object(n["a"])([Object(r["b"])({value:!0})],p.prototype,"visible",null),Object(n["a"])([Object(r["b"])({value:!0})],p.prototype,"editable",null),Object(n["a"])([Object(r["b"])({readOnly:!0})],p.prototype,"attached",void 0),Object(n["a"])([Object(r["b"])({readOnly:!0})],p.prototype,"created",void 0),Object(n["a"])([Object(r["b"])({readOnly:!0})],p.prototype,"completed",void 0),Object(n["a"])([Object(r["b"])({readOnly:!0})],p.prototype,"manipulators",void 0),Object(n["a"])([Object(r["b"])({constructOnly:!0})],p.prototype,"deferCreation",void 0),p=Object(n["a"])([Object(s["a"])("esri.views.interactive.InteractiveToolBase")],p)},"4aea":function(e,t,i){"use strict";i.d(t,"a",(function(){return r})),i.d(t,"b",(function(){return n}));const n=["freehand","hybrid","click"],r="click"},"4de4":function(e,t,i){"use strict";var n=i("23e7"),r=i("b727").filter,s=i("1dde"),o=s("filter");n({target:"Array",proto:!0,forced:!o},{filter:function(e){return r(this,e,arguments.length>1?arguments[1]:void 0)}})},"4df4":function(e,t,i){"use strict";var n=i("0366"),r=i("7b0b"),s=i("9bdd"),o=i("e95a"),a=i("50c4"),c=i("8418"),l=i("35a1");e.exports=function(e){var t,i,h,d,p,u,f=r(e),b="function"==typeof this?this:Array,g=arguments.length,m=g>1?arguments[1]:void 0,v=void 0!==m,y=l(f),_=0;if(v&&(m=n(m,g>2?arguments[2]:void 0,2)),void 0==y||b==Array&&o(y))for(t=a(f.length),i=new b(t);t>_;_++)u=v?m(f[_],_):f[_],c(i,_,u);else for(d=y.call(f),p=d.next,i=new b;!(h=p.call(d)).done;_++)u=v?s(d,m,[h.value,_],!0):h.value,c(i,_,u);return i.length=_,i}},"56d6":function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return o}));var n=i("3886"),r=i("690a"),s=i("9e77");function o(e){const t=new r["a"];return t.include(s["a"],e),t.vertex.uniforms.add("uModelViewMatrix","mat4"),t.vertex.uniforms.add("uProjectionMatrix","mat4"),t.attributes.add("start","vec3"),t.attributes.add("end","vec3"),t.attributes.add("up","vec3"),t.attributes.add("extrude","vec2"),t.varyings.add("uv","vec2"),t.varyings.add("vViewStart","vec3"),t.varyings.add("vViewEnd","vec3"),t.varyings.add("vViewPlane","vec4"),t.vertex.uniforms.add("glowWidth","float"),t.vertex.uniforms.add("pixelToNDC","vec2"),t.vertex.code.add(n["a"]`
  void main() {
    vec3 pos = mix(start, end, extrude.x);

    vec4 viewPos = uModelViewMatrix * vec4(pos, 1);
    vec4 projPos = uProjectionMatrix * viewPos;
    vec2 ndcPos = projPos.xy / projPos.w;

    vec3 viewUp = (uModelViewMatrix * vec4(extrude.y * up, 0)).xyz;
    vec4 projPosUp = uProjectionMatrix * vec4(viewPos.xyz + viewUp, 1);
    vec2 projExtrudeDir = normalize(projPosUp.xy / projPosUp.w - ndcPos);

    vec2 lxy = abs(sign(projExtrudeDir) - ndcPos);
    ndcPos += length(lxy) * projExtrudeDir;

    vec3 worldPlaneNormal = normalize(cross(up, normalize(end - start)));
    vec3 viewPlaneNormal = (uModelViewMatrix * vec4(worldPlaneNormal, 0)).xyz;

    vViewStart = (uModelViewMatrix * vec4(start, 1)).xyz;
    vViewEnd = (uModelViewMatrix * vec4(end, 1)).xyz;
    vViewPlane = vec4(viewPlaneNormal, -dot(viewPlaneNormal, vViewStart));

    // Add enough padding in the X screen space direction for glow
    float xPaddingPixels = sign(dot(viewPlaneNormal, viewPos.xyz)) * (extrude.x * 2.0 - 1.0) * glowWidth;
    ndcPos.x += xPaddingPixels * pixelToNDC.x;

    uv = ndcPos * 0.5 + 0.5;
    gl_Position = vec4(ndcPos, 0, 1);
  }
  `),t.fragment.uniforms.add("globalAlpha","float"),t.fragment.uniforms.add("perScreenPixelRatio","float"),t.fragment.code.add(n["a"]`
  float planeDistancePixels(vec4 plane, vec3 pos, vec3 start, vec3 end) {
    vec3 origin = mix(start, end, 0.5);
    vec3 basis = end - origin;
    vec3 posAtOrigin = pos - origin;

    float x = dot(normalize(basis), posAtOrigin);
    float y = dot(plane.xyz, posAtOrigin);

    float dx = max(abs(x) - length(basis), 0.0);
    float dy = y;

    float dist = length(vec2(dx, dy));

    float width = fwidth(y);
    float maxPixelDistance = length(pos) * perScreenPixelRatio * 2.0;
    float pixelDist = dist / min(width, maxPixelDistance);
    return abs(pixelDist);
  }

  void main() {
    vec3 pos;
    vec3 normal;
    float depthDiscontinuityAlpha;

    if (!laserlineReconstructFromDepth(pos, normal, depthDiscontinuityAlpha)) {
      discard;
    }

    float distance = planeDistancePixels(vViewPlane, pos, vViewStart, vViewEnd);

    vec4 color = laserlineProfile(distance);
    float alpha = 1.0 - smoothstep(0.995, 0.999, abs(dot(normal, vViewPlane.xyz)));

    gl_FragColor = laserlineOutput(color * alpha * depthDiscontinuityAlpha);
  }
  `),t}var a=Object.freeze({__proto__:null,build:o})},5715:function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));i("c120");var n=i("e92d"),r=i("6706"),s=i("7dcb");n["a"].getLogger("esri.views.interactive.snapping.hints.RightAngleSnappingHint");class o extends s["a"]{constructor(e,t,i){super(),this.previousVertex=e,this.centerVertex=t,this.nextVertex=i}equals(e){return e instanceof o&&Object(r["d"])(this.previousVertex,e.previousVertex)&&Object(r["d"])(this.centerVertex,e.centerVertex)&&Object(r["d"])(this.nextVertex,e.nextVertex)}}},"589c":function(e,t,i){"use strict";i("ba62")},"58c2":function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));var n=i("3886");function r(e){e.fragment.uniforms.add("projInfo","vec4"),e.fragment.uniforms.add("zScale","vec2"),e.fragment.code.add(n["a"]`
    vec3 reconstructPosition(vec2 fragCoord, float depth) {
      return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
    }
  `)}},"5e06":function(e,t,i){"use strict";i.r(t);var n=function(){var e=this,t=e.$createElement;e._self._c;return e._m(0)},r=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"wrap"},[i("div",{staticClass:"container",attrs:{id:"viewDiv"}})])}],s=i("3835"),o=i("1da1"),a=(i("96cf"),i("d81d"),i("99af"),i("4de4"),i("d3b7"),i("ddb0"),i("a15b"),i("159b"),i("b64b"),i("bc3a")),c=i.n(a),l=i("6d1b"),h=i("8d60"),d=i("f6ad"),p=i("a611"),u=i("5bd5"),f=i("ce0b"),b=i("955e"),g={name:"UserCluster",components:{},data:function(){return{totalNum:0,map:null,view:null,filterList:[{id:0,count:0,label:"",value:"ONLINE",active:!0},{id:1,count:0,label:"",value:"OFFLINE",active:!0},{id:2,count:0,label:"",value:"UNACTIVATED",active:!0}]}},mounted:function(){this.initMap(),this.initBind(),this.initDeviceLayer()},methods:{initMap:function(){var e=new l["a"]({basemap:"hybrid"}),t=new p["a"]({container:"viewDiv",map:e,zoom:11,center:[113.54735115356235,22.78385103258788]}),i=new d["a"]({view:t});t.ui.add(i,{position:"bottom-left"}),this.map=e,window._view=this.view=t},initBind:function(){var e=this;this.view.on("click",(function(t){e.view.hitTest(t).then((function(e){if(e.results&&e.results.length){var t=e.results[0].graphic.attributes;console.log("attribute".concat(JSON.stringify(t)))}}))}))},getUniqueValueInfos:function(){var e=this.filterList.map((function(e,t){return{value:e.value,symbol:{type:"picture-marker",url:"".concat("/study-arcgis/","/static/images/svg/camera_m_").concat(t+1,".svg")}}}));return e},initDeviceLayer:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var i,n,r,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.getDeviceData();case 2:i=t.sent,n=e.getUniqueValueInfos(),r={type:"cluster",clusterRadius:"100px",popupTemplate:{title:"",content:"{cluster_count},{cluster_type_91c828acc5960230bb07c9e0e6781429}",fieldInfos:[{fieldName:"cluster_count",format:{places:0,digitSeparator:!0}}]},clusterMinSize:"24px",clusterMaxSize:"60px",labelingInfo:[{deconflictionStrategy:"none",labelExpressionInfo:{expression:"Text($feature.cluster_count, '#,###')"},symbol:{type:"text",color:"#3744e7",haloColor:"#fff",haloSize:"2px",yoffset:4,font:{weight:"bold",size:"14px"}},labelPlacement:"center-center"}]},s=new u["default"]({id:"deviceLayer",title:"",fields:[{name:"ObjectID",type:"oid"},{name:"id",type:"string"},{name:"deviceUid",type:"string"},{name:"deviceStatus",type:"string"}],featureReduction:r,outFields:["*"],objectIdField:"ObjectID",geometryType:"point",source:[],renderer:{type:"unique-value",valueExpression:"return $feature.deviceStatus",uniqueValueInfos:n,visualVariables:[{type:"size",valueExpression:"$view.scale",stops:[{value:5e5,size:2},{value:25e4,size:10},{value:125e3,size:15},{value:32e3,size:30}]}]},popupTemplate:{title:"{deviceUid}",content:[{type:"fields",fieldInfos:[{label:"Uid",fieldName:"deviceUid"},{label:"id",fieldName:"id"},{label:"",fieldName:"deviceStatus"}]}]}}),e.map.add(s),s.applyEdits({addFeatures:i}).then((function(e){console.log("deleteFeatures:".concat(e.deleteFeatureResults.length)),console.log("addFeatures:".concat(e.addFeatureResults.length))}));case 8:case"end":return t.stop()}}),t)})))()},checkItem:function(e){e.active=!e.active;var t=this.filterList.filter((function(e){return 1==e.active})).map((function(e){return e.value}));this.filterDeviceLayer({mode:"deviceStatus",values:t})},initDraw:function(){var e=new f["a"]({id:"canvas",title:""});this.map.add(e);var t=new b["a"]({layer:e,view:this.view,creationMode:"update"});this.view.ui.add(t,"bottom-right"),t.on("update",(function(e){e.graphics[0].geometry&&console.log(JSON.stringify(e.graphics[0].geometry.rings))})),this.sketch=t},filterDeviceLayer:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.mode,i=e.values,n=void 0===i?[]:i,r=this.map.findLayerById("deviceLayer");this.view.whenLayerView(r).then((function(e){var i="";n.length>0&&(i+=n.map((function(e){return"".concat(t,"='").concat(e,"'")})).join(" OR ")),console.log("queryStr: ",i),e.filter={where:i},r.refresh()}))},countDeviceData:function(e){var t=this,i={ONLINE:{count:0,index:0},OFFLINE:{count:0,index:1},UNACTIVATED:{count:0,index:2}};e.forEach((function(e){var t=i[e.deviceStatus];t&&t.count++})),Object.keys(i).forEach((function(e){var n=i[e],r=n.index,s=n.count;t.filterList[r].count=s}))},getDeviceData:function(){var e=this;return new Promise((function(t){c.a.get("".concat("/study-arcgis/","/static/mockData.json")).then((function(i){var n=i.data.data,r=[];n.forEach((function(e){for(var t=0;t<50;t++){var i=Object(s["a"])(e.location,2),n=i[0],o=i[1],a=Math.random(),c=Math.random(),l=(new Date).getTime();n+=(a>.5?1:-1)*a*1,o+=(c>.5?1:-1)*c*1,r.push({id:l,deviceUid:l,location:[n,o],deviceStatus:"UNACTIVATED"})}})),n=n.concat(r),console.log("data count: ".concat(n.length)),e.countDeviceData(n);var o=[];n.forEach((function(e){var t=Object(s["a"])(e.location,2),i=t[0],n=t[1],r=new h["a"]({geometry:{type:"point",latitude:n,longitude:i},attributes:e});o.push(r)})),t(o)}))}))}}},m=g,v=(i("aa4b"),i("589c"),i("2877")),y=Object(v["a"])(m,n,r,!1,null,"50483cc8",null);t["default"]=y.exports},"5ef2":function(e,t,i){"use strict";function n(){return new Float32Array(4)}function r(e){const t=new Float32Array(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function s(e,t,i,n){const r=new Float32Array(4);return r[0]=e,r[1]=t,r[2]=i,r[3]=n,r}function o(e,t){return new Float32Array(e,t,4)}function a(){return n()}function c(){return s(1,1,1,1)}function l(){return s(1,0,0,0)}function h(){return s(0,1,0,0)}function d(){return s(0,0,1,0)}function p(){return s(0,0,0,1)}i.d(t,"a",(function(){return r})),i.d(t,"b",(function(){return n})),i.d(t,"c",(function(){return s}));const u=a(),f=c(),b=l(),g=h(),m=d(),v=p();Object.freeze({__proto__:null,create:n,clone:r,fromValues:s,createView:o,zeros:a,ones:c,unitX:l,unitY:h,unitZ:d,unitW:p,ZEROS:u,ONES:f,UNIT_X:b,UNIT_Y:g,UNIT_Z:m,UNIT_W:v})},"5fae":function(e,t,i){"use strict";i.d(t,"a",(function(){return l}));var n=i("b2b2"),r=i("d791"),s=i("afe1"),o=i("5a22"),a=i("748f"),c=i("f53a");class l extends c["a"]{constructor(e){super(e.view),this._resources=null,this._transform=Object(s["b"])()}get object(){return Object(n["k"])(this._resources)?this._resources.object:null}get transform(){return this._transform}set transform(e){Object(r["c"])(this._transform,e),Object(n["k"])(this._resources)&&(this._resources.object.transformation=this._transform,this._resources.layer.commit())}recreate(){this.attached&&this.createResources()}recreateGeometry(){if(Object(n["j"])(this._resources))return;const e=this._resources.object,t=this.view._stage;t.removeMany(e.geometries),e.removeAllGeometries(),this.createGeometries(e),this.visible||e.setVisible(this.visible),t.addMany(e.geometries),this._resources.layer.commit()}createResources(){this.destroyResources();const e=this.view._stage;if(!e)return;const t=new a["a"]({isPickable:!1});e.add(t);const i=new o["a"]({castShadow:!1});i.transformation=this._transform,this.createExternalResources(),this.createGeometries(i),e.addMany(i.geometries),this.forEachExternalMaterial(t=>e.add(t)),e.add(i),t.add(i),t.commit(),this.visible||(i.setVisible(!1),t.commit()),this._resources={layer:t,object:i}}destroyResources(){const e=this.view._stage;!Object(n["j"])(this._resources)&&e&&(e.remove(this._resources.object),e.remove(this._resources.layer),this.forEachExternalMaterial(t=>{e.remove(t),t.dispose()}),e.removeMany(this._resources.object.geometries),this._resources.object.dispose(),this.destroyExternalResources(),this._resources=null)}updateVisibility(e){Object(n["j"])(this._resources)||(this._resources.object.setVisible(e),this._resources.layer.commit())}}},6469:function(e,t,i){"use strict";i.d(t,"a",(function(){return x}));var n=i("a4ee"),r=(i("c120"),i("7ffa")),s=i("b2b2"),o=(i("e92d"),i("cea0"),i("59b2"),i("d386")),a=(i("e041"),i("8eed"),i("f402"),i("f4cc")),c=i("4ae5"),l=(i("e06a"),i("ce6d")),h=i("a915"),d=i("af40"),p=i("9305"),u=i("3563"),f=i("8b1a"),b=i("6ae9"),g=i("27df"),m=i("1f1c"),v=i("c20d"),y=i("3510"),_=i("feba");class O{constructor({grabbableForEvent:e}){this.events=new l["a"],this.interactive=!0,this.selectable=!1,this.cursor=null,this.grabbable=!0,this.grabbableForEvent=e}intersectionDistance(e,t){return 0}attach(){}detach(){}}var j=i("4aea");let x=class extends l["a"]{constructor(e){var t,i;super(),this._manipulator=null,this._stagedVertex=null,this.geometryType=null,this.elevationInfo=null,this.snapToSceneEnabled=null,this._handles=new d["a"],this._defaultZ=0,this._elevationDrawSurface=null,this._snappingDrawSurface=null,this._snappingManager=null,this._snappingPipeline=new y["a"],this._createOperationCompleted=!1,this._pointerDownStates=new Set,this._snappingTask=null,this.view=e.view,this.drawingMode=Object(s["u"])(e.drawingMode,j["a"]),this.geometryType=e.geometryType,this.elevationInfo=e.elevationInfo,this.coordinateHelper=Object(f["a"])(e.hasZ,e.hasM,this.view.spatialReference,this.view.viewingMode),this._defaultZ=e.defaultZ,this.snapToSceneEnabled=e.snapToSceneEnabled,this._snappingDrawSurface=Object(s["t"])(e.snappingDrawSurface),this._snappingManager=e.snappingManager;const n=null==(t=e.view)||null==(i=t.resourceController)?void 0:i.scheduler;this._frameTask=n?n.registerTask(p["b"].SNAPPING,e=>this._frameTask.processQueue(e),()=>!1):p["a"],this._elevationDrawSurface=e.elevationDrawSurface,this._editGeometry=new g["a"](new b["c"](this.coordinateHelper),"segment"===this.geometryType?"polyline":this.geometryType),this._activeComponent=new b["a"](this._editGeometry.editGeometry),this._editGeometry.editGeometry.components.push(this._activeComponent),this._editGeometry.on(["vertex-add","vertex-update","vertex-remove"],e=>{const t=e.vertices.map(e=>({componentIndex:0,vertexIndex:e.index,coordinates:this.coordinateHelper.toArray(e.pos)})),i=t.map(e=>e.coordinates);switch(e.type){case"vertex-add":this.emit(e.type,{...e,added:i,vertices:t});break;case"vertex-update":this.emit(e.type,{...e,updated:i,vertices:t});break;case"vertex-remove":this.emit(e.type,{...e,removed:i,vertices:t})}}),this._manipulator=new O({grabbableForEvent:e=>"click"!==this.drawingMode||"touch"===e.pointerType&&this._snappingEnabled&&1===this._pointerDownStates.size}),e.manipulators.add(this._manipulator),this._manipulator.grabbable="point"!==this.geometryType;const r=this.createManipulatorDragPipeline(this._manipulator),o=this._manipulator.events.on("immediate-double-click",e=>{this._manipulator.dragging||"point"===this.geometryType||(this.complete(),e.stopPropagation())}),a=this._manipulator.events.on("immediate-click",e=>{if(this._manipulator.dragging)return;const t=this._activeComponent,i=this._closeOnClickVertexIndex(e.screenPoint);if(Object(s["k"])(i))this.discardStagedVertex(),this.complete();else{const i=this._screenToMap(e.screenPoint);if(Object(s["k"])(i))switch(this.drawingMode){case"freehand":break;case"click":case"hybrid":this._snappingTask=Object(s["a"])(this._snappingTask),this.hasStagedVertex?this.commitStagedVertex():this._editGeometry.appendVertex(this.coordinateHelper.fromPoint(i)),("point"===this.geometryType||"segment"===this.geometryType&&2===t.vertices.length||"segment"===this.geometryType&&"hybrid"===this.drawingMode&&1===t.vertices.length)&&this.complete()}}e.stopPropagation()});this._handles.add([r,a,o])}get isCompleted(){return this._createOperationCompleted}get _snappingEnabled(){return Object(s["k"])(this._snappingManager)&&this._snappingManager.options.effectiveEnabled}createManipulatorDragPipeline(e){switch(this.drawingMode){case"click":return this.createManipulatorDragPipelineClick(e);case"freehand":return this.createManipulatorDragPipelineFreehand(e);case"hybrid":return this.createManipulatorDragPipelineHybrid(e)}}createManipulatorDragPipelineClick(e){return Object(v["e"])(e,(e,t,i,n)=>{const r="touch"===n&&this._snappingEnabled;!this.isCompleted&&r&&(t.next(this._screenToMapDragEventStep()).next(e=>("start"===e.action&&(this.stagedVertex=e.mapStart,("segment"===this.geometryType||r&&0===this.vertices.length)&&this.commitStagedVertex()),e)).next(this._snappingPipeline.createSnapDragEventPipelineStep({predicate:()=>r,cancel:i,snappingManager:this._snappingManager,snappingContext:new m["a"]({geometry:this._editGeometry,elevationInfo:this.elevationInfo,pointer:n,visualizer:new _["a"]})}),this._snappingPipeline.next).next(e=>(r&&(this.stagedVertex=e.mapEnd,"end"===e.action&&this.commitStagedVertex()),e)).next(e=>("end"===e.action&&("segment"!==this.geometryType&&"point"!==this.geometryType||this.complete()),e)),i.next(()=>{r&&Object(s["k"])(this._snappingManager)&&this._snappingManager.doneSnapping()}))})}createManipulatorDragPipelineFreehand(e){return Object(v["e"])(e,(e,t)=>{this.isCompleted||t.next(this._screenToMapDragEventStep()).next(e=>("start"===e.action&&(this.stagedVertex=e.mapStart,"segment"===this.geometryType&&this.commitStagedVertex()),e)).next(e=>{switch(e.action){case"start":case"update":this.stagedVertex=e.mapEnd,"polygon"!==this.geometryType&&"polyline"!==this.geometryType||this.commitStagedVertex();break;case"end":this.complete()}return e})})}createManipulatorDragPipelineHybrid(e){return Object(v["e"])(e,(e,t)=>{this.isCompleted||t.next(this._screenToMapDragEventStep()).next(e=>("start"===e.action&&(this.stagedVertex=e.mapStart,this.commitStagedVertex()),e)).next(e=>{switch(e.action){case"start":case"update":this.stagedVertex=e.mapEnd,"polygon"!==this.geometryType&&"polyline"!==this.geometryType||this.commitStagedVertex();break;case"end":"segment"!==this.geometryType&&"point"!==this.geometryType||this.complete()}return e})})}destroy(){this._handles.destroy(),this._handles=null,this._editGeometry.destroy(),this._frameTask.remove()}onInputEvent(e){switch(e.type){case"pointer-down":this._pointerDownStates.add(e.pointerId);break;case"pointer-up":this._pointerDownStates.delete(e.pointerId)}switch(e.type){case"pointer-move":return this._onPointerMove(e);case"hold":return this._onHold(e)}}get canRedo(){return this._editGeometry.canRedo}redo(){this._editGeometry.redo()}get canUndo(){return this._editGeometry.canUndo}undo(){Object(s["k"])(this._snappingManager)&&this._snappingManager.doneSnapping(),this._editGeometry.undo()}complete(e=!1){Object(s["a"])(this._snappingTask),this.commitStagedVertex(),this._createOperationCompleted=!0,Object(s["k"])(this._snappingManager)&&this._snappingManager.doneSnapping(),this.emit("complete",{vertices:this.vertices.map((e,t)=>({componentIndex:0,vertexIndex:t,coordinates:e})),aborted:e,type:"complete"})}cancel(){this.complete(!0)}get interactive(){return this._manipulator.interactive}set interactive(e){this._manipulator.interactive=e}get numVertices(){return Object(s["k"])(this._stagedVertex)?this._activeComponent.vertices.length+1:this._activeComponent.vertices.length}get numCommittedVertices(){return this._activeComponent.vertices.length}get vertices(){const e=this._activeComponent.vertices.map(e=>this.coordinateHelper.toArray(e.pos));return Object(s["k"])(this._stagedVertex)&&e.push(this.coordinateHelper.pointToArray(this._stagedVertex)),e}get spatialReference(){return this.view.spatialReference}get hasStagedVertex(){return Object(s["k"])(this._stagedVertex)}get stagedVertex(){return this._stagedVertex}set stagedVertex(e){if(Object(s["j"])(e))return void this.discardStagedVertex();if(Object(s["k"])(this._stagedVertex)&&Object(u["b"])(this._stagedVertex,e))return;Object(s["j"])(this._stagedVertex)?this._stagedVertex=Object(r["a"])(e):(this._stagedVertex.x=e.x,this._stagedVertex.y=e.y,this._stagedVertex.z=e.z,this._stagedVertex.m=e.m,this._stagedVertex.hasZ=e.hasZ,this._stagedVertex.hasM=e.hasM,this._stagedVertex.spatialReference=e.spatialReference);const t={componentIndex:0,vertexIndex:this._activeComponent.vertices.length,coordinates:this.coordinateHelper.pointToArray(e)};this.emit("cursor-update",{updated:null,vertices:[t],operation:"apply",type:"vertex-update"})}commitStagedVertex(){if(this._snappingTask=Object(s["a"])(this._snappingTask),Object(s["k"])(this._stagedVertex)){const e=this._stagedVertex;this._stagedVertex=null,this._editGeometry.appendVertex(this.coordinateHelper.fromPoint(e))}}discardStagedVertex(){this._stagedVertex=null}_onPointerMove(e){if(Object(s["a"])(this._snappingTask),this._manipulator.dragging||this._pointerDownStates.has(e.pointerId)||this._manipulator.grabbing||!this._manipulator.interactive)return;const t=Object(h["f"])(e.x,e.y),i=this._closeOnClickVertexIndex(t);if(Object(s["k"])(i)){this.discardStagedVertex();const e={componentIndex:0,vertexIndex:i,coordinates:this.coordinateHelper.toArray(this._activeComponent.vertices[i].pos)};this.emit("cursor-update",{updated:null,vertices:[e],operation:"apply",type:"vertex-update"})}else{const i=this._screenToMap(t);if(this._manipulator.cursor=Object(s["k"])(i)?"crosshair":null,Object(s["k"])(i))if(Object(s["k"])(this._snappingManager)){const t=this._snappingManager,n=new m["a"]({geometry:this._editGeometry,elevationInfo:this.elevationInfo,pointer:e.pointerType,visualizer:new _["a"]});this.stagedVertex=t.update(i,n),this._snappingTask=Object(a["i"])(async e=>{const r=await this._frameTask.schedule(()=>t.snap(i,n,e),e);r.valid&&await this._frameTask.schedule(()=>{this.stagedVertex=r.apply()},e)})}else this.stagedVertex=i}e.stopPropagation()}_onHold(e){Object(s["a"])(this._snappingTask),"click"===this.drawingMode&&"touch"===e.pointerType&&this._snappingEnabled&&(this.stagedVertex=e.mapPoint),e.stopPropagation()}_screenToMapDragEventStep(){let e=null;return t=>{if("start"===t.action&&(e=this._screenToMap(t.screenStart)),Object(s["j"])(e))return null;const i=this._screenToMap(t.screenEnd);return Object(s["k"])(i)?{...t,mapStart:e,mapEnd:i}:null}}_screenToMap(e){return this._getDrawSurface().screenToMap(e)}_mapToScreen(e){return this._getDrawSurface().mapToScreen(e)}_getDrawSurface(){let e=null;if(this.coordinateHelper.hasZ){let t=this._defaultZ,i=!1;Object(s["k"])(this.elevationInfo)&&"absolute-height"===this.elevationInfo.mode&&(i=!0),Object(s["k"])(this.snapToSceneEnabled)&&(i=this.snapToSceneEnabled),Object(s["k"])(this.elevationInfo)&&"on-the-ground"===this.elevationInfo.mode&&(i=!1);const n=this._activeComponent.vertices.length;("segment"===this.geometryType||"polygon"===this.geometryType)&&n>0&&(t=this.coordinateHelper.getZ(this._activeComponent.vertices[0].pos),i=!1),i?e=this._snappingDrawSurface:(this._elevationDrawSurface.defaultZ=t,e=this._elevationDrawSurface)}else this._elevationDrawSurface.defaultZ=null,e=this._elevationDrawSurface;return e}_vertexWithinPointerDistance(e,t){const i=25,n=this._mapToScreen(e);return!!Object(s["k"])(n)&&w(n,t,i)}_closeOnClickVertexIndex(e){const t=this._activeComponent;if("polygon"===this.geometryType&&t.vertices.length>2){if(this._vertexWithinPointerDistance(this.coordinateHelper.toPoint(t.vertices[0].pos,S),e))return 0;if(this._vertexWithinPointerDistance(this.coordinateHelper.toPoint(t.vertices[t.vertices.length-1].pos,S),e))return t.vertices.length-1}return null}};function w(e,t,i){const n=e.x-t.x,r=e.y-t.y;return n*n+r*r<=i}x=Object(n["a"])([Object(o["a"])("esri.views.3d.interactive.editingTools.draw3D.DrawOperation")],x);const S=new c["a"]({x:0,y:0,z:0})},"647b":function(e,t,i){"use strict";i.d(t,"a",(function(){return Z}));var n=i("b2b2"),r=i("0b2d"),s=i("e431"),o=i("d0ac"),a=i("f53a"),c=i("a997"),l=i("38a4"),h=i("02f1"),d=i("0fc4"),p=i("7577"),u=i("1153"),f=i("d5f7"),b=i("7c51"),g=i("a4ee"),m=i("d791"),v=i("afe1"),y=i("c3a4"),_=i("ca98"),O=i("da35"),j=i("8e37"),x=i("189c"),w=i("56d6");class S extends _["a"]{initializeProgram(e){const t=S.shader.get(),i=this.configuration,n=t.build(i);return new j["a"](e.rctx,n.generateSource("vertex"),n.generateSource("fragment"),S.attributeLocations)}bind(e,t,i){this.program.setUniform3fv("innerColor",e.innerColor),this.program.setUniform1f("innerWidth",e.innerWidth*i.pixelRatio),this.program.setUniform3fv("glowColor",e.glowColor),this.program.setUniform1f("glowWidth",e.glowWidth*i.pixelRatio),this.program.setUniform1f("glowFalloff",e.glowFalloff),this.program.setUniform1f("globalAlpha",e.globalAlpha),this.program.setUniform1f("perScreenPixelRatio",i.perScreenPixelRatio),this.program.setUniform2f("pixelToNDC",2/i.fullWidth,2/i.fullHeight),this.program.setUniformMatrix4fv("uProjectionMatrix",i.projectionMatrix),Object(m["t"])(C,i.viewMatrix,t),this.program.setUniformMatrix4fv("uModelViewMatrix",C),this.configuration.contrastControlEnabled&&this.program.setUniform1f("globalAlphaContrastBoost",null!=e.globalAlphaContrastBoost?e.globalAlphaContrastBoost:1)}initializePipeline(){return Object(x["e"])({blending:Object(x["g"])(1,771),colorWrite:x["c"]})}bindPipelineState(e){e.setPipelineState(this.pipeline)}}S.shader=new y["a"](w["a"],()=>i.e("chunk-2d22cca6").then(i.bind(null,"f578"))),S.attributeLocations={start:0,end:1,up:2,extrude:3};class P extends O["a"]{constructor(){super(...arguments),this.contrastControlEnabled=!1}}Object(g["a"])([Object(O["b"])()],P.prototype,"contrastControlEnabled",void 0);const C=Object(v["b"])();i("c120"),i("9f8b");var T=i("2ebb"),E=i("fc00"),A=i("7ce4"),M=i("0fa6");i("d267");class k{constructor(e){this._renderCoordsHelper=e,this._buffers=null,this._origin=Object(r["e"])(),this._dirty=!1,this._count=0,this._vao=null}set vertices(e){const t=new Float64Array(3*e.length);let i=0;for(const n of e)t[i++]=n[0],t[i++]=n[1],t[i++]=n[2];this.buffers=[t]}set buffers(e){if(this._buffers=e,this._buffers.length>0){const e=this._buffers[0],t=3*Math.floor(e.length/3/2);Object(s["x"])(this._origin,e[t+0],e[t+1],e[t+2])}else Object(s["x"])(this._origin,0,0,0);this._dirty=!0}get origin(){return this._origin}draw(e){const t=this.ensureVAO(e);Object(n["k"])(t)&&(e.bindVAO(t),e.drawArrays(4,0,this._count))}dispose(){Object(n["k"])(this._vao)&&this._vao.dispose()}ensureVAO(e){return Object(n["j"])(this._buffers)?null:(Object(n["j"])(this._vao)&&(this._vao=this.createVAO(e,this._buffers)),this.ensureVertexData(this._vao,this._buffers),this._vao)}createVAO(e,t){const i=this.createDataBuffer(t);return this._dirty=!1,new M["a"](e,S.attributeLocations,{data:Object(T["a"])(G)},{data:A["a"].createVertex(e,35044,i)})}ensureVertexData(e,t){if(!this._dirty)return;const i=this.createDataBuffer(t);e.vertexBuffers.data.setData(i),this._dirty=!1}numberOfRenderVertices(e){return 2*(e.length/3-1)*3}createDataBuffer(e){const t=e.reduce((e,t)=>e+this.numberOfRenderVertices(t),0);this._count=t;const i=G.createBuffer(t),n=this._origin;let r=0,o=0;for(const a of e){for(let e=0;e<a.length;e+=3){const t=Object(s["x"])(D,a[e+0],a[e+1],a[e+2]);0===e?o=this._renderCoordsHelper.getAltitude(t):this._renderCoordsHelper.setAltitude(o,t);const c=this._renderCoordsHelper.worldUpAtPosition(t,V),l=r+2*e,h=Object(s["k"])(D,t,n);if(e<a.length-3){i.up.setVec(l,c),i.up.setVec(l+3,c),i.up.setVec(l+5,c);for(let e=0;e<6;e++)i.start.setVec(l+e,h);i.extrude.setValues(l+0,0,-1),i.extrude.setValues(l+1,1,-1),i.extrude.setValues(l+2,1,1),i.extrude.setValues(l+3,0,-1),i.extrude.setValues(l+4,1,1),i.extrude.setValues(l+5,0,1)}if(e>0){i.up.setVec(l-2,c),i.up.setVec(l-4,c),i.up.setVec(l-5,c);for(let e=-6;e<0;e++)i.end.setVec(l+e,h)}}r+=this.numberOfRenderVertices(a)}return i.buffer}}const V=Object(r["e"])(),D=Object(r["e"])(),G=Object(E["a"])().vec3f("start").vec3f("end").vec3f("up").vec2f("extrude");var I=i("fa1e");class R extends _["a"]{initializeProgram(e){const t=R.shader.get(),i=this.configuration,n=t.build(i);return new j["a"](e.rctx,n.generateSource("vertex"),n.generateSource("fragment"),I["a"])}bind(e,t){this.program.setUniform3fv("innerColor",e.innerColor),this.program.setUniform1f("innerWidth",e.innerWidth*t.pixelRatio),this.program.setUniform3fv("glowColor",e.glowColor),this.program.setUniform1f("glowWidth",e.glowWidth*t.pixelRatio),this.program.setUniform1f("glowFalloff",e.glowFalloff),this.program.setUniform1f("globalAlpha",e.globalAlpha),this.configuration.contrastControlEnabled&&this.program.setUniform1f("globalAlphaContrastBoost",null!=e.globalAlphaContrastBoost?e.globalAlphaContrastBoost:1);const i=null!=e.angleCutoff?e.angleCutoff:c["c"];this.program.setUniform2f("angleCutoff",Math.cos(i),Math.cos(Math.max(0,i-Object(l["f"])(2)))),this.configuration.intersectsLineEnabled&&this.program.setUniform1f("perScreenPixelRatio",t.perScreenPixelRatio)}initializePipeline(){return Object(x["e"])({blending:Object(x["g"])(1,771),colorWrite:x["c"]})}}R.shader=new y["a"](c["a"],()=>i.e("chunk-2d2248f1").then(i.bind(null,"e13b")));class z extends O["a"]{constructor(){super(...arguments),this.heightManifoldEnabled=!1,this.pointDistanceEnabled=!1,this.lineVerticalPlaneEnabled=!1,this.intersectsLineEnabled=!1,this.contrastControlEnabled=!1}}Object(g["a"])([Object(O["b"])()],z.prototype,"heightManifoldEnabled",void 0),Object(g["a"])([Object(O["b"])()],z.prototype,"pointDistanceEnabled",void 0),Object(g["a"])([Object(O["b"])()],z.prototype,"lineVerticalPlaneEnabled",void 0),Object(g["a"])([Object(O["b"])()],z.prototype,"intersectsLineEnabled",void 0),Object(g["a"])([Object(O["b"])()],z.prototype,"contrastControlEnabled",void 0);const L=Object(r["e"])(),H=Object(d["c"])(),U={glowColor:[1,.5,0],glowWidth:8,glowFalloff:8,innerColor:[1,1,1],innerWidth:1,globalAlpha:.75,angleCutoff:Object(l["f"])(6),globalAlphaContrastBoost:2};function F(e,t,i,n){const r=L,a=H;Object(s["n"])(r,t,n),Object(s["l"])(a,i),a[3]=0,Object(p["m"])(a,a,n),o["f"].fromPositionAndNormal(r,a,e)}class q{constructor(e,t={},i={contrastControlEnabled:!1}){this._renderCoordsHelper=e,this._config=i,this._technique=null,this._projInfo=Object(d["c"])(),this._zScale=Object(h["b"])(),this._heightManifoldEnabled=!1,this._heightManifoldTarget=Object(r["e"])(),this._pointDistanceEnabled=!1,this._pointDistanceOrigin=Object(r["e"])(),this._pointDistanceTarget=Object(r["e"])(),this._lineVerticalPlaneEnabled=!1,this._lineVerticalPlaneSegment=o["e"].create(),this._intersectsLineEnabled=!1,this._intersectsLineSegment=o["e"].create(),this._intersectsLineRadius=3,this._intersectsLineInfinite=!1,this._pathVerticalPlaneEnabled=!1,this._pathVerticalPlaneData=null,this._pathTechnique=null,this.canRender=!0,this._tempNormal=Object(r["e"])(),this._tempDir=Object(r["e"])(),this._tempUp=Object(r["e"])(),this._tempVec3A=Object(r["e"])(),this._tempVec3B=Object(r["e"])(),this._tempVec4=Object(d["c"])(),this._tempPlane=o["f"].create(),this._tempSphere=o["h"].create(),this._params=Object(b["e"])(t,U)}get renderSlots(){return[this._config.contrastControlEnabled?17:16]}get needsLinearDepth(){return!0}get heightManifoldEnabled(){return this._heightManifoldEnabled}set heightManifoldEnabled(e){this._heightManifoldEnabled!==e&&(this._heightManifoldEnabled=e,this._requestRender())}get heightManifoldTarget(){return this._heightManifoldTarget}set heightManifoldTarget(e){Object(s["l"])(this._heightManifoldTarget,e),this._requestRender()}get pointDistanceEnabled(){return this._pointDistanceEnabled}set pointDistanceEnabled(e){e!==this._pointDistanceEnabled&&(this._pointDistanceEnabled=e,this._requestRender())}get pointDistanceTarget(){return this._pointDistanceTarget}set pointDistanceTarget(e){Object(s["l"])(this._pointDistanceTarget,e),this._requestRender()}get pointDistanceOrigin(){return this._pointDistanceOrigin}set pointDistanceOrigin(e){Object(s["l"])(this._pointDistanceOrigin,e),this._requestRender()}get lineVerticalPlaneEnabled(){return this._lineVerticalPlaneEnabled}set lineVerticalPlaneEnabled(e){e!==this._lineVerticalPlaneEnabled&&(this._lineVerticalPlaneEnabled=e,this._requestRender())}get lineVerticalPlaneSegment(){return this._lineVerticalPlaneSegment}set lineVerticalPlaneSegment(e){o["e"].copy(e,this._lineVerticalPlaneSegment),this._requestRender()}get intersectsLineEnabled(){return this._intersectsLineEnabled}set intersectsLineEnabled(e){e!==this._intersectsLineEnabled&&(this._intersectsLineEnabled=e,this._requestRender())}get intersectsLineSegment(){return this._intersectsLineSegment}set intersectsLineSegment(e){o["e"].copy(e,this._intersectsLineSegment),this._requestRender()}get intersectsLineRadius(){return this._intersectsLineRadius}set intersectsLineRadius(e){e!==this._intersectsLineRadius&&(this._intersectsLineRadius=e,this._requestRender())}get intersectsLineInfinite(){return this._intersectsLineInfinite}set intersectsLineInfinite(e){e!==this._intersectsLineInfinite&&(this._intersectsLineInfinite=e,this._requestRender())}get pathVerticalPlaneEnabled(){return this._pathVerticalPlaneEnabled}set pathVerticalPlaneEnabled(e){e!==this._pathVerticalPlaneEnabled&&(this._pathVerticalPlaneEnabled=e,Object(n["k"])(this._pathVerticalPlaneData)&&this._requestRender())}set pathVerticalPlaneVertices(e){Object(n["j"])(this._pathVerticalPlaneData)&&(this._pathVerticalPlaneData=new k(this._renderCoordsHelper)),this._pathVerticalPlaneData.vertices=e,this.pathVerticalPlaneEnabled&&this._requestRender()}set pathVerticalPlaneBuffers(e){Object(n["j"])(this._pathVerticalPlaneData)&&(this._pathVerticalPlaneData=new k(this._renderCoordsHelper)),this._pathVerticalPlaneData.buffers=e,this.pathVerticalPlaneEnabled&&this._requestRender()}setParameterValues(e){Object(b["k"])(this._params,e)&&this._requestRender()}initializeRenderContext(e){this._context=e;const t=e.renderContext.rctx;this._quadVAO=Object(f["d"])(t),this._techniqueRepository=e.shaderTechniqueRep,this._techniqueConfig=new z,this._pathTechniqueConfig=new P}uninitializeRenderContext(){this._quadVAO=Object(n["f"])(this._quadVAO),this._techniqueRepository.release(this._technique),this._technique=null,this._pathVerticalPlaneData=Object(n["f"])(this._pathVerticalPlaneData),this._techniqueRepository.release(this._pathTechnique),this._pathTechnique=null}render(e){const t=this.heightManifoldEnabled||this.pointDistanceEnabled||this.lineVerticalPlaneSegment||this.intersectsLineEnabled,i=this.pathVerticalPlaneEnabled;if(!t&&!i)return!0;const n=e.camera;return Object(u["f"])(n.projectionMatrix,n.fullWidth,n.fullHeight,this._projInfo,this._zScale),t&&this.renderUnified(e),i&&this.renderPath(e),!0}renderUnified(e){const t=e.rctx,i=this._selectTechnique(),n=i.program;t.bindProgram(n),i.bindPipelineState(t),this.bindGlobalUniforms(e,n),this.bindHeightManifoldUniforms(e,n),this.bindPointDistanceUniforms(e,n),this.bindLineVerticalPlaneUniforms(e,n),this.bindIntersectsLineUniforms(e,n),i.bind(this._params,e.camera),t.bindVAO(this._quadVAO),t.drawArrays(5,0,4)}renderPath(e){if(Object(n["j"])(this._pathVerticalPlaneData))return;this._pathTechniqueConfig.contrastControlEnabled=this._config.contrastControlEnabled,this._pathTechnique=this._techniqueRepository.acquireAndReleaseExisting(S,this._pathTechniqueConfig,this._pathTechnique);const t=e.rctx,i=this._pathTechnique,r=i.program;t.bindProgram(r),i.bindPipelineState(t),this.bindGlobalUniforms(e,r),i.bind(this._params,this._pathVerticalPlaneData.origin,e.camera),this._pathVerticalPlaneData.draw(e.rctx)}bindHeightManifoldUniforms(e,t){if(!this.heightManifoldEnabled)return;const i=this._tempVec3A,n=this._tempPlane;this._renderCoordsHelper.worldUpAtPosition(this._heightManifoldTarget,i),F(n,this._heightManifoldTarget,i,e.camera.viewMatrix),t.setUniform4fv("heightPlane",n)}bindPointDistanceUniforms(e,t){if(!this._pointDistanceEnabled)return;const i=e.camera,n=this._tempSphere;Object(s["l"])(n,this._pointDistanceOrigin),Object(s["n"])(n,n,i.viewMatrix),n[3]=Object(s["p"])(this._pointDistanceOrigin,this._pointDistanceTarget),t.setUniform4f("pointDistanceSphere",n[0],n[1],n[2],n[3])}bindLineVerticalPlaneUniforms(e,t){if(!this._lineVerticalPlaneEnabled)return;const i=this._renderCoordsHelper,n=e.camera,r=this._tempPlane,a=this._tempVec3A,c=this._tempUp,l=this._tempDir,h=this._tempNormal;o["e"].pointAt(this._lineVerticalPlaneSegment,.5,a),i.worldUpAtPosition(a,c),Object(s["s"])(l,this._lineVerticalPlaneSegment.vector),Object(s["h"])(h,c,l),Object(s["s"])(h,h),F(r,this._lineVerticalPlaneSegment.origin,h,n.viewMatrix),t.setUniform4fv("lineVerticalPlane",r);const d=this._tempVec3A;Object(s["l"])(d,this._lineVerticalPlaneSegment.origin),i.setAltitude(0,d),Object(s["n"])(d,d,n.viewMatrix),t.setUniform3fv("lineVerticalStart",d);const p=this._tempVec3B;Object(s["g"])(p,this._lineVerticalPlaneSegment.origin,this._lineVerticalPlaneSegment.vector),i.setAltitude(0,p),Object(s["n"])(p,p,n.viewMatrix),t.setUniform3fv("lineVerticalEnd",p)}bindIntersectsLineUniforms(e,t){if(!this._intersectsLineEnabled)return;const i=B,n=W;if(this._intersectsLineInfinite){const t=e.camera;if(o["c"].fromRay(o["g"].wrap(this._intersectsLineSegment.origin,this._intersectsLineSegment.vector),N),N.c0=-Number.MAX_VALUE,!o["d"].intersectClipRay(t.frustum,N))return;o["c"].getStart(N,i),o["c"].getEnd(N,n)}else Object(s["l"])(i,this._intersectsLineSegment.origin),Object(s["g"])(n,this._intersectsLineSegment.origin,this._intersectsLineSegment.vector);const r=this._tempVec3A;Object(s["n"])(r,i,e.camera.viewMatrix),t.setUniform3fv("intersectsLineStart",r);const a=this._tempVec4;Object(s["l"])(a,this._intersectsLineSegment.vector),this._tempVec4[3]=0,Object(p["m"])(this._tempVec4,this._tempVec4,e.camera.viewMatrix),Object(s["n"])(n,n,e.camera.viewMatrix),t.setUniform3fv("intersectsLineEnd",n),Object(s["s"])(a,a),t.setUniform3f("intersectsLineDirection",a[0],a[1],a[2]),t.setUniform1f("intersectsLineRadius",this._intersectsLineRadius)}bindGlobalUniforms(e,t){const i=e.camera;t.setUniform4fv("projInfo",this._projInfo),t.setUniform2fv("zScale",this._zScale),t.setUniform2f("nearFar",i.near,i.far),this._heightManifoldEnabled?t.setUniform1f("maxPixelDistance",2*i.computeScreenPixelSizeAt(this._heightManifoldTarget)):this._pointDistanceEnabled?t.setUniform1f("maxPixelDistance",2*i.computeScreenPixelSizeAt(this._pointDistanceTarget)):this._lineVerticalPlaneEnabled&&t.setUniform1f("maxPixelDistance",2*i.computeScreenPixelSizeAt(this._lineVerticalPlaneSegment.origin)),t.setUniform1i("depthMap",0),e.rctx.bindTexture(e.offscreenRenderingHelper.linearDepthTexture,0),t.setUniform1i("frameColor",1),e.rctx.bindTexture(e.offscreenRenderingHelper.mainColorTexture,1)}_requestRender(){this._context&&this._context.requestRender()}_selectTechnique(){return this._techniqueConfig.heightManifoldEnabled=this.heightManifoldEnabled,this._techniqueConfig.lineVerticalPlaneEnabled=this.lineVerticalPlaneEnabled,this._techniqueConfig.pointDistanceEnabled=this.pointDistanceEnabled,this._techniqueConfig.intersectsLineEnabled=this.intersectsLineEnabled,this._techniqueConfig.contrastControlEnabled=this._config.contrastControlEnabled,this._technique=this._techniqueRepository.acquireAndReleaseExisting(R,this._techniqueConfig,this._technique),this._technique}}const N=o["c"].create(),B=Object(r["e"])(),W=Object(r["e"])();class Z extends a["a"]{constructor(e){super(e.view),this._angleCutoff=c["c"],this._style={},this._heightManifoldTarget=Object(r["e"])(),this._heightManifoldEnabled=!1,this._intersectsLine=o["e"].create(),this._intersectsLineEnabled=!1,this._intersectsLineInfinite=!1,this._lineVerticalPlaneSegment=null,this._pathVerticalPlaneBuffers=null,this._pointDistanceLine=null,this.applyProps(e)}get testData(){return this.renderer}createResources(){this.ensureRenderer()}destroyResources(){this.disposeRenderer()}updateVisibility(){this.syncHeightManifold(),this.syncIntersectsLine(),this.syncPathVerticalPlane(),this.syncLineVerticalPlane(),this.syncPointDistance()}get angleCutoff(){return this._angleCutoff}set angleCutoff(e){this._angleCutoff!==e&&(this._angleCutoff=e,this.syncAngleCutoff())}get style(){return this._style}set style(e){this._style=e,this.syncStyle()}get heightManifoldTarget(){return this._heightManifoldEnabled?this._heightManifoldTarget:null}set heightManifoldTarget(e){Object(n["k"])(e)?(Object(s["l"])(this._heightManifoldTarget,e),this._heightManifoldEnabled=!0):this._heightManifoldEnabled=!1,this.syncRenderer(),this.syncHeightManifold()}set intersectsWorldUpAtLocation(e){if(Object(n["j"])(e))return void(this.intersectsLine=null);const t=this.view.renderCoordsHelper.worldUpAtPosition(e,K);this.intersectsLine=o["e"].fromValues(e,t),this.intersectsLineInfinite=!0}get intersectsLine(){return this._intersectsLineEnabled?this._intersectsLine:null}set intersectsLine(e){Object(n["k"])(e)?(o["e"].copy(e,this._intersectsLine),this._intersectsLineEnabled=!0):this._intersectsLineEnabled=!1,this.syncIntersectsLine(),this.syncRenderer()}get intersectsLineInfinite(){return this._intersectsLineInfinite}set intersectsLineInfinite(e){this._intersectsLineInfinite=e,this.syncIntersectsLineInfinite()}get lineVerticalPlaneSegment(){return this._lineVerticalPlaneSegment}set lineVerticalPlaneSegment(e){this._lineVerticalPlaneSegment=Object(n["k"])(e)?o["e"].copy(e):null,this.syncLineVerticalPlane(),this.syncRenderer()}get pathVerticalPlane(){return this._pathVerticalPlaneBuffers}set pathVerticalPlane(e){this._pathVerticalPlaneBuffers=e,this.syncPathVerticalPlane(),this.syncLineVerticalPlane(),this.syncPointDistance(),this.syncRenderer()}get pointDistanceLine(){return this._pointDistanceLine}set pointDistanceLine(e){this._pointDistanceLine=Object(n["k"])(e)?{origin:Object(r["d"])(e.origin),target:Object(r["d"])(e.target)}:null,this.syncPointDistance(),this.syncRenderer()}syncRenderer(){this.attached&&(this._intersectsLineEnabled||this._heightManifoldEnabled||Object(n["k"])(this._pointDistanceLine)||Object(n["k"])(this._pathVerticalPlaneBuffers))?this.ensureRenderer():this.disposeRenderer()}ensureRenderer(){Object(n["k"])(this.renderer)||(this.renderer=new q(this.view.renderCoordsHelper,void 0,{contrastControlEnabled:!0}),this.syncStyle(),this.syncHeightManifold(),this.syncIntersectsLine(),this.syncIntersectsLineInfinite(),this.syncPathVerticalPlane(),this.syncLineVerticalPlane(),this.syncPointDistance(),this.syncAngleCutoff(),this.view._stage&&this.view._stage.addRenderPlugin(this.renderer.renderSlots,this.renderer))}syncStyle(){Object(n["j"])(this.renderer)||(this.renderer.setParameterValues(this._style),null!=this._style.intersectsLineRadius&&(this.renderer.intersectsLineRadius=this._style.intersectsLineRadius))}syncAngleCutoff(){Object(n["j"])(this.renderer)||this.renderer.setParameterValues({angleCutoff:this._angleCutoff})}syncHeightManifold(){Object(n["j"])(this.renderer)||(this.renderer.heightManifoldEnabled=this._heightManifoldEnabled&&this.visible,this._heightManifoldEnabled&&(this.renderer.heightManifoldTarget=this._heightManifoldTarget))}syncIntersectsLine(){Object(n["j"])(this.renderer)||(this.renderer.intersectsLineEnabled=this._intersectsLineEnabled&&this.visible,this._intersectsLineEnabled&&(this.renderer.intersectsLineSegment=this._intersectsLine))}syncIntersectsLineInfinite(){Object(n["j"])(this.renderer)||(this.renderer.intersectsLineInfinite=this._intersectsLineInfinite)}syncPathVerticalPlane(){Object(n["j"])(this.renderer)||(this.renderer.pathVerticalPlaneEnabled=Object(n["k"])(this._pathVerticalPlaneBuffers)&&this.visible,Object(n["k"])(this._pathVerticalPlaneBuffers)&&(this.renderer.pathVerticalPlaneBuffers=this._pathVerticalPlaneBuffers))}syncLineVerticalPlane(){Object(n["j"])(this.renderer)||(this.renderer.lineVerticalPlaneEnabled=Object(n["k"])(this._lineVerticalPlaneSegment)&&this.visible,Object(n["k"])(this._lineVerticalPlaneSegment)&&(this.renderer.lineVerticalPlaneSegment=this._lineVerticalPlaneSegment))}syncPointDistance(){Object(n["j"])(this.renderer)||(this.renderer.pointDistanceEnabled=Object(n["k"])(this._pointDistanceLine)&&this.visible,Object(n["k"])(this._pointDistanceLine)&&(this.renderer.pointDistanceOrigin=this._pointDistanceLine.origin,this.renderer.pointDistanceTarget=this._pointDistanceLine.target))}disposeRenderer(){Object(n["k"])(this.renderer)&&this.view._stage&&(this.view._stage.removeRenderPlugin(this.renderer),this.renderer=null)}}const K=Object(r["e"])()},"65a7":function(e,t,i){"use strict";i.d(t,"a",(function(){return l}));var n=i("c649"),r=i("e753"),s=i("e6b5"),o=i("d232"),a=i("b63c"),c=i("5715");class l{draw(e,t){const i=this.getUniqueHints(e),l=[];for(const n of i)n instanceof r["a"]&&l.push(this.visualizeIntersectionPoint(n,t)),n instanceof s["a"]&&l.push(this.visualizeLine(n,t)),n instanceof o["a"]&&l.push(this.visualizeParallelSign(n,t)),n instanceof c["a"]&&l.push(this.visualizeRightAngleQuad(n,t)),n instanceof a["a"]&&l.push(this.visualizePoint(n,t));return Object(n["b"])(l)}getUniqueHints(e){const t=[];for(const i of e){let e=!0;for(const n of t)if(i.equals(n)){e=!1;break}e&&t.push(i)}return t}}},6706:function(e,t,i){"use strict";i.d(t,"a",(function(){return d})),i.d(t,"b",(function(){return h})),i.d(t,"c",(function(){return p})),i.d(t,"d",(function(){return l})),i.d(t,"e",(function(){return u})),i.d(t,"f",(function(){return c}));var n=i("4ae5"),r=i("a915"),s=i("0b2d"),o=i("3349"),a=i("f408");function c(e,t){const i=e.x-t.x,n=e.y-t.y;return i*i+n*n}function l(e,t){const i=e.length===t.length&&e[0]===t[0]&&e[1]===t[1];switch(e.length){case 2:return i;case 3:return i&&e[2]===t[2];case 4:return i&&e[3]===t[3]}return!1}function h(e,t,i,n){return"2d"===n.type?n.toScreen(t.toPoint(e,g)):(d(e,t,i,n,f),n.state.camera.projectToScreen(f,b),Object(r["f"])(b[0],b[1]))}function d(e,t,i,n,r=Object(s["e"])()){const o=t.toXYZ(e);return o[2]=Object(a["b"])(n,o,t.spatialReference,i)||0,n.renderCoordsHelper.toRenderCoords(o,t.spatialReference,r),r}function p(e,t,i,n,r,s,o){const c=i.toXYZ(e),l=i.toXYZ(t),h=Object(a["b"])(r,c,i.spatialReference,n),d=Object(a["b"])(r,l,i.spatialReference,n),p=(null==h?d:null==d?h:Math.min(h,d))||0;c[2]=p,l[2]=p,r.renderCoordsHelper.toRenderCoords(c,i.spatialReference,s),r.renderCoordsHelper.toRenderCoords(l,i.spatialReference,o)}function u(e,t){t.sort((t,i)=>Object(o["j"])(t.targetPoint,e)-Object(o["j"])(i.targetPoint,e))}const f=Object(s["e"])(),b=Object(r["g"])(),g=new n["a"]},6750:function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));var n=i("3886");function r(e,t){e.constants.add("stippleAlphaColorDiscard","float",.001),e.constants.add("stippleAlphaHighlightDiscard","float",.5),t.stippleEnabled?s(e,t):o(e)}function s(e,t){e.vertex.uniforms.add("stipplePatternPixelSizeInv","float"),t.stippleUVMaxEnabled&&e.varyings.add("stipplePatternUvMax","float"),e.varyings.add("stipplePatternUv","float"),e.fragment.uniforms.add("stipplePatternTexture","sampler2D"),t.stippleOffColorEnabled&&e.fragment.uniforms.add("stippleOffColor","vec4"),e.fragment.code.add(n["a"]`
  float getStippleAlpha() {
    float stipplePatternUvClamped = stipplePatternUv * gl_FragCoord.w;
    ${t.stippleUVMaxEnabled?"stipplePatternUvClamped = clamp(stipplePatternUvClamped, 0.0, stipplePatternUvMax);":""}

    return texture2D(stipplePatternTexture, vec2(mod(stipplePatternUvClamped, 1.0), 0.5)).a;
  }`),t.stippleOffColorEnabled?e.fragment.code.add(n["a"]`
    #define discardByStippleAlpha(stippleAlpha, threshold) {}
    #define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)
    `):e.fragment.code.add(n["a"]`
    #define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }
    #define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)
    `)}function o(e){e.fragment.code.add(n["a"]`
  float getStippleAlpha() { return 1.0; }

  #define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}
  #define blendStipple(color, _stippleAlpha_) color
  `)}},"6ae9":function(e,t,i){"use strict";i.d(t,"a",(function(){return h})),i.d(t,"b",(function(){return l})),i.d(t,"c",(function(){return d})),i.d(t,"d",(function(){return c}));var n=i("b2b2"),r=i("1219"),s=i("521c"),o=(i("e06a"),i("ce6d")),a=i("8b1a");class c{constructor(e){this.left=null,this.right=null,this.type="vertex",this.index=null,this.component=e}get pos(){return this._pos}set pos(e){this._pos=e,this.component.unnormalizeVertexPositions()}}class l{constructor(e,t,i){this.type="edge",this.component=e,this.left=t,this.right=i,t.right=this,i.left=this}}class h{constructor(e){this.vertices=[],this.edges=[],this.data=e}unnormalizeVertexPositions(){this.vertices.length<=1||this.data.coordinateHelper.unnormalize(this.vertices)}updateVertexIndex(e,t){if(0===this.vertices.length)return;const i=this.vertices[0];let n=null,r=e,s=t;do{n=r,n.index=s++,r=n.right?n.right.right:null}while(null!=r&&r!==i);n.left&&n!==this.vertices[this.vertices.length-1]&&this.swapVertices(this.vertices.indexOf(n),this.vertices.length-1)}getFirstVertex(){return 0===this.vertices.length?null:this.vertices[0]}getLastVertex(){return 0===this.vertices.length?null:this.vertices[this.vertices.length-1]}swapVertices(e,t){const i=this.vertices[e];this.vertices[e]=this.vertices[t],this.vertices[t]=i}iterateVertices(e){if(0===this.vertices.length)return;const t=this.vertices[0];let i=t;do{e(i,i.index),i=Object(n["k"])(i.right)?i.right.right:null}while(i!==t&&null!=i)}}class d extends o["a"]{constructor(e){super(),this.coordinateHelper=e,this.undoStack=[],this.redoStack=[],this.components=[]}apply(e,t=1){0!==t&&!Object(n["j"])(this.lastOperation)&&this.lastOperation.accumulate(e)||(e.apply(),this.undoStack.push(e),this.redoStack=[])}undo(){if(this.undoStack.length>0){const e=this.undoStack.pop();return e.undo(),this.redoStack.push(e),e}return null}get canUndo(){return this.undoStack.length>0}get lastOperation(){return this.undoStack.length>0?this.undoStack[this.undoStack.length-1]:null}redo(){if(this.redoStack.length>0){const e=this.redoStack.pop();return e.apply(),this.undoStack.push(e),e}return null}get canRedo(){return this.redoStack.length>0}toPoint(){return 0===this.components.length||0===this.components[0].vertices.length?null:this.coordinateHelper.createPoint(this.components[0].vertices[0].pos)}toPolyline(){const e=[],t=this.coordinateHelper.toArray;return this.components.forEach((i,n)=>{const r=[];let s=i.vertices.find(e=>null==e.left);const o=s;do{r.push(t(s.pos)),s=s.right?s.right.right:null}while(s&&s!==o);e.push(r)}),new s["a"]({paths:e,spatialReference:this.coordinateHelper.spatialReference})}toPolygon(){const e=[],t=this.coordinateHelper.toArray;return this.components.forEach((i,r)=>{const s=[],o=i.vertices[0];let a=o;const c=a;do{s.push(t(a.pos)),a=Object(n["k"])(a.right)?a.right.right:null}while(a&&a!==c);s.push(t(o.pos)),e.push(s)}),new r["a"]({rings:e,spatialReference:this.coordinateHelper.spatialReference})}static fromGeometry(e,t){const i=Object(a["a"])(e.hasZ,e.hasM,e.spatialReference,t),n=new d(i);switch(e.type){case"polygon":{const t=e.rings;for(let e=0;e<t.length;++e){const r=t[e],s=new h(n),o=r.length-1;for(let e=0;e<o;++e){const t=i.fromArray(r[e]),n=new c(s);s.vertices.push(n),n.pos=t,n.index=e}const a=s.vertices.length-1;for(let e=0;e<a;++e){const t=s.vertices[e],i=s.vertices[e+1],n=new l(s,t,i);s.edges.push(n)}const d=new l(s,s.vertices[s.vertices.length-1],s.vertices[0]);s.edges.push(d),n.components.push(s)}}break;case"polyline":for(const t of e.paths){const e=new h(n),r=t.length;for(let n=0;n<r;++n){const r=i.fromArray(t[n]),s=new c(e);e.vertices.push(s),s.pos=r,s.index=n}const s=e.vertices.length-1;for(let t=0;t<s;++t){const i=e.vertices[t],n=e.vertices[t+1],r=new l(e,i,n);e.edges.push(r)}n.components.push(e)}break;case"point":{const t=new h(n),i=new c(t);i.index=0,i.pos=n.coordinateHelper.fromPoint(e),t.vertices.push(i),n.components.push(t)}}return n}}},"6b75":function(e,t,i){"use strict";function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}i.d(t,"a",(function(){return n}))},7079:function(e,t,i){"use strict";i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return o}));var n,r=i("3886"),s=i("9617");function o(e,t){t.multipassGeometryEnabled&&e.vertex.include(s["b"]),e.vertex.code.add(r["a"]`
  void main(void) {
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel
      // filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${t.multipassGeometryEnabled?r["a"]`
        // Don't draw vertices behind geometry
        if(geometryDepthTest(.5 + .5 * posProjCenter.xy / posProjCenter.w, projectAux.posView.z)){
          posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
        }`:""}

      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    }
    else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  }
  `),e.fragment.uniforms.add("color","vec4"),e.fragment.code.add(r["a"]`
  void main() {
    gl_FragColor = color;
  }
  `)}!function(e){function t(e){e.setUniform4f("color",1,1,1,1)}e.bindUniforms=t}(n||(n={}))},"746f":function(e,t,i){var n=i("428f"),r=i("5135"),s=i("e538"),o=i("9bf2").f;e.exports=function(e){var t=n.Symbol||(n.Symbol={});r(t,e)||o(t,e,{value:s.f(e)})}},"748f":function(e,t,i){"use strict";i.d(t,"a",(function(){return d})),i.d(t,"b",(function(){return p}));var n=i("b2b2"),r=i("8a44"),s=i("ce6d"),o=i("0b2d"),a=i("af40"),c=i("003f");const l=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","shaderTransformationChanged","objectTransformation","visibilityChanged","occlusionChanged","highlightChanged","objectGeometryAdded","objectGeometryRemoved","vertexAttrsUpdated"];var h=i("0bde");class d extends c["a"]{constructor(e,t=""){super(),this.apiLayerUid=t,this.type=0,this.events=new s["a"],this.isSliceable=!1,this._objects=new r["a"],this._stageHandles=new a["a"],this.apiLayerUid=t,e=e||{},this.group=e.group||"",this.isVisible=null==e.isVisible||e.isVisible,this.isPickable=null==e.isPickable||e.isPickable,this.translation=e.translation?Object(o["d"])(e.translation):Object(o["e"])()}destroy(){this.detachStage(),this._stage=null}attachStage(e){this.detachStage(),this._stage=e;for(const t of l)this._stageHandles.add(this.events.on(t,i=>e.handleEvent(t,i)))}detachStage(){this._stageHandles.removeAll(),this.invalidateSpatialQueryAccelerator()}getObjectIds(){return this._objects.map(e=>e.id)}getObjects(){return this._objects}add(e){this._objects.push(e),e.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:e}),Object(n["k"])(this._octree)&&this._octree.add([e])}remove(e){this._objects.removeUnordered(e)&&(e.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:e}),Object(n["k"])(this._octree)&&this._octree.remove([e]))}addMany(e){this._objects.pushArray(e);for(const t of e)t.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:e}),Object(n["k"])(this._octree)&&this._octree.add(e)}removeMany(e){const t=new Array;if(this._objects.removeUnorderedMany(e,e.length,t),0!==t.length){for(const e of t)e.parentLayer=null;this.events.emit("layerObjectsRemoved",{layer:this,objects:t}),Object(n["k"])(this._octree)&&this._octree.remove(t)}}commit(){Object(n["k"])(this._stage)&&this._stage.processDirtyLayer(this.id)}notifyObjectBBChanged(e,t){Object(n["k"])(this._octree)&&this._octree.update(e,t)}getSpatialQueryAccelerator(){return Object(n["j"])(this._octree)&&this._objects.length>50&&this._createOctree(),this._octree}shaderTransformationChanged(){this.invalidateSpatialQueryAccelerator(),this.events.emit("shaderTransformationChanged",this)}invalidateSpatialQueryAccelerator(){this._octree=Object(n["e"])(this._octree)}_createOctree(){this._octree=new h["a"](e=>e.getBounds()),this._octree.add(this._objects.data,this._objects.length)}}function p(e){return Object(n["k"])(e)&&0===e.type}},7779:function(e,t,i){"use strict";i.d(t,"a",(function(){return r})),i.d(t,"b",(function(){return p}));var n=i("9ef0");const r={main:new n["a"]([255,127,0]),selected:new n["a"]([255,255,255]),outline:new n["a"]([0,0,0,.5]),selectedOutline:new n["a"]([255,255,255]),hoverOutline:new n["a"]([255,255,255]),secondary:new n["a"]([255,255,255]),secondaryOutline:new n["a"]([100,100,100]),transparent:new n["a"]([0,0,0,0])};function s(e,t){if(t)for(const i in t)e[i]=t[i]}class o{constructor(e){this.size=8,this.hoverSize=10,this.color=r.main,this.hoverColor=r.main,this.outlineColor=r.outline,this.hoverOutlineColor=r.hoverOutline,s(this,e)}}class a{constructor(e){this.color=r.secondary,this.hoverColor=r.main,s(this,e)}}class c{constructor(e){this.color=r.transparent,this.hoverColor=r.transparent,this.outlineColor=r.main,this.hoverOutlineColor=r.main,this.stagedColor=r.transparent,this.stagedOutlineColor=r.secondary,s(this,e)}}class l{constructor(e){this.vertex=new o,this.midpoint=new o({color:r.secondary,outlineColor:r.secondaryOutline,size:6}),this.selected=new o({color:r.selected,hoverColor:r.selected,hoverOutlineColor:r.hoverOutline}),s(this,e)}}class h{constructor(e){this.center=new o({color:r.secondaryOutline}),this.fill=new c,this.line=new a,this.vertex=new o({color:r.selected,outlineColor:r.main,hoverColor:r.selected,hoverOutlineColor:r.secondaryOutline}),s(this,e)}}class d{constructor(e){this.reshapeGraphics=new l,this.transformGraphics=new h,s(this,e)}}const p=new d},"7c1d":function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));var n=i("3886");function r(e){const t=n["a"]`
    vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
      vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
      vec2 pixelSz = vec2(1.0) / widthHeight;
      vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
      vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
      return vec4(result, clipCoord.zw);
    }
  `,i=n["a"]`

    vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
      vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
      vec2 pixelSz = vec2(1.0) / widthHeight;
      vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
      vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
      return vec4(result, clipCoord.zw);
    }
  `;e.vertex.code.add(t),e.vertex.code.add(i),e.fragment.code.add(t),e.fragment.code.add(i)}},"7ce4":function(e,t,i){"use strict";var n=i("a21b"),r=i("1956");class s{constructor(e,t,i,n,s){this._context=e,this.bufferType=t,this.usage=i,this._glName=null,this._size=-1,this._indexType=void 0,e.instanceCounter.increment(1,this),this._glName=this._context.gl.createBuffer(),Object(r["a"])(this._context.gl),n&&this.setData(n,s)}static createIndex(e,t,i,n){return new s(e,34963,t,i,n)}static createVertex(e,t,i){return new s(e,34962,t,i)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get byteSize(){return 34962===this.bufferType?this._size:5125===this._indexType?4*this._size:2*this._size}dispose(){this._context&&(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(1,this),this._context=null)}setData(e,t){if(!e)return;if("number"==typeof e){if(e<0&&console.error("Buffer size cannot be negative!"),34963===this.bufferType&&t)switch(this._indexType=t,this._size=e,t){case 5123:e*=2;break;case 5125:e*=4}}else{let t=e.byteLength;Object(n["i"])(e)&&(t/=2,this._indexType=5123),Object(n["j"])(e)&&(t/=4,this._indexType=5125),this._size=t}const i=this._context.getBoundVAO();this._context.bindVAO(null),this._context.bindBuffer(this),this._context.gl.bufferData(this.bufferType,e,this.usage),this._context.bindVAO(i)}setSubData(e,t=0,i=0,r=e.byteLength){if(!e)return;(t<0||t>=this._size)&&console.error("offset is out of range!");let s=t,o=i,a=r,c=e.byteLength;Object(n["i"])(e)&&(c/=2,s*=2,o*=2,a*=2),Object(n["j"])(e)&&(c/=4,s*=4,o*=4,a*=4),void 0===r&&(r=c-1),i>=r&&console.error("end must be bigger than start!"),t+i-r>this._size&&console.error("An attempt to write beyond the end of the buffer!");const l=this._context.getBoundVAO();this._context.bindVAO(null),this._context.bindBuffer(this);const h=this._context.gl,d=ArrayBuffer.isView(e)?e.buffer:e,p=0===o&&a===e.byteLength?d:d.slice(o,a);h.bufferSubData(this.bufferType,s,p),this._context.bindVAO(l)}}t["a"]=s},"7dcb":function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));class n{}},8418:function(e,t,i){"use strict";var n=i("c04e"),r=i("9bf2"),s=i("5c6c");e.exports=function(e,t,i){var o=n(t);o in e?r.f(e,o,s(0,i)):e[o]=i}},8539:function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return c})),i.d(t,"c",(function(){return l})),i.d(t,"d",(function(){return s})),i.d(t,"e",(function(){return a})),i.d(t,"f",(function(){return r}));i("c120");var n=i("b2b2");function r(e,t){return e.vertexBuffers[t].size/s(e.layout[t])}function s(e){return e[0].stride}function o(e,t,i,n,r){const s=e.gl,o=e.capabilities.instancing;e.bindBuffer(i);for(const a of n){const e=t[a.name],i=(r||(0+a.baseInstance?a.baseInstance:0))*a.stride;if(void 0===e&&console.error(`There is no location for vertex attribute '${a.name}' defined.`),a.baseInstance&&!a.divisor&&console.error(`Vertex attribute '${a.name}' uses baseInstanceOffset without divisor.`),a.count<=4)s.vertexAttribPointer(e,a.count,a.type,a.normalized,a.stride,a.offset+i),s.enableVertexAttribArray(e),a.divisor&&a.divisor>0&&o&&o.vertexAttribDivisor(e,a.divisor);else if(9===a.count)for(let t=0;t<3;t++)s.vertexAttribPointer(e+t,3,a.type,a.normalized,a.stride,a.offset+12*t+i),s.enableVertexAttribArray(e+t),a.divisor&&a.divisor>0&&o&&o.vertexAttribDivisor(e+t,a.divisor);else if(16===a.count)for(let t=0;t<4;t++)s.vertexAttribPointer(e+t,4,a.type,a.normalized,a.stride,a.offset+16*t+i),s.enableVertexAttribArray(e+t),a.divisor&&a.divisor>0&&o&&o.vertexAttribDivisor(e+t,a.divisor);else console.error("Unsupported vertex attribute element count: "+a.count)}}function a(e,t,i,n){const r=e.gl,s=e.capabilities.instancing;e.bindBuffer(i);for(const o of n){const e=t[o.name];if(o.count<=4)r.disableVertexAttribArray(e),o.divisor&&o.divisor>0&&s&&s.vertexAttribDivisor(e,0);else if(9===o.count)for(let t=0;t<3;t++)r.disableVertexAttribArray(e+t),o.divisor&&o.divisor>0&&s&&s.vertexAttribDivisor(e+t,0);else if(16===o.count)for(let t=0;t<4;t++)r.disableVertexAttribArray(e+t),o.divisor&&o.divisor>0&&s&&s.vertexAttribDivisor(e+t,0);else console.error("Unsupported vertex attribute element count: "+o.count)}e.unbindBuffer(34962)}function c(e){switch(e){case 6406:case 6409:case 36168:return 1;case 6410:case 32854:case 33325:case 32854:case 33189:return 2;case 6407:case 6402:return 3;case 6408:case 34041:case 33326:case 35898:case 33327:case 34041:return 4;case 33328:case 34842:return 8;case 34836:return 16;case 33776:case 33777:return.5;case 33778:case 33779:return 1;case 37488:case 37489:case 37492:case 37493:case 37494:case 37495:return.5;case 37490:case 37491:case 37496:case 37497:return 1}return 0}function l(e){if(Object(n["j"])(e))return 0;if("colorAttachment"in e)return e.glName?l(e.colorAttachment)+l(e.depthStencilAttachment):0;if("descriptor"in e)return e.glName?l(e.descriptor):0;const t=e.internalFormat||"pixelFormat"in e&&e.pixelFormat;if(!t)return 0;const i="hasMipmap"in e&&e.hasMipmap?1.3:1,r=e.width*e.height;return c(t)*r*i}},8675:function(e,t,i){"use strict";i.d(t,"a",(function(){return c})),i.d(t,"b",(function(){return a})),i.d(t,"c",(function(){return s})),i.d(t,"d",(function(){return o}));var n=i("fc00"),r=i("5957");const s=Object(n["a"])().vec3f("position"),o=Object(n["a"])().vec3f("position").vec2f("uv0"),a=Object(n["a"])().vec3f("position").vec4u8("color");class c{constructor(e){this.vertexBufferLayout=e}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return e.indices.get("position").length}write(e,t,i,n){Object(r["c"])(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,i,n)}}},"86ba":function(e,t,i){"use strict";i.d(t,"a",(function(){return R}));var n=i("b2b2"),r=i("e92d"),s=i("38a4"),o=i("a915"),a=i("0b2d"),c=i("e431"),l=i("3349"),h=i("fc00"),d=i("d0ac"),p=i("1153"),u=i("1038"),f=i("b623"),b=i("d7f7"),g=i("35b3"),m=i("b4c8"),v=i("a4ee"),y=i("c3a4"),_=i("ca98"),O=i("da35"),j=i("8e37"),x=i("189c"),w=i("8e97"),S=i("d272"),P=i("6a07"),C=i("be24"),T=i("7438"),E=i("c6d7"),A=i("87b7"),M=i("9a68");const k={position:0,subdivisionFactor:1,uv0:2,auxpos1:3,auxpos2:4,size:6,sizeFeatureAttribute:6,color:5,colorFeatureAttribute:5,opacityFeatureAttribute:7};class V extends _["a"]{constructor(e,t){super(e,t),this.stipplePattern=null,this.stippleTextureBind=null,this.stippleTextureRepository=e.stippleTextureRepository}initializeProgram(e){const t=V.shader.get(),i=this.configuration,n=t.build({OITEnabled:0===i.transparencyPassType,output:i.output,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,stippleEnabled:i.stippleEnabled,stippleOffColorEnabled:i.stippleOffColorEnabled,stippleUVMaxEnabled:i.stippleIntegerRepeatsEnabled,stippleIntegerRepeatsEnabled:i.stippleIntegerRepeatsEnabled,roundCaps:i.roundCaps,roundJoins:i.roundJoins,vvColor:i.vvColor,vvSize:i.vvSize,vvInstancingEnabled:!0,vvOpacity:i.vvOpacity,falloffEnabled:i.falloffEnabled,innerColorEnabled:i.innerColorEnabled,multipassTerrainEnabled:i.multipassTerrainEnabled,cullAboveGround:i.cullAboveGround});return new j["a"](e.rctx,n.generateSource("vertex"),n.generateSource("fragment"),k)}dispose(){super.dispose(),this.stippleTextureRepository.release(this.stipplePattern),this.stipplePattern=null,this.stippleTextureBind=null}bindPass(e,t,i){if(w["a"].bindProjectionMatrix(this.program,i.camera.projectionMatrix),4===this.configuration.output&&P["a"].bindOutputHighlight(e,this.program,i),i.multipassTerrainEnabled&&(this.program.setUniform2fv("inverseViewport",i.inverseViewport),Object(E["a"])(this.program,e,i)),this.program.setUniform1f("intrinsicWidth",t.width),this.program.setUniform4fv("intrinsicColor",t.color),this.program.setUniform1f("miterLimit","miter"!==t.join?0:t.miterLimit),this.program.setUniform2fv("cameraNearFar",i.camera.nearFar),this.program.setUniform1f("pixelRatio",i.camera.pixelRatio),this.program.setUniform2f("screenSize",i.camera.fullViewport[2],i.camera.fullViewport[3]),C["a"].bindUniformsWithOpacity(this.program,t),this.stipplePattern!==t.stipplePattern){const e=t.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,e),this.stipplePattern=e}if(this.configuration.stippleEnabled){const r=Object(n["k"])(this.stippleTextureBind)?this.stippleTextureBind(e,0)*i.camera.pixelRatio:1;if(this.program.setUniform1i("stipplePatternTexture",0),this.program.setUniform1f("stipplePatternPixelSizeInv",1/r),this.configuration.stippleOffColorEnabled){const e=Object(n["t"])(t.stippleOffColor);this.program.setUniform4f("stippleOffColor",e[0],e[1],e[2],e.length>3?e[3]:1)}}this.configuration.falloffEnabled&&this.program.setUniform1f("falloff",t.falloff),this.configuration.innerColorEnabled&&(this.program.setUniform4fv("innerColor",Object(n["u"])(t.innerColor,t.color)),this.program.setUniform1f("innerWidth",t.innerWidth*i.camera.pixelRatio))}bindDraw(e){w["a"].bindView(this.program,e),S["a"].bindUniformsWithOrigin(this.program,this.configuration,e)}setPipelineState(e,t){const i=this.configuration,n=3===e,r=2===e;return Object(x["e"])({blending:0===i.output||7===i.output?n?T["f"]:Object(T["a"])(e):null,depthTest:{func:Object(T["b"])(e)},depthWrite:n?!i.transparent&&i.writeDepth&&x["d"]:Object(T["c"])(e),colorWrite:x["c"],stencilWrite:i.sceneHasOcludees?A["j"]:null,stencilTest:i.sceneHasOcludees?t?A["f"]:A["e"]:null,polygonOffset:n||r?i.polygonOffset&&D:T["d"]})}initializePipeline(){const e=this.configuration,t=e.polygonOffset&&D;return e.occluder&&(this._occluderPipelineTransparent=Object(x["e"])({blending:T["f"],polygonOffset:t,depthTest:A["a"],depthWrite:null,colorWrite:x["c"],stencilWrite:null,stencilTest:A["h"]}),this._occluderPipelineOpaque=Object(x["e"])({blending:T["f"],polygonOffset:t,depthTest:A["a"],depthWrite:null,colorWrite:x["c"],stencilWrite:A["i"],stencilTest:A["g"]}),this._occluderPipelineMaskWrite=Object(x["e"])({blending:null,polygonOffset:t,depthTest:A["b"],depthWrite:null,colorWrite:null,stencilWrite:A["j"],stencilTest:A["f"]})),this._occludeePipelineState=this.setPipelineState(this.configuration.transparencyPassType,!0),this.setPipelineState(this.configuration.transparencyPassType,!1)}get primitiveType(){return 5}getPipelineState(e,t){return t?this._occludeePipelineState:this.configuration.occluder?11===e?this._occluderPipelineTransparent:10===e?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:this.pipeline}}V.shader=new y["a"](M["a"],()=>i.e("chunk-2d213386").then(i.bind(null,"ac6d")));const D={factor:0,units:-4};class G extends O["a"]{constructor(){super(...arguments),this.output=0,this.occluder=!1,this.slicePlaneEnabled=!1,this.transparent=!1,this.polygonOffset=!1,this.writeDepth=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stippleIntegerRepeatsEnabled=!1,this.roundCaps=!1,this.roundJoins=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.falloffEnabled=!1,this.innerColorEnabled=!1,this.sceneHasOcludees=!1,this.transparencyPassType=3,this.multipassTerrainEnabled=!1,this.cullAboveGround=!0}}Object(v["a"])([Object(O["b"])({count:8})],G.prototype,"output",void 0),Object(v["a"])([Object(O["b"])()],G.prototype,"occluder",void 0),Object(v["a"])([Object(O["b"])()],G.prototype,"slicePlaneEnabled",void 0),Object(v["a"])([Object(O["b"])()],G.prototype,"transparent",void 0),Object(v["a"])([Object(O["b"])()],G.prototype,"polygonOffset",void 0),Object(v["a"])([Object(O["b"])()],G.prototype,"writeDepth",void 0),Object(v["a"])([Object(O["b"])()],G.prototype,"stippleEnabled",void 0),Object(v["a"])([Object(O["b"])()],G.prototype,"stippleOffColorEnabled",void 0),Object(v["a"])([Object(O["b"])()],G.prototype,"stippleIntegerRepeatsEnabled",void 0),Object(v["a"])([Object(O["b"])()],G.prototype,"roundCaps",void 0),Object(v["a"])([Object(O["b"])()],G.prototype,"roundJoins",void 0),Object(v["a"])([Object(O["b"])()],G.prototype,"vvSize",void 0),Object(v["a"])([Object(O["b"])()],G.prototype,"vvColor",void 0),Object(v["a"])([Object(O["b"])()],G.prototype,"vvOpacity",void 0),Object(v["a"])([Object(O["b"])()],G.prototype,"falloffEnabled",void 0),Object(v["a"])([Object(O["b"])()],G.prototype,"innerColorEnabled",void 0),Object(v["a"])([Object(O["b"])()],G.prototype,"sceneHasOcludees",void 0),Object(v["a"])([Object(O["b"])({count:4})],G.prototype,"transparencyPassType",void 0),Object(v["a"])([Object(O["b"])()],G.prototype,"multipassTerrainEnabled",void 0),Object(v["a"])([Object(O["b"])()],G.prototype,"cullAboveGround",void 0);const I=r["a"].getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial");class R extends g["a"]{constructor(e){super(e,L),this._vertexAttributeLocations=k,this.techniqueConfig=new G,this.layout=this.createLayout()}isClosed(e,t){return q(this.params,e,t)}dispose(){}getPassParameters(){return this.params}getTechniqueConfig(e,t){this.techniqueConfig.output=e;const i=Object(n["k"])(this.params.stipplePattern);return this.techniqueConfig.stippleEnabled=i,this.techniqueConfig.stippleIntegerRepeatsEnabled=i&&this.params.stippleIntegerRepeats,this.techniqueConfig.stippleOffColorEnabled=i&&Object(n["k"])(this.params.stippleOffColor),this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees,this.techniqueConfig.roundJoins="round"===this.params.join,this.techniqueConfig.roundCaps="round"===this.params.cap,this.techniqueConfig.transparent=this.params.transparent,this.techniqueConfig.polygonOffset=this.params.polygonOffset,this.techniqueConfig.writeDepth=this.params.writeDepth,this.techniqueConfig.vvColor=this.params.vvColorEnabled,this.techniqueConfig.vvOpacity=this.params.vvOpacityEnabled,this.techniqueConfig.vvSize=this.params.vvSizeEnabled,this.techniqueConfig.innerColorEnabled=this.params.innerWidth>0&&Object(n["k"])(this.params.innerColor),this.techniqueConfig.falloffEnabled=this.params.falloff>0,this.techniqueConfig.occluder=8===this.params.renderOccluded,this.techniqueConfig.transparencyPassType=t?t.transparencyPassType:3,this.techniqueConfig.multipassTerrainEnabled=!!t&&t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=!t||t.cullAboveGround,this.techniqueConfig}intersect(e,t,i,n,r,s,o,a,c){c?this.intersectDrapedLineGeometry(e,n,s,o):this.intersectLineGeometry(e,t,i,n,this.params.width,o)}intersectDrapedLineGeometry(e,t,i,n){if(!t.options.selectionMode)return;const r=e.vertexAttributes.get("position").data,o=e.vertexAttributes.get("size");let a=this.params.width;if(this.params.vvSizeEnabled){const t=e.vertexAttributes.get("sizeFeatureAttribute").data[0];a*=Object(s["d"])(this.params.vvSizeOffset[0]+t*this.params.vvSizeFactor[0],this.params.vvSizeMinSize[0],this.params.vvSizeMaxSize[0])}else o&&(a*=o.data[0]);const c=i[0],l=i[1],h=(a/2+4)*e.screenToWorldRatio;let d=Number.MAX_VALUE;for(let p=0;p<r.length-5;p+=3){const e=r[p],t=r[p+1],i=c-e,n=l-t,o=r[p+3]-e,a=r[p+4]-t,h=Object(s["d"])((o*i+a*n)/(o*o+a*a),0,1),u=o*h-i,f=a*h-n,b=u*u+f*f;b<d&&(d=b)}d<h*h&&n()}intersectLineGeometry(e,t,i,n,r,o){if(!n.options.selectionMode||Object(f["e"])(t))return;if(!Object(p["g"])(i))return void I.error("intersection assumes a translation-only matrix");const a=e.vertexAttributes,h=a.get("position").data;let u=r;if(this.params.vvSizeEnabled){const e=a.get("sizeFeatureAttribute").data[0];u*=Object(s["d"])(this.params.vvSizeOffset[0]+e*this.params.vvSizeFactor[0],this.params.vvSizeMinSize[0],this.params.vvSizeMaxSize[0])}else a.has("size")&&(u*=a.get("size").data[0]);const b=n.camera,g=X;Object(l["c"])(g,n.point);const m=u*b.pixelRatio/2+4*b.pixelRatio;Object(c["x"])(oe[0],g[0]-m,g[1]+m,0),Object(c["x"])(oe[1],g[0]+m,g[1]+m,0),Object(c["x"])(oe[2],g[0]+m,g[1]-m,0),Object(c["x"])(oe[3],g[0]-m,g[1]-m,0);for(let s=0;s<4;s++)if(!b.unprojectFromRenderScreen(oe[s],ae[s]))return;d["f"].fromPoints(b.eye,ae[0],ae[1],ce),d["f"].fromPoints(b.eye,ae[1],ae[2],le),d["f"].fromPoints(b.eye,ae[2],ae[3],he),d["f"].fromPoints(b.eye,ae[3],ae[0],de);let v=Number.MAX_VALUE;const y=F(this.params,a,e.indices)?h.length-2:h.length-5;for(let s=0;s<y;s+=3){W[0]=h[s]+i[12],W[1]=h[s+1]+i[13],W[2]=h[s+2]+i[14];const e=(s+3)%h.length;if(Z[0]=h[e]+i[12],Z[1]=h[e+1]+i[13],Z[2]=h[e+2]+i[14],d["f"].signedDistance(ce,W)<0&&d["f"].signedDistance(ce,Z)<0||d["f"].signedDistance(le,W)<0&&d["f"].signedDistance(le,Z)<0||d["f"].signedDistance(he,W)<0&&d["f"].signedDistance(he,Z)<0||d["f"].signedDistance(de,W)<0&&d["f"].signedDistance(de,Z)<0)continue;if(b.projectToRenderScreen(W,Y),b.projectToRenderScreen(Z,J),Y[2]<0&&J[2]>0){Object(c["k"])(K,W,Z);const e=b.frustum,t=-d["f"].signedDistance(e[4],W)/Object(c["i"])(K,d["f"].normal(e[4]));Object(c["f"])(K,K,t),Object(c["g"])(W,W,K),b.projectToRenderScreen(W,Y)}else if(Y[2]>0&&J[2]<0){Object(c["k"])(K,Z,W);const e=b.frustum,t=-d["f"].signedDistance(e[4],Z)/Object(c["i"])(K,d["f"].normal(e[4]));Object(c["f"])(K,K,t),Object(c["g"])(Z,Z,K),b.projectToRenderScreen(Z,J)}else if(Y[2]<0&&J[2]<0)continue;Y[2]=0,J[2]=0;const t=d["e"].distance2(d["e"].fromPoints(Y,J,te),g);t<v&&(v=t,Object(c["l"])(Q,W),Object(c["l"])(ee,Z))}const _=n.rayBeginPoint,O=n.rayEndPoint;if(v<m*m){let e=Number.MAX_VALUE;if(d["e"].closestLineSegmentPoint(d["e"].fromPoints(Q,ee,te),d["e"].fromPoints(_,O,ie),$)){Object(c["k"])($,$,_);const t=Object(c["q"])($);Object(c["f"])($,$,1/t),e=t/Object(c["p"])(_,O)}o(e,$)}}computeAttachmentOrigin(e,t){const i=e.vertexAttributes;if(!i)return null;const n=e.indices,r=i.get("position");return Object(u["a"])(r,n?n.get("position"):null,n&&F(this.params,i,n),t)}createLayout(){const e=Object(h["a"])().vec3f("position").f32("subdivisionFactor").vec2f("uv0").vec3f("auxpos1").vec3f("auxpos2");return this.params.vvSizeEnabled?e.f32("sizeFeatureAttribute"):e.f32("size"),this.params.vvColorEnabled?e.f32("colorFeatureAttribute"):e.vec4f("color"),this.params.vvOpacityEnabled&&e.f32("opacityFeatureAttribute"),e}createBufferWriter(){return new H(this.layout,this.params)}getGLMaterial(e){return 0===e.output||7===e.output||4===e.output||1===e.output?new z(e):void 0}validateParameterValues(e){"miter"!==e.join&&(e.miterLimit=0),this.requiresTransparent(e)&&(e.transparent=!0)}requiresTransparent(e){return!!((e.color&&e.color[3])<1||e.innerWidth>0&&this.colorRequiresTransparent(e.innerColor)||e.stipplePattern&&this.colorRequiresTransparent(e.stippleOffColor)||e.falloff>0)}colorRequiresTransparent(e){return Object(n["k"])(e)&&e[3]<1&&e[3]>0}}class z extends b["a"]{constructor(e){super(e),this.updateParameters()}updateParameters(e){this.technique=this.techniqueRep.acquireAndReleaseExisting(V,this.material.getTechniqueConfig(this.output,e),this.technique)}beginSlot(e){return this.technique.configuration.occluder?3===e||10===e||11===e:0===this.output||7===this.output?(this.targetSlot=this.technique.configuration.writeDepth?5:8,e===this.targetSlot):3===e}_updateOccludeeState(e){e.hasOccludees!==this.material.params.sceneHasOcludees&&this.material.setParameterValues({sceneHasOcludees:e.hasOccludees})}ensureParameters(e){0!==this.output&&7!==this.output||this._updateOccludeeState(e),this.updateParameters(e)}bind(e,t){e.bindProgram(this.technique.program),this.technique.bindPass(e,this.material.getPassParameters(),t)}getPipelineState(e,t){return this.technique.getPipelineState(e,t)}}const L={width:0,color:[1,1,1,1],join:"miter",cap:"butt",miterLimit:5,writeDepth:!0,polygonOffset:!1,stipplePattern:null,stippleIntegerRepeats:!1,stippleOffColor:null,slicePlaneEnabled:!1,vvFastUpdate:!1,transparent:!1,isClosed:!1,falloff:0,innerWidth:0,innerColor:null,sceneHasOcludees:!1,...g["b"],...m["a"].Default};class H{constructor(e,t){switch(this.params=t,this.numJoinSubdivisions=0,this.vertexBufferLayout=e,this.params.join){case"miter":case"bevel":this.numJoinSubdivisions=t.stipplePattern?1:0;break;case"round":this.numJoinSubdivisions=B}}isClosed(e){return F(this.params,e.vertexAttributes,e.indices)}numCapSubdivisions(e){if(this.isClosed(e))return 0;switch(this.params.cap){case"butt":return 0;case"square":return 1;case"round":return N}}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){const t=2*this.numCapSubdivisions(e)+2,i=e.indices.get("position").length/2+1,n=this.isClosed(e);let r=n?2:2*t;const s=n?0:1,o=n?i:i-1;if(e.vertexAttributes.has("subdivisions")){const t=e.vertexAttributes.get("subdivisions").data;for(let e=s;e<o;++e)r+=4+2*t[e]}else r+=(o-s)*(2*this.numJoinSubdivisions+4);return r+=2,r}write(e,t,i,n){const r=ne,s=re,o=se,a=t.vertexAttributes.get("position").data,l=t.indices&&t.indices.get("position"),h=this.numCapSubdivisions(t);l&&l.length!==2*(a.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");let d=null;t.vertexAttributes.has("subdivisions")&&(d=t.vertexAttributes.get("subdivisions").data);let p=1,u=0;this.params.vvSizeEnabled?u=t.vertexAttributes.get("sizeFeatureAttribute").data[0]:t.vertexAttributes.has("size")&&(p=t.vertexAttributes.get("size").data[0]);let f=[1,1,1,1],b=0;this.params.vvColorEnabled?b=t.vertexAttributes.get("colorFeatureAttribute").data[0]:t.vertexAttributes.has("color")&&(f=t.vertexAttributes.get("color").data);let g=0;this.params.vvOpacityEnabled&&(g=t.vertexAttributes.get("opacityFeatureAttribute").data[0]);const m=a.length/3,v=e.transformation,y=new Float32Array(i.buffer),_=this.vertexBufferLayout.stride/4;let O=n*_;const j=O,x=(e,t,i,n,r,s,o)=>{if(y[O++]=t[0],y[O++]=t[1],y[O++]=t[2],y[O++]=n,y[O++]=r,y[O++]=s,y[O++]=e[0],y[O++]=e[1],y[O++]=e[2],y[O++]=i[0],y[O++]=i[1],y[O++]=i[2],this.params.vvSizeEnabled?y[O++]=u:y[O++]=p,this.params.vvColorEnabled)y[O++]=b;else{const e=Math.min(4*o,f.length-4);y[O++]=f[e+0],y[O++]=f[e+1],y[O++]=f[e+2],y[O++]=f[e+3]}this.params.vvOpacityEnabled&&(y[O++]=g)};O+=_,Object(c["x"])(s,a[0],a[1],a[2]),v&&Object(c["n"])(s,s,v);const w=this.isClosed(t);if(w){const e=a.length-3;Object(c["x"])(r,a[e],a[e+1],a[e+2]),v&&Object(c["n"])(r,r,v)}else{Object(c["l"])(r,s),Object(c["x"])(o,a[3],a[4],a[5]),v&&Object(c["n"])(o,o,v);for(let e=0;e<h;++e){const t=1-e/h;x(r,s,o,t,1,-4,0),x(r,s,o,t,1,4,0)}x(r,s,o,0,0,-4,0),x(r,s,o,0,0,4,0),Object(c["l"])(r,s),Object(c["l"])(s,o)}const S=w?m:m-1;for(let P=w?0:1;P<S;P++){const e=(P+1)%m*3;Object(c["x"])(o,a[e+0],a[e+1],a[e+2]),v&&Object(c["n"])(o,o,v),x(r,s,o,0,1,-1,P),x(r,s,o,0,1,1,P);const t=d?d[P]:this.numJoinSubdivisions;for(let i=0;i<t;++i){const e=(i+1)/(t+1);x(r,s,o,e,1,-2,P),x(r,s,o,e,1,2,P)}x(r,s,o,1,0,-2,P),x(r,s,o,1,0,2,P),Object(c["l"])(r,s),Object(c["l"])(s,o)}if(w)O=U(y,j+_,y,O,2*_);else{x(r,s,o,0,1,-5,S),x(r,s,o,0,1,5,S);for(let e=0;e<h;++e){const t=(e+1)/h;x(r,s,o,t,1,-5,S),x(r,s,o,t,1,5,S)}}U(y,j+_,y,j,_),O=U(y,O-_,y,O,_)}}function U(e,t,i,n,r){for(let s=0;s<r;s++)i[n++]=e[t++];return n}function F(e,t,i){return q(e,t.get("position").data,i?i.get("position"):null)}function q(e,t,i){return!!e.isClosed&&(i?i.length>2:t.length>6)}const N=3,B=1,W=Object(a["e"])(),Z=Object(a["e"])(),K=Object(a["e"])(),$=Object(a["e"])(),X=Object(a["e"])(),Y=Object(o["e"])(),J=Object(o["e"])(),Q=Object(a["e"])(),ee=Object(a["e"])(),te=d["e"].create(),ie=d["e"].create(),ne=Object(a["e"])(),re=Object(a["e"])(),se=Object(a["e"])(),oe=[Object(o["e"])(),Object(o["e"])(),Object(o["e"])(),Object(o["e"])()],ae=[Object(a["e"])(),Object(a["e"])(),Object(a["e"])(),Object(a["e"])()],ce=d["f"].create(),le=d["f"].create(),he=d["f"].create(),de=d["f"].create()},"8b1a":function(e,t,i){"use strict";i.d(t,"a",(function(){return b}));var n=i("7f83"),r=i("4ae5"),s=(i("e06a"),i("0b2d")),o=i("e431"),a=i("02f1"),c=i("0fc4"),l=i("3349"),h=i("7577"),d=i("f091");class p{constructor(e,t){this.spatialReference=e,this.viewingMode=t,this._unnormalizationInfo=m(e,t)}tag(e){return e}createNew(){return this.tag(Object(a["b"])())}fromPoint(e){return this.tag(Object(a["f"])(e.x,e.y))}fromArray(e){return this.tag(Object(a["f"])(e[0],e[1]))}toArray(e){return[e[0],e[1]]}clone(e){return this.tag(Object(a["e"])(e))}toPoint(e,t){return t.x=e[0],t.y=e[1],t.hasZ=!1,t.hasM=!1,t.spatialReference=this.spatialReference,t}createPoint(e){return new r["a"]({x:e[0],y:e[1],z:void 0,m:void 0,spatialReference:this.spatialReference})}createPointFromArray(e){return new r["a"]({x:e[0],y:e[1],z:void 0,m:void 0,spatialReference:this.spatialReference})}createDehydratedPoint(e){return{x:e[0],y:e[1],z:void 0,m:void 0,hasZ:!1,hasM:!1,spatialReference:this.spatialReference,type:"point"}}lerp(e,t,i,n){return Object(l["m"])(n,e,t,i)}addDelta(e,t,i){e[0]+=t,e[1]+=i}scale(e,t,i,n){const r=d["c"].get(),s=Object(l["d"])(r,e,t),o=Object(l["a"])(r,i,Object(l["g"])(i,s));Object(l["p"])(e,e,o,n-1)}rotate(e,t,i){Object(l["r"])(e,e,t,i)}pointToArray(e){return[e.x,e.y]}getZ(e,t){return t}hasZ(){return!1}unnormalize(e){g(e,this._unnormalizationInfo)}fromXYZ(e){return this.tag(Object(a["f"])(e[0],e[1]))}toXYZ(e,t=0){return Object(s["g"])(e[0],e[1],t)}}class u{constructor(e,t,i){this.valueType=e,this.spatialReference=t,this._unnormalizationInfo=m(t,i)}tag(e){return e}createNew(){return this.tag(Object(s["e"])())}fromPoint(e){return this.tag(Object(s["g"])(e.x,e.y,0===this.valueType?e.z:e.m))}fromArray(e){return this.tag(Object(s["g"])(e[0],e[1],e[2]||0))}toArray(e){return[e[0],e[1],e[2]]}clone(e){return this.tag(Object(s["f"])(e))}toPoint(e,t){return t.x=e[0],t.y=e[1],0===this.valueType?(t.z=e[2],t.hasZ=!0,t.hasM=!1):(t.m=e[2],t.hasZ=!1,t.hasM=!0),t.spatialReference=this.spatialReference,t}createPoint(e){return new r["a"]({x:e[0],y:e[1],z:0===this.valueType?e[2]:void 0,m:1===this.valueType?e[2]:void 0,spatialReference:this.spatialReference})}createPointFromArray(e){return new r["a"]({x:e[0],y:e[1],z:0===this.valueType?e[2]:void 0,m:1===this.valueType?e[2]:void 0,spatialReference:this.spatialReference})}createDehydratedPoint(e){const t=0===this.valueType,i=1===this.valueType;return{x:e[0],y:e[1],z:t?e[2]:void 0,m:i?e[2]:void 0,hasZ:t,hasM:i,spatialReference:this.spatialReference,type:"point"}}lerp(e,t,i,n){return Object(o["j"])(n,e,t,i)}addDelta(e,t,i,n){e[0]+=t,e[1]+=i,0===this.valueType&&(e[2]+=n)}scale(e,t,i,n){const r=d["c"].get(),s=Object(l["d"])(r,e,t),o=Object(l["a"])(r,i,Object(l["g"])(i,s));Object(l["p"])(e,e,o,n-1)}rotate(e,t,i){Object(l["r"])(e,e,t,i)}pointToArray(e){return 0===this.valueType?[e.x,e.y,e.z]:[e.x,e.y,e.m]}getZ(e,t){return 0===this.valueType?e[2]:t}hasZ(){return 0===this.valueType}unnormalize(e){g(e,this._unnormalizationInfo)}fromXYZ(e,t=0,i=0){return this.tag(Object(s["g"])(e[0],e[1],0===this.valueType?e.length>2?e[2]:t:i))}toXYZ(e,t=0){return this.tag(Object(s["g"])(e[0],e[1],0===this.valueType?e[2]:t))}}class f{constructor(e,t){this.spatialReference=e,this._unnormalizationInfo=m(e,t)}tag(e){return e}createNew(){return this.tag(Object(c["c"])())}fromPoint(e){return this.tag(Object(c["d"])(e.x,e.y,e.z,e.m))}fromArray(e){return this.tag(Object(c["d"])(e[0],e[1],e[2]||0,e[3]||0))}toArray(e){return[e[0],e[1],e[2],e[3]]}clone(e){return this.tag(Object(c["g"])(e))}toPoint(e,t){return t.x=e[0],t.y=e[1],t.z=e[2],t.m=e[3],t.hasZ=!0,t.hasM=!0,t.spatialReference=this.spatialReference,t}createPoint(e){return new r["a"]({x:e[0],y:e[1],z:e[2],m:e[3],spatialReference:this.spatialReference})}createPointFromArray(e){return new r["a"]({x:e[0],y:e[1],z:e[2],m:e[3],spatialReference:this.spatialReference})}createDehydratedPoint(e){return{x:e[0],y:e[1],z:e[2],m:e[3],hasZ:!0,hasM:!0,spatialReference:this.spatialReference,type:"point"}}lerp(e,t,i,n){return Object(h["j"])(n,e,t,i)}addDelta(e,t,i,n){e[0]+=t,e[1]+=i,e[2]+=n}scale(e,t,i,n){const r=d["c"].get(),s=Object(l["d"])(r,e,t),o=Object(l["a"])(r,i,Object(l["g"])(i,s));Object(l["p"])(e,e,o,n-1)}rotate(e,t,i){Object(l["r"])(e,e,t,i)}pointToArray(e){return[e.x,e.y,e.z,e.m]}getZ(e){return e[2]}hasZ(){return!0}unnormalize(e){g(e,this._unnormalizationInfo)}fromXYZ(e,t=0,i=0){return this.tag(Object(c["d"])(e[0],e[1],e.length>2?e[2]:t,i))}toXYZ(e){return Object(s["g"])(e[0],e[1],e[2])}}function b(e,t,i,n){return e&&t?new f(i,n):t?new u(1,i,n):e?new u(0,i,n):new p(i,n)}function g(e,t){if(!t.supported)return;let i=1/0,n=-1/0;const r=t.upperBoundX-t.lowerBoundX;e.forEach(e=>{let s=e.pos[0];for(;s<t.lowerBoundX;)s+=r;for(;s>t.upperBoundX;)s-=r;i=Math.min(i,s),n=Math.max(n,s),e.pos[0]=s});const s=n-i;r-s<s&&e.forEach(e=>{e.pos[0]<0&&(e.pos[0]+=r)})}function m(e,t){const i=Object(n["d"])(e);return"global"===t&&i?{supported:!0,lowerBoundX:i.valid[0],upperBoundX:i.valid[1]}:{supported:!1,lowerBoundX:null,upperBoundX:null}}},"8e37":function(e,t,i){"use strict";i("c120");var n=i("b2b2"),r=["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uint","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"],s=r,o=i("9f8b"),a=999,c=9999,l=0,h=1,d=2,p=3,u=4,f=5,b=6,g=7,m=8,v=9,y=10,_=11,O=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"];function j(){var e,t,i,n=0,r=0,s=a,j=[],x=[],w=1,S=0,P=0,C=!1,T=!1,E="";return function(e){return x=[],null!==e?M(e.replace?e.replace(/\r\n/g,"\n"):e):k()};function A(e){e.length&&x.push({type:O[s],data:e,position:P,line:w,column:S})}function M(t){var o;for(n=0,i=(E+=t).length;e=E[n],n<i;){switch(o=n,s){case l:n=R();break;case h:n=I();break;case d:n=G();break;case p:n=z();break;case u:n=U();break;case _:n=H();break;case f:n=F();break;case c:n=q();break;case v:n=D();break;case a:n=V()}if(o!==n)switch(E[o]){case"\n":S=0,++w;break;default:++S}}return r+=n,E=E.slice(n),x}function k(e){return j.length&&A(j.join("")),s=y,A("(eof)"),x}function V(){return j=j.length?[]:j,"/"===t&&"*"===e?(P=r+n-1,s=l,t=e,n+1):"/"===t&&"/"===e?(P=r+n-1,s=h,t=e,n+1):"#"===e?(s=d,P=r+n,n):/\s/.test(e)?(s=v,P=r+n,n):(C=/\d/.test(e),T=/[^\w_]/.test(e),P=r+n,s=C?u:T?p:c,n)}function D(){return/[^\s]/g.test(e)?(A(j.join("")),s=a,n):(j.push(e),t=e,n+1)}function G(){return"\r"!==e&&"\n"!==e||"\\"===t?(j.push(e),t=e,n+1):(A(j.join("")),s=a,n)}function I(){return G()}function R(){return"/"===e&&"*"===t?(j.push(e),A(j.join("")),s=a,n+1):(j.push(e),t=e,n+1)}function z(){if("."===t&&/\d/.test(e))return s=f,n;if("/"===t&&"*"===e)return s=l,n;if("/"===t&&"/"===e)return s=h,n;if("."===e&&j.length){for(;L(j););return s=f,n}if(";"===e||")"===e||"("===e){if(j.length)for(;L(j););return A(e),s=a,n+1}var i=2===j.length&&"="!==e;if(/[\w_\d\s]/.test(e)||i){for(;L(j););return s=a,n}return j.push(e),t=e,n+1}function L(e){for(var t,i,n=0;;){if(t=o["c"].indexOf(e.slice(0,e.length+n).join("")),i=o["c"][t],-1===t){if(n--+e.length>0)continue;i=e.slice(0,1).join("")}return A(i),P+=i.length,(j=j.slice(i.length)).length}}function H(){return/[^a-fA-F0-9]/.test(e)?(A(j.join("")),s=a,n):(j.push(e),t=e,n+1)}function U(){return"."===e||/[eE]/.test(e)?(j.push(e),s=f,t=e,n+1):"x"===e&&1===j.length&&"0"===j[0]?(s=_,j.push(e),t=e,n+1):/[^\d]/.test(e)?(A(j.join("")),s=a,n):(j.push(e),t=e,n+1)}function F(){return"f"===e&&(j.push(e),t=e,n+=1),/[eE]/.test(e)||"-"===e&&/[eE]/.test(t)?(j.push(e),t=e,n+1):/[^\d]/.test(e)?(A(j.join("")),s=a,n):(j.push(e),t=e,n+1)}function q(){if(/[^\d\w_]/.test(e)){var i=j.join("");return s=o["b"].indexOf(i)>-1?m:o["a"].indexOf(i)>-1?g:b,A(j.join("")),s=a,n}return j.push(e),t=e,n+1}}function x(e){var t=j(),i=[];return(i=i.concat(t(e))).concat(t(null))}function w(e){return x(e)}function S(e){return e.map(e=>"eof"!==e.type?e.data:"").join("")}const P=["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"];function C(e,t="100",i="300 es"){const n=/^\s*\#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const r of e)if("preprocessor"===r.type){const e=n.exec(r.data);if(e){const n=e[1].replace(/\s\s+/g," ");if(n===i)return n;if(n===t)return r.data="#version "+i,t;throw new Error("unknown glsl version: "+n)}}return e.splice(0,0,{type:"preprocessor",data:"#version "+i},{type:"whitespace",data:"\n"}),null}function T(e,t){for(let i=t-1;i>=0;i--){const t=e[i];if("whitespace"!==t.type&&"block-comment"!==t.type){if("keyword"!==t.type)break;if("attribute"===t.data||"in"===t.data)return!0}}return!1}function E(e,t,i,n){n=n||i;for(const r of e)if("ident"===r.type&&r.data===i)return n in t?t[n]++:t[n]=0,E(e,t,n+"_"+t[n],n);return i}function A(e,t,i="afterVersion"){function n(e,t){for(let i=t;i<e.length;i++){const t=e[i];if("operator"===t.type&&";"===t.data)return i}return null}function r(e){let t=-1,r=0,s=-1;for(let o=0;o<e.length;o++){const a=e[o];if("preprocessor"===a.type&&(a.data.match(/\#(if|ifdef|ifndef)\s+.+/)?++r:a.data.match(/\#endif\s*.*/)&&--r),"afterVersion"!==i&&"afterPrecision"!==i||"preprocessor"===a.type&&/^#version/.test(a.data)&&(s=Math.max(s,o)),"afterPrecision"===i&&"keyword"===a.type&&"precision"===a.data){const t=n(e,o);if(null===t)throw new Error("precision statement not followed by any semicolons!");s=Math.max(s,t)}t<s&&0===r&&(t=o)}return t+1}const s={data:"\n",type:"whitespace"},o=t=>t<e.length&&/[^\r\n]$/.test(e[t].data);let a=r(e);o(a-1)&&e.splice(a++,0,s);for(const c of t)e.splice(a++,0,c);o(a-1)&&o(a)&&e.splice(a,0,s)}function M(e,t,i,n="lowp"){A(e,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:n},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"ident",data:t},{type:"operator",data:";"}],"afterPrecision")}function k(e,t,i,n,r="lowp"){A(e,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"="},{type:"whitespace",data:" "},{type:"integer",data:n.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"ident",data:t},{type:"operator",data:";"}],"afterPrecision")}function V(e,t){let i,n,r=-1;for(let s=t;s<e.length;s++){const t=e[s];if("operator"===t.type&&("["===t.data&&(i=s),"]"===t.data)){n=s;break}"integer"===t.type&&(r=parseInt(t.data,10))}return i&&n&&e.splice(i,n-i+1),r}function D(e,t){const i=w(e);if("300 es"===C(i,"100","300 es"))throw new Error("shader is already glsl 300 es");let n=null,r=null;const o={},a={};for(let c=0;c<i.length;++c){const e=i[c];switch(e.type){case"keyword":"vertex"===t&&"attribute"===e.data?e.data="in":"varying"===e.data&&(e.data="vertex"===t?"out":"in");break;case"builtin":if(/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(e.data.trim())&&(e.data=e.data.replace(/(2D|Cube|EXT)/g,"")),"fragment"===t&&"gl_FragColor"===e.data&&(n||(n=E(i,o,"fragColor"),M(i,n,"vec4")),e.data=n),"fragment"===t&&"gl_FragData"===e.data){const t=V(i,c+1),n=E(i,o,"fragData");k(i,n,"vec4",t,"mediump"),e.data=n}else"fragment"===t&&"gl_FragDepthEXT"===e.data&&(r||(r=E(i,o,"gl_FragDepth")),e.data=r);break;case"ident":if(s.indexOf(e.data)>=0){if("vertex"===t&&T(i,c))throw new Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");e.data in a||(a[e.data]=E(i,o,e.data)),e.data=a[e.data]}}}for(let s=i.length-1;s>=0;--s){const e=i[s];if("preprocessor"===e.type){const t=e.data.match(/\#extension\s+(.*)\:/);if(t&&t[1]&&P.indexOf(t[1].trim())>=0){const e=i[s+1];i.splice(s,e&&"whitespace"===e.type?2:1)}const n=e.data.match(/\#ifdef\s+(.*)/);n&&n[1]&&P.indexOf(n[1].trim())>=0&&(e.data="#if 1");const r=e.data.match(/\#ifndef\s+(.*)/);r&&r[1]&&P.indexOf(r[1].trim())>=0&&(e.data="#if 0")}}return S(i)}class G{constructor(e,t,i,n,r={}){if(this._context=null,this._glName=null,this._locations={},this._initialized=!1,this._vShader=null,this._fShader=null,this._defines={},this._nameToUniformLocation={},this._nameToAttribLocation={},this._nameToUniform1={},this._nameToUniform1v={},this._nameToUniform2={},this._nameToUniform3={},this._nameToUniform4={},this._nameToUniformMatrix3={},this._nameToUniformMatrix4={},e||console.error("RenderingContext isn't initialized!"),0===t.length&&console.error("Shaders source should not be empty!"),e.instanceCounter.increment(3,this),this._context=e,this._vertexShaderSource=t,this._fragmentShaderSource=i,Array.isArray(r))for(const s of r)this._defines[s]="1";else this._defines=r;this._locations=n}get glName(){return this._glName}get locations(){return this._locations}getDefine(e){return this._defines[e]}dispose(){if(!this._context)return;const e=this._context.gl;if(this._vShader){const t=this._vShader;e.deleteShader(t),this._vShader=null}if(this._fShader){const t=this._fShader;e.deleteShader(t),this._fShader=null}this._glName&&(e.deleteProgram(this._glName),this._glName=null),this._context.instanceCounter.decrement(3,this),this._context=null}initialize(){if(this._initialized)return;this._vShader=this._loadShader(35633),this._fShader=this._loadShader(35632),this._vShader&&this._fShader||console.error("Error loading shaders!");const e=this._context.gl,t=e.createProgram();e.attachShader(t,this._vShader),e.attachShader(t,this._fShader);for(const i in this._locations){const n=this._locations[i];e.bindAttribLocation(t,n,i)}e.linkProgram(t),this._glName=t,this._initialized=!0}getUniformLocation(e){return this.initialize(),void 0===this._nameToUniformLocation[e]&&(this._nameToUniformLocation[e]=this._context.gl.getUniformLocation(this._glName,e)),this._nameToUniformLocation[e]}hasUniform(e){return null!==this.getUniformLocation(e)}getAttribLocation(e){return this.initialize(),void 0===this._nameToAttribLocation[e]&&(this._nameToAttribLocation[e]=this._context.gl.getAttribLocation(this._glName,e)),this._nameToAttribLocation[e]}setUniform1i(e,t){const i=this._nameToUniform1[e];void 0!==i&&t===i||(this._context.bindProgram(this),this._context.gl.uniform1i(this.getUniformLocation(e),t),this._nameToUniform1[e]=t)}setUniform1iv(e,t){const i=this._nameToUniform1v[e];I(i,t)&&(this._context.bindProgram(this),this._context.gl.uniform1iv(this.getUniformLocation(e),t),void 0===i?this._nameToUniform1v[e]=G._arrayCopy(t):G._arrayAssign(t,i))}setUniform2iv(e,t){const i=this._nameToUniform2[e];I(i,t)&&(this._context.bindProgram(this),this._context.gl.uniform2iv(this.getUniformLocation(e),t),void 0===i?this._nameToUniform2[e]=G._arrayCopy(t):G._arrayAssign(t,i))}setUniform3iv(e,t){const i=this._nameToUniform3[e];I(i,t)&&(this._context.bindProgram(this),this._context.gl.uniform3iv(this.getUniformLocation(e),t),void 0===i?this._nameToUniform3[e]=G._arrayCopy(t):G._arrayAssign(t,i))}setUniform4iv(e,t){const i=this._nameToUniform4[e];I(i,t)&&(this._context.bindProgram(this),this._context.gl.uniform4iv(this.getUniformLocation(e),t),void 0===i?this._nameToUniform4[e]=G._arrayCopy(t):G._arrayAssign(t,i))}setUniform1f(e,t){const i=this._nameToUniform1[e];void 0!==i&&t===i||(this._context.bindProgram(this),this._context.gl.uniform1f(this.getUniformLocation(e),t),this._nameToUniform1[e]=t)}setUniform1fv(e,t){const i=this._nameToUniform1v[e];I(i,t)&&(this._context.bindProgram(this),this._context.gl.uniform1fv(this.getUniformLocation(e),t),void 0===i?this._nameToUniform1v[e]=G._arrayCopy(t):G._arrayAssign(t,i))}setUniform2f(e,t,i){const n=this._nameToUniform2[e];void 0!==n&&t===n[0]&&i===n[1]||(this._context.bindProgram(this),this._context.gl.uniform2f(this.getUniformLocation(e),t,i),void 0===n?this._nameToUniform2[e]=[t,i]:(n[0]=t,n[1]=i))}setUniform2fv(e,t){const i=this._nameToUniform2[e];I(i,t)&&(this._context.bindProgram(this),this._context.gl.uniform2fv(this.getUniformLocation(e),t),void 0===i?this._nameToUniform2[e]=G._arrayCopy(t):G._arrayAssign(t,i))}setUniform3f(e,t,i,n){const r=this._nameToUniform3[e];void 0!==r&&t===r[0]&&i===r[1]&&n===r[2]||(this._context.bindProgram(this),this._context.gl.uniform3f(this.getUniformLocation(e),t,i,n),void 0===r?this._nameToUniform3[e]=[t,i,n]:(r[0]=t,r[1]=i,r[2]=n))}setUniform3fv(e,t){const i=this._nameToUniform3[e];I(i,t)&&(this._context.bindProgram(this),this._context.gl.uniform3fv(this.getUniformLocation(e),t),void 0===i?this._nameToUniform3[e]=G._arrayCopy(t):G._arrayAssign(t,i))}setUniform4f(e,t,i,n,r){const s=this._nameToUniform4[e];void 0!==s&&t===s[0]&&i===s[1]&&n===s[2]&&r===s[3]||(this._context.bindProgram(this),this._context.gl.uniform4f(this.getUniformLocation(e),t,i,n,r),void 0===s?this._nameToUniform4[e]=[t,i,n,r]:(s[0]=t,s[1]=i,s[2]=n,s[3]=r))}setUniform4fv(e,t){const i=this._nameToUniform4[e];I(i,t)&&(this._context.bindProgram(this),this._context.gl.uniform4fv(this.getUniformLocation(e),t),void 0===i?this._nameToUniform4[e]=G._arrayCopy(t):G._arrayAssign(t,i))}setUniformMatrix3fv(e,t,i=!1){const n=this._nameToUniformMatrix3[e];R(n,t)&&(this._context.bindProgram(this),this._context.gl.uniformMatrix3fv(this.getUniformLocation(e),i,t),void 0===n?this._nameToUniformMatrix3[e]=G._arrayCopy(t):G._arrayAssign(t,n))}setUniformMatrix4fv(e,t,i=!1){const n=this._nameToUniformMatrix4[e];z(n,t)&&(this._context.bindProgram(this),this._context.gl.uniformMatrix4fv(this.getUniformLocation(e),i,t),void 0===n?this._nameToUniformMatrix4[e]=G._arrayCopy(t):G._arrayAssign(t,n))}assertCompatibleVertexAttributeLocations(e){const t=e.locations===this.locations;return t||console.error("VertexAttributeLocations are incompatible"),t}static _padToThree(e){let t=e.toString();return e<1e3&&(t=("  "+e).slice(-3)),t}_addLineNumbers(e){let t=2;return e.replace(/\n/g,()=>"\n"+G._padToThree(t++)+":")}_loadShader(e){const t=35633===e;let i=t?this._vertexShaderSource:this._fragmentShaderSource,n="";for(const o in this._defines)n+=`#define ${o} ${this._defines[o]}\n`;i=n+i,"webgl2"===this._context.contextVersion&&(i=D(i,t?"vertex":"fragment"));const r=this._context.gl,s=r.createShader(e);return r.shaderSource(s,i),r.compileShader(s),s}static _arrayCopy(e){const t=[];for(let i=0;i<e.length;++i)t.push(e[i]);return t}static _arrayAssign(e,t){for(let i=0;i<e.length;++i)t[i]=e[i]}}function I(e,t){if(Object(n["j"])(e)||e.length!==t.length)return!0;for(let i=0;i<e.length;++i)if(e[i]!==t[i])return!0;return!1}function R(e,t){return!!Object(n["j"])(e)||(9!==e.length?I(e,t):9!==e.length||e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||e[4]!==t[4]||e[5]!==t[5]||e[6]!==t[6]||e[7]!==t[7]||e[8]!==t[8])}function z(e,t){return!!Object(n["j"])(e)||(16!==e.length?I(e,t):16!==e.length||e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||e[4]!==t[4]||e[5]!==t[5]||e[6]!==t[6]||e[7]!==t[7]||e[8]!==t[8]||e[9]!==t[9]||e[10]!==t[10]||e[11]!==t[11]||e[12]!==t[12]||e[13]!==t[13]||e[14]!==t[14]||e[15]!==t[15])}t["a"]=G},"8f1c":function(e,t,i){"use strict";i.d(t,"a",(function(){return b}));i("c120");var n=i("b2b2"),r=i("0b2d"),s=i("e431"),o=i("af40"),a=i("7577"),c=i("5ef2"),l=i("19b9"),h=i("d0ac"),d=i("caf7"),p=i("86ba"),u=i("647b"),f=i("5fae");class b extends f["a"]{constructor(e){super(e),this._ray=h["g"].create(),this._externalResources=null,this._handles=new o["a"],this._isWorldDown=!1,this._start=Object(r["e"])(),this._end=Object(r["g"])(1,0,0),this._width=1,this._color=Object(c["c"])(1,0,1,1),this._polygonOffset=!1,this._writeDepthEnabled=!0,this._innerWidth=0,this._innerColor=Object(c["c"])(1,1,1,1),this._stippleIntegerRepeats=!0,this._stipplePattern=null,this._stippleOffColor=null,this._falloff=0,this._extensionType=0,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=4,this._fadedExtensions=O,this.applyProps(e)}createExternalResources(){const e=new p["a"](this.materialParameters);this._handles.add(this.view.state.watch("camera",()=>{this.updateGeometry()}));const t=new u["a"]({view:this.view,attached:this._laserlineEnabled});this._externalResources={material:e,laserline:t}}destroyExternalResources(){Object(n["k"])(this._externalResources)&&this._externalResources.laserline.destroy(),this._externalResources=null,this._handles.removeAll()}forEachExternalMaterial(e){Object(n["k"])(this._externalResources)&&e(this._externalResources.material)}createGeometries(e){const t=[Object(r["e"])(),Object(r["e"])()],i=3===this.extensionType;i&&t.push(Object(r["e"])(),Object(r["e"])());const s=i?new Float32Array([1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,0]):null,o=d["a"].createPolylineGeometry(t,null,s);e.addGeometry(o,Object(n["t"])(this._externalResources).material),this.updateVertices(o)}updateVisibility(e){super.updateVisibility(e),Object(n["k"])(this._externalResources)&&(this._externalResources.laserline.visible=e)}setStartEndFromWorldDownAtLocation(e){this._isWorldDown=!0,Object(s["l"])(this._start,e),this.view.renderCoordsHelper.worldUpAtPosition(e,this._end),Object(s["k"])(this._end,e,this._end),h["g"].fromPoints(this._start,this._end,this._ray),this.updateGeometry()}get start(){return this._start}set start(e){this._isWorldDown=!1,Object(s["r"])(this._start,e)||(Object(s["l"])(this._start,e),h["g"].fromPoints(this._start,this._end,this._ray),this.updateGeometry())}get end(){return this._end}set end(e){this._isWorldDown=!1,Object(s["r"])(this._end,e)||(Object(s["l"])(this._end,e),h["g"].fromPoints(this._start,this._end,this._ray),this.updateGeometry())}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this.updateMaterial())}get color(){return this._color}set color(e){Object(a["g"])(e,this._color)||(Object(a["c"])(this._color,e),this.updateMaterial())}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){e!==this._polygonOffset&&(this._polygonOffset=e,this.updateMaterial())}get writeDepthEnabled(){return this._writeDepthEnabled}set writeDepthEnabled(e){this._writeDepthEnabled!==e&&(this._writeDepthEnabled=e,this.updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this.updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){Object(a["g"])(e,this._innerColor)||(Object(a["c"])(this._innerColor,e),this.updateMaterial())}get stippleIntegerRepeats(){return this._stippleIntegerRepeats}set stippleIntegerRepeats(e){e!==this._stippleIntegerRepeats&&(this._stippleIntegerRepeats=e,this.updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){const t=Object(n["k"])(e)!==Object(n["k"])(this._stipplePattern);this._stipplePattern=e,t?this.recreate():this.updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){(Object(n["j"])(e)||Object(n["j"])(this._stippleOffColor)||!Object(a["g"])(e,this._stippleOffColor))&&(this._stippleOffColor=Object(n["k"])(e)?Object(c["a"])(e):null,this.updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this.updateMaterial())}get extensionType(){return this._extensionType}set extensionType(e){e!==this._extensionType&&(this._extensionType=e,this.updateGeometry())}get _laserlineAttached(){return this._laserlineEnabled&&Object(n["k"])(this._laserlineStyle)}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(e){this._laserlineStyle=e,Object(n["k"])(this._externalResources)&&(this._externalResources.laserline.attached=this._laserlineAttached,Object(n["k"])(e)&&(this._externalResources.laserline.style=e))}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,Object(n["k"])(this._externalResources)&&(this._externalResources.laserline.attached=this._laserlineAttached))}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this.updateMaterial())}get fadedExtensions(){return this._fadedExtensions}set fadedExtensions(e){this._fadedExtensions=Object(n["u"])(e,O),this.recreateGeometry()}updateMaterial(){Object(n["j"])(this._externalResources)||this._externalResources.material.setParameterValues(this.materialParameters)}get materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stippleIntegerRepeats:this._stippleIntegerRepeats,innerWidth:this._innerWidth,innerColor:this._innerColor,falloff:this._falloff,polygonOffset:this._polygonOffset,renderOccluded:this._renderOccluded,writeDepth:this._writeDepthEnabled}}updateGeometry(){Object(n["k"])(this.object)&&this.updateVertices(this.object.geometries[0])}updateVertices(e){const t=3===this._extensionType?this.updateLineSegmentFinite(y):this.updateLineSegmentInfinite(this._extensionType,y);this.updateVertexAttributes(e,t),Object(n["k"])(this._externalResources)&&(this._externalResources.laserline.intersectsLine=t)}updateLineSegmentFinite(e){return h["e"].fromPoints(this._start,this._end,e)}updateLineSegmentInfinite(e,t){const i=this.view.state.camera;switch(Object(l["e"])(this._ray,g),e){case 0:g.c0=-Number.MAX_VALUE;break;case 1:case 2:{const e=this._ray.origin,t=Object(n["u"])(this.view.elevationProvider.getElevation(e[0],e[1],e[2],this.view.renderCoordsHelper.spatialReference,"ground"),0),i=this.view.renderCoordsHelper.getAltitude(e);this._isWorldDown&&i<t&&Object(s["u"])(g.ray.direction,g.ray.direction),2===this._extensionType&&null!=t&&(g.c1=Math.abs(i-t));break}}if(!h["d"].intersectClipRay(i.frustum,g))return h["e"].fromPoints(this._start,this._end,t);const r=Object(l["f"])(g,m),o=Object(l["d"])(g,v);return h["e"].fromPoints(r,o,t)}updateVertexAttributes(e,t){const i=e.getMutableAttribute("position").data;if(3===this.extensionType){const e=h["e"].pointAt(t,-this.fadedExtensions.start,m);i[0]=e[0],i[1]=e[1],i[2]=e[2];const n=h["e"].pointAt(t,0,m);i[3]=n[0],i[4]=n[1],i[5]=n[2];const r=h["e"].pointAt(t,1,m);i[6]=r[0],i[7]=r[1],i[8]=r[2];const s=h["e"].pointAt(t,1+this.fadedExtensions.end,m);i[9]=s[0],i[10]=s[1],i[11]=s[2]}else{const e=h["e"].pointAt(t,0,m);i[0]=e[0],i[1]=e[1],i[2]=e[2];const n=h["e"].pointAt(t,1,m);i[3]=n[0],i[4]=n[1],i[5]=n[2]}Object(n["k"])(this.object)&&this.object.geometryVertexAttrsUpdated(0)}}const g=Object(l["b"])(),m=Object(r["e"])(),v=Object(r["e"])(),y=h["e"].create(),_=1/3,O={start:_,end:_}},"92af":function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));var n=i("df3b");class r extends n["a"]{constructor({coordinateHelper:e,targetPoint:t,objectId:i,constraint:n}){super(e,t,n),this.objectId=i}}},"955e":function(e,t,i){"use strict";var n=i("a4ee"),r=(i("c120"),i("e92d")),s=i("59b2"),o=i("4adc"),a=i("1a3e"),c=i("d386"),l=(i("e041"),i("8eed"),i("f402"),i("9d83")),h=i("2c4f"),d=i("255d"),p=(i("1b8f"),i("702a")),u=i("755e"),f=i("feab"),b=i("26fd"),g=i("121a"),m=(i("cea0"),i("fc29")),v=i("c9fb");let y=class extends m["a"]{constructor(e){super(e),this.layer=null,this.enabled=!0,this.updating=!1,this.availability=1}};Object(n["a"])([Object(s["b"])({constructOnly:!0})],y.prototype,"layer",void 0),Object(n["a"])([Object(s["b"])()],y.prototype,"enabled",void 0),Object(n["a"])([Object(s["b"])()],y.prototype,"updating",void 0),Object(n["a"])([Object(s["b"])()],y.prototype,"availability",void 0),y=Object(n["a"])([Object(c["a"])("esri.views.interactive.snapping.SnappingLayerSource")],y);var _=y,O=_;let j=class extends m["a"]{constructor(e){super(e),this.enabled=!1,this.enabledToggled=!1,this.selfEnabled=!0,this.featureEnabled=!0,this.featureSources=new h["a"],this.distance=v["a"].distance,this.touchSensitivityMultiplier=v["a"].touchSensitivityMultiplier}get effectiveEnabled(){return this.enabledToggled?!this.enabled:this.enabled}get effectiveSelfEnabled(){return this.effectiveEnabled&&this.selfEnabled}get effectiveFeatureEnabled(){return this.effectiveEnabled&&this.featureEnabled}};Object(n["a"])([Object(s["b"])()],j.prototype,"enabled",void 0),Object(n["a"])([Object(s["b"])()],j.prototype,"enabledToggled",void 0),Object(n["a"])([Object(s["b"])()],j.prototype,"selfEnabled",void 0),Object(n["a"])([Object(s["b"])()],j.prototype,"featureEnabled",void 0),Object(n["a"])([Object(s["b"])({type:h["a"].ofType(O)})],j.prototype,"featureSources",void 0),Object(n["a"])([Object(s["b"])()],j.prototype,"distance",void 0),Object(n["a"])([Object(s["b"])()],j.prototype,"touchSensitivityMultiplier",void 0),Object(n["a"])([Object(s["b"])({readOnly:!0})],j.prototype,"effectiveEnabled",null),Object(n["a"])([Object(s["b"])({readOnly:!0})],j.prototype,"effectiveSelfEnabled",null),Object(n["a"])([Object(s["b"])({readOnly:!0})],j.prototype,"effectiveFeatureEnabled",null),j=Object(n["a"])([Object(c["a"])("esri.views.interactive.snapping.SnappingOptions")],j);var x=j,w=x,S=i("b2b2"),P=i("ce50"),C=i("f4cc"),T=i("4ae5"),E=i("32ed"),A=(i("e06a"),i("ce6d")),M=i("4cac"),k=i("a915"),V=i("db52"),D=i("0d76"),G=i("4dc9"),I=i("1fd7"),R=i("8d60"),z=i("af40"),L=i("3795"),H=i("f694"),U=i("ce0b"),F=i("2589"),q=i("7aa6"),N=i("412f"),B=i("1a54"),W=i("1381"),Z=i("8b1a"),K=i("6ae9"),$=i("27df"),X=i("1f1c");let Y=class extends A["a"].EventedAccessor{constructor(e){var t;super(e),this._hasZ=null,this._snappingTask=null,this._stagedVertex=null,this._stagedVertexUnsnapped=null,this._lastVertexUnsnapped=null,this._nativeEventHistory={undoStack:[],redoStack:[]},this.interactiveUndoDisabled=!1,this.history=[],this.redoHistory=[],this.snapToScene=!1,this.view=null,this.elevationInfo=null,this.defaultZ=0,this._coordinateHelper=Object(Z["a"])(e.hasZ,!1,e.view.spatialReference,"local"),this._snappingManager=e.snappingManager,this._editGeometry=new $["a"](new K["c"](this._coordinateHelper),null!=(t=e.editGeometryType)?t:"polygon"),this._snappingContext=new X["a"]({geometry:this._editGeometry,elevationInfo:{mode:"on-the-ground",offset:0},pointer:"mouse",visualizer:new W["a"]}),this._activeComponent=new K["a"](this._editGeometry.editGeometry),this._editGeometry.editGeometry.components.push(this._activeComponent)}destroy(){this._snappingTask=Object(S["a"])(this._snappingTask),Object(S["k"])(this._snappingManager)&&this._snappingManager.doneSnapping(),this._editGeometry.destroy()}get _committedVertices(){return this._editGeometry.editGeometry.components[0].vertices.map(e=>e.pos)}get vertices(){return Object(S["k"])(this._stagedVertex)?[...this._committedVertices,this._coordinateHelper.pointToArray(this._stagedVertex)]:this._committedVertices}get hasZ(){return Object(S["k"])(this._hasZ)?this._hasZ:"3d"===this.view.type}set hasZ(e){this._hasZ=e,this.notifyChange("hasZ")}canUndo(){return this._editGeometry.editGeometry.canUndo}canRedo(){return this._editGeometry.editGeometry.canRedo}undo(){this.canUndo()&&this._editGeometry.undo()}redo(){this.canRedo()&&this._editGeometry.redo()}getCoordsFromScreenPoint(e){const t=this.screenToMap(e);return Object(S["k"])(t)?t.hasZ?[t.x,t.y,t.z]:[t.x,t.y]:null}getCoordsAndPointFromScreenPoint(e){const t=this.screenToMap(e);return Object(S["k"])(t)?t.hasZ?{vertex:[t.x,t.y,t.z],mapPoint:t}:{vertex:[t.x,t.y],mapPoint:t}:null}_pushCursorVertex(e){const t=Object(B["k"])(e[0],e[1],null,this.view.spatialReference);this._stagedVertexUnsnapped=t,Object(S["j"])(this._snappingManager)?this._stagedVertex=t:(this._stagedVertex=this._snappingManager.update(t,this._snappingContext),this._snappingTask=Object(C["i"])(async e=>{if(Object(S["k"])(this._snappingManager)){const i=await this._snappingManager.snap(t,this._snappingContext,e);return i.valid&&(this._stagedVertex=i.apply(),this.notifyChange("vertices")),i}return null}))}_popCursorVertex(){this._stagedVertex=null,this._stagedVertexUnsnapped=null,this.notifyChange("vertices")}getGeometryZValue(){return this.defaultZ}screenToMap(e){let t=null;if("3d"===this.view.type)if(this.hasZ){const i=Object(S["u"])(this.elevationInfo,J);t=this.view.sceneIntersectionHelper.intersectElevationFromScreen(Object(k["g"])(e.x,e.y),i,this.getGeometryZValue())}else{const i=Object(S["u"])(this.elevationInfo,Q);t=this.view.sceneIntersectionHelper.intersectElevationFromScreen(Object(k["g"])(e.x,e.y),i,0),Object(S["k"])(t)&&(t.z=void 0)}else t=this.view.toMap(e),Object(S["k"])(t)&&(t.z=this.hasZ?this.getGeometryZValue():void 0);return t}_isDuplicateOfLastVertex(e){const t=this._editGeometry.editGeometry.components[0].getLastVertex();if(Object(S["k"])(t)&&e[0]===t[0]&&e[1]===t[1])return!0;const{x:i,y:n}=this._coordinateHelper.createDehydratedPoint(e);return!(!Object(S["k"])(this._lastVertexUnsnapped)||i!==this._lastVertexUnsnapped.x||n!==this._lastVertexUnsnapped.y)}};Object(n["a"])([Object(s["b"])({readOnly:!0})],Y.prototype,"vertices",null),Object(n["a"])([Object(s["b"])({type:Boolean,nonNullable:!0})],Y.prototype,"interactiveUndoDisabled",void 0),Object(n["a"])([Object(s["b"])({readOnly:!0})],Y.prototype,"history",void 0),Object(n["a"])([Object(s["b"])({readOnly:!0})],Y.prototype,"redoHistory",void 0),Object(n["a"])([Object(s["b"])()],Y.prototype,"snapToScene",void 0),Object(n["a"])([Object(s["b"])()],Y.prototype,"view",void 0),Object(n["a"])([Object(s["b"])()],Y.prototype,"elevationInfo",void 0),Object(n["a"])([Object(s["b"])({nonNullable:!0})],Y.prototype,"defaultZ",void 0),Object(n["a"])([Object(s["b"])()],Y.prototype,"hasZ",null),Y=Object(n["a"])([Object(c["a"])("esri.views.draw.DrawAction")],Y);const J={mode:"absolute-height",offset:0},Q={mode:"on-the-ground",offset:0};var ee=Y,te=ee;class ie{constructor(e,t,i,n){this.view=e,this.native=t,this.vertexIndex=i,this.vertices=n,this.defaultPrevented=!1,this.type="vertex-add"}preventDefault(){this.defaultPrevented=!0}}class ne{constructor(e,t,i,n){this.view=e,this.native=t,this.vertexIndex=i,this.vertices=n,this.defaultPrevented=!1,this.type="vertex-remove"}preventDefault(){this.defaultPrevented=!0}}class re{constructor(e,t,i,n,r=null){this.view=e,this.native=t,this.vertexIndex=i,this.vertices=n,this.mapPoint=r,this.coordinates=null,this.defaultPrevented=!1,this.type="cursor-update",this.coordinates=1===n.length?n[0]:null}preventDefault(){this.defaultPrevented=!0}}class se{constructor(e,t){this.native=e,this.vertices=t,this.coordinates=null,this.defaultPrevented=!1,this.type="draw-complete",this.coordinates=1===t.length?t[0]:null}preventDefault(){this.defaultPrevented=!0}}const oe={drawCompleteKey:"c",redoKey:"r",undoKey:"z",vertexAddKey:"f",panKey:" "};let ae=class extends te{constructor(e){super(e),this._cursorScreenPoint=null,this._popVertexOnPointerMove=!1,this._addVertexOnPointerUp=!1,this._activePointerId=null,this._viewHandles=new z["a"],this._undoRedoHandles=new z["a"]}initialize(){this._addViewHandles(),this._addUndoRedoHandles()}destroy(){this._removeViewHandles(),this._viewHandles.destroy(),this._removeUndoRedoHandles(),this._undoRedoHandles.destroy(),this.emit("destroy")}undo(){super.undo(),this.notifyChange("vertices")}redo(){super.redo(),this.notifyChange("vertices")}complete(){this._completeDrawing()}_addViewHandles(){this._removeViewHandles(),this._viewHandles.add([this.view.on("click",e=>{e.stopPropagation()},F["b"].TOOL),this.view.on("pointer-down",e=>{this._shouldHandlePointerEvent(e)&&(this._snappingTask=Object(S["a"])(this._snappingTask),this._activePointerId=e.pointerId,this._addVertexOnPointerUp=!0,this._cursorScreenPoint=Object(N["a"])(e),"touch"===e.pointerType&&this._updateCursor(e.native))},F["b"].TOOL),this.view.on("pointer-move",e=>{this._popVertexOnPointerMove&&(this.undo(),this._popVertexOnPointerMove=!1),this._snappingTask=Object(S["a"])(this._snappingTask),this._cursorScreenPoint=Object(N["a"])(e),"touch"!==e.pointerType&&this._updateCursor(e.native)},F["b"].TOOL),this.view.on("pointer-drag",e=>{this._shouldHandlePointerEvent(e)&&(this._snappingTask=Object(S["a"])(this._snappingTask),this._addVertexOnPointerUp=!1)},F["b"].TOOL),this.view.on("pointer-up",e=>{if(this._shouldHandlePointerEvent(e))if(this._snappingTask=Object(S["a"])(this._snappingTask),this._activePointerId=null,this._addVertexOnPointerUp)this._vertexAddHandler(e);else{const t="touch"===e.pointerType;this._updateCursor(e.native,t)}},F["b"].TOOL),this.view.on("drag",["Shift"],e=>{e.stopPropagation()},F["b"].TOOL),this.view.on("double-click",e=>{e.stopPropagation(),this._drawCompleteHandler(e)},F["b"].TOOL),this.view.on("double-click",["Control"],e=>{e.stopPropagation(),this._drawCompleteHandler(e)},F["b"].TOOL),this.view.on("key-down",e=>{const{key:t,repeat:i}=e;t===oe.vertexAddKey&&!i&&this._cursorScreenPoint?(e.stopPropagation(),this._snappingTask=Object(S["a"])(this._snappingTask),this._vertexAddHandler(e)):t===oe.drawCompleteKey&&!i&&this._cursorScreenPoint&&this.vertices.length>2?(e.stopPropagation(),this._snappingTask=Object(S["a"])(this._snappingTask),this._vertexAddHandler(e),this._drawCompleteHandler(e)):t!==oe.undoKey||this.interactiveUndoDisabled||i?t!==oe.redoKey||this.interactiveUndoDisabled||i?t!==oe.panKey||i||e.stopPropagation():(e.stopPropagation(),this.redo()):(e.stopPropagation(),this.undo())},F["b"].TOOL),this.view.on("key-up",e=>{e.key===oe.panKey&&e.stopPropagation()},F["b"].TOOL)])}_addUndoRedoHandles(){this._removeUndoRedoHandles(),this._undoRedoHandles.add([this._editGeometry.on("vertex-remove",e=>{if(this.notifyChange("vertices"),"undo"===e.operation){const t=this._nativeEventHistory.undoStack.pop();this._nativeEventHistory.redoStack.push(t);const i=[...this._committedVertices];Object(S["k"])(this._stagedVertex)&&i.push(this._coordinateHelper.pointToArray(this._stagedVertex)),this.emit("undo",new ne(this.view,t,e.vertices[0].index,i))}}),this._editGeometry.on("vertex-add",e=>{if(this.notifyChange("vertices"),"apply"===e.operation){const e=this._nativeEventHistory.undoStack[this._nativeEventHistory.undoStack.length],t=this._committedVertices.length-1,i=new ie(this.view,e,t,this.vertices);this.emit("vertex-add",i),i.defaultPrevented&&(this._popVertexOnPointerMove=!0)}else if("redo"===e.operation){const t=this._nativeEventHistory.redoStack.pop();this._nativeEventHistory.undoStack.push(t);const i=[...this._committedVertices];Object(S["k"])(this._stagedVertex)&&i.push(this._coordinateHelper.pointToArray(this._stagedVertex)),this.emit("redo",new ie(this.view,t,e.vertices[0].index,i))}})])}_removeViewHandles(){this._viewHandles.removeAll()}_removeUndoRedoHandles(){this._undoRedoHandles.removeAll()}_addVertex(e,t){const i=this._coordinateHelper.fromArray(e);if(this._isDuplicateOfLastVertex(i))return;this._lastVertexUnsnapped=this._stagedVertexUnsnapped,this._popCursorVertex(),this._editGeometry.appendVertex(i);const n=t||new Event("placeholder");this._nativeEventHistory.undoStack.push(n)}_updateCursor(e,t=!1){if(this._popCursorVertex(),!this._cursorScreenPoint)return;const i=this.getCoordsAndPointFromScreenPoint(this._cursorScreenPoint);if(Object(S["k"])(i)&&!t){this._pushCursorVertex(i.vertex);const t=()=>new re(this.view,e,this._activeComponent.vertices.length,this.vertices,Object(S["k"])(this._stagedVertex)?new T["a"](this._stagedVertex):null);this.emit("cursor-update",t()),Object(S["k"])(this._snappingTask)&&this._snappingTask.promise.then(e=>{e.valid&&this.emit("cursor-update",t())},()=>{})}}_completeDrawing(e){if(this._activePointerId=null,this._popCursorVertex(),this._snappingTask=Object(S["a"])(this._snappingTask),Object(S["k"])(this._snappingManager)&&this._snappingManager.doneSnapping(),this.vertices.length<2)return;const t=new se(e,this.vertices);this.emit("draw-complete",t),t.defaultPrevented||this._removeViewHandles()}_shouldHandlePointerEvent(e){return ce(e)&&(Object(S["j"])(this._activePointerId)||this._activePointerId===e.pointerId)}_vertexAddHandler(e){const t=Object(S["k"])(this._stagedVertex)?this._coordinateHelper.pointToArray(this._stagedVertex):this.getCoordsFromScreenPoint(this._cursorScreenPoint);Object(S["k"])(t)&&this._addVertex(t,e.native)}_drawCompleteHandler(e){this._completeDrawing(e.native)}};function ce(e){return"mouse"!==e.pointerType||0===e.button}ae=Object(n["a"])([Object(c["a"])("esri.views.draw.MultipointDrawAction")],ae);Object.freeze({__proto__:null,get MultipointDrawAction(){return ae}});var le=i("e20b"),he=i("6469"),de=i("025c"),pe=i("4772");let ue=class extends(A["a"].EventedMixin(pe["a"])){constructor(e){super(e),this.drawOperation=null,this.hasZ=!0,this.defaultZ=0,this.elevationInfo=null,this.snapToScene=null,this.mode=null,this.geometryType=null,this.type="draw-3d"}initialize(){const e=Object(S["u"])(this.elevationInfo,{mode:this.hasZ?"absolute-height":"on-the-ground",offset:0});this.drawOperation=new he["a"]({view:this.view,manipulators:this.manipulators,geometryType:this.geometryType,drawingMode:this.mode,hasZ:this.hasZ,defaultZ:this.defaultZ,snapToSceneEnabled:this.snapToScene,snappingDrawSurface:new de["b"](this.view,e),elevationDrawSurface:new de["a"](e,this.defaultZ,this.view),hasM:!1,elevationInfo:e}),this.drawOperation.on("vertex-add",e=>this.onVertexAdd(e)),this.drawOperation.on("vertex-remove",e=>this.onVertexRemove(e)),this.drawOperation.on("vertex-update",e=>this.onVertexUpdate(e)),this.drawOperation.on("cursor-update",e=>this.onCursorUpdate(e)),this.drawOperation.on("complete",e=>this.onComplete(e))}destroy(){this.drawOperation.destroy(),this.drawOperation=null,this._set("view",null)}onInputEvent(e){this.drawOperation.onInputEvent(e)}set enabled(e){this.drawOperation.interactive=e,this._set("enabled",e)}reset(){}get canRedo(){return this.drawOperation.canRedo}redo(){this.drawOperation.redo()}get canUndo(){return this.drawOperation.canUndo}undo(){this.drawOperation.undo()}completeCreateOperation(){this.drawOperation.complete()}activate(){}deactivate(){this.drawOperation.isCompleted||this.drawOperation.cancel()}getVertexCoords(){return this.drawOperation.vertices}onVertexAdd(e){this.emit("vertex-add",e)}onVertexRemove(e){this.emit("vertex-remove",e)}onVertexUpdate(e){this.emit("vertex-update",e)}onCursorUpdate(e){this.emit("cursor-update",e)}onComplete(e){this.emit("complete",e)}};Object(n["a"])([Object(s["b"])({constructOnly:!0,nonNullable:!0})],ue.prototype,"view",void 0),Object(n["a"])([Object(s["b"])({value:!0})],ue.prototype,"enabled",null),Object(n["a"])([Object(s["b"])({constructOnly:!0})],ue.prototype,"hasZ",void 0),Object(n["a"])([Object(s["b"])({constructOnly:!0,nonNullable:!0})],ue.prototype,"defaultZ",void 0),Object(n["a"])([Object(s["b"])({constructOnly:!0})],ue.prototype,"elevationInfo",void 0),Object(n["a"])([Object(s["b"])()],ue.prototype,"snapToScene",void 0),Object(n["a"])([Object(s["b"])({constructOnly:!0})],ue.prototype,"mode",void 0),Object(n["a"])([Object(s["b"])({constructOnly:!0})],ue.prototype,"geometryType",void 0),Object(n["a"])([Object(s["b"])({readOnly:!0})],ue.prototype,"type",void 0),ue=Object(n["a"])([Object(c["a"])("esri.views.3d.interactive.editingTools.draw.DrawTool")],ue);let fe=class extends te{constructor(e){super(e),this._cursorScreenPoint=null,this._addVertexOnPointerUp=!1,this._activePointerId=null,this._viewHandles=new z["a"]}initialize(){"2d"===this.view.type?this._addViewHandles():this._addDrawTool(this.view)}destroy(){"2d"===this.view.type?(this._removeViewHandles(),this._viewHandles.destroy()):this._removeDrawTool(),this.emit("destroy")}get coordinates(){return Object(le["c"])(r["a"].getLogger("esri.views.draw.PointDrawAction"),"coordinates",{replacement:"vertices",version:"4.19"}),this.vertices[0]}complete(){"2d"===this.view.type?this._cursorScreenPoint&&this._completeDrawing():this._drawTool.completeCreateOperation()}_addViewHandles(){this._removeViewHandles(),this._viewHandles.add([this.view.on("pointer-down",e=>{this._shouldHandlePointerEvent(e)&&(this._snappingTask=Object(S["a"])(this._snappingTask),this._activePointerId=e.pointerId,this._addVertexOnPointerUp=!0,this._cursorScreenPoint=Object(N["a"])(e),"touch"===e.pointerType&&this._updateCursor(e.native))},F["b"].TOOL),this.view.on("pointer-move",e=>{this._snappingTask=Object(S["a"])(this._snappingTask),this._cursorScreenPoint=Object(N["a"])(e),"touch"!==e.pointerType&&this._updateCursor(e.native)},F["b"].TOOL),this.view.on("pointer-drag",e=>{this._shouldHandlePointerEvent(e)&&(this._snappingTask=Object(S["a"])(this._snappingTask),this._addVertexOnPointerUp=!1)},F["b"].TOOL),this.view.on("pointer-up",e=>{if(this._shouldHandlePointerEvent(e))if(this._snappingTask=Object(S["a"])(this._snappingTask),this._activePointerId=null,this._addVertexOnPointerUp)e.stopPropagation(),this._vertexAddHandler();else{const t="touch"===e.pointerType;this._updateCursor(e.native,t)}},F["b"].TOOL),this.view.on("drag",["Shift"],e=>{e.stopPropagation()},F["b"].TOOL),this.view.on("key-down",e=>{e.key===oe.drawCompleteKey&&this._cursorScreenPoint&&(this._snappingTask=Object(S["a"])(this._snappingTask),this._vertexAddHandler())},F["b"].TOOL)])}_removeViewHandles(){this._viewHandles.removeAll()}_addDrawTool(e){this._drawTool=new ue({view:e,elevationInfo:this.elevationInfo,hasZ:this.hasZ,geometryType:"point",mode:"click"}),this.view.toolViewManager.tools.push(this._drawTool),this.view.activeTool=this._drawTool,this._drawTool.on("cursor-update",e=>{1===e.vertices.length&&this.emit("cursor-update",new re(this.view,null,e.vertices[0].vertexIndex,this._drawTool.getVertexCoords()))}),this._drawTool.on("complete",e=>{this.emit("draw-complete",new se(null,this._drawTool.getVertexCoords())),this._removeDrawTool()})}_removeDrawTool(){Object(S["k"])(this._drawTool)&&(this.view.tools.remove(this._drawTool),this._drawTool.destroy(),this._drawTool=null)}_addVertex(e){const t=this._coordinateHelper.fromArray(e);this._isDuplicateOfLastVertex(t)||(this._lastVertexUnsnapped=this._stagedVertexUnsnapped,this._popCursorVertex(),this._editGeometry.appendVertex(t),this.notifyChange("vertices"))}_updateCursor(e,t=!1){if(this._popCursorVertex(),!this._cursorScreenPoint)return;const i=this.getCoordsAndPointFromScreenPoint(this._cursorScreenPoint);if(Object(S["k"])(i)&&!t){this._pushCursorVertex(i.vertex);const t=()=>new re(this.view,e,this._activeComponent.vertices.length,this.vertices,Object(S["k"])(this._stagedVertex)?new T["a"](this._stagedVertex):null);this.emit("cursor-update",t()),Object(S["k"])(this._snappingTask)&&this._snappingTask.promise.then(e=>{e.valid&&this.emit("cursor-update",t())},()=>{})}}_completeDrawing(e){this._activePointerId=null,this._popCursorVertex(),this._snappingTask=Object(S["a"])(this._snappingTask),Object(S["k"])(this._snappingManager)&&this._snappingManager.doneSnapping();const t=new se(e,this.vertices);this.emit("draw-complete",t),t.defaultPrevented||this._removeViewHandles()}_shouldHandlePointerEvent(e){return be(e)&&(Object(S["j"])(this._activePointerId)||this._activePointerId===e.pointerId)}_vertexAddHandler(){const e=Object(S["k"])(this._stagedVertex)?this._coordinateHelper.pointToArray(this._stagedVertex):this.getCoordsFromScreenPoint(this._cursorScreenPoint);Object(S["k"])(e)&&(this._addVertex(e),this._completeDrawing())}};function be(e){return"mouse"!==e.pointerType||0===e.button}Object(n["a"])([Object(s["b"])({readOnly:!0})],fe.prototype,"coordinates",null),fe=Object(n["a"])([Object(c["a"])("esri.views.draw.PointDrawAction")],fe);var ge=i("4aea");let me=class extends te{constructor(e){super(e),this._cursorScreenPoint=null,this._panEnabled=!1,this._popVertexOnPointerMove=!1,this._addVertexOnPointerUp=!1,this._activePointerId=null,this._viewHandles=new z["a"],this._undoRedoHandles=new z["a"],this.mode=ge["a"]}initialize(){"2d"===this.view.type?(this._addViewHandles(),this._addUndoRedoHandles()):this._addDrawTool(this.view)}destroy(){"2d"===this.view.type?(this._removeViewHandles(),this._viewHandles.destroy(),this._removeUndoRedoHandles(),this._undoRedoHandles.destroy()):this._removeDrawTool(),this.emit("destroy")}get _dragEnabled(){return"freehand"===this.mode||"hybrid"===this.mode}get _clickEnabled(){return"click"===this.mode||"hybrid"===this.mode}undo(){super.undo(),this.notifyChange("vertices")}redo(){super.redo(),this.notifyChange("vertices")}complete(){"2d"===this.view.type?this._completeDrawing():this._drawTool.completeCreateOperation()}getGeometryZValue(){return this.vertices.length>0&&this.vertices[0].length>2?this.vertices[0][2]:this._get("defaultZ")}_addViewHandles(){this._removeViewHandles(),this._viewHandles.add([this.view.on("click",e=>{e.stopPropagation()},F["b"].TOOL),this.view.on("pointer-down",e=>{this._shouldHandlePointerEvent(e)&&(this._snappingTask=Object(S["a"])(this._snappingTask),this._activePointerId=e.pointerId,this._addVertexOnPointerUp=!0,this._cursorScreenPoint=Object(N["a"])(e),"touch"===e.pointerType&&this._updateCursor(e.native))},F["b"].TOOL),this.view.on("pointer-move",e=>{this._snappingTask=Object(S["a"])(this._snappingTask),this._popVertexOnPointerMove&&(this.undo(),this._popVertexOnPointerMove=!1),this._cursorScreenPoint=Object(N["a"])(e),"touch"!==e.pointerType&&this._updateCursor(e.native)},F["b"].TOOL),this.view.on("pointer-drag",e=>{this._shouldHandlePointerEvent(e)&&(this._snappingTask=Object(S["a"])(this._snappingTask),this._cursorScreenPoint=Object(N["a"])(e),this._dragEnabled&&!this._panEnabled?this._vertexAddHandler(e):this._addVertexOnPointerUp=!1)},F["b"].TOOL),this.view.on("pointer-up",e=>{if(this._shouldHandlePointerEvent(e))if(this._snappingTask=Object(S["a"])(this._snappingTask),this._activePointerId=null,this._addVertexOnPointerUp){if(!this._clickEnabled)return 1===this.vertices.length&&this.vertices.pop(),void this._drawCompleteHandler(e);this._vertexAddHandler(e)}else{const t="touch"===e.pointerType;this._updateCursor(e.native,t)}},F["b"].TOOL),this.view.on("drag",e=>{this._dragEnabled&&Object(S["k"])(this._activePointerId)&&!this._panEnabled&&e.stopPropagation()},F["b"].TOOL),this.view.on("drag",["Shift"],e=>{e.stopPropagation()},F["b"].TOOL),this.view.on("double-click",e=>{e.stopPropagation(),this._drawCompleteHandler(e)},F["b"].TOOL),this.view.on("double-click",["Control"],e=>{e.stopPropagation(),this._drawCompleteHandler(e)},F["b"].TOOL),this.view.on("key-down",e=>{const{key:t,repeat:i}=e;t===oe.vertexAddKey&&!i&&this._cursorScreenPoint?(e.stopPropagation(),this._snappingTask=Object(S["a"])(this._snappingTask),this._vertexAddHandler(e)):t===oe.drawCompleteKey&&!i&&this._cursorScreenPoint&&this.vertices.length>2?(e.stopPropagation(),this._snappingTask=Object(S["a"])(this._snappingTask),this._vertexAddHandler(e),this._drawCompleteHandler(e)):t!==oe.undoKey||this.interactiveUndoDisabled||i?t!==oe.redoKey||this.interactiveUndoDisabled||i?t!==oe.panKey||i||(e.stopPropagation(),this._panEnabled=!0):(e.stopPropagation(),this.redo()):(e.stopPropagation(),this.undo())},F["b"].TOOL),this.view.on("key-up",e=>{e.key===oe.panKey&&(e.stopPropagation(),this._panEnabled=!1)},F["b"].TOOL)])}_addUndoRedoHandles(){this._removeUndoRedoHandles(),this._undoRedoHandles.add([this._editGeometry.on("vertex-remove",e=>{if(this.notifyChange("vertices"),"undo"===e.operation){const t=this._nativeEventHistory.undoStack.pop();this._nativeEventHistory.redoStack.push(t);const i=[...this._committedVertices];Object(S["k"])(this._stagedVertex)&&i.push(this._coordinateHelper.pointToArray(this._stagedVertex)),this.emit("undo",new ne(this.view,t,e.vertices[0].index,i))}}),this._editGeometry.on("vertex-add",e=>{if(this.notifyChange("vertices"),"apply"===e.operation){const e=this._nativeEventHistory.undoStack[this._nativeEventHistory.undoStack.length],t=this._committedVertices.length-1,i=new ie(this.view,e,t,this.vertices);this.emit("vertex-add",i),i.defaultPrevented&&(this._popVertexOnPointerMove=!0)}else if("redo"===e.operation){const t=this._nativeEventHistory.redoStack.pop();this._nativeEventHistory.undoStack.push(t);const i=[...this._committedVertices];Object(S["k"])(this._stagedVertex)&&i.push(this._coordinateHelper.pointToArray(this._stagedVertex)),this.emit("redo",new ie(this.view,t,e.vertices[0].index,i))}})])}_removeViewHandles(){this._viewHandles.removeAll()}_removeUndoRedoHandles(){this._undoRedoHandles.removeAll()}_addDrawTool(e){this._drawTool=new ue({view:e,elevationInfo:this.elevationInfo,hasZ:this.hasZ,geometryType:"polygon",mode:this.mode}),this.view.toolViewManager.tools.push(this._drawTool),this.view.activeTool=this._drawTool,this._drawTool.on("vertex-add",e=>{1===e.vertices.length&&this.emit("vertex-add",new ie(this.view,null,e.vertices[0].vertexIndex,this._drawTool.getVertexCoords()))}),this._drawTool.on("cursor-update",e=>{1===e.vertices.length&&this.emit("cursor-update",new re(this.view,null,e.vertices[0].vertexIndex,this._drawTool.getVertexCoords()))}),this._drawTool.on("complete",e=>{this.emit("draw-complete",new se(null,this._drawTool.getVertexCoords())),this._removeDrawTool()})}_removeDrawTool(){Object(S["k"])(this._drawTool)&&(this.view.tools.remove(this._drawTool),this._drawTool.destroy(),this._drawTool=null)}_addVertex(e,t){const i=this._coordinateHelper.fromArray(e);if(this._isDuplicateOfLastVertex(i))return;this._lastVertexUnsnapped=this._stagedVertexUnsnapped,this._popCursorVertex(),this._editGeometry.appendVertex(i);const n=t||new Event("placeholder");this._nativeEventHistory.undoStack.push(n)}_updateCursor(e,t=!1){if(this._popCursorVertex(),!this._cursorScreenPoint)return;const i=this.getCoordsAndPointFromScreenPoint(this._cursorScreenPoint);if(Object(S["k"])(i)&&!t){this._pushCursorVertex(i.vertex);const t=()=>new re(this.view,e,this._activeComponent.vertices.length,this.vertices,Object(S["k"])(this._stagedVertex)?new T["a"](this._stagedVertex):null);this.emit("cursor-update",t()),Object(S["k"])(this._snappingTask)&&this._snappingTask.promise.then(e=>{e.valid&&this.emit("cursor-update",t())},()=>{})}}_completeDrawing(e){if(this._activePointerId=null,this._popCursorVertex(),this._snappingTask=Object(S["a"])(this._snappingTask),Object(S["k"])(this._snappingManager)&&this._snappingManager.doneSnapping(),this.vertices.length<3)return;const t=new se(e,this.vertices);this.emit("draw-complete",t),t.defaultPrevented||this._removeViewHandles()}_shouldHandlePointerEvent(e){return ve(e)&&(Object(S["j"])(this._activePointerId)||this._activePointerId===e.pointerId)}_vertexAddHandler(e){const t=Object(S["k"])(this._stagedVertex)?this._coordinateHelper.pointToArray(this._stagedVertex):this.getCoordsFromScreenPoint(this._cursorScreenPoint);Object(S["k"])(t)&&this._addVertex(t,e.native)}_drawCompleteHandler(e){this._completeDrawing(e.native)}};function ve(e){return"mouse"!==e.pointerType||0===e.button}Object(n["a"])([Object(s["b"])()],me.prototype,"_dragEnabled",null),Object(n["a"])([Object(s["b"])()],me.prototype,"_clickEnabled",null),Object(n["a"])([Object(s["b"])({type:ge["b"]})],me.prototype,"mode",void 0),me=Object(n["a"])([Object(c["a"])("esri.views.draw.PolygonDrawAction")],me);let ye=class extends te{constructor(e){super(e),this._cursorScreenPoint=null,this._panEnabled=!1,this._popVertexOnPointerMove=!1,this._addVertexOnPointerUp=!1,this._activePointerId=null,this._viewHandles=new z["a"],this._undoRedoHandles=new z["a"],this.mode=ge["a"]}initialize(){"2d"===this.view.type?(this._addViewHandles(),this._addUndoRedoHandles()):this._addDrawTool(this.view)}destroy(){"2d"===this.view.type?(this._removeViewHandles(),this._viewHandles.destroy(),this._removeUndoRedoHandles(),this._undoRedoHandles.destroy()):this._removeDrawTool(),this.emit("destroy")}get _clickEnabled(){return"click"===this.mode||"hybrid"===this.mode}get _dragEnabled(){return"freehand"===this.mode||"hybrid"===this.mode}undo(){super.undo(),this.notifyChange("vertices")}redo(){super.redo(),this.notifyChange("vertices")}complete(){"2d"===this.view.type?this._completeDrawing():this._drawTool.completeCreateOperation()}_addViewHandles(){this._removeViewHandles(),this._viewHandles.add([this.view.on("click",e=>{e.stopPropagation()},F["b"].TOOL),this.view.on("pointer-down",e=>{this._shouldHandlePointerEvent(e)&&!this._panEnabled&&(this._snappingTask=Object(S["a"])(this._snappingTask),this._activePointerId=e.pointerId,this._addVertexOnPointerUp=!0,this._cursorScreenPoint=Object(N["a"])(e),"touch"===e.pointerType&&this._updateCursor(e.native))},F["b"].TOOL),this.view.on("pointer-move",e=>{this._popVertexOnPointerMove&&(this.undo(),this._popVertexOnPointerMove=!1),this._snappingTask=Object(S["a"])(this._snappingTask),this._cursorScreenPoint=Object(N["a"])(e),"touch"!==e.pointerType&&this._updateCursor(e.native)},F["b"].TOOL),this.view.on("pointer-drag",e=>{this._shouldHandlePointerEvent(e)&&(this._snappingTask=Object(S["a"])(this._snappingTask),this._cursorScreenPoint=Object(N["a"])(e),this._dragEnabled&&!this._panEnabled?this._vertexAddHandler(e):this._addVertexOnPointerUp=!1)},F["b"].TOOL),this.view.on("pointer-up",e=>{if(this._shouldHandlePointerEvent(e))if(this._snappingTask=Object(S["a"])(this._snappingTask),this._activePointerId=null,this._addVertexOnPointerUp){if(!this._clickEnabled)return 1===this.vertices.length&&this.vertices.pop(),void this._drawCompleteHandler(e);this._vertexAddHandler(e)}else{const t="touch"===e.pointerType;this._updateCursor(e.native,t)}},F["b"].TOOL),this.view.on("drag",e=>{this._dragEnabled&&Object(S["k"])(this._activePointerId)&&!this._panEnabled&&e.stopPropagation()},F["b"].TOOL),this.view.on("drag",["Shift"],e=>{e.stopPropagation()},F["b"].TOOL),this.view.on("double-click",e=>{e.stopPropagation(),this._drawCompleteHandler(e)},F["b"].TOOL),this.view.on("double-click",["Control"],e=>{e.stopPropagation(),this._drawCompleteHandler(e)},F["b"].TOOL),this.view.on("key-down",e=>{const{key:t,repeat:i}=e;t===oe.vertexAddKey&&!i&&this._cursorScreenPoint?(e.stopPropagation(),this._snappingTask=Object(S["a"])(this._snappingTask),this._vertexAddHandler(e)):t===oe.drawCompleteKey&&!i&&this._cursorScreenPoint&&this.vertices.length>1?(e.stopPropagation(),this._snappingTask=Object(S["a"])(this._snappingTask),this._vertexAddHandler(e),this._drawCompleteHandler(e)):t!==oe.undoKey||this.interactiveUndoDisabled||i?t!==oe.redoKey||this.interactiveUndoDisabled||i?t!==oe.panKey||i||(e.stopPropagation(),this._panEnabled=!0):(e.stopPropagation(),this.redo()):(e.stopPropagation(),this.undo())},F["b"].TOOL),this.view.on("key-up",e=>{e.key===oe.panKey&&(e.stopPropagation(),this._panEnabled=!1)},F["b"].TOOL)])}_addUndoRedoHandles(){this._removeUndoRedoHandles(),this._undoRedoHandles.add([this._editGeometry.on("vertex-remove",e=>{if(this.notifyChange("vertices"),"undo"===e.operation){const t=this._nativeEventHistory.undoStack.pop();this._nativeEventHistory.redoStack.push(t);const i=[...this._committedVertices];Object(S["k"])(this._stagedVertex)&&i.push(this._coordinateHelper.pointToArray(this._stagedVertex)),this.emit("undo",new ne(this.view,t,e.vertices[0].index,i))}}),this._editGeometry.on("vertex-add",e=>{if(this.notifyChange("vertices"),"apply"===e.operation){const e=this._nativeEventHistory.undoStack[this._nativeEventHistory.undoStack.length],t=this._committedVertices.length-1,i=new ie(this.view,e,t,this.vertices);this.emit("vertex-add",i),i.defaultPrevented&&(this._popVertexOnPointerMove=!0)}else if("redo"===e.operation){const t=this._nativeEventHistory.redoStack.pop();this._nativeEventHistory.undoStack.push(t);const i=[...this._committedVertices];Object(S["k"])(this._stagedVertex)&&i.push(this._coordinateHelper.pointToArray(this._stagedVertex)),this.emit("redo",new ie(this.view,t,e.vertices[0].index,i))}})])}_removeViewHandles(){this._viewHandles.removeAll()}_removeUndoRedoHandles(){this._undoRedoHandles.removeAll()}_addDrawTool(e){this._drawTool=new ue({view:e,elevationInfo:this.elevationInfo,hasZ:this.hasZ,geometryType:"polyline",mode:this.mode}),this.view.toolViewManager.tools.push(this._drawTool),this.view.activeTool=this._drawTool,this._drawTool.on("vertex-add",e=>{1===e.vertices.length&&this.emit("vertex-add",new ie(this.view,null,e.vertices[0].vertexIndex,this._drawTool.getVertexCoords()))}),this._drawTool.on("cursor-update",e=>{1===e.vertices.length&&this.emit("cursor-update",new re(this.view,null,e.vertices[0].vertexIndex,this._drawTool.getVertexCoords()))}),this._drawTool.on("complete",e=>{this.emit("draw-complete",new se(null,this._drawTool.getVertexCoords())),this._removeDrawTool()})}_removeDrawTool(){Object(S["k"])(this._drawTool)&&(this.view.tools.remove(this._drawTool),this._drawTool=Object(S["e"])(this._drawTool))}_addVertex(e,t){const i=this._coordinateHelper.fromArray(e);if(this._isDuplicateOfLastVertex(i))return;this._lastVertexUnsnapped=this._stagedVertexUnsnapped,this._popCursorVertex(),this._editGeometry.appendVertex(i);const n=t||new Event("placeholder");this._nativeEventHistory.undoStack.push(n)}_updateCursor(e,t=!1){if(this._popCursorVertex(),!this._cursorScreenPoint)return;const i=this.getCoordsAndPointFromScreenPoint(this._cursorScreenPoint);if(Object(S["k"])(i)&&!t){this._pushCursorVertex(i.vertex);const t=()=>new re(this.view,e,this._activeComponent.vertices.length,this.vertices,Object(S["k"])(this._stagedVertex)?new T["a"](this._stagedVertex):null);this.emit("cursor-update",t()),Object(S["k"])(this._snappingTask)&&this._snappingTask.promise.then(e=>{e.valid&&this.emit("cursor-update",t())},()=>{})}}_completeDrawing(e){if(this._activePointerId=null,this._popCursorVertex(),this._snappingTask=Object(S["a"])(this._snappingTask),Object(S["k"])(this._snappingManager)&&this._snappingManager.doneSnapping(),this.vertices.length<2)return;const t=new se(e,this.vertices);this.emit("draw-complete",t),t.defaultPrevented||this._removeViewHandles()}_shouldHandlePointerEvent(e){return _e(e)&&(Object(S["j"])(this._activePointerId)||this._activePointerId===e.pointerId)}_vertexAddHandler(e){const t=Object(S["k"])(this._stagedVertex)?this._coordinateHelper.pointToArray(this._stagedVertex):this.getCoordsFromScreenPoint(this._cursorScreenPoint);Object(S["k"])(t)&&this._addVertex(t,e.native)}_drawCompleteHandler(e){this._completeDrawing(e.native)}};function _e(e){return"mouse"!==e.pointerType||0===e.button}Object(n["a"])([Object(s["b"])()],ye.prototype,"_clickEnabled",null),Object(n["a"])([Object(s["b"])()],ye.prototype,"_dragEnabled",null),Object(n["a"])([Object(s["b"])({type:ge["b"]})],ye.prototype,"mode",void 0),ye=Object(n["a"])([Object(c["a"])("esri.views.draw.PolylineDrawAction")],ye);var Oe=i("a545");const je=["freehand","click"];let xe=class extends te{constructor(e){super(e),this._isDragging=!1,this._panEnabled=!1,this._cursorScreenPoint=null,this._viewHandles=new z["a"],this._activePointerId=null,this._addVertexOnPointerUp=!1,this.viewAlignedCoordinateSystem=null,this.mode="freehand"}initialize(){"2d"===this.view.type?this._addViewHandles():this._addDrawTool(this.view)}destroy(){"2d"===this.view.type?(this._removeViewHandles(),this._viewHandles.destroy()):this._removeDrawTool(),this.emit("destroy")}complete(){"2d"===this.view.type?this._completeDrawing():this._drawTool.completeCreateOperation()}getGeometryZValue(){return this.vertices.length>0&&this.vertices[0].length>2?this.vertices[0][2]:this._get("defaultZ")}_addViewHandles(){this._removeViewHandles(),"click"===this.mode?this._viewHandles.add(this._getClickModeViewHandles()):this._viewHandles.add(this._getDragModeViewHandles())}_getDragModeViewHandles(){return[this.view.on("immediate-click",e=>{if(e.stopPropagation(),e.mapPoint&&!this._panEnabled){const t=this.getCoordsFromScreenPoint(Object(N["a"])(e));Object(S["k"])(t)&&(this._vertexAddHandler(e),this._drawCompleteHandler(e))}},F["b"].TOOL),this.view.on("pointer-down",e=>{this._shouldHandlePointerEvent(e)&&(this._snappingTask=Object(S["a"])(this._snappingTask),this._panEnabled||(this._resetGeometry(),this._addVertexOnPointerUp=!0,this._cursorScreenPoint=Object(N["a"])(e),this._activePointerId=e.pointerId,this._vertexAddHandler(e),this._isDragging=!1,"touch"===e.pointerType&&this._updateCursor(e.native)))},F["b"].TOOL),this.view.on("pointer-move",e=>{this._snappingTask=Object(S["a"])(this._snappingTask),Object(S["j"])(this._activePointerId)&&"touch"!==e.pointerType&&(this._cursorScreenPoint=Object(N["a"])(e),this._updateCursor(e.native))},F["b"].TOOL),this.view.on("pointer-drag",e=>{this._shouldHandlePointerEvent(e)&&(this._snappingTask=Object(S["a"])(this._snappingTask),this._isDragging=!0,this._cursorScreenPoint=Object(N["a"])(e),this._updateCursor(e.native))},F["b"].TOOL),this.view.on("pointer-up",e=>{this._shouldHandlePointerEvent(e)&&this._addVertexOnPointerUp&&(this._snappingTask=Object(S["a"])(this._snappingTask),this._activePointerId=null,this._isDragging&&this._vertexAddHandler(e),2===this._committedVertices.length&&this._drawCompleteHandler(e),this._isDragging=!1)},F["b"].TOOL),this.view.on("key-down",e=>{e.key===oe.drawCompleteKey&&this._cursorScreenPoint?(this._snappingTask=Object(S["a"])(this._snappingTask),this._drawCompleteHandler(e)):e.key===oe.panKey&&(this._panEnabled=!0)},F["b"].TOOL),this.view.on("key-up",e=>{e.key===oe.panKey&&(this._panEnabled=!1)},F["b"].TOOL),this.view.on("drag",e=>{Object(S["k"])(this._activePointerId)&&e.stopPropagation()},F["b"].TOOL),this.view.on("drag",["Shift"],e=>{e.stopPropagation()},F["b"].TOOL)]}_getClickModeViewHandles(){return[this.view.on("pointer-down",e=>{this._snappingTask=Object(S["a"])(this._snappingTask),this._cursorScreenPoint=Object(N["a"])(e),this._activePointerId=e.pointerId,this._isDragging=!1,"touch"===e.pointerType&&this._updateCursor(e.native)},F["b"].TOOL),this.view.on("pointer-move",e=>{this._snappingTask=Object(S["a"])(this._snappingTask),this._cursorScreenPoint=Object(N["a"])(e),Object(S["j"])(this._activePointerId)&&"touch"!==e.pointerType&&this._updateCursor(e.native)},F["b"].TOOL),this.view.on("pointer-drag",e=>{this._shouldHandlePointerEvent(e)&&(this._snappingTask=Object(S["a"])(this._snappingTask),this._isDragging=!0)},F["b"].TOOL),this.view.on("pointer-up",e=>{this._shouldHandlePointerEvent(e)&&(this._snappingTask=Object(S["a"])(this._snappingTask),this._activePointerId=null,e.stopPropagation(),this._isDragging||this._vertexAddHandler(e),2!==this.vertices.length||this._isDragging||this._drawCompleteHandler(e),this._isDragging=!1)},F["b"].TOOL),this.view.on("key-down",e=>{e.key===oe.vertexAddKey&&this._cursorScreenPoint&&(this._vertexAddHandler(e),2===this.vertices.length&&this._drawCompleteHandler(e)),e.key===oe.drawCompleteKey&&this._cursorScreenPoint&&2===this.vertices.length&&this._drawCompleteHandler(e)},F["b"].TOOL)]}_removeViewHandles(){this._viewHandles.removeAll()}_addDrawTool(e){this._drawTool=new ue({view:e,elevationInfo:this.elevationInfo,hasZ:this.hasZ,geometryType:"segment",mode:this.mode}),this.view.toolViewManager.tools.push(this._drawTool),this.view.activeTool=this._drawTool,this._drawTool.on("vertex-add",e=>{1===e.vertices.length&&this.emit("vertex-add",new ie(this.view,null,e.vertices[0].vertexIndex,this._drawTool.getVertexCoords()))}),this._drawTool.on("cursor-update",e=>{1===e.vertices.length&&this.emit("cursor-update",new re(this.view,null,e.vertices[0].vertexIndex,this._drawTool.getVertexCoords()))}),this._drawTool.on("complete",e=>{this.emit("draw-complete",new se(null,this._drawTool.getVertexCoords())),this._removeDrawTool()})}_removeDrawTool(){Object(S["k"])(this._drawTool)&&(this.view.tools.remove(this._drawTool),this._drawTool.destroy(),this._drawTool=null)}_addVertex(e,t){const i=this._coordinateHelper.fromArray(e);if(this._isDuplicateOfLastVertex(i))return;this._lastVertexUnsnapped=this._stagedVertexUnsnapped,this._popCursorVertex(),this._editGeometry.appendVertex(i),1===this._committedVertices.length&&(this.viewAlignedCoordinateSystem=Object(Oe["a"])(this.view,this._committedVertices[0]));const n=this._committedVertices.length-1,r=new ie(this.view,t,n,this.vertices);this.emit("vertex-add",r)}_updateCursor(e){if(this._popCursorVertex(),!this._cursorScreenPoint)return;const t=this.getCoordsAndPointFromScreenPoint(this._cursorScreenPoint);if(Object(S["k"])(t)){this._pushCursorVertex(t.vertex);const i=()=>new re(this.view,e,this._activeComponent.vertices.length,this.vertices,Object(S["k"])(this._stagedVertex)?new T["a"](this._stagedVertex):null);this.emit("cursor-update",i()),Object(S["k"])(this._snappingTask)&&this._snappingTask.promise.then(e=>{e.valid&&this.emit("cursor-update",i())},()=>{})}}_completeDrawing(e){if(this._activePointerId=null,this._popCursorVertex(),this._cursorScreenPoint=null,this._isDragging=!1,this._snappingTask=Object(S["a"])(this._snappingTask),Object(S["k"])(this._snappingManager)&&this._snappingManager.doneSnapping(),this.vertices.length<1)return;const t=new se(e,this.vertices);this.emit("draw-complete",t),t.defaultPrevented||this._removeViewHandles()}_resetGeometry(){this._editGeometry.destroy(),this._editGeometry=new $["a"](new K["c"](this._coordinateHelper),"polygon"),this._activeComponent=new K["a"](this._editGeometry.editGeometry),this._editGeometry.editGeometry.components.push(this._activeComponent)}_shouldHandlePointerEvent(e){return we(e)&&(Object(S["j"])(this._activePointerId)||this._activePointerId===e.pointerId)}_vertexAddHandler(e){const t=Object(S["k"])(this._stagedVertex)?this._coordinateHelper.pointToArray(this._stagedVertex):this.getCoordsFromScreenPoint(this._cursorScreenPoint);Object(S["k"])(t)&&this._addVertex(t,e.native)}_drawCompleteHandler(e){this._completeDrawing(e.native)}};function we(e){return"mouse"!==e.pointerType||0===e.button}Object(n["a"])([Object(s["b"])({type:je})],xe.prototype,"mode",void 0),xe=Object(n["a"])([Object(c["a"])("esri/views/2d/engine/markup/SegmentDrawAction")],xe);let Se=class extends m["a"]{constructor(){super(...arguments),this.activeAction=null,this.type="draw",this.view=null}destroy(){this.activeAction&&(this.activeAction.destroy(),this.activeAction=null)}create(e,t){this.reset();const i={view:this.view,...t};switch(e){case"point":i.editGeometryType="point",this.activeAction=new fe(i);break;case"polyline":i.editGeometryType="polyline",this.activeAction=new ye(i);break;case"multipoint":i.editGeometryType="polygon",this.activeAction=new ae(i);break;case"polygon":i.editGeometryType="polygon",this.activeAction=new me(i);break;case"rectangle":case"circle":case"ellipse":case"triangle":i.editGeometryType="polygon",this.activeAction=new xe(i)}return this.activeAction}complete(){this.activeAction&&this.activeAction.complete(),this.activeAction=null}reset(){this.activeAction&&this.activeAction.destroy(),this.activeAction=null}};Object(n["a"])([Object(s["b"])()],Se.prototype,"activeAction",void 0),Object(n["a"])([Object(s["b"])({readOnly:!0})],Se.prototype,"type",void 0),Object(n["a"])([Object(s["b"])()],Se.prototype,"view",void 0),Se=Object(n["a"])([Object(c["a"])("esri.views.draw.Draw")],Se);var Pe=Se,Ce=Pe;function Te(e){switch(e){case 0:break;case 1:return"not owned by a graphics layer";case 2:return"no geometry";case 3:return"the geometry type is not supported";case 4:return"the elevation mode is not supported";case 5:return"the symbol type is not supported"}return""}var Ee=i("243f"),Ae=i("240c"),Me=i("f408");function ke(e){var t;if("graphics"!==(null==(t=e.layer)?void 0:t.type))return 1;if(Object(S["j"])(e.geometry))return 2;switch(e.geometry.type){case"point":break;case"polygon":case"polyline":return 0;case"multipoint":case"extent":case"mesh":default:return 3}const i=Object(S["k"])(e.symbol)&&"point-3d"===e.symbol.type&&e.symbol.symbolLayers;return i&&i.length>0&&i.some(e=>"object"===e.type)?"on-the-ground"!==Object(Me["e"])(e)&&Object(Me["g"])(e)?4:0:5}let Ve=null;async function De(){return Ve||(Ve=await Promise.all([i.e("chunk-2d22cf8c"),i.e("chunk-3529a025")]).then(i.bind(null,"dfd4"))),Ve}var Ge=i("b65e"),Ie=i("9efb"),Re=i("5996"),ze=i("9096"),Le=i("3349"),He=i("6706"),Ue=i("0b2d"),Fe=i("28eb"),qe=i("92af");let Ne=class extends ze["a"]{constructor(e){super(e),this.sourceModules={featureService:{module:null,loader:null},featureCollection:{module:null,loader:null},graphics:{module:null,loader:null}}}get updating(){return Object(Fe["b"])(this.snappingSources,({snappingSource:e})=>e.updating)||this.updatingHandles.updating}get snappingSources(){var e;const t=this._get("snappingSources")||new Map,i=new Map;if(null!=(e=this.options)&&e.featureSources)for(const n of this.options.featureSources.items){const e=n.layer.uid,r=t.get(e);if(r){t.delete(e),i.set(e,r);continue}if(!n.layer.loaded){this.updatingHandles.addPromise(n.layer.load());continue}const s=this.createSourceInfo(n);Object(S["k"])(s)&&i.set(e,s)}for(const[,n]of t)n.destroy();return i}initialize(){var e;this.updatingHandles.add(this,"snappingSources",()=>{this.notifyChange("updating")},1),Object(S["k"])(this.view)&&this.handles.add([null==(e=this.view.refreshManager)?void 0:e.on("refresh",e=>{"interval"===e.trigger&&this.refreshSourceOfLayer(e.layerView.layer)}),this.view.on("layerview-create",e=>this.updateLayerView(e.layer,e.layerView)),this.view.on("layerview-destroy",e=>this.updateLayerView(e.layer,null))])}refreshSourceOfLayer(e){for(const[,{snappingSource:t}]of this.snappingSources)t.layerSource.layer===e&&t.refresh()}updateLayerView(e,t){for(const[,i]of this.snappingSources)i.snappingSource.layerSource.layer===e&&(i.layerView=t)}destroy(){this._set("options",null);for(const[,e]of this.snappingSources)e.destroy()}async fetchCandidates(e,t,i){if(!this.options.effectiveFeatureEnabled)return[];const n=[],r={distance:this.computeScreeenSizeDistanceParameters(e,t),point:e,coordinateHelper:t.coordinateHelper,types:this.types,filter:null};for(const[,{snappingSource:o,layerView:a}]of this.snappingSources)!o.layerSource.enabled||Object(S["k"])(a)&&a.suspended||n.push(o.fetchCandidates(r,i).then(({candidates:e})=>e.filter(e=>!this.candidateIsExcluded(o,e,t.excludeFeature))));const s=(await Object(C["l"])(n)).flat();return Object(C["w"])(i),Object(He["e"])(e,s),s}computeScreeenSizeDistanceParameters(e,t){const i=this.options.distance*("touch"===t.pointer?this.options.touchSensitivityMultiplier:1);return Object(S["j"])(this.view)?i:"2d"===this.view.type?i*this.view.resolution:this.computeScreeenSizeDistanceParameters3D(e,i,this.view,t)}computeScreeenSizeDistanceParameters3D(e,t,i,n){const{coordinateHelper:r,elevationInfo:s}=n,o=i.state.camera.computeScreenPixelSizeAt(Object(He["a"])(e,r,s,i,We))*i.renderCoordsHelper.unitInMeters/i.mapCoordsHelper.unitInMeters,a=t*o;return{x:a/this.computeScreenMagnitudeOfMapOffset(e,o,0,i,n),y:a/this.computeScreenMagnitudeOfMapOffset(e,0,o,i,n)}}computeScreenMagnitudeOfMapOffset(e,t,i,n,{coordinateHelper:r,elevationInfo:s}){const o=r.clone(e);o[0]+=t,o[1]+=i;const a=Object(He["b"])(e,r,s,n),c=Object(He["b"])(o,r,s,n),l=c.x-a.x,h=c.y-a.y;return Math.sqrt(l*l+h*h)}get types(){return 3}candidateIsExcluded(e,t,i){if(Object(S["j"])(i))return!1;const n=this.getCandidateObjectId(t);if(Object(S["j"])(n))return!1;const r=e.layerSource.layer;return"graphics"===r.type?i.uid===n:i.sourceLayer===r&&!(!i.attributes||!("objectIdField"in r))&&i.attributes[r.objectIdField]===n}getCandidateObjectId(e){return e instanceof qe["a"]?e.objectId:null}createSourceInfo(e){const t=this.createFeatureSnappingSourceType(e);if(Object(S["j"])(t))return null;if("loading"in t)return this.updatingHandles.addPromise(t.loading.then(()=>{this.destroyed||this.notifyChange("snappingSources")})),null;const i=Object(S["k"])(this.view)?this.view.allLayerViews.find(t=>t.layer===e.layer):null;return new Be(t.source,i)}createFeatureSnappingSourceType(e){switch(e.layer.type){case"feature":case"geojson":case"csv":return this.createFeatureSnappingSourceFeatureLayer(e);case"graphics":return this.createFeatureSnappingSourceGraphicsLayer(e)}return null}createFeatureSnappingSourceFeatureLayer(e){switch(e.layer.source.type){case"feature-layer":{const t=this.getSourceModule("featureService");return Object(S["k"])(t.module)?{source:new t.module.FeatureServiceSnappingSource({spatialReference:this.spatialReference,view:this.view,layerSource:e})}:{loading:t.loader}}case"memory":case"csv":case"geojson":{if("mesh"===e.layer.geometryType)return null;const t=this.getSourceModule("featureCollection");return Object(S["k"])(t.module)?{source:new t.module.FeatureCollectionSnappingSource({layerSource:e})}:{loading:t.loader}}}return null}createFeatureSnappingSourceGraphicsLayer(e){const t=this.getSourceModule("graphics");return Object(S["k"])(t.module)?{source:new t.module.GraphicsSnappingSource({spatialReference:this.spatialReference,view:this.view,layerSource:e})}:{loading:t.loader}}getSourceModule(e){const t=this.sourceModules[e];if(Object(S["j"])(t.loader)){const i=this.loadSourceModule(e).then(e=>{t.module=e});return t.loader=i,{module:t.module,loader:i}}return{module:t.module,loader:t.loader}}loadSourceModule(e){switch(e){case"featureService":return this.updatingHandles.addPromise(i.e("chunk-6b4e548a").then(i.bind(null,"ba80")));case"featureCollection":return this.updatingHandles.addPromise(i.e("chunk-474e6fbb").then(i.bind(null,"2dca")));case"graphics":return this.updatingHandles.addPromise(Promise.all([i.e("chunk-2d0d03a7"),i.e("chunk-31ca1d6f"),i.e("chunk-59bef320")]).then(i.bind(null,"b234")))}return null}};Object(n["a"])([Object(s["b"])({constructOnly:!0})],Ne.prototype,"spatialReference",void 0),Object(n["a"])([Object(s["b"])({constructOnly:!0})],Ne.prototype,"view",void 0),Object(n["a"])([Object(s["b"])()],Ne.prototype,"options",void 0),Object(n["a"])([Object(s["b"])({readOnly:!0})],Ne.prototype,"updating",null),Object(n["a"])([Object(s["b"])({readOnly:!0})],Ne.prototype,"snappingSources",null),Ne=Object(n["a"])([Object(c["a"])("esri.views.interactive.snapping.FeatureSnappingEngine")],Ne);class Be{constructor(e,t){this.snappingSource=e,this.layerView=t,this.handles=new z["a"];const i=this.snappingSource.layerSource.layer;if("refresh"in i){const t=i;this.handles.add(t.on("refresh",()=>e.refresh()))}this.handles.add([Object(L["a"])(e,"updating",t=>e.layerSource.updating=t,!0),Object(L["a"])(e,"availability",t=>e.layerSource.availability=t,!0)])}destroy(){this.snappingSource.destroy(),this.handles.destroy()}}const We=Object(Ue["e"])();var Ze=i("02f1");class Ke{constructor(e,t){this.view=e,this.options=t,this.squaredShortLineThreshold=v["a"].shortLineThreshold*v["a"].shortLineThreshold}snap(e,t){return Object(S["k"])(t.vertexHandle)?"vertex"!==t.vertexHandle.type?[]:this.snapExistingVertex(e,t):this.snapNewVertex(e,t)}edgeExceedsShortLineThreshold(e,t){return this.exceedsShortLineThreshold(e.left.pos,e.right.pos,t)}exceedsShortLineThreshold(e,t,{elevationInfo:i,geometry:n}){const r=n.editGeometry.coordinateHelper;return 0===this.squaredShortLineThreshold||Object(He["f"])(Object(He["b"])(t,r,i,this.view),Object(He["b"])(e,r,i,this.view))>this.squaredShortLineThreshold}squaredProximityTreshold(e){return"touch"===e?this.squaredTouchProximityThreshold:this.squaredMouseProximityTreshold}get squaredMouseProximityTreshold(){return this.options.distance*this.options.distance}get squaredTouchProximityThreshold(){const{distance:e,touchSensitivityMultiplier:t}=this.options,i=e*t;return i*i}}var $e=i("0f94"),Xe=i("38a4"),Ye=i("e6b5"),Je=i("df3b"),Qe=i("43e0");class et extends Je["a"]{constructor({coordinateHelper:e,lineStart:t,lineEnd:i,targetPoint:n}){super(e,n,new Qe["b"](e,t,i)),this.referenceLineHint=new Ye["a"](2,t,i)}get hints(){return[this.referenceLineHint,new Ye["a"](0,this.lineEndClosestToTarget(),this.targetPoint)]}lineEndClosestToTarget(){const e=this.constraint.start,t=this.constraint.end;return Object(Xe["s"])(Object(Le["g"])(Object(Le["d"])(it,t,e),Object(Le["d"])(tt,this.targetPoint,e)))>0?t:e}}const tt=Object(Ze["b"])(),it=Object(Ze["b"])();class nt extends Ke{snapNewVertex(e,t){const i=t.geometry.editGeometry.components[0],n=i.edges.length,r=[];if(n<1)return r;const s=t.coordinateHelper,o=Object(He["b"])(e,s,t.elevationInfo,this.view),a=i.edges[n-1];let c=a;do{this.edgeExceedsShortLineThreshold(c,t)&&this._processCandidateProposal(c.left.pos,c.right.pos,e,o,t,r),c=c.left.left}while(c&&c!==a);return r}snapExistingVertex(e,t){const i=[],n=Object(S["t"])(t.vertexHandle),r=n.component;if(r.edges.length<2)return i;const s=t.coordinateHelper,o=Object(He["b"])(e,s,t.elevationInfo,this.view),a=n.left,c=n.right;a&&c&&this.edgeExceedsShortLineThreshold(a,t)&&this.edgeExceedsShortLineThreshold(c,t)&&this._processCandidateProposal(a.left.pos,c.right.pos,e,o,t,i);const l=r.edges[0];let h=l;do{h!==n.left&&h!==n.right&&this.edgeExceedsShortLineThreshold(h,t)&&this._processCandidateProposal(h.left.pos,h.right.pos,e,o,t,i),h=h.right.right}while(h&&h!==l);return i}_processCandidateProposal(e,t,i,n,r,s){const o=Object($e["g"])(Object(Ze["b"])(),i,e,t),a=r.coordinateHelper,c=a.fromXYZ(o,a.getZ(i,0));Object(He["f"])(n,Object(He["b"])(c,a,r.elevationInfo,this.view))<this.squaredProximityTreshold(r.pointer)&&s.push(new et({coordinateHelper:r.coordinateHelper,lineStart:e,lineEnd:t,targetPoint:c}))}}var rt=i("d232");class st extends Je["a"]{constructor({coordinateHelper:e,referenceLine:t,lineStart:i,targetPoint:n}){const r=e.clone(i);Object(Le["d"])(r,Object(Le["h"])(r,r,t.right.pos),t.left.pos),super(e,n,new Qe["b"](e,i,r)),this._referenceLines=[{edge:t,fadeLeft:!0,fadeRight:!0}]}get hints(){return[new Ye["a"](0,this.constraint.start,this.targetPoint),new rt["a"](this.constraint.start,this.targetPoint),...this._referenceLines.map(e=>new Ye["a"](1,e.edge.left.pos,e.edge.right.pos,e.fadeLeft,e.fadeRight))]}addReferenceLine(e){const t={edge:e,fadeLeft:!0,fadeRight:!0};this._referenceLines.forEach(i=>{e.right.right===i.edge&&(i.fadeLeft=!1,t.fadeRight=!1),e.left.left===i.edge&&(i.fadeRight=!1,t.fadeLeft=!1)}),this._referenceLines.push(t)}}class ot extends Ke{constructor(){super(...arguments),this._tmpProjection=Object(Ze["b"])()}snapNewVertex(e,t){const i=t.geometry.editGeometry.components[0],n=i.edges.length,r=i.vertices.length,s=[];if(n<2)return s;const o=Object(He["b"])(e,t.coordinateHelper,t.elevationInfo,this.view),a=i.vertices[r-1],c=i.vertices[0],l=i.edges[n-1];let h=l;do{this.edgeExceedsShortLineThreshold(h,t)&&(this._checkEdgeForParalleLines(h,a.pos,e,o,t,s),this._checkEdgeForParalleLines(h,c.pos,e,o,t,s)),h=h.left.left}while(h&&h!==l);return s}snapExistingVertex(e,t){const i=[],n=Object(S["t"])(t.vertexHandle),r=n.component;if(r.edges.length<3)return i;const s=Object(He["b"])(e,t.coordinateHelper,t.elevationInfo,this.view),o=n.left,a=n.right,c=r.vertices[0],l=r.vertices.length,h=r.vertices[l-1],d=r.edges[0];let p=d;do{p!==o&&p!==a&&this.edgeExceedsShortLineThreshold(p,t)&&(o&&this._checkEdgeForParalleLines(p,o.left.pos,e,s,t,i),a&&this._checkEdgeForParalleLines(p,a.right.pos,e,s,t,i),n===c?this._checkEdgeForParalleLines(p,h.pos,e,s,t,i):n===h&&this._checkEdgeForParalleLines(p,c.pos,e,s,t,i)),p=p.right.right}while(p&&p!==d);return i}_checkEdgeForParalleLines(e,t,i,n,r,s){const o=e.left.pos,a=e.right.pos;if(Object($e["g"])(this._tmpProjection,t,o,a),Object(Le["j"])(this._tmpProjection,t)<v["a"].parallelLineThreshold)return;Object($e["g"])(this._tmpProjection,i,o,a,t);const c=r.coordinateHelper,l=c.fromXYZ(this._tmpProjection,c.getZ(i,0));if(Object(He["f"])(n,Object(He["b"])(l,c,r.elevationInfo,this.view))<this.squaredProximityTreshold(r.pointer)){if(this.parallelToPreviousCandidate(e,s))return;s.push(new st({coordinateHelper:c,referenceLine:e,lineStart:t,targetPoint:l}))}}parallelToPreviousCandidate(e,t){const i=e.left.pos,n=e.right.pos;for(const r of t)if(Object($e["g"])(this._tmpProjection,n,r.constraint.start,r.constraint.end,i),Object(Le["j"])(this._tmpProjection,n)<v["a"].parallelLineThreshold)return r.addReferenceLine(e),!0;return!1}}var at=i("5715");class ct extends Je["a"]{constructor({coordinateHelper:e,targetPoint:t,constraint:i,previousVertex:n,centerVertex:r}){super(e,t,i),this.previousVertex=n,this.centerVertex=r,this.referenceLine=new Ye["a"](1,n,i.start)}get hints(){return[new Ye["a"](0,this.constraint.start,this.targetPoint),this.referenceLine,new at["a"](this.previousVertex,this.centerVertex,this.targetPoint)]}}class lt extends Ke{constructor(){super(...arguments),this._tmp=Object(Ze["b"])()}snapNewVertex(e,t){const i=t.geometry.editGeometry.components[0],n=i.vertices.length,r=[];if(n<2)return r;const s=Object(He["b"])(e,t.coordinateHelper,t.elevationInfo,this.view),o=i.vertices[n-1];this._checkForSnappingCandidate(r,o.left,o.pos,e,o.left.left.pos,o.pos,t,e,s);const a=i.vertices[0];return this._checkForSnappingCandidate(r,a.right,a.pos,e,a.right.right.pos,a.pos,t,e,s),r}snapExistingVertex(e,t){const i=[],n=Object(S["t"])(t.vertexHandle),r=n.component,s=r.vertices.length;if(s<3)return i;const o=Object(He["b"])(e,t.coordinateHelper,t.elevationInfo,this.view),a=n.left,c=n.right,l=r.vertices[0],h=r.vertices[s-1];if(!a)return this._checkForSnappingCandidate(i,l.right.right.right,l.right.right.pos,e,l.right.right.right.right.pos,l.right.right.pos,t,e,o),i;if(!c)return this._checkForSnappingCandidate(i,h.left.left.left,h.left.left.pos,e,h.left.left.left.left.pos,h.left.left.pos,t,e,o),i;if(a&&a.left.left){const n=a.left.left;this._checkForSnappingCandidate(i,n,a.left.pos,e,n.left.pos,a.left.pos,t,e,o)}if(c&&c.right.right){const n=c.right.right;this._checkForSnappingCandidate(i,n,c.right.pos,e,n.right.pos,c.right.pos,t,e,o)}return i}_checkForSnappingCandidate(e,t,i,n,r,s,o,a,c){if(!this.edgeExceedsShortLineThreshold(t,o))return;Object(Le["d"])(this._tmp,t.right.pos,t.left.pos);const l=Object(Ze["f"])(this._tmp[1],-this._tmp[0]),h=Object(Le["g"])(l,Object(Le["d"])(this._tmp,n,i))/Object(Le["q"])(l),d=o.coordinateHelper,p=d.fromXYZ(Object(Le["p"])(Object(Ze["b"])(),s,l,h),d.getZ(a,0));Object(He["f"])(c,Object(He["b"])(p,d,o.elevationInfo,this.view))<this.squaredProximityTreshold(o.pointer)&&e.push(new ct({coordinateHelper:d,targetPoint:p,constraint:new Qe["e"](d,s,Object(Le["p"])(d.createNew(),s,l,Object(Xe["s"])(h))),previousVertex:r,centerVertex:s}))}}class ht extends Je["a"]{constructor({coordinateHelper:e,targetPoint:t,point1:i,point2:n}){super(e,t,new Qe["c"](e,Object(Le["m"])(dt,i,n,.5),.5*Object(Le["i"])(i,n))),this.p1=i,this.p2=n}get hints(){return[new Ye["a"](1,this.targetPoint,this.p1),new Ye["a"](1,this.targetPoint,this.p2),new at["a"](this.p1,this.targetPoint,this.p2)]}}const dt=Object(Ze["b"])();class pt extends Ke{snapNewVertex(e,t){const i=t.geometry.editGeometry.components[0],n=[],r=i.vertices.length;if("polygon"!==t.geometry.type||r<2)return n;const s=i.vertices[0],o=i.vertices[r-1];return this._processCandidateProposal(s.pos,o.pos,e,t,n),n}snapExistingVertex(e,t){const i=[],n=Object(S["t"])(t.vertexHandle),r=n.component;return r.edges.length<2?i:"polyline"!==t.geometry.type||0!==n.index&&n.index!==r.vertices.length-1?(this._processCandidateProposal(n.left.left.pos,n.right.right.pos,e,t,i),i):i}_processCandidateProposal(e,t,i,n,r){if(!this.exceedsShortLineThreshold(e,t,n))return;const s=Object(Le["m"])(Object(Ze["b"])(),e,t,.5),o=.5*Object(Le["i"])(e,t),a=Object($e["f"])(Object(Ze["b"])(),i,s,o),c=n.coordinateHelper,l=c.fromXYZ(a,c.getZ(i,0)),h=Object(He["b"])(i,c,n.elevationInfo,this.view);Object(He["f"])(h,Object(He["b"])(l,c,n.elevationInfo,this.view))<this.squaredProximityTreshold(n.pointer)&&r.push(new ht({coordinateHelper:c,targetPoint:l,point1:e,point2:t}))}}let ut=class extends m["a"]{constructor(e){super(e),this.updating=!1,this._snappers=new h["a"]}initialize(){this._snappers.push(new ot(this.view,this.options),new nt(this.view,this.options),new lt(this.view,this.options),new pt(this.view,this.options))}set options(e){this._set("options",e);for(const t of this._snappers)t.options=e}async fetchCandidates(e,t){if(!this.options.effectiveSelfEnabled)return[];const i=[];for(const n of this._snappers.items)i.push(...n.snap(e,t));return Object(He["e"])(e,i),i}};Object(n["a"])([Object(s["b"])({readOnly:!0})],ut.prototype,"updating",void 0),Object(n["a"])([Object(s["b"])({constructOnly:!0})],ut.prototype,"view",void 0),Object(n["a"])([Object(s["b"])()],ut.prototype,"options",null),ut=Object(n["a"])([Object(c["a"])("esri.views.interactive.snapping.SelfSnappingEngine")],ut);var ft=i("e753");class bt extends Je["a"]{constructor(e,t,i,n){super(e,t,new Qe["a"](e,t,i.constraint,n.constraint)),this.first=i,this.second=n}get hints(){return this.first.targetPoint=this.targetPoint,this.second.targetPoint=this.targetPoint,[...this.first.hints,...this.second.hints,new ft["a"](this.targetPoint)]}}let gt=class extends(A["a"].EventedMixin(ze["a"])){constructor(e){super(e),this.options=new w,this.engines=[],this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this.options=new w}initialize(){this.handles.add([Object(Ie["a"])(()=>{const{effectiveFeatureEnabled:e,effectiveSelfEnabled:t,touchSensitivityMultiplier:i,distance:n}=this.options;return{effectiveFeatureEnabled:e,effectiveSelfEnabled:t,touchSensitivityMultiplier:i,distance:n}},()=>{this.doneSnapping(),this.emit("changed")}),this.watch("options",e=>{for(const t of this.engines)t.options=e},!0),Object(L["a"])(this.view,"ready",e=>this.onViewReady(e),!0)])}destroy(){this.destroyEngines()}get updating(){return this.engines.some(e=>e.updating)}onViewReady(e){var t,i;this.destroyEngines(),e&&(this.engines=[new ut({view:this.view,options:this.options}),new Ne({view:this.view,spatialReference:null!=(t=null==(i=this.view)?void 0:i.spatialReference)?t:Re["a"].WGS84,options:this.options})])}destroyEngines(){for(const e of this.engines)e.destroy();this.engines.length=0}get squaredMouseProximityTreshold(){return this.options.distance*this.options.distance}get squaredTouchProximityThreshold(){const{distance:e,touchSensitivityMultiplier:t}=this.options,i=e*t;return i*i}async snap(e,t,i){const n=t.coordinateHelper.fromPoint(e),r=await this.fetchCandidates(n,t,i);return{get valid(){return!Object(C["o"])(i)},apply:()=>{const{snappedPoint:e,hints:i}=this.processCandidates(n,r,t);return this.removeVisualization(),Object(S["k"])(t.visualizer)&&this.handles.add(t.visualizer.draw(i,{coordinateHelper:t.coordinateHelper,elevationInfo:t.elevationInfo,view:this.view}),mt),e}}}update(e,t){this.removeVisualization();let i=e;const n=[];if(Object(S["k"])(this._currentMainCandidate)){const r=t.coordinateHelper,s=r.fromPoint(e),o=this._currentMainCandidate.constraint.closestTo(s);if(Object(He["f"])(Object(He["b"])(s,r,t.elevationInfo,this.view),Object(He["b"])(o,r,t.elevationInfo,this.view))<this.squaredPointProximityThreshold(t.pointer)){i=r.createDehydratedPoint(o),this._currentMainCandidate.targetPoint=o,n.push(...this._currentMainCandidate.hints);for(const e of this._currentOtherActiveCandidates)e.targetPoint=o,n.push(...e.hints)}else this._currentMainCandidate=null,this._currentOtherActiveCandidates=[]}return Object(S["k"])(t.visualizer)&&this.handles.add(t.visualizer.draw(n,{coordinateHelper:t.coordinateHelper,elevationInfo:t.elevationInfo,view:this.view}),mt),i}doneSnapping(){this.removeVisualization(),this._currentMainCandidate=null,this._currentOtherActiveCandidates=[]}removeVisualization(){this.handles.remove(mt)}async fetchCandidates(e,t,i){return(await Promise.all(this.engines.map(n=>n.fetchCandidates(e,t,i)))).flat()}processCandidates(e,t,i){if(t.length<1)return this.doneSnapping(),{snappedPoint:i.coordinateHelper.toPoint(e,new T["a"]),hints:[]};Object(He["e"])(e,t);const n=this._currentMainCandidate;if(Object(S["k"])(n)){const r=this.findOldConstraintInNewCandidates(n,t);if(r>=0){if(!(t[r]instanceof bt))return this.intersectWithOtherCandidates(r,t,e,i);if(Object(Le["j"])(e,n.targetPoint)<this.squaredPointProximityThreshold(i.pointer))return this.updateSnappingCandidate(n,t,i)}}return this.intersectWithOtherCandidates(0,t,e,i)}findOldConstraintInNewCandidates(e,t){return e instanceof bt?this.findOldCandidateIndex(t,e.first)>=0&&this.findOldCandidateIndex(t,e.second)>=0?0:-1:this.findOldCandidateIndex(t,e)}intersectWithOtherCandidates(e,t,i,n){const r=t[e],s=[],o=n.coordinateHelper;for(let a=0;a<t.length;++a){if(a===e)continue;const c=t[a];for(const e of r.constraint.intersect(c.constraint)){const t=o.fromXYZ(e.intersection,r.targetPoint[2]);s.push([new bt(o,t,r,c),Object(He["f"])(Object(He["b"])(i,n.coordinateHelper,n.elevationInfo,this.view),Object(He["b"])(t,n.coordinateHelper,n.elevationInfo,this.view))])}}return s.length>0&&(s.sort((e,t)=>e[1]-t[1]),s[0][1]<this.squaredPointProximityThreshold(n.pointer))?this.updateSnappingCandidate(s[0][0],t,n):this.updateSnappingCandidate(r,t,n)}updateSnappingCandidate(e,t,i){this.doneSnapping(),this._currentMainCandidate=e;const n=this._currentMainCandidate.targetPoint,r=[];r.push(...e.hints);for(const s of t){if(e instanceof bt){if(s.constraint.objectEqual(e.first.constraint)||s.constraint.objectEqual(e.second.constraint))continue}else if(s.constraint.objectEqual(e.constraint))continue;s.constraint.check(n)&&(s.targetPoint=n,this._currentOtherActiveCandidates.push(s),r.push(...s.hints))}return{snappedPoint:i.coordinateHelper.createDehydratedPoint(n),hints:r}}squaredPointProximityThreshold(e){return"touch"===e?this.squaredTouchProximityThreshold:this.squaredMouseProximityTreshold}findOldCandidateIndex(e,t){let i=-1;for(let n=0;n<e.length;++n)if(t.constraint.objectEqual(e[n].constraint)){i=n;break}return i}get test(){return{visualizationsActive:this.handles.has(mt)}}};Object(n["a"])([Object(s["b"])({constructOnly:!0})],gt.prototype,"view",void 0),Object(n["a"])([Object(s["b"])()],gt.prototype,"options",void 0),Object(n["a"])([Object(s["b"])({readOnly:!0})],gt.prototype,"updating",null),Object(n["a"])([Object(s["b"])()],gt.prototype,"engines",void 0),Object(n["a"])([Object(s["b"])()],gt.prototype,"squaredMouseProximityTreshold",null),Object(n["a"])([Object(s["b"])()],gt.prototype,"squaredTouchProximityThreshold",null),gt=Object(n["a"])([Object(c["a"])("esri.views.interactive.snapping.SnappingManager")],gt);const mt="visualization-handle";var vt=i("6c97");let yt=class extends A["a"].EventedAccessor{constructor(e){super(e),this.cancelled=!1,this.history={undo:[],redo:[]},this.type=null}get tool(){if(!this.activeComponent)return null;switch(this.activeComponent.type){case"graphic-mover":case"move-3d":return"move";case"box":case"transform-3d":return"transform";case"reshape":case"reshape-3d":return"reshape";case"draw":case"draw-3d":return null;default:Object(vt["a"])(this.activeComponent)}return null}addToHistory(e){this.history.redo=[],this.history.undo.push(e)}resetHistory(){this.history.redo=[],this.history.undo=[]}canUndo(){return this.history.undo.length>0}canRedo(){return this.history.redo.length>0}complete(){this.reset(),this.onEnd(),this.emit("complete")}cancel(){this.cancelled=!0,this.complete()}reset(){this.activeComponent.reset()}refreshComponent(){const e=this.activeComponent;e&&("box"!==e.type&&"reshape"!==e.type||e.refresh())}set undo(e){this._set("undo",()=>{this.canUndo()&&e()})}set redo(e){this._set("redo",()=>{this.canRedo()&&e()})}};Object(n["a"])([Object(s["b"])()],yt.prototype,"activeComponent",void 0),Object(n["a"])([Object(s["b"])()],yt.prototype,"cancelled",void 0),Object(n["a"])([Object(s["b"])()],yt.prototype,"history",void 0),Object(n["a"])([Object(s["b"])()],yt.prototype,"tool",null),Object(n["a"])([Object(s["b"])()],yt.prototype,"type",void 0),Object(n["a"])([Object(s["b"])()],yt.prototype,"canUndo",null),Object(n["a"])([Object(s["b"])()],yt.prototype,"canRedo",null),Object(n["a"])([Object(s["b"])()],yt.prototype,"onEnd",void 0),Object(n["a"])([Object(s["b"])()],yt.prototype,"undo",null),Object(n["a"])([Object(s["b"])()],yt.prototype,"redo",null),Object(n["a"])([Object(s["b"])()],yt.prototype,"toggleTool",void 0),Object(n["a"])([Object(s["b"])()],yt.prototype,"addToSelection",void 0),Object(n["a"])([Object(s["b"])()],yt.prototype,"removeFromSelection",void 0),yt=Object(n["a"])([Object(c["a"])("esri.widgets.Sketch.support.OperationHandle")],yt);const _t="esri.widgets.Sketch.SketchViewModel",Ot=r["a"].getLogger(_t),jt={redoKey:"r",undoKey:"z",centerKey:"Alt",constraintKey:"Control",snappingKey:"Control",cancelKey:"Escape",deleteKeys:["Backspace","Delete"],complete:"c",pan:" "},xt={defaultZ:0},wt={enableMidpoints:!0,enableMoveAllGraphics:!0,enableRotation:!0,enableScaling:!0,multipleSelectionEnabled:!0,preserveAspectRatio:!1,toggleToolOnClick:!0,tool:"transform",enableZ:!0,enableMoveGraphic:!0};let St=class extends A["a"].EventedAccessor{constructor(e){super(e),this._activeFillGraphic=null,this._activeLineGraphic=null,this._centerIndicatorGraphic=null,this._centerSymbol=new G["a"]({style:"cross",size:6,color:[255,255,255]}),this._defaultSegmentOffset=48,this._numUpdating=0,this._handles=new z["a"],this._internalGraphicsLayer=new U["a"]({listMode:"hide",internal:!0}),this._lineGraphic=null,this._operationHandle=null,this._vertexGraphics=[],this._viewHandles=new z["a"],this._doUnnormalization=!1,this._moveOperationCloneInfos=[],this.activeFillSymbol=new D["a"]({style:"solid",color:[150,150,150,.2],outline:{color:[50,50,50],width:0}}),this.activeLineSymbol=new M["a"]({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",effects:[{type:"CIMGeometricEffectDashes",dashTemplate:[3.75,3.75],lineDashEnding:"HalfPattern",controlPointEnding:"NoConstraint"}],enable:!0,capStyle:"Butt",joinStyle:"Round",miterLimit:10,width:1.6,color:[255,255,255,255]},{type:"CIMSolidStroke",enable:!0,capStyle:"Butt",joinStyle:"Round",miterLimit:10,width:2,color:[0,0,0,255]}]}}}),this.activeVertexSymbol=new G["a"]({style:"circle",size:6,color:[255,127,0,1],outline:{color:[50,50,50],width:1}}),this.layer=null,this.pointSymbol=new G["a"]({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.polygonSymbol=new D["a"]({color:[150,150,150,.2],outline:{color:[50,50,50],width:2}}),this.polylineSymbol=new V["a"]({color:[130,130,130,1],width:2}),this._snappingManager=null,this.updateGraphics=new h["a"],this.updateOnGraphicClick=!0,this.updatePointSymbol=new G["a"]({size:10,color:[0,200,255,.5],outline:{color:"black",width:1}}),this.updatePolygonSymbol=new D["a"]({color:[12,207,255,.2],outline:{join:"round",color:[12,207,255],width:2}}),this.updatePolylineSymbol=new V["a"]({color:[12,207,255],width:2}),this.vertexSymbol=new G["a"]({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this._moduleLoaderAbortController=null,this._viewReadyAbortController=null,this._originalAutoOpenEnabled=null,this.defaultCreateOptions=xt,this.defaultUpdateOptions=wt,this.snappingOptions=new w}initialize(){this._handles.add([Object(L["e"])(this,"layer",()=>{this.cancel(),this._internalGraphicsLayer.elevationInfo=Object(S["k"])(this.layer)?this.layer.elevationInfo:null}),Object(L["b"])(this,"view.map.layers","change",e=>{e.removed.indexOf(this.layer)>=0&&this.cancel()}),Object(L["b"])(this,"layer.graphics","change",e=>{if(Object(S["k"])(this._operationHandle))for(const t of e.removed)this.updateGraphics.includes(t)&&(this.updateGraphics.length>1?this._operationHandle.removeFromSelection(t):this._operationHandle.cancel())}),Object(L["a"])(this,"layer.elevationInfo",()=>{this.cancel(),this._internalGraphicsLayer.elevationInfo=Object(S["k"])(this.layer)?this.layer.elevationInfo:null},!0),Object(L["a"])(this,"view",e=>{Object(S["e"])(this._snappingManager),e&&(this._snappingManager=new gt({view:e,options:this.snappingOptions}))},!0)])}destroy(){this.cancel(),this._handles=Object(S["e"])(this._handles),this._viewHandles=Object(S["e"])(this._viewHandles),this._removeDefaultLayer(),Object(S["e"])(this._draw),Object(S["e"])(this._snappingManager),this._set("view",null),this.emit("destroy")}get _defaultUpdateTool(){return"3d"===this.view.type?"move":"transform"}get _draw(){return"ready"===this.state||"active"===this.state?new Ce({view:this.view}):null}get updating(){return this._numUpdating>0}get activeTool(){return this._operationHandle&&this._operationHandle.tool?this._operationHandle.tool:null}get activeComponent(){return this._operationHandle?this._operationHandle.activeComponent:null}get createGraphic(){return this.view&&"3d"===this.view.type&&Object(S["k"])(this.activeComponent)&&"draw-3d"===this.activeComponent.type?Object(S["t"])(this.activeComponent.createGraphic):this._get("createGraphic")}set defaultCreateOptions(e){this._set("defaultCreateOptions",{...xt,...e})}set defaultUpdateOptions(e){this._set("defaultUpdateOptions",{...wt,...e})}set snappingOptions(e){Object(S["k"])(this._snappingManager)&&(this._snappingManager.options=e),this._set("snappingOptions",e)}get state(){var e;const t=!(null==(e=this.view)||!e.ready||!this.layer),i=this._operationHandle;return t&&i?"active":t?"ready":"disabled"}get view(){return this._get("view")}set view(e){const t=this._get("view");if(t){const{container:e,map:i}=t;e&&(t.cursor=null),i&&i.remove(this._internalGraphicsLayer),this._viewHandles.removeAll(),this.cancel()}this._doUnnormalization=null!=e&&"3d"===e.type&&"global"===e.viewingMode;const i="view-ready";this._handles.remove(i),e&&this._handles.add(Object(L["f"])(e,"ready",t=>{this._viewHandles.removeAll(),t&&this._viewHandles.add(this._generateViewHandles(e))},!0),i),this._set("view",e)}cancel(){this._moduleLoaderAbortController=Object(S["a"])(this._moduleLoaderAbortController),this._viewReadyAbortController=Object(S["a"])(this._viewReadyAbortController),this._operationHandle&&this._operationHandle.cancel()}complete(){this._operationHandle&&this._operationHandle.complete()}delete(){const{state:e,updateGraphics:t}=this;if("active"===e&&t.length){const{activeTool:e,layer:i}=this,n=t.toArray();i.removeMany(n),this.cancel(),this._emitDeleteEvent({graphics:n,tool:e})}}async create(e,t){if(await this._waitViewReady(),"disabled"===this.state)throw this.layer||this._logError("sketch:missing-property","Property 'layer' is missing on SketchViewModel."),this.view||this._logError("sketch:missing-property","Property 'view' is missing on SketchViewModel."),Object(C["f"])();if(this.cancel(),!e)return void this._logError("sketch:missing-parameter","Missing parameter 'tool'.");const i=await this._setupCreateOperation(e,t);if(Object(S["j"])(i)||this.destroyed)return;Object(Ge["a"])(this.view,this._internalGraphicsLayer);const n=()=>{if(i===this._operationHandle){const t=this.createGraphic,n=this._operationHandle.cancelled;this._operationHandle.destroy(),this._operationHandle=null,this._set("createGraphic",null),this.view&&this.view.map&&this.view.map.remove(this._internalGraphicsLayer),i.cancelled||null==t||this.layer.add(t),this.emit("create",{graphic:t,state:n?"cancel":"complete",tool:e,toolEventInfo:null,type:"create"})}};i.on("complete",n),this._operationHandle=i,this.view.ready&&Object(q["b"])(this.view)&&this.view.focus()}async update(e,t){await this._waitViewReady();const{layer:i,view:n,state:r}=this;if("disabled"===r)throw n||this._logError("sketch:missing-property","Property 'view' is missing on SketchViewModel."),i||this._logError("sketch:missing-property","Property 'layer' is missing on SketchViewModel."),Object(C["f"])();this.cancel();const s=Array.isArray(e)?e:[e];if(null==e||!s||!s.length)return void this._logError("sketch:missing-parameter","Missing parameter 'graphics'.");if(s.some(e=>e.layer!==i?(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics missing from the supplied GraphicsLayer."),!0):Object(S["j"])(e.geometry)?(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics with an unsupported geometry."),!0):"2d"===n.type&&!n.spatialReference.equals(e.geometry.spatialReference)&&(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics with a spatial reference different from the supplied MapView."),!0)))return;const o=await this._setupUpdateOperation(s,t);this.destroyed||Object(S["j"])(o)||At(o)||(Object(Ge["a"])(this.view,this._internalGraphicsLayer),this._setUpdateOperationHandle(o,t),this.emit("update",{graphics:s,state:"start",aborted:!1,tool:o.tool,toolEventInfo:null,type:"update"}))}undo(){this.canUndo()&&this._operationHandle.undo()}redo(){this.canRedo()&&this._operationHandle.redo()}canUndo(){return!(!this._operationHandle||!this._operationHandle.canUndo())}canRedo(){return!(!this._operationHandle||!this._operationHandle.canRedo())}toggleUpdateTool(){this._operationHandle&&this._operationHandle.toggleTool&&this._operationHandle.toggleTool()}async _getFirstHit(e){const t=[];switch(this.view.type){case"2d":{const r=await this.view.hitTest(e);if(r.results.length>0){const e=r.results[0];if(e.graphic){var i,n;const r=e.graphic;"vector-tile"!==(null==(i=r.layer)?void 0:i.type)&&"imagery"!==(null==(n=r.layer)?void 0:n.type)&&t.push(e)}}}break;case"3d":{const i=[this.view.map.ground];this.view.map.allLayers.forEach(e=>{"integrated-mesh"===e.type&&i.push(e)});const n=await this.view.hitTest(e,{exclude:i});if(n.results.length>0){const e=n.results[0];(!n.ground.mapPoint||this.view.map.ground.opacity<1||n.ground.distance-e.distance>-Math.min(3*n.ground.distance,"global"===this.view.viewingMode?Object(H["e"])(this.view.renderCoordsHelper.spatialReference).radius/this.view.renderCoordsHelper.unitInMeters:Number.POSITIVE_INFINITY))&&t.push(e)}}}return{screenPoint:e,results:t}}_generateViewHandles(e){return[e.on("immediate-click",t=>{const{_operationHandle:i,defaultUpdateOptions:n,layer:r,state:s,updateGraphics:o,updateOnGraphicClick:a}=this,c="active"===s&&"create"===i.type;"disabled"!==s&&!c&&a&&(this._beginAsyncOperation(),this._getFirstHit(Object(N["a"])(t)).then(i=>{const n=i.results;if(n.length)for(let a=0;a<n.length;++a){const i=n[a];if(i.graphic){const n=i.graphic;if(o.indexOf(n)>-1||n.layer===r)return t.stopPropagation(),n;"2d"!==e.type||this._isComponentGraphic(n)||"active"!==s||this.cancel()}}else"active"===s&&this.cancel();return null}).then(e=>Object(S["k"])(e)&&-1===o.indexOf(e)?this.update([e],{...n}):null).then(()=>{this._endAsyncOperation()}))},F["b"].WIDGET)]}async _setupCreateOperation(e,t){if(!e)return null;const i={hasZ:"3d"===this.view.type,...this.defaultCreateOptions,...t};let n;if("2d"===this.view.type)switch(e){case"point":n=this._setupCreatePointOperation(e,i);break;case"multipoint":n=await this._setupCreateMultipointOperation(e,i);break;case"polygon":case"polyline":n=await this._setupCreatePolyOperation(e,i);break;case"rectangle":n=await this._setupCreateRectangleOperation(e,i);break;case"circle":n=await this._setupCreateCircleOperation(e,i)}else{const t=await this._setupCreate3DOperation(e,this.view,i);if(Object(S["j"])(t)||At(t))return null;n=t}return n}async _setupCreate3DOperation(e,t,n){if("multipoint"===e)return null;const r={point:this.pointSymbol,multipoint:null,polyline:this.polylineSymbol,polygon:this.polygonSymbol,rectangle:this.polygonSymbol,circle:this.polygonSymbol}[e];this._removeCreateOperationGraphics();const s="rectangle"!==e,o="rectangle"!==e;this.snappingOptions.enabledToggled=!1;const a={view:t,mode:"rectangle"===e||"circle"===e?"hybrid":"click",...n,elevationInfo:this.layer.elevationInfo,geometryType:e,createGraphicSymbol:r,snapToScene:!Object(S["k"])(this.layer.elevationInfo)||"absolute-height"===this.layer.elevationInfo.mode,snappingManager:this._snappingManager,forceUniformSize:o,centered:s},c=await this._requireModule(Promise.all([i.e("chunk-2d22cf8c"),i.e("chunk-5fc30fdb")]).then(i.bind(null,"438e")));if(At(c))return c;if(this.destroyed)return null;const l=new c.module.DrawGraphicTool(a);this.view.tools.add(l);let h=null;this.view.activeTool=l;const d=[],p=new yt({activeComponent:l,tool:e,type:"update",onEnd:()=>{var e;d.forEach(e=>e.remove()),d.length=0,null==(e=this.view.tools)||e.remove(l),l.destroy()},undo:()=>{l.canUndo&&l.undo()},redo:()=>{l.canRedo&&l.redo()},canUndo:()=>l.canUndo,canRedo:()=>l.canRedo});return d.push(this.view.on("key-down",t=>{t.key===jt.pan?(t.stopPropagation(),t.repeat||(l.enabled=!1)):t.key===jt.complete?(t.stopPropagation(),l.completeCreateOperation()):t.key===jt.undoKey?(t.stopPropagation(),p.undo()):t.key===jt.redoKey?(t.stopPropagation(),p.redo()):t.key!==jt.snappingKey||"rectangle"===e||"circle"===e||t.repeat?t.key!==jt.constraintKey||"rectangle"!==e&&"circle"!==e||t.repeat?t.key===jt.centerKey&&(t.repeat||(l.centered=!s,t.stopPropagation())):(l.forceUniformSize=!o,t.stopPropagation()):(this.snappingOptions.enabledToggled=!0,t.stopPropagation())},F["b"].WIDGET),this.view.on("key-up",t=>{t.key===jt.pan?l.enabled=!0:t.key===jt.snappingKey&&"rectangle"!==e&&"circle"!==e?(this.snappingOptions.enabledToggled=!1,t.stopPropagation()):t.key!==jt.constraintKey||"rectangle"!==e&&"circle"!==e?t.key===jt.centerKey&&(l.centered=s,t.stopPropagation()):(l.forceUniformSize=o,t.stopPropagation())},F["b"].WIDGET),l.on("vertex-add",t=>{switch(h=Object(S["j"])(h)?"start":"active",t.operation){case"apply":this.emit("create",{graphic:Object(S["t"])(l.createGraphic),state:h,tool:this.activeTool,toolEventInfo:t,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[Object(S["t"])(l.createGraphic)],tool:e});break;case"redo":this._emitRedoEvent({graphics:[Object(S["t"])(l.createGraphic)],tool:e})}}),l.on("cursor-update",e=>{l.drawOperation.numCommittedVertices>0&&this.emit("create",{graphic:Object(S["t"])(l.createGraphic),state:"active",tool:this.activeTool,toolEventInfo:{coordinates:e.vertices[0].coordinates,type:"cursor-update"},type:"create"})}),l.on("vertex-remove",t=>{switch(t.operation){case"apply":this.emit("create",{graphic:Object(S["t"])(l.createGraphic),state:"active",tool:this.activeTool,toolEventInfo:t,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[Object(S["t"])(l.createGraphic)],tool:e});break;case"redo":this._emitRedoEvent({graphics:[Object(S["t"])(l.createGraphic)],tool:e})}}),l.on("complete",e=>{this._removeCreateOperationGraphics(),this._set("createGraphic",Object(S["t"])(e.graphic)),h="complete",e.aborted?p&&p.cancel():p&&p.complete()})),p}_setupCreatePointOperation(e,t){const i={elevationInfo:this.layer.elevationInfo,hasZ:t.hasZ,defaultZ:t.defaultZ,snappingManager:this._snappingManager,interactiveUndoDisabled:!0},n=this._draw.create(e,i),r=[n.on("cursor-update",e=>{Object(S["k"])(e.vertexIndex)?this._displayCrosshairCursor():this._displayDefaultCursor()}),n.on("draw-complete",e=>{const t=this.createPointFromVertex(e.vertices[0]),i=new R["a"](t,this.pointSymbol);this._set("createGraphic",i),o&&o.complete()})],s=[this.view.on("key-down",e=>{e.key===jt.cancelKey&&(o&&o.cancel(),e.stopPropagation())},F["b"].WIDGET)],o=this._operationHandleForCreateAction(n,[...r,...s],e);return o}async _setupCreateMultipointOperation(e,t){const i=await De(),n={...t,elevationInfo:this.layer.elevationInfo,snappingManager:this._snappingManager,interactiveUndoDisabled:!0},r=this._draw.create(e,n);let s=null;const o=[],a=this._operationHandleForCreateAction(r,o,e);return o.push(r.on("vertex-add",t=>{const{type:n,vertexIndex:r,vertices:o}=t,a=o[r];s=t,this._drawMultipointGraphic(i,o,!0),this.emit("create",{graphic:this.createGraphic,state:1===o.length?"start":"active",tool:e,toolEventInfo:{added:a,vertices:[{coordinates:a,componentIndex:0,vertexIndex:r}],type:n},type:"create"})}),r.on("vertex-remove",t=>{const{type:n,vertexIndex:r,vertices:o}=t,a=o[r];s=t,this._drawMultipointGraphic(i,o,!0),this.emit("create",{graphic:this.createGraphic,state:"active",tool:e,toolEventInfo:{removed:a,vertices:[{coordinates:a,componentIndex:0,vertexIndex:r}],type:n},type:"create"})}),r.on("vertex-update",t=>{const{type:n,vertexIndex:r,vertices:o}=t,a=o[r];s=t,this._drawMultipointGraphic(i,o,!0),this.emit("create",{graphic:this.createGraphic,state:"active",tool:e,toolEventInfo:{type:n,updated:a,vertices:[{coordinates:a,componentIndex:0,vertexIndex:r}]},type:"create"})}),r.on("cursor-update",e=>{s=e}),r.on("draw-complete",e=>{const t=e.vertices.slice(0),n=i.createMultipoint(t,this.view.spatialReference);n&&this.createGraphic&&(this.createGraphic.geometry=n),a&&a.complete()}),r.on("undo",e=>{const t=e.vertices,n=s&&"cursor-update"!==s.type;this._resetCreateOperationGraphics(),t.length&&this._drawMultipointGraphic(i,t,n)}),r.on("redo",e=>{const t=e.vertices,n=s&&"cursor-update"!==s.type;this._resetCreateOperationGraphics(),t.length&&this._drawMultipointGraphic(i,t,n)})),o.push(this.view.on("pointer-move",()=>this._displayCrosshairCursor(),F["b"].WIDGET),this.view.on("key-down",e=>this._getCommonUpdateOperationKeyDownHandlers(a,e),F["b"].WIDGET)),a}async _setupCreatePolyOperation(e,t){const i=await De(),n={...t,elevationInfo:this.layer.elevationInfo,snappingManager:this._snappingManager,interactiveUndoDisabled:!0};let r=null;("polyline"===e||"polygon"===e)&&(r=this._draw.create(e,n));let s=null;const o=[r.on("vertex-add",t=>{const{type:n,vertexIndex:r,vertices:o}=t,a=o[r];this._snapLastPolygonVertexToFirst(e,o),s=t,this._drawVertexGraphics(i,e,o,{userClicked:!0}),this.emit("create",{graphic:this.createGraphic,state:1===o.length?"start":"active",tool:e,toolEventInfo:{added:a,vertices:[{coordinates:a,componentIndex:0,vertexIndex:r}],type:n},type:"create"})}),r.on("vertex-remove",t=>{const{type:n,vertexIndex:r,vertices:o}=t,a=o[r];this._snapLastPolygonVertexToFirst(e,o),s=t,this._drawVertexGraphics(i,e,o,{userClicked:!0}),this.emit("create",{graphic:this.createGraphic,state:"active",tool:e,toolEventInfo:{removed:a,vertices:[{coordinates:a,componentIndex:0,vertexIndex:r}],type:n},type:"create"})}),r.on("vertex-update",t=>{const{type:n,vertexIndex:r,vertices:o}=t,a=o[r];this._snapLastPolygonVertexToFirst(e,o),s=t,this._drawVertexGraphics(i,e,o,{userClicked:!0}),this.emit("create",{graphic:this.createGraphic,state:"active",tool:e,toolEventInfo:{type:n,updated:a,vertices:[{coordinates:a,componentIndex:0,vertexIndex:r}]},type:"create"})}),r.on("cursor-update",t=>{const{type:n,vertices:r}=t;if(t.mapPoint&&(this._snapLastPolygonVertexToFirst(e,r),s=t,this._drawVertexGraphics(i,e,r,{userClicked:!1}),r.length>1)){const t=r[r.length-1];this.emit("create",{graphic:this.createGraphic,state:"active",tool:e,toolEventInfo:{coordinates:t,type:n},type:"create"})}}),r.on("draw-complete",t=>{const n=t.vertices.slice(0);let r=null;"polyline"===e?r=i.createPolyline([n],this.view.spatialReference,this._doUnnormalization):"polygon"===e&&(r=i.createPolygon([n],this.view.spatialReference,this._doUnnormalization,!0)),r&&(this.createGraphic.geometry=r),c&&c.complete()}),r.on("undo",t=>{const n=t.vertices,r=s&&"cursor-update"!==s.type;this._resetCreateOperationGraphics(),this._snapLastPolygonVertexToFirst(e,n),n.length&&this._drawVertexGraphics(i,e,n,{userClicked:r})}),r.on("redo",t=>{const n=t.vertices,r=s&&"cursor-update"!==s.type;this._resetCreateOperationGraphics(),this._snapLastPolygonVertexToFirst(e,n),n.length&&this._drawVertexGraphics(i,e,n,{userClicked:r})})],a=[this.view.on("pointer-move",e=>{Object(S["k"])(r.getCoordsFromScreenPoint(Object(k["f"])(e.x,e.y)))?this._displayCrosshairCursor():this._displayDefaultCursor()},F["b"].WIDGET),this.view.on("key-down",e=>{e.key!==jt.snappingKey||e.repeat?e.key===jt.undoKey&&c&&c.canUndo()?(e.stopPropagation(),c.undo()):e.key===jt.redoKey&&c&&c.canRedo()?(e.stopPropagation(),c.redo()):e.key===jt.cancelKey&&c&&c.cancel():(this.snappingOptions.enabledToggled=!0,e.stopPropagation())},F["b"].WIDGET),this.view.on("key-up",e=>{e.key===jt.snappingKey&&(this.snappingOptions.enabledToggled=!1,e.stopPropagation())},F["b"].WIDGET)];if("polygon"===e){const e=(e,t,i)=>{if(!e||!e.layer||!e.visible)return!1;const n=this.view.toScreen(e.geometry);return this._isWithinScreenDistance(n,t,i)},t=t=>{if(!(this._vertexGraphics.length<=2))return e(this._vertexGraphics[0],t,this._getVertexIntersectDistance())};let i=!1;a.push(this.view.on("pointer-move",()=>{i=!1},F["b"].WIDGET),this.view.on("pointer-down",n=>{if(t(n))return i=!0,void n.stopPropagation();this._vertexGraphics.some(t=>e(t,n,this._getVertexIntersectDistance()))&&n.stopPropagation()},F["b"].WIDGET),this.view.on("pointer-up",e=>{i&&(e.stopPropagation(),r.complete())}))}const c=this._operationHandleForCreateAction(r,[...o,...a],e);return c}async _setupCreateCircleOperation(e,t){const i=await De(),n={...t,elevationInfo:this.layer.elevationInfo,snappingManager:this._snappingManager,interactiveUndoDisabled:!0},r=this._draw.create(e,n);let s=!1,o=!0;const a=[r.on("vertex-add",t=>{const{type:n,vertexIndex:a,vertices:c}=t,l=c[a];this._drawSegmentGraphic(i,e,c,{centered:o,constrainToggle:s},r.viewAlignedCoordinateSystem),this.emit("create",{graphic:this.createGraphic,state:1===c.length?"start":"active",tool:e,toolEventInfo:{added:l,vertices:[{coordinates:l,componentIndex:0,vertexIndex:a}],type:n},type:"create"})}),r.on("cursor-update",t=>{const{type:n,vertices:a}=t;if(this._drawSegmentGraphic(i,e,a,{centered:o,constrainToggle:s},r.viewAlignedCoordinateSystem),2===a.length){const t=a[a.length-1];this.emit("create",{graphic:this.createGraphic,state:"active",tool:e,toolEventInfo:{coordinates:t,type:n},type:"create"})}}),r.on("draw-complete",e=>{const t=e.vertices.slice(0);let n;1===t.length?(t.push(r.viewAlignedCoordinateSystem.makeMapPoint(t[0][0]+this._defaultSegmentOffset*this.view.resolution,t[0][1])),n=i.createCircle(t,r.viewAlignedCoordinateSystem,!0,this.view.resolution)):n=s?i.createEllipse(t,r.viewAlignedCoordinateSystem,o):i.createCircle(t,r.viewAlignedCoordinateSystem,o,this.view.resolution),this.createGraphic?this.createGraphic.geometry=n:(this._removeCreateGraphic(),this._set("createGraphic",new R["a"](n,this.polygonSymbol))),l&&l.complete()})],c=[this.view.on("pointer-move",e=>{Object(S["k"])(r.getCoordsFromScreenPoint(Object(k["f"])(e.x,e.y)))?this._displayCrosshairCursor():this._displayDefaultCursor()},F["b"].WIDGET),this.view.on("key-down",t=>{t.key===jt.constraintKey?s||(s=!0,this._drawSegmentGraphic(i,e,r.vertices,{centered:o,constrainToggle:s},r.viewAlignedCoordinateSystem)):t.key===jt.centerKey?o&&(o=!1,this._drawSegmentGraphic(i,e,r.vertices,{centered:o,constrainToggle:s},r.viewAlignedCoordinateSystem)):t.key===jt.cancelKey&&l&&l.cancel()},F["b"].WIDGET),this.view.on("key-up",t=>{t.key===jt.constraintKey?(s=!1,this._drawSegmentGraphic(i,e,r.vertices,{centered:o,constrainToggle:s},r.viewAlignedCoordinateSystem)):t.key===jt.centerKey&&(o=!0,this._drawSegmentGraphic(i,e,r.vertices,{centered:o,constrainToggle:s},r.viewAlignedCoordinateSystem))},F["b"].WIDGET)],l=this._operationHandleForCreateAction(r,[...a,...c],e);return l}async _setupCreateRectangleOperation(e,t){const i=await De(),n={...t,elevationInfo:this.layer.elevationInfo,snappingManager:this._snappingManager,interactiveUndoDisabled:!0},r=this._draw.create(e,n);let s=!1,o=!1;const a=[r.on("vertex-add",t=>{const{type:n,vertexIndex:a,vertices:c}=t,l=c[a];this._drawSegmentGraphic(i,e,c,{centered:o,constrainToggle:s},r.viewAlignedCoordinateSystem),this.emit("create",{graphic:this.createGraphic,state:1===c.length?"start":"active",tool:e,toolEventInfo:{added:l,vertices:[{coordinates:l,componentIndex:0,vertexIndex:a}],type:n},type:"create"})}),r.on("cursor-update",t=>{const{type:n,vertices:a}=t;if(this._drawSegmentGraphic(i,e,a,{centered:o,constrainToggle:s},r.viewAlignedCoordinateSystem),2===a.length){const t=a[a.length-1];this.emit("create",{graphic:this.createGraphic,state:"active",tool:e,toolEventInfo:{coordinates:t,type:n},type:"create"})}}),r.on("draw-complete",e=>{const t=e.vertices.slice(0);let n=null;1===t.length&&(s=!1,o=!1),n=s?i.createSquare(t,r.viewAlignedCoordinateSystem,o):i.createRectangle(t,r.viewAlignedCoordinateSystem,o),this.createGraphic?this.createGraphic.geometry=n:(this._removeCreateGraphic(),this._set("createGraphic",new R["a"](n,this.polygonSymbol))),l&&l.complete()})],c=[this.view.on("pointer-move",e=>{Object(S["k"])(r.getCoordsFromScreenPoint(Object(k["f"])(e.x,e.y)))?this._displayCrosshairCursor():this._displayDefaultCursor()},F["b"].WIDGET),this.view.on("key-down",t=>{t.key===jt.constraintKey?s||(s=!0,this._drawSegmentGraphic(i,e,r.vertices,{centered:o,constrainToggle:s},r.viewAlignedCoordinateSystem)):t.key===jt.centerKey?o||(o=!0,this._drawSegmentGraphic(i,e,r.vertices,{centered:o,constrainToggle:s},r.viewAlignedCoordinateSystem)):t.key===jt.cancelKey&&l&&l.cancel()},F["b"].WIDGET),this.view.on("key-up",t=>{t.key===jt.constraintKey?(s=!1,this._drawSegmentGraphic(i,e,r.vertices,{centered:o,constrainToggle:s},r.viewAlignedCoordinateSystem)):t.key===jt.centerKey&&(o=!1,this._drawSegmentGraphic(i,e,r.vertices,{centered:o,constrainToggle:s},r.viewAlignedCoordinateSystem))},F["b"].WIDGET)],l=this._operationHandleForCreateAction(r,[...a,...c],e);return l}async _setupUpdateOperation(e,t){const{_defaultUpdateTool:i,defaultUpdateOptions:n,layer:r,view:s}=this,o={...n,...t},a=o.tool||i;for(const c of e)r.remove(c),r.add(c);if("3d"===s.type){if(0===e.length)return null;switch(a){case"move":return this._setupMove3DOperation(e,o,s,a);case"reshape":{if(e.length>1)return this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null;const t=Object(Ae["a"])(e[0]);return 0===t?this._setupReshape3DOperation(e[0],o,s):(this._logError("sketch:reshape",`Reshape operation not supported for provided graphic(s) (${Te(t)}).`),null)}case"transform":return this._setupGraphicTransform3DOperation(e,o,s)}}if("move"===a)return this._setupMoveOperation(e,o,s);if(e.length>1)return"reshape"===a?(this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null):this._setupTransformOrReshapeOperation(e,a,o,s);if(1===e.length){const t=e[0],i=Object(S["i"])(t.geometry,"type");if("point"===i||"multipoint"===i)return this._setupMoveOperation(e,o,s);if("transform"===a||"reshape"===a)return this._setupTransformOrReshapeOperation(e,a,o,s)}return null}async _setupMove3DOperation(e,t,n,r,s=!1){for(const i of e){const e=Object(Ee["a"])(i);if(0!==e)return this._logError("sketch:move",`Move operation not supported for provided graphic(s) (${Te(e)}).`),null}const o=await this._requireModule(Promise.all([i.e("chunk-2d22cf8c"),i.e("chunk-5fc30fdb")]).then(i.bind(null,"438e")));if(At(o))return o;const a=new o.module.GraphicMoveTool({view:n,enableZ:t.enableZ,snappingManager:this._snappingManager});this.view.tools.add(a),a.graphics.addMany(e),s||this.updateGraphics.addMany(e);const c=[],l=new yt({activeComponent:a,tool:r,type:"update",onEnd:()=>{var e;c.forEach(e=>e.remove()),c.length=0,null==(e=this.view.tools)||e.remove(a),a.destroyed||a.destroy()},undo:()=>{Pt(l,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:r})},redo:()=>{Ct(l,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:r})},addToSelection:e=>{this.updateGraphics.push(e),a.graphics.push(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:e=>{const t=this.updateGraphics.indexOf(e);l.history.undo.forEach(e=>e.updates.splice(t,1)),l.history.redo.forEach(e=>e.updates.splice(t,1)),this.updateGraphics.remove(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),0!==this.updateGraphics.length?a.graphics.remove(e):l.complete()},toggleTool:async()=>{if(1!==this.updateGraphics.length||!1===t.toggleToolOnClick)return;if("transform"!==r)return;const e=this.updateGraphics.getItemAt(0);if(0!==Object(Ae["a"])(e))return;const i=await this._setupReshape3DOperation(e,t,n,!0);At(i)||(l.onEnd(),l.destroy(),this._setUpdateOperationHandle(i,t))}});return c.push(...this._getHandlesForComponent(l,t),this.view.on("immediate-click",e=>this._getCommonUpdateOperationClickHandlers(l,e,t),F["b"].WIDGET),this.view.on("key-down",e=>this._getCommonUpdateOperationKeyDownHandlers(l,e),F["b"].WIDGET)),l}_setupGraphicTransform3DOperation(e,t,i,n=!1){if(1===e.length&&0===ke(e[0])){const r=e[0];if(Object(S["k"])(r.geometry)&&"point"===r.geometry.type)return this._setupPointTransform3DOperation(r,t,i);if(Object(S["k"])(r.geometry)&&("polygon"===r.geometry.type||"polyline"===r.geometry.type))return this._setupPolyTransform3DOperation(r,t,i,n)}return this._setupMove3DOperation(e,t,i,"transform",n)}async _setupPointTransform3DOperation(e,t,n){const r="transform",{enableRotation:s,enableScaling:o,enableZ:a}=t,c=await this._requireModule(Promise.all([i.e("chunk-2d22cf8c"),i.e("chunk-5fc30fdb")]).then(i.bind(null,"438e")));if(At(c))return c;const l=new c.module.GraphicTransformTool({graphic:e,view:n,enableRotation:s,enableScaling:o,enableZ:a,snappingManager:this._snappingManager});this.view.tools.add(l),this.updateGraphics.add(e);const h=[],d=new yt({activeComponent:l,tool:r,type:"update",onEnd:()=>{var e;h.forEach(e=>e.remove()),h.length=0,null==(e=this.view.tools)||e.remove(l),l.destroyed||l.destroy()},undo:()=>{Pt(d,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:r})},redo:()=>{Ct(d,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:r})},addToSelection:async e=>{this.updateGraphics.add(e);const i=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,n,"transform",!0);At(i)||(d.onEnd(),d.destroy(),this._setUpdateOperationHandle(i,t))}});return h.push(...this._getHandlesForComponent(d,t),this.view.on("immediate-click",e=>this._getCommonUpdateOperationClickHandlers(d,e,t),F["b"].WIDGET),this.view.on("key-down",e=>this._getCommonUpdateOperationKeyDownHandlers(d,e),F["b"].WIDGET)),d}async _setupPolyTransform3DOperation(e,t,n,r=!1){const s="transform",{enableRotation:o,enableScaling:a,enableZ:c,preserveAspectRatio:l}=t,h=await this._requireModule(Promise.all([i.e("chunk-2d22cf8c"),i.e("chunk-5fc30fdb")]).then(i.bind(null,"438e")));if(At(h))return h;const d=new h.module.ExtentTransformTool({graphic:e,view:n,enableRotation:o,enableScaling:a,enableZ:c,preserveAspectRatio:l});this.view.tools.add(d),r||this.updateGraphics.add(e);const p=[],u=new yt({activeComponent:d,tool:s,type:"update",onEnd:()=>{var e;p.forEach(e=>e.remove()),p.length=0,null==(e=this.view.tools)||e.remove(d),d.destroyed||d.destroy()},canUndo:()=>d.canUndo(),undo:()=>{d.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:s})},canRedo:()=>d.canRedo(),redo:()=>{d.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:s})},addToSelection:async e=>{this.updateGraphics.add(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"});const i=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,n,"transform",!0);At(i)||(u.onEnd(),u.destroy(),this._setUpdateOperationHandle(i,t))},removeFromSelection:async e=>{this.updateGraphics.remove(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),u.complete()},toggleTool:async()=>{if(1!==this.updateGraphics.length||!1===t.toggleToolOnClick)return;const e=this.updateGraphics.getItemAt(0);if(0!==Object(Ae["a"])(e))return;const i=await this._setupReshape3DOperation(e,t,n,!0);At(i)||(u.onEnd(),u.destroy(),this._setUpdateOperationHandle(i,t))}});return p.push(...this._getHandlesForComponent(u,t),this.view.on("immediate-click",e=>this._getCommonUpdateOperationClickHandlers(u,e,t),F["b"].WIDGET),this.view.on("key-down",e=>this._getCommonUpdateOperationKeyDownHandlers(u,e),F["b"].WIDGET),this.view.on("key-down",e=>{e.key!==jt.constraintKey||e.repeat||(d.preserveAspectRatio=!d.preserveAspectRatio,e.stopPropagation())},F["b"].WIDGET),this.view.on("key-up",e=>{e.key===jt.constraintKey&&(d.preserveAspectRatio=!d.preserveAspectRatio,e.stopPropagation())},F["b"].WIDGET)),u}async _setupMoveOperation(e,t,i){const n="move";this.updateGraphics.addMany(e);const r=await this._getGraphicMover(e,t,i);if(At(r))return r;this._syncCloneInfos();const s=new yt({activeComponent:r,tool:n,type:"update",onEnd:()=>{var e;this._displayDefaultCursor(),a.forEach(e=>e.remove()),o.forEach(e=>e.remove()),a=[],o=[],r.destroy(),null==(e=this._internalGraphicsLayer)||e.removeMany([...this.updateGraphics.toArray()]),this._removeCloneGraphics()},undo:()=>{const e=this.updateGraphics.toArray();Pt(s,e),this._syncCloneInfos(),this._emitUndoEvent({graphics:e,tool:n})},redo:()=>{const e=this.updateGraphics.toArray();Ct(s,e),this._syncCloneInfos(),this._emitRedoEvent({graphics:e,tool:n})},addToSelection:e=>{this.updateGraphics.push(e),r.graphics=this.updateGraphics.toArray();const t=this._createClone(e);this._moveOperationCloneInfos.push({graphic:e,clone:t}),this._internalGraphicsLayer.add(t),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:e=>{const t=this.updateGraphics.indexOf(e);s.history.undo.forEach(e=>e.updates.splice(t,1)),s.history.redo.forEach(e=>e.updates.splice(t,1));const i=this._moveOperationCloneInfos.findIndex(t=>t.graphic===e),n=this._moveOperationCloneInfos[i];this._internalGraphicsLayer.remove(n.clone),this.updateGraphics.remove(e),this._moveOperationCloneInfos.splice(i,1);const o=this.updateGraphics.toArray();this.emit("update",{graphics:o,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),0!==this.updateGraphics.length?r.graphics=o:s.complete()}});let o=[i.on("immediate-click",e=>this._getCommonUpdateOperationClickHandlers(s,e,t),F["b"].WIDGET),i.on("key-down",e=>{this._getCommonUpdateOperationKeyDownHandlers(s,e),e.key!==jt.constraintKey||e.repeat||(r.enableMoveAllGraphics=!r.enableMoveAllGraphics)},F["b"].WIDGET),i.on("key-up",e=>{e.key===jt.constraintKey&&(r.enableMoveAllGraphics=!r.enableMoveAllGraphics)},F["b"].WIDGET)],a=this._getHandlesForComponent(s,t);return a.push(r.on("graphic-move",e=>{this._moveOperationCloneInfos.forEach(t=>{const i=e.allGraphics.find(e=>e===t.graphic);i&&(t.clone.geometry=i.geometry)})})),s}_removeCloneGraphics(){if(this._moveOperationCloneInfos.length){for(const{clone:e}of this._moveOperationCloneInfos)this._internalGraphicsLayer.remove(e),e.destroy();this._moveOperationCloneInfos=[]}}_syncCloneInfos(){this._removeCloneGraphics(),this._moveOperationCloneInfos=this._generateCloneInfos(this.updateGraphics.toArray());for(const{clone:e}of this._moveOperationCloneInfos)this._internalGraphicsLayer.add(e)}_generateCloneInfos(e){return(null==e?void 0:e.map(e=>({graphic:e,clone:this._createClone(e)})))||[]}_createClone(e){const t=e.clone();return t.symbol=this._getSymbolForClone(e),t}_getSymbolForClone(e){const t=12;if(Object(S["j"])(e.symbol))return null;switch(e.symbol.type){case"cim":return new G["a"]({style:"circle",size:t,color:[0,0,0,0],outline:{color:[255,127,0,1],width:1}});case"picture-marker":{const{xoffset:t,yoffset:i,height:n,width:r}=e.symbol,s=n===r?r:Math.max(n,r);return new G["a"]({xoffset:t,yoffset:i,size:s,style:"square",color:[0,0,0,0],outline:{color:[255,127,0,1],width:1}})}case"simple-marker":{const{xoffset:t,yoffset:i,size:n,style:r}=e.symbol;return new G["a"]({xoffset:t,yoffset:i,style:"circle"===r?"circle":"square",size:n+2,color:[0,0,0,0],outline:{color:[255,127,0,1],width:1}})}case"simple-fill":return new D["a"]({color:[0,0,0,0],outline:{style:"dash",color:[255,127,0,1],width:1}});case"simple-line":return new V["a"]({color:[255,127,0,1],style:"dash",width:1});case"text":{const{xoffset:i,yoffset:n}=e.symbol;return new G["a"]({xoffset:i,yoffset:n,size:t,color:[0,0,0,0],outline:{color:[255,127,0,1],width:1}})}default:return null}}async _setupReshape3DOperation(e,t,n,r=!1){const s="reshape",o=await this._requireModule(Promise.all([i.e("chunk-2d22cf8c"),i.e("chunk-5fc30fdb")]).then(i.bind(null,"438e")));if(At(o))return o;this.snappingOptions.enabledToggled=!1;const a=new o.module.GraphicReshapeTool({view:n,graphic:e,enableZ:t.enableZ,enableMoveGraphic:t.enableMoveGraphic,snappingManager:this._snappingManager});n.tools.add(a),r||this.updateGraphics.add(e);const c=[],l=new yt({activeComponent:a,tool:s,type:"update",onEnd:()=>{var e;c.forEach(e=>e.remove()),c.length=0,null==(e=this.view.tools)||e.remove(a),a.destroyed||a.destroy()},undo:()=>{a.beforeUndo(),Pt(l,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:s})},redo:()=>{Ct(l,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:s})},addToSelection:async e=>{this.updateGraphics.add(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"});const i=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,n,"transform",!0);At(i)||(l.onEnd(),l.destroy(),this._setUpdateOperationHandle(i,t))},removeFromSelection:async e=>{this.updateGraphics.remove(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),l.complete()},toggleTool:async()=>{if(!1===t.toggleToolOnClick)return;const e=await this._setupGraphicTransform3DOperation(this.updateGraphics.toArray(),t,n,!0);At(e)||(l.onEnd(),l.destroy(),this._setUpdateOperationHandle(e,t))}});return c.push(...this._getHandlesForComponent(l,t),n.on("immediate-click",e=>this._getCommonUpdateOperationClickHandlers(l,e,t),F["b"].WIDGET),n.on("key-down",e=>{this._getCommonUpdateOperationKeyDownHandlers(l,e),e.key===jt.snappingKey&&(this.snappingOptions.enabledToggled=!0,e.stopPropagation())},F["b"].WIDGET),n.on("key-up",e=>{e.key===jt.snappingKey&&(this.snappingOptions.enabledToggled=!1,e.stopPropagation())},F["b"].WIDGET)),l}async _setupTransformOrReshapeOperation(e,t,i,n){const{multipleSelectionEnabled:r}=i;this.updateGraphics.addMany(e);const s="transform"===t?await this._getBox(e,i,n):await this._getReshape(e,i,n);if(At(s))return s;const o=new yt({activeComponent:s,type:"update",onEnd:()=>{c.forEach(e=>e.remove()),a.forEach(e=>e.remove()),c=[],a=[],o.activeComponent&&!o.activeComponent.destroyed&&o.activeComponent.destroy(),this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray())},undo:()=>{Pt(o,this.updateGraphics.toArray()),o.refreshComponent(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:o.tool})},redo:()=>{Ct(o,this.updateGraphics.toArray()),o.refreshComponent(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:o.tool})},addToSelection:e=>{const t=o.activeComponent;this.updateGraphics.add(e),t.graphics=this.updateGraphics.toArray(),t.refresh(),o.resetHistory(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:e=>{const t=o.activeComponent,i=this.updateGraphics.indexOf(e);o.history.undo.forEach(e=>e.updates.splice(i,1)),o.history.redo.forEach(e=>e.updates.splice(i,1)),this.updateGraphics.remove(e);const n=this.updateGraphics.toArray();this.emit("update",{graphics:n,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),0!==this.updateGraphics.length?t.graphics=n:o.complete()},toggleTool:async()=>{if(this.updateGraphics.length>1)return;let t=null;"transform"===o.tool?t=await this._getReshape(e,i,n):"reshape"===o.tool&&(t=await this._getBox(e,i,n)),At(t)||(o.activeComponent.destroy(),o.activeComponent=t,o.activeComponent&&(c.forEach(e=>e.remove()),c=this._getHandlesForComponent(o,i)))}});let a=[n.on("immediate-click",e=>{this._getFirstHit(Object(N["a"])(e)).then(t=>{var i;if(!o)return;if(null==(i=t.results)||!i.length)return void o.complete();const n=o.activeComponent;t.results.some(t=>{if(t.graphic){var i;const s=t.graphic;if("box"===(null==n?void 0:n.type)&&null!=(i=e.native)&&i.shiftKey&&r)return o.addToSelection(s),!0;s.layer===this.layer&&o.complete()}return!1})&&e.stopPropagation()})},F["b"].WIDGET),n.on("key-down",e=>{if(this._getCommonUpdateOperationKeyDownHandlers(o,e),e.key!==jt.snappingKey||e.repeat||(this.snappingOptions.enabledToggled=!0,e.stopPropagation()),e.key===jt.constraintKey&&!e.repeat&&o){const e=o.activeComponent;e&&"box"===e.type&&(e.preserveAspectRatio=!e.preserveAspectRatio)}},F["b"].WIDGET),n.on("key-up",e=>{var t;if(e.key===jt.snappingKey&&"reshape"===(null==o||null==(t=o.activeComponent)?void 0:t.type)&&(this.snappingOptions.enabledToggled=!1,e.stopPropagation()),e.key===jt.constraintKey&&o){const e=o.activeComponent;e&&"box"===e.type&&(e.preserveAspectRatio=!e.preserveAspectRatio)}},F["b"].WIDGET)],c=this._getHandlesForComponent(o,i);return o}async _getGraphicMover(e,t,n){const{enableMoveAllGraphics:r}=t,s=await this._requireModule(i.e("chunk-63e4c91e").then(i.bind(null,"24be")));return At(s)?s:new s.module.default({enableMoveAllGraphics:r,graphics:e,view:n,callbacks:{onGraphicMoveStart:({dx:e,dy:t,graphic:i})=>{this._displayGrabbingCursor(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:t,mover:i,type:"move-start"},type:"update"})},onGraphicMove:({dx:e,dy:t,graphic:i})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:t,mover:i,type:"move"},type:"update"}),onGraphicMoveStop:({dx:e,dy:t,graphic:i})=>{this._displayPointerCursor(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:t,mover:i,type:"move-stop"},type:"update"})},onGraphicPointerOver:()=>this._displayPointerCursor(),onGraphicPointerOut:()=>this._displayDefaultCursor()}})}async _getBox(e,t,n){const{enableRotation:r,enableScaling:s,preserveAspectRatio:o}=t,a=await this._requireModule(i.e("chunk-bc5f8c4a").then(i.bind(null,"4c3c")));return At(a)?a:new a.module.default({graphics:e,enableRotation:r,enableScaling:s,preserveAspectRatio:o,layer:this._internalGraphicsLayer,view:n,callbacks:{onMoveStart:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onMove:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onMoveStop:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onScaleStart:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onScale:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onScaleStop:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onRotateStart:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onRotate:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onRotateStop:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"})}})}async _getReshape(e,t,n){const{enableMidpoints:r=!0}=t,s=await this._requireModule(i.e("chunk-f6fb21b8").then(i.bind(null,"053b")));return At(s)?s:new s.module.default({enableMidpoints:r,graphic:e[0],layer:this._internalGraphicsLayer,snappingManager:this._snappingManager,view:n,callbacks:{onReshapeStart:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onReshape:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onReshapeStop:({mover:e,type:t})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e,type:t},type:"update"}),onMoveStart:({dx:e,dy:t,mover:i,type:n})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:t,mover:i,type:n},type:"update"}),onMove:({dx:e,dy:t,mover:i,type:n})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:t,mover:i,type:n},type:"update"}),onMoveStop:({dx:e,dy:t,mover:i,type:n})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:t,mover:i,type:n},type:"update"}),onVertexAdd:({added:e,type:t,vertices:i})=>{const n=e.map(e=>Object(E["b"])(e.geometry));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:n,vertices:i,type:t},type:"update"})},onVertexRemove:({removed:e,type:t,vertices:i})=>{const n=e.map(e=>Object(E["b"])(e.geometry));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{removed:n,vertices:i,type:t},type:"update"})}}})}_getHandlesForComponent(e,t){const i=e.activeComponent;switch(i.type){case"graphic-mover":return[i.on("graphic-click",({graphic:t,viewEvent:i})=>{var n;null!=(n=i.native)&&n.shiftKey&&(i.stopPropagation(),e.removeFromSelection(t))}),i.on("graphic-move-start",t=>e.addToHistory(Tt(t.allGraphics)))];case"box":return[i.on("graphic-click",i=>this._onTransformOrReshape2DGraphicClick(e,t,i)),i.on("move-start",t=>e.addToHistory(Tt(t.graphics))),i.on("rotate-start",t=>e.addToHistory(Tt(t.graphics))),i.on("scale-start",t=>e.addToHistory(Tt(t.graphics)))];case"reshape":return[i.on("graphic-click",i=>this._onTransformOrReshape2DGraphicClick(e,t,i)),i.on("move-start",t=>e.addToHistory(Tt([t.mover]))),i.on("reshape-start",t=>e.addToHistory(Tt([t.graphic]))),i.on("vertex-add",t=>e.addToHistory(Tt([t.oldGraphic]))),i.on("vertex-remove",t=>e.addToHistory(Tt([t.oldGraphic])))];case"move-3d":return[i.on("graphic-move-start",t=>{e.addToHistory(Tt(t.allGraphics)),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:t.allGraphics.length>0?t.allGraphics[0]:null,type:"move-start"},type:"update"})}),i.on("graphic-move",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e.dx,dy:e.dy,mover:e.allGraphics.length>0?e.allGraphics[0]:null,type:"move"},type:"update"})}),i.on("graphic-move-stop",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:e.allGraphics.length>0?e.allGraphics[0]:null,type:"move-stop"},type:"update"})}),i.on("immediate-click",i=>{i.shiftKey?this._toggleSelection([i.graphic],e,t):e.toggleTool()})];case"transform-3d":return[i.on("graphic-translate-start",t=>{e.addToHistory(Tt([t.graphic])),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:t.graphic,dx:t.dxScreen,dy:t.dyScreen,type:"move-start"},type:"update"})}),i.on("graphic-translate-stop",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.graphic,dx:e.dxScreen,dy:e.dyScreen,type:"move-stop"},type:"update"})}),i.on("graphic-rotate-start",t=>{e.addToHistory(Et([t.graphic])),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:t.graphic,angle:t.angle,type:"rotate-start"},type:"update"})}),i.on("graphic-rotate-stop",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.graphic,angle:e.angle,type:"rotate-stop"},type:"update"})}),i.on("graphic-scale-start",t=>{e.addToHistory(Et([t.graphic])),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:t.graphic,xScale:t.xScale,yScale:t.yScale,type:"scale-start"},type:"update"})}),i.on("graphic-scale-stop",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.graphic,xScale:e.xScale,yScale:e.yScale,type:"scale-stop"},type:"update"})}),i.on("graphic-translate",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.graphic,dx:e.dxScreen,dy:e.dyScreen,type:"move"},type:"update"})}),i.on("graphic-rotate",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.graphic,angle:e.angle,type:"rotate"},type:"update"})}),i.on("graphic-scale",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.graphic,xScale:e.xScale,yScale:e.yScale,type:"scale"},type:"update"})}),i.on("immediate-click",i=>{i.shiftKey?this._toggleSelection([i.graphic],e,t):e.toggleTool()})];case"reshape-3d":return[i.on("reshape",t=>{"reshape-start"===t.type&&e.addToHistory(Tt([t.mover])),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:t,type:"update"})}),i.on("move",t=>{"move-start"===t.type&&e.addToHistory(Tt([t.mover])),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:t,type:"update"})}),i.on("vertex-add",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:e,type:"update"})}),i.on("vertex-remove",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:e,type:"update"})}),i.on("immediate-click",i=>{i.shiftKey?this._toggleSelection([i.graphic],e,t):e.toggleTool()})];case"draw":case"draw-3d":return null;default:return}}_onTransformOrReshape2DGraphicClick(e,t,i){var n;const{graphic:r,viewEvent:s}=i;null!=(n=s.native)&&n.shiftKey?(s.stopPropagation(),e.removeFromSelection(r)):t.toggleToolOnClick&&(Object(S["j"])(r.geometry)||"extent"!==r.geometry.type?(s.stopPropagation(),e.toggleTool()):this._logError("sketch:reshape-extent","Reshape operation does not support graphics with geometry of type 'extent'."))}_setUpdateOperationHandle(e,t){this._operationHandle=e;const i=this.view.map;this._disablePopup(t);const n=()=>{if(e===this._operationHandle){const n=this.updateGraphics.toArray(),r=this._operationHandle.tool;this._operationHandle.destroy(),this._operationHandle=null,this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray()),this.updateGraphics.removeAll(),i&&i.remove(this._internalGraphicsLayer),this._restorePopup(t),this.emit("update",{graphics:n,state:"complete",aborted:e.cancelled,tool:r,toolEventInfo:null,type:"update"})}};e.on("complete",n)}_getCommonUpdateOperationClickHandlers(e,t,i){const n=Object(N["a"])(t);this._getFirstHit(n).then(n=>{const r=n.results;r.length&&(t.native.shiftKey&&this._toggleSelection(r.map(e=>e.graphic),e,i)||r.some(e=>e.graphic&&this.updateGraphics.indexOf(e.graphic)>-1))?t.stopPropagation():e.complete()})}_toggleSelection(e,t,i){const n=!!i.multipleSelectionEnabled;return e.some(e=>null!=e&&!(!n||e.layer!==this.layer)&&(-1===this.updateGraphics.indexOf(e)?t.addToSelection(e):t.removeFromSelection(e),!0))}_getCommonUpdateOperationKeyDownHandlers(e,t){if(!e)return;const i=t.key;i===jt.undoKey&&e.canUndo()?(t.stopPropagation(),e.undo()):i===jt.redoKey&&e.canRedo()?(t.stopPropagation(),e.redo()):i===jt.cancelKey?(t.stopPropagation(),e.cancel()):jt.deleteKeys.indexOf(i)>=0&&this._onDeleteKey(t)}_onDeleteKey(e){if(!this._operationHandle||"update"!==this._operationHandle.type)return;const t=this.activeComponent;if(Object(S["j"])(t)||"reshape"===t.type||"reshape-3d"===t.type)return;e.stopPropagation();const i=this.updateGraphics.toArray();this.layer.removeMany(i),this._emitDeleteEvent({graphics:i,tool:this.activeTool})}_drawMultipointGraphic(e,t,i){let n=null;if(!i&&t.length>1){const i=t.slice(0);i.pop(),n=e.createMultipoint(i,this.view.spatialReference)}else n=e.createMultipoint(t,this.view.spatialReference);this.createGraphic?this.createGraphic.geometry=n:this._set("createGraphic",new R["a"](n,this.pointSymbol)),i&&1===t.length&&this._internalGraphicsLayer.add(this.createGraphic)}_drawVertexGraphics(e,t,i,n){if(!i.length)return;const{_doUnnormalization:r,activeLineSymbol:s,activeVertexSymbol:o,polygonSymbol:a,polylineSymbol:c,vertexSymbol:l,view:{spatialReference:h}}=this,d=!(!n||!n.userClicked),p="polygon"===t,u=p?a:c;if(1===i.length){this._removeLineGraphic(),this._removeActiveLineGraphic();const t=this.createPointFromVertex(i[0]),n=p?e.createPolygon([i],h,r,!0):e.createPolyline([i],h,r);this._vertexGraphics.length?this._vertexGraphics[0].geometry=t:this._vertexGraphics.push(new R["a"](t,o)),this.createGraphic?this.createGraphic.set({geometry:n,symbol:u}):this._set("createGraphic",new R["a"](n,u)),d&&this._internalGraphicsLayer.add(this._vertexGraphics[0])}else if(2===i.length){const t=this.createPointFromVertex(i[1]),n=e.createPolyline([i],h,r),s=p?e.createPolygon([i],h,r,!0):e.createPolyline([i],h,r);if(!this._vertexGraphics.length){const e=this.createPointFromVertex(i[0]),t=new R["a"](e,l);this._vertexGraphics.push(t)}if(1===this._vertexGraphics.length){const e=this._vertexGraphics[0],i=new R["a"](t,l);this._removeLineGraphic(),this._removeActiveFillGraphic(),this._vertexGraphics.push(i),this._internalGraphicsLayer.remove(e),this._internalGraphicsLayer.add(e)}else this._vertexGraphics[1].geometry=t;this._showActiveLineGraphic(n);const o=this._vertexGraphics[0];d&&(this._activeLineGraphic.symbol=c,o.symbol=l,this._internalGraphicsLayer.add(this._vertexGraphics[1])),this.createGraphic?this.createGraphic.set({geometry:s,symbol:u}):this._set("createGraphic",new R["a"](s,u)),this._internalGraphicsLayer.remove(o),this._internalGraphicsLayer.add(o)}else if(i.length>2){const n=p?e.createPolygon([i],h,r,!0):e.createPolyline([i],h,r);"polygon"===t&&this._showFillGraphic(n);const a=i.map(e=>e.slice()),f=a.pop(),b=[a[a.length-1],f],g=e.createPolyline([a],h,r),m=e.createPolyline([b],h,r);this._showLineGraphic(g),this._showActiveLineGraphic(m);for(let e=0;e<a.length;e++){const t=this._vertexGraphics[e];if(t)d||e!==this._vertexGraphics.length-1?t.symbol=l:t.symbol=o;else{const t=this.createPointFromVertex(i[e]);this._showVertexGraphic(t)}}if(d){this._activeLineGraphic.symbol=c;const e=i.length-1,t=this.createPointFromVertex(i[e]);this._showVertexGraphic(t)}else this._activeLineGraphic.symbol=s;this.createGraphic?this.createGraphic.set({geometry:n,symbol:u}):(this._removeCreateGraphic(),this._set("createGraphic",new R["a"](n,u)));for(const e of this._vertexGraphics)this._internalGraphicsLayer.remove(e),this._internalGraphicsLayer.add(e)}}_drawSegmentGraphic(e,t,i,n,r){if(!i.length)return;const s=!(null==n||!n.centered),o=!(null==n||!n.constrainToggle);let a;1===i.length?this._removeCenterIndicatorGraphic():("rectangle"===t?a=o?e.createSquare(i,r,s):e.createRectangle(i,r,s):"circle"===t&&(a=o?e.createEllipse(i,r,s):e.createCircle(i,r,s,this.view.resolution)),Object(S["k"])(a)&&a.extent&&a.extent.center&&this._showCenterIndicatorGraphic(a.extent.center)),a?this.createGraphic?this.createGraphic.geometry=a:(this._removeCreateGraphic(),this._set("createGraphic",new R["a"](a,this.polygonSymbol)),this._internalGraphicsLayer.add(this.createGraphic)):this._removeCreateGraphic()}_showCenterIndicatorGraphic(e){this._centerIndicatorGraphic?this._centerIndicatorGraphic.geometry=e:(this._centerIndicatorGraphic=new R["a"](e,this._centerSymbol),this._internalGraphicsLayer.add(this._centerIndicatorGraphic))}_removeCenterIndicatorGraphic(){this._centerIndicatorGraphic&&(this._internalGraphicsLayer.remove(this._centerIndicatorGraphic),this._centerIndicatorGraphic.destroy(),this._centerIndicatorGraphic=null)}_showActiveLineGraphic(e){this._activeLineGraphic?(this._activeLineGraphic.set({geometry:e,symbol:this.activeLineSymbol}),this._internalGraphicsLayer.remove(this._activeLineGraphic)):this._activeLineGraphic=new R["a"](e,this.activeLineSymbol),this._internalGraphicsLayer.add(this._activeLineGraphic)}_showFillGraphic(e){this._activeFillGraphic?(this._activeFillGraphic.set({geometry:e,symbol:this.activeFillSymbol}),this._internalGraphicsLayer.remove(this._activeFillGraphic)):this._activeFillGraphic=new R["a"](e,this.activeFillSymbol),this._internalGraphicsLayer.add(this._activeFillGraphic)}_showLineGraphic(e){this._lineGraphic?(this._lineGraphic.set({geometry:e,symbol:this.polylineSymbol}),this._internalGraphicsLayer.remove(this._lineGraphic)):this._lineGraphic=new R["a"](e,this.polylineSymbol),this._internalGraphicsLayer.add(this._lineGraphic)}_showVertexGraphic(e,t){const i=t?this.activeVertexSymbol:this.vertexSymbol,n=new R["a"](e,i);this._vertexGraphics.push(n),this._internalGraphicsLayer.add(n)}_resetCreateOperationGraphics(){this._removeActiveFillGraphic(),this._removeLineGraphic(),this._removeActiveLineGraphic(),this._removeVertexGraphics(),this._removeCloneGraphics()}_removeCreateGraphic(){this.createGraphic&&(this._internalGraphicsLayer.remove(this.createGraphic),this._set("createGraphic",null))}_removeCreateOperationGraphics(){this._removeCenterIndicatorGraphic(),this._removeActiveLineGraphic(),this._removeActiveFillGraphic(),this._removeLineGraphic(),this._removeVertexGraphics()}_removeActiveLineGraphic(){this._activeLineGraphic&&(this._internalGraphicsLayer.remove(this._activeLineGraphic),this._activeLineGraphic.destroy(),this._activeLineGraphic=null)}_removeActiveFillGraphic(){this._activeFillGraphic&&(this._internalGraphicsLayer.remove(this._activeFillGraphic),this._activeFillGraphic.destroy(),this._activeFillGraphic=null)}_removeLineGraphic(){this._lineGraphic&&(this._internalGraphicsLayer.remove(this._lineGraphic),this._lineGraphic.destroy(),this._lineGraphic=null)}_removeVertexGraphics(){this._vertexGraphics.length&&(this._internalGraphicsLayer.removeMany(this._vertexGraphics),this._vertexGraphics.forEach(e=>e.destroy()),this._vertexGraphics=[])}_removeDefaultLayer(){this._internalGraphicsLayer&&(this.view&&this.view.map&&this.view.map.remove(this._internalGraphicsLayer),this._internalGraphicsLayer.destroy(),this._internalGraphicsLayer=null)}_operationHandleForCreateAction(e,t,i){return new yt({activeComponent:this._draw,tool:i,type:"create",onEnd:()=>{t.forEach(e=>e.remove()),t.length=0,this._removeCreateOperationGraphics(),this._internalGraphicsLayer&&this._internalGraphicsLayer.remove(this.createGraphic),this._displayDefaultCursor()},undo:()=>{e.undo(),this._emitUndoEvent({graphics:[this.createGraphic],tool:i})},redo:()=>{e.redo(),this._emitRedoEvent({graphics:[this.createGraphic],tool:i})},canUndo:()=>e&&e.canUndo(),canRedo:()=>e&&e.canRedo()})}_isComponentGraphic(e){const{activeComponent:t}=this;return!(!e||Object(S["j"])(t))&&(!(!e.attributes||!e.attributes.esriSketchTool)||("box"===t.type||"reshape"===t.type)&&t.isUIGraphic(e))}_snapLastPolygonVertexToFirst(e,t){if("polygon"!==e&&t.length<=2)return;const i=t[0],n=t[t.length-1],r=this.view.toScreen(new T["a"](i[0],i[1],this.view.spatialReference)),s=this.view.toScreen(new T["a"](n[0],n[1],this.view.spatialReference));this._isWithinScreenDistance(r,s,this._getVertexIntersectDistance())&&(n[0]=i[0],n[1]=i[1])}_getVertexIntersectDistance(){const e=3;return this.vertexSymbol&&"simple-marker"===this.vertexSymbol.type?Object(k["h"])(this.vertexSymbol.size)/2+e:e}_isWithinScreenDistance(e,t,i){const n=e.x-t.x,r=e.y-t.y;return Math.sqrt(n*n+r*r)<=i}_displayPointerCursor(){this.view&&this.view.container&&"pointer"!==this.view.cursor&&(this.view.cursor="pointer")}_displayGrabbingCursor(){this.view&&this.view.container&&"grabbing"!==this.view.cursor&&(this.view.cursor="grabbing")}_displayCrosshairCursor(){this.view&&this.view.container&&"crosshair"!==this.view.cursor&&(this.view.cursor="crosshair")}_displayDefaultCursor(){this.view&&this.view.container&&null!==this.view.cursor&&(this.view.cursor=null)}_logError(e,t,i){Ot.error(new P["a"](e,t,i))}async _requireModule(e){const t=new AbortController;this._moduleLoaderAbortController=t;const i=await e;return this._moduleLoaderAbortController!==t||t.signal.aborted?{requireError:"aborted"}:{module:i}}_emitUndoEvent(e){this.emit("undo",{...e,type:"undo"})}_emitRedoEvent(e){this.emit("redo",{...e,type:"redo"})}_emitDeleteEvent(e){this.emit("delete",{...e,type:"delete"})}createPointFromVertex(e){return e.length>2?new T["a"](e[0],e[1],e[2],this.view.spatialReference):new T["a"](e[0],e[1],this.view.spatialReference)}test(){return this._operationHandle}wait(){return Object(L["j"])(this,"updating")}_beginAsyncOperation(){this._numUpdating+=1,this.notifyChange("updating")}_endAsyncOperation(){this._numUpdating-=1,this.notifyChange("updating")}_disablePopupEnabled(e){var t;return"3d"!==(null==(t=this.view)?void 0:t.type)||this.updateOnGraphicClick||Object(S["k"])(e)&&e.toggleToolOnClick}_disablePopup(e){if(!this._disablePopupEnabled(e))return;const t=this.view.popup;t&&Object(S["j"])(this._originalAutoOpenEnabled)&&(this._originalAutoOpenEnabled=t.autoOpenEnabled,t.autoOpenEnabled=!1)}_restorePopup(e){if(!this._disablePopupEnabled(e))return;const t=this.view.popup;t&&Object(S["k"])(this._originalAutoOpenEnabled)&&(t.autoOpenEnabled=this._originalAutoOpenEnabled,this._originalAutoOpenEnabled=null)}async _waitViewReady(){this.view&&(Object(S["a"])(this._viewReadyAbortController),this._viewReadyAbortController=Object(C["e"])(),await Object(C["z"])(Object(L["k"])(this.view,"ready"),this._viewReadyAbortController.signal))}};function Pt(e,t){const i=e.history.undo.pop().updates,n=[];t.forEach((e,t)=>{const r=i[t],s={};null!=r&&(Object(S["k"])(r.geometry)&&(s.geometry=e.geometry,e.geometry=r.geometry),Object(S["k"])(r.symbol)&&(s.symbol=e.symbol,e.symbol=r.symbol),n.push(s))}),e.history.redo.push({updates:n})}function Ct(e,t){const i=e.history.redo.pop().updates,n=[];t.forEach((e,t)=>{const r=i[t],s={};null!=r&&(Object(S["k"])(r.geometry)&&(s.geometry=e.geometry,e.geometry=r.geometry),Object(S["k"])(r.symbol)&&(s.symbol=e.symbol,e.symbol=r.symbol),n.push(s))}),e.history.undo.push({updates:n})}function Tt(e){return{updates:e.map(e=>({geometry:e.geometry}))}}function Et(e){return{updates:e.map(e=>({symbol:e.symbol}))}}function At(e){return"requireError"in e&&"aborted"===e.requireError}Object(n["a"])([Object(s["b"])({readOnly:!0})],St.prototype,"_draw",null),Object(n["a"])([Object(s["b"])()],St.prototype,"updating",null),Object(n["a"])([Object(s["b"])()],St.prototype,"_operationHandle",void 0),Object(n["a"])([Object(s["b"])({readOnly:!0})],St.prototype,"activeTool",null),Object(n["a"])([Object(s["b"])()],St.prototype,"activeFillSymbol",void 0),Object(n["a"])([Object(s["b"])()],St.prototype,"activeLineSymbol",void 0),Object(n["a"])([Object(s["b"])()],St.prototype,"activeVertexSymbol",void 0),Object(n["a"])([Object(s["b"])({readOnly:!0})],St.prototype,"createGraphic",null),Object(n["a"])([Object(s["b"])()],St.prototype,"defaultCreateOptions",null),Object(n["a"])([Object(s["b"])()],St.prototype,"defaultUpdateOptions",null),Object(n["a"])([Object(s["b"])()],St.prototype,"layer",void 0),Object(n["a"])([Object(s["b"])({types:I["e"]})],St.prototype,"pointSymbol",void 0),Object(n["a"])([Object(s["b"])({types:I["e"]})],St.prototype,"polygonSymbol",void 0),Object(n["a"])([Object(s["b"])({types:I["e"]})],St.prototype,"polylineSymbol",void 0),Object(n["a"])([Object(s["b"])({type:w,nonNullable:!0})],St.prototype,"snappingOptions",null),Object(n["a"])([Object(s["b"])()],St.prototype,"_snappingManager",void 0),Object(n["a"])([Object(s["b"])({readOnly:!0})],St.prototype,"state",null),Object(n["a"])([Object(s["b"])({readOnly:!0})],St.prototype,"updateGraphics",void 0),Object(n["a"])([Object(s["b"])()],St.prototype,"updateOnGraphicClick",void 0),Object(n["a"])([Object(s["b"])({types:I["e"]})],St.prototype,"updatePointSymbol",void 0),Object(n["a"])([Object(s["b"])({types:I["e"]})],St.prototype,"updatePolygonSymbol",void 0),Object(n["a"])([Object(s["b"])({types:I["e"]})],St.prototype,"updatePolylineSymbol",void 0),Object(n["a"])([Object(s["b"])({types:I["e"]})],St.prototype,"vertexSymbol",void 0),Object(n["a"])([Object(s["b"])({value:null})],St.prototype,"view",null),Object(n["a"])([Object(s["b"])()],St.prototype,"cancel",null),Object(n["a"])([Object(s["b"])()],St.prototype,"complete",null),Object(n["a"])([Object(s["b"])()],St.prototype,"delete",null),Object(n["a"])([Object(s["b"])()],St.prototype,"create",null),Object(n["a"])([Object(s["b"])()],St.prototype,"update",null),Object(n["a"])([Object(s["b"])()],St.prototype,"undo",null),Object(n["a"])([Object(s["b"])()],St.prototype,"redo",null),Object(n["a"])([Object(s["b"])()],St.prototype,"canUndo",null),Object(n["a"])([Object(s["b"])()],St.prototype,"canRedo",null),Object(n["a"])([Object(s["b"])()],St.prototype,"toggleUpdateTool",null),St=Object(n["a"])([Object(c["a"])(_t)],St);var Mt=St,kt=Mt;async function Vt(){return Promise.all([i.e("chunk-2d22cf8c"),i.e("chunk-252f2cfc")]).then(i.bind(null,"00ac"))}async function Dt(){return Vt().then(({contains:e,intersects:t,overlaps:i,simplify:n})=>({contains:e,intersects:t,overlaps:i,simplify:n}))}async function Gt(e){const{selector:t,candidates:i,currentSelection:n,options:r,view:s}=e;if(!(i&&i.length&&n&&s))return{added:[],removed:[]};const{overlaps:o,intersects:a,contains:c}=r,{spatialReference:l}=s;if(!t)return{added:[],removed:n.removeAll()};const h=t,d=await Dt(),p=[],u=[];return i.forEach(e=>{const t=e.geometry,i=o&&!!d.overlaps(l,h,t),r=a&&!!d.intersects(l,h,t),s=c&&!!d.contains(l,h,t),f=n.includes(e);i||r||s?!f&&p.push(e):f&&u.push(e)}),n.removeMany(u),n.addMany(p),{added:p,removed:u}}let It=class extends A["a"].EventedAccessor{constructor(e){super(),this._activeOptions=null,this._dashedFillSymbol=new D["a"]({color:[0,0,0,0],outline:{style:"dash",color:[12,207,255],width:2}}),this._dashedLineSymbol=new V["a"]({style:"dash",color:[12,207,255],width:2}),this._defaultOptions={tool:"rectangle",createOptions:null,selectionOptions:{overlaps:!0,intersects:!0,contains:!1}},this._completed=!1,this._handles=new z["a"],this._sketchViewModel=new kt,this._sketchGraphicsLayer=new U["a"]({listMode:"hide",internal:!0}),this._transparentPointSymbol=new G["a"]({color:[0,0,0,0],outline:{style:"none",width:0}}),this.candidates=null,this.geometry=null,this.options=null,this.selection=new h["a"],this.view=null,this.candidates=e.candidates,this.options=e.options,this.view=e.view;const{_dashedFillSymbol:t,_dashedLineSymbol:i,_sketchViewModel:n,_sketchGraphicsLayer:r,_transparentPointSymbol:s}=this;n.set({layer:r,view:this.view,activePointSymbol:s,activeLineSymbol:i,activeVertexSymbol:s,activeFillSymbol:t,pointSymbol:s,polygonSymbol:t,polylineSymbol:i,vertexSymbol:s}),this._handles.add([n.on("create",e=>this._onSketchEvent(e)),n.on(["undo","redo"],e=>this._onSketchEvent(e))])}initialize(){this._load()}destroy(){this._handles.destroy(),this._handles=null}get state(){const{_completed:e,_sketchViewModel:{state:t}}=this;return e?"complete":"active"===t?"active":"disabled"}cancel(){this._sketchViewModel.cancel()}async _load(){await this.view.whenReady();const{options:e}=this,{tool:t,createOptions:i}=this._activeOptions={...this._defaultOptions,...e};this._sketchViewModel.create(t,i)}_onSketchEvent(e){const t="create"===e.type?e.graphic:e.graphics[0],i=(null==t?void 0:t.geometry)||null,n="create"===e.type&&"cancel"===e.state,r="create"===e.type&&"complete"===e.state;this._processSelectionGeometry(i,r,n)}_processSelectionGeometry(e,t,i){if(this._set("geometry",e),(t||i)&&(this._completed=!0),i)return void this._onComplete([],!0);const{_activeOptions:n,candidates:r,selection:s,view:o}=this;Gt({selector:e,candidates:r,currentSelection:s,options:n.selectionOptions,view:o}).then(({added:e,removed:i})=>{t?this._onComplete(this.selection.toArray(),!1):(e.length||i.length)&&this.emit("selection-change",{added:e,removed:i,type:"selection-change"})})}_onComplete(e,t){this._handles.removeAll(),this.notifyChange("state"),this.emit("complete",{aborted:t,selection:e,type:"complete"})}};Object(n["a"])([Object(s["b"])()],It.prototype,"_completed",void 0),Object(n["a"])([Object(s["b"])()],It.prototype,"candidates",void 0),Object(n["a"])([Object(s["b"])({readOnly:!0})],It.prototype,"geometry",void 0),Object(n["a"])([Object(s["b"])()],It.prototype,"options",void 0),Object(n["a"])([Object(s["b"])({readOnly:!0})],It.prototype,"selection",void 0),Object(n["a"])([Object(s["b"])({readOnly:!0})],It.prototype,"state",null),Object(n["a"])([Object(s["b"])({value:null})],It.prototype,"view",void 0),It=Object(n["a"])([Object(c["a"])("esri.widgets.support.Selector")],It);var Rt=It,zt=Rt;let Lt=class extends(Object(ze["b"])(m["a"])){constructor(e){super(e),this._defaultSelectionOptions={intersects:!0,overlaps:!0,contains:!0},this.candidates=null,this.options=null,this.view=null}draw(e){const{_defaultSelectionOptions:t,candidates:i,options:n,view:r}=this,s={...t,...n,...null==e?void 0:e.selectionOptions};return new zt({candidates:i,options:{...e,selectionOptions:s},view:r})}async selectionFrom(e,t){const{_defaultSelectionOptions:i,candidates:n,options:r,view:s}=this,o=new h["a"],a={...i,...r,...t};return await Gt({selector:e,candidates:n,currentSelection:o,options:a,view:s}),o.toArray()}};Object(n["a"])([Object(s["b"])()],Lt.prototype,"candidates",void 0),Object(n["a"])([Object(s["b"])()],Lt.prototype,"options",void 0),Object(n["a"])([Object(s["b"])({value:null})],Lt.prototype,"view",void 0),Lt=Object(n["a"])([Object(c["a"])("esri.widgets.support.Selector")],Lt);var Ht=Lt,Ut=Ht;const Ft={base:"esri-sketch",verticalLayout:"esri-sketch--vertical",panel:"esri-sketch__panel",infoPanel:"esri-sketch__info-panel",section:"esri-sketch__section",toolSection:"esri-sketch__tool-section",infoSection:"esri-sketch__info-section",infoCountSection:"esri-sketch__info-count-section",menuContainer:"esri-sketch__menu-container",menuHeader:"esri-sketch__menu-header",menuTitle:"esri-sketch__menu-title",menuContent:"esri-sketch__menu-content",menuItem:"esri-sketch__menu-item",menuItemWrapper:"esri-sketch__menu-item-wrapper",featureCountBadge:"esri-sketch__feature-count-badge",featureCountText:"esri-sketch__feature-count-text",featureCountNumber:"esri-sketch__feature-count-number",button:"esri-sketch__button",selectedButton:"esri-sketch__button--selected",pointIcon:"esri-icon-map-pin",polygonIcon:"esri-icon-polygon",polylineIcon:"esri-icon-polyline",circleIcon:"esri-icon-radio-unchecked",rectangleIcon:"esri-icon-checkbox-unchecked",cursorIcon:"esri-icon-cursor",resetIcon:"esri-icon-trash",undoIcon:"esri-icon-undo",redoIcon:"esri-icon-redo",settingsIcon:"esri-icon-settings",actionToggle:"esri-sketch__action-toggle",actionToggleOn:"esri-sketch__action-toggle--on",actionTitle:"esri-sketch__item-action-title",actionIcon:"esri-sketch__item-action-icon",rectangleSelectIcon:"esri-icon-cursor-marquee",lassoSelectIcon:"esri-icon-lasso",disabled:"esri-disabled",esriWidget:"esri-widget",rotating:"esri-rotating",widgetIcon:"esri-icon-edit"},qt={createTools:{point:!0,polyline:!0,polygon:!0,rectangle:!0,circle:!0},selectionTools:{"rectangle-selection":!0,"lasso-selection":!0},undoRedoMenu:!0,settingsMenu:!0};let Nt=class extends g["a"]{constructor(e,t){super(e,t),this._activeCreateOptions=null,this._activeSelectionInfo=null,this._menuOpen=!1,this._selector=new Ut,this.availableCreateTools=["point","polyline","polygon","rectangle","circle"],this.createGraphic=null,this.creationMode="continuous",this.defaultCreateOptions=null,this.defaultUpdateOptions=null,this.iconClass=Ft.widgetIcon,this.label=void 0,this.layer=null,this.messages=null,this.snappingOptions=new w,this.updateGraphics=new h["a"],this.view=null,this.viewModel=new kt,this.visibleElements={...qt},this._activateCreateTool=this._activateCreateTool.bind(this)}initialize(){const{view:e}=this;this._selector.view=e,this.own([this.viewModel.on("create",()=>this.scheduleRender()),this.viewModel.on("update",()=>this.scheduleRender()),this.viewModel.on("create",e=>this._onCreateOperation(e)),this.viewModel.on("delete",e=>this.emit("delete",e)),this.viewModel.on("undo",()=>this.scheduleRender()),this.viewModel.on("redo",()=>this.scheduleRender()),this.viewModel.watch("view",e=>this._selector.set({view:e})),this.viewModel.watch("state",()=>this.notifyChange("state"))])}get activeTool(){var e;return(null==(e=this._activeSelectionInfo)?void 0:e.tool)||this.viewModel.activeTool}set layout(e){"vertical"!==e&&(e="horizontal"),this._set("layout",e)}get state(){return this._activeSelectionInfo?"active":this.viewModel.state}castVisibleElements(e){return{...qt,...e,createTools:{...qt.createTools,...null==e?void 0:e.createTools},selectionTools:{...qt.selectionTools,...null==e?void 0:e.selectionTools}}}create(e,t){this._activeCreateOptions=t||null,this.viewModel.create(e,t)}update(e,t){return this.viewModel.update(e,t)}complete(){}cancel(){this._cancelSelectionOperation(),this.viewModel.cancel()}undo(){}redo(){}delete(){}render(){const{label:e,layout:t,viewModel:{state:i}}=this;return Object(b["a"])("div",{"aria-label":e,class:this.classes(Ft.base,Ft.esriWidget,{[Ft.disabled]:"disabled"===i,[Ft.verticalLayout]:"vertical"===t})},Object(b["a"])("div",{role:"toolbar",class:Ft.panel},this.renderTopPanelContents()),Object(b["a"])("div",{class:this.classes(Ft.panel,Ft.infoPanel)},this.renderInfoPanelContents()))}renderTopPanelContents(){const e=this.classes(Ft.section,Ft.toolSection),{availableCreateTools:t,visibleElements:i}=this;return[Object(b["a"])("div",{role:"menu",key:"selection-button-container",class:e},this.renderSelectionTools()),t&&t.length?Object(b["a"])("div",{role:"menu",class:e},this.renderDrawButtons()):null,i.undoRedoMenu?Object(b["a"])("div",{role:"menu",key:"undo-redo-menu-button-container",class:e},this.renderUndoRedoMenuButtons()):null,i.settingsMenu?Object(b["a"])("div",{key:"settings-menu-button-container",class:Ft.section},this.renderSettingsMenuButton()):null]}renderInfoPanelContents(){return this._menuOpen?this.renderSettingsMenu():this.updateGraphics.length?[Object(b["a"])("div",{class:this.classes(Ft.section,Ft.infoSection,Ft.infoCountSection),key:"feature-count-container"},this.renderFeatureCount()),Object(b["a"])("div",{class:this.classes(Ft.section,Ft.infoSection),key:"delete-button-container"},this.renderDeleteButton())]:void 0}renderSettingsMenu(){const{settings:e}=this.messages;return[Object(b["a"])("div",{role:"menu",class:Ft.menuContainer,key:"settings-menu-container"},Object(b["a"])("header",{class:Ft.menuHeader,key:"settings-menu-header"},Object(b["a"])("span",{class:Ft.menuTitle},e)),Object(b["a"])("div",{class:Ft.menuContent,key:"settings-menu-content","aria-label":e},Object(b["a"])("div",{class:Ft.menuItemWrapper},this.renderSnappingToggleMenuItem())))]}renderSnappingToggleMenuItem(){var e;return Object(b["a"])("div",{class:Ft.menuItem,"aria-label":null==(e=this.messages)?void 0:e.snappingEnabled,key:"sketch-snapping-action-toggle",role:"menuitem"},this.renderSnappingToggle())}renderSnappingToggle(){const{messages:{snappingEnabled:e},viewModel:{snappingOptions:{enabled:t}}}=this,i=this.classes(Ft.actionToggle,{[Ft.actionToggleOn]:t});return Object(b["a"])("div",{bind:this,role:"button",onclick:this._onSnappingToggleClick,onkeydown:this._onSnappingToggleKeyDown,class:i,tabindex:"0",title:e,"aria-label":e},this.renderActionIcon(),Object(b["a"])("span",{class:Ft.actionTitle},e))}_onSnappingToggleKeyDown(e){const t=Object(l["a"])(e);"Enter"!==t&&" "!==t||(e.preventDefault(),this._toggleSnapping())}_onSnappingToggleClick(e){e.stopPropagation(),this._toggleSnapping()}renderActionIcon(){return Object(b["a"])("span",{key:"action-icon","aria-hidden":"true",class:this.classes(Ft.actionIcon)})}renderFeatureCount(){const{layout:e,messages:t,updateGraphics:{length:i}}=this,n=Object(d["a"])(1===i?t.featureCount:t.featuresCount,{count:i});return Object(b["a"])("div",{class:Ft.featureCountBadge,"aria-label":n},Object(b["a"])("span",{class:Ft.featureCountNumber},"vertical"===e?i:n))}renderDeleteButton(){const e=this.messages.deleteFeature;return Object(b["a"])("button",{"aria-label":e,bind:this,class:this.classes(Ft.button,Ft.resetIcon),onclick:this.delete,title:e,type:"button"})}renderSelectionTools(){return[this.renderDefaultSelectionButton(),this.renderRectangleSelectionButton(),this.renderLassoSelectionButton()]}renderDefaultSelectionButton(){if(!this.viewModel.updateOnGraphicClick)return;const e=this.messages.selectFeature;return Object(b["a"])("button",{"aria-label":e,bind:this,class:this.classes(Ft.button,Ft.cursorIcon,{[Ft.selectedButton]:"ready"===this.state}),onclick:this.cancel,role:"menuitemradio",title:e})}renderRectangleSelectionButton(){var e,t;if("2d"!==(null==(e=this.view)?void 0:e.type)||!this.visibleElements.selectionTools["rectangle-selection"])return;const i=this.messages.selectRectangle;return Object(b["a"])("button",{"aria-label":i,bind:this,class:this.classes(Ft.button,Ft.rectangleSelectIcon,{[Ft.selectedButton]:"rectangle-selection"===(null==(t=this._activeSelectionInfo)?void 0:t.tool)}),onclick:this._activateRectangleSelectTool,role:"menuitemradio",title:i})}renderLassoSelectionButton(){var e,t;if("2d"!==(null==(e=this.view)?void 0:e.type)||!this.visibleElements.selectionTools["lasso-selection"])return;const i=this.messages.selectLasso;return Object(b["a"])("button",{"aria-label":i,bind:this,class:this.classes(Ft.button,Ft.lassoSelectIcon,{[Ft.selectedButton]:"lasso-selection"===(null==(t=this._activeSelectionInfo)?void 0:t.tool)}),onclick:this._activateLassoSelectTool,role:"menuitemradio",title:i})}renderDrawButtons(){const e=this.visibleElements.createTools;return this.availableCreateTools.map(t=>"point"===t&&e.point?this.renderPointButton():"polyline"===t&&e.polyline?this.renderPolylineButton():"polygon"===t&&e.polygon?this.renderPolygonButton():"rectangle"===t&&e.rectangle?this.renderRectangleButton():"circle"===t&&e.circle?this.renderCircleButton():void 0)}renderPointButton(){const e="point",t=this.messages.drawPoint,i=[Ft.button,Ft.pointIcon];return this.activeTool===e&&i.push(Ft.selectedButton),Object(b["a"])("button",{"aria-label":t,bind:this,class:this.classes(i),"data-tool-name":e,onclick:this._activateCreateTool,role:"menuitemradio",title:t,type:"button"})}renderPolygonButton(){const e="polygon",t=this.messages.drawPolygon,i=[Ft.button,Ft.polygonIcon];return this.activeTool===e&&i.push(Ft.selectedButton),Object(b["a"])("button",{"aria-label":t,bind:this,class:this.classes(i),"data-tool-name":e,onclick:this._activateCreateTool,role:"menuitemradio",title:t,type:"button"})}renderPolylineButton(){const e="polyline",t=this.messages.drawPolyline,i=[Ft.button,Ft.polylineIcon];return this.activeTool===e&&i.push(Ft.selectedButton),Object(b["a"])("button",{"aria-label":t,bind:this,class:this.classes(i),"data-tool-name":e,onclick:this._activateCreateTool,role:"menuitemradio",title:t,type:"button"})}renderCircleButton(){const e="circle",t=this.messages.drawCircle,i=[Ft.button,Ft.circleIcon];return this.activeTool===e&&i.push(Ft.selectedButton),Object(b["a"])("button",{"aria-label":t,bind:this,class:this.classes(i),"data-tool-name":e,onclick:this._activateCreateTool,role:"menuitemradio",title:t,type:"button"})}renderRectangleButton(){const e="rectangle",t=this.messages.drawRectangle,i=[Ft.button,Ft.rectangleIcon];return this.activeTool===e&&i.push(Ft.selectedButton),Object(b["a"])("button",{"aria-label":t,bind:this,class:this.classes(i),"data-tool-name":e,onclick:this._activateCreateTool,role:"menuitemradio",title:t,type:"button"})}renderUndoRedoMenuButtons(){return[this.renderUndoButton(),this.renderRedoButton()]}renderUndoButton(){const e=this.messages.undo,t=!this.viewModel.canUndo(),i=Object(p["f"])()?Ft.redoIcon:Ft.undoIcon;return Object(b["a"])("button",{"aria-label":e,bind:this,class:this.classes(Ft.button,i),disabled:t,onclick:this.undo,title:e,type:"button"})}renderRedoButton(){const e=this.messages.redo,t=!this.viewModel.canRedo(),i=Object(p["f"])()?Ft.undoIcon:Ft.redoIcon;return Object(b["a"])("button",{"aria-label":e,bind:this,class:this.classes(Ft.button,i),disabled:t,onclick:this.redo,title:e,type:"button"})}renderSettingsMenuButton(){const e=this.messages.settings,t=[Ft.button,Ft.settingsIcon];return this._menuOpen&&t.push(Ft.selectedButton),Object(b["a"])("button",{"aria-label":e,bind:this,class:this.classes(t),onclick:this._toggleMenu,title:e,type:"button"})}_cancelSelectionOperation(){var e,t;null==(e=this._activeSelectionInfo)||null==(t=e.operation)||t.cancel(),this._activeSelectionInfo=null,this._selector.candidates=null}_activateCreateTool(e){const t=e.target.getAttribute("data-tool-name");this.activeTool!==t?(this._activeSelectionInfo&&this._cancelSelectionOperation(),this.create(t)):this.cancel()}_onCreateOperation(e){if("complete"!==e.state)return;const{creationMode:t}=this,{type:i}=e;if("create"===i){const{tool:i,graphic:n}=e,r=this._activeCreateOptions;this._activeCreateOptions=null,"continuous"===t?this.create(i,r):"update"===t&&this.update([n])}}_toggleMenu(){this._menuOpen=!this._menuOpen,this.scheduleRender()}_toggleSnapping(){const{viewModel:{snappingOptions:e}}=this;this.viewModel.snappingOptions.enabled=!e.enabled,this.scheduleRender()}_onSelectionOperationComplete(e){const{viewModel:{defaultUpdateOptions:t}}=this,{selection:i}=e;if(this._activeSelectionInfo=null,!e.aborted&&i.length){const e=t.tool,n=i.length>1&&"reshape"===e?"transform":e;this.update(i,{...t,tool:n})}this.notifyChange("state")}_activateRectangleSelectTool(){if(this._activeSelectionInfo){const e=this._activeSelectionInfo.tool;if(this._cancelSelectionOperation(),"rectangle-selection"===e)return}else"active"===this.state&&this.cancel();this._selector.candidates=this._getSelectionCandidates();const e=this._selector.draw({tool:"rectangle"});e.once("complete",e=>this._onSelectionOperationComplete(e)),this._activeSelectionInfo={tool:"rectangle-selection",operation:e}}_activateLassoSelectTool(){if(this._activeSelectionInfo){const e=this._activeSelectionInfo.tool;if(this._cancelSelectionOperation(),"lasso-selection"===e)return}else"active"===this.state&&this.cancel();this._selector.candidates=this._getSelectionCandidates();const e=this._selector.draw({tool:"polygon",createOptions:{mode:"freehand"}});e.once("complete",e=>this._onSelectionOperationComplete(e)),this._activeSelectionInfo={tool:"lasso-selection",operation:e}}_getSelectionCandidates(){var e,t;return(null==(e=this.layer)||null==(t=e.graphics)?void 0:t.toArray())||[]}};Object(n["a"])([Object(s["b"])()],Nt.prototype,"_activeSelectionInfo",void 0),Object(n["a"])([Object(s["b"])()],Nt.prototype,"activeTool",null),Object(n["a"])([Object(s["b"])({cast:e=>{if(!e||!e.length)return null;const t=new Set(["point","polyline","polygon","rectangle","circle"]);return e.filter(e=>t.has(e))}})],Nt.prototype,"availableCreateTools",void 0),Object(n["a"])([Object(o["a"])("viewModel.createGraphic")],Nt.prototype,"createGraphic",void 0),Object(n["a"])([Object(s["b"])()],Nt.prototype,"creationMode",void 0),Object(n["a"])([Object(o["a"])("viewModel.defaultCreateOptions")],Nt.prototype,"defaultCreateOptions",void 0),Object(n["a"])([Object(o["a"])("viewModel.defaultUpdateOptions")],Nt.prototype,"defaultUpdateOptions",void 0),Object(n["a"])([Object(s["b"])()],Nt.prototype,"iconClass",void 0),Object(n["a"])([Object(s["b"])({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Nt.prototype,"label",void 0),Object(n["a"])([Object(o["a"])("viewModel.layer")],Nt.prototype,"layer",void 0),Object(n["a"])([Object(s["b"])({value:"horizontal"})],Nt.prototype,"layout",null),Object(n["a"])([Object(s["b"])(),Object(u["a"])("esri/widgets/Sketch/t9n/Sketch")],Nt.prototype,"messages",void 0),Object(n["a"])([Object(o["a"])("viewModel.snappingOptions")],Nt.prototype,"snappingOptions",void 0),Object(n["a"])([Object(s["b"])()],Nt.prototype,"state",null),Object(n["a"])([Object(o["a"])("viewModel.updateGraphics")],Nt.prototype,"updateGraphics",void 0),Object(n["a"])([Object(o["a"])("viewModel.view")],Nt.prototype,"view",void 0),Object(n["a"])([Object(s["b"])(),Object(f["a"])(["create","update","undo","redo"])],Nt.prototype,"viewModel",void 0),Object(n["a"])([Object(s["b"])()],Nt.prototype,"visibleElements",void 0),Object(n["a"])([Object(a["a"])("visibleElements")],Nt.prototype,"castVisibleElements",null),Object(n["a"])([Object(o["a"])("viewModel.complete")],Nt.prototype,"complete",null),Object(n["a"])([Object(o["a"])("viewModel.undo")],Nt.prototype,"undo",null),Object(n["a"])([Object(o["a"])("viewModel.redo")],Nt.prototype,"redo",null),Object(n["a"])([Object(o["a"])("viewModel.delete")],Nt.prototype,"delete",null),Nt=Object(n["a"])([Object(c["a"])("esri.widgets.Sketch")],Nt);var Bt=Nt;t["a"]=Bt},9617:function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return s}));var n=i("3886"),r=i("d047");function s(e){e.include(r["a"]),e.uniforms.add("geometryDepthTexture","sampler2D"),e.uniforms.add("cameraNearFar","vec2"),e.code.add(n["a"]`
    //Compare the linearized depths of the vertex/fragment and the geometry in the scene. If vertex/fragment is behind geometry, don't draw it.
    bool geometryDepthTest(vec2 pos, float elementDepth){

      float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos, cameraNearFar);
      if(elementDepth < (geometryDepth - 1.0)){
        return true;
      }
      return false;
    }
  `)}function o(e,t,i){i.multipassGeometryEnabled&&i.geometryLinearDepthTexture&&(e.setUniform1i("geometryDepthTexture",11),t.bindTexture(i.geometryLinearDepthTexture,11))}},"99af":function(e,t,i){"use strict";var n=i("23e7"),r=i("d039"),s=i("e8b5"),o=i("861d"),a=i("7b0b"),c=i("50c4"),l=i("8418"),h=i("65f0"),d=i("1dde"),p=i("b622"),u=i("2d00"),f=p("isConcatSpreadable"),b=9007199254740991,g="Maximum allowed index exceeded",m=u>=51||!r((function(){var e=[];return e[f]=!1,e.concat()[0]!==e})),v=d("concat"),y=function(e){if(!o(e))return!1;var t=e[f];return void 0!==t?!!t:s(e)},_=!m||!v;n({target:"Array",proto:!0,forced:_},{concat:function(e){var t,i,n,r,s,o=a(this),d=h(o,0),p=0;for(t=-1,n=arguments.length;t<n;t++)if(s=-1===t?o:arguments[t],y(s)){if(r=c(s.length),p+r>b)throw TypeError(g);for(i=0;i<r;i++,p++)i in s&&l(d,p,s[i])}else{if(p>=b)throw TypeError(g);l(d,p++,s)}return d.length=p,d}})},"9a68":function(e,t,i){"use strict";i.d(t,"a",(function(){return b})),i.d(t,"b",(function(){return f}));var n=i("3886"),r=i("690a"),s=i("4377"),o=i("d272"),a=i("d047"),c=i("ebd5"),l=i("c6d7"),h=i("e6aa"),d=i("c2d1"),p=i("6750"),u=i("c51b");function f(e){const t=new r["a"];t.extensions.add("GL_OES_standard_derivatives"),t.include(u["a"]),t.include(h["a"],e),t.include(p["a"],e),1===e.output&&t.include(d["a"],e),t.vertex.uniforms.add("proj","mat4").add("view","mat4").add("cameraNearFar","vec2").add("pixelRatio","float").add("miterLimit","float").add("screenSize","vec2"),t.attributes.add("position","vec3"),t.attributes.add("subdivisionFactor","float"),t.attributes.add("uv0","vec2"),t.attributes.add("auxpos1","vec3"),t.attributes.add("auxpos2","vec3"),t.varyings.add("vColor","vec4"),t.varyings.add("vpos","vec3"),t.varyings.add("linearDepth","float"),e.multipassTerrainEnabled&&t.varyings.add("depth","float");const i=e.falloffEnabled,f=e.innerColorEnabled;return f&&t.varyings.add("vLineDistance","float"),i&&t.varyings.add("vLineDistanceNorm","float"),e.falloffEnabled&&t.fragment.uniforms.add("falloff","float"),e.innerColorEnabled&&(t.fragment.uniforms.add("innerColor","vec4"),t.fragment.uniforms.add("innerWidth","float")),t.vertex.code.add(n["a"]`
		#define PERPENDICULAR(v) vec2(v.y, -v.x);
		#define ISOUTSIDE (left.x * right.y - left.y * right.x)*uv0.y > 0.0

		float interp(float ncp, vec4 a, vec4 b) {
			return (-ncp - a.z) / (b.z - a.z);
		}

		vec2 rotate(vec2 v, float a) {
			float s = sin(a);
			float c = cos(a);
			mat2 m = mat2(c, -s, s, c);
			return m * v;
		}
`),t.vertex.code.add(n["a"]`
    vec4 projectAndScale(vec4 pos) {
      vec4 posNdc = proj * pos;

      // Note that posNdc is in -1:1, scaling by screenSize converts this to a coordinate system
      // that is twice scaled (going from -size:size).
      posNdc.xy *= screenSize / posNdc.w;
      return posNdc;
    }
`),t.vertex.code.add(n["a"]`
    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {
      float vnp = cameraNearFar[0] * 0.99;

      //current pos behind ncp --> we need to clip
      if(pos.z > -cameraNearFar[0]) {
        if (!isStartVertex) {
          //previous in front of ncp
          if(prev.z < -cameraNearFar[0]) {
            pos = mix(prev, pos, interp(vnp, prev, pos));
            next = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
        //next in front of ncp
        if(isStartVertex) {
          if(next.z < -cameraNearFar[0]) {
            pos = mix(pos, next, interp(vnp, pos, next));
            prev = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
      } else {
        //current position visible
        //previous behind ncp
        if (prev.z > -cameraNearFar[0]) {
          prev = mix(pos, prev, interp(vnp, pos, prev));
        }
        //next behind ncp
        if (next.z > -cameraNearFar[0]) {
          next = mix(next, pos, interp(vnp, next, pos));
        }
      }

      ${e.multipassTerrainEnabled?"depth = pos.z;":""}
      linearDepth = (-pos.z - cameraNearFar[0]) / (cameraNearFar[1] - cameraNearFar[0]);

      pos = projectAndScale(pos);
      next = projectAndScale(next);
      prev = projectAndScale(prev);
    }
`),t.vertex.code.add(n["a"]`
  void main(void) {
    float coverage = 1.0;
    vpos = position;

    // Check for special value of uv0.y which is used by the Renderer when graphics
    // are removed before the VBO is recompacted. If this is the case, then we just
    // project outside of clip space.
    if (uv0.y == 0.0) {
      // Project out of clip space
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
    }
    else {
      bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;
      bool isJoin = abs(uv0.y)-3.0 < 0.0;

      float lineWidth = getSize() * pixelRatio;

      // convert sub-pixel coverage to alpha
      if (lineWidth < 1.0) {
        coverage = lineWidth;
        lineWidth = 1.0;
      }else{
        // Ribbon lines cannot properly render non-integer sizes. Round width to integer size if
        // larger than one for better quality. Note that we do render < 1 pixels more or less correctly
        // so we only really care to round anything larger than 1.
        lineWidth = floor(lineWidth + 0.5);
      }

      vec4 pos  = view * vec4(position.xyz, 1.0);
      vec4 prev = view * vec4(auxpos1.xyz, 1.0);
      vec4 next = view * vec4(auxpos2.xyz, 1.0);

      clipAndTransform(pos, prev, next, isStartVertex);

      vec2 left = (pos.xy - prev.xy);
      vec2 right = (next.xy - pos.xy);

      float leftLen = length(left);
      float rightLen = length(right);
  `),e.stippleEnabled&&t.vertex.code.add(n["a"]`
      // uv0.x is either 0 or 1, depending on whether this is considered the start of a line segment
      // or the end. If start, then use pos->next, otherwise use prev->pos to define the line segment
      // vector
      vec4 stippleSegmentInfo = mix(vec4(pos.xy, right), vec4(prev.xy, left), uv0.x);
      vec2 stippleSegmentOrigin = stippleSegmentInfo.xy;

      // Scale s.t. it's in units of stipple pattern size.
      vec2 stippleSegmentDirection = stippleSegmentInfo.zw;
    `),t.vertex.code.add(n["a"]`
    left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
    right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);

    vec2 capDisplacementDir = vec2(0, 0);
    vec2 joinDisplacementDir = vec2(0, 0);
    float displacementLen = lineWidth;

    if (isJoin) {

      // JOIN handling ---------------------------------------------------
      // determine if vertex is on the "outside or "inside" of the join
      bool isOutside = ISOUTSIDE;

      // compute miter join position first
      joinDisplacementDir = normalize(left + right);
      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);

      // compute miter stretch
      if (leftLen > 0.001 && rightLen > 0.001) {
        float nDotSeg = dot(joinDisplacementDir, left);
        displacementLen /= length(nDotSeg * left - joinDisplacementDir);

        // limit displacement of inner vertices
        if (!isOutside) {
          displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
        }
      }

      if (isOutside && (displacementLen > miterLimit * lineWidth)) {
    `),e.roundJoins?t.vertex.code.add(n["a"]`
        vec2 startDir;
        vec2 endDir;

        if (leftLen < 0.001) {
          startDir = right;
        }
        else{
          startDir = left;
        }
        startDir = normalize(startDir);
        startDir = PERPENDICULAR(startDir);

        if (rightLen < 0.001) {
          endDir = left;
        }
        else{
          endDir = right;
        }
        endDir = normalize(endDir);
        endDir = PERPENDICULAR(endDir);

        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * subdivisionFactor * rotationAngle);
      `):t.vertex.code.add(n["a"]`
        // convert to bevel join if miterLimit is exceeded
        if (leftLen < 0.001) {
          joinDisplacementDir = right;
        }
        else if (rightLen < 0.001) {
          joinDisplacementDir = left;
        }
        else {
          joinDisplacementDir = isStartVertex ? right : left;
        }
        joinDisplacementDir = normalize(joinDisplacementDir);
        joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
  `),t.vertex.code.add(n["a"]`
        displacementLen = lineWidth;
      }
    } else {
    // CAP handling ---------------------------------------------------
    if (leftLen < 0.001) {
      joinDisplacementDir = right;
    }
    else if (rightLen < 0.001) {
      joinDisplacementDir = left;
    }
    else {
      joinDisplacementDir = isStartVertex ? right : left;
    }
    joinDisplacementDir = normalize(joinDisplacementDir);
    joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
    displacementLen = lineWidth;

    capDisplacementDir = isStartVertex ? -right : left;
  `),e.roundCaps?t.vertex.code.add(n["a"]`
    float angle = subdivisionFactor*PI*0.5;
    joinDisplacementDir *= cos(angle);
    capDisplacementDir *= sin(angle);
    `):t.vertex.code.add(n["a"]`
    capDisplacementDir *= subdivisionFactor;
    `),t.vertex.code.add(n["a"]`
  }

  // Displacement (in pixels) caused by join/or cap
  vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;

  ${i||f?n["a"]`float lineDist = lineWidth * sign(uv0.y) * pos.w;`:""}

  ${f?n["a"]`vLineDistance = lineDist;`:""}
  ${i?n["a"]`vLineDistanceNorm = lineDist / lineWidth;`:""}

  pos.xy += dpos;
  `),e.stippleEnabled&&(t.vertex.code.add(n["a"]`
    {
      // Compute the stipple pattern UV coordinate from the actual position, based on the origin
      // and direction of the line segment on which the stipple pattern is based.

      // Project the vector from the origin of the segment to the vertex onto the line segment.
      // Note the 0.5 factor due to projected positions being at twice the screen size scale (see projectAndScale)
      vec2 posVec = pos.xy - stippleSegmentOrigin;

      float stippleSegmentDirectionLength = length(stippleSegmentDirection);
    `),e.stippleIntegerRepeatsEnabled&&t.vertex.code.add(n["a"]`
      float numberOfPatternRepeats = stippleSegmentDirectionLength * 0.5 * stipplePatternPixelSizeInv;
      float roundedNumberOfPatternRepeats = floor(numberOfPatternRepeats);
      stipplePatternUvMax = roundedNumberOfPatternRepeats;
      `),t.vertex.code.add(n["a"]`
      if (stippleSegmentDirectionLength >= 0.001) {
        // Project the vertex position onto the line segment.
        float projectedLength = dot(stippleSegmentDirection, posVec) / stippleSegmentDirectionLength * 0.5;
     ${e.stippleIntegerRepeatsEnabled?"float wholeNumberOfRepeatsScale = roundedNumberOfPatternRepeats / numberOfPatternRepeats;":"float wholeNumberOfRepeatsScale = 1.0;"}
        stipplePatternUv = projectedLength * wholeNumberOfRepeatsScale * stipplePatternPixelSizeInv * pos.w;
        } else {
          stipplePatternUv = 1.0;
        }
      }
    `)),t.vertex.code.add(n["a"]`
      // Convert back into NDC
      pos.xy = pos.xy / screenSize * pos.w;

      vColor = getColor();
      vColor.a *= coverage;

      gl_Position = pos;
    }
  }
  `),e.multipassTerrainEnabled&&(t.fragment.include(a["a"]),t.include(l["b"],e)),t.include(o["a"],e),t.fragment.uniforms.add("intrinsicColor","vec4"),t.fragment.include(s["a"]),t.fragment.code.add(n["a"]`
  void main() {
    discardBySlice(vpos);
    ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
    float stippleAlpha = getStippleAlpha();
    discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);

    vec4 color = intrinsicColor * vColor;
  `),e.innerColorEnabled&&(t.fragment.uniforms.add("pixelRatio","float"),t.fragment.code.add(n["a"]`
    float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;
    float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
    float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
    color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);
    `)),t.fragment.code.add(n["a"]`
    vec4 finalColor = blendStipple(color, stippleAlpha);
  `),e.falloffEnabled&&t.fragment.code.add(n["a"]`
    finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);
    `),t.fragment.code.add(n["a"]`
    if (finalColor.a < ${n["a"].float(c["c"])}) {
      discard;
    }

    ${7===e.output?n["a"]`gl_FragColor = vec4(finalColor.a);`:""}
    ${0===e.output?n["a"]`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${0===e.output&&e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
    ${4===e.output?n["a"]`gl_FragColor = vec4(1.0);`:""}
    ${1===e.output?n["a"]`outputDepth(linearDepth);`:""}
  }
  `),t}var b=Object.freeze({__proto__:null,build:f})},"9bdd":function(e,t,i){var n=i("825a"),r=i("2a62");e.exports=function(e,t,i,s){try{return s?t(n(i)[0],i[1]):t(i)}catch(o){throw r(e),o}}},"9e77":function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var n=i("3886"),r=i("d047"),s=i("58c2");function o(e,t){e.extensions.add("GL_OES_standard_derivatives"),e.fragment.include(r["a"]),e.include(s["a"]),e.fragment.uniforms.add("glowColor","vec3"),e.fragment.uniforms.add("glowWidth","float"),e.fragment.uniforms.add("glowFalloff","float"),e.fragment.uniforms.add("innerColor","vec3"),e.fragment.uniforms.add("innerWidth","float"),e.fragment.uniforms.add("depthMap","sampler2D"),e.fragment.uniforms.add("nearFar","vec2"),e.fragment.uniforms.add("frameColor","sampler2D"),t.contrastControlEnabled&&e.fragment.uniforms.add("globalAlphaContrastBoost","float"),e.fragment.code.add(n["a"]`
  vec4 blendPremultiplied(vec4 source, vec4 dest) {
    float oneMinusSourceAlpha = 1.0 - source.a;

    return vec4(
      source.rgb + dest.rgb * oneMinusSourceAlpha,
      source.a + dest.a * oneMinusSourceAlpha
    );
  }
  `),e.fragment.code.add(n["a"]`
  vec4 premultipliedColor(vec3 rgb, float alpha) {
    return vec4(rgb * alpha, alpha);
  }
  `),e.fragment.code.add(n["a"]`
  vec4 laserlineProfile(float dist) {
    if (dist > glowWidth) {
      return vec4(0.0);
    }

    float innerAlpha = (1.0 - smoothstep(0.0, innerWidth, dist));
    float glowAlpha = pow(max(0.0, 1.0 - dist / glowWidth), glowFalloff);

    return blendPremultiplied(
      premultipliedColor(innerColor, innerAlpha),
      premultipliedColor(glowColor, glowAlpha)
    );
  }
  `),e.fragment.code.add(n["a"]`
  bool laserlineReconstructFromDepth(out vec3 pos, out vec3 normal, out float depthDiscontinuityAlpha) {
    float depth = linearDepthFromTexture(depthMap, uv, nearFar);

    if (-depth == nearFar[0]) {
      return false;
    }

    pos = reconstructPosition(gl_FragCoord.xy, depth);
    normal = normalize(cross(dFdx(pos), dFdy(pos)));

    float ddepth = fwidth(depth);
    depthDiscontinuityAlpha = 1.0 - smoothstep(0.0, 0.01, -ddepth / depth);

    return true;
  }
  `),t.contrastControlEnabled?e.fragment.code.add(n["a"]`
    float rgbToLuminance(vec3 color) {
      return dot(vec3(0.2126, 0.7152, 0.0722), color);
    }

    vec4 laserlineOutput(vec4 color) {
      float backgroundLuminance = rgbToLuminance(texture2D(frameColor, uv).rgb);
      float alpha = clamp(globalAlpha * max(backgroundLuminance * globalAlphaContrastBoost, 1.0), 0.0, 1.0);

      return color * alpha;
    }
    `):e.fragment.code.add(n["a"]`
    vec4 laserlineOutput(vec4 color) {
      return color * globalAlpha;
    }
    `)}},a15b:function(e,t,i){"use strict";var n=i("23e7"),r=i("44ad"),s=i("fc6a"),o=i("a640"),a=[].join,c=r!=Object,l=o("join",",");n({target:"Array",proto:!0,forced:c||!l},{join:function(e){return a.call(s(this),void 0===e?",":e)}})},a4d3:function(e,t,i){"use strict";var n=i("23e7"),r=i("da84"),s=i("d066"),o=i("c430"),a=i("83ab"),c=i("4930"),l=i("fdbf"),h=i("d039"),d=i("5135"),p=i("e8b5"),u=i("861d"),f=i("825a"),b=i("7b0b"),g=i("fc6a"),m=i("c04e"),v=i("5c6c"),y=i("7c73"),_=i("df75"),O=i("241c"),j=i("057f"),x=i("7418"),w=i("06cf"),S=i("9bf2"),P=i("d1e7"),C=i("9112"),T=i("6eeb"),E=i("5692"),A=i("f772"),M=i("d012"),k=i("90e3"),V=i("b622"),D=i("e538"),G=i("746f"),I=i("d44e"),R=i("69f3"),z=i("b727").forEach,L=A("hidden"),H="Symbol",U="prototype",F=V("toPrimitive"),q=R.set,N=R.getterFor(H),B=Object[U],W=r.Symbol,Z=s("JSON","stringify"),K=w.f,$=S.f,X=j.f,Y=P.f,J=E("symbols"),Q=E("op-symbols"),ee=E("string-to-symbol-registry"),te=E("symbol-to-string-registry"),ie=E("wks"),ne=r.QObject,re=!ne||!ne[U]||!ne[U].findChild,se=a&&h((function(){return 7!=y($({},"a",{get:function(){return $(this,"a",{value:7}).a}})).a}))?function(e,t,i){var n=K(B,t);n&&delete B[t],$(e,t,i),n&&e!==B&&$(B,t,n)}:$,oe=function(e,t){var i=J[e]=y(W[U]);return q(i,{type:H,tag:e,description:t}),a||(i.description=t),i},ae=l?function(e){return"symbol"==typeof e}:function(e){return Object(e)instanceof W},ce=function(e,t,i){e===B&&ce(Q,t,i),f(e);var n=m(t,!0);return f(i),d(J,n)?(i.enumerable?(d(e,L)&&e[L][n]&&(e[L][n]=!1),i=y(i,{enumerable:v(0,!1)})):(d(e,L)||$(e,L,v(1,{})),e[L][n]=!0),se(e,n,i)):$(e,n,i)},le=function(e,t){f(e);var i=g(t),n=_(i).concat(fe(i));return z(n,(function(t){a&&!de.call(i,t)||ce(e,t,i[t])})),e},he=function(e,t){return void 0===t?y(e):le(y(e),t)},de=function(e){var t=m(e,!0),i=Y.call(this,t);return!(this===B&&d(J,t)&&!d(Q,t))&&(!(i||!d(this,t)||!d(J,t)||d(this,L)&&this[L][t])||i)},pe=function(e,t){var i=g(e),n=m(t,!0);if(i!==B||!d(J,n)||d(Q,n)){var r=K(i,n);return!r||!d(J,n)||d(i,L)&&i[L][n]||(r.enumerable=!0),r}},ue=function(e){var t=X(g(e)),i=[];return z(t,(function(e){d(J,e)||d(M,e)||i.push(e)})),i},fe=function(e){var t=e===B,i=X(t?Q:g(e)),n=[];return z(i,(function(e){!d(J,e)||t&&!d(B,e)||n.push(J[e])})),n};if(c||(W=function(){if(this instanceof W)throw TypeError("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?String(arguments[0]):void 0,t=k(e),i=function(e){this===B&&i.call(Q,e),d(this,L)&&d(this[L],t)&&(this[L][t]=!1),se(this,t,v(1,e))};return a&&re&&se(B,t,{configurable:!0,set:i}),oe(t,e)},T(W[U],"toString",(function(){return N(this).tag})),T(W,"withoutSetter",(function(e){return oe(k(e),e)})),P.f=de,S.f=ce,w.f=pe,O.f=j.f=ue,x.f=fe,D.f=function(e){return oe(V(e),e)},a&&($(W[U],"description",{configurable:!0,get:function(){return N(this).description}}),o||T(B,"propertyIsEnumerable",de,{unsafe:!0}))),n({global:!0,wrap:!0,forced:!c,sham:!c},{Symbol:W}),z(_(ie),(function(e){G(e)})),n({target:H,stat:!0,forced:!c},{for:function(e){var t=String(e);if(d(ee,t))return ee[t];var i=W(t);return ee[t]=i,te[i]=t,i},keyFor:function(e){if(!ae(e))throw TypeError(e+" is not a symbol");if(d(te,e))return te[e]},useSetter:function(){re=!0},useSimple:function(){re=!1}}),n({target:"Object",stat:!0,forced:!c,sham:!a},{create:he,defineProperty:ce,defineProperties:le,getOwnPropertyDescriptor:pe}),n({target:"Object",stat:!0,forced:!c},{getOwnPropertyNames:ue,getOwnPropertySymbols:fe}),n({target:"Object",stat:!0,forced:h((function(){x.f(1)}))},{getOwnPropertySymbols:function(e){return x.f(b(e))}}),Z){var be=!c||h((function(){var e=W();return"[null]"!=Z([e])||"{}"!=Z({a:e})||"{}"!=Z(Object(e))}));n({target:"JSON",stat:!0,forced:be},{stringify:function(e,t,i){var n,r=[e],s=1;while(arguments.length>s)r.push(arguments[s++]);if(n=t,(u(t)||void 0!==e)&&!ae(e))return p(t)||(t=function(e,t){if("function"==typeof n&&(t=n.call(this,e,t)),!ae(t))return t}),r[1]=t,Z.apply(null,r)}})}W[U][F]||C(W[U],F,W[U].valueOf),I(W,H),M[L]=!0},a545:function(e,t,i){"use strict";i.d(t,"a",(function(){return g})),i.d(t,"b",(function(){return p}));var n=i("b2b2"),r=i("4ae5"),s=(i("e06a"),i("0b2d")),o=i("e431"),a=i("b139"),c=i("04f0"),l=i("a29a"),h=i("f7eb");function d(e,t,i=null){return Object(n["k"])(i)?[e,t,i]:[e,t]}function p(e,t,i=null){return Object(n["k"])(i)?{x:e,y:t,z:i}:{x:e,y:t}}class u{constructor(e){this.spatialReference=e}mapToLocalMultiple(e){return Object(n["g"])(e.map(e=>this.mapToLocal(e)))}get doUnnormalization(){return!1}}class f extends u{constructor(e,t,i=null){super(t),this.defaultZ=i,this.transform=Object(h["b"])(),this.transformInv=Object(h["b"])(),this.transform=Object(h["a"])(e),Object(l["a"])(this.transformInv,this.transform)}makeMapPoint(e,t){return d(e,t,this.defaultZ)}mapToLocal(e){return p(this.transform[0]*e[0]+this.transform[2]*e[1]+this.transform[4],this.transform[1]*e[0]+this.transform[3]*e[1]+this.transform[5])}localToMap(e){return d(this.transformInv[0]*e.x+this.transformInv[2]*e.y+this.transformInv[4],this.transformInv[1]*e.x+this.transformInv[3]*e.y+this.transformInv[5],this.defaultZ)}}class b extends u{constructor(e,t){super(e.spatialReference),this.view=e,this.defaultZ=null,this.pWS=Object(s["e"])(),this.tangentFrameUpWS=Object(s["e"])(),this.tangentFrameRightWS=Object(s["e"])(),this.tangentFrameForwardWS=Object(s["e"])(),this.localFrameRightWS=Object(s["e"])(),this.localFrameUpWS=Object(s["e"])(),this.worldToLocalTransform=Object(a["a"])(),this.localToWorldTransform=Object(a["a"])(),this.scale=1,this.scale=e.resolution,this.referenceMapPoint=t,this.defaultZ=t.hasZ?t.z:null;const i=e.state.camera.viewRight;this.view.renderCoordsHelper.toRenderCoords(this.referenceMapPoint,this.pWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,0,this.tangentFrameRightWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,1,this.tangentFrameUpWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,2,this.tangentFrameForwardWS);const n=Object(s["e"])();Object(o["f"])(n,this.tangentFrameForwardWS,Object(o["i"])(i,this.tangentFrameForwardWS)),Object(o["k"])(this.localFrameRightWS,i,n),Object(o["s"])(this.localFrameRightWS,this.localFrameRightWS),Object(o["h"])(this.localFrameUpWS,this.tangentFrameForwardWS,this.localFrameRightWS),Object(c["f"])(this.worldToLocalTransform,this.localFrameRightWS,this.tangentFrameRightWS),Object(c["d"])(this.localToWorldTransform,this.worldToLocalTransform)}get doUnnormalization(){return"global"===this.view.viewingMode}makeMapPoint(e,t){return d(e,t,this.defaultZ)}mapToLocal(e){const t=Object(s["e"])();this.view.renderCoordsHelper.toRenderCoords(new r["a"]({x:e[0],y:e[1],spatialReference:this.spatialReference}),t),Object(o["v"])(t,t,this.worldToLocalTransform);const i=this.view.renderCoordsHelper.fromRenderCoords(t,this.view.spatialReference);return Object(n["k"])(i)?p(i.x/this.scale,i.y/this.scale):null}localToMap(e){const t=Object(s["e"])();this.view.renderCoordsHelper.toRenderCoords(new r["a"]({x:e.x*this.scale,y:e.y*this.scale,spatialReference:this.spatialReference}),t),Object(o["v"])(t,t,this.localToWorldTransform);const i=this.view.renderCoordsHelper.fromRenderCoords(t,this.view.spatialReference);return Object(n["k"])(i)?d(i.x,i.y,this.defaultZ):null}}function g(e,t){if("2d"===e.type)return new f(e.state.transform,e.spatialReference,t.length>2?t[2]:null);if("3d"===e.type){const i=t.length>2?new r["a"]({x:t[0],y:t[1],z:t[2],spatialReference:e.spatialReference}):new r["a"]({x:t[0],y:t[1],spatialReference:e.spatialReference});return new b(e,i)}return null}},a630:function(e,t,i){var n=i("23e7"),r=i("4df4"),s=i("1c7e"),o=!s((function(e){Array.from(e)}));n({target:"Array",stat:!0,forced:o},{from:r})},a6c9:function(e,t,i){"use strict";i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return c})),i.d(t,"c",(function(){return a})),i.d(t,"d",(function(){return o})),i.d(t,"e",(function(){return h})),i.d(t,"f",(function(){return r})),i.d(t,"g",(function(){return l}));i("c120");var n=i("1153");function r(e,t,i){switch(e){case"circle":return s(t,i);case"square":return o(t,i);case"cross":return c(t,i);case"x":return l(t,i);case"kite":return a(t,i);case"triangle":return h(t,i);default:return s(t,i)}}function s(e,t){const i=e,r=new Uint8Array(4*i*i),s=i/2-.5,o=t/2;for(let a=0;a<i;a++)for(let t=0;t<i;t++){const c=t+i*a,l=t-s,h=a-s;let d=Math.sqrt(l*l+h*h)-o;d=d/e+.5,Object(n["i"])(d,r,4*c)}return r}function o(e,t){return d(e,t,!1)}function a(e,t){return d(e,t,!0)}function c(e,t){return p(e,t,!1)}function l(e,t){return p(e,t,!0)}function h(e,t){const i=new Uint8Array(4*e*e),r=1,s=-.5,o=Math.sqrt(r*r+s*s),a=(e-t)/2;for(let c=0;c<e;c++)for(let l=0;l<e;l++){const h=c*e+l,d=(l-a)/t,p=(c-a+.75)/t,u=-(r*d+s*p)/o,f=(r*(d-1)+s*-p)/o,b=-p,g=Math.max(u,f,b);Object(n["i"])(g*t/e+.5,i,4*h)}return i}function d(e,t,i){i&&(t/=Math.SQRT2);const r=new Uint8Array(4*e*e);for(let s=0;s<e;s++)for(let o=0;o<e;o++){let a=o-.5*e+.25,c=.5*e-s-.75;const l=s*e+o;if(i){const e=(a+c)/Math.SQRT2;c=(c-a)/Math.SQRT2,a=e}let h=Math.max(Math.abs(a),Math.abs(c))-.5*t;h=h/e+.5,Object(n["i"])(h,r,4*l)}return r}function p(e,t,i){i&&(t*=Math.SQRT2);const r=.5*t,s=new Uint8Array(4*e*e);for(let o=0;o<e;o++)for(let t=0;t<e;t++){let a=t-.5*e,c=.5*e-o-1;const l=o*e+t;if(i){const e=(a+c)/Math.SQRT2;c=(c-a)/Math.SQRT2,a=e}let h;a=Math.abs(a),c=Math.abs(c),h=a>c?a>r?Math.sqrt((a-r)*(a-r)+c*c):c:c>r?Math.sqrt(a*a+(c-r)*(c-r)):a,h=h/e+.5,Object(n["i"])(h,s,4*l)}return s}},a997:function(e,t,i){"use strict";i.d(t,"a",(function(){return h})),i.d(t,"b",(function(){return l})),i.d(t,"c",(function(){return c}));var n=i("38a4"),r=i("3886"),s=i("690a"),o=i("2aad"),a=i("9e77");const c=Object(n["f"])(6);function l(e){const t=new s["a"];return t.extensions.add("GL_OES_standard_derivatives"),t.include(o["a"]),t.include(a["a"],e),t.fragment.uniforms.add("angleCutoff","vec2"),t.fragment.uniforms.add("globalAlpha","float"),e.heightManifoldEnabled&&t.fragment.uniforms.add("heightPlane","vec4"),e.pointDistanceEnabled&&t.fragment.uniforms.add("pointDistanceSphere","vec4"),e.lineVerticalPlaneEnabled&&t.fragment.uniforms.add("lineVerticalPlane","vec4").add("lineVerticalStart","vec3").add("lineVerticalEnd","vec3"),(e.heightManifoldEnabled||e.pointDistanceEnabled||e.lineVerticalPlaneEnabled)&&t.fragment.uniforms.add("maxPixelDistance","float"),e.intersectsLineEnabled&&t.fragment.uniforms.add("intersectsLineStart","vec3").add("intersectsLineEnd","vec3").add("intersectsLineDirection","vec3").add("intersectsLineRadius","float").add("perScreenPixelRatio","float"),(e.lineVerticalPlaneEnabled||e.heightManifoldEnabled)&&t.fragment.code.add(r["a"]`
      float planeDistancePixels(vec4 plane, vec3 pos) {
        float dist = dot(plane.xyz, pos) + plane.w;
        float width = fwidth(dist);
        dist /= min(width, maxPixelDistance);
        return abs(dist);
      }`),e.pointDistanceEnabled&&t.fragment.code.add(r["a"]`
    float sphereDistancePixels(vec4 sphere, vec3 pos) {
      float dist = distance(sphere.xyz, pos) - sphere.w;
      float width = fwidth(dist);
      dist /= min(width, maxPixelDistance);
      return abs(dist);
    }
    `),e.intersectsLineEnabled&&t.fragment.code.add(r["a"]`
    float lineDistancePixels(vec3 start, vec3 dir, float radius, vec3 pos) {
      float dist = length(cross(dir, pos - start)) / (length(pos) * perScreenPixelRatio);
      return abs(dist) - radius;
    }
    `),(e.lineVerticalPlaneEnabled||e.intersectsLineEnabled)&&t.fragment.code.add(r["a"]`
    bool pointIsWithinLine(vec3 pos, vec3 start, vec3 end) {
      vec3 dir = end - start;
      float t2 = dot(dir, pos - start);
      float l2 = dot(dir, dir);
      return t2 >= 0.0 && t2 <= l2;
    }
    `),t.fragment.code.add(r["a"]`
  void main() {
    vec3 pos;
    vec3 normal;
    float depthDiscontinuityAlpha;

    if (!laserlineReconstructFromDepth(pos, normal, depthDiscontinuityAlpha)) {
      discard;
    }

    vec4 color = vec4(0, 0, 0, 0);
  `),e.heightManifoldEnabled&&t.fragment.code.add(r["a"]`
    {
      float heightManifoldAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, heightPlane.xyz)));
      vec4 heightManifoldColor = laserlineProfile(planeDistancePixels(heightPlane, pos));
      color = max(color, heightManifoldColor * heightManifoldAlpha);
    }
    `),e.pointDistanceEnabled&&t.fragment.code.add(r["a"]`
    {
      // distance to sphere
      float pointDistanceSphereDistance = sphereDistancePixels(pointDistanceSphere, pos);
      vec4 pointDistanceSphereColor = laserlineProfile(pointDistanceSphereDistance);
      float pointDistanceSphereAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, normalize(pos - pointDistanceSphere.xyz))));

      color = max(color, pointDistanceSphereColor * pointDistanceSphereAlpha);
    }
    `),e.lineVerticalPlaneEnabled&&t.fragment.code.add(r["a"]`
    {
      if (pointIsWithinLine(pos, lineVerticalStart, lineVerticalEnd)) {
        float lineVerticalDistance = planeDistancePixels(lineVerticalPlane, pos);

        vec4 lineVerticalColor = laserlineProfile(lineVerticalDistance);
        float lineVerticalAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, lineVerticalPlane.xyz)));

        color = max(color, lineVerticalColor * lineVerticalAlpha);
      }
    }
    `),e.intersectsLineEnabled&&t.fragment.code.add(r["a"]`
    {
      if (pointIsWithinLine(pos, intersectsLineStart, intersectsLineEnd)) {
        float intersectsLineDistance = lineDistancePixels(intersectsLineStart, intersectsLineDirection, intersectsLineRadius, pos);
        vec4 intersectsLineColor = laserlineProfile(intersectsLineDistance);
        float intersectsLineAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, 1.0 - abs(dot(normal, intersectsLineDirection)));

        color = max(color, intersectsLineColor * intersectsLineAlpha);
      }
    }
    `),t.fragment.code.add(r["a"]`
    gl_FragColor = laserlineOutput(color * depthDiscontinuityAlpha);
  }
  `),t}var h=Object.freeze({__proto__:null,defaultAngleCutoff:c,build:l})},aa4b:function(e,t,i){"use strict";i("2a07")},b48e:function(e,t,i){"use strict";var n,r=i("a4ee"),s=(i("c120"),i("e92d"),i("cea0"),i("59b2")),o=i("d386"),a=(i("e041"),i("8eed"),i("f402"),i("2c81")),c=i("9786"),l=i("4ae5"),h=i("1219"),d=i("f694"),p=i("8048"),u=i("40b6");let f=n=class extends h["a"]{constructor(...e){super(...e),this.center=null,this.geodesic=!1,this.numberOfPoints=60,this.radius=1e3,this.radiusUnit="meters"}normalizeCtorArgs(e,t){let i;if(e&&e.center)i=e;else{if(e&&e.rings)return super.normalizeCtorArgs(e,t);i={center:e}}return{...super.normalizeCtorArgs(),...i,...t}}initialize(){const e=this.center,t=this.numberOfPoints;if(this.hasZ=e&&e.hasZ,0!==this.rings.length||!e)return;const i=Object(p["c"])(this.radius,this.radiusUnit,"meters"),n=e.spatialReference;let r,s="geographic";if(n.isWebMercator?s="webMercator":(null!=a["a"][n.wkid]||n.wkt&&0===n.wkt.indexOf("PROJCS"))&&(s="projected"),this.geodesic){let n;switch(s){case"webMercator":n=Object(c["e"])(e);break;case"projected":console.error("Creating a geodesic circle requires the center to be specified in web mercator or geographic coordinate system");break;case"geographic":n=e}r=this._createGeodesicCircle(n,i,t),"webMercator"===s&&(r=Object(c["b"])(r))}else{let n;"webMercator"===s||"projected"===s?n=i/this._convert2Meters(1,e.spatialReference):"geographic"===s&&(n=Object(p["k"])(i,"meters",Object(d["e"])(e.spatialReference).radius)),r=this._createPlanarCircle(e,n,t)}this.spatialReference=r.spatialReference,this.addRing(r.rings[0])}clone(){const{center:e,numberOfPoints:t,radius:i,radiusUnit:r,geodesic:s}=this;return new n({center:e.clone(),numberOfPoints:t,radius:i,radiusUnit:r,geodesic:s})}_createGeodesicCircle(e,t,i){let n=0;const r=[];for(;n<360;){const s=[0,0],o=[e.x,e.y];Object(u["a"])(s,o,n,t),this.hasZ&&s.push(e.z),r.push(s),n+=360/i}return r.push(r[0]),new h["a"](r)}_createPlanarCircle(e,t,i){let n=0;const r=[];for(;n<2*Math.PI;){const s=[e.x+Math.cos(-n)*t,e.y+Math.sin(-n)*t];this.hasZ&&s.push(e.z),r.push(s),n+=Math.PI/(i/2)}return r.push(r[0]),new h["a"]({spatialReference:e.spatialReference,rings:[r]})}_convert2Meters(e,t){let i;if(null!=a["a"][t.wkid])i=a["a"].values[a["a"][t.wkid]];else{const e=t.wkt,n=e.lastIndexOf(",")+1,r=e.lastIndexOf("]]");i=parseFloat(e.substring(n,r))}return e*i}};Object(r["a"])([Object(s["b"])({type:l["a"]})],f.prototype,"center",void 0),Object(r["a"])([Object(s["b"])()],f.prototype,"geodesic",void 0),Object(r["a"])([Object(s["b"])()],f.prototype,"numberOfPoints",void 0),Object(r["a"])([Object(s["b"])()],f.prototype,"radius",void 0),Object(r["a"])([Object(s["b"])()],f.prototype,"radiusUnit",void 0),f=n=Object(r["a"])([Object(o["a"])("esri.geometry.Circle")],f);var b=f;t["a"]=b},b4c8:function(e,t,i){"use strict";var n,r=i("dae5"),s=i("47f8");!function(e){e.Default={vvSizeEnabled:!1,vvSizeMinSize:Object(s["d"])(1,1,1),vvSizeMaxSize:Object(s["d"])(100,100,100),vvSizeOffset:Object(s["d"])(0,0,0),vvSizeFactor:Object(s["d"])(1,1,1),vvSizeValue:Object(s["d"])(1,1,1),vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],vvOpacityEnabled:!1,vvOpacityValues:[0,0,0,0,0,0,0,0],vvOpacityOpacities:[1,1,1,1,1,1,1,1],vvSymbolAnchor:[0,0,0],vvSymbolRotationMatrix:Object(r["a"])()}}(n||(n={}));var o=n;t["a"]=o},b63c:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var n=i("6706"),r=i("7dcb");class s extends r["a"]{constructor(e){super(),this.point=e}equals(e){return e instanceof s&&Object(n["d"])(this.point,e.point)}}},b64b:function(e,t,i){var n=i("23e7"),r=i("7b0b"),s=i("df75"),o=i("d039"),a=o((function(){s(1)}));n({target:"Object",stat:!0,forced:a},{keys:function(e){return s(r(e))}})},b65e:function(e,t,i){"use strict";function n(e,t){if(!t||!e||!e.map)return;const{map:i}=e;i.layers.find(e=>e===t)||i.add(t)}i.d(t,"a",(function(){return n}))},ba58:function(e,t,i){"use strict";i.d(t,"a",(function(){return v})),i.d(t,"b",(function(){return M})),i.d(t,"c",(function(){return C})),i.d(t,"d",(function(){return k})),i.d(t,"e",(function(){return x})),i.d(t,"f",(function(){return A})),i.d(t,"g",(function(){return S})),i.d(t,"h",(function(){return V})),i.d(t,"i",(function(){return P})),i.d(t,"j",(function(){return w})),i.d(t,"k",(function(){return E}));var n=i("b2b2"),r=i("32ed"),s=i("57e5"),o=i("38a4"),a=i("0b2d"),c=i("d791"),l=i("9180"),h=i("8188"),d=i("afe1"),p=i("02f1"),u=i("0fc4"),f=i("7577"),b=i("4261"),g=i("1a54"),m=i("d3cf");function v(e,t){if("point"===e.type)return j(e,t,!1);if(Object(m["d"])(e))switch(e.type){case"extent":return j(e.center,t,!1);case"polygon":return j(e.centroid,t,!1);case"polyline":return j(y(e),t,!0);case"mesh":return j(e.extent.center,t,!1)}else switch(e.type){case"extent":return j(_(e),t,!0);case"polygon":return j(O(e),t,!0);case"polyline":return j(y(e),t,!0)}}function y(e){const t=e.paths[0];if(!t||0===t.length)return null;const i=Object(r["f"])(t,Object(r["e"])(t)/2);return Object(g["k"])(i[0],i[1],i[2],e.spatialReference)}function _(e){const t=Object(o["j"])(e.zmin);return Object(g["k"])(.5*(e.xmax+e.xmin),.5*(e.ymax+e.ymin),t?.5*(e.zmax+e.zmin):void 0,e.spatialReference)}function O(e){const t=e.rings[0];if(!t||0===t.length)return null;const i=Object(s["b"])(e.rings,e.hasZ);return Object(g["k"])(i[0],i[1],i[2],e.spatialReference)}function j(e,t,i){const n=i?e:Object(m["a"])(e);return t&&e?Object(h["s"])(e,n,t)?n:null:n}function x(e,t,i,n=0){if(e){t||(t=Object(l["l"])());const r=e;let s=.5*r.width*(i-1),o=.5*r.height*(i-1);return r.width<1e-7*r.height?s+=o/20:r.height<1e-7*r.width&&(o+=s/20),Object(f["l"])(t,r.xmin-s-n,r.ymin-o-n,r.xmax+s+n,r.ymax+o+n),t}return null}function w(e,t){for(let i=0;i<e.geometries.length;++i){const n=e.geometries[i].getMutableAttribute("auxpos1");n&&n.data[3]!==t&&(n.data[3]=t,e.geometryVertexAttrsUpdated(i))}}function S(e,t){const i=Object(u["f"])(u["a"]);return Object(n["k"])(e)&&(i[0]=e[0],i[1]=e[1],i[2]=e[2]),Object(n["k"])(t)?i[3]=t:Object(n["k"])(e)&&e.length>3&&(i[3]=e[3]),i}function P(e,t,i,r,s,o=[0,0,0,0]){for(let a=0;a<3;++a)Object(n["k"])(e)&&null!=e[a]?o[a]=e[a]:Object(n["k"])(i)&&null!=i[a]?o[a]=i[a]:o[a]=s[a];return Object(n["k"])(t)?o[3]=t:Object(n["k"])(r)?o[3]=r:o[3]=s[3],o}function C(e=a["a"],t,i,r=1){const s=new Array(3);if(Object(n["j"])(t)||Object(n["j"])(i))s[0]=1,s[1]=1,s[2]=1;else{let n,r=0;for(let o=2;o>=0;o--){const a=e[o];let c;const l=null!=a,h=0===o&&!n&&!l,d=i[o];"symbol-value"===a||h?c=0!==d?t[o]/d:1:l&&"proportional"!==a&&isFinite(a)&&(c=0!==d?a/d:1),null!=c&&(s[o]=c,n=c,r=Math.max(r,Math.abs(c)))}for(let e=2;e>=0;e--)null==s[e]?s[e]=n:0===s[e]&&(s[e]=.001*r)}for(let n=2;n>=0;n--)s[n]/=r;return Object(a["f"])(s)}function T(e){return null!=e.isPrimitive}function E(e){return T(e)&&(e=[e.width,e.depth,e.height]),A(e)?null:"Symbol sizes may not be negative values"}function A(e){if(Array.isArray(e)){for(const t of e)if(!A(t))return!1;return!0}return null==e||e>=0}function M(e,t,i,n=Object(d["b"])()){const r=e||0,s=t||0,o=i||0;return 0!==r&&Object(c["g"])(n,n,-r/180*Math.PI),0!==s&&Object(c["e"])(n,n,s/180*Math.PI),0!==o&&Object(c["f"])(n,n,o/180*Math.PI),n}function k(e,t){return null!=t.minDemResolution?t.minDemResolution:Object(b["y"])(e)?t.minDemResolutionForPoints:.01*Object(b["z"])(e)}const V={"bottom-left":Object(p["f"])(0,0),bottom:Object(p["f"])(.5,0),"bottom-right":Object(p["f"])(1,0),left:Object(p["f"])(0,.5),center:Object(p["f"])(.5,.5),right:Object(p["f"])(1,.5),"top-left":Object(p["f"])(0,1),top:Object(p["f"])(.5,1),"top-right":Object(p["f"])(1,1)}},ba62:function(e,t,i){},c20d:function(e,t,i){"use strict";i.d(t,"a",(function(){return j})),i.d(t,"b",(function(){return y})),i.d(t,"c",(function(){return _})),i.d(t,"d",(function(){return d})),i.d(t,"e",(function(){return h})),i.d(t,"f",(function(){return O})),i.d(t,"g",(function(){return u})),i.d(t,"h",(function(){return f})),i.d(t,"i",(function(){return g})),i.d(t,"j",(function(){return m})),i.d(t,"k",(function(){return v}));var n=i("7ffa"),r=i("b2b2"),s=(i("c649"),i("9786")),o=i("38a4"),a=i("a915"),c=i("cdc1");function l(e,t){let i=null,n=null;return s=>{if("cancel"===s.action)return void(Object(r["k"])(n)&&(n.execute({action:"cancel"}),i=null,n=null));const o={action:s.action,screenStart:s.start,screenEnd:s.screenPoint};"start"===s.action&&Object(r["j"])(i)&&(i=new j,n=new j,t(e,i,n,s.pointerType,o)),Object(r["k"])(i)&&i.execute(o),"end"===s.action&&Object(r["k"])(i)&&(i=null,n=null)}}function h(e,t){return e.events.on("drag",l(e,t))}function d(e,t){const i=[e.x,e.y,e.z],n=t,r=[Math.cos(n),Math.sin(n)],s=Math.sqrt(r[0]*r[0]+r[1]*r[1]);if(0===s)return null;r[0]/=s,r[1]/=s;const o=e=>{const t=(e.x-i[0])*r[0]+(e.y-i[1])*r[1];e.x=i[0]+t*r[0],e.y=i[1]+t*r[1]};return e=>(o(e.mapStart),o(e.mapEnd),e)}function p(e,t){let i=null;const n=Object(r["k"])(e[t])?e[t].spatialReference:null;function o(e,t){return Object(r["j"])(e)||"mesh"===e.type?null:e.spatialReference.equals(t)?e.clone():Object(s["a"])(e,t)?Object(s["d"])(e,t):null}return a=>{if("start"===a.action&&Object(r["k"])(e[t])&&(i=o(e[t],a.mapStart.spatialReference)),Object(r["j"])(i))return null;const l=a.mapEnd.x-a.mapStart.x,h=a.mapEnd.y-a.mapStart.y,d=a.mapEnd.z-a.mapStart.z,p=Object(c["d"])(i.clone(),l,h,d);return p.spatialReference.equals(n)?e[t]=p:e[t]=Object(s["d"])(p,n),{...a,translationX:l,translationY:h,translationZ:d}}}function u(e){return p(e,"geometry")}function f(e){const t=e.map(e=>Object(r["t"])(u(e))).filter(e=>Object(r["k"])(e));return e=>{const i=e.mapEnd.x-e.mapStart.x,n=e.mapEnd.y-e.mapStart.y,r=e.mapEnd.z-e.mapStart.z;return t.forEach(t=>t(e)),{...e,translationX:i,translationY:n,translationZ:r}}}function b(e,t){const i=new Map;for(const r of t)i.set(r,Object(n["a"])(e[r]));return t=>(i.forEach((t,i)=>{e[i]=t}),t)}function g(e){return b(e,["geometry"])}function m(e){const t=e.map(e=>Object(r["t"])(g(e))).filter(e=>Object(r["k"])(e));return e=>(t.forEach(t=>t(e)),e)}function v(e){const t=Object(r["k"])(e.symbol)?e.symbol.clone():null;return i=>(e.symbol=t,i)}function y(){let e=0,t=0,i=0;return n=>{"start"===n.action&&(e=n.mapStart.x,t=n.mapStart.y,i=n.mapStart.z);const r=n.mapEnd.x-e,s=n.mapEnd.y-t,o=n.mapEnd.z-i;return e=n.mapEnd.x,t=n.mapEnd.y,i=n.mapEnd.z,{...n,mapDeltaX:r,mapDeltaY:s,mapDeltaZ:o,mapDeltaSpatialReference:n.mapStart.spatialReference}}}function _(){let e=0,t=0;return i=>{"start"===i.action&&(e=i.screenStart.x,t=i.screenStart.y);const n=i.screenEnd.x-e,r=i.screenEnd.y-t;return e=i.screenEnd.x,t=i.screenEnd.y,{...i,screenDeltaX:n,screenDeltaY:r}}}function O(e,t){let i=null,n=0,r=0;return s=>{if("start"===s.action&&(i=e.toScreen(t),i.x<0||i.x>e.width||i.y<0||i.y>e.height?i=null:(n=s.screenStart.x-i.x,r=s.screenStart.y-i.y)),null==i)return null;const c=Object(o["d"])(s.screenEnd.x-n,0,e.width),l=Object(o["d"])(s.screenEnd.y-r,0,e.height),h=Object(a["f"])(c,l);return s.screenStart=i,s.screenEnd=h,s}}class j{constructor(){this.execute=()=>{}}next(e,t=new j){return Object(r["k"])(e)&&(this.execute=i=>{const n=e(i);Object(r["k"])(n)&&t.execute(n)}),t}}},c9fb:function(e,t,i){"use strict";i.d(t,"a",(function(){return h}));var n=i("a4ee"),r=i("59b2"),s=i("d386"),o=i("6a0e"),a=i("9ef0");let c=class extends o["a"]{constructor(){super(...arguments),this.enabled=!0}};Object(n["a"])([Object(r["b"])({type:Boolean})],c.prototype,"enabled",void 0),c=Object(n["a"])([Object(s["a"])("esri.views.interactive.snapping.Settings.DefaultSnappingAlgorithm")],c);let l=class extends o["a"]{constructor(e){super(e),this.lineSnapper=new c,this.parallelLineSnapper=new c,this.rightAngleSnapper=new c,this.rightAngleTriangleSnapper=new c,this.shortLineThreshold=15,this.distance=5,this.pointThreshold=1e-6,this.intersectionParallelLineThreshold=1e-6,this.parallelLineThreshold=1e-6,this.touchSensitivityMultiplier=1.5,this.pointOnLineThreshold=1e-6,this.orange=new a["a"]([255,127,0]),this.lineHintWidthReference=3,this.lineHintWidthTarget=3,this.lineHintFadedExtensions=.3,this.parallelLineHintWidth=2,this.parallelLineHintLength=24,this.parallelLineHintOffset=1.5,this.rightAngleHintSize=24,this.rightAngleHintOutlineSize=1.5}};Object(n["a"])([Object(r["b"])({type:c,constructOnly:!0,nonNullable:!0,json:{write:!0}})],l.prototype,"lineSnapper",void 0),Object(n["a"])([Object(r["b"])({type:c,constructOnly:!0,nonNullable:!0,json:{write:!0}})],l.prototype,"parallelLineSnapper",void 0),Object(n["a"])([Object(r["b"])({type:c,constructOnly:!0,nonNullable:!0,json:{write:!0}})],l.prototype,"rightAngleSnapper",void 0),Object(n["a"])([Object(r["b"])({type:c,constructOnly:!0,nonNullable:!0,json:{write:!0}})],l.prototype,"rightAngleTriangleSnapper",void 0),Object(n["a"])([Object(r["b"])({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],l.prototype,"shortLineThreshold",void 0),Object(n["a"])([Object(r["b"])({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],l.prototype,"distance",void 0),Object(n["a"])([Object(r["b"])({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],l.prototype,"pointThreshold",void 0),Object(n["a"])([Object(r["b"])({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],l.prototype,"intersectionParallelLineThreshold",void 0),Object(n["a"])([Object(r["b"])({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],l.prototype,"parallelLineThreshold",void 0),Object(n["a"])([Object(r["b"])({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],l.prototype,"touchSensitivityMultiplier",void 0),Object(n["a"])([Object(r["b"])({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],l.prototype,"pointOnLineThreshold",void 0),Object(n["a"])([Object(r["b"])({type:a["a"],nonNullable:!0})],l.prototype,"orange",void 0),Object(n["a"])([Object(r["b"])({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],l.prototype,"lineHintWidthReference",void 0),Object(n["a"])([Object(r["b"])({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],l.prototype,"lineHintWidthTarget",void 0),Object(n["a"])([Object(r["b"])({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],l.prototype,"lineHintFadedExtensions",void 0),Object(n["a"])([Object(r["b"])({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],l.prototype,"parallelLineHintWidth",void 0),Object(n["a"])([Object(r["b"])({type:Number,nonNullable:!0,range:{min:0,max:50},json:{write:!0}})],l.prototype,"parallelLineHintLength",void 0),Object(n["a"])([Object(r["b"])({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],l.prototype,"parallelLineHintOffset",void 0),Object(n["a"])([Object(r["b"])({type:Number,nonNullable:!0,range:{min:0,max:46},json:{write:!0}})],l.prototype,"rightAngleHintSize",void 0),Object(n["a"])([Object(r["b"])({type:Number,nonNullable:!0,range:{min:0,max:6},json:{write:!0}})],l.prototype,"rightAngleHintOutlineSize",void 0),l=Object(n["a"])([Object(s["a"])("esri.views.interactive.snapping.Settings.Defaults")],l);const h=new l},caf7:function(e,t,i){"use strict";var n,r=i("0b2d"),s=i("e431"),o=i("47f8"),a=i("d0ac");!function(e){function t(e,t){const i=e[t],n=e[t+1],r=e[t+2];return Math.sqrt(i*i+n*n+r*r)}function i(e,t){const i=e[t],n=e[t+1],r=e[t+2],s=1/Math.sqrt(i*i+n*n+r*r);e[t]*=s,e[t+1]*=s,e[t+2]*=s}function n(e,t,i){e[t]*=i,e[t+1]*=i,e[t+2]*=i}function r(e,t,i,n,r,s=t){(r=r||e)[s]=e[t]+i[n],r[s+1]=e[t+1]+i[n+1],r[s+2]=e[t+2]+i[n+2]}function s(e,t,i,n,r,s=t){(r=r||e)[s]=e[t]-i[n],r[s+1]=e[t+1]-i[n+1],r[s+2]=e[t+2]-i[n+2]}e.length=t,e.normalize=i,e.scale=n,e.add=r,e.subtract=s}(n||(n={}));var c=i("1153"),l=i("1038"),h=i("0278");const d=n;var p,u,f,b;!function(e){const t=.5,i=[[-t,-t,t],[t,-t,t],[t,t,t],[-t,t,t],[-t,-t,-t],[t,-t,-t],[t,t,-t],[-t,t,-t]],n=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],r=[0,0,1,0,1,1,0,1],s=new Uint16Array([0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5]),o=new Uint16Array(36);for(let l=0;l<6;l++)for(let e=0;e<6;e++)o[6*l+e]=l;const a=new Uint16Array(36);for(let l=0;l<6;l++)a[6*l+0]=0,a[6*l+1]=1,a[6*l+2]=2,a[6*l+3]=2,a[6*l+4]=3,a[6*l+5]=0;function c(e){Array.isArray(e)||(e=[e,e,e]);const t=new Array(24);for(let n=0;n<8;n++)t[3*n]=i[n][0]*e[0],t[3*n+1]=i[n][1]*e[1],t[3*n+2]=i[n][2]*e[2];return new h["a"]([["position",{size:3,data:t,exclusive:!0}],["normal",{size:3,data:n}],["uv0",{size:2,data:r}]],[["position",s],["normal",o],["uv0",a]])}e.createGeometry=c}(p||(p={})),function(e){const t=.5,i=[[-t,0,-t],[t,0,-t],[t,0,t],[-t,0,t],[0,-t,0],[0,t,0]],n=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],r=new Uint16Array([5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0]),s=new Uint16Array([0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7]);function o(e){Array.isArray(e)||(e=[e,e,e]);const t=new Array(18);for(let n=0;n<6;n++)t[3*n]=i[n][0]*e[0],t[3*n+1]=i[n][1]*e[1],t[3*n+2]=i[n][2]*e[2];return new h["a"]([["position",{size:3,data:t,exclusive:!0}],["normal",{size:3,data:n}]],[["position",r],["normal",s]])}e.createGeometry=o}(u||(u={})),function(e){const t=.5,i=0,n=Object(o["d"])(-t,i,-t),r=Object(o["d"])(t,i,-t),a=Object(o["d"])(0,i,t),c=Object(o["d"])(0,i+t,0),l=Object(o["c"])(),d=Object(o["c"])(),p=Object(o["c"])(),u=Object(o["c"])(),f=Object(o["c"])();Object(s["k"])(l,n,c),Object(s["k"])(d,n,r),Object(s["h"])(p,l,d),Object(s["s"])(p,p),Object(s["k"])(l,r,c),Object(s["k"])(d,r,a),Object(s["h"])(u,l,d),Object(s["s"])(u,u),Object(s["k"])(l,a,c),Object(s["k"])(d,a,n),Object(s["h"])(f,l,d),Object(s["s"])(f,f);const b=[n,r,a,c],g=[0,-1,0,p[0],p[1],p[2],u[0],u[1],u[2],f[0],f[1],f[2]],m=[0,1,2,3,1,0,3,2,1,3,0,2],v=[0,0,0,1,1,1,2,2,2,3,3,3];function y(e){Array.isArray(e)||(e=[e,e,e]);const t=new Array(12);for(let i=0;i<4;i++)t[3*i]=b[i][0]*e[0],t[3*i+1]=b[i][1]*e[1],t[3*i+2]=b[i][2]*e[2];return new h["a"]([["position",{size:3,data:t,exclusive:!0}],["normal",{size:3,data:g}]],[["position",new Uint16Array(m)],["normal",new Uint16Array(v)]])}e.createGeometry=y}(f||(f={})),function(e){function t(e,t,i,n={uv:!0}){const r=-Math.PI,s=2*Math.PI,o=-Math.PI/2,a=Math.PI,c=Math.max(3,Math.floor(t)),l=Math.max(2,Math.floor(i)),d=(c+1)*(l+1),p=new Float32Array(3*d),u=new Float32Array(3*d),f=new Float32Array(2*d),b=[];let g=0;for(let h=0;h<=l;h++){const t=[],i=h/l,n=o+i*a,d=Math.cos(n);for(let o=0;o<=c;o++){const a=o/c,l=r+a*s,h=Math.cos(l)*d,b=Math.sin(n),m=-Math.sin(l)*d;p[3*g]=h*e,p[3*g+1]=b*e,p[3*g+2]=m*e,u[3*g]=h,u[3*g+1]=b,u[3*g+2]=m,f[2*g]=a,f[2*g+1]=i,t.push(g),++g}b.push(t)}const m=new Uint32Array(2*c*(l-1)*3);g=0;for(let h=0;h<l;h++)for(let e=0;e<c;e++){const t=b[h][e],i=b[h][e+1],n=b[h+1][e+1],r=b[h+1][e];0===h?(m[g++]=t,m[g++]=n,m[g++]=r):h===l-1?(m[g++]=t,m[g++]=i,m[g++]=n):(m[g++]=t,m[g++]=i,m[g++]=n,m[g++]=n,m[g++]=r,m[g++]=t)}const v=[["position",m],["normal",m]],y=[["position",{size:3,data:p,exclusive:!0}],["normal",{size:3,data:u,exclusive:!0}]];return n.uv&&(y.push(["uv0",{size:2,data:f,exclusive:!0}]),v.push(["uv0",m])),n.offset&&(v[0][0]="offset",y[0][0]="offset",v.push(["position",new Uint32Array(m.length)]),y.push(["position",{size:3,data:Float64Array.from(n.offset),exclusive:!0}])),new h["a"](y,v)}function i(e,t,i){const n=e;let r,s;if(i)r=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],s=new Uint32Array([0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1]);else{const e=n*(1+Math.sqrt(5))/2;r=[-n,e,0,n,e,0,-n,-e,0,n,-e,0,0,-n,e,0,n,e,0,-n,-e,0,n,-e,e,0,-n,e,0,n,-e,0,-n,-e,0,n],s=new Uint32Array([0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1])}for(let h=0;h<r.length;h+=3)d.scale(r,h,e/d.length(r,h));let o={};function a(t,i){t>i&&([t,i]=[i,t]);const n=t.toString()+"."+i.toString();if(o[n])return o[n];let s=r.length;return r.length+=3,d.add(r,3*t,r,3*i,r,s),d.scale(r,s,e/d.length(r,s)),s/=3,o[n]=s,s}for(let h=0;h<t;h++){const e=s.length,t=new Uint32Array(4*e);for(let i=0;i<e;i+=3){const e=s[i],n=s[i+1],r=s[i+2],o=a(e,n),c=a(n,r),l=a(r,e),h=4*i;t[h]=e,t[h+1]=o,t[h+2]=l,t[h+3]=n,t[h+4]=c,t[h+5]=o,t[h+6]=r,t[h+7]=l,t[h+8]=c,t[h+9]=o,t[h+10]=c,t[h+11]=l}s=t,o={}}const c=new Float32Array(r);for(let h=0;h<c.length;h+=3)d.normalize(c,h);const l=[["position",s],["normal",s]],p=[["position",{size:3,data:new Float32Array(r),exclusive:!0}],["normal",{size:3,data:c,exclusive:!0}]];return new h["a"](p,l)}function n(e,t,i,n,r,s,o){const a=t?[t[0],t[1],t[2]]:[0,0,0],c=e?[e[0],e[1],e[2]]:[0,0,1];s=s||[0,0];const l=i?[255*i[0],255*i[1],255*i[2],i.length>3?255*i[3]:255]:[255,255,255,255],d=null!=n&&2===n.length?n:[1,1],p=[["position",{size:3,data:a,exclusive:!0}],["normal",{size:3,data:c,exclusive:!0}],["uv0",{size:s.length,data:s}],["color",{size:4,data:l,exclusive:!0}],["size",{size:2,data:d}]];if(null!=r){const e=new Float32Array([r[0],r[1],r[2],r[3]]);p.push(["auxpos1",{size:4,data:e}])}if(null!=o){const e=new Float32Array([o[0],o[1],o[2],o[3]]);p.push(["auxpos2",{size:4,data:e}])}return new h["a"](p,null,1)}function b(e,t,i,n,r,s,o,a){if(null!=e){const{data:t}=a.getMutableAttribute("normal");t[0]=e[0],t[1]=e[1],t[2]=e[2]}if(null!=t){const{data:e}=a.getMutableAttribute("position");e[0]=t[0],e[1]=t[1],e[2]=t[2]}if(null!=i){const{data:e}=a.getMutableAttribute("color");e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3]}if(null!=n){const{data:e}=a.getMutableAttribute("size");e[0]=n[0],e[1]=n[1]}if(null!=r){const{data:e}=a.getMutableAttribute("auxpos1");e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3]}if(null!=s){const{data:e}=a.getMutableAttribute("uv0");e[0]=s[0],e[1]=s[1]}if(null!=o){const{data:e}=a.getMutableAttribute("auxpos2");e[0]=o[0],e[1]=o[1],e[2]=o[2],e[3]=o[3]}}function v(e,t){const i=new Float32Array(3*e.length),n=new Float32Array(t?3*e.length:3),r=new Uint32Array(e.length),s=new Uint32Array(e.length);for(let o=0;o<e.length;o++)i[3*o]=e[o][0],i[3*o+1]=e[o][1],i[3*o+2]=e[o][2],t&&(n[3*o]=t[o][0],n[3*o+1]=t[o][1],n[3*o+2]=t[o][2]),r[o]=o,s[o]=0;return t||(n[0]=0,n[1]=1,n[2]=0),new h["a"]([["position",{size:3,data:i,exclusive:!0}],["normal",{size:3,data:n,exclusive:!0}],["uv0",{size:2,data:[0,0],exclusive:!0}]],[["position",r],["normal",t?r:s],["uv0",s]],1)}function y(){const e=[0,0,0,0,0,100,100,0,0],t=new Uint16Array([0,1,2]),i=[0,1,0],n=new Uint16Array([0,0,0]),r=[0,0],s=new Uint16Array([0,0,0]);return new h["a"]([["position",{size:3,data:e,exclusive:!0}],["normal",{size:3,data:i,exclusive:!0}],["uv0",{size:2,data:r,exclusive:!0}]],[["position",t],["normal",n],["uv0",s]])}e.createBoxGeometry=p.createGeometry,e.createDiamondGeometry=u.createGeometry,e.createTetrahedronGeometry=f.createGeometry,e.createSphereGeometry=t,e.createPolySphereGeometry=i,e.createPointGeometry=n,e.updatePointGeometry=b,e.createPointArrayGeometry=v,e.createTriangleGeometry=y;const _=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function O(e=_){const t=new Array(12);for(let s=0;s<4;s++)for(let i=0;i<3;i++)t[3*s+i]=e[s][i];const i=new Uint32Array([0,1,2,2,3,0]),n=[0,0,1],r=new Uint32Array([0,0,0,0,0,0]);return new h["a"]([["position",{size:3,data:t,exclusive:!0}],["normal",{size:3,data:n,exclusive:!0}],["uv0",{size:2,data:[0,0,1,0,1,1,0,1],exclusive:!0}],["color",{size:4,data:[255,255,255,255],exclusive:!0}]],[["position",i],["normal",r],["uv0",i],["color",r]])}function j(e,t,i,n,r=!0,s=!0){let a=0;const c=t,l=e;let d=Object(o["d"])(0,a,0),p=Object(o["d"])(0,a+l,0),u=Object(o["d"])(0,-1,0),f=Object(o["d"])(0,1,0);n&&(a=l,p=Object(o["d"])(0,0,0),d=Object(o["d"])(0,a,0),u=Object(o["d"])(0,1,0),f=Object(o["d"])(0,-1,0));const b=[p,d],g=[u,f],m=i+2,v=Math.sqrt(l*l+c*c);if(n)for(let h=i-1;h>=0;h--){const e=h*(2*Math.PI/i),t=Object(o["d"])(Math.cos(e)*c,a,Math.sin(e)*c);b.push(t);const n=Object(o["d"])(l*Math.cos(e)/v,-c/v,l*Math.sin(e)/v);g.push(n)}else for(let h=0;h<i;h++){const e=h*(2*Math.PI/i),t=Object(o["d"])(Math.cos(e)*c,a,Math.sin(e)*c);b.push(t);const n=Object(o["d"])(l*Math.cos(e)/v,c/v,l*Math.sin(e)/v);g.push(n)}const y=new Uint32Array(2*(i+2)*3),_=new Uint32Array(2*(i+2)*3);let O=0,j=0;if(r){for(let e=3;e<b.length;e++)y[O++]=1,y[O++]=e-1,y[O++]=e,_[j++]=0,_[j++]=0,_[j++]=0;y[O++]=b.length-1,y[O++]=2,y[O++]=1,_[j++]=0,_[j++]=0,_[j++]=0}if(s){for(let e=3;e<b.length;e++)y[O++]=e,y[O++]=e-1,y[O++]=0,_[j++]=e,_[j++]=e-1,_[j++]=1;y[O++]=0,y[O++]=2,y[O++]=b.length-1,_[j++]=1,_[j++]=2,_[j++]=g.length-1}const x=new Float32Array(3*m);for(let o=0;o<m;o++)x[3*o]=b[o][0],x[3*o+1]=b[o][1],x[3*o+2]=b[o][2];const w=new Float32Array(3*m);for(let o=0;o<m;o++)w[3*o]=g[o][0],w[3*o+1]=g[o][1],w[3*o+2]=g[o][2];return new h["a"]([["position",{size:3,data:x,exclusive:!0}],["normal",{size:3,data:w,exclusive:!0}]],[["position",y],["normal",_]])}function x(e,t,i,n,r,a){const c=n?Object(o["a"])(n):Object(o["d"])(1,0,0),l=r?Object(o["a"])(r):Object(o["d"])(0,0,0);a=null==a||a;const d=Object(o["c"])();Object(s["s"])(d,c);const p=Object(o["c"])();Object(s["f"])(p,d,Math.abs(e));const u=Object(o["c"])();Object(s["f"])(u,p,-.5),Object(s["g"])(u,u,l);const f=Object(o["d"])(0,1,0);Math.abs(1-Object(s["i"])(d,f))<.2&&Object(s["x"])(f,0,0,1);const b=Object(o["c"])();Object(s["h"])(b,d,f),Object(s["s"])(b,b),Object(s["h"])(f,b,d);const g=2*i+(a?2:0),m=i+(a?2:0),v=new Float32Array(3*g),y=new Float32Array(3*m),_=new Float32Array(2*g),O=new Uint32Array(3*i*(a?4:2)),j=new Uint32Array(3*i*(a?4:2));a&&(v[3*(g-2)+0]=u[0],v[3*(g-2)+1]=u[1],v[3*(g-2)+2]=u[2],_[2*(g-2)]=0,_[2*(g-2)+1]=0,v[3*(g-1)+0]=v[3*(g-2)+0]+p[0],v[3*(g-1)+1]=v[3*(g-2)+1]+p[1],v[3*(g-1)+2]=v[3*(g-2)+2]+p[2],_[2*(g-1)]=1,_[2*(g-1)+1]=1,y[3*(m-2)+0]=-d[0],y[3*(m-2)+1]=-d[1],y[3*(m-2)+2]=-d[2],y[3*(m-1)+0]=d[0],y[3*(m-1)+1]=d[1],y[3*(m-1)+2]=d[2]);const x=function(e,t,i){O[e]=t,j[e]=i};let w=0;const S=Object(o["c"])(),P=Object(o["c"])();for(let o=0;o<i;o++){const e=o*(2*Math.PI/i);Object(s["f"])(S,f,Math.sin(e)),Object(s["f"])(P,b,Math.cos(e)),Object(s["g"])(S,S,P),y[3*o+0]=S[0],y[3*o+1]=S[1],y[3*o+2]=S[2],Object(s["f"])(S,S,t),Object(s["g"])(S,S,u),v[3*o+0]=S[0],v[3*o+1]=S[1],v[3*o+2]=S[2],_[2*o+0]=o/i,_[2*o+1]=0,v[3*(o+i)+0]=v[3*o+0]+p[0],v[3*(o+i)+1]=v[3*o+1]+p[1],v[3*(o+i)+2]=v[3*o+2]+p[2],_[2*(o+i)+0]=o/i,_[2*o+1]=1;const n=(o+1)%i;x(w++,o,o),x(w++,o+i,o),x(w++,n,n),x(w++,n,n),x(w++,o+i,o),x(w++,n+i,n)}if(a){for(let e=0;e<i;e++){const t=(e+1)%i;x(w++,g-2,m-2),x(w++,e,m-2),x(w++,t,m-2)}for(let e=0;e<i;e++){const t=(e+1)%i;x(w++,e+i,m-1),x(w++,g-1,m-1),x(w++,t+i,m-1)}}return new h["a"]([["position",{size:3,data:v,exclusive:!0}],["normal",{size:3,data:y,exclusive:!0}],["uv0",{size:2,data:_,exclusive:!0}]],[["position",O],["normal",j],["uv0",O]])}function w(t,i,n,r,s){n=n||10,r=null==r||r,Object(c["a"])(t.length>1);const o=[[0,0,0]],a=[],l=[];for(let e=0;e<n;e++){a.push([0,-e-1,-(e+1)%n-1]);const t=e/n*2*Math.PI;l.push([Math.cos(t)*i,Math.sin(t)*i])}return e.createPathExtrusionGeometry(l,t,o,a,r,s)}function S(e,t,i,n,c,l=Object(o["d"])(0,0,0)){const d=e.length,p=new Float32Array(t.length*d*3+(6*i.length||0)),u=new Float32Array(t.length*d*3+(i?6:0)),f=(t.length-1)*d*6+3*n.length*2,b=new Uint32Array(f),m=new Uint32Array(f);let v=0,y=0,_=0,O=0;const j=Object(o["c"])(),x=Object(o["c"])(),w=Object(o["c"])(),S=Object(o["c"])(),P=Object(o["c"])(),C=Object(o["c"])(),T=Object(o["c"])(),E=Object(r["e"])(),A=Object(o["c"])(),k=Object(o["c"])(),V=Object(o["c"])(),D=Object(o["c"])(),G=Object(o["c"])(),I=a["f"].create();Object(s["x"])(A,0,1,0),Object(s["k"])(x,t[1],t[0]),Object(s["s"])(x,x),c?(Object(s["g"])(E,t[0],l),Object(s["s"])(w,E)):Object(s["x"])(w,0,0,1),M(x,w,A,A,P,w,g),Object(s["l"])(S,w),Object(s["l"])(D,P);for(let r=0;r<i.length;r++)Object(s["f"])(C,P,i[r][0]),Object(s["f"])(E,w,i[r][2]),Object(s["g"])(C,C,E),Object(s["g"])(C,C,t[0]),p[v++]=C[0],p[v++]=C[1],p[v++]=C[2];u[y++]=-x[0],u[y++]=-x[1],u[y++]=-x[2];for(let r=0;r<n.length;r++)b[_++]=n[r][0]>0?n[r][0]:-n[r][0]-1+i.length,b[_++]=n[r][1]>0?n[r][1]:-n[r][1]-1+i.length,b[_++]=n[r][2]>0?n[r][2]:-n[r][2]-1+i.length,m[O++]=0,m[O++]=0,m[O++]=0;let R=i.length;const z=i.length-1;for(let r=0;r<t.length;r++){let i=!1;r>0&&(Object(s["l"])(j,x),r<t.length-1?(Object(s["k"])(x,t[r+1],t[r]),Object(s["s"])(x,x)):i=!0,Object(s["g"])(k,j,x),Object(s["s"])(k,k),Object(s["g"])(V,t[r-1],S),a["f"].fromPositionAndNormal(t[r],k,I),a["f"].intersectRay(I,a["g"].wrap(V,j),E)?(Object(s["k"])(E,E,t[r]),Object(s["s"])(w,E),Object(s["h"])(P,k,w),Object(s["s"])(P,P)):M(k,S,D,A,P,w,g),Object(s["l"])(S,w),Object(s["l"])(D,P)),c&&(Object(s["g"])(E,t[r],l),Object(s["s"])(G,E));for(let n=0;n<d;n++)if(Object(s["f"])(C,P,e[n][0]),Object(s["f"])(E,w,e[n][1]),Object(s["g"])(C,C,E),Object(s["s"])(T,C),u[y++]=T[0],u[y++]=T[1],u[y++]=T[2],Object(s["g"])(C,C,t[r]),p[v++]=C[0],p[v++]=C[1],p[v++]=C[2],!i){const e=(n+1)%d;b[_++]=R+n,b[_++]=R+d+n,b[_++]=R+e,b[_++]=R+e,b[_++]=R+d+n,b[_++]=R+d+e;for(let t=0;t<6;t++)m[O++]=b[_-6+t]-z}R+=d}const L=t[t.length-1];for(let r=0;r<i.length;r++)Object(s["f"])(C,P,i[r][0]),Object(s["f"])(E,w,i[r][1]),Object(s["g"])(C,C,E),Object(s["g"])(C,C,L),p[v++]=C[0],p[v++]=C[1],p[v++]=C[2];const H=y/3;u[y++]=x[0],u[y++]=x[1],u[y++]=x[2];const U=R-d;for(let r=0;r<n.length;r++)b[_++]=n[r][0]>=0?R+n[r][0]:-n[r][0]-1+U,b[_++]=n[r][2]>=0?R+n[r][2]:-n[r][2]-1+U,b[_++]=n[r][1]>=0?R+n[r][1]:-n[r][1]-1+U,m[O++]=H,m[O++]=H,m[O++]=H;return new h["a"]([["position",{size:3,data:p,exclusive:!0}],["normal",{size:3,data:u,exclusive:!0}]],[["position",b],["normal",m]])}function P(e,t,i){Object(c["a"])(e.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),Object(c["a"])(3===e[0].length,"createPolylineGeometry(): malformed vertex"),Object(c["a"])(null==t||t.length===e.length,"createPolylineGeometry: need same number of points and normals"),Object(c["a"])(null==t||3===t[0].length,"createPolylineGeometry(): malformed normal");const n=new Float64Array(3*e.length),r=new Uint32Array(2*(e.length-1));let s=0,o=0;for(let c=0;c<e.length;c++){for(let t=0;t<3;t++)n[s++]=e[c][t];c>0&&(r[o++]=c-1,r[o++]=c)}const a=[],d=[];if(a.push(["position",r]),d.push(["position",{size:3,data:n,exclusive:!0}]),t){const i=new Float32Array(3*t.length);let n=0;for(let r=0;r<e.length;r++)for(let e=0;e<3;e++)i[n++]=t[r][e];a.push(["normal",r]),d.push(["normal",{size:3,data:i,exclusive:!0}])}return i&&(d.push(["color",{size:4,data:i}]),a.push(["color",Object(l["d"])(i.length/4)])),new h["a"](d,a,2)}function C(e,t,i,n){const r=new Array(18),s=[[-t,0,n/2],[i,0,n/2],[0,e,n/2],[-t,0,-n/2],[i,0,-n/2],[0,e,-n/2]],o=new Uint16Array([0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5]);for(let a=0;a<6;a++)r[3*a]=s[a][0],r[3*a+1]=s[a][1],r[3*a+2]=s[a][2];return new h["a"]([["position",{size:3,data:r,exclusive:!0}]],[["position",o]])}function T(e,t){const i=e.getMutableAttribute("position").data;for(let n=0;n<i.length;n+=3){const e=i[n],r=i[n+1],o=i[n+2];Object(s["x"])(m,e,r,o),Object(s["n"])(m,m,t),i[n]=m[0],i[n+1]=m[1],i[n+2]=m[2]}}function E(e,t=e){const i=e.vertexAttributes,n=i.get("position").data,r=i.get("normal").data;if(r){const e=t.getMutableAttribute("normal").data;for(let t=0;t<r.length;t+=3){const i=r[t+1];e[t+1]=-r[t+2],e[t+2]=i}}if(n){const e=t.getMutableAttribute("position").data;for(let t=0;t<n.length;t+=3){const i=n[t+1];e[t+1]=-n[t+2],e[t+2]=i}}return t}function A(e,t,i,n,r){return!(Math.abs(Object(s["i"])(t,e))>r)&&(Object(s["h"])(i,e,t),Object(s["s"])(i,i),Object(s["h"])(n,i,e),Object(s["s"])(n,n),!0)}function M(e,t,i,n,r,s,o){return A(e,t,r,s,o)||A(e,i,r,s,o)||A(e,n,r,s,o)}e.createSquareGeometry=O,e.createConeGeometry=j,e.createCylinderGeometry=x,e.createTubeGeometry=w,e.createPathExtrusionGeometry=S,e.createPolylineGeometry=P,e.createExtrudedTriangle=C,e.transformInPlace=T,e.cgToGIS=E,e.makeOrthoBasisDirUp=A,e.makeOrthoBasisDirUpFallback=M}(b||(b={}));const g=.99619469809,m=Object(o["c"])();var v=b;t["a"]=v},cdc1:function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return h})),i.d(t,"c",(function(){return l})),i.d(t,"d",(function(){return o})),i.d(t,"e",(function(){return c}));var n=i("32ed"),r=i("28b1"),s=i("9180");function o(e,t,i,r){if(null==r||e.hasZ||(r=void 0),"point"===e.type)return e.x+=t,e.y+=i,e.hasZ&&null!=r&&(e.z+=r),e;if("multipoint"===e.type){const n=e.points;for(let e=0;e<n.length;e++)n[e]=d(n[e],t,i,r);return e}if("extent"===e.type)return e.xmin+=t,e.xmax+=t,e.ymin+=i,e.ymax+=i,null!=r&&(e.zmin+=r,e.zmax+=r),e;const s=Object(n["b"])(e),o="polyline"===e.type?e.paths:e.rings;for(let n=0;n<s.length;n++){const e=s[n];for(let n=0;n<e.length;n++)e[n]=d(e[n],t,i,r)}return"paths"in e?e.paths=o:e.rings=o,e}function a(e,t,i,r,s){const a=e.clone(),c=r.resolution;if("point"===a.type){if(s)o(a,t*c,-i*c);else{const e=r.state.transform,n=r.state.inverseTransform,s=e[0]*a.x+e[2]*a.y+e[4],o=e[1]*a.x+e[3]*a.y+e[5];a.x=n[0]*(s+t)+n[2]*(o+i)+n[4],a.y=n[1]*(s+t)+n[3]*(o+i)+n[5]}return a}if("multipoint"===a.type){if(s)o(a,t*c,-i*c);else{const e=a.points,n=r.state.transform,s=r.state.inverseTransform;for(let r=0;r<e.length;r++){const o=e[r],a=n[0]*o[0]+n[2]*o[1]+n[4],c=n[1]*o[0]+n[3]*o[1]+n[5],l=s[0]*(a+t)+s[2]*(c+i)+s[4],h=s[1]*(a+t)+s[3]*(c+i)+s[5];e[r]=p(o,l,h,void 0)}}return a}if("extent"===a.type){if(s)o(a,t*c,-i*c);else{const e=r.state.transform,n=r.state.inverseTransform,s=e[0]*a.xmin+e[2]*a.ymin+e[4],o=e[1]*a.xmin+e[3]*a.ymin+e[5],c=e[0]*a.xmax+e[2]*a.ymax+e[4],l=e[1]*a.xmax+e[3]*a.ymax+e[5];a.xmin=n[0]*(s+t)+n[2]*(o+i)+n[4],a.ymin=n[1]*(s+t)+n[3]*(o+i)+n[5],a.xmax=n[0]*(c+t)+n[2]*(l+i)+n[4],a.ymax=n[1]*(c+t)+n[3]*(l+i)+n[5]}return a}if(s)o(a,t*c,-i*c);else{const e=Object(n["b"])(a),s="polyline"===a.type?a.paths:a.rings,o=r.state.transform,c=r.state.inverseTransform;for(let n=0;n<e.length;n++){const r=e[n];for(let e=0;e<r.length;e++){const n=r[e],s=o[0]*n[0]+o[2]*n[1]+o[4],a=o[1]*n[0]+o[3]*n[1]+o[5],l=c[0]*(s+t)+c[2]*(a+i)+c[4],h=c[1]*(s+t)+c[3]*(a+i)+c[5];r[e]=p(n,l,h,void 0)}}"paths"in a?a.paths=s:a.rings=s}return a}function c(e,t,i,o){if("point"===e.type){const{x:n,y:r}=e,s=o?o[0]:n,a=o?o[1]:r,c=e.clone(),l=(n-s)*t+s,h=(r-a)*i+a;return c.x=l,c.y=h,c}if("multipoint"===e.type){const a=Object(n["b"])(e),c=Object(s["l"])(),[l,h,d,u]=Object(r["d"])(c,[a]),f=o?o[0]:(l+d)/2,b=o?o[1]:(u+h)/2,g=e.clone(),m=g.points;for(let e=0;e<m.length;e++){const n=m[e],[r,s]=n,o=(r-f)*t+f,a=(s-b)*i+b;m[e]=p(n,o,a,void 0)}return g}if("extent"===e.type){const{xmin:n,xmax:r,ymin:s,ymax:a}=e,c=o?o[0]:(n+r)/2,l=o?o[1]:(a+s)/2,h=e.clone();if(h.xmin=(n-c)*t+c,h.ymax=(a-l)*i+l,h.xmax=(r-c)*t+c,h.ymin=(s-l)*i+l,h.xmin>h.xmax){const e=h.xmin,t=h.xmax;h.xmin=t,h.xmax=e}if(h.ymin>h.ymax){const e=h.ymin,t=h.ymax;h.ymin=t,h.ymax=e}return h}const a=Object(n["b"])(e),c=Object(s["l"])(),[l,h,d,u]=Object(r["d"])(c,a),f=o?o[0]:(l+d)/2,b=o?o[1]:(u+h)/2,g=e.clone(),m="polyline"===g.type?g.paths:g.rings;for(let n=0;n<a.length;n++){const e=a[n];for(let r=0;r<e.length;r++){const s=e[r],[o,a]=s,c=(o-f)*t+f,l=(a-b)*i+b;m[n][r]=p(s,c,l,void 0)}}return"paths"in g?g.paths=m:g.rings=m,g}function l(e,t,i,n,r,s){const o=Math.sqrt((i-e)*(i-e)+(n-t)*(n-t));return Math.sqrt((r-e)*(r-e)+(s-t)*(s-t))/o}function h(e,t,i,n,r,s){const o=180*Math.atan2(t-n,e-i)/Math.PI;return 180*Math.atan2(t-s,e-r)/Math.PI-o}function d(e,t,i,n){return p(e,e[0]+t,e[1]+i,null!=e[2]&&null!=n?e[2]+n:void 0)}function p(e,t,i,n){const r=[t,i];return e.length>2&&r.push(null!=n?n:e[2]),e.length>3&&r.push(e[3]),r}},ce0b:function(e,t,i){"use strict";var n=i("a4ee"),r=(i("c120"),i("e92d"),i("cea0"),i("59b2")),s=i("d386"),o=(i("e041"),i("8eed"),i("f402"),i("a6a3")),a=i("fd14"),c=i("997b"),l=i("5a62"),h=i("f626");let d=class extends(Object(c["a"])(Object(l["a"])(o["a"]))){constructor(e){super(e),this.elevationInfo=null,this.graphics=new h["b"],this.screenSizePerspectiveEnabled=!0,this.type="graphics",this.internal=!1}destroy(){this.removeAll(),this.graphics.destroy()}add(e){return this.graphics.add(e),this}addMany(e){return this.graphics.addMany(e),this}removeAll(){return this.graphics.removeAll(),this}remove(e){this.graphics.remove(e)}removeMany(e){this.graphics.removeMany(e)}on(e,t){return super.on(e,t)}graphicChanged(e){this.emit("graphic-update",e)}};Object(n["a"])([Object(r["b"])({type:a["a"]})],d.prototype,"elevationInfo",void 0),Object(n["a"])([Object(r["b"])(Object(h["c"])())],d.prototype,"graphics",void 0),Object(n["a"])([Object(r["b"])({type:["show","hide"]})],d.prototype,"listMode",void 0),Object(n["a"])([Object(r["b"])()],d.prototype,"screenSizePerspectiveEnabled",void 0),Object(n["a"])([Object(r["b"])({readOnly:!0})],d.prototype,"type",void 0),Object(n["a"])([Object(r["b"])({constructOnly:!0})],d.prototype,"internal",void 0),d=Object(n["a"])([Object(s["a"])("esri.layers.GraphicsLayer")],d);var p=d;t["a"]=p},d0cb:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var n=i("3886"),r=i("2f98");function s(e,t){const i=e;i.include(r["a"]),i.attributes.add("position","vec3"),i.attributes.add("normal","vec3"),i.attributes.add("auxpos1","vec4"),i.vertex.uniforms.add("proj","mat4"),i.vertex.uniforms.add("view","mat4"),i.vertex.uniforms.add("viewNormal","mat4"),i.vertex.uniforms.add("viewport","vec4"),i.vertex.uniforms.add("camPos","vec3"),i.vertex.uniforms.add("polygonOffset","float"),i.vertex.uniforms.add("cameraGroundRelative","float"),i.vertex.uniforms.add("pixelRatio","float"),i.vertex.uniforms.add("perDistancePixelRatio","float"),i.vertex.uniforms.add("uRenderTransparentlyOccludedHUD","float"),t.verticalOffsetEnabled&&i.vertex.uniforms.add("verticalOffset","vec4"),t.screenSizePerspectiveEnabled&&i.vertex.uniforms.add("screenSizePerspectiveAlignment","vec4"),i.vertex.uniforms.add("hudVisibilityTexture","sampler2D"),i.vertex.constants.add("smallOffsetAngle","float",.984807753012208),i.vertex.code.add(n["a"]`
    struct ProjectHUDAux {
      vec3 posModel;
      vec3 posView;
      vec3 vnormal;

      float distanceToCamera;
      float absCosAngle;
    };
  `),i.vertex.code.add(n["a"]`
    float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
      float pointGroundSign = sign(pointGroundDistance);

      if (pointGroundSign == 0.0) {
        pointGroundSign = cameraGroundRelative;
      }

      // cameraGroundRelative is -1 if camera is below ground, 1 if above ground
      // groundRelative is 1 if both camera and symbol are on the same side of the ground, -1 otherwise
      float groundRelative = cameraGroundRelative * pointGroundSign;

      // view angle dependent part of polygon offset emulation
      // we take the absolute value because the sign that is dropped is
      // instead introduced using the ground-relative position of the symbol and the camera
      if (polygonOffset > .0) {
        float cosAlpha = clamp(absCosAngle, 0.01, 1.0);

        float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
        float factor = (1.0 - tanAlpha / viewport[2]);

        // same side of the terrain
        if (groundRelative > 0.0) {
          posView *= factor;
        }
        // opposite sides of the terrain
        else {
          posView /= factor;
        }
      }

      return groundRelative;
    }
  `),t.isDraped||i.vertex.code.add(n["a"]`
    void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
      float distanceToCamera = length(posView);

      // Compute offset in world units for a half pixel shift
      float pixelOffset = distanceToCamera * perDistancePixelRatio * 0.5;

      // Apply offset along normal in the direction away from the ground surface
      vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;

      // Apply the same offset also on the view space position
      vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;

      posModel += modelOffset;
      posView += viewOffset;
    }
  `),i.vertex.code.add(n["a"]`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      // centerOffset is in view space and is used to implement world size offsetting
      // of labels with respect to objects. It also pulls the label towards the viewer
      // so that the label is visible in front of the object.
      vec3 centerOffset = auxpos1.xyz;

      // The pointGroundDistance is the distance of the geometry to the ground and is
      // negative if the point is below the ground, or positive if the point is above
      // ground.
      float pointGroundDistance = auxpos1.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${t.isDraped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(camPos - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${t.screenSizePerspectiveEnabled&&(t.verticalOffsetEnabled||1===t.screenCenterOffsetUnitsEnabled)?"vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":""}

      ${t.verticalOffsetEnabled?t.screenSizePerspectiveEnabled?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":""}

      ${t.verticalOffsetEnabled?n["a"]`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${1!==t.screenCenterOffsetUnitsEnabled?n["a"]`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `:""}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${1===t.screenCenterOffsetUnitsEnabled?t.screenSizePerspectiveEnabled?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":""}

      ${1===t.screenCenterOffsetUnitsEnabled?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `),i.vertex.code.add(n["a"]`
    bool testVisibilityHUD(vec4 posProj) {
      // For occlusion testing, use the nearest pixel center to avoid
      // subpixel filtering messing up the color we use to test for
      vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      vec4 occlusionPixel = texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);

      // the red pixel here indicates that the occlusion pixel passed the depth test against solid geometry and was written
      // the green pixel stores transparency of transparent geometry (1.0 -> fully transparent)
      // note that we also check against green == 0.0, i.e. transparent geometry that has opaque parts

      // thus we render visible pixels that are occluded by semi-transparent (but not fully transparent!) geometry here
      if (uRenderTransparentlyOccludedHUD > 0.5) {
        // multiplying by uRenderTransparentlyOccludedHUD allows us to ignore the second condition if
        // uRenderTransparentlyOccludedHUD = 0.75
        return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * uRenderTransparentlyOccludedHUD < 1.0;
      }

      // and visible pixels that are not occluded by semi-transparent geometry here
      return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
    }
  `)}!function(e){function t(e,t){e.setUniform1f("uRenderTransparentlyOccludedHUD",0===t.renderTransparentlyOccludedHUD?1:1===t.renderTransparentlyOccludedHUD?0:.75)}function i(e,t,i){t.setUniform1i("hudVisibilityTexture",4),e.bindTexture(i.hudVisibilityTexture,4),e.setActiveTexture(0)}e.bindUniforms=t,e.bindVisibilityTexture=i}(s||(s={}))},d232:function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));i("c120");var n=i("e92d"),r=i("6706"),s=i("7dcb");n["a"].getLogger("esri.views.interactive.snapping.hints.ParallelSnappingHint");class o extends s["a"]{constructor(e,t){super(),this.lineStart=e,this.lineEnd=t}equals(e){return e instanceof o&&Object(r["d"])(this.lineStart,e.lineStart)&&Object(r["d"])(this.lineEnd,e.lineEnd)}}},d28b:function(e,t,i){var n=i("746f");n("iterator")},d36e:function(e,t,i){"use strict";i.d(t,"a",(function(){return w}));var n=i("d7f7"),r=i("7c51"),s=i("35b3"),o=i("7438"),a=i("8675"),c=i("a4ee"),l=i("c3a4"),h=i("ca98"),d=i("da35"),p=i("fa1e"),u=i("8e37"),f=i("189c"),b=i("8e97"),g=i("d272"),m=i("6a07"),v=i("c6d7"),y=i("87b7"),_=i("1962");class O extends h["a"]{initializeProgram(e){const t=O.shader.get(),i=this.configuration,n=t.build({output:i.output,OITEnabled:0===i.transparencyPassType,attributeColor:i.vertexColors,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,multipassTerrainEnabled:i.multipassTerrainEnabled,cullAboveGround:i.cullAboveGround});return new u["a"](e.rctx,n.generateSource("vertex"),n.generateSource("fragment"),p["a"])}bindPass(e,t,i){b["a"].bindProjectionMatrix(this.program,i.camera.projectionMatrix),this.program.setUniform4fv("eColor",t.color),4===this.configuration.output&&m["a"].bindOutputHighlight(e,this.program,i),(1===this.configuration.output||i.multipassTerrainEnabled)&&this.program.setUniform2fv("cameraNearFar",i.camera.nearFar),i.multipassTerrainEnabled&&(this.program.setUniform2fv("inverseViewport",i.inverseViewport),Object(v["a"])(this.program,e,i))}bindDraw(e){b["a"].bindView(this.program,e),g["a"].bindUniformsWithOrigin(this.program,this.configuration,e)}setPipelineState(e,t){const i=this.configuration,n=3===e,r=2===e,s=e=>0!==e&&{face:1===e?1028:1029,mode:2305};return Object(f["e"])({blending:0!==i.output&&7!==i.output||!i.transparent?null:n?o["f"]:Object(o["a"])(e),culling:s(i.cullFace),depthTest:{func:Object(o["b"])(e)},depthWrite:n||r?i.writeDepth&&f["d"]:null,colorWrite:f["c"],stencilWrite:i.sceneHasOcludees?y["j"]:null,stencilTest:i.sceneHasOcludees?t?y["f"]:y["e"]:null,polygonOffset:n||r?i.polygonOffset&&j:Object(o["g"])(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this.setPipelineState(this.configuration.transparencyPassType,!0),this.setPipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(e){return e?this._occludeePipelineState:this.pipeline}}O.shader=new l["a"](_["a"],()=>i.e("chunk-2d0de726").then(i.bind(null,"864f")));const j={factor:1,units:1};class x extends d["a"]{constructor(){super(...arguments),this.output=0,this.cullFace=0,this.slicePlaneEnabled=!1,this.vertexColors=!1,this.transparent=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.sceneHasOcludees=!1,this.transparencyPassType=3,this.multipassTerrainEnabled=!1,this.cullAboveGround=!0}}Object(c["a"])([Object(d["b"])({count:8})],x.prototype,"output",void 0),Object(c["a"])([Object(d["b"])({count:3})],x.prototype,"cullFace",void 0),Object(c["a"])([Object(d["b"])()],x.prototype,"slicePlaneEnabled",void 0),Object(c["a"])([Object(d["b"])()],x.prototype,"vertexColors",void 0),Object(c["a"])([Object(d["b"])()],x.prototype,"transparent",void 0),Object(c["a"])([Object(d["b"])()],x.prototype,"polygonOffset",void 0),Object(c["a"])([Object(d["b"])()],x.prototype,"enableOffset",void 0),Object(c["a"])([Object(d["b"])()],x.prototype,"writeDepth",void 0),Object(c["a"])([Object(d["b"])()],x.prototype,"sceneHasOcludees",void 0),Object(c["a"])([Object(d["b"])({count:4})],x.prototype,"transparencyPassType",void 0),Object(c["a"])([Object(d["b"])()],x.prototype,"multipassTerrainEnabled",void 0),Object(c["a"])([Object(d["b"])()],x.prototype,"cullAboveGround",void 0);class w extends s["a"]{constructor(e){super(e,P),this.supportsEdges=!0,this.techniqueConfig=new x}getTechniqueConfig(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.cullFace=this.params.cullFace,this.techniqueConfig.vertexColors=this.params.vertexColors,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.transparent=this.params.transparent,this.techniqueConfig.polygonOffset=this.params.polygonOffset,this.techniqueConfig.writeDepth=this.params.writeDepth,this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees,this.techniqueConfig.transparencyPassType=t?t.transparencyPassType:3,this.techniqueConfig.enableOffset=!t||t.camera.relativeElevation<o["e"],this.techniqueConfig.multipassTerrainEnabled=!!t&&t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=!t||t.cullAboveGround,this.techniqueConfig}getPassParameters(){return this.params}intersect(e,t,i,n,s,o,a){Object(r["i"])(e,t,n,s,o,void 0,a)}getGLMaterial(e){return 0===e.output||7===e.output||4===e.output||1===e.output&&this.params.writeLinearDepth?new S(e):void 0}createBufferWriter(){return new a["a"](a["b"])}}class S extends n["a"]{constructor(e){super(e),this.updateParameters()}updateParameters(e){this.technique=this.techniqueRep.acquireAndReleaseExisting(O,this.material.getTechniqueConfig(this.output,e),this.technique)}beginSlot(e){return 4===this.output?3===e:e===(this.technique.configuration.transparent?this.technique.configuration.writeDepth?5:8:3)}_updateOccludeeState(e){e.hasOccludees!==this.material.params.sceneHasOcludees&&this.material.setParameterValues({sceneHasOcludees:e.hasOccludees})}ensureParameters(e){0!==this.output&&7!==this.output||this._updateOccludeeState(e),this.updateParameters(e)}bind(e,t){e.bindProgram(this.technique.program),this.technique.bindPass(e,this.material.getPassParameters(),t)}getPipelineState(e,t){return this.technique.getPipelineState(t)}}const P={color:[1,1,1,1],transparent:!1,writeDepth:!0,writeLinearDepth:!1,vertexColors:!1,polygonOffset:!1,slicePlaneEnabled:!1,cullFace:0,sceneHasOcludees:!1,...s["b"]}},d3cf:function(e,t,i){"use strict";i.d(t,"a",(function(){return y})),i.d(t,"b",(function(){return u})),i.d(t,"c",(function(){return p})),i.d(t,"d",(function(){return l}));i("c120");var n=i("a21b"),r=i("7ffa"),s=i("b2b2"),o=i("a9ab"),a=i("8d60"),c=i("1a54");function l(e){return"declaredClass"in e}function h(e){return"declaredClass"in e}function d(e){return"declaredClass"in e}function p(e,t){if(!e)return null;if(d(e))return e;const i=new a["a"]({layer:t,sourceLayer:t});return i.visible=e.visible,i.symbol=Object(r["a"])(e.symbol),i.attributes=Object(r["a"])(e.attributes),i.geometry=u(e.geometry),i}function u(e){return Object(s["j"])(e)?null:l(e)?e:Object(o["a"])(f(e))}function f(e){const t=e.spatialReference.toJSON();switch(e.type){case"point":{const{x:i,y:n,z:r,m:s}=e;return{x:i,y:n,z:r,m:s,spatialReference:t}}case"polygon":{const{rings:i,hasZ:n,hasM:r}=e;return{rings:b(i),hasZ:n,hasM:r,spatialReference:t}}case"polyline":{const{paths:i,hasZ:n,hasM:r}=e;return{paths:b(i),hasZ:n,hasM:r,spatialReference:t}}case"extent":{const{xmin:i,xmax:n,ymin:r,ymax:s,zmin:o,zmax:a,mmin:c,mmax:l,hasZ:h,hasM:d}=e;return{xmin:i,xmax:n,ymin:r,ymax:s,zmin:o,zmax:a,mmin:c,mmax:l,hasZ:h,hasM:d,spatialReference:t}}case"multipoint":{const{points:i,hasZ:n,hasM:r}=e;return{points:v(i)?g(i):i,hasZ:n,hasM:r,spatialReference:t}}default:return}}function b(e){return m(e)?e.map(e=>g(e)):e}function g(e){return e.map(e=>Object(n["n"])(e))}function m(e){for(const t of e)if(0!==t.length)return v(t);return!1}function v(e){return e.length&&(Object(n["d"])(e[0])||Object(n["e"])(e[0]))}function y(e,t){if(!e)return null;let i;if(h(e)){if(null==t)return e.clone();if(h(t))return t.copy(e)}return null!=t?(i=t,i.x=e.x,i.y=e.y,i.spatialReference=e.spatialReference,e.hasZ?(i.z=e.z,i.hasZ=e.hasZ):(i.z=null,i.hasZ=!1),e.hasM?(i.m=e.m,i.hasM=!0):(i.m=null,i.hasM=!1)):(i=Object(c["k"])(e.x,e.y,e.z,e.spatialReference),e.hasM&&(i.m=e.m,i.hasM=!0)),i}},dd63:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var n=i("b2b2"),r=i("3795"),s=i("5a22"),o=i("748f");class a{constructor(e){this.resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1}destroy(){this._destroyResources()}get object(){return Object(n["k"])(this._resources)?this._resources.object:null}get resources(){return Object(n["k"])(this._resources)?this._resources.external:null}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncVisible())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}recreate(){this.attached&&this._createResources()}recreateGeometry(){if(!this.resourceFactory.recreateGeometry)return void this.recreate();const e=this.resourceFactory.view._stage;if(Object(n["j"])(this._resources)||!e)return;const t=this._resources.object;this._resources.external.forEach(t=>{2===t.type&&e.remove(t)}),t.removeAllGeometries();const i=this.resourceFactory.recreateGeometry(this._resources.external,t,this._resources.layer);e.addMany(i),this._resources.layer.commit()}_createOrDestroyResources(){this._attached?this._resources||this._createResources():this._destroyResources()}_createResources(){this._destroyResources();const e=this.resourceFactory.view._stage;if(!e)return;const t=new o["a"]({isPickable:!1});e.add(t);const i=new s["a"]({castShadow:!1}),n=this.resourceFactory.createResources(i,t);n.forEach(t=>e.add(t)),e.add(i),t.add(i),t.commit(),this._syncVisible();const a=this.resourceFactory.cameraChanged?Object(r["a"])(this.resourceFactory.view.state,"camera",e=>this.resourceFactory.cameraChanged(e)):null;this._resources={layer:t,object:i,external:n,cameraHandle:a}}_destroyResources(){if(Object(n["j"])(this._resources))return;const e=this.resourceFactory.view._stage;null==e||e.remove(this._resources.object),null==e||e.remove(this._resources.layer),this._resources.external.forEach(t=>{null==e||e.remove(t),"dispose"in t&&t.dispose()}),this._resources.object.dispose(),this._resources.cameraHandle&&this._resources.cameraHandle.remove(),this._resources=null}_syncVisible(){Object(n["j"])(this._resources)||(this._resources.object.setVisible(this._visible),this._resources.layer.commit())}}},df3b:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));class n{constructor(e,t,i){this.coordinateHelper=e,this.targetPoint=t,this.constraint=i}}},e01a:function(e,t,i){"use strict";var n=i("23e7"),r=i("83ab"),s=i("da84"),o=i("5135"),a=i("861d"),c=i("9bf2").f,l=i("e893"),h=s.Symbol;if(r&&"function"==typeof h&&(!("description"in h.prototype)||void 0!==h().description)){var d={},p=function(){var e=arguments.length<1||void 0===arguments[0]?void 0:String(arguments[0]),t=this instanceof p?new h(e):void 0===e?h():h(e);return""===e&&(d[t]=!0),t};l(p,h);var u=p.prototype=h.prototype;u.constructor=p;var f=u.toString,b="Symbol(test)"==String(h("test")),g=/^Symbol\((.*)\)[^)]+$/;c(u,"description",{configurable:!0,get:function(){var e=a(this)?this.valueOf():this,t=f.call(e);if(o(d,e))return"";var i=b?t.slice(7,-1):t.replace(g,"$1");return""===i?void 0:i}}),n({global:!0,forced:!0},{Symbol:p})}},e1e0:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var n=i("b50f"),r=i("34f2");class s extends r["a"]{constructor(e,t,i,n=0){super(e),this.origin=t,this.angle=i,this.accumulationType=n}rotate(e,t){this.helper.rotate(e.pos,this.origin,t)}apply(e){this.rotate(e,this.angle)}undo(e){this.rotate(e,-this.angle)}canAccumulate(e){return e instanceof s&&Object(n["e"])(this.origin,e.origin)}accumulate(e,t){const i=1===t.accumulationType;this.rotate(e,i?t.angle-this.angle:t.angle)}accumulateParams(e){const t=1===e.accumulationType;this.angle=t?e.angle:this.angle+e.angle}}},e538:function(e,t,i){var n=i("b622");t.f=n},e6aa:function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));var n=i("3886");function r(e,t){e.vertex.uniforms.add("intrinsicWidth","float"),t.vvSize?(e.attributes.add("sizeFeatureAttribute","float"),e.vertex.uniforms.add("vvSizeMinSize","vec3"),e.vertex.uniforms.add("vvSizeMaxSize","vec3"),e.vertex.uniforms.add("vvSizeOffset","vec3"),e.vertex.uniforms.add("vvSizeFactor","vec3"),e.vertex.code.add(n["a"]`
    float getSize() {
      return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;
    }
    `)):(e.attributes.add("size","float"),e.vertex.code.add(n["a"]`
    float getSize(){
      return intrinsicWidth * size;
    }
    `)),t.vvOpacity?(e.attributes.add("opacityFeatureAttribute","float"),e.vertex.constants.add("vvOpacityNumber","int",8),e.vertex.code.add(n["a"]`
    uniform float vvOpacityValues[vvOpacityNumber];
    uniform float vvOpacityOpacities[vvOpacityNumber];

    float interpolateOpacity( float value ){
      if (value <= vvOpacityValues[0]) {
        return vvOpacityOpacities[0];
      }

      for (int i = 1; i < vvOpacityNumber; ++i) {
        if (vvOpacityValues[i] >= value) {
          float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
          return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
        }
      }

      return vvOpacityOpacities[vvOpacityNumber - 1];
    }

    vec4 applyOpacity( vec4 color ){
      return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));
    }
    `)):e.vertex.code.add(n["a"]`
    vec4 applyOpacity( vec4 color ){
      return color;
    }
    `),t.vvColor?(e.attributes.add("colorFeatureAttribute","float"),e.vertex.constants.add("vvColorNumber","int",8),e.vertex.code.add(n["a"]`
    uniform float vvColorValues[vvColorNumber];
    uniform vec4 vvColorColors[vvColorNumber];

    vec4 interpolateColor( float value ) {
      if (value <= vvColorValues[0]) {
        return vvColorColors[0];
      }

      for (int i = 1; i < vvColorNumber; ++i) {
        if (vvColorValues[i] >= value) {
          float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
          return mix(vvColorColors[i-1], vvColorColors[i], f);
        }
      }

      return vvColorColors[vvColorNumber - 1];
    }

    vec4 getColor(){
      return applyOpacity(interpolateColor(colorFeatureAttribute));
    }
    `)):(e.attributes.add("color","vec4"),e.vertex.code.add(n["a"]`
    vec4 getColor(){
      return applyOpacity(color);
    }
    `))}},e6b5:function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));i("c120");var n=i("e92d"),r=i("6706"),s=i("7dcb");n["a"].getLogger("esri.views.interactive.snapping.hints.LineSnappingHint");class o extends s["a"]{constructor(e,t,i,n=!0,r=!0){super(),this.type=e,this.lineStart=t,this.lineEnd=i,this.fadeLeft=n,this.fadeRight=r}equals(e){return e instanceof o&&this.type===e.type&&Object(r["d"])(this.lineStart,e.lineStart)&&Object(r["d"])(this.lineEnd,e.lineEnd)&&this.fadeLeft===e.fadeLeft&&this.fadeRight===e.fadeRight}}},e753:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var n=i("6706"),r=i("7dcb");class s extends r["a"]{constructor(e){super(),this.intersectionPoint=e}equals(e){return e instanceof s&&Object(n["d"])(this.intersectionPoint,e.intersectionPoint)}}},e9d6:function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return l})),i.d(t,"c",(function(){return c})),i.d(t,"d",(function(){return h})),i.d(t,"e",(function(){return p})),i.d(t,"f",(function(){return u})),i.d(t,"g",(function(){return d})),i.d(t,"h",(function(){return f}));var n=i("e92d"),r=i("82fa"),s=i("d3cf");const o=n["a"].getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function a(e){return{cachedResult:e.cachedResult,arcade:e.arcade?{func:e.arcade.func,context:e.arcade.modules.arcadeUtils.createExecContext(null,{sr:e.arcade.context.spatialReference}),modules:e.arcade.modules}:null}}function c(e){const t=e&&e.expression;if("string"==typeof t){const e=g(t);if(null!=e)return{cachedResult:e}}return null}async function l(e,t,i){const n=e&&e.expression;if("string"!=typeof n)return null;const s=g(n);if(null!=s)return{cachedResult:s};const o=await Object(r["e"])(),a=o.arcadeUtils,c=a.createSyntaxTree(n);return a.dependsOnView(c)?(null!=i&&i.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:a.createFunction(c),context:a.createExecContext(null,{sr:t}),modules:o}}}function h(e,t,i){return e.arcadeUtils.createFeature(t.attributes,t.geometry,i)}function d(e,t){if(null!=e&&!b(e)){if(!t||!e.arcade)return void o.errorOncePerTick("Arcade support required but not provided");const i=t;i._geometry&&(i._geometry=Object(s["b"])(i._geometry)),e.arcade.modules.arcadeUtils.updateExecContext(e.arcade.context,t)}}function p(e){if(null!=e){if(b(e))return e.cachedResult;const t=e.arcade;let i=e.arcade.modules.arcadeUtils.executeFunction(t.func,t.context);return"number"!=typeof i&&(e.cachedResult=0,i=0),i}return 0}function u(e,t=!1){let i=e&&e.featureExpressionInfo;const n=i&&i.expression;return t||"0"===n||(i=null),i}const f={cachedResult:0};function b(e){return null!=e.cachedResult}function g(e){return"0"===e?0:null}},f0b9:function(e,t,i){"use strict";function n(e){return 32+e.length}function r(){return 16}function s(e){if(!e)return 0;let t=32;for(const i in e)if(e.hasOwnProperty(i)){const s=e[i];switch(typeof s){case"string":t+=n(s);break;case"number":t+=r();break;case"boolean":t+=4}}return t}function o(e,t){return 32+e.length*t}i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return o})),i.d(t,"c",(function(){return r})),i.d(t,"d",(function(){return n}))},f408:function(e,t,i){"use strict";i.d(t,"a",(function(){return p})),i.d(t,"b",(function(){return u})),i.d(t,"c",(function(){return s})),i.d(t,"d",(function(){return c})),i.d(t,"e",(function(){return a})),i.d(t,"f",(function(){return d})),i.d(t,"g",(function(){return l}));var n=i("b2b2"),r=i("8076");function s(e,t){return Object(n["j"])(t)||!t.mode?e?"absolute-height":"on-the-ground":t.mode}function o(e,t){return s(!!Object(n["k"])(e)&&e.hasZ,t)}function a(e){const t=h(e);return o(e.geometry,t)}function c(e){const t=h(e),i=o(e.geometry,t);return{mode:i,offset:Object(n["k"])(t)&&"on-the-ground"!==i?Object(n["u"])(t.offset,0)*Object(r["a"])(Object(n["u"])(t.unit,"meters")):0}}function l(e){if("on-the-ground"===a(e))return!1;const t=h(e),i=Object(n["k"])(t)&&t.featureExpressionInfo?t.featureExpressionInfo.expression:null;return!(!i||"0"===i)}function h(e){return e.layer&&"elevationInfo"in e.layer?e.layer.elevationInfo:null}function d(e,t,i){if(Object(n["j"])(i)||!i.mode)return;const r=e.hasZ?e.z:0,s=Object(n["k"])(i.offset)?i.offset:0;switch(i.mode){case"absolute-height":return r-s;case"on-the-ground":return 0;case"relative-to-ground":return r-(Object(n["u"])(t.elevationProvider.getElevation(e.x,e.y,e.z,e.spatialReference,"ground"),0)+s);case"relative-to-scene":return r-(Object(n["u"])(t.elevationProvider.getElevation(e.x,e.y,e.z,e.spatialReference,"scene"),0)+s)}}function p(e,t,i,n=null){return f(e,t.x,t.y,t.hasZ?t.z:0,t.spatialReference,i,n)}function u(e,t,i,n,r=null){return f(e,t[0],t[1],t.length>2?t[2]:0,i,n,r)}function f(e,t,i,r,s,o,a=null){if(Object(n["j"])(o))return;const c=Object(n["k"])(a)?a.mode:"absolute-height";return"on-the-ground"===c?0:g(b(t,i,r,s,e,o),t,i,r,s,e,a,c)}function b(e,t,i,r,s,o){const a=Object(n["k"])(o.offset)?o.offset:0;switch(o.mode){case"absolute-height":return i+a;case"on-the-ground":return Object(n["u"])(s.elevationProvider.getElevation(e,t,0,r,"ground"),0);case"relative-to-ground":return i+Object(n["u"])(s.elevationProvider.getElevation(e,t,i,r,"ground"),0)+a;case"relative-to-scene":return i+Object(n["u"])(s.elevationProvider.getElevation(e,t,i,r,"scene"),0)+a}}function g(e,t,i,r,s,o,a,c){const l=Object(n["k"])(a)&&Object(n["k"])(a.offset)?a.offset:0;switch(c){case"absolute-height":return e-l;case"relative-to-ground":return e-(Object(n["u"])(o.elevationProvider.getElevation(t,i,r,s,"ground"),0)+l);case"relative-to-scene":return e-(Object(n["u"])(o.elevationProvider.getElevation(t,i,r,s,"scene"),0)+l)}}},f53a:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));class n{constructor(e){this._attached=!1,this._resourcesCreated=!1,this._visible=!0,this.view=e,this.view.watch("ready",e=>{this._resourcesCreated&&(e?this._createResources():this._destroyResources())})}applyProps(e){let t=!1;for(const i in e)i in this?"attached"===i?t=e[i]:this[i]=e[i]:console.error("Cannot set unknown property",i);this.attached=t}destroy(){this.attached=!1}get attached(){return this._attached}set attached(e){e!==this._attached&&this.view._stage&&(this._attached=e,this._attached&&!this._resourcesCreated?this._createResources():!this._attached&&this._resourcesCreated&&this._destroyResources())}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this.attached&&this.updateVisibility(e))}_createResources(){this.createResources(),this._resourcesCreated=!0,this.visible||this.updateVisibility(!1)}_destroyResources(){this.destroyResources(),this._resourcesCreated=!1}}},fb6a:function(e,t,i){"use strict";var n=i("23e7"),r=i("861d"),s=i("e8b5"),o=i("23cb"),a=i("50c4"),c=i("fc6a"),l=i("8418"),h=i("b622"),d=i("1dde"),p=d("slice"),u=h("species"),f=[].slice,b=Math.max;n({target:"Array",proto:!0,forced:!p},{slice:function(e,t){var i,n,h,d=c(this),p=a(d.length),g=o(e,p),m=o(void 0===t?p:t,p);if(s(d)&&(i=d.constructor,"function"!=typeof i||i!==Array&&!s(i.prototype)?r(i)&&(i=i[u],null===i&&(i=void 0)):i=void 0,i===Array||void 0===i))return f.call(d,g,m);for(n=new(void 0===i?Array:i)(b(m-g,0)),h=0;g<m;g++,h++)g in d&&l(n,h,d[g]);return n.length=h,n}})},fbd0:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var n=i("b50f"),r=i("02f1"),s=i("3349"),o=i("34f2");class a extends o["a"]{constructor(e,t,i,n,o,a=0){super(e),this.origin=t,this.axis1=i,this.factor1=n,this.factor2=o,this.accumulationType=a,this.axis2=Object(s["s"])(Object(r["b"])(),i[1],-i[0])}scale(e,t,i){this.helper.scale(e.pos,this.origin,this.axis1,t),this.helper.scale(e.pos,this.origin,this.axis2,i)}apply(e){this.scale(e,this.factor1,this.factor2)}undo(e){this.scale(e,1/this.factor1,1/this.factor2)}canAccumulate(e){return e instanceof a&&Object(n["e"])(this.origin,e.origin)&&Object(n["e"])(this.axis1,e.axis1)}accumulate(e,t){1===t.accumulationType?this.scale(e,t.factor1/this.factor1,t.factor2/this.factor2):this.scale(e,t.factor1,t.factor2)}accumulateParams(e){const t=1===e.accumulationType;this.factor1=t?e.factor1:this.factor1*e.factor1,this.factor2=t?e.factor2:this.factor2*e.factor2}}},feba:function(e,t,i){"use strict";i.d(t,"a",(function(){return A}));i("c120");var n=i("c649"),r=i("9ef0"),s=i("0b2d"),o=i("e431"),a=i("c9fb"),c=i("6706"),l=i("65a7"),h=i("8f1c"),d=i("b2b2"),p=i("a915"),u=i("af40"),f=i("afe1"),b=i("3349"),g=i("7577"),m=i("5ef2"),v=i("caf7"),y=i("86ba"),_=i("5fae");class O extends _["a"]{constructor(e){super(e),this._handles=new u["a"],this._location=Object(s["e"])(),this._direction=Object(s["g"])(1,0,0),this._width=1,this._offset=1,this._length=18,this._color=Object(m["c"])(1,0,1,1),this._renderOccluded=4,this.applyProps(e)}get location(){return this._location}set location(e){Object(o["r"])(this._location,e)||(Object(o["l"])(this._location,e),this.updateGeometry())}get direction(){return this._direction}set direction(e){Object(o["r"])(this._direction,e)||(Object(o["l"])(this._direction,e),this.updateGeometry())}setDirectionFromPoints(e,t){Object(o["s"])(this._direction,Object(o["k"])(this._direction,t,e)),this.updateGeometry()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this.updateMaterial())}get offset(){return this._offset}set offset(e){e!==this._offset&&(this._offset=e,this.updateGeometry())}get length(){return this._length}set length(e){e!==this._length&&(this._length=e,this.updateGeometry())}get color(){return this._color}set color(e){Object(g["g"])(e,this._color)||(Object(g["c"])(this._color,e),this.updateMaterial())}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this.updateMaterial())}createExternalResources(){const e=new y["a"](this.materialParameters);this._handles.add(this.view.state.watch("camera",()=>{this.updateGeometry()})),this._externalResources={material:e}}destroyExternalResources(){this._handles.removeAll(),this._externalResources=null}createGeometries(e){const t=v["a"].createPolylineGeometry([Object(s["e"])(),Object(s["e"])()]),i=v["a"].createPolylineGeometry([Object(s["e"])(),Object(s["e"])()]),n=Object(d["t"])(this._externalResources).material;e.addGeometry(t,n,f["a"]),e.addGeometry(i,n,f["a"]),this.updateVertices(e)}forEachExternalMaterial(e){Object(d["k"])(this._externalResources)&&e(this._externalResources.material)}updateMaterial(){Object(d["j"])(this._externalResources)||this._externalResources.material.setParameterValues(this.materialParameters)}get materialParameters(){return{width:this._width,color:this._color,renderOccluded:this._renderOccluded}}updateGeometry(){const e=this.object;Object(d["j"])(e)||this.updateVertices(e)}updateVertices(e){const t=this.view.state.camera;t.projectToScreen(this.location,x),Object(o["g"])(j,this.location,this.direction),t.projectToScreen(j,w),Object(b["e"])(w,Object(b["d"])(w,w,x)),this.updateVertexAttributes(t,e,0,x,w,1),this.updateVertexAttributes(t,e,1,x,w,-1)}updateVertexAttributes(e,t,i,n,r,s){const o=t.geometryRecords[i].geometry.getMutableAttribute("position").data,a=Object(b["a"])(S,Object(b["s"])(S,r[1]*s,r[0]*-s),this.offset+this.width/2),c=Object(b["h"])(P,Object(b["h"])(P,Object(b["h"])(P,n,Object(b["a"])(P,r,this.length/2)),a),a),l=Object(b["h"])(C,c,Object(b["a"])(C,r,-this.length));e.unprojectFromScreen(c,j),o[0]=j[0],o[1]=j[1],o[2]=j[2],e.unprojectFromScreen(l,j),o[3]=j[0],o[4]=j[1],o[5]=j[2],t.geometryVertexAttrsUpdated(i)}}const j=Object(s["e"])(),x=Object(p["g"])(),w=Object(p["g"])(),S=Object(p["g"])(),P=Object(p["g"])(),C=Object(p["g"])();var T=i("002c"),E=i("45a1");class A extends l["a"]{visualizeIntersectionPoint(e,t){const{coordinateHelper:i,elevationInfo:s,view:o}=t;return Object(n["a"])(new T["a"]({view:o,primitive:"circle",geometry:i.createPoint(e.intersectionPoint),elevationInfo:s,size:20,outlineSize:2,color:[0,0,0,0],outlineColor:r["a"].toUnitRGBA(a["a"].orange),pixelSnappingEnabled:!1}))}visualizePoint(e,t){const{coordinateHelper:i,elevationInfo:s,view:o}=t;return Object(n["a"])(new T["a"]({view:o,primitive:"circle",geometry:i.createPoint(e.point),elevationInfo:s,size:20,outlineSize:2,color:[0,0,0,0],outlineColor:r["a"].toUnitRGBA(a["a"].orange),pixelSnappingEnabled:!1}))}visualizeLine(e,t){const{coordinateHelper:i,elevationInfo:r,view:s}=t;return Object(n["a"])(this.createLineSegmentHintFromMap(e.type,e.lineStart,e.lineEnd,i,r,s,e.fadeLeft,e.fadeRight))}visualizeParallelSign(e,t){const{coordinateHelper:i,elevationInfo:s,view:l}=t,h=Object(c["a"])(e.lineStart,i,s,t.view),d=Object(c["a"])(e.lineEnd,i,s,t.view),p=Object(o["j"])(d,h,d,.5),u=new O({view:l,attached:!1,offset:a["a"].parallelLineHintOffset,length:a["a"].parallelLineHintLength,width:a["a"].parallelLineHintWidth,color:r["a"].toUnitRGBA(a["a"].orange),location:p,renderOccluded:16});return u.setDirectionFromPoints(h,p),u.attached=!0,Object(n["a"])(u)}visualizeRightAngleQuad(e,t){const{coordinateHelper:i,elevationInfo:s,view:o}=t;return Object(n["a"])(new E["a"]({view:o,attached:!0,color:r["a"].toUnitRGBA(a["a"].orange),renderOccluded:2,outlineRenderOccluded:16,outlineColor:r["a"].toUnitRGBA(a["a"].orange),outlineSize:a["a"].rightAngleHintOutlineSize,size:a["a"].rightAngleHintSize,geometry:{previous:Object(c["a"])(e.previousVertex,i,s,o),center:Object(c["a"])(e.centerVertex,i,s,o),next:Object(c["a"])(e.nextVertex,i,s,o)}}))}createLineSegmentHintFromMap(e,t,i,n,r,o,a=!0,l=!0){const h=Object(s["e"])(),d=Object(s["e"])();return Object(c["c"])(t,i,n,r,o,h,d),this.createLineSegmentHint(e,o,h,d,a,l)}createLineSegmentHint(e,t,i,n,s=!0,o=!0){const c=new h["a"]({view:t,extensionType:3,start:i,end:n,color:r["a"].toUnitRGBA(a["a"].orange),renderOccluded:16});switch(e){case 0:c.width=a["a"].lineHintWidthTarget,c.fadedExtensions={start:0,end:a["a"].lineHintFadedExtensions};break;case 2:c.width=a["a"].lineHintWidthReference,c.fadedExtensions={start:0,end:0};break;case 1:c.width=a["a"].lineHintWidthReference,c.fadedExtensions={start:s?a["a"].lineHintFadedExtensions:0,end:o?a["a"].lineHintFadedExtensions:0}}return c.attached=!0,c}}}}]);