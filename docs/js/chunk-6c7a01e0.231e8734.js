(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6c7a01e0"],{"82de":function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return c}));var n=i("afe1"),r=i("0b2d"),s=i("8188"),o=i("f694");function a(e,t,i,r){const o=c(e,t,i),a=Object(n["d"])();return Object(s["d"])(i,o,a,r),a}const l=1,d=5-l;function c(e,t,i){const n=Object(r["f"])(),s=e[3],a=2**(Math.ceil(Math.log(s)*Math.LOG2E/d)*d+l);if(i.isGeographic){const t=a/Object(o["e"])(i).radius*180/Math.PI,r=Math.round(e[1]/t),s=Math.max(-90,Math.min(90,r*t)),l=t/Math.cos((Math.abs(s)-t/2)/180*Math.PI),d=Math.round(e[0]/l)*l;n[0]=d,n[1]=s}else{const t=Math.round(e[0]/a),i=Math.round(e[1]/a);n[0]=t*a,n[1]=i*a}const c=e[2]+t,u=Math.round(c/a);return n[2]=u*a,n}},9056:function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return Je}));var n=i("a4ee"),r=i("792b"),s=i("2c4f"),o=i("e92d"),a=i("b2b2"),l=i("f4cc"),d=i("a915"),c=i("a21b"),u=i("8048"),h=i("59b2"),p=(i("b50f"),i("c120"),i("cea0"),i("d386")),f=i("e431"),b=i("47f8"),g=i("8188"),_=i("4261"),m=i("9180"),y=i("7289"),O=i("1a54"),j=i("e5ec"),S=i("4106"),x=(i("4338"),i("b5a9"),i("df3d"),i("c1da")),v=i("306f"),w=i("8076"),P=i("66af"),z=i("78ba");class M extends z["a"]{constructor(e){super("PointCloudWorker","transform",e)}getTransferList(e){const t=[e.geometryBuffer];if(Object(a["l"])(e.primaryAttributeData)&&e.primaryAttributeData.buffer&&t.push(e.primaryAttributeData.buffer),Object(a["l"])(e.modulationAttributeData)&&e.modulationAttributeData.buffer&&t.push(e.modulationAttributeData.buffer),Object(a["l"])(e.filterAttributesData))for(const i of e.filterAttributesData)Object(a["l"])(i)&&i.buffer&&t.push(i.buffer);for(const i of e.userAttributesData)i.buffer&&t.push(i.buffer);return t}}var C=i("ee9c");function N(e,t,i){for(let r=0;r<t.length;r++)I[r]=!1,k[r]=null;for(let r=0;r<e.length;r++)R[r]=!1,A[r]=null;for(let r=0;r<t.length;r++){const n=F(t[r],e,i);n>=0&&(I[r]=!0,null!=A[n]?A[n].push(t[r]):A[n]=[t[r]])}for(let r=0;r<e.length;r++){const n=F(e[r],t,i);n>=0&&(R[r]=!0,null!=k[n]?k[n].push(e[r]):k[n]=[e[r]])}const n=[];for(let r=0;r<e.length;r++)null!=A[r]||R[r]||n.push({load:[],remove:[e[r]]});for(let r=0;r<t.length;r++)null!=k[r]||I[r]||n.push({load:[t[r]],remove:[]});for(let r=0;r<t.length;r++)null!=k[r]&&(k[r].length>1||k[r][0]!==t[r])&&n.push({load:[t[r]],remove:k[r]});for(let r=0;r<e.length;r++)null!=A[r]&&(A[r].length>1||A[r][0]!==e[r])&&n.push({load:A[r],remove:[e[r]]});return n}const R=[!1],A=[null],I=[!1],k=[null];function F(e,t,i){let n=e;for(;n>0;){const e=t.indexOf(n);if(e>=0)return e;n=i.getParentId(n)}return t.indexOf(n)}function V(e,t,i){return e.sort((e,n)=>{if(0===e.load.length&&0===n.load.length)return 0;if(0===e.load.length)return-1;if(0===n.load.length)return 1;if(0===e.remove.length&&0===n.remove.length){const r=i.getRenderCenter(e.load[0]),s=i.getRenderCenter(n.load[0]);return Object(f["k"])(r,t)-Object(f["k"])(s,t)}if(0===e.remove.length)return-1;if(0===n.remove.length)return 1;if(1===e.load.length&&1===n.load.length){const r=i.getRenderCenter(e.load[0]),s=i.getRenderCenter(n.load[0]);return Object(f["k"])(r,t)-Object(f["k"])(s,t)}if(1===e.load.length)return-1;if(1===n.load.length)return 1;{const r=i.getRenderCenter(e.remove[0]),s=i.getRenderCenter(n.remove[0]);return Object(f["k"])(r,t)-Object(f["k"])(s,t)}})}function q(e,t,i){for(let n=0;n<e.length;++n){const r=e[n];r.load.length>t&&1===r.remove.length&&E(e,r,i)}}function E(e,t,i){const n=[t.remove[0]],r=[];for(;1===n.length;){const e=n.pop();r.length=0;for(let s=0;s<t.load.length;s++){let o=t.load[s],a=i.getParentId(o);for(;a!==e;)o=a,a=i.getParentId(o);let l=n.indexOf(o);l<0&&(l=n.length,n.push(o),r.push([])),r[l].push(t.load[s])}}t.load=n;for(let s=0;s<n.length;s++)r[s].length>1?e.push({remove:[n[s]],load:r[s]}):n[s]=r[s][0]}var L=i("cee3");class W{constructor(e,t,i){this._pages=[],this.pageSize=0,this._nodeSR=null,this._renderSR=null,this._nodeSR=e,this._renderSR=t,this.pageSize=i}addPage(e,t,i=0){for(;this._pages.length<e;)this._pages.push(null);const n=U(t,this._nodeSR,this._renderSR,i);this._pages[e]={nodes:t,renderObbs:n,parents:new Uint32Array(this.pageSize)},D(this._pages,this.pageSize)}hasPage(e){return!!this._pages[e]}getNode(e){const t=this.pageSize;return this._pages[H(e,t)].nodes[Q(e,t)]}getRenderObb(e){const t=this.pageSize;return this._pages[H(e,t)].renderObbs[Q(e,t)]}getRenderCenter(e){return this.getRenderObb(e).center}setRenderObb(e,t){const i=this.pageSize;Object(L["m"])(t,this._pages[H(e,i)].renderObbs[Q(e,i)])}getParentId(e){const t=this.pageSize;return this._pages[H(e,t)].parents[Q(e,t)]}hasNodes(e,t){const i=H(e,this.pageSize),n=H(e+t-1,this.pageSize);for(let r=i;r<=n;r++)if(null==this._pages[r])return!1;return!0}forEachNodeId(e){for(let t=0;t<this._pages.length;t++){const i=this._pages[t];if(i)for(let n=0;n<i.nodes.length;n++)e(t*this.pageSize+n)}}createVisibilityTraverse(){const e={index:this,queue:[],masks:[],tempAabb:Object(_["h"])()};return(t,i)=>T(e,t,i)}}function T(e,t,i){const n=e.index;if(!n.hasNodes(0,1))return;const r=e.queue;r.length=0,r.push(0);const s=e.masks;for(s.length=0,s.push(0);r.length>0;){const o=r.pop();let a=s.pop();const l=n.getNode(o),d=n.getRenderObb(o);let c=!0;if(null!=t.clippingBox){const i=1<<t.frustum.length;if(0==(a&i)){const n=Object(L["n"])(d,e.tempAabb);Object(_["f"])(t.clippingBox,n)?a|=i:Object(_["w"])(t.clippingBox,n)||(c=!1)}}for(let e=0;e<t.frustum.length&&c;e++){const i=1<<e;if(0==(a&i)){const n=Object(L["g"])(d,t.frustum[e]);n>0?c=!1:n<0&&(a|=i)}}if(i.predicate(o,l,c)){const e=l.firstChild,t=l.childCount;let d=!1;const c=H(e,n.pageSize),u=H(e+t-1,n.pageSize);for(let r=c;r<=u;r++)if(!n.hasPage(r)){i.pageMiss(o,r),d=!0;break}if(!d)for(let i=0;i<t;i++)r.push(e+i),s.push(a)}}}function U(e,t,i,n){const r=new L["a"](e.length);for(let s=0;s<e.length;s++)Object(C["v"])(e[s].obb,t,r.obbs[s],i,n);return r.obbs}function D(e,t){const i=[0];for(;i.length;){const n=i.pop(),r=e[H(n,t)].nodes[Q(n,t)];for(let s=0;s<r.childCount;s++){const o=r.firstChild+s;null!=e[H(o,t)]&&(e[H(o,t)].parents[Q(o,t)]=n,i.push(o))}}}function H(e,t){return e/t|0}function Q(e,t){return e%t}function G(e){const t=e.renderer,i=t&&t.type,n=t&&e.renderer.toJSON()||null;let r=null,s=!1;"point-cloud-unique-value"===i||"point-cloud-stretch"===i||"point-cloud-class-breaks"===i?r=Z(e.attributeStorageInfo,t.field):"point-cloud-rgb"===i?(r=Y(e.attributeStorageInfo,t.field),s=null!=r):(r=Y(e.attributeStorageInfo,"RGB"),s=null!=r);let o=null;return t&&t.colorModulation&&(o=Z(e.attributeStorageInfo,t.colorModulation.field)),{rendererJSON:n,isRGBRenderer:s,primaryAttribute:r,modulationAttribute:o}}function B(e){const t=e.filters;return t?t.map(t=>({filterJSON:t.toJSON(),attributeInfo:Z(e.attributeStorageInfo,t.field)})):[]}function $(e){const t=e&&e.pointSizeAlgorithm;return t&&"splat"===t.type?t:null}function K(e){const t=e&&e.pointSizeAlgorithm;return t&&"fixed-size"===t.type?t:null}function J(e){const t=e&&e.pointSizeAlgorithm;return!(!t||!t.type)&&"fixed-size"===t.type}function Y(e,t){for(const i of e)if(i.name===t&&null!=i.attributeValues&&"UInt8"===i.attributeValues.valueType&&3===i.attributeValues.valuesPerElement)return{name:t,storageInfo:i,useElevation:!1};return null}function Z(e,t){for(const i of e)if(i.name===t){const e="embedded-elevation"===i.encoding;return{name:t,storageInfo:e?null:i,useElevation:e}}return"elevation"===t.toLowerCase()?{name:t,storageInfo:null,useElevation:!0}:null}var X,ee=i("05ff"),te=i("8d60");let ie=X=class extends te["a"]{constructor(e){super(e)}clone(){return new X(this.cloneProperties())}cloneProperties(){const{pointCloudMetadata:e}=this;return{...super.cloneProperties(),pointCloudMetadata:e}}};Object(n["a"])([Object(h["b"])({constructOnly:!0})],ie.prototype,"pointCloudMetadata",void 0),ie=X=Object(n["a"])([Object(p["a"])("esri.views.3d.layers.i3s.PointGraphic")],ie);var ne=i("8a44"),re=i("d791"),se=i("970c"),oe=i("0b2d"),ae=i("7577"),le=i("d18f"),de=i("c649"),ce=i("bea9");class ue{constructor(e){this.context=e,this.highlights=new Set}get hasHighlights(){return this.highlights.size>0}destroy(){this.highlights=null}add(e){const t=new he(e);return this.highlights.add(t),this.enableSet(t),Object(de["c"])(()=>this.removeSet(t))}removeSet(e){this.disableSet(e),this.highlights.delete(e)}enableSet(e){e.enabled||(e.enabled=!0,this.context.forEachNode(t=>this.enableSetForNode(e,t)))}enableSetForNode(e,t){if(!e.enabled)return;const i=e.ids.get(t.id);i&&i.forEach(i=>this.context.addHighlight(t,i,e.id))}disableSet(e){e.enabled&&(e.enabled=!1,this.context.forEachNode(t=>this.disableSetForNode(e,t)))}disableSetForNode(e,t){e.enabled||this.context.removeHighlight(t,e.id)}nodeAdded(e){this.highlights.forEach(t=>this.enableSetForNode(t,e))}nodeRemoved(e){this.highlights.forEach(t=>this.disableSetForNode(t,e))}removeAll(){this.highlights.forEach(e=>this.disableSet(e))}}class he{constructor(e){this.id=new ce["a"](0),this.ids=new Map,this.enabled=!1;for(const t of e)Object(a["l"])(t)&&this.add(t.nodeId,t.pointId)}add(e,t){const i=this.ids.get(e);i?i.add(t):this.ids.set(e,new Set([t]))}}var pe=i("d272"),fe=i("6a07"),be=i("fa1e"),ge=i("9250"),_e=i("c3a4"),me=i("ca98"),ye=i("da35"),Oe=i("c829"),je=i("87b7"),Se=i("bc58"),xe=i("189c");class ve extends me["a"]{constructor(e,t,i){super(e,t,i)}initializeProgram(e){const t=ve.shader.get(),i=this.configuration,n=t.build({output:i.output,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!0,drawScreenSize:i.drawScreenSize});return new Oe["a"](e.rctx,n,be["a"])}initializePipeline(){return Object(xe["g"])({depthTest:{func:513},depthWrite:xe["e"],colorWrite:xe["d"],stencilWrite:this.configuration.sceneHasOcludees?je["j"]:null,stencilTest:this.configuration.sceneHasOcludees?je["e"]:null})}}ve.shader=new _e["a"](Se["a"],()=>i.e("chunk-2d207ae6").then(i.bind(null,"a221")));class we extends ye["a"]{constructor(){super(...arguments),this.output=0,this.slicePlaneEnabled=!1,this.drawScreenSize=!1,this.sceneHasOcludees=!1}}Object(n["a"])([Object(ye["b"])({count:8})],we.prototype,"output",void 0),Object(n["a"])([Object(ye["b"])()],we.prototype,"slicePlaneEnabled",void 0),Object(n["a"])([Object(ye["b"])()],we.prototype,"drawScreenSize",void 0),Object(n["a"])([Object(ye["b"])()],we.prototype,"sceneHasOcludees",void 0);var Pe=i("7ce4"),ze=i("0fa6");const Me={positions:[{name:"position",count:3,type:5126,offset:0,stride:12,normalized:!1}],colors:[{name:"color",count:3,type:5121,offset:0,stride:3,normalized:!0}]};class Ce{constructor(e){this._params=e,this.type=5,this.isGround=!1,this._bindParameters={inverseViewport:[0,0],highlightDepthTexture:null},this._highlights=new ue({forEachNode:e=>this.forEachNode(e),addHighlight:(e,t,i)=>this.addHighlight(e,t,i),removeHighlight:(e,t)=>this.removeHighlight(e,t)}),this.canRender=!0,this.layerUid="",this._useFixedSizes=!1,this._scaleFactor=1,this._minSizePx=0,this._useRealWorldSymbolSizes=!1,this._size=0,this._sizePx=0,this._slicePlaneEnabled=!1,this._clipBox=Object(_["h"])(_["b"]),this._techniqueConfig=new we,this.tempMatrix4=Object(se["a"])(),this.tempVec3=Object(b["c"])(),this.nodes=new ne["a"]}get needsHighlight(){return this._highlights.hasHighlights}initializeRenderContext(e){this._context=e,this._techniqueRep=this._context.shaderTechniqueRep,e.requestRender()}uninitializeRenderContext(){}intersect(e,t,i,n){const r=Object(oe["f"])(),s=Object(oe["f"])(),o=Object(oe["f"])(),a=Object(oe["f"])(),l=Object(y["d"])(),d=e.camera.perScreenPixelRatio/2,c=e.camera.near,u=this._getSizeParams();Object(f["m"])(s,n,i);const h=1/Object(f["s"])(s);Object(f["h"])(s,s,h),Object(f["v"])(o,s),Object(ae["l"])(l,s[0],s[1],s[2],-Object(f["k"])(s,i));class p{constructor(){this.node=null,this.pointId=null,this.point=null,this.dist=null,this.normal=null,this.layerUid=""}}const b=new p,g=new p,m=[],O=Object(_["h"])(),j=Object(_["h"])(this._clipBox);Object(_["A"])(j,-i[0],-i[1],-i[2],j),this.nodes.forAll(y=>{const S=y.splatSize*this._scaleFactor;let x=Object(L["j"])(y.obb,l),v=Object(L["i"])(y.obb,l);x-=Ae(S,x+c,u,d,y.isLeaf),v-=Ae(S,v+c,u,d,y.isLeaf);const w=v<0,P=null!=b.dist&&null!=g.dist&&b.dist<x*h&&g.dist>v*h;if(w||P)return;const z=Re(S,v+c,u,d,y.isLeaf);if(!Object(L["f"])(y.obb,i,s,z))return;const M=z*z;Object(L["n"])(y.obb,O),Object(_["A"])(O,-i[0],-i[1],-i[2],O);const C=!Object(_["f"])(j,O);Object(f["m"])(a,y.origin,i);const N=y.coordinates.length/3;for(let l=0;l<N;l++){if(r[0]=a[0]+y.coordinates[3*l],r[1]=a[1]+y.coordinates[3*l+1],r[2]=a[2]+y.coordinates[3*l+2],C&&!Object(_["g"])(j,r))continue;const O=Object(f["k"])(r,s),x=Object(f["w"])(r)-O*O;if(x>M)continue;let v=O+c;const w=Ae(S,v,u,d,y.isLeaf);if(O-w<0)continue;v-=w;const P=Re(S,v,u,d,y.isLeaf);if(x>P*P)continue;const z=(O-w)*h,N=e=>{e.point=Ie(y,l,e.point),e.dist=z,e.normal=o,e.node=y,e.pointId=l,e.layerUid=this.layerUid};if((null==b.dist||z<b.dist)&&(null==t||t(i,n,z))&&N(b),0!==e.options.store&&(null==g.dist||z>g.dist)&&(null==t||t(i,n,z))&&N(g),2===e.options.store&&(null==t||t(i,n,z))){const e=new p;N(e),m.push(e)}}});const S=e=>{const{layerUid:t,node:i,pointId:n}=e;return{point:e.point,layerUid:t,graphicUid:n,createGraphic:()=>this._params.createGraphic(i,n,e.point)}},x=(e,t)=>{const i=S(t);e.set(this.type,i,t.dist,t.normal)};if(null!=b.dist){const t=e.results.min;(null==t.dist||b.dist<t.dist)&&x(t,b)}if(null!=g.dist&&0!==e.options.store){const t=e.results.max;(null==t.dist||g.dist>t.dist)&&x(t,g)}if(2===e.options.store){const t=Object(le["f"])(i,n);for(const i of m){const n=Object(ge["c"])(t);x(n,i),e.results.all.push(n)}}}render(e){if(0===this.nodes.length||0!==e.pass&&2!==e.pass&&5!==e.pass)return!1;const t=this._getSizeParams(),i=this.selectTechnique(e,t),n=i.program;if(null==n)return!1;this.nodes.forAll(t=>{null==t.vao&&this._initNode(e,t)});const r=e.rctx;r.useProgram(n),i.bindPipelineState(r);const s=this._clipBox,o=!Object(_["l"])(s,_["b"],(e,t)=>e===t);o||(Object(f["z"])(this.tempVec3,-1/0,-1/0,-1/0),n.setUniform3fv("uClipMin",this.tempVec3),Object(f["z"])(this.tempVec3,1/0,1/0,1/0),n.setUniform3fv("uClipMax",this.tempVec3)),n.setUniformMatrix4fv("uProjectionMatrix",e.camera.projectionMatrix),2===e.pass&&n.setUniform2f("nearFar",e.camera.near,e.camera.far),e.isHighlightPass&&(this._bindParameters.inverseViewport[0]=1/e.camera.fullViewport[2],this._bindParameters.inverseViewport[1]=1/e.camera.fullViewport[3],this._bindParameters.highlightDepthTexture=e.highlightDepthTexture,Object(fe["b"])(n,this._bindParameters));const a=e.camera.pixelRatio;t.drawFixedSize&&n.setUniform2f("uPointScale",t.fixedSize*a,e.camera.fullHeight);const l=this._slicePlaneEnabled?e.sliceHelper&&e.sliceHelper.plane:null;return this.nodes.forAll(d=>{if(0===d.coordinates.length||e.isHighlightPass&&!d.highlights)return;if(n.setUniform2f("uScreenMinMaxSize",t.screenMinSize*a,Ne(d.isLeaf)*a),!t.drawFixedSize){const t=d.splatSize*this._scaleFactor;n.setUniform2f("uPointScale",t*a,e.camera.fullHeight/a)}const c=d.origin;o&&(Object(f["z"])(this.tempVec3,s[0]-c[0],s[1]-c[1],s[2]-c[2]),n.setUniform3fv("uClipMin",this.tempVec3),Object(f["z"])(this.tempVec3,s[3]-c[0],s[4]-c[1],s[5]-c[2]),n.setUniform3fv("uClipMax",this.tempVec3)),Object(re["j"])(this.tempMatrix4),Object(re["b"])(this.tempMatrix4,this.tempMatrix4,c),Object(re["n"])(this.tempMatrix4,e.camera.viewMatrix,this.tempMatrix4),n.setUniformMatrix4fv("uModelViewMatrix",this.tempMatrix4),Object(pe["b"])(n,i.configuration,l,c),r.bindVAO(d.vao),e.isHighlightPass?this._renderHighlightFragments(r,d):r.drawArrays(0,0,d.coordinates.length/3)}),!0}_renderHighlightFragments(e,t){const i=t.highlights;if(Object(a["k"])(i))return;let n=Object(a["u"])(i[0].component),r=n+1;for(let o=1;o<i.length;o++){const t=Object(a["u"])(i[o].component);if(t!==r){const i=r-n;i>0&&e.drawArrays(0,n,i),n=t}r=t+1}const s=r-n;s>0&&e.drawArrays(0,n,s)}set useFixedSizes(e){this._useFixedSizes!==e&&(this._useFixedSizes=e,this._requestRender())}get useFixedSizes(){return this._useFixedSizes}set scaleFactor(e){this._scaleFactor!==e&&(this._scaleFactor=e,this._requestRender())}get scaleFactor(){return this._scaleFactor}set minSizePx(e){this._minSizePx!==e&&(this._minSizePx=e,this._requestRender())}get minSizePx(){return this._minSizePx}set useRealWorldSymbolSizes(e){this._useRealWorldSymbolSizes!==e&&(this._useRealWorldSymbolSizes=e,this._requestRender())}get useRealWorldSymbolSizes(){return this._useRealWorldSymbolSizes}set size(e){this._size!==e&&(this._size=e,this._requestRender())}get size(){return this._size}set sizePx(e){this._sizePx!==e&&(this._sizePx=e,this._requestRender())}get sizePx(){return this._sizePx}set clippingBox(e){Object(_["C"])(this._clipBox,e||_["b"])}get slicePlaneEnabled(){return this._slicePlaneEnabled}set slicePlaneEnabled(e){this._slicePlaneEnabled!==e&&(this._slicePlaneEnabled=e,this._requestRender())}addNode(e){this.nodes.push(e),this._highlights.nodeAdded(e),this._requestRender()}removeNode(e){let t=null;return this.nodes.filterInPlace(i=>i.id!==e||(t=i,i.vao=Object(a["f"])(i.vao),this._highlights.nodeRemoved(i),!1)),this._requestRender(),t}forEachNode(e){this.nodes.forAll(e)}removeAll(){this.nodes.forAll(e=>e.vao=Object(a["f"])(e.vao)),this._highlights.removeAll(),this.nodes.clear(),this._requestRender()}highlight(e){return this._highlights.add(e)}addHighlight(e,t,i){e.highlights=Fe(e.highlights,t,i),this._requestRender()}removeHighlight(e,t){e.highlights=Ve(e.highlights,t),this._requestRender()}_initNode(e,t){const i=e.rctx;t.vao=new ze["a"](i,be["a"],Me,{positions:Pe["a"].createVertex(i,35044,t.coordinates),colors:Pe["a"].createVertex(i,35044,t.rgb)})}_requestRender(){this._context&&this._context.requestRender()}_getSizeParams(){const e=this._useFixedSizes,t=e&&!this._useRealWorldSymbolSizes;return{drawScreenSpace:t,drawFixedSize:e,fixedSize:t?this._sizePx:this._size,screenMinSize:e?0:this._minSizePx}}selectTechnique(e,t){return this._techniqueConfig.drawScreenSize=t.drawScreenSpace,this._techniqueConfig.slicePlaneEnabled=this._slicePlaneEnabled,this._techniqueConfig.sceneHasOcludees=e.hasOccludees,this._techniqueConfig.output=2===e.pass?1:5===e.pass?4:0,this._techniqueRep.releaseAndAcquire(ve,this._techniqueConfig,this._technique)}}function Ne(e){return e?256:64}function Re(e,t,i,n,r){if(i.drawScreenSpace)return i.fixedSize*t*n;const s=Ne(r)*t*n;return i.drawFixedSize?Math.min(i.fixedSize/2,s):i.screenMinSize>0?Math.min(Math.max(i.screenMinSize*t*n,e/2),s):Math.min(e/2,s)}function Ae(e,t,i,n,r){return i.drawScreenSpace?0:Re(e,t,i,n,r)}function Ie(e,t,i){return null==i&&(i=Object(oe["f"])()),i[0]=e.origin[0]+e.coordinates[3*t],i[1]=e.origin[1]+e.coordinates[3*t+1],i[2]=e.origin[2]+e.coordinates[3*t+2],i}function ke(e){return Object(a["l"])(e.component)?e.component:-1}function Fe(e,t,i){Object(a["k"])(e)&&(e=[]);const n={component:t,id:i};e.push(n);const r=ke(n);let s=e.length-1;for(;s>0&&r<ke(e[s-1]);)[e[s-1],e[s]]=[e[s],e[s-1]],--s;return e}function Ve(e,t){if(Object(a["k"])(e))return e;const i=e.filter(e=>e.id!==t);return 0===i.length?null:i}!function(e){function t(e){return e.hasOwnProperty("splatSize")}e.isInstanceOfNode=t}(Ce||(Ce={}));var qe=i("f7f0"),Ee=i("4b49"),Le=i("deae"),We=i("365a"),Te=i("5e70"),Ue=i("9305");const De=o["a"].getLogger("esri.views.3d.layers.PointCloudLayerView3D"),He=8,Qe=Object(y["d"])();let Ge=class extends(Object(qe["a"])(Object(P["a"])(We["a"]))){constructor(){super(...arguments),this.type="point-cloud-3d",this.maximumPointCount=4e6,this.slicePlaneEnabled=!1,this._renderer=null,this._rendererAdded=!1,this._renderedNodes=new Set,this._nodeScales=new Map,this._updateViewNeeded=!0,this._lodFactor=1,this._maxLoggedBoxWarnings=5,this._pageMultiplier=1,this._nodeLoadEpoch=0,this._indexQueue=[],this._workQueue=new Array,this._idleQueue=new v["a"],this._indexPagesLoading=new Map,this._loadingNodes=new Map,this._recalcWork=!0,this._layerIsVisible=!1,this._codedDomainPopulationPromise=null,this._codedDomainPopulationAbortController=null,this._totalWork=0,this._index=null,this._loadingInitNodePage=!1,this._nodeIdArray=[]}get pointScale(){const e=$(this.layer&&this.layer.renderer),t=1;return e&&null!=e.scaleFactor?e.scaleFactor:t}get useRealWorldSymbolSizes(){const e=K(this.layer&&this.layer.renderer),t=!1;return e&&null!=e.useRealWorldSymbolSizes?e.useRealWorldSymbolSizes:t}get pointSize(){const e=K(this.layer&&this.layer.renderer),t=0;return e&&null!=e.size?e.size:t}get inverseDensity(){const e=96;return this.layer&&this.layer.renderer?1*e/this.layer.renderer.pointsPerInch:5}get availableFields(){const e=G(this.layer),t=new Set;e.primaryAttribute&&t.add(e.primaryAttribute.name),e.modulationAttribute&&t.add(e.primaryAttribute.name);const i=B(this.layer);if(i)for(const n of i)t.add(n.attributeInfo.name);if(this.layer.outFields)for(const n of Object(x["v"])(this.layer.fieldsIndex,this.layer.outFields))t.add(n);return Array.from(t)}get _clippingBox(){if(!this.view||!this.view.clippingArea)return null;const e=Object(_["h"])(),t=this.view.renderSpatialReference;return Object(Ee["a"])(this.view.clippingArea,e,t)?e:null}get _elevationOffset(){const e=this.layer&&this.layer.elevationInfo;if(e&&"absolute-height"===e.mode){const t=Object(u["g"])(this.layer.spatialReference),i=Object(w["a"])(e.unit);return Object(a["v"])(e.offset,0)*i/t}return 0}initialize(){const e=this.view.resourceController;this._worker=new M(t=>e.schedule(t)),this.addResolvingPromise(this._worker.promise),this._tmpPoint=Object(O["j"])(0,0,0,this.layer.spatialReference),Object(C["c"])(this.layer),Object(C["b"])(this.layer,this.view),this._indexRequester=e.createStreamDataRequester(2),this._dataRequester=e.createStreamDataRequester(3),this._initRenderer();const t=this._initNodePages(),i=this.view.resourceController.memoryController;this._memCache=i.newCache(this.layer.uid),this.updatingHandles.add(this,"_clippingBox",()=>this._setUpdateViewNeeded(),2),this.updatingHandles.add(this,"_elevationOffset",()=>this._elevationOffsetChanged(),2),this.updatingHandles.add(this.layer,"renderer",()=>this._rendererChanged(),2),this.updatingHandles.add(this.layer,"filters",()=>this._reload(),2),this.updatingHandles.add(this.layer,"outFields",()=>this._reload(),2),this.updatingHandles.add(this.layer,"scaleRangeId",()=>this._setUpdateViewNeeded()),this.updatingHandles.add(this,"clippingArea",()=>this._setUpdateViewNeeded(),2),this.updatingHandles.add(this.view.state,"contentCamera",()=>this._setUpdateViewNeeded()),this.handles.add([this.view.basemapTerrain.on("scale-change",e=>this._scaleUpdateHandler(e)),i.events.on("quality-changed",()=>this._setUpdateViewNeeded())]),this.addResolvingPromise(t),this.when(()=>{this.handles.add([e.scheduler.registerTask(Ue["b"].POINT_CLOUD_LAYER,this),e.scheduler.registerIdleStateCallbacks(()=>this._idleBegin(),()=>this._idleEnd()),this.updatingHandles.add(this,"suspended",e=>{e?this._clearNodeState():this._setUpdateViewNeeded()},2)])},()=>{this.updatingHandles.removeAll(),this.handles.removeAll()})}_setUpdateViewNeeded(){this._updateViewNeeded=!0,this._updateLoading()}destroy(){this.cancelLoading(),this._worker&&(this._worker.destroy(),this._worker=null),this._destroyRenderer(),this._memCache.destroy(),this._memCache=null,this._codedDomainPopulationAbortController&&(this._codedDomainPopulationAbortController.abort(),this._codedDomainPopulationAbortController=null),this._codedDomainPopulationPromise=null}_initRenderer(){this._renderer=new Ce({createGraphic:(e,t,i)=>this._createGraphic(e,t,i)}),this._renderer.layerUid=this.layer.uid,this.updatingHandles.add(this,"_clippingBox",e=>this._renderer.clippingBox=e,2),this.updatingHandles.add(this,"suspended",e=>this._setPointsVisible(!e),2),this.updatingHandles.add(this,"pointScale",e=>this._renderer.scaleFactor=e,2),this._renderer.minSizePx=Math.sqrt(2),this.updatingHandles.add(this,"useRealWorldSymbolSizes",e=>this._renderer.useRealWorldSymbolSizes=e,2),this.updatingHandles.add(this,"pointSize",e=>{const t=Object(d["h"])(e);this._renderer.size=e,this._renderer.sizePx=t},2),this.updatingHandles.add(this,"slicePlaneEnabled",e=>this._renderer.slicePlaneEnabled=e,2),this.updatingHandles.add(this,"inverseDensity",()=>this._setUpdateViewNeeded(),2),this.updatingHandles.add(this,"maximumPointCount",()=>this._setUpdateViewNeeded(),2),this.updatingHandles.add(this.view,"qualitySettings.sceneService.pointCloud.lodFactor",e=>{this._lodFactor=e,this._setUpdateViewNeeded()},2)}_destroyRenderer(){this._renderer.removeAll(),this._setPointsVisible(!1)}_createGraphic(e,t,i){const n=Object(a["l"])(e.pointIdFilterMap)?e.pointIdFilterMap[t]:t,r=this.view.computeMapPointFromVec3d(i),s=this._createGraphicAttributes(e,n);return new ie({pointCloudMetadata:{nodeId:e.id,pointIndexInNode:t,attributePointIndexInNode:n,epoch:this._nodeLoadEpoch},geometry:r,attributes:s,layer:this.layer,sourceLayer:this.layer})}_createGraphicAttributes(e,t){const i={};for(const n of e.attributes)this._encodeGraphicAttribute(n.attributeInfo,n.values,t,i);return i}_encodeGraphicAttribute(e,t,i,n){const r=e.storageInfo&&e.storageInfo.attributeValues,s=r?r.valuesPerElement:1;if(1===s)n[e.name]=t[i];else if("UInt8"===r.valueType&&s<=4){let r=0;const o=i*s;for(let e=o;e<o+s;e++)r=(r<<8)+t[e];n[e.name]=r}else n[e.name]=void 0}_setPointsVisible(e){e&&!this._rendererAdded?(this.view._stage.addRenderPlugin([3],this._renderer),this._rendererAdded=!0):!e&&this._rendererAdded&&(this.view._stage.removeRenderPlugin(this._renderer),this._rendererAdded=!1)}_rendererChanged(){this._renderer.useFixedSizes=J(this.layer.renderer),this._reload()}_reload(){this._clearNodeState(),this._memCache.clear(),this._setUpdateViewNeeded()}_elevationOffsetChanged(){this._clearNodeState(),this._memCache.clear(),this._initNodePages()}_scaleUpdateHandler(e){this.layer.minScale||this.layer.maxScale?Object(g["n"])(e.extent,e.spatialReference,$e,this.layer.spatialReference)&&(this._nodeScales.forEach((t,i)=>{if(!this._renderedNodes.has(i))return void this._nodeScales.delete(i);const n=this._index.getNode(i);Object(m["h"])($e,n.obb.center)&&this._nodeScales.set(i,e.scale)}),this._setUpdateViewNeeded()):this._nodeScales.clear()}displayNodes(e){this._workQueue=N([...this._renderedNodes],e,this._index),V(this._workQueue,this.view.state.contentCamera.viewForward,this._index),q(this._workQueue,He,this._index),this._updateQueues(),this._totalWork=this._computeWork(),this._updateLoading(),this._layerIsVisible=e.length>0||this._loadingInitNodePage,this.notifyChange("suspended")}cancelLoading(){this._cancelNodeLoading(),this._cancelIndexLoading()}_cancelNodeLoading(){const e=new Array;this._loadingNodes.forEach(({abortController:t})=>e.push(t)),this._loadingNodes.clear();for(const t of e)t.abort();this._workQueue=[],this._idleQueue.cancelAll(),this._totalWork=this._computeWork(),this._updateLoading()}_updateQueues(){const e=new Set;this._workQueue.forEach(t=>t.load.forEach(t=>e.add(t)));const t=new Array,i=new Map;this._loadingNodes.forEach((n,r)=>{e.has(r)?i.set(r,n):t.push(n)}),this._loadingNodes=i;for(const{abortController:n}of t)n.abort();this._workQueue=this._workQueue.filter(e=>{for(const t of e.load)if(this._loadingNodes.has(t))return this._recalcWork=!0,!1;return!0}),this._totalWork=this._computeWork(),this._updateLoading()}_cancelIndexLoading(){this._indexQueue=[],this._indexPagesLoading.forEach(({abortController:e})=>e.abort()),this._indexPagesLoading.clear(),this._totalWork=this._computeWork(),this._updateLoading()}_clearNodeState(){this._nodeLoadEpoch++,this._renderedNodes.forEach(e=>this._removeFromRenderer(e)),this._cancelNodeLoading()}_idleBegin(){this._setUpdateViewNeeded()}_idleEnd(){this._setUpdateViewNeeded()}get running(){return this.suspended?this._updateViewNeeded:this._updateViewNeeded||this._indexQueue.length>0||this._workQueue.length>0||this._idleQueue.running}runTask(e){if(this.suspended){if(this._updateViewNeeded){this._updateViewNeeded=!1;const e=this._isRootNodeVisible();e!==this._layerIsVisible&&(this._layerIsVisible=e,this.notifyChange("suspended")),this._updateLoading()}}else{for(e.run(()=>this._updateWorkQueues());this._indexQueue.length>0&&e.run(()=>this._processIndexQueue()););this._processWorkQueue(e),this._idleQueue.runTask(e)}}_processIndexQueue(){const e=this._indexQueue.shift(),t=this._loadNodePage(e);return this._indexPagesLoading.set(e,t),t.promise.then(t=>{this._index.addPage(e,t,this._elevationOffset),this._setUpdateViewNeeded()}).then(()=>{this._indexPagesLoading.delete(e)},()=>{this._indexPagesLoading.delete(e)}),!0}_processWorkQueue(e){for(;!e.done;){const t=this._scheduleWorkEntry();if(Object(a["k"])(t))return;this._processWorkEntry(t),e.madeProgress()}}_scheduleWorkEntry(){let e=this._workQueue.length;for(;e--;){const e=this._workQueue.shift();if(!e.remove.find(e=>!this._renderedNodes.has(e)))return e;this._workQueue.push(e)}return null}_processWorkEntry(e){if(0!==e.load.length)Promise.all(e.load.map(e=>{const t=new AbortController,i=this._memCache.pop(e.toString());return Object(a["l"])(i)?this._loadingNodes.set(e,{abortController:t,promise:Promise.resolve(i)}):this._loadingNodes.has(e)||this._loadingNodes.set(e,{abortController:t,promise:this.loadNode(e,t.signal)}),this._loadingNodes.get(e).promise})).then(t=>{for(let i=0;i<e.load.length;i++)if(t[i]){const n=this._setupRendererData(e.load[i],t[i]);this._addToRenderer(n)}for(const i of e.remove)this._removeFromRenderer(i)}).catch(()=>{}).then(()=>{for(const t of e.load)this._loadingNodes.delete(t);this._updateLoading(),this._recalcWork&&!this._idleQueue.running&&0===this._indexQueue.length&&0===this._loadingNodes.size&&(this._recalcWork=!1,this._setUpdateViewNeeded())}),this._updateLoading();else for(const t of e.remove)this._removeFromRenderer(t)}async populateClassCodeCodedDomain(e,t){const i="CLASS_CODE",n=this.layer.fieldsIndex.get(i);if(!n||n.domain)return;if(-1===e.indexOf(n.name))return;const s=await Object(r["d"])(this.layer.queryCachedStatistics(i,{signal:t}));if(!1===s.ok)return;const o=s.value,a=o&&o.labels&&o.labels.labels;a&&Array.isArray(a)&&(n.domain=new S["a"]({name:"CLASS_CODE",codedValues:a.map(e=>new j["a"]({code:e.value,name:e.label}))}))}async prepareFetchPopupFeatures(e){return this._codedDomainPopulationPromise||(this._codedDomainPopulationAbortController=new AbortController,this._codedDomainPopulationPromise=this.populateClassCodeCodedDomain(e,this._codedDomainPopulationAbortController.signal).then(()=>{this._codedDomainPopulationAbortController=null})),this._codedDomainPopulationPromise}async whenGraphicAttributes(e,t){const i=this._splitGraphicsPerNode(e),n=this.layer.attributeStorageInfo,s=t.map(e=>Z(n,e)),o=async(e,t)=>{const i=this._index.getNode(t);await Object(r["b"])(s,async t=>{const n=t.useElevation?await this._loadElevationAttributeFromGeometry(i.resourceId):await this._loadAndParseAttribute(i,t);if(n)for(const i of e)if(this._isValidPointGraphic(i)){const e=i.pointCloudMetadata.attributePointIndexInNode;this._encodeGraphicAttribute(t,n,e,i.attributes)}})},a=[];return i.forEach((e,t)=>{a.push(o(e,t))}),await Object(l["j"])(a),e}_isValidPointGraphic(e){return e instanceof ie&&e.pointCloudMetadata&&e.pointCloudMetadata.epoch===this._nodeLoadEpoch}_splitGraphicsPerNode(e){const t=new Map;for(const i of e){if(!this._isValidPointGraphic(i))continue;const e=i.pointCloudMetadata,n=t.get(e.nodeId);n?n.push(i):t.set(e.nodeId,[i])}return t}async _loadAndParseAttribute(e,t){const i=await this._loadAttribute(e.resourceId,t,null);return Object(a["l"])(i)?Object(ee["d"])({attributeInfo:t,buffer:i},null,e.vertexCount):null}async _loadElevationAttributeFromGeometry(e){const t=this.layer.store.defaultGeometrySchema,i=Object(ee["e"])(t,await this._loadGeometry(e,null));return Object(ee["a"])(i,i.length/3)}highlight(e){if(!e)return{remove(){}};const t=s["a"].isCollection(e)?e.toArray():Array.isArray(e)?e:[e];return this._renderer.highlight(t.map(e=>this._graphicToPointDefinition(e)))}_graphicToPointDefinition(e){if(!this._isValidPointGraphic(e))return null;const{nodeId:t,pointIndexInNode:i}=e.pointCloudMetadata;return null!=t&&null!=i?{nodeId:t,pointId:i}:null}_computeWork(){let e=0;for(const t of this._workQueue)e+=t.load.length+t.remove.length;return e+=this._loadingNodes.size,e+=(this._indexQueue.length+this._indexPagesLoading.size)*this._index.pageSize,e+=this._loadingInitNodePage?100:0,e+=this._updateViewNeeded?100:0,e}get updatingProgressValue(){if(this.suspended)return this._updateViewNeeded?0:1;const e=this._computeWork();return 1-Math.min(this._totalWork,e)/this._totalWork}_updateLoading(){this.notifyChange("updating"),this.notifyChange("updatingProgressValue")}canResume(){return super.canResume()&&this._layerIsVisible}isUpdating(){return this.suspended?this._updateViewNeeded:this._computeWork()>0}_initNodePages(){const e=this.layer.store.index,t=e.nodesPerPage||e.nodePerIndexBlock;return this._index=new W(this.layer.spatialReference,this.view.renderCoordsHelper.spatialReference,t),this._cancelIndexLoading(),this._traverseVisible=this._index.createVisibilityTraverse(),this._loadingInitNodePage=!0,this._layerIsVisible=!0,this.notifyChange("suspended"),this._updateLoading(),this._pageMultiplier=null!=e.nodesPerPage?1:e.nodePerIndexBlock,this._loadNodePage(0).promise.then(e=>{this._index.addPage(0,e,this._elevationOffset),this._loadingInitNodePage=!1,this._setUpdateViewNeeded()})}_loadNodePage(e){const t=new AbortController,i=`${this.baseUrl}/nodepages/${e*this._pageMultiplier}`;return{promise:this._requestNodePage(i,t.signal).then(t=>t.nodes.map((t,i)=>({resourceId:null!=t.resourceId?t.resourceId:e*this._index.pageSize+i,obb:t.obb,firstChild:t.firstChild,childCount:t.childCount,vertexCount:null!=t.vertexCount?t.vertexCount:t.pointCount,lodThreshold:null!=t.lodThreshold?t.lodThreshold:t.effectiveArea}))),abortController:t}}_updateWorkQueues(){if(!this._updateViewNeeded)return!1;let e=this.inverseDensity/this._lodFactor*this._getLodMemoryFactor();const t=this.maximumPointCount*this._lodFactor*this._getLodMemoryFactor();let i=this._computeNodesForMinimumDensity(e),n=this._computePointCount(i),r=Math.sqrt(n/(.75*t));for(;n>t;)e*=r,i=this._computeNodesForMinimumDensity(e),n=this._computePointCount(i),r=Math.sqrt(2);return this.displayNodes(i),this._updateViewNeeded=!1,this._updateLoading(),!0}_computePointCount(e){let t=0;for(let i=0;i<e.length;i++){const n=this._index.getNode(e[i]);n&&(t+=n.vertexCount)}return t}_getLodMemoryFactor(){return this.view.resourceController.memoryController.memoryFactor}_isRootNodeVisible(){let e=!1;return this._traverseVisible({frustum:this.view.state.contentCamera.frustum,clippingBox:this._clippingBox},{predicate:(t,i,n)=>(e=n,!1),pageMiss:()=>{}}),e}_computeNodesForMinimumDensity(e){const t=this.view.state.contentCamera,i=t.frustum,n=this._clippingBox,r=t.viewForward,s=Object(f["k"])(r,t.eye),o=Object(y["f"])(r,-s,Qe),a=t.perScreenPixelRatio/2,l=e*e,d=this._nodeIdArray;d.length=0;const{minScale:c,maxScale:u}=Object(Te["a"])(this.layer),h=0===c&&0===u?e=>d.push(e):e=>{const t=this._getScale(e);Object(Te["d"])(t,c,u)&&d.push(e)};return this._traverseVisible({frustum:i,clippingBox:n},{predicate:(e,t,i)=>{if(!i)return!1;if(0===t.childCount)return h(e),!1;const n=this._index.getRenderObb(e);return!(this._computeAveragePixelArea(n,t.lodThreshold,t.vertexCount,o,a)<=l)||(h(e),!1)},pageMiss:(e,t)=>{h(e),this._indexQueue.indexOf(t)<0&&this._indexQueue.push(t)}}),d}_getScale(e){let t=this._nodeScales.get(e);if(null==t){const i=this._index.getNode(e).obb.center;this._tmpPoint.x=i[0],this._tmpPoint.y=i[1],this._tmpPoint.z=i[2],t=this.view.basemapTerrain.getScale(this._tmpPoint),this._nodeScales.set(e,t)}return t}_computeAveragePixelArea(e,t,i,n,r){const s=1e-7,o=Math.max(s,Object(L["j"])(e,n));return t/(o*o)/(4*r*r)/i}loadNode(e,t){try{return this.loadNodeAsync(e,t)}catch(i){throw Object(l["m"])(i)||De.error(i),i}}async loadAdditionalUserAttributes(e,t,i){const n=this.layer.outFields;if(!n)return[];const r=Object(x["v"])(this.layer.fieldsIndex,n),s=new Set(e.map(e=>Object(a["l"])(e)?e.name:null)),o=this.layer.attributeStorageInfo,d=[];for(const a of r){if(s.has(a))continue;const e=Z(o,a);e&&d.push(t(e))}const c=await Object(l["k"])(d);return Object(l["w"])(i),Object(a["p"])(c,e=>e)}async loadNodeAsync(e,t){const i=this._index.getNode(e),n=G(this.layer),r=B(this.layer),s=i.resourceId,o=async e=>{if(Object(a["k"])(e))return null;if(e.useElevation)return{attributeInfo:e,buffer:null};const i=await this._loadAttribute(s,e,t);return Object(a["l"])(i)?{attributeInfo:e,buffer:i}:null};return this._idleQueue.push(async()=>{const i=this._loadGeometry(s,t),{primaryAttribute:a,modulationAttribute:d}=n,c=o(a),u=o(d),h=r.map(e=>e.attributeInfo),p=h.map(e=>o(e)),f=this.loadAdditionalUserAttributes([a,d,...h],o,t),[b,g,_,m,y]=await Promise.all([i,c,u,Promise.all(p),f]);Object(l["w"])(t);const O={geometryBuffer:b,primaryAttributeData:g,modulationAttributeData:_,filterAttributesData:m,userAttributesData:y,schema:this.layer.store.defaultGeometrySchema,rendererInfo:n,filterInfo:r,obb:this._index.getRenderObb(e),elevationOffset:this._elevationOffset,inSR:this.layer.spatialReference.toJSON(),outSR:this.view.renderCoordsHelper.spatialReference.toJSON()};return this._worker.invoke(O,t)},t)}async _loadGeometry(e,t){return this._requestData(`${this.baseUrl}/nodes/${e}/geometries/0`,t)}async _loadAttribute(e,t,i){if(Object(a["k"])(t)||!t.storageInfo)return null;const n=t.storageInfo.key;return this._requestData(`${this.baseUrl}/nodes/${e}/attributes/${n}`,i)}_requestNodePage(e,t){const i={f:"json",token:this.layer.apiKey};return this._indexRequester.request(e,"json",{query:i,signal:t})}_requestData(e,t){return this._dataRequester.request(e,"binary",{query:{token:this.layer.apiKey},signal:t})}_removeFromRenderer(e){if(this._renderedNodes.has(e)){const t=this._renderer.removeNode(e);this._renderedNodes.delete(e),this._nodeScales.delete(e),this._memCache.put(t.id.toString(),t,Be(t))}}_addToRenderer(e){this._renderedNodes.has(e.id)||(this._renderedNodes.add(e.id),this._renderer.addNode(e))}_setupRendererData(e,t){const i=this._index.getNode(e),n=Math.sqrt(i.lodThreshold/i.vertexCount),r=this._index.getRenderObb(e);if(Ce.isInstanceOfNode(t))return t.splatSize=n,t.obb=r,t.origin=Object(b["a"])(t.obb.center),t;const s=.01*Math.max(r.halfSize[0],r.halfSize[1],r.halfSize[2]);if(t.obb.halfSize[0]>r.halfSize[0]+s||t.obb.halfSize[1]>r.halfSize[1]+s||t.obb.halfSize[2]>r.halfSize[2]+s){if(this._maxLoggedBoxWarnings>0){const i=e=>`[${e.halfSize[0]}, ${e.halfSize[1]}, ${e.halfSize[2]}]`;De.warn(`Node ${e} reported bounding box too small. got ${i(r)} but points cover ${i(t.obb)}`),0==--this._maxLoggedBoxWarnings&&De.warn("  Too many bounding box errors, stopping reporting for this layer.")}this._index.setRenderObb(e,t.obb)}return{id:e,coordinates:t.points,origin:Object(b["a"])(r.center),rgb:t.rgb,attributes:t.attributes,pointIdFilterMap:t.pointIdFilterMap,highlights:null,splatSize:n,obb:r,isLeaf:0===i.childCount}}getUsedMemory(){let e=0;return this._renderer.forEachNode(t=>{e+=Ke,e+=Object(c["a"])(t.coordinates);for(const i of t.attributes){const t=i.values;Object(c["c"])(t.buffer)&&(e+=Object(c["a"])(t))}}),e}getUnloadedMemory(){const e=this._renderedNodes.size;if(e<4)return 0;const t=[...this._renderedNodes].reduce((e,t)=>e+this._index.getNode(t).vertexCount);let i=this._loadingNodes.size;for(let n=0;n<this._workQueue.length;n++)i+=this._workQueue[n].load.length,i-=this._workQueue[n].remove.length;return i<0?0:i*t/e*((this.getUsedMemory()-e*Ke)/t)+i*Ke}ignoresMemoryFactor(){return!1}get performanceInfo(){return{nodes:this._renderedNodes.size,displayedNumberOfFeatures:[...this._renderedNodes].reduce((e,t)=>e+this._index.getNode(t).vertexCount,0),maximumNumberOfFeatures:this.maximumPointCount,totalNumberOfFeatures:-1,core:null,"Loading Nodes":this._loadingNodes.size,"Index Queue":this._indexQueue.length,"Work Queue":this._workQueue.length,"Idle Queue":this._idleQueue.length}}get test(){return{index:this._index,visibleNodes:this._renderedNodes}}};function Be(e){return 5*e.coordinates.length+128}Object(n["a"])([Object(h["b"])()],Ge.prototype,"layer",void 0),Object(n["a"])([Object(h["b"])({readOnly:!0,aliasOf:"layer.parsedUrl.path"})],Ge.prototype,"baseUrl",void 0),Object(n["a"])([Object(h["b"])({readOnly:!0})],Ge.prototype,"pointScale",null),Object(n["a"])([Object(h["b"])({readOnly:!0})],Ge.prototype,"useRealWorldSymbolSizes",null),Object(n["a"])([Object(h["b"])({readOnly:!0})],Ge.prototype,"pointSize",null),Object(n["a"])([Object(h["b"])({readOnly:!0})],Ge.prototype,"inverseDensity",null),Object(n["a"])([Object(h["b"])()],Ge.prototype,"maximumPointCount",void 0),Object(n["a"])([Object(h["b"])({readOnly:!0})],Ge.prototype,"availableFields",null),Object(n["a"])([Object(h["b"])({readOnly:!0})],Ge.prototype,"_clippingBox",null),Object(n["a"])([Object(h["b"])({readOnly:!0})],Ge.prototype,"_elevationOffset",null),Object(n["a"])([Object(h["b"])({type:Boolean})],Ge.prototype,"slicePlaneEnabled",void 0),Object(n["a"])([Object(h["b"])()],Ge.prototype,"updating",void 0),Object(n["a"])([Object(h["b"])(Le["a"])],Ge.prototype,"updatingProgress",void 0),Object(n["a"])([Object(h["b"])({readOnly:!0})],Ge.prototype,"updatingProgressValue",null),Ge=Object(n["a"])([Object(p["a"])("esri.views.3d.layers.PointCloudLayerView3D")],Ge);const $e=Object(m["m"])(),Ke=160,Je=Ge},ad73:function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return s}));var n=i("b2b2"),r=i("c1da");async function s(e,t=e.popupTemplate){if(!Object(n["l"])(t))return[];const i=await t.getRequiredFields(e.fieldsIndex),{lastEditInfoEnabled:s}=t,{objectIdField:o,typeIdField:a,globalIdField:l,relationships:d}=e;if(i.includes("*"))return["*"];const c=s?await Object(r["n"])(e):[],u=Object(r["j"])(e.fieldsIndex,[...i,...c]);return a&&u.push(a),u&&o&&e.fieldsIndex.has(o)&&-1===u.indexOf(o)&&u.push(o),u&&l&&e.fieldsIndex.has(l)&&-1===u.indexOf(l)&&u.push(l),d&&d.forEach(t=>{const{keyField:i}=t;u&&i&&e.fieldsIndex.has(i)&&-1===u.indexOf(i)&&u.push(i)}),u}function o(e,t){return e.popupTemplate?e.popupTemplate:Object(n["l"])(t)&&t.defaultPopupTemplateEnabled&&Object(n["l"])(e.defaultPopupTemplate)?e.defaultPopupTemplate:null}},bc58:function(e,t,i){"use strict";i.d(t,"a",(function(){return d})),i.d(t,"b",(function(){return l}));var n=i("d272"),r=i("6a07"),s=i("501b"),o=i("3886"),a=i("690a");function l(e){const t=new a["a"],i=0===e.output,l=1===e.output,d=4===e.output;return t.extensions.add("GL_OES_standard_derivatives"),t.include(n["a"],e),t.attributes.add("position","vec3"),t.attributes.add("color","vec3"),t.vertex.uniforms.add("uModelViewMatrix","mat4").add("uProjectionMatrix","mat4").add("uScreenMinMaxSize","vec2").add("uPointScale","vec2").add("uClipMin","vec3").add("uClipMax","vec3"),l?(t.vertex.uniforms.add("nearFar","vec2"),t.varyings.add("depth","float")):4!==e.output&&t.varyings.add("vColor","vec3"),t.vertex.code.add(o["a"]`
    void main(void) {
      // Move clipped points outside of clipspace
      if (position.x < uClipMin.x || position.y < uClipMin.y || position.z < uClipMin.z ||
        position.x > uClipMax.x || position.y > uClipMax.y || position.z > uClipMax.z) {
        gl_Position = vec4(0.0,0.0,0.0,2.0);
        gl_PointSize = 0.0;
        return;
      }

      if (rejectBySlice(position)) {
        gl_Position = vec4(0.0,0.0,0.0,2.0);
        gl_PointSize = 0.0;
        return;
      }

      // Position in camera space
      vec4 camera = uModelViewMatrix * vec4(position, 1.0);

      float pointSize = uPointScale.x;
      vec4 position = uProjectionMatrix * camera;
     ${e.drawScreenSize?o["a"]`
      float clampedScreenSize = pointSize;`:o["a"]`
      float pointRadius = 0.5 * pointSize;
      vec4 cameraOffset = camera + vec4(0.0, pointRadius, 0.0, 0.0);
      vec4 positionOffset = uProjectionMatrix * cameraOffset;
      float radius = abs(positionOffset.y - position.y);
      float viewHeight = uPointScale.y;
      // screen diameter = (2 * r / w) * (h / 2)
      float screenPointSize = (radius / position.w) * viewHeight;
      float clampedScreenSize = clamp(screenPointSize, uScreenMinMaxSize.x, uScreenMinMaxSize.y);
      // Shift towards camera, to move rendered point out of terrain i.e. to
      // the camera-facing end of the virtual point when considering it as a
      // 3D sphere.
      camera.xyz -= normalize(camera.xyz) * pointRadius * clampedScreenSize / screenPointSize;
      position = uProjectionMatrix * camera;`}

     gl_PointSize = clampedScreenSize;
     gl_Position = position;

     ${l?o["a"]`depth = (-camera.z - nearFar[0]) / (nearFar[1] - nearFar[0]);`:""}
     ${i?o["a"]`vColor = color;`:""}
    }
  `),t.fragment.include(s["a"],e),d&&t.include(r["a"]),t.fragment.code.add(o["a"]`
    void main(void) {
      vec2 vOffset = gl_PointCoord - vec2(0.5, 0.5);
      float r2 = dot(vOffset, vOffset);

      if (r2 > 0.25) {
        discard;
      }
      ${l?o["a"]`gl_FragColor = float2rgba(depth);`:""}
      ${d?o["a"]`outputHighlight();`:""}
      ${i?o["a"]`gl_FragColor = vec4(vColor, 1.0);`:""}
    }
  `),t}const d=Object.freeze({__proto__:null,build:l})},ee9c:function(e,t,i){"use strict";i.d(t,"a",(function(){return he})),i.d(t,"b",(function(){return se})),i.d(t,"c",(function(){return re})),i.d(t,"d",(function(){return ie})),i.d(t,"e",(function(){return te})),i.d(t,"f",(function(){return Y})),i.d(t,"g",(function(){return X})),i.d(t,"h",(function(){return ve})),i.d(t,"i",(function(){return R})),i.d(t,"j",(function(){return I})),i.d(t,"k",(function(){return L})),i.d(t,"l",(function(){return A})),i.d(t,"m",(function(){return J})),i.d(t,"n",(function(){return B})),i.d(t,"o",(function(){return V})),i.d(t,"p",(function(){return $})),i.d(t,"q",(function(){return ue})),i.d(t,"r",(function(){return K})),i.d(t,"s",(function(){return E})),i.d(t,"t",(function(){return k})),i.d(t,"u",(function(){return le})),i.d(t,"v",(function(){return pe})),i.d(t,"w",(function(){return de})),i.d(t,"x",(function(){return W}));var n=i("2eab"),r=i("b50f"),s=i("ce50"),o=i("c120"),a=i("b2b2"),l=i("f4cc"),d=i("a21b"),c=i("1c92"),u=i("dae5"),h=i("d791"),p=i("afe1"),f=i("04f0"),b=i("e764"),g=i("e431"),_=i("0b2d"),m=i("0fc4"),y=i("8188"),O=i("f694"),j=i("5996"),S=i("9180"),x=i("7f83"),v=i("69dd"),w=i("ad64"),P=i("82de"),z=i("ec13"),M=i("caf1"),C=i("cee3");function N(e){return e&&parseInt(e.substring(e.lastIndexOf("/")+1,e.length),10)}function R(e){if(Object(o["a"])("disable-feature:i3s-draco")||!e)return!1;for(const i of e)for(const e of i.geometryBuffers){var t;if("draco"===(null==(t=e.compressedAttributes)?void 0:t.encoding))return!0}return!1}function A(e,t,i,n,r,s){r.traverse(i,i=>{let r=i.mbs;t!==n&&(r=q,Object(y["o"])(i.mbs,n,r,t));const o=E(e,r);return 0!==o&&(s(i,o),!0)})}function I(e,t,i){let n=0,r=0;for(let s=0;s<t.length&&n<e.length;s++)e[n]===t[s]&&(i(s)&&(e[r]=e[n],r++),n++);e.length=r}function k(e,t,i){let n=0,s=0;for(;n<i.length;)Object(r["b"])(e,i[n])>=0===t&&(i[s]=i[n],s++),n++;i.length=s}const F=Object(S["m"])();function V(e,t){if(0===t.rotationScale[1]&&0===t.rotationScale[2]&&0===t.rotationScale[3]&&0===t.rotationScale[5]&&0===t.rotationScale[6]&&0===t.rotationScale[7])return F[0]=(e[0]-t.position[0])/t.rotationScale[0],F[1]=(e[1]-t.position[1])/t.rotationScale[4],F[2]=(e[2]-t.position[0])/t.rotationScale[0],F[3]=(e[3]-t.position[1])/t.rotationScale[4],F}const q=Object(m["e"])();function E(e,t){const i=t[0],n=t[1],r=t[3],s=e[0]-i,o=i-e[2],a=e[1]-n,l=n-e[3],d=Math.max(s,o,0),c=Math.max(a,l,0),u=d*d+c*c;return u>r*r?0:u>0?1:-Math.max(s,o,a,l)>r?3:2}function L(e,t,i){const n=[],r=i&&i.missingFields,s=i&&i.originalFields;for(const o of e){const e=o.toLowerCase();let i=!1;for(const r of t)if(e===r.name.toLowerCase()){n.push(r.name),i=!0,s&&s.push(o);break}!i&&r&&r.push(o)}return n}async function W(e,t,i,n,o){if(0===t.length)return[];const l=e.attributeStorageInfo;if(Object(a["l"])(e.associatedLayer))try{return await U(e.associatedLayer,t,i,n)}catch(d){if(e.associatedLayer.loaded)throw d}if(l){const d=T(t,i,o);if(Object(a["k"])(d))throw new s["a"]("scenelayer:features-not-loaded","Tried to query attributes for unloaded features");const c=e.parsedUrl.path,u=await Promise.all(d.map(e=>H(c,l,e.node,e.indices,n).then(t=>{for(let i=0;i<e.graphics.length;i++){const n=e.graphics[i],r=t[i];if(n.attributes)for(const e in n.attributes)e in r||(r[e]=n.attributes[e]);n.attributes=r}return e.graphics})));return Object(r["f"])(u)}throw new s["a"]("scenelayer:no-attribute-source","This scene layer does not have a source for attributes available")}function T(e,t,i){const n=new Map,r=[],s=i();for(const o of e){const e=o.attributes[t];for(let t=0;t<s.length;t++){const i=s[t],a=i.featureIds.indexOf(e);if(a>=0){let e=n.get(i.node);e||(e={node:i.node,indices:[],graphics:[]},r.push(e),n.set(i.node,e)),e.indices.push(a),e.graphics.push(o);for(let i=t;i>0;i--)s[i]=s[i-1];s[0]=i;break}}}return r}async function U(e,t,i,n){t.sort((e,t)=>e.attributes[i]-t.attributes[i]);const r=t.map(e=>e.attributes[i]),s=[],o=L(n,e.fields,{originalFields:s}),a=await D(e,r,o);for(let l=0;l<t.length;l++){const e=t[l],i=a[l],n={};if(e.attributes)for(const t in e.attributes)n[t]=e.attributes[t];for(let t=0;t<s.length;t++)n[s[t]]=i[o[t]];e.attributes=n}return t}function D(e,t,i){const n=e.capabilities.query.maxRecordCount;if(null!=n&&t.length>n){const s=Object(r["n"])(t,n);return Promise.all(s.map(t=>D(e,t,i))).then(r["f"])}const o=new v["a"]({objectIds:t,outFields:i,orderByFields:[e.objectIdField]});return e.queryFeatures(o).then(e=>{if(e&&e.features&&e.features.length===t.length)return e.features.map(e=>e.attributes);throw new s["a"]("scenelayer:feature-not-in-associated-layer","Feature not found in associated feature layer")})}function H(e,t,i,r,s){const o=[];for(const n of t)if(n&&-1!==s.indexOf(n.name)){const t=`${e}/nodes/${i.resources.attributes}/attributes/${n.key}/0`;o.push({url:t,storageInfo:n})}return Object(l["j"])(o.map(e=>Object(n["default"])(e.url,{responseType:"array-buffer"}).then(t=>Object(w["d"])(e.storageInfo,t.data)))).then(e=>{const t=[];for(const i of r){const n={};for(let t=0;t<e.length;t++)null!=e[t].value&&(n[o[t].storageInfo.name]=B(e[t].value,i));t.push(n)}return t})}const Q=-32768,G=-(2**31);function B(e,t){if(!e)return null;const i=e[t];return Object(d["f"])(e)?i===Q?null:i:Object(d["g"])(e)?i===G?null:i:i!=i?null:i}function $(e){const t=e.store.indexCRS||e.store.geographicCRS,i=void 0===t?e.store.indexWKT:void 0;if(i){if(!e.spatialReference)throw new s["a"]("layerview:no-store-spatial-reference-wkt-index-and-no-layer-spatial-reference","Found indeWKT in the scene layer store but no layer spatial reference",{});if(i!==e.spatialReference.wkt)throw new s["a"]("layerview:store-spatial-reference-wkt-index-incompatible","The indeWKT of the scene layer store does not match the WKT of the layer spatial reference",{})}const n=t?new j["a"](N(t)):e.spatialReference;return n.equals(e.spatialReference)?e.spatialReference:n}function K(e){const t=e.store.vertexCRS||e.store.projectedCRS,i=void 0===t?e.store.vertexWKT:void 0;if(i){if(!e.spatialReference)throw new s["a"]("layerview:no-store-spatial-reference-wkt-vertex-and-no-layer-spatial-reference","Found vertexWKT in the scene layer store but no layer spatial reference",{});if(i!==e.spatialReference.wkt)throw new s["a"]("layerview:store-spatial-reference-wkt-vertex-incompatible","The vertexWKT of the scene layer store does not match the WKT of the layer spatial reference",{})}const n=t?new j["a"](N(t)):e.spatialReference;return n.equals(e.spatialReference)?e.spatialReference:n}function J(e,t){return Object(a["k"])(t)?"@null":t===Object(O["g"])(t)?"@ECEF":e.equals(t)?"":null!=t.wkid?"@"+t.wkid:null}function Y(e,t,i){if(!Object(y["b"])(e,t))throw new s["a"]("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{});if("local"===i&&!Z(e,t))throw new s["a"]("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{})}function Z(e,t){return e.equals(t)||e.isWGS84&&t.isWebMercator||e.isWebMercator&&t.isWGS84}function X(e,t,i){const n=$(e),r=K(e);Y(n,t,i),Y(r,t,i)}function ee(e){return(null==e.geometryType||"triangles"===e.geometryType)&&(null==e.topology||"PerAttributeArray"===e.topology)&&null!=e.vertexAttributes&&null!=e.vertexAttributes.position}function te(e){if(null==e.store||null==e.store.defaultGeometrySchema||!ee(e.store.defaultGeometrySchema))throw new s["a"]("scenelayer:unsupported-geometry-schema","The geometry schema of this scene layer is not supported.",{url:e.parsedUrl.path})}function ie(e,t){X(e,t.spatialReference,t.viewingMode)}function ne(e){return null!=e.geometryType&&"points"===e.geometryType&&(null==e.topology||"PerAttributeArray"===e.topology)&&(null==e.encoding||""===e.encoding||"lepcc-xyz"===e.encoding)&&null!=e.vertexAttributes&&null!=e.vertexAttributes.position}function re(e){if(null==e.store||null==e.store.defaultGeometrySchema||!ne(e.store.defaultGeometrySchema))throw new s["a"]("pointcloud:unsupported-geometry-schema","The geometry schema of this point cloud scene layer is not supported.",{})}function se(e,t){Y(e.spatialReference,t.spatialReference,t.viewingMode)}function oe(e){return"simple"===e.type||"class-breaks"===e.type||"unique-value"===e.type}function ae(e){return"mesh-3d"===e.type}function le(e){if(null==e||!oe(e))return!0;if(("unique-value"===e.type||"class-breaks"===e.type)&&null==e.defaultSymbol)return!0;const t=e.getSymbols();if(0===t.length)return!0;for(const i of t){if(!ae(i)||0===i.symbolLayers.length)return!0;for(const e of i.symbolLayers.items)if("fill"!==e.type||Object(a["k"])(e.material)||Object(a["k"])(e.material.color)||"replace"!==e.material.colorMixMode)return!0}return!1}const de=Object(z["c"])({color:[0,0,0,0],opacity:0});class ce{constructor(){this.edgeMaterial=null,this.material=null,this.castShadows=!0}}function ue(e){const t=new ce;let i=!1,n=!1;for(const r of e.symbolLayers.items)if("fill"===r.type&&r.enabled){const e=r.material,s=r.edges;if(Object(a["l"])(e)&&!i){const n=e.color,s=Object(M["b"])(e.colorMixMode);Object(a["l"])(n)?t.material={color:[n.r/255,n.g/255,n.b/255],alpha:n.a,colorMixMode:s}:t.material={color:[1,1,1],alpha:1,colorMixMode:1},t.castShadows=r.castShadows,i=!0}Object(a["l"])(s)&&!n&&(t.edgeMaterial=Object(z["b"])(s,{}),n=!0)}return t.material||(t.material={color:[1,1,1],alpha:1,colorMixMode:1}),t}function he(e,t){return(0|e)+(0|t)|0}function pe(e,t,i,n,r=0){n===Object(O["g"])(n)?t.isGeographic?xe(e,i,t,r):Se(e,i,t,r):t.isWGS84&&(n.isWebMercator||Object(x["k"])(n))?fe(t,e,n,i,r):t.isWebMercator&&Object(x["k"])(n)?Oe(t,e,n,i,r):e===i?(i.center[2]+=r,Object(y["p"])(i.center,t,0,i.center,n,0,1)):(Object(g["z"])(i.center,e.center[0],e.center[1],e.center[2]+r),Object(y["p"])(i.center,t,0,i.center,n,0,1),Object(f["a"])(i.quaternion,e.quaternion),Object(g["n"])(i.halfSize,e.halfSize))}function fe(e,t,i,n,r){Object(g["n"])(me,t.center),me[2]+=r;const s=Object(O["g"])(i);Object(y["p"])(me,e,0,me,s,0,1),je(s,t,me,i,n)}const be=new Float64Array(24),ge={data:be,size:3},_e=Object(_["f"])(),me=Object(_["f"])(),ye=Object(u["b"])();function Oe(e,t,i,n,r){Object(g["n"])(me,t.center),me[2]+=r,je(e,t,me,i,n)}function je(e,t,i,n,r){const s=Object(c["h"])(ye,t.quaternion);for(let o=0;o<8;++o){for(let e=0;e<3;++e)_e[e]=t.halfSize[e]*(0!=(o&1<<e)?-1:1);for(let e=0;e<3;++e){let t=i[e];for(let i=0;i<3;++i)t+=_e[i]*s[3*i+e];be[3*o+e]=t}}Object(y["p"])(be,e,0,be,n,0,8),Object(C["c"])(ge,r)}function Se(e,t,i,n){Object(C["d"])(e,ze),Object(g["z"])(t.center,e.center[0],e.center[1],e.center[2]+n),Object(y["d"])(i,t.center,we,Object(O["g"])(i)),Object(g["z"])(t.center,we[12],we[13],we[14]);const r=2*Math.sqrt(1+we[0]+we[5]+we[10]);Pe[0]=(we[6]-we[9])/r,Pe[1]=(we[8]-we[2])/r,Pe[2]=(we[1]-we[4])/r,Pe[3]=.25*r,Object(f["g"])(t.quaternion,Pe,e.quaternion),Object(f["b"])(Pe,t.quaternion);let s=0,o=0,a=0;for(const l of ze)l[2]+=n,Object(y["p"])(l,i,0,l,Object(O["g"])(i),0,1),Object(g["C"])(Re,l,t.center),Object(g["x"])(Re,Re,Pe),s=Math.max(s,Math.abs(Re[0])),o=Math.max(o,Math.abs(Re[1])),a=Math.max(a,Math.abs(Re[2]));Object(g["z"])(t.halfSize,s,o,a)}function xe(e,t,i,n){const r=Object(O["e"])(i),s=1+Math.max(0,n)/(r.radius+e.center[2]);Object(g["z"])(t.center,e.center[0],e.center[1],e.center[2]+n),Object(y["p"])(t.center,i,0,t.center,Object(O["g"])(i),0,1),Object(f["a"])(t.quaternion,e.quaternion),Object(f["b"])(Pe,e.quaternion),Object(g["z"])(Re,0,0,1),Object(g["x"])(Re,Re,Pe),Object(g["z"])(Re,e.halfSize[0]*Math.abs(Re[0]),e.halfSize[1]*Math.abs(Re[1]),e.halfSize[2]*Math.abs(Re[2])),Object(g["h"])(Re,Re,r.inverseFlattening),Object(g["i"])(t.halfSize,e.halfSize,Re),Object(g["h"])(t.halfSize,t.halfSize,s)}function ve(e,t,i,n,r,s){if(!s||0===s.length||Object(a["k"])(t))return null;const o=Object(P["a"])(e.mbs,r,i,t);let l;Object(h["c"])(Ie,o);const d=()=>{if(!l)if(l=ze,Object(S["o"])(Ce),Object(a["l"])(e.serviceObb)){pe(e.serviceObb,i,Ne,t,r),Object(C["d"])(Ne,l);for(const e of l)Object(g["t"])(e,e,Ie),Object(S["r"])(Ce,e)}else{const n=e.mbs,s=n[3];Object(y["y"])(n,i,Re,t),Object(g["t"])(Re,Re,Ie),Re[2]+=r;for(let e=0;e<8;++e){const t=1&e?s:-s,i=2&e?s:-s,n=4&e?s:-s,r=l[e];Object(g["n"])(r,[Re[0]+t,Re[1]+i,Re[2]+n]),Object(S["r"])(Ce,r)}}};let c=1/0,u=-1/0;const p=e=>{if("replace"!==e.type)return;const i=e.geometry;if(!i.hasZ)return;Object(S["o"])(Me);const r=i.spatialReference||n,s=i.rings.reduce((e,i)=>i.reduce((e,i)=>(Object(y["y"])(i,r,Re,t),Object(g["t"])(Re,Re,Ie),Object(S["r"])(Me,Re),Math.min(Re[2],e)),e),1/0);d(),Object(S["x"])(Ce,Me)&&(c=Math.min(c,s),u=Math.max(u,s))};if(s.forEach(e=>p(e)),c===1/0)return null;const f=(e,t,i)=>{Object(g["t"])(Re,i,o),e[t+0]=Re[0],e[t+1]=Re[1],e[t+2]=Re[2],t+=24,i[2]=c,Object(g["t"])(Re,i,o),e[t+0]=Re[0],e[t+1]=Re[1],e[t+2]=Re[2],t+=24,i[2]=u,Object(g["t"])(Re,i,o),e[t+0]=Re[0],e[t+1]=Re[1],e[t+2]=Re[2]};for(let a=0;a<8;++a)f(Ae.data,3*a,l[a]);return Object(C["c"])(Ae)}const we=Object(p["d"])(),Pe=Object(b["b"])(),ze=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],Me=Object(S["m"])(),Ce=Object(S["m"])(),Ne=Object(C["e"])(),Re=[0,0,0],Ae={data:new Array(72),size:3},Ie=Object(p["d"])()},f7f0:function(e,t,i){"use strict";i.d(t,"a",(function(){return d}));var n=i("a4ee"),r=i("ce50"),s=i("b2b2"),o=(i("e92d"),i("cea0"),i("b50f"),i("c120"),i("2dd4"),i("d386")),a=i("c1da"),l=i("ad73");const d=e=>{let t=class extends e{_validateFetchPopupFeatures(e){const{layer:t}=this,{popupEnabled:i}=t;return i?Object(l["a"])(t,e)?void 0:new r["a"]("scenelayerview3d:fetchPopupFeatures","Layer does not define a popup template",{layer:t}):new r["a"]("scenelayerview3d:fetchPopupFeatures","Popups are disabled",{layer:t})}async prepareFetchPopupFeatures(e){}async fetchPopupFeatures(e,t){const i=this._validateFetchPopupFeatures(t);if(i)return Promise.reject(i);const n=Object(s["l"])(t)?t.clientGraphics:null;if(!n||0===n.length)return Promise.resolve([]);const r="scene"===this.layer.type&&Object(s["l"])(this.layer.associatedLayer)?this.layer.associatedLayer:this.layer,o=Object(a["v"])(this.layer.fieldsIndex,await Object(l["b"])(r,Object(l["a"])(this.layer,t)));await this.prepareFetchPopupFeatures(o);const d=new Set,c=[],u=[];for(const s of n)Object(a["t"])(o,s,d)?u.push(s):c.push(s);return 0===u.length?Promise.resolve(c):this.whenGraphicAttributes(u,[...d]).catch(()=>u).then(e=>c.concat(e))}};return t=Object(n["a"])([Object(o["a"])("esri.views.3d.layers.support.PopupSceneLayerView")],t),t}}}]);