(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5f3937a2"],{"1bd2":function(e,t,i){"use strict";i.d(t,"a",(function(){return c}));var s=i("a4ee"),n=i("b2b2"),r=i("fab3"),o=i("59b2"),a=(i("b50f"),i("c120"),i("cea0"),i("d386"));const c=e=>{let t=class extends(Object(r["b"])(e)){constructor(){super(...arguments),this.parent=null}get updating(){return!1}get visible(){const e=!Object(n["l"])(this.parent)||this.parent.visible&&!this.parent.suspended;return this.analysis.visible&&e}};return Object(s["a"])([Object(o["b"])({readOnly:!0})],t.prototype,"type",void 0),Object(s["a"])([Object(o["b"])({constructOnly:!0})],t.prototype,"analysis",void 0),Object(s["a"])([Object(o["b"])({constructOnly:!0})],t.prototype,"parent",void 0),Object(s["a"])([Object(o["b"])({constructOnly:!0})],t.prototype,"view",void 0),Object(s["a"])([Object(o["b"])({readOnly:!0})],t.prototype,"updating",null),Object(s["a"])([Object(o["b"])({readOnly:!0})],t.prototype,"visible",null),t=Object(s["a"])([Object(a["a"])("esri.views.3d.analysis.AnalysisView3D")],t),t}},"5fae":function(e,t,i){"use strict";i.d(t,"a",(function(){return l}));var s=i("b2b2"),n=i("d791"),r=i("afe1"),o=i("f53a"),a=i("5a22"),c=i("748f");class l extends o["a"]{constructor(e){super(e.view),this._resources=null,this._transform=Object(r["d"])()}get object(){return Object(s["l"])(this._resources)?this._resources.object:null}get transform(){return this._transform}set transform(e){Object(n["d"])(this._transform,e),Object(s["l"])(this._resources)&&(this._resources.object.transformation=this._transform)}recreate(){this.attached&&this.createResources()}recreateGeometry(){if(Object(s["k"])(this._resources))return;const e=this._resources.object,t=this.view._stage;t.removeMany(e.geometries),e.removeAllGeometries(),this.createGeometries(e),this.visible||e.setVisible(this.visible),t.addMany(e.geometries)}createResources(){this.destroyResources();const e=this.view._stage;if(!e)return;const t=new c["a"]({isPickable:!1,updatePolicy:1});e.add(t);const i=new a["a"]({castShadow:!1});i.transformation=this._transform,this.createExternalResources(),this.createGeometries(i),e.addMany(i.geometries),this.forEachExternalMaterial(t=>e.add(t)),e.add(i),t.add(i),this.visible||i.setVisible(!1),this._resources={layer:t,object:i}}destroyResources(){const e=this.view._stage;!Object(s["k"])(this._resources)&&e&&(e.remove(this._resources.object),e.remove(this._resources.layer),this.forEachExternalMaterial(t=>{e.remove(t),t.dispose()}),e.removeMany(this._resources.object.geometries),this._resources.object.dispose(),this.destroyExternalResources(),this._resources=null)}updateVisibility(e){Object(s["k"])(this._resources)||this._resources.object.setVisible(e)}}},"8e60":function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return be}));var s=i("a4ee"),n=i("fc29"),r=i("ce6d"),o=i("9096"),a=i("b2b2"),c=i("59b2"),l=i("b50f"),b=(i("c120"),i("cea0"),i("d386")),d=i("1bd2"),h=(i("e06a"),i("af40")),u=i("c649"),O=i("f4cc"),p=i("477c"),j=i("e431"),y=i("0b2d"),g=i("8188"),_=i("9180"),v=i("d18f");let f=class extends n["a"]{constructor(e){super(e),this.elevationAlignedTargetLocation=null,this.inputPoints={isValid:!1,observer:Object(y["f"])(),observerSurfaceNormal:null,target:Object(y["f"])(),targetSurfaceNormal:null,observerAdjusted:Object(y["f"])(),targetAdjusted:Object(y["f"])()},this.computationResult={start:Object(y["f"])(),end:Object(y["f"])(),intersection:Object(y["f"])(),isValid:!1,isTargetVisible:!1},this.result=null}updateComputationResults(){this.notifyChange("computationResult")}updateInputPoints(){this.notifyChange("inputPoints")}onElevationChange(){this.notifyChange("elevationAlignedTargetLocation")}};Object(s["a"])([Object(c["b"])()],f.prototype,"target",void 0),Object(s["a"])([Object(c["b"])()],f.prototype,"elevationAlignedTargetLocation",void 0),Object(s["a"])([Object(c["b"])()],f.prototype,"inputPoints",void 0),Object(s["a"])([Object(c["b"])()],f.prototype,"computationResult",void 0),Object(s["a"])([Object(c["b"])()],f.prototype,"result",void 0),f=Object(s["a"])([Object(b["a"])("esri.views.3d.analysis.LineOfSight.LineOfSightAnalysis")],f);var m,C=i("a915"),w=i("7361"),A=i("1a54"),V=i("7ffa");let R=m=class extends n["a"]{constructor(e){super(e)}clone(){return new m({type:this.type,id:Object(V["a"])(this.id),point:Object(V["a"])(this.point),normal:Object(V["a"])(this.normal),ray:Object(V["a"])(this.ray)})}equals(e){return this.type===e.type&&this.id===e.id&&Object(a["g"])(this.point,e.point)&&Object(l["e"])(this.normal,e.normal)&&Object(v["e"])(this.ray,e.ray)}};Object(s["a"])([Object(c["b"])()],R.prototype,"type",void 0),Object(s["a"])([Object(c["b"])({constructOnly:!0})],R.prototype,"id",void 0),Object(s["a"])([Object(c["b"])({constructOnly:!0})],R.prototype,"point",void 0),Object(s["a"])([Object(c["b"])({constructOnly:!0})],R.prototype,"normal",void 0),Object(s["a"])([Object(c["b"])({constructOnly:!0})],R.prototype,"ray",void 0),R=m=Object(s["a"])([Object(b["a"])("esri.views.3d.analysis.LineOfSight.LineOfSightIntersectionResult")],R);var E=i("6be6"),L=i("9990"),T=i("7a91"),I=i("a03d"),P=i("9250"),S=i("5c33");let D=class extends n["a"]{constructor(e){super(e)}initialize(){this.intersector=Object(P["b"])(this.view.state.viewingMode),this.intersector.options.hud=!1,this.intersector.options.store=0}getScreenPointIntersection(e){const t=Object(C["j"])(e,w["c"].get()),i=Object(L["c"])(this.view.state.camera,t,x);return this._getRayIntersection(i)}_getRayIntersection(e){if(Object(a["k"])(e))return null;this.view.sceneIntersectionHelper.intersectToolIntersectorRay(e,this.intersector);const t=this.intersector.results.min;if(!t.getIntersectionPoint(G))return null;const i=this.view.renderCoordsHelper.fromRenderCoords(G,this.view.spatialReference),s=Object(y["g"])(t.normal),n=Object(j["k"])(s,e.direction)>0?-1:1;if(Object(j["h"])(s,s,n),Object(E["a"])(t))return new R({type:0,id:`${t.target.layerUid}/${t.target.nodeIndex}/${t.target.componentIndex}`,point:i,normal:s,ray:Object(v["b"])(e)});if(Object(T["b"])(t))return new R({type:2,id:t.target.lij.slice(),point:i,normal:s,ray:Object(v["b"])(e)});const r=Object(S["a"])(t,this.view);if(Object(a["l"])(r)){const t=r.layer,n=r.sourceLayer;let o;return o=n&&"scene"===n.type?Object(A["g"])(r,n.objectIdField):r.uid,new R({type:0,id:`${t.uid}/${o}`,point:i,normal:s,ray:Object(v["b"])(e)})}return null}_canUpdateFromIntersectionResult(e,t){if(Object(a["k"])(e)||!t||e.type!==t.type)return!1;switch(e.type){case 2:{const i=e.id,s=t.id;return i[0]===s[0]&&i[1]===s[1]&&i[2]===s[2]||Object(I["i"])(i,s)}case 0:case 4:return e.id===t.id}}updateFromIntersectionResult(e){let t;if(2===e.type&&Object(a["l"])(e.point)){const i=G,s=H,n=z;this.view.renderCoordsHelper.toRenderCoords(e.point,s),this.view.renderCoordsHelper.worldUpAtPosition(s,n);const r=this.view.basemapTerrain.elevationBounds,o=this.view.renderCoordsHelper.getAltitude(s),a=r?Math.abs(r.max-r.min)/Math.abs(o):100,c=o>0?1:-1;Object(j["u"])(n,n),Object(j["h"])(n,n,c*a),Object(j["i"])(i,s,n),Object(v["f"])(i,s,x),t=this._getRayIntersection(x)}else t=this._getRayIntersection(e.ray);return this._canUpdateFromIntersectionResult(t,e)?t.point:null}};Object(s["a"])([Object(c["b"])()],D.prototype,"view",void 0),Object(s["a"])([Object(c["b"])()],D.prototype,"intersector",void 0),D=Object(s["a"])([Object(b["a"])("esri.views.3d.analysis.LineOfSight.LineOfSightRayIntersector")],D);const G=Object(y["f"])(),H=Object(y["f"])(),z=Object(y["f"])(),x=Object(v["c"])();let k=class extends n["a"]{constructor(e){super(e),this.target=null,this.intersectedGraphic=null,this.intersectedLocation=null,this.elevationAlignedTargetLocation=null}};Object(s["a"])([Object(c["b"])()],k.prototype,"target",void 0),Object(s["a"])([Object(c["b"])()],k.prototype,"intersectedGraphic",void 0),Object(s["a"])([Object(c["b"])()],k.prototype,"intersectedLocation",void 0),Object(s["a"])([Object(c["b"])()],k.prototype,"elevationAlignedTargetLocation",void 0),Object(s["a"])([Object(c["b"])()],k.prototype,"visible",void 0),k=Object(s["a"])([Object(b["a"])("esri.views.3d.analysis.LineOfSight.LineOfSightResult")],k);var M=i("0cb9"),F=i("9305"),U=i("d347"),N=i("4ae5");let B=class extends(r["a"].EventedMixin(n["a"])){constructor(e){super(e),this._updatingHandles=new U["a"],this._frameTask=F["a"],this._handles=new h["a"],this._analysisHandles=new h["a"]}initialize(){var e;const t=null==(e=this.view.resourceController)?void 0:e.scheduler;t&&(this._frameTask=t.registerTask(F["b"].LINE_OF_SIGHT_TOOL)),this._handles.add([this._connectObserver(),this._connectAnalyses(),this._connectTargets()]),this._intersector=new D({view:this.view})}destroy(){this._handles.destroy(),this._analysisHandles.destroy(),this._analyses.removeAll(),this._updatingHandles.destroy()}get updating(){return this._frameTask.updating||this._updatingHandles.updating}get priority(){return this._frameTask.priority}set priority(e){this._frameTask.priority=e}get _analyses(){return this.analysisViewData.analyses}get _observerEngineLocation(){return this.analysisViewData.observerEngineLocation}set _observerEngineLocation(e){this.analysisViewData.observerEngineLocation=e}get _screenPixelSize(){return this.view.state.camera.computeScreenPixelSizeAt(this._observerEngineLocation)}getLineOfSightComputationDependencies(e){const{inputPoints:t}=e;return{inputPoints:t}}computeAnalysis(e){const t=e.analysis,{inputPoints:i,computationResult:s}=t,{observerAdjusted:n,targetAdjusted:r}=i,{start:o,end:a}=s;Object(j["n"])(o,n),Object(j["n"])(a,r),this._canComputeAnalysis(t)?this._computeAnalysisIntersection(e):this._interpolateAnalysisIntersection(e),t.updateComputationResults(),this.emit("result-changed",{target:e.analysis.target,result:t.result})}_adjustStartEndPositions(e){const t=this._screenPixelSize,i=this.view,{inputPoints:s}=e,{observer:n,observerSurfaceNormal:r,target:o,targetSurfaceNormal:c,observerAdjusted:l,targetAdjusted:b}=s,d=J;Object(a["l"])(r)?Object(j["n"])(d,r):Object(j["m"])(d,o,n);const h=t;Object(j["u"])(d,d),Object(j["h"])(d,d,Math.min(h,1)),Object(j["i"])(l,n,d),Object(a["l"])(c)?Object(j["n"])(d,c):Object(j["m"])(d,n,o);const u=i.state.camera.computeScreenPixelSizeAt(o);Object(j["u"])(d,d),Object(j["h"])(d,d,Math.min(u,1)),Object(j["i"])(b,o,d)}_computeAnalysisIntersection({analysis:e,interpolationInfo:t}){const{view:i}=this,{sceneIntersectionHelper:s,renderCoordsHelper:n}=i;if(Object(a["k"])(s))return;const r=this._intersector.intersector,{computationResult:o,inputPoints:c}=e,{observer:l,target:b}=c,{start:d,end:h}=o,u=Object(v["f"])(d,h,Z);s.intersectToolIntersectorRay(u,r);const O=o.intersection,p=J,y=r.results.min.getIntersectionPoint(O);let g=!0;if(y){Object(j["n"])(t.originalIntersection,O),Object(j["n"])(t.originalObserver,d),Object(j["n"])(t.originalTarget,h),n.fromRenderCoords(O,p,i.spatialReference);const e=1-Object(j["q"])(h,b)/Object(j["q"])(d,b);g=Object(j["q"])(l,O)>=e*Object(j["q"])(l,b)}const _=new N["a"](p,i.spatialReference);{const{result:t,target:s}=e;Object(a["l"])(t)?(t.target=s,t.intersectedGraphic=g?null:Object(S["a"])(r.results.min,i),t.intersectedLocation=g?null:_,t.visible=!!y&&g):e.result=new k({target:s,elevationAlignedTargetLocation:e.elevationAlignedTargetLocation,intersectedGraphic:g?null:Object(S["a"])(r.results.min,i),intersectedLocation:g?null:_,visible:!!y&&g})}o.isValid=c.isValid=!0,o.isTargetVisible=g}_interpolateAnalysisIntersection({analysis:e,interpolationInfo:t}){const{computationResult:i,inputPoints:s}=e,{start:n,end:r,intersection:o}=i,{originalIntersection:a,originalObserver:c,originalTarget:l}=t;if(Object(j["n"])(o,a),s.isValid){const e=J,t=Object(j["q"])(c,a)/Object(j["q"])(c,l);Object(j["C"])(e,n,c),Object(j["h"])(e,e,1-t),Object(j["i"])(o,o,e),Object(j["C"])(e,r,l),Object(j["h"])(e,e,t),Object(j["i"])(o,o,e),i.isValid=!0}else e.result=null,i.isValid=!1,i.isTargetVisible=!1}_canComputeAnalysis(e){const t=this.analysisViewData.elevationAlignedObserver,i=this.view.frustum;if(Object(a["k"])(t)||Object(a["k"])(e.target)||Object(a["k"])(i))return!1;const{observerAdjusted:s,targetAdjusted:n}=e.inputPoints,r=i.intersectsPoint(s),o=i.intersectsPoint(n);return r&&o}_onObserverChange(e,t){if(Object(a["k"])(e))return this.analysis.targets.removeAll(),void(this.analysisViewData.elevationAlignedObserver=null);this.analysisViewData.elevationAlignedObserver=this._applyElevationAlignment(e,t);const i=Object(y["f"])();this.view.renderCoordsHelper.toRenderCoords(this.analysisViewData.elevationAlignedObserver,i),this._observerEngineLocation=i,this.priority=F["b"].LINE_OF_SIGHT_TOOL_INTERACTIVE}_applyElevationAlignment(e,t){if(e.hasZ&&(Object(a["k"])(t)||0===t.type))return e;const i=e.clone();return i.z=Object(a["v"])(Object(M["b"])(this.view.elevationProvider,i),0),i}_onObserverChangeForAnalysis(e){e.inputPoints.isValid=!1}_onObserverEngineForAnalysis(e,t,i){const{inputPoints:s}=e;if(Object(j["n"])(s.observer,t),Object(a["l"])(i)){const e=this._intersector.updateFromIntersectionResult(i);Object(a["l"])(e)&&this.view.renderCoordsHelper.toRenderCoords(e,s.observer),s.observerSurfaceNormal=Object(y["d"])(i.normal)}else s.observerSurfaceNormal=null;this._adjustStartEndPositions(e),e.updateInputPoints(),this.priority=F["b"].LINE_OF_SIGHT_TOOL_INTERACTIVE}_onTargetLocationChange(e,t,i){const s=e.inputPoints;if(s.isValid=!1,Object(a["l"])(t)){if(e.elevationAlignedTargetLocation=this._applyElevationAlignment(t,i),this.view.renderCoordsHelper.toRenderCoords(e.elevationAlignedTargetLocation,s.target),Object(a["l"])(i)){const e=this._intersector.updateFromIntersectionResult(i);Object(a["l"])(e)&&this.view.renderCoordsHelper.toRenderCoords(e,s.target),s.targetSurfaceNormal=Object(y["d"])(i.normal)}else s.targetSurfaceNormal=null;this._adjustStartEndPositions(e),e.updateInputPoints()}this.priority=F["b"].LINE_OF_SIGHT_TOOL_INTERACTIVE}_connectAnalysisToTarget(e){return Object(u["b"])([Object(p["b"])(()=>e.target.location,t=>{q(t,e.target.intersection)||(e.target.intersection=null)},p["a"]),Object(p["b"])(()=>({analysis:e,targetLocation:e.target.location,targetIntersection:e.target.intersection}),({analysis:e,targetLocation:t,targetIntersection:i})=>{Object(a["l"])(t)&&this._onTargetLocationChange(e,t,i)},p["e"])])}_connectAnalysisToObserver(e){return Object(p["b"])(()=>({analysis:e,observer:this.analysisViewData.elevationAlignedObserver}),({analysis:e})=>{this._onObserverChangeForAnalysis(e)},p["e"])}_connectAnalysisToObserverEngine(e){return Object(p["b"])(()=>({analysis:e,observer:this._observerEngineLocation,observerIntersection:this.analysis.intersection}),({analysis:e,observer:t,observerIntersection:i})=>{this._onObserverEngineForAnalysis(e,t,i)},p["e"])}_connectAnalysisToCamera(e){return Object(p["b"])(()=>({camera:this.view.state.camera,isDirty:this._isCameraDirty}),({isDirty:t})=>{e.inputPoints.isValid&&!t||e.updateInputPoints()},p["d"])}_connectAnalysisToElevation(e){return this.view.elevationProvider.on("elevation-change",t=>{if(!this._canComputeAnalysis(e))return;const i=this.analysis.observer;W(t.extent,t.spatialReference,i)&&this._onObserverChange(i,this.analysis.intersection);const s=e.target;Object(a["l"])(s)&&W(t.extent,t.spatialReference,s.location)&&e.onElevationChange()})}_connectAnalysisForCompute(e){let t=a["q"];const i={analysis:e,interpolationInfo:{originalIntersection:Object(y["f"])(),originalObserver:Object(y["f"])(),originalTarget:Object(y["f"])()}};return Object(u["b"])([Object(p["b"])(()=>this.getLineOfSightComputationDependencies(e),()=>{t=Object(a["a"])(t),t=Object(O["h"])(async e=>{await Object(O["l"])(this._frameTask.schedule(()=>this.computeAnalysis(i),e))})},p["e"]),Object(u["c"])(()=>t=Object(a["a"])(t))])}_connectAnalysis(e){const t=this._analysisHandles;t.has(e)||t.add([this._connectAnalysisToTarget(e),this._connectAnalysisToObserver(e),this._connectAnalysisToObserverEngine(e),this._connectAnalysisToCamera(e),this._connectAnalysisToElevation(e),this._connectAnalysisForCompute(e)],e)}_disconnectAnalysis(e){this._analysisHandles.remove(e)}_onAnalysesCollectionChange(e){e.added.forEach(e=>this._connectAnalysis(e)),e.removed.forEach(e=>this._disconnectAnalysis(e))}_onTargetsChange(){return this._analyses.removeAll(),this.analysis.targets.forEach(e=>this._addTarget(e)),this._updatingHandles.addOnCollectionPropertyChange(this.analysis,"targets",e=>this._onTargetCollectionChange(e))}_onTargetCollectionChange(e){e.added.forEach(e=>this._addTarget(e)),e.removed.forEach(e=>this._removeTarget(e))}_onCursorTargetChange(e,t){Object(a["l"])(t)&&this._removeTarget(t),Object(a["l"])(e)&&this._addTarget(e)}_addTarget(e){this._analyses.some(t=>t.target===e)||this._analyses.add(new f({target:e}))}_removeTarget(e){const t=this._analyses.find(t=>t.target===e);this._analyses.remove(t)}_connectObserver(){return Object(u["b"])([Object(p["b"])(()=>this.analysis.observer,e=>{q(e,this.analysis.intersection)||(this.analysis.intersection=null)},p["a"]),Object(p["b"])(()=>({observer:this.analysis.observer,intersection:this.analysis.intersection}),({observer:e,intersection:t})=>this._onObserverChange(e,t),p["e"])])}_connectAnalyses(){let e=null;return Object(u["b"])([Object(p["b"])(()=>this._analyses,()=>{Object(a["t"])(e),e=this._updatingHandles.addOnCollectionPropertyChange(this,"_analyses",e=>this._onAnalysesCollectionChange(e)),this._analyses.forEach(e=>this._connectAnalysis(e))},p["e"]),Object(u["c"])(()=>e=Object(a["t"])(e))])}_connectTargets(){let e=null;return Object(u["b"])([Object(p["b"])(()=>this.analysis.targets,()=>{e=Object(a["t"])(e),e=this._onTargetsChange()},p["e"]),Object(p["b"])(()=>this.analysisViewData.cursorTarget,(e,t)=>{this._onCursorTargetChange(e,t)}),Object(u["c"])(()=>{e=Object(a["t"])(e)})])}get _isCameraDirty(){const e=this.analysisViewData.elevationAlignedObserver,{view:t}=this,{renderCoordsHelper:i}=t;if(Object(a["k"])(e)||Object(a["k"])(i))return!1;const s=J;i.toRenderCoords(e,s);const n=t.state.camera.computeScreenPixelSizeAt(s);return Math.abs((n-this._screenPixelSize)/this._screenPixelSize)>$}};function W(e,t,i){return!Object(a["k"])(i)&&(Object(g["n"])(e,t,K,i.spatialReference),Object(_["i"])(K,i))}function q(e,t){return Object(a["k"])(t)||Object(a["l"])(e)&&e.equals(t.point)}Object(s["a"])([Object(c["b"])({constructOnly:!0})],B.prototype,"analysis",void 0),Object(s["a"])([Object(c["b"])({constructOnly:!0})],B.prototype,"analysisViewData",void 0),Object(s["a"])([Object(c["b"])({constructOnly:!0})],B.prototype,"view",void 0),Object(s["a"])([Object(c["b"])()],B.prototype,"updating",null),Object(s["a"])([Object(c["b"])()],B.prototype,"priority",null),Object(s["a"])([Object(c["b"])()],B.prototype,"_analyses",null),Object(s["a"])([Object(c["b"])()],B.prototype,"_observerEngineLocation",null),Object(s["a"])([Object(c["b"])()],B.prototype,"_screenPixelSize",null),Object(s["a"])([Object(c["b"])({readOnly:!0})],B.prototype,"_updatingHandles",void 0),Object(s["a"])([Object(c["b"])()],B.prototype,"_frameTask",void 0),Object(s["a"])([Object(c["b"])()],B.prototype,"_isCameraDirty",null),B=Object(s["a"])([Object(b["a"])("esri.views.3d.analysis.LineOfSight.LineOfSightController")],B);const $=.1,J=Object(y["f"])(),Z=Object(v["c"])(),K=Object(_["o"])();var Q=i("2c4f"),X=i("9ef0");let Y=class extends n["a"]{constructor(e){super(e),this.innerWidth=2,this.outerWidth=8,this.visibleInnerColor=new X["a"]([3,252,111,1]),this.visibleOuterColor=new X["a"]([3,252,111,.15]),this.occludedInnerColor=new X["a"]([252,3,69,1]),this.occludedOuterColor=new X["a"]([252,3,69,.1]),this.undefinedInnerColor=new X["a"]([255,255,255,1]),this.undefinedOuterColor=new X["a"]([127,127,127,.2])}};Object(s["a"])([Object(c["b"])({type:Number})],Y.prototype,"innerWidth",void 0),Object(s["a"])([Object(c["b"])({type:Number})],Y.prototype,"outerWidth",void 0),Object(s["a"])([Object(c["b"])({type:X["a"]})],Y.prototype,"visibleInnerColor",void 0),Object(s["a"])([Object(c["b"])({type:X["a"]})],Y.prototype,"visibleOuterColor",void 0),Object(s["a"])([Object(c["b"])({type:X["a"]})],Y.prototype,"occludedInnerColor",void 0),Object(s["a"])([Object(c["b"])({type:X["a"]})],Y.prototype,"occludedOuterColor",void 0),Object(s["a"])([Object(c["b"])({type:X["a"]})],Y.prototype,"undefinedInnerColor",void 0),Object(s["a"])([Object(c["b"])({type:X["a"]})],Y.prototype,"undefinedOuterColor",void 0),Y=Object(s["a"])([Object(b["a"])("esri.views.3d.analysis.LineOfSight.LineOfSightConfiguration")],Y);let ee=class extends n["a"]{constructor(){super(...arguments),this.analyses=new Q["a"],this.elevationAlignedObserver=null,this.configuration=new Y,this.observerEngineLocation=Object(y["f"])(),this.cursorTarget=null}};Object(s["a"])([Object(c["b"])()],ee.prototype,"analyses",void 0),Object(s["a"])([Object(c["b"])()],ee.prototype,"elevationAlignedObserver",void 0),Object(s["a"])([Object(c["b"])({type:Y})],ee.prototype,"configuration",void 0),Object(s["a"])([Object(c["b"])()],ee.prototype,"observerEngineLocation",void 0),Object(s["a"])([Object(c["b"])()],ee.prototype,"cursorTarget",void 0),ee=Object(s["a"])([Object(b["a"])("esri.views.3d.analysis.LineOfSight.LineOfSightViewData")],ee);var te=i("38a4"),ie=i("afe1"),se=i("94e6");let ne=class extends n["a"]{constructor(e){super(e),this._handle=null,this._analysisHandles=new h["a"]}initialize(){this._handle=this._connectAnalyses()}destroy(){this._handle=Object(a["t"])(this._handle),this._analysisHandles=Object(a["e"])(this._analysisHandles)}get visible(){return this.analysisView.visible&&!this.analysisView.suspended}get _analyses(){return this.analysisView.analysisViewData.analyses}get _configuration(){return this.analysisView.analysisViewData.configuration}get _opacity(){return this.analysisView.fullOpacity}createLineOfSightVisualization(){const e=this._configuration,t=this._opacity,i={view:this.view,attached:!0,width:e.outerWidth,innerWidth:e.innerWidth},s=X["a"].toUnitRGBA(e.visibleOuterColor);Object(te["c"])(s,s,t);const n=X["a"].toUnitRGBA(e.visibleInnerColor);Object(te["c"])(n,n,t);const r=X["a"].toUnitRGBA(e.occludedOuterColor);Object(te["c"])(r,r,t);const o=X["a"].toUnitRGBA(e.occludedInnerColor);Object(te["c"])(o,o,t);const a=X["a"].toUnitRGBA(e.undefinedOuterColor);Object(te["c"])(a,a,t);const c=X["a"].toUnitRGBA(e.undefinedInnerColor);return Object(te["c"])(c,c,t),{visibleLineVisualElement:new se["a"]({...i,color:s,innerColor:n}),occludedLineVisualElement:new se["a"]({...i,color:r,innerColor:o}),undefinedLineVisualElement:new se["a"]({...i,color:a,innerColor:c})}}destroyLineOfSightVisualization(e){e.visibleLineVisualElement=Object(a["e"])(e.visibleLineVisualElement),e.occludedLineVisualElement=Object(a["e"])(e.occludedLineVisualElement),e.undefinedLineVisualElement=Object(a["e"])(e.undefinedLineVisualElement)}updateLineOfSightVisualization(e,t){const i=this.visible,s=this._configuration,{computationResult:n,inputPoints:r}=e,{start:o,end:a,intersection:c,isValid:l,isTargetVisible:b}=n,{observer:d}=r,h=ce;h[12]=d[0],h[13]=d[1],h[14]=d[2];const u=Object(j["m"])(re,o,d),O=Object(j["m"])(oe,a,d),p=Object(j["m"])(ae,c,d),{visibleLineVisualElement:g,occludedLineVisualElement:_,undefinedLineVisualElement:v}=t;if(!i)return g.visible=!1,_.visible=!1,void(v.visible=!1);if(g.visible=!0,_.visible=!0,v.visible=!0,g.geometry=null,_.geometry=null,v.geometry=null,l)if(b){g.geometry=[[Object(y["g"])(u),Object(y["g"])(O)]],g.transform=h;const e=X["a"].toUnitRGBA(s.visibleOuterColor);g.color=Object(te["c"])(e,e,this._opacity)}else{g.geometry=[[Object(y["g"])(u),Object(y["g"])(p)]],g.transform=h;const e=X["a"].toUnitRGBA(s.occludedOuterColor);g.color=Object(te["c"])(e,e,this._opacity),_.geometry=[[Object(y["g"])(p),Object(y["g"])(O)]],_.transform=h}else v.geometry=[[Object(y["g"])(u),Object(y["g"])(O)]],v.transform=h}updateVisualizationOpacity(e,t){const i=this._configuration,s=this._opacity,n=X["a"].toUnitRGBA(i.visibleOuterColor);Object(te["c"])(n,n,s);const r=X["a"].toUnitRGBA(i.visibleInnerColor);Object(te["c"])(r,r,s);const o=X["a"].toUnitRGBA(i.occludedOuterColor);Object(te["c"])(o,o,s);const a=X["a"].toUnitRGBA(i.occludedInnerColor);Object(te["c"])(a,a,s);const c=X["a"].toUnitRGBA(i.undefinedOuterColor);Object(te["c"])(c,c,s);const l=X["a"].toUnitRGBA(i.undefinedInnerColor);Object(te["c"])(l,l,s),t.visibleLineVisualElement.color=e.computationResult.isTargetVisible?n:o,t.visibleLineVisualElement.innerColor=r,t.occludedLineVisualElement.color=o,t.occludedLineVisualElement.innerColor=a,t.undefinedLineVisualElement.color=c,t.undefinedLineVisualElement.innerColor=l}getLineOfSightVisualizationDependencies(e){const{computationResult:t}=e,{occludedOuterColor:i,visibleOuterColor:s}=this._configuration;return{computationResult:t,occludedOuterColor:i,visibleOuterColor:s,visible:this.visible}}_connectAnalysis(e){const t=this._analysisHandles;if(t.has(e))return;const i=this.createLineOfSightVisualization();t.add([Object(p["b"])(()=>this.getLineOfSightVisualizationDependencies(e),()=>this.updateLineOfSightVisualization(e,i),p["e"]),Object(p["b"])(()=>this._opacity,()=>this.updateVisualizationOpacity(e,i),p["d"]),Object(u["c"])(()=>this.destroyLineOfSightVisualization(i))],e)}_disconnectAnalysis(e){this._analysisHandles.remove(e)}_connectAnalyses(){let e=null;return Object(u["b"])([Object(p["b"])(()=>this._analyses,t=>{e=Object(a["t"])(e),e=t.on("change",e=>this._onAnalysesCollectionChange(e)),this._onAnalysesCollectionChange({target:t,added:t.items,removed:[],moved:[]})},p["e"]),Object(u["c"])(()=>e=Object(a["t"])(e))])}_onAnalysesCollectionChange(e){e.added.forEach(e=>this._connectAnalysis(e)),e.removed.forEach(e=>this._disconnectAnalysis(e))}};Object(s["a"])([Object(c["b"])({constructOnly:!0})],ne.prototype,"analysis",void 0),Object(s["a"])([Object(c["b"])({constructOnly:!0})],ne.prototype,"analysisView",void 0),Object(s["a"])([Object(c["b"])({constructOnly:!0})],ne.prototype,"view",void 0),Object(s["a"])([Object(c["b"])({readOnly:!0})],ne.prototype,"visible",null),Object(s["a"])([Object(c["b"])()],ne.prototype,"_analyses",null),Object(s["a"])([Object(c["b"])()],ne.prototype,"_configuration",null),Object(s["a"])([Object(c["b"])()],ne.prototype,"_opacity",null),ne=Object(s["a"])([Object(b["a"])("esri.views.3d.analysis.LineOfSight.LineOfSightVisualization")],ne);const re=Object(y["f"])(),oe=Object(y["f"])(),ae=Object(y["f"])(),ce=Object(ie["d"])();let le=class extends(Object(d["a"])(Object(o["b"])(r["a"].EventedMixin(n["a"])))){constructor(e){super(e),this.type="line-of-sight-view",this.suspended=!1,this.fullOpacity=1,this.analysisViewData=new ee}initialize(){const e=this.view,t=this.analysis;this._analysisController=new B({analysis:t,analysisViewData:this.analysisViewData,view:e}),this._analysisVisualization=new ne({analysis:t,analysisView:this,view:e}),this.handles.add([this._analysisController.on("result-changed",e=>{e.target!==this.analysisViewData.cursorTarget&&this.emit("result-changed",e)})])}destroy(){this._analysisController=Object(a["e"])(this._analysisController),this._analysisVisualization=Object(a["e"])(this._analysisVisualization)}get results(){return this.analysisViewData.analyses.map(e=>e.result)}get priority(){return this._analysisController.priority}set priority(e){this._analysisController.priority=e}get updating(){return Object(a["l"])(this._analysisController)&&this._analysisController.updating}getResultForTarget(e){const t=this.analysisViewData.analyses.find(t=>t.target===e),i=Object(a["c"])(t,e=>e.result);return Object(a["v"])(i,null)}get test(){return{visualization:this._analysisVisualization,controller:this._analysisController}}};Object(s["a"])([Object(c["b"])()],le.prototype,"type",void 0),Object(s["a"])([Object(c["b"])()],le.prototype,"analysis",void 0),Object(s["a"])([Object(c["b"])({readOnly:!0})],le.prototype,"results",null),Object(s["a"])([Object(c["b"])()],le.prototype,"priority",null),Object(s["a"])([Object(c["b"])()],le.prototype,"suspended",void 0),Object(s["a"])([Object(c["b"])()],le.prototype,"fullOpacity",void 0),Object(s["a"])([Object(c["b"])()],le.prototype,"analysisViewData",void 0),Object(s["a"])([Object(c["b"])()],le.prototype,"updating",null),Object(s["a"])([Object(c["b"])()],le.prototype,"_analysisController",void 0),Object(s["a"])([Object(c["b"])()],le.prototype,"_analysisVisualization",void 0),le=Object(s["a"])([Object(b["a"])("esri.views.3d.analysis.LineOfSight.LineOfSightView3D")],le);const be=le},"94e6":function(e,t,i){"use strict";i.d(t,"a",(function(){return u}));var s=i("b2b2"),n=i("d791"),r=i("afe1"),o=i("e431"),a=i("0b2d"),c=i("7577"),l=i("5ef2"),b=i("5fae"),d=i("d408"),h=i("86ba");class u extends b["a"]{constructor(e){super(e),this._renderOccluded=4,this._width=1,this._color=Object(l["c"])(1,0,1,1),this._innerWidth=1,this._innerColor=null,this._stipplePattern=null,this._stippleOffColor=null,this._stipplePreferContinuous=!0,this._writeDepthEnabled=!0,this._falloff=0,this._polygonOffset=!1,this.applyProps(e)}setGeometryFromRenderSpacePoint(e){const t=1e3,i=[];i.push([[e[0]-t,e[1]+0,e[2]+0],[e[0]+t,e[1]+0,e[2]+0]]),i.push([[e[0]-0,e[1]-t,e[2]+0],[e[0]+0,e[1]+t,e[2]+0]]),i.push([[e[0]-0,e[1]+0,e[2]-t],[e[0]+0,e[1]+0,e[2]+t]]),this.geometry=i}setGeometryFromExtent(e){const t=this.view.spatialReference,i=Object(a["f"])(),s=Object(a["f"])(),n=100,r=[];Object(o["z"])(i,e[0],e[1],n),this.view.renderCoordsHelper.toRenderCoords(i,t,s),r.push([s[0],s[1],s[2]]),Object(o["z"])(i,e[2],e[1],n),this.view.renderCoordsHelper.toRenderCoords(i,t,s),r.push([s[0],s[1],s[2]]),Object(o["z"])(i,e[2],e[3],n),this.view.renderCoordsHelper.toRenderCoords(i,t,s),r.push([s[0],s[1],s[2]]),Object(o["z"])(i,e[0],e[3],n),this.view.renderCoordsHelper.toRenderCoords(i,t,s),r.push([s[0],s[1],s[2]]),Object(o["z"])(i,e[0],e[1],n),this.view.renderCoordsHelper.toRenderCoords(i,t,s),r.push([s[0],s[1],s[2]]),Object(o["z"])(i,e[0],e[1],n),this.view.renderCoordsHelper.toRenderCoords(i,t,s),r.push([s[0],s[1],s[2]]),this.geometry=[r]}setGeometryFromFrustum(e){const t=[];e.lines.forEach(e=>{t.push([e.origin[0],e.origin[1],e.origin[2]]),t.push([e.endpoint[0],e.endpoint[1],e.endpoint[2]])}),this.geometry=[t]}setGeometryFromBoundedPlane(e){const t=[],i=e.origin,s=e.basis1,n=e.basis2,r=.5,o=Object(a["f"])(),c=Object(a["f"])(),l=Object(a["f"])(),b=Object(a["f"])();o[0]=i[0]-s[0]*r-n[0]*r,o[1]=i[1]-s[1]*r-n[1]*r,o[2]=i[2]-s[2]*r-n[2]*r,c[0]=i[0]-s[0]*r+n[0]*r,c[1]=i[1]-s[1]*r+n[1]*r,c[2]=i[2]-s[2]*r+n[2]*r,l[0]=i[0]+s[0]*r+n[0]*r,l[1]=i[1]+s[1]*r+n[1]*r,l[2]=i[2]+s[2]*r+n[2]*r,b[0]=i[0]+s[0]*r-n[0]*r,b[1]=i[1]+s[1]*r-n[1]*r,b[2]=i[2]+s[2]*r-n[2]*r,t.push([o[0],o[1],o[2]]),t.push([c[0],c[1],c[2]]),t.push([l[0],l[1],l[2]]),t.push([b[0],b[1],b[2]]),t.push([o[0],o[1],o[2]]),this.geometry=[t]}setGeometryFromSegment(e){const t=e.endRenderSpace;Object(n["j"])(O),Object(n["b"])(O,O,t),this.transform=O;const{points:i}=e.createRenderGeometry(t,this.view.renderCoordsHelper);this.geometry=[i]}setGeometryFromSegments(e,t=a["c"]){Object(n["j"])(O),Object(n["b"])(O,O,t),this.transform=O,this.geometry=e.map(e=>e.createRenderGeometry(t,this.view.renderCoordsHelper).points)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.recreateGeometry()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get color(){return this._color}set color(e){Object(c["g"])(e,this._color)||(Object(c["c"])(this._color,e),this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){Object(s["l"])(e)?!Object(s["k"])(this._innerColor)&&Object(c["g"])(e,this._innerColor)||(this._innerColor=Object(c["c"])(Object(l["b"])(),e),this._updateMaterial()):Object(s["l"])(this._innerColor)&&(this._innerColor=null,this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){const t=Object(s["l"])(e)!==Object(s["l"])(this._stipplePattern);this._stipplePattern=e,t?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){(Object(s["k"])(e)||Object(s["k"])(this._stippleOffColor)||!Object(c["g"])(e,this._stippleOffColor))&&(this._stippleOffColor=Object(s["l"])(e)?Object(l["a"])(e):null,this._updateMaterial())}get stipplePreferContinuous(){return this._stipplePreferContinuous}set stipplePreferContinuous(e){this._stipplePreferContinuous!==e&&(this._stipplePreferContinuous=e,this._updateMaterial())}get writeDepthEnabled(){return this._writeDepthEnabled}set writeDepthEnabled(e){this._writeDepthEnabled!==e&&(this._writeDepthEnabled=e,this._updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial())}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){e!==this._polygonOffset&&(this._polygonOffset=e,this._updateMaterial())}createExternalResources(){this._material=new h["a"](this.materialParameters)}destroyExternalResources(){this._material=null}createGeometries(e){const t=this._createLineGeometries();if(0!==t.length)for(let i=0;i<t.length;++i){const s=Object(d["a"])(t[i]);e.addGeometry(s,this._material)}}forEachExternalMaterial(e){e(this._material)}get materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:this._stipplePreferContinuous,isClosed:!1,falloff:this._falloff,innerColor:this._innerColor,innerWidth:this._innerWidth,polygonOffset:this._polygonOffset,renderOccluded:this._renderOccluded,writeDepth:this._writeDepthEnabled}}_updateMaterial(){this.attached&&this._material.setParameters(this.materialParameters)}_createLineGeometries(){const e=this.geometry;if(Object(s["k"])(e)||0===e.length)return[];const t=[];return e.forEach(e=>{const i=e.length,s=new Float64Array(3*i);e.forEach((e,t)=>{s[3*t+0]=e[0],s[3*t+1]=e[1],s[3*t+2]=e[2]});const n={overlayInfo:null,attributeData:{position:s},removeDuplicateStartEnd:0};t.push(n)}),t}}const O=Object(r["d"])()},f53a:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));class s{constructor(e){this._attached=!1,this._resourcesCreated=!1,this._visible=!0,this.view=e,this.view.watch("ready",e=>{this._resourcesCreated&&(e?this._createResources():this._destroyResources())})}applyProps(e){let t=!1;for(const i in e)i in this?"attached"===i?t=e[i]:this[i]=e[i]:console.error("Cannot set unknown property",i);this.attached=t}destroy(){this.attached=!1}get attached(){return this._attached}set attached(e){e!==this._attached&&this.view._stage&&(this._attached=e,this._attached&&!this._resourcesCreated?this._createResources():!this._attached&&this._resourcesCreated&&this._destroyResources())}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this.attached&&this.updateVisibility(e))}_createResources(){this.createResources(),this._resourcesCreated=!0,this.visible||this.updateVisibility(!1)}_destroyResources(){this.destroyResources(),this._resourcesCreated=!1}}}}]);